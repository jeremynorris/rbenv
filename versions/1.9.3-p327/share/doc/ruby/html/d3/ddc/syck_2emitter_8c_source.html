<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Ruby: ext/syck/emitter.c Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="../../index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="../../files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="../../globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<h1>ext/syck/emitter.c</h1><a href="../../d3/ddc/syck_2emitter_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment"> * emitter.c</span>
<a name="l00003"></a>00003 <span class="comment"> *</span>
<a name="l00004"></a>00004 <span class="comment"> * $Author: naruse $</span>
<a name="l00005"></a>00005 <span class="comment"> *</span>
<a name="l00006"></a>00006 <span class="comment"> * Copyright (C) 2003 why the lucky stiff</span>
<a name="l00007"></a>00007 <span class="comment"> *</span>
<a name="l00008"></a>00008 <span class="comment"> * All Base64 code from Ruby&apos;s pack.c.</span>
<a name="l00009"></a>00009 <span class="comment"> * Ruby is Copyright (C) 1993-2007 Yukihiro Matsumoto</span>
<a name="l00010"></a>00010 <span class="comment"> */</span>
<a name="l00011"></a>00011 <span class="preprocessor">#include &quot;<a class="code" href="../../de/de6/ruby_2ruby_8h.html">ruby/ruby.h</a>&quot;</span>
<a name="l00012"></a>00012 
<a name="l00013"></a>00013 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
<a name="l00014"></a>00014 <span class="preprocessor">#include &lt;string.h&gt;</span>
<a name="l00015"></a>00015 
<a name="l00016"></a>00016 <span class="preprocessor">#include &quot;<a class="code" href="../../de/dce/syck_8h.html">syck.h</a>&quot;</span>
<a name="l00017"></a>00017 
<a name="l00018"></a><a class="code" href="../../d3/ddc/syck_2emitter_8c.html#aa8f15fc9b9db1bf95d797a555e889931">00018</a> <span class="preprocessor">#define DEFAULT_ANCHOR_FORMAT &quot;id%03d&quot;</span>
<a name="l00019"></a>00019 <span class="preprocessor"></span>
<a name="l00020"></a><a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a1fd9aee3bb6a7695c79e6ec889022c60">00020</a> <span class="keyword">const</span> <span class="keywordtype">char</span> <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a1fd9aee3bb6a7695c79e6ec889022c60">hex_table</a>[] =
<a name="l00021"></a>00021 <span class="stringliteral">&quot;0123456789ABCDEF&quot;</span>;
<a name="l00022"></a><a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a0d859bbd272a8ce6dc91ed853326776a">00022</a> <span class="keyword">static</span> <span class="keywordtype">char</span> <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a0d859bbd272a8ce6dc91ed853326776a">b64_table</a>[] =
<a name="l00023"></a>00023 <span class="stringliteral">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&quot;</span>;
<a name="l00024"></a>00024 
<a name="l00025"></a>00025 <span class="comment">/*</span>
<a name="l00026"></a>00026 <span class="comment"> * Built-in base64 (from Ruby&apos;s pack.c)</span>
<a name="l00027"></a>00027 <span class="comment"> */</span>
<a name="l00028"></a>00028 <span class="keywordtype">char</span> *
<a name="l00029"></a><a class="code" href="../../de/dce/syck_8h.html#a98952e24afd69abc5586c6842846153b">00029</a> <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a6331de743d8bbcd4c1469f77cac4319a">syck_base64enc</a>( <span class="keywordtype">char</span> *s, <span class="keywordtype">long</span> <a class="code" href="../../d3/d15/name2ctype_8h.html#aed1cc4dca5d94cb452f79691f54f7423">len</a> )
<a name="l00030"></a>00030 {
<a name="l00031"></a>00031     <span class="keywordtype">long</span> i = 0;
<a name="l00032"></a>00032     <span class="keywordtype">int</span> padding = <span class="charliteral">&apos;=&apos;</span>;
<a name="l00033"></a>00033     <span class="keywordtype">char</span> *buff = <a class="code" href="../../de/dce/syck_8h.html#a2d20ec6949b5978b35b88eedf43f36ff">S_ALLOC_N</a>(<span class="keywordtype">char</span>, len * 4 / 3 + 6);
<a name="l00034"></a>00034 
<a name="l00035"></a>00035     <span class="keywordflow">while</span> (len &gt;= 3) {
<a name="l00036"></a>00036         buff[i++] = <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a0d859bbd272a8ce6dc91ed853326776a">b64_table</a>[077 &amp; (*s &gt;&gt; 2)];
<a name="l00037"></a>00037         buff[i++] = <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a0d859bbd272a8ce6dc91ed853326776a">b64_table</a>[077 &amp; (((*s &lt;&lt; 4) &amp; 060) | ((s[1] &gt;&gt; 4) &amp; 017))];
<a name="l00038"></a>00038         buff[i++] = <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a0d859bbd272a8ce6dc91ed853326776a">b64_table</a>[077 &amp; (((s[1] &lt;&lt; 2) &amp; 074) | ((s[2] &gt;&gt; 6) &amp; 03))];
<a name="l00039"></a>00039         buff[i++] = <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a0d859bbd272a8ce6dc91ed853326776a">b64_table</a>[077 &amp; s[2]];
<a name="l00040"></a>00040         s += 3;
<a name="l00041"></a>00041         len -= 3;
<a name="l00042"></a>00042     }
<a name="l00043"></a>00043     <span class="keywordflow">if</span> (len == 2) {
<a name="l00044"></a>00044         buff[i++] = <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a0d859bbd272a8ce6dc91ed853326776a">b64_table</a>[077 &amp; (*s &gt;&gt; 2)];
<a name="l00045"></a>00045         buff[i++] = <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a0d859bbd272a8ce6dc91ed853326776a">b64_table</a>[077 &amp; (((*s &lt;&lt; 4) &amp; 060) | ((s[1] &gt;&gt; 4) &amp; 017))];
<a name="l00046"></a>00046         buff[i++] = <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a0d859bbd272a8ce6dc91ed853326776a">b64_table</a>[077 &amp; (((s[1] &lt;&lt; 2) &amp; 074) | ((<span class="charliteral">&apos;\0&apos;</span> &gt;&gt; 6) &amp; 03))];
<a name="l00047"></a>00047         buff[i++] = padding;
<a name="l00048"></a>00048     }
<a name="l00049"></a>00049     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (len == 1) {
<a name="l00050"></a>00050         buff[i++] = <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a0d859bbd272a8ce6dc91ed853326776a">b64_table</a>[077 &amp; (*s &gt;&gt; 2)];
<a name="l00051"></a>00051         buff[i++] = <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a0d859bbd272a8ce6dc91ed853326776a">b64_table</a>[077 &amp; (((*s &lt;&lt; 4) &amp; 060) | ((&apos;\0&apos; &gt;&gt; 4) &amp; 017))];
<a name="l00052"></a>00052         buff[i++] = padding;
<a name="l00053"></a>00053         buff[i++] = padding;
<a name="l00054"></a>00054     }
<a name="l00055"></a>00055     buff[i++] = <span class="charliteral">&apos;\n&apos;</span>;
<a name="l00056"></a>00056     <span class="keywordflow">return</span> buff;
<a name="l00057"></a>00057 }
<a name="l00058"></a>00058 
<a name="l00059"></a>00059 <span class="keywordtype">char</span> *
<a name="l00060"></a><a class="code" href="../../de/dce/syck_8h.html#afc88b261d2ce866f77576cc0f4da3b10">00060</a> <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a2a70064b1385f2540a497b62bdfba8a1">syck_base64dec</a>( <span class="keywordtype">char</span> *s, <span class="keywordtype">long</span> <a class="code" href="../../d3/d15/name2ctype_8h.html#aed1cc4dca5d94cb452f79691f54f7423">len</a> )
<a name="l00061"></a>00061 {
<a name="l00062"></a>00062     <span class="keywordtype">int</span> a = -1,b = -1,c = 0,d;
<a name="l00063"></a>00063     <span class="keyword">static</span> <span class="keywordtype">int</span> first = 1;
<a name="l00064"></a>00064     <span class="keyword">static</span> <span class="keywordtype">int</span> b64_xtable[256];
<a name="l00065"></a>00065     <span class="keywordtype">char</span> *ptr = <a class="code" href="../../d1/d7b/syck_8c.html#a9287d968dc4ca9e2bd16635a2cdbcdf5">syck_strndup</a>( s, len );
<a name="l00066"></a>00066     <span class="keywordtype">char</span> *end = ptr;
<a name="l00067"></a>00067     <span class="keywordtype">char</span> *send = s + len;
<a name="l00068"></a>00068 
<a name="l00069"></a>00069     <span class="keywordflow">if</span> (first) {
<a name="l00070"></a>00070         <span class="keywordtype">int</span> i;
<a name="l00071"></a>00071         first = 0;
<a name="l00072"></a>00072 
<a name="l00073"></a>00073         <span class="keywordflow">for</span> (i = 0; i &lt; 256; i++) {
<a name="l00074"></a>00074         b64_xtable[i] = -1;
<a name="l00075"></a>00075         }
<a name="l00076"></a>00076         <span class="keywordflow">for</span> (i = 0; i &lt; 64; i++) {
<a name="l00077"></a>00077         b64_xtable[(int)<a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a0d859bbd272a8ce6dc91ed853326776a">b64_table</a>[i]] = i;
<a name="l00078"></a>00078         }
<a name="l00079"></a>00079     }
<a name="l00080"></a>00080     <span class="keywordflow">while</span> (s &lt; send) {
<a name="l00081"></a>00081         <span class="keywordflow">while</span> (s[0] == <span class="charliteral">&apos;\r&apos;</span> || s[0] == <span class="charliteral">&apos;\n&apos;</span>) { s++; }
<a name="l00082"></a>00082         <span class="keywordflow">if</span> ((a = b64_xtable[(<span class="keywordtype">int</span>)s[0]]) == -1) <span class="keywordflow">break</span>;
<a name="l00083"></a>00083         <span class="keywordflow">if</span> ((b = b64_xtable[(<span class="keywordtype">int</span>)s[1]]) == -1) <span class="keywordflow">break</span>;
<a name="l00084"></a>00084         <span class="keywordflow">if</span> ((c = b64_xtable[(<span class="keywordtype">int</span>)s[2]]) == -1) <span class="keywordflow">break</span>;
<a name="l00085"></a>00085         <span class="keywordflow">if</span> ((d = b64_xtable[(<span class="keywordtype">int</span>)s[3]]) == -1) <span class="keywordflow">break</span>;
<a name="l00086"></a>00086         *end++ = a &lt;&lt; 2 | b &gt;&gt; 4;
<a name="l00087"></a>00087         *end++ = b &lt;&lt; 4 | c &gt;&gt; 2;
<a name="l00088"></a>00088         *end++ = c &lt;&lt; 6 | d;
<a name="l00089"></a>00089         s += 4;
<a name="l00090"></a>00090     }
<a name="l00091"></a>00091     <span class="keywordflow">if</span> (a != -1 &amp;&amp; b != -1) {
<a name="l00092"></a>00092         <span class="keywordflow">if</span> (s + 2 &lt; send &amp;&amp; s[2] == <span class="charliteral">&apos;=&apos;</span>)
<a name="l00093"></a>00093         *end++ = a &lt;&lt; 2 | b &gt;&gt; 4;
<a name="l00094"></a>00094         <span class="keywordflow">if</span> (c != -1 &amp;&amp; s + 3 &lt; send &amp;&amp; s[3] == <span class="charliteral">&apos;=&apos;</span>) {
<a name="l00095"></a>00095         *end++ = a &lt;&lt; 2 | b &gt;&gt; 4;
<a name="l00096"></a>00096         *end++ = b &lt;&lt; 4 | c &gt;&gt; 2;
<a name="l00097"></a>00097         }
<a name="l00098"></a>00098     }
<a name="l00099"></a>00099     *end = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l00100"></a>00100     <span class="comment">/*RSTRING_LEN(buf) = ptr - RSTRING_PTR(buf);*/</span>
<a name="l00101"></a>00101     <span class="keywordflow">return</span> ptr;
<a name="l00102"></a>00102 }
<a name="l00103"></a>00103 
<a name="l00104"></a>00104 <span class="comment">/*</span>
<a name="l00105"></a>00105 <span class="comment"> * Allocate an emitter</span>
<a name="l00106"></a>00106 <span class="comment"> */</span>
<a name="l00107"></a>00107 <a class="code" href="../../d8/df6/struct__syck__emitter.html">SyckEmitter</a> *
<a name="l00108"></a><a class="code" href="../../de/dce/syck_8h.html#a6d0fdf06e34c563f1f3bae139889ebcf">00108</a> <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a6d0fdf06e34c563f1f3bae139889ebcf">syck_new_emitter</a>(<span class="keywordtype">void</span>)
<a name="l00109"></a>00109 {
<a name="l00110"></a>00110     <a class="code" href="../../d8/df6/struct__syck__emitter.html">SyckEmitter</a> *e;
<a name="l00111"></a>00111     e = <a class="code" href="../../de/dce/syck_8h.html#a4114ec55b6f0ccb17ffb6faf8b617019">S_ALLOC</a>( <a class="code" href="../../d8/df6/struct__syck__emitter.html">SyckEmitter</a> );
<a name="l00112"></a>00112     e-&gt;<a class="code" href="../../d8/df6/struct__syck__emitter.html#a93a1b4e72752fe68cb5b615266810b11">headless</a> = 0;
<a name="l00113"></a>00113     e-&gt;<a class="code" href="../../d8/df6/struct__syck__emitter.html#a48879724a6f8cfd9be22a069491b3dc8">use_header</a> = 0;
<a name="l00114"></a>00114     e-&gt;<a class="code" href="../../d8/df6/struct__syck__emitter.html#a903652654e7763e61f8ea52e90b36db4">use_version</a> = 0;
<a name="l00115"></a>00115     e-&gt;<a class="code" href="../../d8/df6/struct__syck__emitter.html#abaf2fa9232e3dcdde0ffaa8f5bbb3e52">sort_keys</a> = 0;
<a name="l00116"></a>00116     e-&gt;<a class="code" href="../../d8/df6/struct__syck__emitter.html#a72e7aa295527973d4166e9eaa1b84eea">anchor_format</a> = <a class="code" href="../../d3/d09/ripper_8y.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00117"></a>00117     e-&gt;<a class="code" href="../../d8/df6/struct__syck__emitter.html#a714457cf53a8c01c33a4c3fc7890e06c">explicit_typing</a> = 0;
<a name="l00118"></a>00118     e-&gt;<a class="code" href="../../d8/df6/struct__syck__emitter.html#a23c54040a81c39d90489250ce66fd3cf">best_width</a> = 80;
<a name="l00119"></a>00119     e-&gt;<a class="code" href="../../d8/df6/struct__syck__emitter.html#abae2d1aaa5f6799f012747ee2e999de2">style</a> = <a class="code" href="../../de/dce/syck_8h.html#a80e0a63715fa32302da405e1585e2f31a91d800cf241e7dc19373dcbceb2c1c27">scalar_none</a>;
<a name="l00120"></a>00120     e-&gt;<a class="code" href="../../d8/df6/struct__syck__emitter.html#a9b961bc8d17683a1b224d1b8ddd8f82c">stage</a> = <a class="code" href="../../de/dce/syck_8h.html#a301a1810f5a817f18e1dde01c771ba04a0d1fbbbb2cb83330bfeeaacfb8f9908e">doc_open</a>;
<a name="l00121"></a>00121     e-&gt;<a class="code" href="../../d8/df6/struct__syck__emitter.html#a1e9795a23ab21ee7fc817921c3a238e1">indent</a> = 2;
<a name="l00122"></a>00122     e-&gt;<a class="code" href="../../d8/df6/struct__syck__emitter.html#abd506e869003405dfa510827bf3f66b1">level</a> = -1;
<a name="l00123"></a>00123     e-&gt;<a class="code" href="../../d8/df6/struct__syck__emitter.html#ac20bad3bf020fd6e0a02dc506eeaf421">anchors</a> = <a class="code" href="../../d3/d09/ripper_8y.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00124"></a>00124     e-&gt;<a class="code" href="../../d8/df6/struct__syck__emitter.html#a7b0db5fa866e726fc11b2bf08a5830b2">markers</a> = <a class="code" href="../../d3/d09/ripper_8y.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00125"></a>00125     e-&gt;<a class="code" href="../../d8/df6/struct__syck__emitter.html#aee20e4cb0b0911ee2f37b9c065e23a85">anchored</a> = <a class="code" href="../../d3/d09/ripper_8y.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00126"></a>00126     e-&gt;<a class="code" href="../../d8/df6/struct__syck__emitter.html#ac1aed632ef8ec2b30a57345949689fd7">bufsize</a> = <a class="code" href="../../de/dce/syck_8h.html#afc4805cd2cca78083bb1b2ccc79c3d68">SYCK_BUFFERSIZE</a>;
<a name="l00127"></a>00127     e-&gt;<a class="code" href="../../d8/df6/struct__syck__emitter.html#aea9239b4ebb3ae4f3d3502fce357f143">buffer</a> = <a class="code" href="../../d3/d09/ripper_8y.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00128"></a>00128     e-&gt;<a class="code" href="../../d8/df6/struct__syck__emitter.html#a3f5edd01c8e21f404279d345b981a49b">marker</a> = <a class="code" href="../../d3/d09/ripper_8y.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00129"></a>00129     e-&gt;<a class="code" href="../../d8/df6/struct__syck__emitter.html#aca2e1583f8909e1ea4e37bef74b1381c">bufpos</a> = 0;
<a name="l00130"></a>00130     e-&gt;<a class="code" href="../../d8/df6/struct__syck__emitter.html#a886df322c1ec31d88ca0b9026823b8e6">emitter_handler</a> = <a class="code" href="../../d3/d09/ripper_8y.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00131"></a>00131     e-&gt;<a class="code" href="../../d8/df6/struct__syck__emitter.html#a5f4f9b474c3ec9a9583333c83f188532">output_handler</a> = <a class="code" href="../../d3/d09/ripper_8y.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00132"></a>00132     e-&gt;<a class="code" href="../../d8/df6/struct__syck__emitter.html#a210f0a62f622de3c022948e946d6efdd">lvl_idx</a> = 0;
<a name="l00133"></a>00133     e-&gt;<a class="code" href="../../d8/df6/struct__syck__emitter.html#a2bf84b16e1c52734de7056f290a0be17">lvl_capa</a> = <a class="code" href="../../de/dce/syck_8h.html#a5ad3e8aa9105cb4dc0fbc9d33427671d">ALLOC_CT</a>;
<a name="l00134"></a>00134     e-&gt;<a class="code" href="../../d8/df6/struct__syck__emitter.html#ae7f2d8223a9d5fa4993f6e33694f4762">levels</a> = <a class="code" href="../../de/dce/syck_8h.html#a2d20ec6949b5978b35b88eedf43f36ff">S_ALLOC_N</a>( <a class="code" href="../../dd/d0e/struct__syck__level.html">SyckLevel</a>, e-&gt;<a class="code" href="../../d8/df6/struct__syck__emitter.html#a2bf84b16e1c52734de7056f290a0be17">lvl_capa</a> );
<a name="l00135"></a>00135     <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#adca3b3d5928b2e4e1806db3dfdf96966">syck_emitter_reset_levels</a>( e );
<a name="l00136"></a>00136     e-&gt;<a class="code" href="../../d8/df6/struct__syck__emitter.html#a8ebc445cac4146b1157563aa2a747a4b">bonus</a> = <a class="code" href="../../d3/d09/ripper_8y.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00137"></a>00137     <span class="keywordflow">return</span> e;
<a name="l00138"></a>00138 }
<a name="l00139"></a>00139 
<a name="l00140"></a>00140 <span class="keywordtype">int</span>
<a name="l00141"></a><a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a30eceef240e9aa9f1e44921901bacf1e">00141</a> <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a30eceef240e9aa9f1e44921901bacf1e">syck_st_free_anchors</a>( <span class="keywordtype">char</span> *<a class="code" href="../../dc/de5/random_8c.html#a742229490b6759a90ece7ba82ba129d5">key</a>, <span class="keywordtype">char</span> *<a class="code" href="../../d6/da0/nkf-utf8_2nkf_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="keywordtype">char</span> *arg )
<a name="l00142"></a>00142 {
<a name="l00143"></a>00143     <a class="code" href="../../de/dce/syck_8h.html#a59b854f4bc2b7cd8e19c75600deeb24d">S_FREE</a>( name );
<a name="l00144"></a>00144     <span class="keywordflow">return</span> <a class="code" href="../../dd/d24/st_8h.html#a0c6a172fd99de7928916e65034ed8b1fac99fc55c7f355bf9071739a4bc2ea139">ST_CONTINUE</a>;
<a name="l00145"></a>00145 }
<a name="l00146"></a>00146 
<a name="l00147"></a>00147 <span class="keywordtype">void</span>
<a name="l00148"></a><a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a3ab4de793a630b3989f78f88a25df04a">00148</a> <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a3ab4de793a630b3989f78f88a25df04a">syck_emitter_st_free</a>( <a class="code" href="../../d8/df6/struct__syck__emitter.html">SyckEmitter</a> *e )
<a name="l00149"></a>00149 {
<a name="l00150"></a>00150     <span class="comment">/*</span>
<a name="l00151"></a>00151 <span class="comment">     * Free the anchor tables</span>
<a name="l00152"></a>00152 <span class="comment">     */</span>
<a name="l00153"></a>00153     <span class="keywordflow">if</span> ( e-&gt;<a class="code" href="../../d8/df6/struct__syck__emitter.html#ac20bad3bf020fd6e0a02dc506eeaf421">anchors</a> != <a class="code" href="../../d3/d09/ripper_8y.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> )
<a name="l00154"></a>00154     {
<a name="l00155"></a>00155         <a class="code" href="../../dd/d24/st_8h.html#ace5a79870d2800659a653fceeca55262">st_foreach</a>( e-&gt;<a class="code" href="../../d8/df6/struct__syck__emitter.html#ac20bad3bf020fd6e0a02dc506eeaf421">anchors</a>, <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a30eceef240e9aa9f1e44921901bacf1e">syck_st_free_anchors</a>, 0 );
<a name="l00156"></a>00156         <a class="code" href="../../dd/d24/st_8h.html#acb004847ef312373d65bfb0d1a21c5b3">st_free_table</a>( e-&gt;<a class="code" href="../../d8/df6/struct__syck__emitter.html#ac20bad3bf020fd6e0a02dc506eeaf421">anchors</a> );
<a name="l00157"></a>00157         e-&gt;<a class="code" href="../../d8/df6/struct__syck__emitter.html#ac20bad3bf020fd6e0a02dc506eeaf421">anchors</a> = <a class="code" href="../../d3/d09/ripper_8y.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00158"></a>00158     }
<a name="l00159"></a>00159 
<a name="l00160"></a>00160     <span class="keywordflow">if</span> ( e-&gt;<a class="code" href="../../d8/df6/struct__syck__emitter.html#aee20e4cb0b0911ee2f37b9c065e23a85">anchored</a> != <a class="code" href="../../d3/d09/ripper_8y.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> )
<a name="l00161"></a>00161     {
<a name="l00162"></a>00162         <a class="code" href="../../dd/d24/st_8h.html#acb004847ef312373d65bfb0d1a21c5b3">st_free_table</a>( e-&gt;<a class="code" href="../../d8/df6/struct__syck__emitter.html#aee20e4cb0b0911ee2f37b9c065e23a85">anchored</a> );
<a name="l00163"></a>00163         e-&gt;<a class="code" href="../../d8/df6/struct__syck__emitter.html#aee20e4cb0b0911ee2f37b9c065e23a85">anchored</a> = <a class="code" href="../../d3/d09/ripper_8y.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00164"></a>00164     }
<a name="l00165"></a>00165 
<a name="l00166"></a>00166     <span class="comment">/*</span>
<a name="l00167"></a>00167 <span class="comment">     * Free the markers tables</span>
<a name="l00168"></a>00168 <span class="comment">     */</span>
<a name="l00169"></a>00169     <span class="keywordflow">if</span> ( e-&gt;<a class="code" href="../../d8/df6/struct__syck__emitter.html#a7b0db5fa866e726fc11b2bf08a5830b2">markers</a> != <a class="code" href="../../d3/d09/ripper_8y.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> )
<a name="l00170"></a>00170     {
<a name="l00171"></a>00171         <a class="code" href="../../dd/d24/st_8h.html#acb004847ef312373d65bfb0d1a21c5b3">st_free_table</a>( e-&gt;<a class="code" href="../../d8/df6/struct__syck__emitter.html#a7b0db5fa866e726fc11b2bf08a5830b2">markers</a> );
<a name="l00172"></a>00172         e-&gt;<a class="code" href="../../d8/df6/struct__syck__emitter.html#a7b0db5fa866e726fc11b2bf08a5830b2">markers</a> = <a class="code" href="../../d3/d09/ripper_8y.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00173"></a>00173     }
<a name="l00174"></a>00174 }
<a name="l00175"></a>00175 
<a name="l00176"></a>00176 <a class="code" href="../../dd/d0e/struct__syck__level.html">SyckLevel</a> *
<a name="l00177"></a><a class="code" href="../../de/dce/syck_8h.html#aed413bd3e59b140647ce36644aa5d3e5">00177</a> <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a5f9693ef17bdeacaa7afd778a29cb919">syck_emitter_current_level</a>( <a class="code" href="../../d8/df6/struct__syck__emitter.html">SyckEmitter</a> *e )
<a name="l00178"></a>00178 {
<a name="l00179"></a>00179     <span class="keywordflow">return</span> &amp;e-&gt;<a class="code" href="../../d8/df6/struct__syck__emitter.html#ae7f2d8223a9d5fa4993f6e33694f4762">levels</a>[e-&gt;<a class="code" href="../../d8/df6/struct__syck__emitter.html#a210f0a62f622de3c022948e946d6efdd">lvl_idx</a>-1];
<a name="l00180"></a>00180 }
<a name="l00181"></a>00181 
<a name="l00182"></a>00182 <a class="code" href="../../dd/d0e/struct__syck__level.html">SyckLevel</a> *
<a name="l00183"></a><a class="code" href="../../de/dce/syck_8h.html#a802732c5d64e48e8fd2d432f03c81bb4">00183</a> <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a35436ae22a44347661a8bb282d9ef744">syck_emitter_parent_level</a>( <a class="code" href="../../d8/df6/struct__syck__emitter.html">SyckEmitter</a> *e )
<a name="l00184"></a>00184 {
<a name="l00185"></a>00185     <span class="keywordflow">return</span> &amp;e-&gt;<a class="code" href="../../d8/df6/struct__syck__emitter.html#ae7f2d8223a9d5fa4993f6e33694f4762">levels</a>[e-&gt;<a class="code" href="../../d8/df6/struct__syck__emitter.html#a210f0a62f622de3c022948e946d6efdd">lvl_idx</a>-2];
<a name="l00186"></a>00186 }
<a name="l00187"></a>00187 
<a name="l00188"></a>00188 <span class="keywordtype">void</span>
<a name="l00189"></a><a class="code" href="../../de/dce/syck_8h.html#a43729dbec8379b3cb8b9664113ee8094">00189</a> <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a69466eaf6caa81595b47f6e1a61f4afe">syck_emitter_pop_level</a>( <a class="code" href="../../d8/df6/struct__syck__emitter.html">SyckEmitter</a> *e )
<a name="l00190"></a>00190 {
<a name="l00191"></a>00191     <a class="code" href="../../de/dce/syck_8h.html#a79da58dac9dcdbcd4005f1d440e363ba">ASSERT</a>( e != <a class="code" href="../../d3/d09/ripper_8y.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> );
<a name="l00192"></a>00192 
<a name="l00193"></a>00193     <span class="comment">/* The root level should never be popped */</span>
<a name="l00194"></a>00194     <span class="keywordflow">if</span> ( e-&gt;<a class="code" href="../../d8/df6/struct__syck__emitter.html#a210f0a62f622de3c022948e946d6efdd">lvl_idx</a> &lt;= 1 ) <span class="keywordflow">return</span>;
<a name="l00195"></a>00195 
<a name="l00196"></a>00196     e-&gt;<a class="code" href="../../d8/df6/struct__syck__emitter.html#a210f0a62f622de3c022948e946d6efdd">lvl_idx</a> -= 1;
<a name="l00197"></a>00197     <a class="code" href="../../d1/ddc/dln_8c.html#affb9fc32698fab7f7b36e0cf8e64c83e">free</a>( e-&gt;<a class="code" href="../../d8/df6/struct__syck__emitter.html#ae7f2d8223a9d5fa4993f6e33694f4762">levels</a>[e-&gt;<a class="code" href="../../d8/df6/struct__syck__emitter.html#a210f0a62f622de3c022948e946d6efdd">lvl_idx</a>].<a class="code" href="../../dd/d0e/struct__syck__level.html#a4c63afeb231da346539b476b29024ab0">domain</a> );
<a name="l00198"></a>00198 }
<a name="l00199"></a>00199 
<a name="l00200"></a>00200 <span class="keywordtype">void</span>
<a name="l00201"></a><a class="code" href="../../de/dce/syck_8h.html#a0158ce32d75d8e31c80d49ccda7bef8a">00201</a> <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#ad4ca8cd66282959ffe72da2df08a665b">syck_emitter_add_level</a>( <a class="code" href="../../d8/df6/struct__syck__emitter.html">SyckEmitter</a> *e, <span class="keywordtype">int</span> <a class="code" href="../../d3/d15/name2ctype_8h.html#aed1cc4dca5d94cb452f79691f54f7423">len</a>, <span class="keyword">enum</span> <a class="code" href="../../de/dce/syck_8h.html#a10af5e9a345d0e86156a336e91ff9f47">syck_level_status</a> status )
<a name="l00202"></a>00202 {
<a name="l00203"></a>00203     <a class="code" href="../../de/dce/syck_8h.html#a79da58dac9dcdbcd4005f1d440e363ba">ASSERT</a>( e != <a class="code" href="../../d3/d09/ripper_8y.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> );
<a name="l00204"></a>00204     <span class="keywordflow">if</span> ( e-&gt;<a class="code" href="../../d8/df6/struct__syck__emitter.html#a210f0a62f622de3c022948e946d6efdd">lvl_idx</a> + 1 &gt; e-&gt;<a class="code" href="../../d8/df6/struct__syck__emitter.html#a2bf84b16e1c52734de7056f290a0be17">lvl_capa</a> )
<a name="l00205"></a>00205     {
<a name="l00206"></a>00206         e-&gt;<a class="code" href="../../d8/df6/struct__syck__emitter.html#a2bf84b16e1c52734de7056f290a0be17">lvl_capa</a> += <a class="code" href="../../de/dce/syck_8h.html#a5ad3e8aa9105cb4dc0fbc9d33427671d">ALLOC_CT</a>;
<a name="l00207"></a>00207         <a class="code" href="../../de/dce/syck_8h.html#a8e4e47dc8e12e09341df3edce2825334">S_REALLOC_N</a>( e-&gt;<a class="code" href="../../d8/df6/struct__syck__emitter.html#ae7f2d8223a9d5fa4993f6e33694f4762">levels</a>, <a class="code" href="../../dd/d0e/struct__syck__level.html">SyckLevel</a>, e-&gt;<a class="code" href="../../d8/df6/struct__syck__emitter.html#a2bf84b16e1c52734de7056f290a0be17">lvl_capa</a> );
<a name="l00208"></a>00208     }
<a name="l00209"></a>00209 
<a name="l00210"></a>00210     <a class="code" href="../../de/dce/syck_8h.html#a79da58dac9dcdbcd4005f1d440e363ba">ASSERT</a>( len &gt; e-&gt;<a class="code" href="../../d8/df6/struct__syck__emitter.html#ae7f2d8223a9d5fa4993f6e33694f4762">levels</a>[e-&gt;<a class="code" href="../../d8/df6/struct__syck__emitter.html#a210f0a62f622de3c022948e946d6efdd">lvl_idx</a>-1].<a class="code" href="../../dd/d0e/struct__syck__level.html#a401e3fc67c4f33f8535cd3ec26fdb87d">spaces</a> );
<a name="l00211"></a>00211     e-&gt;<a class="code" href="../../d8/df6/struct__syck__emitter.html#ae7f2d8223a9d5fa4993f6e33694f4762">levels</a>[e-&gt;<a class="code" href="../../d8/df6/struct__syck__emitter.html#a210f0a62f622de3c022948e946d6efdd">lvl_idx</a>].<a class="code" href="../../dd/d0e/struct__syck__level.html#a401e3fc67c4f33f8535cd3ec26fdb87d">spaces</a> = len;
<a name="l00212"></a>00212     e-&gt;<a class="code" href="../../d8/df6/struct__syck__emitter.html#ae7f2d8223a9d5fa4993f6e33694f4762">levels</a>[e-&gt;<a class="code" href="../../d8/df6/struct__syck__emitter.html#a210f0a62f622de3c022948e946d6efdd">lvl_idx</a>].<a class="code" href="../../dd/d0e/struct__syck__level.html#afa7cc05334cbd8dbe1367d9de134c8ab">ncount</a> = 0;
<a name="l00213"></a>00213     e-&gt;<a class="code" href="../../d8/df6/struct__syck__emitter.html#ae7f2d8223a9d5fa4993f6e33694f4762">levels</a>[e-&gt;<a class="code" href="../../d8/df6/struct__syck__emitter.html#a210f0a62f622de3c022948e946d6efdd">lvl_idx</a>].<a class="code" href="../../dd/d0e/struct__syck__level.html#a4c63afeb231da346539b476b29024ab0">domain</a> = <a class="code" href="../../d1/d7b/syck_8c.html#a9287d968dc4ca9e2bd16635a2cdbcdf5">syck_strndup</a>( e-&gt;<a class="code" href="../../d8/df6/struct__syck__emitter.html#ae7f2d8223a9d5fa4993f6e33694f4762">levels</a>[e-&gt;<a class="code" href="../../d8/df6/struct__syck__emitter.html#a210f0a62f622de3c022948e946d6efdd">lvl_idx</a>-1].<a class="code" href="../../dd/d0e/struct__syck__level.html#a4c63afeb231da346539b476b29024ab0">domain</a>, <a class="code" href="../../d6/d7b/strchr_8c.html#a219836f542ce53545052bed5353820ca">strlen</a>( e-&gt;<a class="code" href="../../d8/df6/struct__syck__emitter.html#ae7f2d8223a9d5fa4993f6e33694f4762">levels</a>[e-&gt;<a class="code" href="../../d8/df6/struct__syck__emitter.html#a210f0a62f622de3c022948e946d6efdd">lvl_idx</a>-1].<a class="code" href="../../dd/d0e/struct__syck__level.html#a4c63afeb231da346539b476b29024ab0">domain</a> ) );
<a name="l00214"></a>00214     e-&gt;<a class="code" href="../../d8/df6/struct__syck__emitter.html#ae7f2d8223a9d5fa4993f6e33694f4762">levels</a>[e-&gt;<a class="code" href="../../d8/df6/struct__syck__emitter.html#a210f0a62f622de3c022948e946d6efdd">lvl_idx</a>].<a class="code" href="../../dd/d0e/struct__syck__level.html#adc00a7ade66d407d9d00745e491c4d6c">status</a> = status;
<a name="l00215"></a>00215     e-&gt;<a class="code" href="../../d8/df6/struct__syck__emitter.html#ae7f2d8223a9d5fa4993f6e33694f4762">levels</a>[e-&gt;<a class="code" href="../../d8/df6/struct__syck__emitter.html#a210f0a62f622de3c022948e946d6efdd">lvl_idx</a>].<a class="code" href="../../dd/d0e/struct__syck__level.html#aa2b1e34c2e0e92f8ea8775278ed6c9c6">anctag</a> = 0;
<a name="l00216"></a>00216     e-&gt;<a class="code" href="../../d8/df6/struct__syck__emitter.html#a210f0a62f622de3c022948e946d6efdd">lvl_idx</a> += 1;
<a name="l00217"></a>00217 }
<a name="l00218"></a>00218 
<a name="l00219"></a>00219 <span class="keywordtype">void</span>
<a name="l00220"></a><a class="code" href="../../de/dce/syck_8h.html#ad1333793817493d86acebec7ae56d119">00220</a> <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#adca3b3d5928b2e4e1806db3dfdf96966">syck_emitter_reset_levels</a>( <a class="code" href="../../d8/df6/struct__syck__emitter.html">SyckEmitter</a> *e )
<a name="l00221"></a>00221 {
<a name="l00222"></a>00222     <span class="keywordflow">while</span> ( e-&gt;<a class="code" href="../../d8/df6/struct__syck__emitter.html#a210f0a62f622de3c022948e946d6efdd">lvl_idx</a> &gt; 1 )
<a name="l00223"></a>00223     {
<a name="l00224"></a>00224         <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a69466eaf6caa81595b47f6e1a61f4afe">syck_emitter_pop_level</a>( e );
<a name="l00225"></a>00225     }
<a name="l00226"></a>00226 
<a name="l00227"></a>00227     <span class="keywordflow">if</span> ( e-&gt;<a class="code" href="../../d8/df6/struct__syck__emitter.html#a210f0a62f622de3c022948e946d6efdd">lvl_idx</a> &lt; 1 )
<a name="l00228"></a>00228     {
<a name="l00229"></a>00229         e-&gt;<a class="code" href="../../d8/df6/struct__syck__emitter.html#a210f0a62f622de3c022948e946d6efdd">lvl_idx</a> = 1;
<a name="l00230"></a>00230         e-&gt;<a class="code" href="../../d8/df6/struct__syck__emitter.html#ae7f2d8223a9d5fa4993f6e33694f4762">levels</a>[0].<a class="code" href="../../dd/d0e/struct__syck__level.html#a401e3fc67c4f33f8535cd3ec26fdb87d">spaces</a> = -1;
<a name="l00231"></a>00231         e-&gt;<a class="code" href="../../d8/df6/struct__syck__emitter.html#ae7f2d8223a9d5fa4993f6e33694f4762">levels</a>[0].<a class="code" href="../../dd/d0e/struct__syck__level.html#afa7cc05334cbd8dbe1367d9de134c8ab">ncount</a> = 0;
<a name="l00232"></a>00232         e-&gt;<a class="code" href="../../d8/df6/struct__syck__emitter.html#ae7f2d8223a9d5fa4993f6e33694f4762">levels</a>[0].<a class="code" href="../../dd/d0e/struct__syck__level.html#a4c63afeb231da346539b476b29024ab0">domain</a> = <a class="code" href="../../d1/d7b/syck_8c.html#a9287d968dc4ca9e2bd16635a2cdbcdf5">syck_strndup</a>( <span class="stringliteral">&quot;&quot;</span>, 0 );
<a name="l00233"></a>00233         e-&gt;<a class="code" href="../../d8/df6/struct__syck__emitter.html#ae7f2d8223a9d5fa4993f6e33694f4762">levels</a>[0].<a class="code" href="../../dd/d0e/struct__syck__level.html#aa2b1e34c2e0e92f8ea8775278ed6c9c6">anctag</a> = 0;
<a name="l00234"></a>00234     }
<a name="l00235"></a>00235     e-&gt;<a class="code" href="../../d8/df6/struct__syck__emitter.html#ae7f2d8223a9d5fa4993f6e33694f4762">levels</a>[0].<a class="code" href="../../dd/d0e/struct__syck__level.html#adc00a7ade66d407d9d00745e491c4d6c">status</a> = <a class="code" href="../../de/dce/syck_8h.html#a10af5e9a345d0e86156a336e91ff9f47ab585bdb00a8c49635980f38231e6b765">syck_lvl_header</a>;
<a name="l00236"></a>00236 }
<a name="l00237"></a>00237 
<a name="l00238"></a>00238 <span class="keywordtype">void</span>
<a name="l00239"></a><a class="code" href="../../de/dce/syck_8h.html#ad74c363be9b8e5d15d7e204399db5dfe">00239</a> <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#aafd36170cf25ea8abebb518c1e7f1a4f">syck_emitter_handler</a>( <a class="code" href="../../d8/df6/struct__syck__emitter.html">SyckEmitter</a> *e, <a class="code" href="../../de/dce/syck_8h.html#ab9e59d05187340135cdd48ba984ea228">SyckEmitterHandler</a> hdlr )
<a name="l00240"></a>00240 {
<a name="l00241"></a>00241     e-&gt;<a class="code" href="../../d8/df6/struct__syck__emitter.html#a886df322c1ec31d88ca0b9026823b8e6">emitter_handler</a> = hdlr;
<a name="l00242"></a>00242 }
<a name="l00243"></a>00243 
<a name="l00244"></a>00244 <span class="keywordtype">void</span>
<a name="l00245"></a><a class="code" href="../../de/dce/syck_8h.html#a0482ed4c44a4d39a878fd3a96fc2751b">00245</a> <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a42ca38a5d2274f822657074a3db6248e">syck_output_handler</a>( <a class="code" href="../../d8/df6/struct__syck__emitter.html">SyckEmitter</a> *e, <a class="code" href="../../de/dce/syck_8h.html#a87cd49951d40306ad5ae09bf8f0cc5fb">SyckOutputHandler</a> hdlr )
<a name="l00246"></a>00246 {
<a name="l00247"></a>00247     e-&gt;<a class="code" href="../../d8/df6/struct__syck__emitter.html#a5f4f9b474c3ec9a9583333c83f188532">output_handler</a> = hdlr;
<a name="l00248"></a>00248 }
<a name="l00249"></a>00249 
<a name="l00250"></a>00250 <span class="keywordtype">void</span>
<a name="l00251"></a><a class="code" href="../../de/dce/syck_8h.html#a8468aba5c533337f9898d056454a1a75">00251</a> <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#acc7e384e4d7addb40d569cb957629c25">syck_free_emitter</a>( <a class="code" href="../../d8/df6/struct__syck__emitter.html">SyckEmitter</a> *e )
<a name="l00252"></a>00252 {
<a name="l00253"></a>00253     <span class="comment">/*</span>
<a name="l00254"></a>00254 <span class="comment">     * Free tables</span>
<a name="l00255"></a>00255 <span class="comment">     */</span>
<a name="l00256"></a>00256     <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a3ab4de793a630b3989f78f88a25df04a">syck_emitter_st_free</a>( e );
<a name="l00257"></a>00257     <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#adca3b3d5928b2e4e1806db3dfdf96966">syck_emitter_reset_levels</a>( e );
<a name="l00258"></a>00258     <a class="code" href="../../de/dce/syck_8h.html#a59b854f4bc2b7cd8e19c75600deeb24d">S_FREE</a>( e-&gt;<a class="code" href="../../d8/df6/struct__syck__emitter.html#ae7f2d8223a9d5fa4993f6e33694f4762">levels</a>[0].<a class="code" href="../../dd/d0e/struct__syck__level.html#a4c63afeb231da346539b476b29024ab0">domain</a> );
<a name="l00259"></a>00259     <a class="code" href="../../de/dce/syck_8h.html#a59b854f4bc2b7cd8e19c75600deeb24d">S_FREE</a>( e-&gt;<a class="code" href="../../d8/df6/struct__syck__emitter.html#ae7f2d8223a9d5fa4993f6e33694f4762">levels</a> );
<a name="l00260"></a>00260     <span class="keywordflow">if</span> ( e-&gt;<a class="code" href="../../d8/df6/struct__syck__emitter.html#aea9239b4ebb3ae4f3d3502fce357f143">buffer</a> != <a class="code" href="../../d3/d09/ripper_8y.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> )
<a name="l00261"></a>00261     {
<a name="l00262"></a>00262         <a class="code" href="../../de/dce/syck_8h.html#a59b854f4bc2b7cd8e19c75600deeb24d">S_FREE</a>( e-&gt;<a class="code" href="../../d8/df6/struct__syck__emitter.html#aea9239b4ebb3ae4f3d3502fce357f143">buffer</a> );
<a name="l00263"></a>00263     }
<a name="l00264"></a>00264     <a class="code" href="../../de/dce/syck_8h.html#a59b854f4bc2b7cd8e19c75600deeb24d">S_FREE</a>( e );
<a name="l00265"></a>00265 }
<a name="l00266"></a>00266 
<a name="l00267"></a>00267 <span class="keywordtype">void</span>
<a name="l00268"></a><a class="code" href="../../de/dce/syck_8h.html#aeb31ebbfc5cb4989f85f7cda0bd7e610">00268</a> <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a7301faa880213b0cf140c8e6d5a60135">syck_emitter_clear</a>( <a class="code" href="../../d8/df6/struct__syck__emitter.html">SyckEmitter</a> *e )
<a name="l00269"></a>00269 {
<a name="l00270"></a>00270     <span class="keywordflow">if</span> ( e-&gt;<a class="code" href="../../d8/df6/struct__syck__emitter.html#aea9239b4ebb3ae4f3d3502fce357f143">buffer</a> == <a class="code" href="../../d3/d09/ripper_8y.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> )
<a name="l00271"></a>00271     {
<a name="l00272"></a>00272         e-&gt;<a class="code" href="../../d8/df6/struct__syck__emitter.html#aea9239b4ebb3ae4f3d3502fce357f143">buffer</a> = <a class="code" href="../../de/dce/syck_8h.html#a2d20ec6949b5978b35b88eedf43f36ff">S_ALLOC_N</a>( <span class="keywordtype">char</span>, e-&gt;<a class="code" href="../../d8/df6/struct__syck__emitter.html#ac1aed632ef8ec2b30a57345949689fd7">bufsize</a> );
<a name="l00273"></a>00273         <a class="code" href="../../de/dce/syck_8h.html#a9862f0d21b09e3963c3dc6fc9a18c27d">S_MEMZERO</a>( e-&gt;<a class="code" href="../../d8/df6/struct__syck__emitter.html#aea9239b4ebb3ae4f3d3502fce357f143">buffer</a>, <span class="keywordtype">char</span>, e-&gt;<a class="code" href="../../d8/df6/struct__syck__emitter.html#ac1aed632ef8ec2b30a57345949689fd7">bufsize</a> );
<a name="l00274"></a>00274     }
<a name="l00275"></a>00275     e-&gt;<a class="code" href="../../d8/df6/struct__syck__emitter.html#aea9239b4ebb3ae4f3d3502fce357f143">buffer</a>[0] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l00276"></a>00276     e-&gt;<a class="code" href="../../d8/df6/struct__syck__emitter.html#a3f5edd01c8e21f404279d345b981a49b">marker</a> = e-&gt;<a class="code" href="../../d8/df6/struct__syck__emitter.html#aea9239b4ebb3ae4f3d3502fce357f143">buffer</a>;
<a name="l00277"></a>00277     e-&gt;<a class="code" href="../../d8/df6/struct__syck__emitter.html#aca2e1583f8909e1ea4e37bef74b1381c">bufpos</a> = 0;
<a name="l00278"></a>00278 }
<a name="l00279"></a>00279 
<a name="l00280"></a>00280 <span class="comment">/*</span>
<a name="l00281"></a>00281 <span class="comment"> * Raw write to the emitter buffer.</span>
<a name="l00282"></a>00282 <span class="comment"> */</span>
<a name="l00283"></a>00283 <span class="keywordtype">void</span>
<a name="l00284"></a><a class="code" href="../../de/dce/syck_8h.html#ae0080d4429b968f5dab01aa9123e98fb">00284</a> <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a251980c11ffad2f157e04ea6ee8dfa66">syck_emitter_write</a>( <a class="code" href="../../d8/df6/struct__syck__emitter.html">SyckEmitter</a> *e, <span class="keyword">const</span> <span class="keywordtype">char</span> *str, <span class="keywordtype">long</span> <a class="code" href="../../d3/d15/name2ctype_8h.html#aed1cc4dca5d94cb452f79691f54f7423">len</a> )
<a name="l00285"></a>00285 {
<a name="l00286"></a>00286     <span class="keywordtype">long</span> at;
<a name="l00287"></a>00287     <a class="code" href="../../de/dce/syck_8h.html#a79da58dac9dcdbcd4005f1d440e363ba">ASSERT</a>( str != <a class="code" href="../../d3/d09/ripper_8y.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> );
<a name="l00288"></a>00288     <span class="keywordflow">if</span> ( e-&gt;<a class="code" href="../../d8/df6/struct__syck__emitter.html#aea9239b4ebb3ae4f3d3502fce357f143">buffer</a> == <a class="code" href="../../d3/d09/ripper_8y.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> )
<a name="l00289"></a>00289     {
<a name="l00290"></a>00290         <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a7301faa880213b0cf140c8e6d5a60135">syck_emitter_clear</a>( e );
<a name="l00291"></a>00291     }
<a name="l00292"></a>00292 
<a name="l00293"></a>00293     <span class="comment">/*</span>
<a name="l00294"></a>00294 <span class="comment">     * Flush if at end of buffer</span>
<a name="l00295"></a>00295 <span class="comment">     */</span>
<a name="l00296"></a>00296     at = e-&gt;<a class="code" href="../../d8/df6/struct__syck__emitter.html#a3f5edd01c8e21f404279d345b981a49b">marker</a> - e-&gt;<a class="code" href="../../d8/df6/struct__syck__emitter.html#aea9239b4ebb3ae4f3d3502fce357f143">buffer</a>;
<a name="l00297"></a>00297     <span class="keywordflow">if</span> ( len + at &gt;= (<span class="keywordtype">long</span>)e-&gt;<a class="code" href="../../d8/df6/struct__syck__emitter.html#ac1aed632ef8ec2b30a57345949689fd7">bufsize</a> )
<a name="l00298"></a>00298     {
<a name="l00299"></a>00299         <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a10db41268b6fc67f49d1451f87d3e180">syck_emitter_flush</a>( e, 0 );
<a name="l00300"></a>00300         <span class="keywordflow">for</span> (;;) {
<a name="l00301"></a>00301             <span class="keywordtype">long</span> rest = e-&gt;<a class="code" href="../../d8/df6/struct__syck__emitter.html#ac1aed632ef8ec2b30a57345949689fd7">bufsize</a> - (e-&gt;<a class="code" href="../../d8/df6/struct__syck__emitter.html#a3f5edd01c8e21f404279d345b981a49b">marker</a> - e-&gt;<a class="code" href="../../d8/df6/struct__syck__emitter.html#aea9239b4ebb3ae4f3d3502fce357f143">buffer</a>);
<a name="l00302"></a>00302             <span class="keywordflow">if</span> (len &lt;= rest) <span class="keywordflow">break</span>;
<a name="l00303"></a>00303             <a class="code" href="../../de/dce/syck_8h.html#a1657ed69b26e144319b4ab50e78f6439">S_MEMCPY</a>( e-&gt;<a class="code" href="../../d8/df6/struct__syck__emitter.html#a3f5edd01c8e21f404279d345b981a49b">marker</a>, str, <span class="keywordtype">char</span>, rest );
<a name="l00304"></a>00304             e-&gt;<a class="code" href="../../d8/df6/struct__syck__emitter.html#a3f5edd01c8e21f404279d345b981a49b">marker</a> += rest;
<a name="l00305"></a>00305             str += rest;
<a name="l00306"></a>00306             len -= rest;
<a name="l00307"></a>00307             <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a10db41268b6fc67f49d1451f87d3e180">syck_emitter_flush</a>( e, 0 );
<a name="l00308"></a>00308         }
<a name="l00309"></a>00309     }
<a name="l00310"></a>00310 
<a name="l00311"></a>00311     <span class="comment">/*</span>
<a name="l00312"></a>00312 <span class="comment">     * Write to buffer</span>
<a name="l00313"></a>00313 <span class="comment">     */</span>
<a name="l00314"></a>00314     <a class="code" href="../../de/dce/syck_8h.html#a1657ed69b26e144319b4ab50e78f6439">S_MEMCPY</a>( e-&gt;<a class="code" href="../../d8/df6/struct__syck__emitter.html#a3f5edd01c8e21f404279d345b981a49b">marker</a>, str, <span class="keywordtype">char</span>, len );
<a name="l00315"></a>00315     e-&gt;<a class="code" href="../../d8/df6/struct__syck__emitter.html#a3f5edd01c8e21f404279d345b981a49b">marker</a> += len;
<a name="l00316"></a>00316 }
<a name="l00317"></a>00317 
<a name="l00318"></a>00318 <span class="comment">/*</span>
<a name="l00319"></a>00319 <span class="comment"> * Write a chunk of data out.</span>
<a name="l00320"></a>00320 <span class="comment"> */</span>
<a name="l00321"></a>00321 <span class="keywordtype">void</span>
<a name="l00322"></a><a class="code" href="../../de/dce/syck_8h.html#aa3883badd7da912bdde3e6fa27ccdc56">00322</a> <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a10db41268b6fc67f49d1451f87d3e180">syck_emitter_flush</a>( <a class="code" href="../../d8/df6/struct__syck__emitter.html">SyckEmitter</a> *e, <span class="keywordtype">long</span> check_room )
<a name="l00323"></a>00323 {
<a name="l00324"></a>00324     <span class="comment">/*</span>
<a name="l00325"></a>00325 <span class="comment">     * Check for enough space in the buffer for check_room length.</span>
<a name="l00326"></a>00326 <span class="comment">     */</span>
<a name="l00327"></a>00327     <span class="keywordflow">if</span> ( check_room &gt; 0 )
<a name="l00328"></a>00328     {
<a name="l00329"></a>00329         <span class="keywordflow">if</span> ( (<span class="keywordtype">long</span>)e-&gt;<a class="code" href="../../d8/df6/struct__syck__emitter.html#ac1aed632ef8ec2b30a57345949689fd7">bufsize</a> &gt; ( e-&gt;<a class="code" href="../../d8/df6/struct__syck__emitter.html#a3f5edd01c8e21f404279d345b981a49b">marker</a> - e-&gt;<a class="code" href="../../d8/df6/struct__syck__emitter.html#aea9239b4ebb3ae4f3d3502fce357f143">buffer</a> ) + check_room )
<a name="l00330"></a>00330         {
<a name="l00331"></a>00331             <span class="keywordflow">return</span>;
<a name="l00332"></a>00332         }
<a name="l00333"></a>00333     }
<a name="l00334"></a>00334     <span class="keywordflow">else</span>
<a name="l00335"></a>00335     {
<a name="l00336"></a>00336         check_room = e-&gt;<a class="code" href="../../d8/df6/struct__syck__emitter.html#ac1aed632ef8ec2b30a57345949689fd7">bufsize</a>;
<a name="l00337"></a>00337     }
<a name="l00338"></a>00338 
<a name="l00339"></a>00339     <span class="comment">/*</span>
<a name="l00340"></a>00340 <span class="comment">     * Commit buffer.</span>
<a name="l00341"></a>00341 <span class="comment">     */</span>
<a name="l00342"></a>00342     <span class="keywordflow">if</span> ( check_room &gt; e-&gt;<a class="code" href="../../d8/df6/struct__syck__emitter.html#a3f5edd01c8e21f404279d345b981a49b">marker</a> - e-&gt;<a class="code" href="../../d8/df6/struct__syck__emitter.html#aea9239b4ebb3ae4f3d3502fce357f143">buffer</a> )
<a name="l00343"></a>00343     {
<a name="l00344"></a>00344         check_room = e-&gt;<a class="code" href="../../d8/df6/struct__syck__emitter.html#a3f5edd01c8e21f404279d345b981a49b">marker</a> - e-&gt;<a class="code" href="../../d8/df6/struct__syck__emitter.html#aea9239b4ebb3ae4f3d3502fce357f143">buffer</a>;
<a name="l00345"></a>00345     }
<a name="l00346"></a>00346     (e-&gt;<a class="code" href="../../d8/df6/struct__syck__emitter.html#a5f4f9b474c3ec9a9583333c83f188532">output_handler</a>)( e, e-&gt;<a class="code" href="../../d8/df6/struct__syck__emitter.html#aea9239b4ebb3ae4f3d3502fce357f143">buffer</a>, check_room );
<a name="l00347"></a>00347     e-&gt;<a class="code" href="../../d8/df6/struct__syck__emitter.html#aca2e1583f8909e1ea4e37bef74b1381c">bufpos</a> += check_room;
<a name="l00348"></a>00348     e-&gt;<a class="code" href="../../d8/df6/struct__syck__emitter.html#a3f5edd01c8e21f404279d345b981a49b">marker</a> -= check_room;
<a name="l00349"></a>00349 }
<a name="l00350"></a>00350 
<a name="l00351"></a>00351 <span class="comment">/*</span>
<a name="l00352"></a>00352 <span class="comment"> * Start emitting from the given node, check for anchoring and then</span>
<a name="l00353"></a>00353 <span class="comment"> * issue the callback to the emitter handler.</span>
<a name="l00354"></a>00354 <span class="comment"> */</span>
<a name="l00355"></a>00355 <span class="keywordtype">void</span>
<a name="l00356"></a><a class="code" href="../../de/dce/syck_8h.html#aa170e91e4bdae35e10439d6532cf7b29">00356</a> <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#ac851171d4d82013821f84db6331bbcc4">syck_emit</a>( <a class="code" href="../../d8/df6/struct__syck__emitter.html">SyckEmitter</a> *e, <a class="code" href="../../de/dce/syck_8h.html#a8a45dfe133c1fd041e1b902bda9e43e8">st_data_t</a> n )
<a name="l00357"></a>00357 {
<a name="l00358"></a>00358     <a class="code" href="../../de/dce/syck_8h.html#a4e170963ed89a5ec1a7e8ffedc8c0b3b">SYMID</a> oid;
<a name="l00359"></a>00359     <span class="keywordtype">char</span> *anchor_name = <a class="code" href="../../d3/d09/ripper_8y.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00360"></a>00360     <span class="keywordtype">int</span> indent = 0;
<a name="l00361"></a>00361     <span class="keywordtype">long</span> x = 0;
<a name="l00362"></a>00362     <a class="code" href="../../dd/d0e/struct__syck__level.html">SyckLevel</a> *lvl = <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a5f9693ef17bdeacaa7afd778a29cb919">syck_emitter_current_level</a>( e );
<a name="l00363"></a>00363 
<a name="l00364"></a>00364     <span class="comment">/*</span>
<a name="l00365"></a>00365 <span class="comment">     * Determine headers.</span>
<a name="l00366"></a>00366 <span class="comment">     */</span>
<a name="l00367"></a>00367     <span class="keywordflow">if</span> ( e-&gt;<a class="code" href="../../d8/df6/struct__syck__emitter.html#a9b961bc8d17683a1b224d1b8ddd8f82c">stage</a> == <a class="code" href="../../de/dce/syck_8h.html#a301a1810f5a817f18e1dde01c771ba04a0d1fbbbb2cb83330bfeeaacfb8f9908e">doc_open</a> &amp;&amp; ( e-&gt;<a class="code" href="../../d8/df6/struct__syck__emitter.html#a93a1b4e72752fe68cb5b615266810b11">headless</a> == 0 || e-&gt;<a class="code" href="../../d8/df6/struct__syck__emitter.html#a48879724a6f8cfd9be22a069491b3dc8">use_header</a> == 1 ) )
<a name="l00368"></a>00368     {
<a name="l00369"></a>00369         <span class="keywordflow">if</span> ( e-&gt;<a class="code" href="../../d8/df6/struct__syck__emitter.html#a903652654e7763e61f8ea52e90b36db4">use_version</a> == 1 )
<a name="l00370"></a>00370         {
<a name="l00371"></a>00371             <span class="keywordtype">char</span> *header = <a class="code" href="../../de/dce/syck_8h.html#a2d20ec6949b5978b35b88eedf43f36ff">S_ALLOC_N</a>( <span class="keywordtype">char</span>, 64 );
<a name="l00372"></a>00372             <a class="code" href="../../de/dce/syck_8h.html#a9862f0d21b09e3963c3dc6fc9a18c27d">S_MEMZERO</a>( header, <span class="keywordtype">char</span>, 64 );
<a name="l00373"></a>00373             sprintf( header, <span class="stringliteral">&quot;--- %%YAML:%d.%d &quot;</span>, <a class="code" href="../../de/dce/syck_8h.html#acfcc3b521945b0285bf92acc360aedfe">SYCK_YAML_MAJOR</a>, <a class="code" href="../../de/dce/syck_8h.html#a8ae9ccf58b9b34169b25fddb926f04e8">SYCK_YAML_MINOR</a> );
<a name="l00374"></a>00374             <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a251980c11ffad2f157e04ea6ee8dfa66">syck_emitter_write</a>( e, header, <a class="code" href="../../d6/d7b/strchr_8c.html#a219836f542ce53545052bed5353820ca">strlen</a>( header ) );
<a name="l00375"></a>00375             <a class="code" href="../../de/dce/syck_8h.html#a59b854f4bc2b7cd8e19c75600deeb24d">S_FREE</a>( header );
<a name="l00376"></a>00376         }
<a name="l00377"></a>00377         <span class="keywordflow">else</span>
<a name="l00378"></a>00378         {
<a name="l00379"></a>00379             <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a251980c11ffad2f157e04ea6ee8dfa66">syck_emitter_write</a>( e, <span class="stringliteral">&quot;--- &quot;</span>, 4 );
<a name="l00380"></a>00380         }
<a name="l00381"></a>00381         e-&gt;<a class="code" href="../../d8/df6/struct__syck__emitter.html#a9b961bc8d17683a1b224d1b8ddd8f82c">stage</a> = <a class="code" href="../../de/dce/syck_8h.html#a301a1810f5a817f18e1dde01c771ba04a0cdac32ad46f4cc2160b0c6f36a9a90b">doc_processing</a>;
<a name="l00382"></a>00382     }
<a name="l00383"></a>00383 
<a name="l00384"></a>00384     <span class="comment">/* Add new level */</span>
<a name="l00385"></a>00385     <span class="keywordflow">if</span> ( lvl-&gt;<a class="code" href="../../dd/d0e/struct__syck__level.html#a401e3fc67c4f33f8535cd3ec26fdb87d">spaces</a> &gt;= 0 ) {
<a name="l00386"></a>00386         indent = lvl-&gt;<a class="code" href="../../dd/d0e/struct__syck__level.html#a401e3fc67c4f33f8535cd3ec26fdb87d">spaces</a> + e-&gt;<a class="code" href="../../d8/df6/struct__syck__emitter.html#a1e9795a23ab21ee7fc817921c3a238e1">indent</a>;
<a name="l00387"></a>00387     }
<a name="l00388"></a>00388     <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#ad4ca8cd66282959ffe72da2df08a665b">syck_emitter_add_level</a>( e, indent, <a class="code" href="../../de/dce/syck_8h.html#a10af5e9a345d0e86156a336e91ff9f47a110d860d4221f15b6ce30be7ce1904fc">syck_lvl_open</a> );
<a name="l00389"></a>00389     lvl = <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a5f9693ef17bdeacaa7afd778a29cb919">syck_emitter_current_level</a>( e );
<a name="l00390"></a>00390 
<a name="l00391"></a>00391     <span class="comment">/* Look for anchor */</span>
<a name="l00392"></a>00392     <span class="keywordflow">if</span> ( e-&gt;<a class="code" href="../../d8/df6/struct__syck__emitter.html#ac20bad3bf020fd6e0a02dc506eeaf421">anchors</a> != <a class="code" href="../../d3/d09/ripper_8y.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> &amp;&amp;
<a name="l00393"></a>00393         <a class="code" href="../../dd/d24/st_8h.html#a2d85287fbdaf7dcbc22d45e925c29fea">st_lookup</a>( e-&gt;<a class="code" href="../../d8/df6/struct__syck__emitter.html#a7b0db5fa866e726fc11b2bf08a5830b2">markers</a>, n, (<a class="code" href="../../de/dce/syck_8h.html#a8a45dfe133c1fd041e1b902bda9e43e8">st_data_t</a> *)&amp;oid ) &amp;&amp;
<a name="l00394"></a>00394         <a class="code" href="../../dd/d24/st_8h.html#a2d85287fbdaf7dcbc22d45e925c29fea">st_lookup</a>( e-&gt;<a class="code" href="../../d8/df6/struct__syck__emitter.html#ac20bad3bf020fd6e0a02dc506eeaf421">anchors</a>, (<a class="code" href="../../de/dce/syck_8h.html#a8a45dfe133c1fd041e1b902bda9e43e8">st_data_t</a>)oid, (<span class="keywordtype">void</span> *)&amp;anchor_name ) )
<a name="l00395"></a>00395     {
<a name="l00396"></a>00396         <span class="keywordflow">if</span> ( e-&gt;<a class="code" href="../../d8/df6/struct__syck__emitter.html#aee20e4cb0b0911ee2f37b9c065e23a85">anchored</a> == <a class="code" href="../../d3/d09/ripper_8y.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> )
<a name="l00397"></a>00397         {
<a name="l00398"></a>00398             e-&gt;<a class="code" href="../../d8/df6/struct__syck__emitter.html#aee20e4cb0b0911ee2f37b9c065e23a85">anchored</a> = <a class="code" href="../../dd/d24/st_8h.html#a955c6e936b9681649ab9ffa4aa741949">st_init_numtable</a>();
<a name="l00399"></a>00399         }
<a name="l00400"></a>00400 
<a name="l00401"></a>00401         <span class="keywordflow">if</span> ( ! <a class="code" href="../../dd/d24/st_8h.html#a2d85287fbdaf7dcbc22d45e925c29fea">st_lookup</a>( e-&gt;<a class="code" href="../../d8/df6/struct__syck__emitter.html#aee20e4cb0b0911ee2f37b9c065e23a85">anchored</a>, (<a class="code" href="../../de/dce/syck_8h.html#a8a45dfe133c1fd041e1b902bda9e43e8">st_data_t</a>)anchor_name, (<a class="code" href="../../de/dce/syck_8h.html#a8a45dfe133c1fd041e1b902bda9e43e8">st_data_t</a> *)&amp;x ) )
<a name="l00402"></a>00402         {
<a name="l00403"></a>00403             <span class="keywordtype">char</span> *an = <a class="code" href="../../de/dce/syck_8h.html#a2d20ec6949b5978b35b88eedf43f36ff">S_ALLOC_N</a>( <span class="keywordtype">char</span>, <a class="code" href="../../d6/d7b/strchr_8c.html#a219836f542ce53545052bed5353820ca">strlen</a>( anchor_name ) + 3 );
<a name="l00404"></a>00404             sprintf( an, <span class="stringliteral">&quot;&amp;%s &quot;</span>, anchor_name );
<a name="l00405"></a>00405             <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a251980c11ffad2f157e04ea6ee8dfa66">syck_emitter_write</a>( e, an, <a class="code" href="../../d6/d7b/strchr_8c.html#a219836f542ce53545052bed5353820ca">strlen</a>( anchor_name ) + 2 );
<a name="l00406"></a>00406             <a class="code" href="../../d1/ddc/dln_8c.html#affb9fc32698fab7f7b36e0cf8e64c83e">free</a>( an );
<a name="l00407"></a>00407 
<a name="l00408"></a>00408             x = 1;
<a name="l00409"></a>00409             <a class="code" href="../../dd/d24/st_8h.html#acdc42c01229b7537ea5a4c6965c7e47a">st_insert</a>( e-&gt;<a class="code" href="../../d8/df6/struct__syck__emitter.html#aee20e4cb0b0911ee2f37b9c065e23a85">anchored</a>, (<a class="code" href="../../de/dce/syck_8h.html#a8a45dfe133c1fd041e1b902bda9e43e8">st_data_t</a>)anchor_name, (<a class="code" href="../../de/dce/syck_8h.html#a8a45dfe133c1fd041e1b902bda9e43e8">st_data_t</a>)x );
<a name="l00410"></a>00410             lvl-&gt;<a class="code" href="../../dd/d0e/struct__syck__level.html#aa2b1e34c2e0e92f8ea8775278ed6c9c6">anctag</a> = 1;
<a name="l00411"></a>00411         }
<a name="l00412"></a>00412         <span class="keywordflow">else</span>
<a name="l00413"></a>00413         {
<a name="l00414"></a>00414             <span class="keywordtype">char</span> *an = <a class="code" href="../../de/dce/syck_8h.html#a2d20ec6949b5978b35b88eedf43f36ff">S_ALLOC_N</a>( <span class="keywordtype">char</span>, <a class="code" href="../../d6/d7b/strchr_8c.html#a219836f542ce53545052bed5353820ca">strlen</a>( anchor_name ) + 2 );
<a name="l00415"></a>00415             sprintf( an, <span class="stringliteral">&quot;*%s&quot;</span>, anchor_name );
<a name="l00416"></a>00416             <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a251980c11ffad2f157e04ea6ee8dfa66">syck_emitter_write</a>( e, an, <a class="code" href="../../d6/d7b/strchr_8c.html#a219836f542ce53545052bed5353820ca">strlen</a>( anchor_name ) + 1 );
<a name="l00417"></a>00417             <a class="code" href="../../d1/ddc/dln_8c.html#affb9fc32698fab7f7b36e0cf8e64c83e">free</a>( an );
<a name="l00418"></a>00418 
<a name="l00419"></a>00419             <span class="keywordflow">goto</span> end_emit;
<a name="l00420"></a>00420         }
<a name="l00421"></a>00421     }
<a name="l00422"></a>00422 
<a name="l00423"></a>00423     (e-&gt;<a class="code" href="../../d8/df6/struct__syck__emitter.html#a886df322c1ec31d88ca0b9026823b8e6">emitter_handler</a>)( e, n );
<a name="l00424"></a>00424 
<a name="l00425"></a>00425     <span class="comment">/* Pop the level */</span>
<a name="l00426"></a>00426 end_emit:
<a name="l00427"></a>00427     <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a69466eaf6caa81595b47f6e1a61f4afe">syck_emitter_pop_level</a>( e );
<a name="l00428"></a>00428     <span class="keywordflow">if</span> ( e-&gt;<a class="code" href="../../d8/df6/struct__syck__emitter.html#a210f0a62f622de3c022948e946d6efdd">lvl_idx</a> == 1 ) {
<a name="l00429"></a>00429         <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a251980c11ffad2f157e04ea6ee8dfa66">syck_emitter_write</a>( e, <span class="stringliteral">&quot;\n&quot;</span>, 1 );
<a name="l00430"></a>00430         e-&gt;<a class="code" href="../../d8/df6/struct__syck__emitter.html#a93a1b4e72752fe68cb5b615266810b11">headless</a> = 0;
<a name="l00431"></a>00431         e-&gt;<a class="code" href="../../d8/df6/struct__syck__emitter.html#a9b961bc8d17683a1b224d1b8ddd8f82c">stage</a> = <a class="code" href="../../de/dce/syck_8h.html#a301a1810f5a817f18e1dde01c771ba04a0d1fbbbb2cb83330bfeeaacfb8f9908e">doc_open</a>;
<a name="l00432"></a>00432     }
<a name="l00433"></a>00433 }
<a name="l00434"></a>00434 
<a name="l00435"></a>00435 <span class="comment">/*</span>
<a name="l00436"></a>00436 <span class="comment"> * Determine what tag needs to be written, based on the taguri of the node</span>
<a name="l00437"></a>00437 <span class="comment"> * and the implicit tag which would be assigned to this node.  If a tag is</span>
<a name="l00438"></a>00438 <span class="comment"> * required, write the tag.</span>
<a name="l00439"></a>00439 <span class="comment"> */</span>
<a name="l00440"></a><a class="code" href="../../de/dce/syck_8h.html#a45d9be67131d3efc5ebd0460f63d199f">00440</a> <span class="keywordtype">void</span> <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a9d213f5296217ed7f2bfef25267ab499">syck_emit_tag</a>( <a class="code" href="../../d8/df6/struct__syck__emitter.html">SyckEmitter</a> *e, <span class="keyword">const</span> <span class="keywordtype">char</span> *tag, <span class="keyword">const</span> <span class="keywordtype">char</span> *ignore )
<a name="l00441"></a>00441 {
<a name="l00442"></a>00442     <a class="code" href="../../dd/d0e/struct__syck__level.html">SyckLevel</a> *lvl;
<a name="l00443"></a>00443     <span class="keywordflow">if</span> ( tag == <a class="code" href="../../d3/d09/ripper_8y.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> ) <span class="keywordflow">return</span>;
<a name="l00444"></a>00444     <span class="keywordflow">if</span> ( ignore != <a class="code" href="../../d3/d09/ripper_8y.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> &amp;&amp; <a class="code" href="../../dc/d53/implicit_8c.html#a6e712591b4b24a5f95e762b3c0583f60">syck_tagcmp</a>( tag, ignore ) == 0 &amp;&amp; e-&gt;<a class="code" href="../../d8/df6/struct__syck__emitter.html#a714457cf53a8c01c33a4c3fc7890e06c">explicit_typing</a> == 0 ) <span class="keywordflow">return</span>;
<a name="l00445"></a>00445     lvl = <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a5f9693ef17bdeacaa7afd778a29cb919">syck_emitter_current_level</a>( e );
<a name="l00446"></a>00446 
<a name="l00447"></a>00447     <span class="comment">/* implicit */</span>
<a name="l00448"></a>00448     <span class="keywordflow">if</span> ( <a class="code" href="../../d6/d7b/strchr_8c.html#a219836f542ce53545052bed5353820ca">strlen</a>( tag ) == 0 ) {
<a name="l00449"></a>00449         <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a251980c11ffad2f157e04ea6ee8dfa66">syck_emitter_write</a>( e, <span class="stringliteral">&quot;! &quot;</span>, 2 );
<a name="l00450"></a>00450 
<a name="l00451"></a>00451     <span class="comment">/* global types */</span>
<a name="l00452"></a>00452     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( strncmp( tag, <span class="stringliteral">&quot;tag:&quot;</span>, 4 ) == 0 ) {
<a name="l00453"></a>00453         <span class="keywordtype">int</span> taglen = (int)<a class="code" href="../../d6/d7b/strchr_8c.html#a219836f542ce53545052bed5353820ca">strlen</a>( tag );
<a name="l00454"></a>00454         <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a251980c11ffad2f157e04ea6ee8dfa66">syck_emitter_write</a>( e, <span class="stringliteral">&quot;!&quot;</span>, 1 );
<a name="l00455"></a>00455         <span class="keywordflow">if</span> ( strncmp( tag + 4, <a class="code" href="../../de/dce/syck_8h.html#abe48fac810a8a79c7b2ded3216b25ee8">YAML_DOMAIN</a>, <a class="code" href="../../d6/d7b/strchr_8c.html#a219836f542ce53545052bed5353820ca">strlen</a>( <a class="code" href="../../de/dce/syck_8h.html#abe48fac810a8a79c7b2ded3216b25ee8">YAML_DOMAIN</a> ) ) == 0 ) {
<a name="l00456"></a>00456             <span class="keywordtype">int</span> skip = 4 + <a class="code" href="../../d6/d7b/strchr_8c.html#a219836f542ce53545052bed5353820ca">strlen</a>( <a class="code" href="../../de/dce/syck_8h.html#abe48fac810a8a79c7b2ded3216b25ee8">YAML_DOMAIN</a> ) + 1;
<a name="l00457"></a>00457             <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a251980c11ffad2f157e04ea6ee8dfa66">syck_emitter_write</a>( e, tag + skip, taglen - skip );
<a name="l00458"></a>00458         } <span class="keywordflow">else</span> {
<a name="l00459"></a>00459             <span class="keyword">const</span> <span class="keywordtype">char</span> *subd = tag + 4;
<a name="l00460"></a>00460             <span class="keywordflow">while</span> ( *subd != <span class="charliteral">&apos;:&apos;</span> &amp;&amp; *subd != <span class="charliteral">&apos;\0&apos;</span> ) subd++;
<a name="l00461"></a>00461             <span class="keywordflow">if</span> ( *subd == <span class="charliteral">&apos;:&apos;</span> ) {
<a name="l00462"></a>00462                 <span class="keywordflow">if</span> ( subd - tag &gt; ( (<span class="keywordtype">long</span>)( <a class="code" href="../../d6/d7b/strchr_8c.html#a219836f542ce53545052bed5353820ca">strlen</a>( <a class="code" href="../../de/dce/syck_8h.html#abe48fac810a8a79c7b2ded3216b25ee8">YAML_DOMAIN</a> ) + 5 )) &amp;&amp;
<a name="l00463"></a>00463                      strncmp( subd - <a class="code" href="../../d6/d7b/strchr_8c.html#a219836f542ce53545052bed5353820ca">strlen</a>( <a class="code" href="../../de/dce/syck_8h.html#abe48fac810a8a79c7b2ded3216b25ee8">YAML_DOMAIN</a> ), <a class="code" href="../../de/dce/syck_8h.html#abe48fac810a8a79c7b2ded3216b25ee8">YAML_DOMAIN</a>, <a class="code" href="../../d6/d7b/strchr_8c.html#a219836f542ce53545052bed5353820ca">strlen</a>( <a class="code" href="../../de/dce/syck_8h.html#abe48fac810a8a79c7b2ded3216b25ee8">YAML_DOMAIN</a> ) ) == 0 ) {
<a name="l00464"></a>00464                     <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a251980c11ffad2f157e04ea6ee8dfa66">syck_emitter_write</a>( e, tag + 4, subd - <a class="code" href="../../d6/d7b/strchr_8c.html#a219836f542ce53545052bed5353820ca">strlen</a>( <a class="code" href="../../de/dce/syck_8h.html#abe48fac810a8a79c7b2ded3216b25ee8">YAML_DOMAIN</a> ) - ( tag + 4 ) - 1 );
<a name="l00465"></a>00465                     <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a251980c11ffad2f157e04ea6ee8dfa66">syck_emitter_write</a>( e, <span class="stringliteral">&quot;/&quot;</span>, 1 );
<a name="l00466"></a>00466                     <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a251980c11ffad2f157e04ea6ee8dfa66">syck_emitter_write</a>( e, subd + 1, ( tag + taglen ) - ( subd + 1 ) );
<a name="l00467"></a>00467                 } <span class="keywordflow">else</span> {
<a name="l00468"></a>00468                     <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a251980c11ffad2f157e04ea6ee8dfa66">syck_emitter_write</a>( e, tag + 4, subd - ( tag + 4 ) );
<a name="l00469"></a>00469                     <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a251980c11ffad2f157e04ea6ee8dfa66">syck_emitter_write</a>( e, <span class="stringliteral">&quot;/&quot;</span>, 1 );
<a name="l00470"></a>00470                     <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a251980c11ffad2f157e04ea6ee8dfa66">syck_emitter_write</a>( e, subd + 1, ( tag + taglen ) - ( subd + 1 ) );
<a name="l00471"></a>00471                 }
<a name="l00472"></a>00472             } <span class="keywordflow">else</span> {
<a name="l00473"></a>00473                 <span class="comment">/* TODO: Invalid tag (no colon after domain) */</span>
<a name="l00474"></a>00474                 <span class="keywordflow">return</span>;
<a name="l00475"></a>00475             }
<a name="l00476"></a>00476         }
<a name="l00477"></a>00477         <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a251980c11ffad2f157e04ea6ee8dfa66">syck_emitter_write</a>( e, <span class="stringliteral">&quot; &quot;</span>, 1 );
<a name="l00478"></a>00478 
<a name="l00479"></a>00479     <span class="comment">/* private types */</span>
<a name="l00480"></a>00480     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( strncmp( tag, <span class="stringliteral">&quot;x-private:&quot;</span>, 10 ) == 0 ) {
<a name="l00481"></a>00481         <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a251980c11ffad2f157e04ea6ee8dfa66">syck_emitter_write</a>( e, <span class="stringliteral">&quot;!!&quot;</span>, 2 );
<a name="l00482"></a>00482         <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a251980c11ffad2f157e04ea6ee8dfa66">syck_emitter_write</a>( e, tag + 10, <a class="code" href="../../d6/d7b/strchr_8c.html#a219836f542ce53545052bed5353820ca">strlen</a>( tag ) - 10 );
<a name="l00483"></a>00483         <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a251980c11ffad2f157e04ea6ee8dfa66">syck_emitter_write</a>( e, <span class="stringliteral">&quot; &quot;</span>, 1 );
<a name="l00484"></a>00484     }
<a name="l00485"></a>00485     lvl-&gt;<a class="code" href="../../dd/d0e/struct__syck__level.html#aa2b1e34c2e0e92f8ea8775278ed6c9c6">anctag</a> = 1;
<a name="l00486"></a>00486 }
<a name="l00487"></a>00487 
<a name="l00488"></a>00488 <span class="comment">/*</span>
<a name="l00489"></a>00489 <span class="comment"> * Emit a newline and an appropriately spaced indent.</span>
<a name="l00490"></a>00490 <span class="comment"> */</span>
<a name="l00491"></a><a class="code" href="../../de/dce/syck_8h.html#a0f60afdf670eed13fcab328dd836a9b7">00491</a> <span class="keywordtype">void</span> <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a84635b690e68518e54670f7f4bf1cb47">syck_emit_indent</a>( <a class="code" href="../../d8/df6/struct__syck__emitter.html">SyckEmitter</a> *e )
<a name="l00492"></a>00492 {
<a name="l00493"></a>00493     <span class="keywordtype">int</span> i;
<a name="l00494"></a>00494     <a class="code" href="../../dd/d0e/struct__syck__level.html">SyckLevel</a> *lvl = <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a5f9693ef17bdeacaa7afd778a29cb919">syck_emitter_current_level</a>( e );
<a name="l00495"></a>00495     <span class="keywordflow">if</span> ( e-&gt;<a class="code" href="../../d8/df6/struct__syck__emitter.html#aca2e1583f8909e1ea4e37bef74b1381c">bufpos</a> == 0 &amp;&amp; ( e-&gt;<a class="code" href="../../d8/df6/struct__syck__emitter.html#a3f5edd01c8e21f404279d345b981a49b">marker</a> - e-&gt;<a class="code" href="../../d8/df6/struct__syck__emitter.html#aea9239b4ebb3ae4f3d3502fce357f143">buffer</a> ) == 0 ) <span class="keywordflow">return</span>;
<a name="l00496"></a>00496     <span class="keywordflow">if</span> ( lvl-&gt;<a class="code" href="../../dd/d0e/struct__syck__level.html#a401e3fc67c4f33f8535cd3ec26fdb87d">spaces</a> &gt;= 0 ) {
<a name="l00497"></a>00497         <span class="keywordtype">char</span> *spcs = <a class="code" href="../../de/dce/syck_8h.html#a2d20ec6949b5978b35b88eedf43f36ff">S_ALLOC_N</a>( <span class="keywordtype">char</span>, lvl-&gt;<a class="code" href="../../dd/d0e/struct__syck__level.html#a401e3fc67c4f33f8535cd3ec26fdb87d">spaces</a> + 2 );
<a name="l00498"></a>00498 
<a name="l00499"></a>00499         spcs[0] = <span class="charliteral">&apos;\n&apos;</span>; spcs[lvl-&gt;<a class="code" href="../../dd/d0e/struct__syck__level.html#a401e3fc67c4f33f8535cd3ec26fdb87d">spaces</a> + 1] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l00500"></a>00500         <span class="keywordflow">for</span> ( i = 0; i &lt; lvl-&gt;<a class="code" href="../../dd/d0e/struct__syck__level.html#a401e3fc67c4f33f8535cd3ec26fdb87d">spaces</a>; i++ ) spcs[i+1] = <span class="charliteral">&apos; &apos;</span>;
<a name="l00501"></a>00501         <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a251980c11ffad2f157e04ea6ee8dfa66">syck_emitter_write</a>( e, spcs, lvl-&gt;<a class="code" href="../../dd/d0e/struct__syck__level.html#a401e3fc67c4f33f8535cd3ec26fdb87d">spaces</a> + 1 );
<a name="l00502"></a>00502         <a class="code" href="../../d1/ddc/dln_8c.html#affb9fc32698fab7f7b36e0cf8e64c83e">free</a>( spcs );
<a name="l00503"></a>00503     }
<a name="l00504"></a>00504 }
<a name="l00505"></a>00505 
<a name="l00506"></a>00506 <span class="comment">/* Clear the scan */</span>
<a name="l00507"></a><a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a15c8cb2e6989cf84fc7d10e56207a315">00507</a> <span class="preprocessor">#define SCAN_NONE       0</span>
<a name="l00508"></a>00508 <span class="preprocessor"></span><span class="comment">/* All printable characters? */</span>
<a name="l00509"></a><a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a9483e630f04dc8987042ad6ab7406617">00509</a> <span class="preprocessor">#define SCAN_NONPRINT   1</span>
<a name="l00510"></a>00510 <span class="preprocessor"></span><span class="comment">/* Any indented lines? */</span>
<a name="l00511"></a><a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a6ed06574fb7457707b66022db4fa8ad9">00511</a> <span class="preprocessor">#define SCAN_INDENTED   2</span>
<a name="l00512"></a>00512 <span class="preprocessor"></span><span class="comment">/* Larger than the requested width? */</span>
<a name="l00513"></a><a class="code" href="../../d3/ddc/syck_2emitter_8c.html#ab6f11e6bb43886bfd0170ce69fa0d1a2">00513</a> <span class="preprocessor">#define SCAN_WIDE       4</span>
<a name="l00514"></a>00514 <span class="preprocessor"></span><span class="comment">/* Opens or closes with whitespace? */</span>
<a name="l00515"></a><a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a9f5ae9a17eb6ce9d635dfb4a2cc8479a">00515</a> <span class="preprocessor">#define SCAN_WHITEEDGE  8</span>
<a name="l00516"></a>00516 <span class="preprocessor"></span><span class="comment">/* Contains a newline */</span>
<a name="l00517"></a><a class="code" href="../../d3/ddc/syck_2emitter_8c.html#abbbda82eec6624085553661c9ebad00b">00517</a> <span class="preprocessor">#define SCAN_NEWLINE    16</span>
<a name="l00518"></a>00518 <span class="preprocessor"></span><span class="comment">/* Contains a single quote */</span>
<a name="l00519"></a><a class="code" href="../../d3/ddc/syck_2emitter_8c.html#ad9471cf3f092be61e0c79e8d94b8a8e6">00519</a> <span class="preprocessor">#define SCAN_SINGLEQ    32</span>
<a name="l00520"></a>00520 <span class="preprocessor"></span><span class="comment">/* Contains a double quote */</span>
<a name="l00521"></a><a class="code" href="../../d3/ddc/syck_2emitter_8c.html#adb5d0a95c037e379a469b0e48cc4a557">00521</a> <span class="preprocessor">#define SCAN_DOUBLEQ    64</span>
<a name="l00522"></a>00522 <span class="preprocessor"></span><span class="comment">/* Starts with a token */</span>
<a name="l00523"></a><a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a8a23edb33d1970780070be4a4d6b0631">00523</a> <span class="preprocessor">#define SCAN_INDIC_S    128</span>
<a name="l00524"></a>00524 <span class="preprocessor"></span><span class="comment">/* Contains a flow indicator */</span>
<a name="l00525"></a><a class="code" href="../../d3/ddc/syck_2emitter_8c.html#ac7615c2ae6e1279a244d0599d3671cfe">00525</a> <span class="preprocessor">#define SCAN_INDIC_C    256</span>
<a name="l00526"></a>00526 <span class="preprocessor"></span><span class="comment">/* Ends without newlines */</span>
<a name="l00527"></a><a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a7af79a5d4b8860eb719eef559657392c">00527</a> <span class="preprocessor">#define SCAN_NONL_E     512</span>
<a name="l00528"></a>00528 <span class="preprocessor"></span><span class="comment">/* Ends with many newlines */</span>
<a name="l00529"></a><a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a52413d2f0a8544563437a1c510b2ebd7">00529</a> <span class="preprocessor">#define SCAN_MANYNL_E   1024</span>
<a name="l00530"></a>00530 <span class="preprocessor"></span><span class="comment">/* Contains flow map indicators */</span>
<a name="l00531"></a><a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a37527eba694d99ed5b04a9ee9eef1d7f">00531</a> <span class="preprocessor">#define SCAN_FLOWMAP    2048</span>
<a name="l00532"></a>00532 <span class="preprocessor"></span><span class="comment">/* Contains flow seq indicators */</span>
<a name="l00533"></a><a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a6a9512514c6667bf830c91b5cfb438c2">00533</a> <span class="preprocessor">#define SCAN_FLOWSEQ    4096</span>
<a name="l00534"></a>00534 <span class="preprocessor"></span><span class="comment">/* Contains a valid doc separator */</span>
<a name="l00535"></a><a class="code" href="../../d3/ddc/syck_2emitter_8c.html#acb9b1e75720bb36b17d7d90a4e7ef4bc">00535</a> <span class="preprocessor">#define SCAN_DOCSEP     8192</span>
<a name="l00536"></a>00536 <span class="preprocessor"></span>
<a name="l00537"></a>00537 <span class="comment">/*</span>
<a name="l00538"></a>00538 <span class="comment"> * Basic printable test for LATIN-1 characters.</span>
<a name="l00539"></a>00539 <span class="comment"> */</span>
<a name="l00540"></a>00540 <span class="keywordtype">int</span>
<a name="l00541"></a><a class="code" href="../../de/dce/syck_8h.html#aca45292660bd04956c891c044a9896ff">00541</a> <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a796f3be7094e862e160bc88516b870a0">syck_scan_scalar</a>( <span class="keywordtype">int</span> req_width, <span class="keyword">const</span> <span class="keywordtype">char</span> *cursor, <span class="keywordtype">long</span> <a class="code" href="../../d3/d15/name2ctype_8h.html#aed1cc4dca5d94cb452f79691f54f7423">len</a> )
<a name="l00542"></a>00542 {
<a name="l00543"></a>00543     <span class="keywordtype">long</span> i = 0, start = 0;
<a name="l00544"></a>00544     <span class="keywordtype">int</span> flags = <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a15c8cb2e6989cf84fc7d10e56207a315">SCAN_NONE</a>;
<a name="l00545"></a>00545 
<a name="l00546"></a>00546     <span class="keywordflow">if</span> ( len &lt; 1 )  <span class="keywordflow">return</span> flags;
<a name="l00547"></a>00547 
<a name="l00548"></a>00548     <span class="comment">/* c-indicators from the spec */</span>
<a name="l00549"></a>00549     <span class="keywordflow">if</span> ( cursor[0] == <span class="charliteral">&apos;[&apos;</span> || cursor[0] == <span class="charliteral">&apos;]&apos;</span> ||
<a name="l00550"></a>00550          cursor[0] == <span class="charliteral">&apos;{&apos;</span> || cursor[0] == <span class="charliteral">&apos;}&apos;</span> ||
<a name="l00551"></a>00551          cursor[0] == <span class="charliteral">&apos;!&apos;</span> || cursor[0] == <span class="charliteral">&apos;*&apos;</span> ||
<a name="l00552"></a>00552          cursor[0] == <span class="charliteral">&apos;&amp;&apos;</span> || cursor[0] == <span class="charliteral">&apos;|&apos;</span> ||
<a name="l00553"></a>00553          cursor[0] == <span class="charliteral">&apos;&gt;&apos;</span> || cursor[0] == <span class="charliteral">&apos;\&apos;&apos;</span> ||
<a name="l00554"></a>00554          cursor[0] == <span class="charliteral">&apos;&quot;&apos;</span> || cursor[0] == <span class="charliteral">&apos;#&apos;</span> ||
<a name="l00555"></a>00555          cursor[0] == <span class="charliteral">&apos;%&apos;</span> || cursor[0] == <span class="charliteral">&apos;@&apos;</span> ||
<a name="l00556"></a>00556          cursor[0] == <span class="charliteral">&apos;&amp;&apos;</span> ) {
<a name="l00557"></a>00557             flags |= <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a8a23edb33d1970780070be4a4d6b0631">SCAN_INDIC_S</a>;
<a name="l00558"></a>00558     }
<a name="l00559"></a>00559     <span class="keywordflow">if</span> ( ( cursor[0] == <span class="charliteral">&apos;-&apos;</span> || cursor[0] == <span class="charliteral">&apos;:&apos;</span> ||
<a name="l00560"></a>00560            cursor[0] == <span class="charliteral">&apos;?&apos;</span> || cursor[0] == <span class="charliteral">&apos;,&apos;</span> ) &amp;&amp;
<a name="l00561"></a>00561            ( len == 1 || cursor[1] == <span class="charliteral">&apos; &apos;</span> || cursor[1] == <span class="charliteral">&apos;\n&apos;</span> ) )
<a name="l00562"></a>00562     {
<a name="l00563"></a>00563             flags |= <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a8a23edb33d1970780070be4a4d6b0631">SCAN_INDIC_S</a>;
<a name="l00564"></a>00564     }
<a name="l00565"></a>00565 
<a name="l00566"></a>00566     <span class="comment">/* whitespace edges */</span>
<a name="l00567"></a>00567     <span class="keywordflow">if</span> ( cursor[len-1] != <span class="charliteral">&apos;\n&apos;</span> ) {
<a name="l00568"></a>00568         flags |= <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a7af79a5d4b8860eb719eef559657392c">SCAN_NONL_E</a>;
<a name="l00569"></a>00569     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( len &gt; 1 &amp;&amp; cursor[len-2] == <span class="charliteral">&apos;\n&apos;</span> ) {
<a name="l00570"></a>00570         flags |= <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a52413d2f0a8544563437a1c510b2ebd7">SCAN_MANYNL_E</a>;
<a name="l00571"></a>00571     }
<a name="l00572"></a>00572     <span class="keywordflow">if</span> (
<a name="l00573"></a>00573         ( len &gt; 0 &amp;&amp; ( cursor[0] == <span class="charliteral">&apos; &apos;</span> || cursor[0] == <span class="charliteral">&apos;\t&apos;</span> || cursor[0] == <span class="charliteral">&apos;\n&apos;</span> || cursor[0] == <span class="charliteral">&apos;\r&apos;</span> ) ) ||
<a name="l00574"></a>00574         ( len &gt; 1 &amp;&amp; ( cursor[len-1] == <span class="charliteral">&apos; &apos;</span> || cursor[len-1] == <span class="charliteral">&apos;\t&apos;</span> ) )
<a name="l00575"></a>00575     ) {
<a name="l00576"></a>00576         flags |= <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a9f5ae9a17eb6ce9d635dfb4a2cc8479a">SCAN_WHITEEDGE</a>;
<a name="l00577"></a>00577     }
<a name="l00578"></a>00578 
<a name="l00579"></a>00579     <span class="comment">/* opening doc sep */</span>
<a name="l00580"></a>00580     <span class="keywordflow">if</span> ( len &gt;= 3 &amp;&amp; strncmp( cursor, <span class="stringliteral">&quot;---&quot;</span>, 3 ) == 0 )
<a name="l00581"></a>00581         flags |= <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#acb9b1e75720bb36b17d7d90a4e7ef4bc">SCAN_DOCSEP</a>;
<a name="l00582"></a>00582 
<a name="l00583"></a>00583     <span class="comment">/* scan string */</span>
<a name="l00584"></a>00584     <span class="keywordflow">for</span> ( i = 0; i &lt; len; i++ ) {
<a name="l00585"></a>00585 
<a name="l00586"></a>00586         <span class="keywordflow">if</span> ( ! ( cursor[i] == 0x9 ||
<a name="l00587"></a>00587                  cursor[i] == 0xA ||
<a name="l00588"></a>00588                  cursor[i] == 0xD ||
<a name="l00589"></a>00589                ( cursor[i] &gt;= 0x20 &amp;&amp; cursor[i] &lt;= 0x7E ) )
<a name="l00590"></a>00590         ) {
<a name="l00591"></a>00591             flags |= <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a9483e630f04dc8987042ad6ab7406617">SCAN_NONPRINT</a>;
<a name="l00592"></a>00592         }
<a name="l00593"></a>00593         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( cursor[i] == <span class="charliteral">&apos;\n&apos;</span> ) {
<a name="l00594"></a>00594             flags |= <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#abbbda82eec6624085553661c9ebad00b">SCAN_NEWLINE</a>;
<a name="l00595"></a>00595             <span class="keywordflow">if</span> ( len - i &gt;= 3 &amp;&amp; strncmp( &amp;cursor[i+1], <span class="stringliteral">&quot;---&quot;</span>, 3 ) == 0 )
<a name="l00596"></a>00596                 flags |= <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#acb9b1e75720bb36b17d7d90a4e7ef4bc">SCAN_DOCSEP</a>;
<a name="l00597"></a>00597             <span class="keywordflow">if</span> ( cursor[i+1] == <span class="charliteral">&apos; &apos;</span> || cursor[i+1] == <span class="charliteral">&apos;\t&apos;</span> )
<a name="l00598"></a>00598                 flags |= <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a6ed06574fb7457707b66022db4fa8ad9">SCAN_INDENTED</a>;
<a name="l00599"></a>00599             <span class="keywordflow">if</span> ( req_width &gt; 0 &amp;&amp; i - start &gt; req_width )
<a name="l00600"></a>00600                 flags |= <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#ab6f11e6bb43886bfd0170ce69fa0d1a2">SCAN_WIDE</a>;
<a name="l00601"></a>00601             start = i;
<a name="l00602"></a>00602         }
<a name="l00603"></a>00603         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( cursor[i] == <span class="charliteral">&apos;\&apos;&apos;</span> )
<a name="l00604"></a>00604         {
<a name="l00605"></a>00605             flags |= <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#ad9471cf3f092be61e0c79e8d94b8a8e6">SCAN_SINGLEQ</a>;
<a name="l00606"></a>00606         }
<a name="l00607"></a>00607         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( cursor[i] == <span class="charliteral">&apos;&quot;&apos;</span> )
<a name="l00608"></a>00608         {
<a name="l00609"></a>00609             flags |= <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#adb5d0a95c037e379a469b0e48cc4a557">SCAN_DOUBLEQ</a>;
<a name="l00610"></a>00610         }
<a name="l00611"></a>00611         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( cursor[i] == <span class="charliteral">&apos;]&apos;</span> )
<a name="l00612"></a>00612         {
<a name="l00613"></a>00613             flags |= <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a6a9512514c6667bf830c91b5cfb438c2">SCAN_FLOWSEQ</a>;
<a name="l00614"></a>00614         }
<a name="l00615"></a>00615         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( cursor[i] == <span class="charliteral">&apos;}&apos;</span> )
<a name="l00616"></a>00616         {
<a name="l00617"></a>00617             flags |= <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a37527eba694d99ed5b04a9ee9eef1d7f">SCAN_FLOWMAP</a>;
<a name="l00618"></a>00618         }
<a name="l00619"></a>00619         <span class="comment">/* remember, if plain collections get implemented, to add nb-plain-flow-char */</span>
<a name="l00620"></a>00620         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( ( cursor[i] == <span class="charliteral">&apos; &apos;</span> &amp;&amp; cursor[i+1] == <span class="charliteral">&apos;#&apos;</span> ) ||
<a name="l00621"></a>00621                   ( cursor[i] == <span class="charliteral">&apos;:&apos;</span> &amp;&amp;
<a name="l00622"></a>00622                     ( cursor[i+1] == <span class="charliteral">&apos; &apos;</span> || cursor[i+1] == <span class="charliteral">&apos;\n&apos;</span> || i == len - 1 ) ) )
<a name="l00623"></a>00623         {
<a name="l00624"></a>00624             flags |= <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#ac7615c2ae6e1279a244d0599d3671cfe">SCAN_INDIC_C</a>;
<a name="l00625"></a>00625         }
<a name="l00626"></a>00626         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( cursor[i] == <span class="charliteral">&apos;,&apos;</span> &amp;&amp;
<a name="l00627"></a>00627                   ( cursor[i+1] == <span class="charliteral">&apos; &apos;</span> || cursor[i+1] == <span class="charliteral">&apos;\n&apos;</span> || i == len - 1 ) )
<a name="l00628"></a>00628         {
<a name="l00629"></a>00629             flags |= <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a37527eba694d99ed5b04a9ee9eef1d7f">SCAN_FLOWMAP</a>;
<a name="l00630"></a>00630             flags |= <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a6a9512514c6667bf830c91b5cfb438c2">SCAN_FLOWSEQ</a>;
<a name="l00631"></a>00631         }
<a name="l00632"></a>00632     }
<a name="l00633"></a>00633 
<a name="l00634"></a>00634     <span class="comment">/* printf( &quot;---STR---\n%s\nFLAGS: %d\n&quot;, cursor, flags ); */</span>
<a name="l00635"></a>00635     <span class="keywordflow">return</span> flags;
<a name="l00636"></a>00636 }
<a name="l00637"></a>00637 <span class="comment">/*</span>
<a name="l00638"></a>00638 <span class="comment"> * All scalars should be emitted through this function, which determines an appropriate style,</span>
<a name="l00639"></a>00639 <span class="comment"> * tag and indent.</span>
<a name="l00640"></a>00640 <span class="comment"> */</span>
<a name="l00641"></a><a class="code" href="../../de/dce/syck_8h.html#a3fe6b1272606e88693da8b078d811e93">00641</a> <span class="keywordtype">void</span> <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a245958e8e4391b414e6c6c45dc9c0119">syck_emit_scalar</a>( <a class="code" href="../../d8/df6/struct__syck__emitter.html">SyckEmitter</a> *e, <span class="keyword">const</span> <span class="keywordtype">char</span> *tag, <span class="keyword">enum</span> <a class="code" href="../../de/dce/syck_8h.html#a80e0a63715fa32302da405e1585e2f31">scalar_style</a> force_style, <span class="keywordtype">int</span> force_indent, <span class="keywordtype">int</span> force_width,
<a name="l00642"></a>00642                        <span class="keywordtype">char</span> keep_nl, <span class="keyword">const</span> <span class="keywordtype">char</span> *str, <span class="keywordtype">long</span> <a class="code" href="../../d3/d15/name2ctype_8h.html#aed1cc4dca5d94cb452f79691f54f7423">len</a> )
<a name="l00643"></a>00643 {
<a name="l00644"></a>00644     <span class="keyword">enum</span> <a class="code" href="../../de/dce/syck_8h.html#a80e0a63715fa32302da405e1585e2f31">scalar_style</a> favor_style = <a class="code" href="../../de/dce/syck_8h.html#a80e0a63715fa32302da405e1585e2f31aef1d1e7c791267244aac19334646178b">scalar_literal</a>;
<a name="l00645"></a>00645     <a class="code" href="../../dd/d0e/struct__syck__level.html">SyckLevel</a> *parent = <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a35436ae22a44347661a8bb282d9ef744">syck_emitter_parent_level</a>( e );
<a name="l00646"></a>00646     <a class="code" href="../../dd/d0e/struct__syck__level.html">SyckLevel</a> *lvl = <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a5f9693ef17bdeacaa7afd778a29cb919">syck_emitter_current_level</a>( e );
<a name="l00647"></a>00647     <span class="keywordtype">int</span> scan = 0;
<a name="l00648"></a>00648     <span class="keyword">const</span> <span class="keywordtype">char</span> *match_implicit;
<a name="l00649"></a>00649     <span class="keywordtype">char</span> *implicit;
<a name="l00650"></a>00650 
<a name="l00651"></a>00651     <span class="keywordflow">if</span> ( str == <a class="code" href="../../d3/d09/ripper_8y.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> ) str = <span class="stringliteral">&quot;&quot;</span>;
<a name="l00652"></a>00652 
<a name="l00653"></a>00653     <span class="comment">/* No empty nulls as map keys */</span>
<a name="l00654"></a>00654     <span class="keywordflow">if</span> ( len == 0 &amp;&amp; ( parent-&gt;<a class="code" href="../../dd/d0e/struct__syck__level.html#adc00a7ade66d407d9d00745e491c4d6c">status</a> == <a class="code" href="../../de/dce/syck_8h.html#a10af5e9a345d0e86156a336e91ff9f47a193976ec9cc4f9ee296a851e5f03c4f8">syck_lvl_map</a> || parent-&gt;<a class="code" href="../../dd/d0e/struct__syck__level.html#adc00a7ade66d407d9d00745e491c4d6c">status</a> == <a class="code" href="../../de/dce/syck_8h.html#a10af5e9a345d0e86156a336e91ff9f47a65beb407005776a7a575da4dd9b65a65">syck_lvl_imap</a> ) &amp;&amp;
<a name="l00655"></a>00655          parent-&gt;<a class="code" href="../../dd/d0e/struct__syck__level.html#afa7cc05334cbd8dbe1367d9de134c8ab">ncount</a> % 2 == 1 &amp;&amp; <a class="code" href="../../dc/d53/implicit_8c.html#a6e712591b4b24a5f95e762b3c0583f60">syck_tagcmp</a>( tag, <span class="stringliteral">&quot;tag:yaml.org,2002:null&quot;</span> ) == 0 )
<a name="l00656"></a>00656     {
<a name="l00657"></a>00657         str = <span class="stringliteral">&quot;~&quot;</span>;
<a name="l00658"></a>00658         len = 1;
<a name="l00659"></a>00659     }
<a name="l00660"></a>00660 
<a name="l00661"></a>00661     scan = <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a796f3be7094e862e160bc88516b870a0">syck_scan_scalar</a>( force_width, str, len );
<a name="l00662"></a>00662     match_implicit = <a class="code" href="../../dc/d53/implicit_8c.html#a7aad39f8f9be61583e9bf90aaa3afa2c">syck_match_implicit</a>( str, len );
<a name="l00663"></a>00663 
<a name="l00664"></a>00664     <span class="comment">/* quote strings which default to implicits */</span>
<a name="l00665"></a>00665     implicit = <a class="code" href="../../db/dd1/handler_8c.html#a27c2866322d97b3d1a5f03a1b60dcb3d">syck_taguri</a>( <a class="code" href="../../de/dce/syck_8h.html#abe48fac810a8a79c7b2ded3216b25ee8">YAML_DOMAIN</a>, match_implicit, (<span class="keywordtype">int</span>)<a class="code" href="../../d6/d7b/strchr_8c.html#a219836f542ce53545052bed5353820ca">strlen</a>( match_implicit ) );
<a name="l00666"></a>00666     <span class="keywordflow">if</span> ( <a class="code" href="../../dc/d53/implicit_8c.html#a6e712591b4b24a5f95e762b3c0583f60">syck_tagcmp</a>( tag, implicit ) != 0 &amp;&amp; <a class="code" href="../../dc/d53/implicit_8c.html#a6e712591b4b24a5f95e762b3c0583f60">syck_tagcmp</a>( tag, <span class="stringliteral">&quot;tag:yaml.org,2002:str&quot;</span> ) == 0 ) {
<a name="l00667"></a>00667         force_style = <a class="code" href="../../de/dce/syck_8h.html#a80e0a63715fa32302da405e1585e2f31a04ab6baa79414ba7ecc1add16c0bde61">scalar_2quote</a>;
<a name="l00668"></a>00668     } <span class="keywordflow">else</span> {
<a name="l00669"></a>00669         <span class="comment">/* complex key */</span>
<a name="l00670"></a>00670         <span class="keywordflow">if</span> ( parent-&gt;<a class="code" href="../../dd/d0e/struct__syck__level.html#adc00a7ade66d407d9d00745e491c4d6c">status</a> == <a class="code" href="../../de/dce/syck_8h.html#a10af5e9a345d0e86156a336e91ff9f47a193976ec9cc4f9ee296a851e5f03c4f8">syck_lvl_map</a> &amp;&amp; parent-&gt;<a class="code" href="../../dd/d0e/struct__syck__level.html#afa7cc05334cbd8dbe1367d9de134c8ab">ncount</a> % 2 == 1 &amp;&amp;
<a name="l00671"></a>00671              ( !( tag == <a class="code" href="../../d3/d09/ripper_8y.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> ||
<a name="l00672"></a>00672              ( implicit != <a class="code" href="../../d3/d09/ripper_8y.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> &amp;&amp; <a class="code" href="../../dc/d53/implicit_8c.html#a6e712591b4b24a5f95e762b3c0583f60">syck_tagcmp</a>( tag, implicit ) == 0 &amp;&amp; e-&gt;<a class="code" href="../../d8/df6/struct__syck__emitter.html#a714457cf53a8c01c33a4c3fc7890e06c">explicit_typing</a> == 0 ) ) ) )
<a name="l00673"></a>00673         {
<a name="l00674"></a>00674             <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a251980c11ffad2f157e04ea6ee8dfa66">syck_emitter_write</a>( e, <span class="stringliteral">&quot;? &quot;</span>, 2 );
<a name="l00675"></a>00675             parent-&gt;<a class="code" href="../../dd/d0e/struct__syck__level.html#adc00a7ade66d407d9d00745e491c4d6c">status</a> = <a class="code" href="../../de/dce/syck_8h.html#a10af5e9a345d0e86156a336e91ff9f47a0b4728afa0a95f1f6acfd7f8d2c16716">syck_lvl_mapx</a>;
<a name="l00676"></a>00676         }
<a name="l00677"></a>00677         <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a9d213f5296217ed7f2bfef25267ab499">syck_emit_tag</a>( e, tag, implicit );
<a name="l00678"></a>00678     }
<a name="l00679"></a>00679     <a class="code" href="../../de/dce/syck_8h.html#a59b854f4bc2b7cd8e19c75600deeb24d">S_FREE</a>( implicit );
<a name="l00680"></a>00680 
<a name="l00681"></a>00681     <span class="comment">/* if still arbitrary, sniff a good block style. */</span>
<a name="l00682"></a>00682     <span class="keywordflow">if</span> ( force_style == <a class="code" href="../../de/dce/syck_8h.html#a80e0a63715fa32302da405e1585e2f31a91d800cf241e7dc19373dcbceb2c1c27">scalar_none</a> ) {
<a name="l00683"></a>00683         <span class="keywordflow">if</span> ( scan &amp; <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#abbbda82eec6624085553661c9ebad00b">SCAN_NEWLINE</a> ) {
<a name="l00684"></a>00684             force_style = <a class="code" href="../../de/dce/syck_8h.html#a80e0a63715fa32302da405e1585e2f31aef1d1e7c791267244aac19334646178b">scalar_literal</a>;
<a name="l00685"></a>00685         } <span class="keywordflow">else</span> {
<a name="l00686"></a>00686             force_style = <a class="code" href="../../de/dce/syck_8h.html#a80e0a63715fa32302da405e1585e2f31ad2d0da74e48550b9379d387ba4fc370b">scalar_plain</a>;
<a name="l00687"></a>00687         }
<a name="l00688"></a>00688     }
<a name="l00689"></a>00689 
<a name="l00690"></a>00690     <span class="keywordflow">if</span> ( e-&gt;<a class="code" href="../../d8/df6/struct__syck__emitter.html#abae2d1aaa5f6799f012747ee2e999de2">style</a> == <a class="code" href="../../de/dce/syck_8h.html#a80e0a63715fa32302da405e1585e2f31aec0a149f2467b0929ff58e5cd2e4dea2">scalar_fold</a> ) {
<a name="l00691"></a>00691         favor_style = <a class="code" href="../../de/dce/syck_8h.html#a80e0a63715fa32302da405e1585e2f31aec0a149f2467b0929ff58e5cd2e4dea2">scalar_fold</a>;
<a name="l00692"></a>00692     }
<a name="l00693"></a>00693 
<a name="l00694"></a>00694     <span class="comment">/* Determine block style */</span>
<a name="l00695"></a>00695     <span class="keywordflow">if</span> ( scan &amp; <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a9483e630f04dc8987042ad6ab7406617">SCAN_NONPRINT</a> ) {
<a name="l00696"></a>00696         force_style = <a class="code" href="../../de/dce/syck_8h.html#a80e0a63715fa32302da405e1585e2f31a04ab6baa79414ba7ecc1add16c0bde61">scalar_2quote</a>;
<a name="l00697"></a>00697     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( scan &amp; <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a9f5ae9a17eb6ce9d635dfb4a2cc8479a">SCAN_WHITEEDGE</a> ) {
<a name="l00698"></a>00698         force_style = <a class="code" href="../../de/dce/syck_8h.html#a80e0a63715fa32302da405e1585e2f31a04ab6baa79414ba7ecc1add16c0bde61">scalar_2quote</a>;
<a name="l00699"></a>00699     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( force_style != <a class="code" href="../../de/dce/syck_8h.html#a80e0a63715fa32302da405e1585e2f31aec0a149f2467b0929ff58e5cd2e4dea2">scalar_fold</a> &amp;&amp; ( scan &amp; <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a6ed06574fb7457707b66022db4fa8ad9">SCAN_INDENTED</a> ) ) {
<a name="l00700"></a>00700         force_style = <a class="code" href="../../de/dce/syck_8h.html#a80e0a63715fa32302da405e1585e2f31aef1d1e7c791267244aac19334646178b">scalar_literal</a>;
<a name="l00701"></a>00701     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( force_style == <a class="code" href="../../de/dce/syck_8h.html#a80e0a63715fa32302da405e1585e2f31ad2d0da74e48550b9379d387ba4fc370b">scalar_plain</a> &amp;&amp; ( scan &amp; <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#abbbda82eec6624085553661c9ebad00b">SCAN_NEWLINE</a> ) ) {
<a name="l00702"></a>00702         force_style = favor_style;
<a name="l00703"></a>00703     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( force_style == <a class="code" href="../../de/dce/syck_8h.html#a80e0a63715fa32302da405e1585e2f31ad2d0da74e48550b9379d387ba4fc370b">scalar_plain</a> &amp;&amp; parent-&gt;<a class="code" href="../../dd/d0e/struct__syck__level.html#adc00a7ade66d407d9d00745e491c4d6c">status</a> == <a class="code" href="../../de/dce/syck_8h.html#a10af5e9a345d0e86156a336e91ff9f47a90bc43e019e7e4c3d41f6d4ab92d1a6b">syck_lvl_iseq</a> &amp;&amp; ( scan &amp; <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a6a9512514c6667bf830c91b5cfb438c2">SCAN_FLOWSEQ</a> ) ) {
<a name="l00704"></a>00704         force_style = <a class="code" href="../../de/dce/syck_8h.html#a80e0a63715fa32302da405e1585e2f31a04ab6baa79414ba7ecc1add16c0bde61">scalar_2quote</a>;
<a name="l00705"></a>00705     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( force_style == <a class="code" href="../../de/dce/syck_8h.html#a80e0a63715fa32302da405e1585e2f31ad2d0da74e48550b9379d387ba4fc370b">scalar_plain</a> &amp;&amp; parent-&gt;<a class="code" href="../../dd/d0e/struct__syck__level.html#adc00a7ade66d407d9d00745e491c4d6c">status</a> == <a class="code" href="../../de/dce/syck_8h.html#a10af5e9a345d0e86156a336e91ff9f47a65beb407005776a7a575da4dd9b65a65">syck_lvl_imap</a> &amp;&amp; ( scan &amp; <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a37527eba694d99ed5b04a9ee9eef1d7f">SCAN_FLOWMAP</a> ) ) {
<a name="l00706"></a>00706         force_style = <a class="code" href="../../de/dce/syck_8h.html#a80e0a63715fa32302da405e1585e2f31a04ab6baa79414ba7ecc1add16c0bde61">scalar_2quote</a>;
<a name="l00707"></a>00707     <span class="comment">/* } else if ( force_style == scalar_fold &amp;&amp; ( ! ( scan &amp; SCAN_WIDE ) ) ) {</span>
<a name="l00708"></a>00708 <span class="comment">        force_style = scalar_literal; */</span>
<a name="l00709"></a>00709     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( force_style == <a class="code" href="../../de/dce/syck_8h.html#a80e0a63715fa32302da405e1585e2f31ad2d0da74e48550b9379d387ba4fc370b">scalar_plain</a> &amp;&amp; ( scan &amp; <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a8a23edb33d1970780070be4a4d6b0631">SCAN_INDIC_S</a> || scan &amp; <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#ac7615c2ae6e1279a244d0599d3671cfe">SCAN_INDIC_C</a> ) ) {
<a name="l00710"></a>00710         <span class="keywordflow">if</span> ( scan &amp; SCAN_NEWLINE ) {
<a name="l00711"></a>00711             force_style = favor_style;
<a name="l00712"></a>00712         } <span class="keywordflow">else</span> {
<a name="l00713"></a>00713             force_style = <a class="code" href="../../de/dce/syck_8h.html#a80e0a63715fa32302da405e1585e2f31a04ab6baa79414ba7ecc1add16c0bde61">scalar_2quote</a>;
<a name="l00714"></a>00714         }
<a name="l00715"></a>00715     }
<a name="l00716"></a>00716 
<a name="l00717"></a>00717     <span class="keywordflow">if</span> ( force_indent &gt; 0 ) {
<a name="l00718"></a>00718         lvl-&gt;<a class="code" href="../../dd/d0e/struct__syck__level.html#a401e3fc67c4f33f8535cd3ec26fdb87d">spaces</a> = parent-&gt;<a class="code" href="../../dd/d0e/struct__syck__level.html#a401e3fc67c4f33f8535cd3ec26fdb87d">spaces</a> + force_indent;
<a name="l00719"></a>00719     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( scan &amp; <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#acb9b1e75720bb36b17d7d90a4e7ef4bc">SCAN_DOCSEP</a> ) {
<a name="l00720"></a>00720         lvl-&gt;<a class="code" href="../../dd/d0e/struct__syck__level.html#a401e3fc67c4f33f8535cd3ec26fdb87d">spaces</a> = parent-&gt;<a class="code" href="../../dd/d0e/struct__syck__level.html#a401e3fc67c4f33f8535cd3ec26fdb87d">spaces</a> + e-&gt;<a class="code" href="../../d8/df6/struct__syck__emitter.html#a1e9795a23ab21ee7fc817921c3a238e1">indent</a>;
<a name="l00721"></a>00721     }
<a name="l00722"></a>00722 
<a name="l00723"></a>00723     <span class="comment">/* For now, all ambiguous keys are going to be double-quoted */</span>
<a name="l00724"></a>00724     <span class="keywordflow">if</span> ( ( parent-&gt;<a class="code" href="../../dd/d0e/struct__syck__level.html#adc00a7ade66d407d9d00745e491c4d6c">status</a> == <a class="code" href="../../de/dce/syck_8h.html#a10af5e9a345d0e86156a336e91ff9f47a193976ec9cc4f9ee296a851e5f03c4f8">syck_lvl_map</a> || parent-&gt;<a class="code" href="../../dd/d0e/struct__syck__level.html#adc00a7ade66d407d9d00745e491c4d6c">status</a> == <a class="code" href="../../de/dce/syck_8h.html#a10af5e9a345d0e86156a336e91ff9f47a0b4728afa0a95f1f6acfd7f8d2c16716">syck_lvl_mapx</a> ) &amp;&amp; parent-&gt;<a class="code" href="../../dd/d0e/struct__syck__level.html#afa7cc05334cbd8dbe1367d9de134c8ab">ncount</a> % 2 == 1 ) {
<a name="l00725"></a>00725         <span class="keywordflow">if</span> ( force_style != <a class="code" href="../../de/dce/syck_8h.html#a80e0a63715fa32302da405e1585e2f31ad2d0da74e48550b9379d387ba4fc370b">scalar_plain</a> ) {
<a name="l00726"></a>00726             force_style = <a class="code" href="../../de/dce/syck_8h.html#a80e0a63715fa32302da405e1585e2f31a04ab6baa79414ba7ecc1add16c0bde61">scalar_2quote</a>;
<a name="l00727"></a>00727         }
<a name="l00728"></a>00728     }
<a name="l00729"></a>00729 
<a name="l00730"></a>00730     <span class="comment">/* If the parent is an inline, double quote anything complex */</span>
<a name="l00731"></a>00731     <span class="keywordflow">if</span> ( parent-&gt;<a class="code" href="../../dd/d0e/struct__syck__level.html#adc00a7ade66d407d9d00745e491c4d6c">status</a> == <a class="code" href="../../de/dce/syck_8h.html#a10af5e9a345d0e86156a336e91ff9f47a65beb407005776a7a575da4dd9b65a65">syck_lvl_imap</a> || parent-&gt;<a class="code" href="../../dd/d0e/struct__syck__level.html#adc00a7ade66d407d9d00745e491c4d6c">status</a> == <a class="code" href="../../de/dce/syck_8h.html#a10af5e9a345d0e86156a336e91ff9f47a90bc43e019e7e4c3d41f6d4ab92d1a6b">syck_lvl_iseq</a> ) {
<a name="l00732"></a>00732         <span class="keywordflow">if</span> ( force_style != <a class="code" href="../../de/dce/syck_8h.html#a80e0a63715fa32302da405e1585e2f31ad2d0da74e48550b9379d387ba4fc370b">scalar_plain</a> &amp;&amp; force_style != <a class="code" href="../../de/dce/syck_8h.html#a80e0a63715fa32302da405e1585e2f31a4644440933345c1ac67c049d3b54c797">scalar_1quote</a> ) {
<a name="l00733"></a>00733             force_style = <a class="code" href="../../de/dce/syck_8h.html#a80e0a63715fa32302da405e1585e2f31a04ab6baa79414ba7ecc1add16c0bde61">scalar_2quote</a>;
<a name="l00734"></a>00734         }
<a name="l00735"></a>00735     }
<a name="l00736"></a>00736 
<a name="l00737"></a>00737     <span class="comment">/* Fix the ending newlines */</span>
<a name="l00738"></a>00738     <span class="keywordflow">if</span> ( scan &amp; <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a7af79a5d4b8860eb719eef559657392c">SCAN_NONL_E</a> ) {
<a name="l00739"></a>00739         keep_nl = <a class="code" href="../../de/dce/syck_8h.html#acd1f2c925deccdc97b77b5c14880128b">NL_CHOMP</a>;
<a name="l00740"></a>00740     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( scan &amp; <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a52413d2f0a8544563437a1c510b2ebd7">SCAN_MANYNL_E</a> ) {
<a name="l00741"></a>00741         keep_nl = <a class="code" href="../../de/dce/syck_8h.html#a2f756aa0bea87d08de5f336eb4b724d0">NL_KEEP</a>;
<a name="l00742"></a>00742     }
<a name="l00743"></a>00743 
<a name="l00744"></a>00744     <span class="comment">/* Write the text node */</span>
<a name="l00745"></a>00745     <span class="keywordflow">switch</span> ( force_style )
<a name="l00746"></a>00746     {
<a name="l00747"></a>00747         <span class="keywordflow">case</span> <a class="code" href="../../de/dce/syck_8h.html#a80e0a63715fa32302da405e1585e2f31a4644440933345c1ac67c049d3b54c797">scalar_1quote</a>:
<a name="l00748"></a>00748             <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a0d862bf7ed7b2a435aa4e7f3bc98136b">syck_emit_1quoted</a>( e, force_width, str, len );
<a name="l00749"></a>00749         <span class="keywordflow">break</span>;
<a name="l00750"></a>00750 
<a name="l00751"></a>00751         <span class="keywordflow">case</span> <a class="code" href="../../de/dce/syck_8h.html#a80e0a63715fa32302da405e1585e2f31a91d800cf241e7dc19373dcbceb2c1c27">scalar_none</a>:
<a name="l00752"></a>00752         <span class="keywordflow">case</span> <a class="code" href="../../de/dce/syck_8h.html#a80e0a63715fa32302da405e1585e2f31a04ab6baa79414ba7ecc1add16c0bde61">scalar_2quote</a>:
<a name="l00753"></a>00753             <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a9b8082dd28e6e2b50ce77d9f56fafb90">syck_emit_2quoted</a>( e, force_width, str, len );
<a name="l00754"></a>00754         <span class="keywordflow">break</span>;
<a name="l00755"></a>00755 
<a name="l00756"></a>00756         <span class="keywordflow">case</span> <a class="code" href="../../de/dce/syck_8h.html#a80e0a63715fa32302da405e1585e2f31aec0a149f2467b0929ff58e5cd2e4dea2">scalar_fold</a>:
<a name="l00757"></a>00757             <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a5c33ad2f8d3a4e0a8cd59c23c5105dd5">syck_emit_folded</a>( e, force_width, keep_nl, str, len );
<a name="l00758"></a>00758         <span class="keywordflow">break</span>;
<a name="l00759"></a>00759 
<a name="l00760"></a>00760         <span class="keywordflow">case</span> <a class="code" href="../../de/dce/syck_8h.html#a80e0a63715fa32302da405e1585e2f31aef1d1e7c791267244aac19334646178b">scalar_literal</a>:
<a name="l00761"></a>00761             <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a1a3f23b525f91dcb95ff0cdfa225d516">syck_emit_literal</a>( e, keep_nl, str, len );
<a name="l00762"></a>00762         <span class="keywordflow">break</span>;
<a name="l00763"></a>00763 
<a name="l00764"></a>00764         <span class="keywordflow">case</span> <a class="code" href="../../de/dce/syck_8h.html#a80e0a63715fa32302da405e1585e2f31ad2d0da74e48550b9379d387ba4fc370b">scalar_plain</a>:
<a name="l00765"></a>00765             <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a251980c11ffad2f157e04ea6ee8dfa66">syck_emitter_write</a>( e, str, len );
<a name="l00766"></a>00766         <span class="keywordflow">break</span>;
<a name="l00767"></a>00767     }
<a name="l00768"></a>00768 
<a name="l00769"></a>00769     <span class="keywordflow">if</span> ( parent-&gt;<a class="code" href="../../dd/d0e/struct__syck__level.html#adc00a7ade66d407d9d00745e491c4d6c">status</a> == <a class="code" href="../../de/dce/syck_8h.html#a10af5e9a345d0e86156a336e91ff9f47a0b4728afa0a95f1f6acfd7f8d2c16716">syck_lvl_mapx</a> )
<a name="l00770"></a>00770     {
<a name="l00771"></a>00771         <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a251980c11ffad2f157e04ea6ee8dfa66">syck_emitter_write</a>( e, <span class="stringliteral">&quot;\n&quot;</span>, 1 );
<a name="l00772"></a>00772     }
<a name="l00773"></a>00773 }
<a name="l00774"></a>00774 
<a name="l00775"></a>00775 <span class="keywordtype">void</span>
<a name="l00776"></a><a class="code" href="../../de/dce/syck_8h.html#adea44d4587ebe5ad2692018b4c21a089">00776</a> <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a8efd953076eec47ad26c66f1e33b6571">syck_emitter_escape</a>( <a class="code" href="../../d8/df6/struct__syck__emitter.html">SyckEmitter</a> *e, <span class="keyword">const</span> <span class="keywordtype">char</span> *src, <span class="keywordtype">long</span> <a class="code" href="../../d3/d15/name2ctype_8h.html#aed1cc4dca5d94cb452f79691f54f7423">len</a> )
<a name="l00777"></a>00777 {
<a name="l00778"></a>00778     <span class="keywordtype">int</span> i;
<a name="l00779"></a>00779     <span class="keywordflow">for</span>( i = 0; i &lt; len; i++ )
<a name="l00780"></a>00780     {
<a name="l00781"></a>00781         <span class="keywordflow">if</span>( (src[i] &lt; 0x20) || (0x7E &lt; src[i]) )
<a name="l00782"></a>00782         {
<a name="l00783"></a>00783             <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a251980c11ffad2f157e04ea6ee8dfa66">syck_emitter_write</a>( e, <span class="stringliteral">&quot;\\&quot;</span>, 1 );
<a name="l00784"></a>00784             <span class="keywordflow">if</span>( <span class="charliteral">&apos;\0&apos;</span> == src[i] )
<a name="l00785"></a>00785                 <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a251980c11ffad2f157e04ea6ee8dfa66">syck_emitter_write</a>( e, <span class="stringliteral">&quot;0&quot;</span>, 1 );
<a name="l00786"></a>00786             <span class="keywordflow">else</span>
<a name="l00787"></a>00787             {
<a name="l00788"></a>00788                 <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a251980c11ffad2f157e04ea6ee8dfa66">syck_emitter_write</a>( e, <span class="stringliteral">&quot;x&quot;</span>, 1 );
<a name="l00789"></a>00789                 <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a251980c11ffad2f157e04ea6ee8dfa66">syck_emitter_write</a>( e, (<span class="keyword">const</span> <span class="keywordtype">char</span> *)<a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a1fd9aee3bb6a7695c79e6ec889022c60">hex_table</a> + ((src[i] &amp; 0xF0) &gt;&gt; 4), 1 );
<a name="l00790"></a>00790                 <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a251980c11ffad2f157e04ea6ee8dfa66">syck_emitter_write</a>( e, (<span class="keyword">const</span> <span class="keywordtype">char</span> *)<a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a1fd9aee3bb6a7695c79e6ec889022c60">hex_table</a> + (src[i] &amp; 0x0F), 1 );
<a name="l00791"></a>00791             }
<a name="l00792"></a>00792         }
<a name="l00793"></a>00793         <span class="keywordflow">else</span>
<a name="l00794"></a>00794         {
<a name="l00795"></a>00795             <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a251980c11ffad2f157e04ea6ee8dfa66">syck_emitter_write</a>( e, src + i, 1 );
<a name="l00796"></a>00796             <span class="keywordflow">if</span>( <span class="charliteral">&apos;\\&apos;</span> == src[i] )
<a name="l00797"></a>00797                 <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a251980c11ffad2f157e04ea6ee8dfa66">syck_emitter_write</a>( e, <span class="stringliteral">&quot;\\&quot;</span>, 1 );
<a name="l00798"></a>00798         }
<a name="l00799"></a>00799     }
<a name="l00800"></a>00800 }
<a name="l00801"></a>00801 
<a name="l00802"></a>00802 <span class="comment">/*</span>
<a name="l00803"></a>00803 <span class="comment"> * Outputs a single-quoted block.</span>
<a name="l00804"></a>00804 <span class="comment"> */</span>
<a name="l00805"></a>00805 <span class="keywordtype">void</span>
<a name="l00806"></a><a class="code" href="../../de/dce/syck_8h.html#ad4769d2d85f8a42ab97aab5b7de8dc0c">00806</a> <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a0d862bf7ed7b2a435aa4e7f3bc98136b">syck_emit_1quoted</a>( <a class="code" href="../../d8/df6/struct__syck__emitter.html">SyckEmitter</a> *e, <span class="keywordtype">int</span> width, <span class="keyword">const</span> <span class="keywordtype">char</span> *str, <span class="keywordtype">long</span> <a class="code" href="../../d3/d15/name2ctype_8h.html#aed1cc4dca5d94cb452f79691f54f7423">len</a> )
<a name="l00807"></a>00807 {
<a name="l00808"></a>00808     <span class="keywordtype">char</span> do_indent = 0;
<a name="l00809"></a>00809     <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../df/d3e/psych_2parser_8c.html#a3b414d8916ef55eb4bf7a05a5639883f">mark</a> = str;
<a name="l00810"></a>00810     <span class="keyword">const</span> <span class="keywordtype">char</span> *start = str;
<a name="l00811"></a>00811     <span class="keyword">const</span> <span class="keywordtype">char</span> *end = str;
<a name="l00812"></a>00812     <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a251980c11ffad2f157e04ea6ee8dfa66">syck_emitter_write</a>( e, <span class="stringliteral">&quot;&apos;&quot;</span>, 1 );
<a name="l00813"></a>00813     <span class="keywordflow">while</span> ( mark &lt; str + len ) {
<a name="l00814"></a>00814         <span class="keywordflow">if</span> ( do_indent ) {
<a name="l00815"></a>00815             <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a84635b690e68518e54670f7f4bf1cb47">syck_emit_indent</a>( e );
<a name="l00816"></a>00816             do_indent = 0;
<a name="l00817"></a>00817         }
<a name="l00818"></a>00818         <span class="keywordflow">switch</span> ( *mark ) {
<a name="l00819"></a>00819             <span class="keywordflow">case</span> <span class="charliteral">&apos;\&apos;&apos;</span>:  <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a251980c11ffad2f157e04ea6ee8dfa66">syck_emitter_write</a>( e, <span class="stringliteral">&quot;&apos;&quot;</span>, 1 ); <span class="keywordflow">break</span>;
<a name="l00820"></a>00820 
<a name="l00821"></a>00821             <span class="keywordflow">case</span> <span class="charliteral">&apos;\n&apos;</span>:
<a name="l00822"></a>00822                 end = mark + 1;
<a name="l00823"></a>00823                 <span class="keywordflow">if</span> ( *start != <span class="charliteral">&apos; &apos;</span> &amp;&amp; *start != <span class="charliteral">&apos;\n&apos;</span> &amp;&amp; *end != <span class="charliteral">&apos;\n&apos;</span> &amp;&amp; *end != <span class="charliteral">&apos; &apos;</span> ) {
<a name="l00824"></a>00824                     <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a251980c11ffad2f157e04ea6ee8dfa66">syck_emitter_write</a>( e, <span class="stringliteral">&quot;\n\n&quot;</span>, 2 );
<a name="l00825"></a>00825                 } <span class="keywordflow">else</span> {
<a name="l00826"></a>00826                     <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a251980c11ffad2f157e04ea6ee8dfa66">syck_emitter_write</a>( e, <span class="stringliteral">&quot;\n&quot;</span>, 1 );
<a name="l00827"></a>00827                 }
<a name="l00828"></a>00828                 do_indent = 1;
<a name="l00829"></a>00829                 start = mark + 1;
<a name="l00830"></a>00830             <span class="keywordflow">break</span>;
<a name="l00831"></a>00831 
<a name="l00832"></a>00832             <span class="keywordflow">case</span> <span class="charliteral">&apos; &apos;</span>:
<a name="l00833"></a>00833                 <span class="keywordflow">if</span> ( width &gt; 0 &amp;&amp; *start != <span class="charliteral">&apos; &apos;</span> &amp;&amp; mark - end &gt; width ) {
<a name="l00834"></a>00834                     do_indent = 1;
<a name="l00835"></a>00835                     end = mark + 1;
<a name="l00836"></a>00836                 } <span class="keywordflow">else</span> {
<a name="l00837"></a>00837                     <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a251980c11ffad2f157e04ea6ee8dfa66">syck_emitter_write</a>( e, <span class="stringliteral">&quot; &quot;</span>, 1 );
<a name="l00838"></a>00838                 }
<a name="l00839"></a>00839             <span class="keywordflow">break</span>;
<a name="l00840"></a>00840 
<a name="l00841"></a>00841             <span class="keywordflow">default</span>:
<a name="l00842"></a>00842                 <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a251980c11ffad2f157e04ea6ee8dfa66">syck_emitter_write</a>( e, mark, 1 );
<a name="l00843"></a>00843             <span class="keywordflow">break</span>;
<a name="l00844"></a>00844         }
<a name="l00845"></a>00845         mark++;
<a name="l00846"></a>00846     }
<a name="l00847"></a>00847     <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a251980c11ffad2f157e04ea6ee8dfa66">syck_emitter_write</a>( e, <span class="stringliteral">&quot;&apos;&quot;</span>, 1 );
<a name="l00848"></a>00848 }
<a name="l00849"></a>00849 
<a name="l00850"></a>00850 <span class="comment">/*</span>
<a name="l00851"></a>00851 <span class="comment"> * Outputs a double-quoted block.</span>
<a name="l00852"></a>00852 <span class="comment"> */</span>
<a name="l00853"></a>00853 <span class="keywordtype">void</span>
<a name="l00854"></a><a class="code" href="../../de/dce/syck_8h.html#addfcd79fadaf74d43c965676f7d60c02">00854</a> <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a9b8082dd28e6e2b50ce77d9f56fafb90">syck_emit_2quoted</a>( <a class="code" href="../../d8/df6/struct__syck__emitter.html">SyckEmitter</a> *e, <span class="keywordtype">int</span> width, <span class="keyword">const</span> <span class="keywordtype">char</span> *str, <span class="keywordtype">long</span> <a class="code" href="../../d3/d15/name2ctype_8h.html#aed1cc4dca5d94cb452f79691f54f7423">len</a> )
<a name="l00855"></a>00855 {
<a name="l00856"></a>00856     <span class="keywordtype">char</span> do_indent = 0;
<a name="l00857"></a>00857     <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../df/d3e/psych_2parser_8c.html#a3b414d8916ef55eb4bf7a05a5639883f">mark</a> = str;
<a name="l00858"></a>00858     <span class="keyword">const</span> <span class="keywordtype">char</span> *start = str;
<a name="l00859"></a>00859     <span class="keyword">const</span> <span class="keywordtype">char</span> *end = str;
<a name="l00860"></a>00860     <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a251980c11ffad2f157e04ea6ee8dfa66">syck_emitter_write</a>( e, <span class="stringliteral">&quot;\&quot;&quot;</span>, 1 );
<a name="l00861"></a>00861     <span class="keywordflow">while</span> ( mark &lt; str + len ) {
<a name="l00862"></a>00862         <span class="keywordflow">if</span> ( do_indent &gt; 0 ) {
<a name="l00863"></a>00863             <span class="keywordflow">if</span> ( do_indent == 2 ) {
<a name="l00864"></a>00864                 <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a251980c11ffad2f157e04ea6ee8dfa66">syck_emitter_write</a>( e, <span class="stringliteral">&quot;\\&quot;</span>, 1 );
<a name="l00865"></a>00865             }
<a name="l00866"></a>00866             <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a84635b690e68518e54670f7f4bf1cb47">syck_emit_indent</a>( e );
<a name="l00867"></a>00867             do_indent = 0;
<a name="l00868"></a>00868         }
<a name="l00869"></a>00869         <span class="keywordflow">switch</span> ( *mark ) {
<a name="l00870"></a>00870 
<a name="l00871"></a>00871             <span class="comment">/* Escape sequences allowed within double quotes. */</span>
<a name="l00872"></a>00872             <span class="keywordflow">case</span> <span class="charliteral">&apos;&quot;&apos;</span>:  <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a251980c11ffad2f157e04ea6ee8dfa66">syck_emitter_write</a>( e, <span class="stringliteral">&quot;\\\&quot;&quot;</span>, 2 ); <span class="keywordflow">break</span>;
<a name="l00873"></a>00873             <span class="keywordflow">case</span> <span class="charliteral">&apos;\\&apos;</span>: <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a251980c11ffad2f157e04ea6ee8dfa66">syck_emitter_write</a>( e, <span class="stringliteral">&quot;\\\\&quot;</span>, 2 ); <span class="keywordflow">break</span>;
<a name="l00874"></a>00874             <span class="keywordflow">case</span> <span class="charliteral">&apos;\0&apos;</span>: <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a251980c11ffad2f157e04ea6ee8dfa66">syck_emitter_write</a>( e, <span class="stringliteral">&quot;\\0&quot;</span>,  2 ); <span class="keywordflow">break</span>;
<a name="l00875"></a>00875             <span class="keywordflow">case</span> <span class="charliteral">&apos;\a&apos;</span>: <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a251980c11ffad2f157e04ea6ee8dfa66">syck_emitter_write</a>( e, <span class="stringliteral">&quot;\\a&quot;</span>,  2 ); <span class="keywordflow">break</span>;
<a name="l00876"></a>00876             <span class="keywordflow">case</span> <span class="charliteral">&apos;\b&apos;</span>: <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a251980c11ffad2f157e04ea6ee8dfa66">syck_emitter_write</a>( e, <span class="stringliteral">&quot;\\b&quot;</span>,  2 ); <span class="keywordflow">break</span>;
<a name="l00877"></a>00877             <span class="keywordflow">case</span> <span class="charliteral">&apos;\f&apos;</span>: <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a251980c11ffad2f157e04ea6ee8dfa66">syck_emitter_write</a>( e, <span class="stringliteral">&quot;\\f&quot;</span>,  2 ); <span class="keywordflow">break</span>;
<a name="l00878"></a>00878             <span class="keywordflow">case</span> <span class="charliteral">&apos;\r&apos;</span>: <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a251980c11ffad2f157e04ea6ee8dfa66">syck_emitter_write</a>( e, <span class="stringliteral">&quot;\\r&quot;</span>,  2 ); <span class="keywordflow">break</span>;
<a name="l00879"></a>00879             <span class="keywordflow">case</span> <span class="charliteral">&apos;\t&apos;</span>: <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a251980c11ffad2f157e04ea6ee8dfa66">syck_emitter_write</a>( e, <span class="stringliteral">&quot;\\t&quot;</span>,  2 ); <span class="keywordflow">break</span>;
<a name="l00880"></a>00880             <span class="keywordflow">case</span> <span class="charliteral">&apos;\v&apos;</span>: <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a251980c11ffad2f157e04ea6ee8dfa66">syck_emitter_write</a>( e, <span class="stringliteral">&quot;\\v&quot;</span>,  2 ); <span class="keywordflow">break</span>;
<a name="l00881"></a>00881             <span class="keywordflow">case</span> 0x1b: <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a251980c11ffad2f157e04ea6ee8dfa66">syck_emitter_write</a>( e, <span class="stringliteral">&quot;\\e&quot;</span>,  2 ); <span class="keywordflow">break</span>;
<a name="l00882"></a>00882 
<a name="l00883"></a>00883             <span class="keywordflow">case</span> <span class="charliteral">&apos;\n&apos;</span>:
<a name="l00884"></a>00884                 end = mark + 1;
<a name="l00885"></a>00885                 <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a251980c11ffad2f157e04ea6ee8dfa66">syck_emitter_write</a>( e, <span class="stringliteral">&quot;\\n&quot;</span>, 2 );
<a name="l00886"></a>00886                 do_indent = 2;
<a name="l00887"></a>00887                 start = mark + 1;
<a name="l00888"></a>00888                 <span class="keywordflow">if</span> ( start &lt; str + len &amp;&amp; ( *start == <span class="charliteral">&apos; &apos;</span> || *start == <span class="charliteral">&apos;\n&apos;</span> ) ) {
<a name="l00889"></a>00889                     do_indent = 0;
<a name="l00890"></a>00890                 }
<a name="l00891"></a>00891             <span class="keywordflow">break</span>;
<a name="l00892"></a>00892 
<a name="l00893"></a>00893             <span class="keywordflow">case</span> <span class="charliteral">&apos; &apos;</span>:
<a name="l00894"></a>00894                 <span class="keywordflow">if</span> ( width &gt; 0 &amp;&amp; *start != <span class="charliteral">&apos; &apos;</span> &amp;&amp; mark - end &gt; width ) {
<a name="l00895"></a>00895                     do_indent = 1;
<a name="l00896"></a>00896                     end = mark + 1;
<a name="l00897"></a>00897                 } <span class="keywordflow">else</span> {
<a name="l00898"></a>00898                     <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a251980c11ffad2f157e04ea6ee8dfa66">syck_emitter_write</a>( e, <span class="stringliteral">&quot; &quot;</span>, 1 );
<a name="l00899"></a>00899                 }
<a name="l00900"></a>00900             <span class="keywordflow">break</span>;
<a name="l00901"></a>00901 
<a name="l00902"></a>00902             <span class="keywordflow">default</span>:
<a name="l00903"></a>00903                 <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a8efd953076eec47ad26c66f1e33b6571">syck_emitter_escape</a>( e, mark, 1 );
<a name="l00904"></a>00904             <span class="keywordflow">break</span>;
<a name="l00905"></a>00905         }
<a name="l00906"></a>00906         mark++;
<a name="l00907"></a>00907     }
<a name="l00908"></a>00908     <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a251980c11ffad2f157e04ea6ee8dfa66">syck_emitter_write</a>( e, <span class="stringliteral">&quot;\&quot;&quot;</span>, 1 );
<a name="l00909"></a>00909 }
<a name="l00910"></a>00910 
<a name="l00911"></a>00911 <span class="comment">/*</span>
<a name="l00912"></a>00912 <span class="comment"> * Outputs a literal block.</span>
<a name="l00913"></a>00913 <span class="comment"> */</span>
<a name="l00914"></a>00914 <span class="keywordtype">void</span>
<a name="l00915"></a><a class="code" href="../../de/dce/syck_8h.html#ab6294a0fd4d2905514799a4ac4888446">00915</a> <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a1a3f23b525f91dcb95ff0cdfa225d516">syck_emit_literal</a>( <a class="code" href="../../d8/df6/struct__syck__emitter.html">SyckEmitter</a> *e, <span class="keywordtype">char</span> keep_nl, <span class="keyword">const</span> <span class="keywordtype">char</span> *str, <span class="keywordtype">long</span> <a class="code" href="../../d3/d15/name2ctype_8h.html#aed1cc4dca5d94cb452f79691f54f7423">len</a> )
<a name="l00916"></a>00916 {
<a name="l00917"></a>00917     <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../df/d3e/psych_2parser_8c.html#a3b414d8916ef55eb4bf7a05a5639883f">mark</a> = str;
<a name="l00918"></a>00918     <span class="keyword">const</span> <span class="keywordtype">char</span> *start = str;
<a name="l00919"></a>00919     <span class="keyword">const</span> <span class="keywordtype">char</span> *end = str;
<a name="l00920"></a>00920     <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a251980c11ffad2f157e04ea6ee8dfa66">syck_emitter_write</a>( e, <span class="stringliteral">&quot;|&quot;</span>, 1 );
<a name="l00921"></a>00921     <span class="keywordflow">if</span> ( keep_nl == <a class="code" href="../../de/dce/syck_8h.html#acd1f2c925deccdc97b77b5c14880128b">NL_CHOMP</a> ) {
<a name="l00922"></a>00922         <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a251980c11ffad2f157e04ea6ee8dfa66">syck_emitter_write</a>( e, <span class="stringliteral">&quot;-&quot;</span>, 1 );
<a name="l00923"></a>00923     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( keep_nl == <a class="code" href="../../de/dce/syck_8h.html#a2f756aa0bea87d08de5f336eb4b724d0">NL_KEEP</a> ) {
<a name="l00924"></a>00924         <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a251980c11ffad2f157e04ea6ee8dfa66">syck_emitter_write</a>( e, <span class="stringliteral">&quot;+&quot;</span>, 1 );
<a name="l00925"></a>00925     }
<a name="l00926"></a>00926     <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a84635b690e68518e54670f7f4bf1cb47">syck_emit_indent</a>( e );
<a name="l00927"></a>00927     <span class="keywordflow">while</span> ( mark &lt; str + len ) {
<a name="l00928"></a>00928         <span class="keywordflow">if</span> ( *mark == <span class="charliteral">&apos;\n&apos;</span> ) {
<a name="l00929"></a>00929             end = mark;
<a name="l00930"></a>00930             <span class="keywordflow">if</span> ( *start != <span class="charliteral">&apos; &apos;</span> &amp;&amp; *start != <span class="charliteral">&apos;\n&apos;</span> &amp;&amp; *end != <span class="charliteral">&apos;\n&apos;</span> &amp;&amp; *end != <span class="charliteral">&apos; &apos;</span> ) end += 1;
<a name="l00931"></a>00931             <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a251980c11ffad2f157e04ea6ee8dfa66">syck_emitter_write</a>( e, start, end - start );
<a name="l00932"></a>00932             <span class="keywordflow">if</span> ( mark + 1 == str + len ) {
<a name="l00933"></a>00933                 <span class="keywordflow">if</span> ( keep_nl != <a class="code" href="../../de/dce/syck_8h.html#a2f756aa0bea87d08de5f336eb4b724d0">NL_KEEP</a> ) <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a251980c11ffad2f157e04ea6ee8dfa66">syck_emitter_write</a>( e, <span class="stringliteral">&quot;\n&quot;</span>, 1 );
<a name="l00934"></a>00934             } <span class="keywordflow">else</span> {
<a name="l00935"></a>00935                 <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a84635b690e68518e54670f7f4bf1cb47">syck_emit_indent</a>( e );
<a name="l00936"></a>00936             }
<a name="l00937"></a>00937             start = mark + 1;
<a name="l00938"></a>00938         }
<a name="l00939"></a>00939         mark++;
<a name="l00940"></a>00940     }
<a name="l00941"></a>00941     end = str + len;
<a name="l00942"></a>00942     <span class="keywordflow">if</span> ( start &lt; end ) {
<a name="l00943"></a>00943         <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a251980c11ffad2f157e04ea6ee8dfa66">syck_emitter_write</a>( e, start, end - start );
<a name="l00944"></a>00944     }
<a name="l00945"></a>00945 }
<a name="l00946"></a>00946 
<a name="l00947"></a>00947 <span class="comment">/*</span>
<a name="l00948"></a>00948 <span class="comment"> * Outputs a folded block.</span>
<a name="l00949"></a>00949 <span class="comment"> */</span>
<a name="l00950"></a>00950 <span class="keywordtype">void</span>
<a name="l00951"></a><a class="code" href="../../de/dce/syck_8h.html#ad360024279e68d57026ba765255d4b77">00951</a> <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a5c33ad2f8d3a4e0a8cd59c23c5105dd5">syck_emit_folded</a>( <a class="code" href="../../d8/df6/struct__syck__emitter.html">SyckEmitter</a> *e, <span class="keywordtype">int</span> width, <span class="keywordtype">char</span> keep_nl, <span class="keyword">const</span> <span class="keywordtype">char</span> *str, <span class="keywordtype">long</span> <a class="code" href="../../d3/d15/name2ctype_8h.html#aed1cc4dca5d94cb452f79691f54f7423">len</a> )
<a name="l00952"></a>00952 {
<a name="l00953"></a>00953     <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../df/d3e/psych_2parser_8c.html#a3b414d8916ef55eb4bf7a05a5639883f">mark</a> = str;
<a name="l00954"></a>00954     <span class="keyword">const</span> <span class="keywordtype">char</span> *start = str;
<a name="l00955"></a>00955     <span class="keyword">const</span> <span class="keywordtype">char</span> *end = str;
<a name="l00956"></a>00956     <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a251980c11ffad2f157e04ea6ee8dfa66">syck_emitter_write</a>( e, <span class="stringliteral">&quot;&gt;&quot;</span>, 1 );
<a name="l00957"></a>00957     <span class="keywordflow">if</span> ( keep_nl == <a class="code" href="../../de/dce/syck_8h.html#acd1f2c925deccdc97b77b5c14880128b">NL_CHOMP</a> ) {
<a name="l00958"></a>00958         <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a251980c11ffad2f157e04ea6ee8dfa66">syck_emitter_write</a>( e, <span class="stringliteral">&quot;-&quot;</span>, 1 );
<a name="l00959"></a>00959     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( keep_nl == <a class="code" href="../../de/dce/syck_8h.html#a2f756aa0bea87d08de5f336eb4b724d0">NL_KEEP</a> ) {
<a name="l00960"></a>00960         <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a251980c11ffad2f157e04ea6ee8dfa66">syck_emitter_write</a>( e, <span class="stringliteral">&quot;+&quot;</span>, 1 );
<a name="l00961"></a>00961     }
<a name="l00962"></a>00962     <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a84635b690e68518e54670f7f4bf1cb47">syck_emit_indent</a>( e );
<a name="l00963"></a>00963     <span class="keywordflow">if</span> ( width &lt;= 0 ) width = e-&gt;<a class="code" href="../../d8/df6/struct__syck__emitter.html#a23c54040a81c39d90489250ce66fd3cf">best_width</a>;
<a name="l00964"></a>00964     <span class="keywordflow">while</span> ( mark &lt; str + len ) {
<a name="l00965"></a>00965         <span class="keywordflow">switch</span> ( *mark ) {
<a name="l00966"></a>00966             <span class="keywordflow">case</span> <span class="charliteral">&apos;\n&apos;</span>:
<a name="l00967"></a>00967                 <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a251980c11ffad2f157e04ea6ee8dfa66">syck_emitter_write</a>( e, end, mark - end );
<a name="l00968"></a>00968                 end = mark + 1;
<a name="l00969"></a>00969                 <span class="keywordflow">if</span> ( *start != <span class="charliteral">&apos; &apos;</span> &amp;&amp; *start != <span class="charliteral">&apos;\n&apos;</span> &amp;&amp; *end != <span class="charliteral">&apos;\n&apos;</span> &amp;&amp; *end != <span class="charliteral">&apos; &apos;</span> ) {
<a name="l00970"></a>00970                     <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a251980c11ffad2f157e04ea6ee8dfa66">syck_emitter_write</a>( e, <span class="stringliteral">&quot;\n&quot;</span>, 1 );
<a name="l00971"></a>00971                 }
<a name="l00972"></a>00972                 <span class="keywordflow">if</span> ( mark + 1 == str + len ) {
<a name="l00973"></a>00973                     <span class="keywordflow">if</span> ( keep_nl != <a class="code" href="../../de/dce/syck_8h.html#a2f756aa0bea87d08de5f336eb4b724d0">NL_KEEP</a> ) <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a251980c11ffad2f157e04ea6ee8dfa66">syck_emitter_write</a>( e, <span class="stringliteral">&quot;\n&quot;</span>, 1 );
<a name="l00974"></a>00974                 } <span class="keywordflow">else</span> {
<a name="l00975"></a>00975                     <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a84635b690e68518e54670f7f4bf1cb47">syck_emit_indent</a>( e );
<a name="l00976"></a>00976                 }
<a name="l00977"></a>00977                 start = mark + 1;
<a name="l00978"></a>00978             <span class="keywordflow">break</span>;
<a name="l00979"></a>00979 
<a name="l00980"></a>00980             <span class="keywordflow">case</span> <span class="charliteral">&apos; &apos;</span>:
<a name="l00981"></a>00981                 <span class="keywordflow">if</span> ( *start != <span class="charliteral">&apos; &apos;</span> ) {
<a name="l00982"></a>00982                     <span class="keywordflow">if</span> ( mark - end &gt; width ) {
<a name="l00983"></a>00983                         <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a251980c11ffad2f157e04ea6ee8dfa66">syck_emitter_write</a>( e, end, mark - end );
<a name="l00984"></a>00984                         <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a84635b690e68518e54670f7f4bf1cb47">syck_emit_indent</a>( e );
<a name="l00985"></a>00985                         end = mark + 1;
<a name="l00986"></a>00986                     }
<a name="l00987"></a>00987                 }
<a name="l00988"></a>00988             <span class="keywordflow">break</span>;
<a name="l00989"></a>00989         }
<a name="l00990"></a>00990         mark++;
<a name="l00991"></a>00991     }
<a name="l00992"></a>00992     <span class="keywordflow">if</span> ( end &lt; mark ) {
<a name="l00993"></a>00993         <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a251980c11ffad2f157e04ea6ee8dfa66">syck_emitter_write</a>( e, end, mark - end );
<a name="l00994"></a>00994     }
<a name="l00995"></a>00995 }
<a name="l00996"></a>00996 
<a name="l00997"></a>00997 <span class="comment">/*</span>
<a name="l00998"></a>00998 <span class="comment"> * Begins emission of a sequence.</span>
<a name="l00999"></a>00999 <span class="comment"> */</span>
<a name="l01000"></a><a class="code" href="../../de/dce/syck_8h.html#ae31fd870f4cfa61265cec237ed63aee8">01000</a> <span class="keywordtype">void</span> <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a4f21706a140c4315f3b9f97dfda2701f">syck_emit_seq</a>( <a class="code" href="../../d8/df6/struct__syck__emitter.html">SyckEmitter</a> *e, <span class="keyword">const</span> <span class="keywordtype">char</span> *tag, <span class="keyword">enum</span> <a class="code" href="../../de/dce/syck_8h.html#a728947932efde8ceab03041ca325ee9d">seq_style</a> style )
<a name="l01001"></a>01001 {
<a name="l01002"></a>01002     <a class="code" href="../../dd/d0e/struct__syck__level.html">SyckLevel</a> *parent = <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a35436ae22a44347661a8bb282d9ef744">syck_emitter_parent_level</a>( e );
<a name="l01003"></a>01003     <a class="code" href="../../dd/d0e/struct__syck__level.html">SyckLevel</a> *lvl = <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a5f9693ef17bdeacaa7afd778a29cb919">syck_emitter_current_level</a>( e );
<a name="l01004"></a>01004     <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a9d213f5296217ed7f2bfef25267ab499">syck_emit_tag</a>( e, tag, <span class="stringliteral">&quot;tag:yaml.org,2002:seq&quot;</span> );
<a name="l01005"></a>01005     <span class="keywordflow">if</span> ( style == <a class="code" href="../../de/dce/syck_8h.html#a728947932efde8ceab03041ca325ee9dad6ab253d3e9d8d2b864e5dec9dc3a0ba">seq_inline</a> || ( parent-&gt;<a class="code" href="../../dd/d0e/struct__syck__level.html#adc00a7ade66d407d9d00745e491c4d6c">status</a> == <a class="code" href="../../de/dce/syck_8h.html#a10af5e9a345d0e86156a336e91ff9f47a65beb407005776a7a575da4dd9b65a65">syck_lvl_imap</a> || parent-&gt;<a class="code" href="../../dd/d0e/struct__syck__level.html#adc00a7ade66d407d9d00745e491c4d6c">status</a> == <a class="code" href="../../de/dce/syck_8h.html#a10af5e9a345d0e86156a336e91ff9f47a90bc43e019e7e4c3d41f6d4ab92d1a6b">syck_lvl_iseq</a> ) ) {
<a name="l01006"></a>01006         <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a251980c11ffad2f157e04ea6ee8dfa66">syck_emitter_write</a>( e, <span class="stringliteral">&quot;[&quot;</span>, 1 );
<a name="l01007"></a>01007         lvl-&gt;<a class="code" href="../../dd/d0e/struct__syck__level.html#adc00a7ade66d407d9d00745e491c4d6c">status</a> = <a class="code" href="../../de/dce/syck_8h.html#a10af5e9a345d0e86156a336e91ff9f47a90bc43e019e7e4c3d41f6d4ab92d1a6b">syck_lvl_iseq</a>;
<a name="l01008"></a>01008     } <span class="keywordflow">else</span> {
<a name="l01009"></a>01009         <span class="comment">/* complex key */</span>
<a name="l01010"></a>01010         <span class="keywordflow">if</span> ( parent-&gt;<a class="code" href="../../dd/d0e/struct__syck__level.html#adc00a7ade66d407d9d00745e491c4d6c">status</a> == <a class="code" href="../../de/dce/syck_8h.html#a10af5e9a345d0e86156a336e91ff9f47a193976ec9cc4f9ee296a851e5f03c4f8">syck_lvl_map</a> &amp;&amp; parent-&gt;<a class="code" href="../../dd/d0e/struct__syck__level.html#afa7cc05334cbd8dbe1367d9de134c8ab">ncount</a> % 2 == 1 ) {
<a name="l01011"></a>01011             <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a251980c11ffad2f157e04ea6ee8dfa66">syck_emitter_write</a>( e, <span class="stringliteral">&quot;? &quot;</span>, 2 );
<a name="l01012"></a>01012             parent-&gt;<a class="code" href="../../dd/d0e/struct__syck__level.html#adc00a7ade66d407d9d00745e491c4d6c">status</a> = <a class="code" href="../../de/dce/syck_8h.html#a10af5e9a345d0e86156a336e91ff9f47a0b4728afa0a95f1f6acfd7f8d2c16716">syck_lvl_mapx</a>;
<a name="l01013"></a>01013         }
<a name="l01014"></a>01014         lvl-&gt;<a class="code" href="../../dd/d0e/struct__syck__level.html#adc00a7ade66d407d9d00745e491c4d6c">status</a> = <a class="code" href="../../de/dce/syck_8h.html#a10af5e9a345d0e86156a336e91ff9f47a8cf827bb42699b875e1f8db92e8d85b9">syck_lvl_seq</a>;
<a name="l01015"></a>01015     }
<a name="l01016"></a>01016 }
<a name="l01017"></a>01017 
<a name="l01018"></a>01018 <span class="comment">/*</span>
<a name="l01019"></a>01019 <span class="comment"> * Begins emission of a mapping.</span>
<a name="l01020"></a>01020 <span class="comment"> */</span>
<a name="l01021"></a>01021 <span class="keywordtype">void</span>
<a name="l01022"></a><a class="code" href="../../de/dce/syck_8h.html#abce13443b05e4b8d68d3dae29dcd4f76">01022</a> <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a5ecc4f5ae062a81ecd2c496ef916964f">syck_emit_map</a>( <a class="code" href="../../d8/df6/struct__syck__emitter.html">SyckEmitter</a> *e, <span class="keyword">const</span> <span class="keywordtype">char</span> *tag, <span class="keyword">enum</span> <a class="code" href="../../de/dce/syck_8h.html#a88ea97c28ee285179a77bf102cec13fb">map_style</a> style )
<a name="l01023"></a>01023 {
<a name="l01024"></a>01024     <a class="code" href="../../dd/d0e/struct__syck__level.html">SyckLevel</a> *parent = <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a35436ae22a44347661a8bb282d9ef744">syck_emitter_parent_level</a>( e );
<a name="l01025"></a>01025     <a class="code" href="../../dd/d0e/struct__syck__level.html">SyckLevel</a> *lvl = <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a5f9693ef17bdeacaa7afd778a29cb919">syck_emitter_current_level</a>( e );
<a name="l01026"></a>01026     <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a9d213f5296217ed7f2bfef25267ab499">syck_emit_tag</a>( e, tag, <span class="stringliteral">&quot;tag:yaml.org,2002:map&quot;</span> );
<a name="l01027"></a>01027     <span class="keywordflow">if</span> ( style == <a class="code" href="../../de/dce/syck_8h.html#a88ea97c28ee285179a77bf102cec13fba6d4a58f471d305293f361dda7fe33808">map_inline</a> || ( parent-&gt;<a class="code" href="../../dd/d0e/struct__syck__level.html#adc00a7ade66d407d9d00745e491c4d6c">status</a> == <a class="code" href="../../de/dce/syck_8h.html#a10af5e9a345d0e86156a336e91ff9f47a65beb407005776a7a575da4dd9b65a65">syck_lvl_imap</a> || parent-&gt;<a class="code" href="../../dd/d0e/struct__syck__level.html#adc00a7ade66d407d9d00745e491c4d6c">status</a> == <a class="code" href="../../de/dce/syck_8h.html#a10af5e9a345d0e86156a336e91ff9f47a90bc43e019e7e4c3d41f6d4ab92d1a6b">syck_lvl_iseq</a> ) ) {
<a name="l01028"></a>01028         <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a251980c11ffad2f157e04ea6ee8dfa66">syck_emitter_write</a>( e, <span class="stringliteral">&quot;{&quot;</span>, 1 );
<a name="l01029"></a>01029         lvl-&gt;<a class="code" href="../../dd/d0e/struct__syck__level.html#adc00a7ade66d407d9d00745e491c4d6c">status</a> = <a class="code" href="../../de/dce/syck_8h.html#a10af5e9a345d0e86156a336e91ff9f47a65beb407005776a7a575da4dd9b65a65">syck_lvl_imap</a>;
<a name="l01030"></a>01030     } <span class="keywordflow">else</span> {
<a name="l01031"></a>01031         <span class="comment">/* complex key */</span>
<a name="l01032"></a>01032         <span class="keywordflow">if</span> ( parent-&gt;<a class="code" href="../../dd/d0e/struct__syck__level.html#adc00a7ade66d407d9d00745e491c4d6c">status</a> == <a class="code" href="../../de/dce/syck_8h.html#a10af5e9a345d0e86156a336e91ff9f47a193976ec9cc4f9ee296a851e5f03c4f8">syck_lvl_map</a> &amp;&amp; parent-&gt;<a class="code" href="../../dd/d0e/struct__syck__level.html#afa7cc05334cbd8dbe1367d9de134c8ab">ncount</a> % 2 == 1 ) {
<a name="l01033"></a>01033             <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a251980c11ffad2f157e04ea6ee8dfa66">syck_emitter_write</a>( e, <span class="stringliteral">&quot;? &quot;</span>, 2 );
<a name="l01034"></a>01034             parent-&gt;<a class="code" href="../../dd/d0e/struct__syck__level.html#adc00a7ade66d407d9d00745e491c4d6c">status</a> = <a class="code" href="../../de/dce/syck_8h.html#a10af5e9a345d0e86156a336e91ff9f47a0b4728afa0a95f1f6acfd7f8d2c16716">syck_lvl_mapx</a>;
<a name="l01035"></a>01035         }
<a name="l01036"></a>01036         lvl-&gt;<a class="code" href="../../dd/d0e/struct__syck__level.html#adc00a7ade66d407d9d00745e491c4d6c">status</a> = <a class="code" href="../../de/dce/syck_8h.html#a10af5e9a345d0e86156a336e91ff9f47a193976ec9cc4f9ee296a851e5f03c4f8">syck_lvl_map</a>;
<a name="l01037"></a>01037     }
<a name="l01038"></a>01038 }
<a name="l01039"></a>01039 
<a name="l01040"></a>01040 <span class="comment">/*</span>
<a name="l01041"></a>01041 <span class="comment"> * Handles emitting of a collection item (for both</span>
<a name="l01042"></a>01042 <span class="comment"> * sequences and maps)</span>
<a name="l01043"></a>01043 <span class="comment"> */</span>
<a name="l01044"></a><a class="code" href="../../de/dce/syck_8h.html#a57e7c150fdab9dafe5fa989b33f75820">01044</a> <span class="keywordtype">void</span> <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a9d05a1c46c573f702a27e936b295b63a">syck_emit_item</a>( <a class="code" href="../../d8/df6/struct__syck__emitter.html">SyckEmitter</a> *e, <a class="code" href="../../de/dce/syck_8h.html#a8a45dfe133c1fd041e1b902bda9e43e8">st_data_t</a> n )
<a name="l01045"></a>01045 {
<a name="l01046"></a>01046     <a class="code" href="../../dd/d0e/struct__syck__level.html">SyckLevel</a> *lvl = <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a5f9693ef17bdeacaa7afd778a29cb919">syck_emitter_current_level</a>( e );
<a name="l01047"></a>01047     <span class="keywordflow">switch</span> ( lvl-&gt;<a class="code" href="../../dd/d0e/struct__syck__level.html#adc00a7ade66d407d9d00745e491c4d6c">status</a> )
<a name="l01048"></a>01048     {
<a name="l01049"></a>01049         <span class="keywordflow">case</span> <a class="code" href="../../de/dce/syck_8h.html#a10af5e9a345d0e86156a336e91ff9f47a8cf827bb42699b875e1f8db92e8d85b9">syck_lvl_seq</a>:
<a name="l01050"></a>01050         {
<a name="l01051"></a>01051             <a class="code" href="../../dd/d0e/struct__syck__level.html">SyckLevel</a> *parent = <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a35436ae22a44347661a8bb282d9ef744">syck_emitter_parent_level</a>( e );
<a name="l01052"></a>01052 
<a name="l01053"></a>01053             <span class="comment">/* seq-in-map shortcut -- the lvl-&gt;anctag check should be unneccesary but</span>
<a name="l01054"></a>01054 <span class="comment">             * there is a nasty shift/reduce in the parser on this point and</span>
<a name="l01055"></a>01055 <span class="comment">             * i&apos;m not ready to tickle it. */</span>
<a name="l01056"></a>01056             <span class="keywordflow">if</span> ( lvl-&gt;<a class="code" href="../../dd/d0e/struct__syck__level.html#aa2b1e34c2e0e92f8ea8775278ed6c9c6">anctag</a> == 0 &amp;&amp; parent-&gt;<a class="code" href="../../dd/d0e/struct__syck__level.html#adc00a7ade66d407d9d00745e491c4d6c">status</a> == <a class="code" href="../../de/dce/syck_8h.html#a10af5e9a345d0e86156a336e91ff9f47a193976ec9cc4f9ee296a851e5f03c4f8">syck_lvl_map</a> &amp;&amp; lvl-&gt;<a class="code" href="../../dd/d0e/struct__syck__level.html#afa7cc05334cbd8dbe1367d9de134c8ab">ncount</a> == 0 ) {
<a name="l01057"></a>01057                 lvl-&gt;<a class="code" href="../../dd/d0e/struct__syck__level.html#a401e3fc67c4f33f8535cd3ec26fdb87d">spaces</a> = parent-&gt;<a class="code" href="../../dd/d0e/struct__syck__level.html#a401e3fc67c4f33f8535cd3ec26fdb87d">spaces</a>;
<a name="l01058"></a>01058             }
<a name="l01059"></a>01059 
<a name="l01060"></a>01060             <span class="comment">/* seq-in-seq shortcut */</span>
<a name="l01061"></a>01061             <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( lvl-&gt;<a class="code" href="../../dd/d0e/struct__syck__level.html#aa2b1e34c2e0e92f8ea8775278ed6c9c6">anctag</a> == 0 &amp;&amp; parent-&gt;<a class="code" href="../../dd/d0e/struct__syck__level.html#adc00a7ade66d407d9d00745e491c4d6c">status</a> == <a class="code" href="../../de/dce/syck_8h.html#a10af5e9a345d0e86156a336e91ff9f47a8cf827bb42699b875e1f8db92e8d85b9">syck_lvl_seq</a> &amp;&amp; lvl-&gt;<a class="code" href="../../dd/d0e/struct__syck__level.html#afa7cc05334cbd8dbe1367d9de134c8ab">ncount</a> == 0 ) {
<a name="l01062"></a>01062                 <span class="keywordtype">int</span> spcs = ( lvl-&gt;<a class="code" href="../../dd/d0e/struct__syck__level.html#a401e3fc67c4f33f8535cd3ec26fdb87d">spaces</a> - parent-&gt;<a class="code" href="../../dd/d0e/struct__syck__level.html#a401e3fc67c4f33f8535cd3ec26fdb87d">spaces</a> ) - 2;
<a name="l01063"></a>01063                 <span class="keywordflow">if</span> ( spcs &gt;= 0 ) {
<a name="l01064"></a>01064                     <span class="keywordtype">int</span> i = 0;
<a name="l01065"></a>01065                     <span class="keywordflow">for</span> ( i = 0; i &lt; spcs; i++ ) {
<a name="l01066"></a>01066                         <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a251980c11ffad2f157e04ea6ee8dfa66">syck_emitter_write</a>( e, <span class="stringliteral">&quot; &quot;</span>, 1 );
<a name="l01067"></a>01067                     }
<a name="l01068"></a>01068                     <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a251980c11ffad2f157e04ea6ee8dfa66">syck_emitter_write</a>( e, <span class="stringliteral">&quot;- &quot;</span>, 2 );
<a name="l01069"></a>01069                     <span class="keywordflow">break</span>;
<a name="l01070"></a>01070                 }
<a name="l01071"></a>01071             }
<a name="l01072"></a>01072 
<a name="l01073"></a>01073             <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a84635b690e68518e54670f7f4bf1cb47">syck_emit_indent</a>( e );
<a name="l01074"></a>01074             <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a251980c11ffad2f157e04ea6ee8dfa66">syck_emitter_write</a>( e, <span class="stringliteral">&quot;- &quot;</span>, 2 );
<a name="l01075"></a>01075         }
<a name="l01076"></a>01076         <span class="keywordflow">break</span>;
<a name="l01077"></a>01077 
<a name="l01078"></a>01078         <span class="keywordflow">case</span> <a class="code" href="../../de/dce/syck_8h.html#a10af5e9a345d0e86156a336e91ff9f47a90bc43e019e7e4c3d41f6d4ab92d1a6b">syck_lvl_iseq</a>:
<a name="l01079"></a>01079         {
<a name="l01080"></a>01080             <span class="keywordflow">if</span> ( lvl-&gt;<a class="code" href="../../dd/d0e/struct__syck__level.html#afa7cc05334cbd8dbe1367d9de134c8ab">ncount</a> &gt; 0 ) {
<a name="l01081"></a>01081                 <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a251980c11ffad2f157e04ea6ee8dfa66">syck_emitter_write</a>( e, <span class="stringliteral">&quot;, &quot;</span>, 2 );
<a name="l01082"></a>01082             }
<a name="l01083"></a>01083         }
<a name="l01084"></a>01084         <span class="keywordflow">break</span>;
<a name="l01085"></a>01085 
<a name="l01086"></a>01086         <span class="keywordflow">case</span> <a class="code" href="../../de/dce/syck_8h.html#a10af5e9a345d0e86156a336e91ff9f47a193976ec9cc4f9ee296a851e5f03c4f8">syck_lvl_map</a>:
<a name="l01087"></a>01087         {
<a name="l01088"></a>01088             <a class="code" href="../../dd/d0e/struct__syck__level.html">SyckLevel</a> *parent = <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a35436ae22a44347661a8bb282d9ef744">syck_emitter_parent_level</a>( e );
<a name="l01089"></a>01089 
<a name="l01090"></a>01090             <span class="comment">/* map-in-seq shortcut */</span>
<a name="l01091"></a>01091             <span class="keywordflow">if</span> ( lvl-&gt;<a class="code" href="../../dd/d0e/struct__syck__level.html#aa2b1e34c2e0e92f8ea8775278ed6c9c6">anctag</a> == 0 &amp;&amp; parent-&gt;<a class="code" href="../../dd/d0e/struct__syck__level.html#adc00a7ade66d407d9d00745e491c4d6c">status</a> == <a class="code" href="../../de/dce/syck_8h.html#a10af5e9a345d0e86156a336e91ff9f47a8cf827bb42699b875e1f8db92e8d85b9">syck_lvl_seq</a> &amp;&amp; lvl-&gt;<a class="code" href="../../dd/d0e/struct__syck__level.html#afa7cc05334cbd8dbe1367d9de134c8ab">ncount</a> == 0 ) {
<a name="l01092"></a>01092                 <span class="keywordtype">int</span> spcs = ( lvl-&gt;<a class="code" href="../../dd/d0e/struct__syck__level.html#a401e3fc67c4f33f8535cd3ec26fdb87d">spaces</a> - parent-&gt;<a class="code" href="../../dd/d0e/struct__syck__level.html#a401e3fc67c4f33f8535cd3ec26fdb87d">spaces</a> ) - 2;
<a name="l01093"></a>01093                 <span class="keywordflow">if</span> ( spcs &gt;= 0 ) {
<a name="l01094"></a>01094                     <span class="keywordtype">int</span> i = 0;
<a name="l01095"></a>01095                     <span class="keywordflow">for</span> ( i = 0; i &lt; spcs; i++ ) {
<a name="l01096"></a>01096                         <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a251980c11ffad2f157e04ea6ee8dfa66">syck_emitter_write</a>( e, <span class="stringliteral">&quot; &quot;</span>, 1 );
<a name="l01097"></a>01097                     }
<a name="l01098"></a>01098                     <span class="keywordflow">break</span>;
<a name="l01099"></a>01099                 }
<a name="l01100"></a>01100             }
<a name="l01101"></a>01101 
<a name="l01102"></a>01102             <span class="keywordflow">if</span> ( lvl-&gt;<a class="code" href="../../dd/d0e/struct__syck__level.html#afa7cc05334cbd8dbe1367d9de134c8ab">ncount</a> % 2 == 0 ) {
<a name="l01103"></a>01103                 <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a84635b690e68518e54670f7f4bf1cb47">syck_emit_indent</a>( e );
<a name="l01104"></a>01104             } <span class="keywordflow">else</span> {
<a name="l01105"></a>01105                 <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a251980c11ffad2f157e04ea6ee8dfa66">syck_emitter_write</a>( e, <span class="stringliteral">&quot;: &quot;</span>, 2 );
<a name="l01106"></a>01106             }
<a name="l01107"></a>01107         }
<a name="l01108"></a>01108         <span class="keywordflow">break</span>;
<a name="l01109"></a>01109 
<a name="l01110"></a>01110         <span class="keywordflow">case</span> <a class="code" href="../../de/dce/syck_8h.html#a10af5e9a345d0e86156a336e91ff9f47a0b4728afa0a95f1f6acfd7f8d2c16716">syck_lvl_mapx</a>:
<a name="l01111"></a>01111         {
<a name="l01112"></a>01112             <span class="keywordflow">if</span> ( lvl-&gt;<a class="code" href="../../dd/d0e/struct__syck__level.html#afa7cc05334cbd8dbe1367d9de134c8ab">ncount</a> % 2 == 0 ) {
<a name="l01113"></a>01113                 <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a84635b690e68518e54670f7f4bf1cb47">syck_emit_indent</a>( e );
<a name="l01114"></a>01114                 lvl-&gt;<a class="code" href="../../dd/d0e/struct__syck__level.html#adc00a7ade66d407d9d00745e491c4d6c">status</a> = <a class="code" href="../../de/dce/syck_8h.html#a10af5e9a345d0e86156a336e91ff9f47a193976ec9cc4f9ee296a851e5f03c4f8">syck_lvl_map</a>;
<a name="l01115"></a>01115             } <span class="keywordflow">else</span> {
<a name="l01116"></a>01116                 <span class="keywordtype">int</span> i;
<a name="l01117"></a>01117                 <span class="keywordflow">if</span> ( lvl-&gt;<a class="code" href="../../dd/d0e/struct__syck__level.html#a401e3fc67c4f33f8535cd3ec26fdb87d">spaces</a> &gt; 0 ) {
<a name="l01118"></a>01118                     <span class="keywordtype">char</span> *spcs = <a class="code" href="../../de/dce/syck_8h.html#a2d20ec6949b5978b35b88eedf43f36ff">S_ALLOC_N</a>( <span class="keywordtype">char</span>, lvl-&gt;<a class="code" href="../../dd/d0e/struct__syck__level.html#a401e3fc67c4f33f8535cd3ec26fdb87d">spaces</a> + 1 );
<a name="l01119"></a>01119 
<a name="l01120"></a>01120                     spcs[lvl-&gt;<a class="code" href="../../dd/d0e/struct__syck__level.html#a401e3fc67c4f33f8535cd3ec26fdb87d">spaces</a>] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l01121"></a>01121                     <span class="keywordflow">for</span> ( i = 0; i &lt; lvl-&gt;<a class="code" href="../../dd/d0e/struct__syck__level.html#a401e3fc67c4f33f8535cd3ec26fdb87d">spaces</a>; i++ ) spcs[i] = <span class="charliteral">&apos; &apos;</span>;
<a name="l01122"></a>01122                     <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a251980c11ffad2f157e04ea6ee8dfa66">syck_emitter_write</a>( e, spcs, lvl-&gt;<a class="code" href="../../dd/d0e/struct__syck__level.html#a401e3fc67c4f33f8535cd3ec26fdb87d">spaces</a> );
<a name="l01123"></a>01123                     <a class="code" href="../../de/dce/syck_8h.html#a59b854f4bc2b7cd8e19c75600deeb24d">S_FREE</a>( spcs );
<a name="l01124"></a>01124                 }
<a name="l01125"></a>01125                 <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a251980c11ffad2f157e04ea6ee8dfa66">syck_emitter_write</a>( e, <span class="stringliteral">&quot;: &quot;</span>, 2 );
<a name="l01126"></a>01126             }
<a name="l01127"></a>01127         }
<a name="l01128"></a>01128         <span class="keywordflow">break</span>;
<a name="l01129"></a>01129 
<a name="l01130"></a>01130         <span class="keywordflow">case</span> <a class="code" href="../../de/dce/syck_8h.html#a10af5e9a345d0e86156a336e91ff9f47a65beb407005776a7a575da4dd9b65a65">syck_lvl_imap</a>:
<a name="l01131"></a>01131         {
<a name="l01132"></a>01132             <span class="keywordflow">if</span> ( lvl-&gt;<a class="code" href="../../dd/d0e/struct__syck__level.html#afa7cc05334cbd8dbe1367d9de134c8ab">ncount</a> &gt; 0 ) {
<a name="l01133"></a>01133                 <span class="keywordflow">if</span> ( lvl-&gt;<a class="code" href="../../dd/d0e/struct__syck__level.html#afa7cc05334cbd8dbe1367d9de134c8ab">ncount</a> % 2 == 0 ) {
<a name="l01134"></a>01134                     <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a251980c11ffad2f157e04ea6ee8dfa66">syck_emitter_write</a>( e, <span class="stringliteral">&quot;, &quot;</span>, 2 );
<a name="l01135"></a>01135                 } <span class="keywordflow">else</span> {
<a name="l01136"></a>01136                     <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a251980c11ffad2f157e04ea6ee8dfa66">syck_emitter_write</a>( e, <span class="stringliteral">&quot;: &quot;</span>, 2 );
<a name="l01137"></a>01137                 }
<a name="l01138"></a>01138             }
<a name="l01139"></a>01139         }
<a name="l01140"></a>01140         <span class="keywordflow">break</span>;
<a name="l01141"></a>01141 
<a name="l01142"></a>01142         <span class="keywordflow">default</span>: <span class="keywordflow">break</span>;
<a name="l01143"></a>01143     }
<a name="l01144"></a>01144     lvl-&gt;<a class="code" href="../../dd/d0e/struct__syck__level.html#afa7cc05334cbd8dbe1367d9de134c8ab">ncount</a>++;
<a name="l01145"></a>01145 
<a name="l01146"></a>01146     <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#ac851171d4d82013821f84db6331bbcc4">syck_emit</a>( e, n );
<a name="l01147"></a>01147 }
<a name="l01148"></a>01148 
<a name="l01149"></a>01149 <span class="comment">/*</span>
<a name="l01150"></a>01150 <span class="comment"> * Closes emission of a collection.</span>
<a name="l01151"></a>01151 <span class="comment"> */</span>
<a name="l01152"></a><a class="code" href="../../de/dce/syck_8h.html#a5e02811cab10095423f442cc6d74f11c">01152</a> <span class="keywordtype">void</span> <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a58741c5a171940423e78be1976eee6d2">syck_emit_end</a>( <a class="code" href="../../d8/df6/struct__syck__emitter.html">SyckEmitter</a> *e )
<a name="l01153"></a>01153 {
<a name="l01154"></a>01154     <a class="code" href="../../dd/d0e/struct__syck__level.html">SyckLevel</a> *lvl = <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a5f9693ef17bdeacaa7afd778a29cb919">syck_emitter_current_level</a>( e );
<a name="l01155"></a>01155     <a class="code" href="../../dd/d0e/struct__syck__level.html">SyckLevel</a> *parent = <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a35436ae22a44347661a8bb282d9ef744">syck_emitter_parent_level</a>( e );
<a name="l01156"></a>01156     <span class="keywordflow">switch</span> ( lvl-&gt;<a class="code" href="../../dd/d0e/struct__syck__level.html#adc00a7ade66d407d9d00745e491c4d6c">status</a> )
<a name="l01157"></a>01157     {
<a name="l01158"></a>01158         <span class="keywordflow">case</span> <a class="code" href="../../de/dce/syck_8h.html#a10af5e9a345d0e86156a336e91ff9f47a8cf827bb42699b875e1f8db92e8d85b9">syck_lvl_seq</a>:
<a name="l01159"></a>01159             <span class="keywordflow">if</span> ( lvl-&gt;<a class="code" href="../../dd/d0e/struct__syck__level.html#afa7cc05334cbd8dbe1367d9de134c8ab">ncount</a> == 0 ) {
<a name="l01160"></a>01160                 <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a251980c11ffad2f157e04ea6ee8dfa66">syck_emitter_write</a>( e, <span class="stringliteral">&quot;[]\n&quot;</span>, 3 );
<a name="l01161"></a>01161             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( parent-&gt;<a class="code" href="../../dd/d0e/struct__syck__level.html#adc00a7ade66d407d9d00745e491c4d6c">status</a> == <a class="code" href="../../de/dce/syck_8h.html#a10af5e9a345d0e86156a336e91ff9f47a0b4728afa0a95f1f6acfd7f8d2c16716">syck_lvl_mapx</a> ) {
<a name="l01162"></a>01162                 <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a251980c11ffad2f157e04ea6ee8dfa66">syck_emitter_write</a>( e, <span class="stringliteral">&quot;\n&quot;</span>, 1 );
<a name="l01163"></a>01163             }
<a name="l01164"></a>01164         <span class="keywordflow">break</span>;
<a name="l01165"></a>01165 
<a name="l01166"></a>01166         <span class="keywordflow">case</span> <a class="code" href="../../de/dce/syck_8h.html#a10af5e9a345d0e86156a336e91ff9f47a90bc43e019e7e4c3d41f6d4ab92d1a6b">syck_lvl_iseq</a>:
<a name="l01167"></a>01167             <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a251980c11ffad2f157e04ea6ee8dfa66">syck_emitter_write</a>( e, <span class="stringliteral">&quot;]\n&quot;</span>, 1 );
<a name="l01168"></a>01168         <span class="keywordflow">break</span>;
<a name="l01169"></a>01169 
<a name="l01170"></a>01170         <span class="keywordflow">case</span> <a class="code" href="../../de/dce/syck_8h.html#a10af5e9a345d0e86156a336e91ff9f47a193976ec9cc4f9ee296a851e5f03c4f8">syck_lvl_map</a>:
<a name="l01171"></a>01171             <span class="keywordflow">if</span> ( lvl-&gt;<a class="code" href="../../dd/d0e/struct__syck__level.html#afa7cc05334cbd8dbe1367d9de134c8ab">ncount</a> == 0 ) {
<a name="l01172"></a>01172                 <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a251980c11ffad2f157e04ea6ee8dfa66">syck_emitter_write</a>( e, <span class="stringliteral">&quot;{}\n&quot;</span>, 3 );
<a name="l01173"></a>01173             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( lvl-&gt;<a class="code" href="../../dd/d0e/struct__syck__level.html#afa7cc05334cbd8dbe1367d9de134c8ab">ncount</a> % 2 == 1 ) {
<a name="l01174"></a>01174                 <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a251980c11ffad2f157e04ea6ee8dfa66">syck_emitter_write</a>( e, <span class="stringliteral">&quot;:\n&quot;</span>, 1 );
<a name="l01175"></a>01175             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( parent-&gt;<a class="code" href="../../dd/d0e/struct__syck__level.html#adc00a7ade66d407d9d00745e491c4d6c">status</a> == <a class="code" href="../../de/dce/syck_8h.html#a10af5e9a345d0e86156a336e91ff9f47a0b4728afa0a95f1f6acfd7f8d2c16716">syck_lvl_mapx</a> ) {
<a name="l01176"></a>01176                 <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a251980c11ffad2f157e04ea6ee8dfa66">syck_emitter_write</a>( e, <span class="stringliteral">&quot;\n&quot;</span>, 1 );
<a name="l01177"></a>01177             }
<a name="l01178"></a>01178         <span class="keywordflow">break</span>;
<a name="l01179"></a>01179 
<a name="l01180"></a>01180         <span class="keywordflow">case</span> <a class="code" href="../../de/dce/syck_8h.html#a10af5e9a345d0e86156a336e91ff9f47a65beb407005776a7a575da4dd9b65a65">syck_lvl_imap</a>:
<a name="l01181"></a>01181             <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#a251980c11ffad2f157e04ea6ee8dfa66">syck_emitter_write</a>( e, <span class="stringliteral">&quot;}\n&quot;</span>, 1 );
<a name="l01182"></a>01182         <span class="keywordflow">break</span>;
<a name="l01183"></a>01183 
<a name="l01184"></a>01184         <span class="keywordflow">default</span>: <span class="keywordflow">break</span>;
<a name="l01185"></a>01185     }
<a name="l01186"></a>01186 }
<a name="l01187"></a>01187 
<a name="l01188"></a>01188 <span class="comment">/*</span>
<a name="l01189"></a>01189 <span class="comment"> * Fill markers table with emitter nodes in the</span>
<a name="l01190"></a>01190 <span class="comment"> * soon-to-be-emitted tree.</span>
<a name="l01191"></a>01191 <span class="comment"> */</span>
<a name="l01192"></a>01192 <a class="code" href="../../de/dce/syck_8h.html#a4e170963ed89a5ec1a7e8ffedc8c0b3b">SYMID</a>
<a name="l01193"></a><a class="code" href="../../de/dce/syck_8h.html#a67d97fcb25d1ecf1122273a12d31d0fa">01193</a> <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#ac79751d8f47e90c1f353d4959c4a5d05">syck_emitter_mark_node</a>( <a class="code" href="../../d8/df6/struct__syck__emitter.html">SyckEmitter</a> *e, <a class="code" href="../../de/dce/syck_8h.html#a8a45dfe133c1fd041e1b902bda9e43e8">st_data_t</a> n )
<a name="l01194"></a>01194 {
<a name="l01195"></a>01195     <a class="code" href="../../de/dce/syck_8h.html#a4e170963ed89a5ec1a7e8ffedc8c0b3b">SYMID</a> oid = 0;
<a name="l01196"></a>01196     <span class="keywordtype">char</span> *anchor_name = <a class="code" href="../../d3/d09/ripper_8y.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01197"></a>01197 
<a name="l01198"></a>01198     <span class="comment">/*</span>
<a name="l01199"></a>01199 <span class="comment">     * Ensure markers table is initialized.</span>
<a name="l01200"></a>01200 <span class="comment">     */</span>
<a name="l01201"></a>01201     <span class="keywordflow">if</span> ( e-&gt;<a class="code" href="../../d8/df6/struct__syck__emitter.html#a7b0db5fa866e726fc11b2bf08a5830b2">markers</a> == <a class="code" href="../../d3/d09/ripper_8y.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> )
<a name="l01202"></a>01202     {
<a name="l01203"></a>01203         e-&gt;<a class="code" href="../../d8/df6/struct__syck__emitter.html#a7b0db5fa866e726fc11b2bf08a5830b2">markers</a> = <a class="code" href="../../dd/d24/st_8h.html#a955c6e936b9681649ab9ffa4aa741949">st_init_numtable</a>();
<a name="l01204"></a>01204     }
<a name="l01205"></a>01205 
<a name="l01206"></a>01206     <span class="comment">/*</span>
<a name="l01207"></a>01207 <span class="comment">     * Markers table initially marks the string position of the</span>
<a name="l01208"></a>01208 <span class="comment">     * object.  Doesn&apos;t yet create an anchor, simply notes the</span>
<a name="l01209"></a>01209 <span class="comment">     * position.</span>
<a name="l01210"></a>01210 <span class="comment">     */</span>
<a name="l01211"></a>01211     <span class="keywordflow">if</span> ( ! <a class="code" href="../../dd/d24/st_8h.html#a2d85287fbdaf7dcbc22d45e925c29fea">st_lookup</a>( e-&gt;<a class="code" href="../../d8/df6/struct__syck__emitter.html#a7b0db5fa866e726fc11b2bf08a5830b2">markers</a>, n, (<a class="code" href="../../de/dce/syck_8h.html#a8a45dfe133c1fd041e1b902bda9e43e8">st_data_t</a> *)&amp;oid ) )
<a name="l01212"></a>01212     {
<a name="l01213"></a>01213         <span class="comment">/*</span>
<a name="l01214"></a>01214 <span class="comment">         * Store all markers</span>
<a name="l01215"></a>01215 <span class="comment">         */</span>
<a name="l01216"></a>01216         oid = e-&gt;<a class="code" href="../../d8/df6/struct__syck__emitter.html#a7b0db5fa866e726fc11b2bf08a5830b2">markers</a>-&gt;<a class="code" href="../../d0/ddd/structst__table.html#aa593a5229fc7d02d628a4518f56f71b6">num_entries</a> + 1;
<a name="l01217"></a>01217         <a class="code" href="../../dd/d24/st_8h.html#acdc42c01229b7537ea5a4c6965c7e47a">st_insert</a>( e-&gt;<a class="code" href="../../d8/df6/struct__syck__emitter.html#a7b0db5fa866e726fc11b2bf08a5830b2">markers</a>, n, (<a class="code" href="../../de/dce/syck_8h.html#a8a45dfe133c1fd041e1b902bda9e43e8">st_data_t</a>)oid );
<a name="l01218"></a>01218     }
<a name="l01219"></a>01219     <span class="keywordflow">else</span>
<a name="l01220"></a>01220     {
<a name="l01221"></a>01221         <span class="keywordflow">if</span> ( e-&gt;<a class="code" href="../../d8/df6/struct__syck__emitter.html#ac20bad3bf020fd6e0a02dc506eeaf421">anchors</a> == <a class="code" href="../../d3/d09/ripper_8y.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> )
<a name="l01222"></a>01222         {
<a name="l01223"></a>01223             e-&gt;<a class="code" href="../../d8/df6/struct__syck__emitter.html#ac20bad3bf020fd6e0a02dc506eeaf421">anchors</a> = <a class="code" href="../../dd/d24/st_8h.html#a955c6e936b9681649ab9ffa4aa741949">st_init_numtable</a>();
<a name="l01224"></a>01224         }
<a name="l01225"></a>01225 
<a name="l01226"></a>01226         <span class="keywordflow">if</span> ( ! <a class="code" href="../../dd/d24/st_8h.html#a2d85287fbdaf7dcbc22d45e925c29fea">st_lookup</a>( e-&gt;<a class="code" href="../../d8/df6/struct__syck__emitter.html#ac20bad3bf020fd6e0a02dc506eeaf421">anchors</a>, (<a class="code" href="../../de/dce/syck_8h.html#a8a45dfe133c1fd041e1b902bda9e43e8">st_data_t</a>)oid, (<span class="keywordtype">void</span> *)&amp;anchor_name ) )
<a name="l01227"></a>01227         {
<a name="l01228"></a>01228             <span class="keywordtype">int</span> idx = 0;
<a name="l01229"></a>01229             <span class="keyword">const</span> <span class="keywordtype">char</span> *anc = ( e-&gt;<a class="code" href="../../d8/df6/struct__syck__emitter.html#a72e7aa295527973d4166e9eaa1b84eea">anchor_format</a> == <a class="code" href="../../d3/d09/ripper_8y.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> ? <a class="code" href="../../d3/ddc/syck_2emitter_8c.html#aa8f15fc9b9db1bf95d797a555e889931">DEFAULT_ANCHOR_FORMAT</a> : e-&gt;<a class="code" href="../../d8/df6/struct__syck__emitter.html#a72e7aa295527973d4166e9eaa1b84eea">anchor_format</a> );
<a name="l01230"></a>01230 
<a name="l01231"></a>01231             <span class="comment">/*</span>
<a name="l01232"></a>01232 <span class="comment">             * Second time hitting this object, let&apos;s give it an anchor</span>
<a name="l01233"></a>01233 <span class="comment">             */</span>
<a name="l01234"></a>01234             idx = (int)(e-&gt;<a class="code" href="../../d8/df6/struct__syck__emitter.html#ac20bad3bf020fd6e0a02dc506eeaf421">anchors</a>-&gt;<a class="code" href="../../d0/ddd/structst__table.html#aa593a5229fc7d02d628a4518f56f71b6">num_entries</a> + 1);
<a name="l01235"></a>01235             anchor_name = <a class="code" href="../../de/dce/syck_8h.html#a2d20ec6949b5978b35b88eedf43f36ff">S_ALLOC_N</a>( <span class="keywordtype">char</span>, <a class="code" href="../../d6/d7b/strchr_8c.html#a219836f542ce53545052bed5353820ca">strlen</a>( anc ) + 10 );
<a name="l01236"></a>01236             <a class="code" href="../../de/dce/syck_8h.html#a9862f0d21b09e3963c3dc6fc9a18c27d">S_MEMZERO</a>( anchor_name, <span class="keywordtype">char</span>, <a class="code" href="../../d6/d7b/strchr_8c.html#a219836f542ce53545052bed5353820ca">strlen</a>( anc ) + 10 );
<a name="l01237"></a>01237             sprintf( anchor_name, anc, idx );
<a name="l01238"></a>01238 
<a name="l01239"></a>01239             <span class="comment">/*</span>
<a name="l01240"></a>01240 <span class="comment">             * Insert into anchors table</span>
<a name="l01241"></a>01241 <span class="comment">             */</span>
<a name="l01242"></a>01242             <a class="code" href="../../dd/d24/st_8h.html#acdc42c01229b7537ea5a4c6965c7e47a">st_insert</a>( e-&gt;<a class="code" href="../../d8/df6/struct__syck__emitter.html#ac20bad3bf020fd6e0a02dc506eeaf421">anchors</a>, (<a class="code" href="../../de/dce/syck_8h.html#a8a45dfe133c1fd041e1b902bda9e43e8">st_data_t</a>)oid, (<a class="code" href="../../de/dce/syck_8h.html#a8a45dfe133c1fd041e1b902bda9e43e8">st_data_t</a>)anchor_name );
<a name="l01243"></a>01243         }
<a name="l01244"></a>01244     }
<a name="l01245"></a>01245     <span class="keywordflow">return</span> oid;
<a name="l01246"></a>01246 }
<a name="l01247"></a>01247 
<a name="l01248"></a>01248 
</pre></div></div>
<hr size="1"/><address style="text-align: right;"><small>Generated on 1 Mar 2013 for Ruby by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
