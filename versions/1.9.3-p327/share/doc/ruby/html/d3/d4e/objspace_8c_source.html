<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Ruby: ext/objspace/objspace.c Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="../../index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="../../files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="../../globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<h1>ext/objspace/objspace.c</h1><a href="../../d3/d4e/objspace_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/**********************************************************************</span>
<a name="l00002"></a>00002 <span class="comment"></span>
<a name="l00003"></a>00003 <span class="comment">  objspace.c - ObjectSpace extender for MRI.</span>
<a name="l00004"></a>00004 <span class="comment"></span>
<a name="l00005"></a>00005 <span class="comment">  $Author: ktsj $</span>
<a name="l00006"></a>00006 <span class="comment">  created at: Wed Jun 17 07:39:17 2009</span>
<a name="l00007"></a>00007 <span class="comment"></span>
<a name="l00008"></a>00008 <span class="comment">  NOTE: This extension library is not expected to exist except C Ruby.</span>
<a name="l00009"></a>00009 <span class="comment"></span>
<a name="l00010"></a>00010 <span class="comment">  All the files in this distribution are covered under the Ruby&apos;s</span>
<a name="l00011"></a>00011 <span class="comment">  license (see the file COPYING).</span>
<a name="l00012"></a>00012 <span class="comment"></span>
<a name="l00013"></a>00013 <span class="comment">**********************************************************************/</span>
<a name="l00014"></a>00014 
<a name="l00015"></a>00015 <span class="comment">/* objspace library extends ObjectSpace module and add several</span>
<a name="l00016"></a>00016 <span class="comment"> * methods to get internal statistic information about</span>
<a name="l00017"></a>00017 <span class="comment"> * object/memory management.</span>
<a name="l00018"></a>00018 <span class="comment"> *</span>
<a name="l00019"></a>00019 <span class="comment"> * Generally, you *SHOULD NOT*use this library if you do not know</span>
<a name="l00020"></a>00020 <span class="comment"> * about the MRI implementation.  Mainly, this library is for (memory)</span>
<a name="l00021"></a>00021 <span class="comment"> * profiler developers and MRI developers who need to know how MRI</span>
<a name="l00022"></a>00022 <span class="comment"> * memory usage.</span>
<a name="l00023"></a>00023 <span class="comment"> *</span>
<a name="l00024"></a>00024 <span class="comment"> */</span>
<a name="l00025"></a>00025 
<a name="l00026"></a>00026 <span class="preprocessor">#include &lt;<a class="code" href="../../de/de6/ruby_2ruby_8h.html">ruby/ruby.h</a>&gt;</span>
<a name="l00027"></a>00027 <span class="preprocessor">#include &lt;<a class="code" href="../../dd/d24/st_8h.html">ruby/st.h</a>&gt;</span>
<a name="l00028"></a>00028 <span class="preprocessor">#include &lt;<a class="code" href="../../dc/dac/io_8h.html">ruby/io.h</a>&gt;</span>
<a name="l00029"></a>00029 <span class="preprocessor">#include &lt;<a class="code" href="../../db/db6/re_8h.html">ruby/re.h</a>&gt;</span>
<a name="l00030"></a>00030 <span class="preprocessor">#include &quot;<a class="code" href="../../d1/d77/node_8h.html">node.h</a>&quot;</span>
<a name="l00031"></a>00031 <span class="preprocessor">#include &quot;<a class="code" href="../../d0/daa/gc_8h.html">gc.h</a>&quot;</span>
<a name="l00032"></a>00032 <span class="preprocessor">#include &quot;<a class="code" href="../../d6/d87/regint_8h.html">regint.h</a>&quot;</span>
<a name="l00033"></a>00033 <span class="preprocessor">#include &quot;<a class="code" href="../../db/dde/internal_8h.html">internal.h</a>&quot;</span>
<a name="l00034"></a>00034 
<a name="l00035"></a>00035 <span class="keywordtype">size_t</span> <a class="code" href="../../d3/d4e/objspace_8c.html#a35705693dcd6c61cd5d517c6526ba62c">rb_str_memsize</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>);
<a name="l00036"></a>00036 <span class="keywordtype">size_t</span> <a class="code" href="../../dc/dcc/array_8c.html#a1ae6803976f7c0c820a9a6f981dac85a">rb_ary_memsize</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>);
<a name="l00037"></a>00037 <span class="keywordtype">size_t</span> <a class="code" href="../../d3/d4e/objspace_8c.html#a9961d1dfb2b3d7ba00a0ca9fe3fa40dc">rb_io_memsize</a>(<span class="keyword">const</span> <a class="code" href="../../dd/d7e/structrb__io__t.html">rb_io_t</a> *);
<a name="l00038"></a>00038 <span class="keywordtype">size_t</span> <a class="code" href="../../d3/d4e/objspace_8c.html#a7cf829bf7d4213be23a4c6a382bb660e">rb_generic_ivar_memsize</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>);
<a name="l00039"></a>00039 <span class="keywordtype">size_t</span> <a class="code" href="../../d3/d4e/objspace_8c.html#a2808ab60a7e7a458c3d440d3e4d34120">rb_objspace_data_type_memsize</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> obj);
<a name="l00040"></a>00040 
<a name="l00041"></a>00041 <span class="keyword">static</span> <span class="keywordtype">size_t</span>
<a name="l00042"></a><a class="code" href="../../d3/d4e/objspace_8c.html#a4d95ce7a52fd4fd445835c0d67b4a4a6">00042</a> <a class="code" href="../../d3/d4e/objspace_8c.html#a4d95ce7a52fd4fd445835c0d67b4a4a6">memsize_of</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> obj)
<a name="l00043"></a>00043 {
<a name="l00044"></a>00044     <span class="keywordtype">size_t</span> <a class="code" href="../../d5/db5/encoding_8c.html#a439227feff9d7f55384e8780cfc2eb82">size</a> = 0;
<a name="l00045"></a>00045 
<a name="l00046"></a>00046     <span class="keywordflow">if</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac59489a7ed093e29019047d13e79c009">SPECIAL_CONST_P</a>(obj)) {
<a name="l00047"></a>00047         <span class="keywordflow">return</span> 0;
<a name="l00048"></a>00048     }
<a name="l00049"></a>00049 
<a name="l00050"></a>00050     <span class="keywordflow">if</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a1ae918b6cc84188a9dc6ab545f732e4d">FL_TEST</a>(obj, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a0eecbc9617756148ca4e1c4c0a8c9de6">FL_EXIVAR</a>)) {
<a name="l00051"></a>00051         size += <a class="code" href="../../d3/d4e/objspace_8c.html#a7cf829bf7d4213be23a4c6a382bb660e">rb_generic_ivar_memsize</a>(obj);
<a name="l00052"></a>00052     }
<a name="l00053"></a>00053 
<a name="l00054"></a>00054     <span class="keywordflow">switch</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#aee74f540353cd2d77d1cb37a3714bd7d">BUILTIN_TYPE</a>(obj)) {
<a name="l00055"></a>00055       <span class="keywordflow">case</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#abed71c72d5c3083041d52ad25630270e">T_OBJECT</a>:
<a name="l00056"></a>00056         <span class="keywordflow">if</span> (!(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a1d4c05021aacd8cab989ff60f95ebe2d">RBASIC</a>(obj)-&gt;flags &amp; <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a49df79f2c7c1ec147dad9a122de1a7d7">ROBJECT_EMBED</a>) &amp;&amp;
<a name="l00057"></a>00057             <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a0331536132945278462f08825b169f7e">ROBJECT</a>(obj)-&gt;as.heap.ivptr) {
<a name="l00058"></a>00058             size += <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a0331536132945278462f08825b169f7e">ROBJECT</a>(obj)-&gt;as.heap.numiv * <span class="keyword">sizeof</span>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>);
<a name="l00059"></a>00059         }
<a name="l00060"></a>00060         <span class="keywordflow">break</span>;
<a name="l00061"></a>00061       <span class="keywordflow">case</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a6cdc7dfe8f84777325da08a96ae5f795">T_MODULE</a>:
<a name="l00062"></a>00062       <span class="keywordflow">case</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ad04c63d175774c6d6e7dfaf0f0a982c9">T_CLASS</a>:
<a name="l00063"></a>00063         size += <a class="code" href="../../dd/d24/st_8h.html#a1d0d955fb1f39486c18162f222deb82b">st_memsize</a>(<a class="code" href="../../d3/d09/ripper_8y.html#ab59ea80cdf15f3f19bbae0346314c9ad">RCLASS_M_TBL</a>(obj));
<a name="l00064"></a>00064         <span class="keywordflow">if</span> (<a class="code" href="../../d3/d09/ripper_8y.html#a7f7f2dbf958976d9bf317167396992d4">RCLASS_IV_TBL</a>(obj)) {
<a name="l00065"></a>00065             size += <a class="code" href="../../dd/d24/st_8h.html#a1d0d955fb1f39486c18162f222deb82b">st_memsize</a>(<a class="code" href="../../d3/d09/ripper_8y.html#a7f7f2dbf958976d9bf317167396992d4">RCLASS_IV_TBL</a>(obj));
<a name="l00066"></a>00066         }
<a name="l00067"></a>00067         <span class="keywordflow">if</span> (<a class="code" href="../../d3/d09/ripper_8y.html#ae5267dcfc60a00436251a80cbee8455f">RCLASS_IV_INDEX_TBL</a>(obj)) {
<a name="l00068"></a>00068             size += <a class="code" href="../../dd/d24/st_8h.html#a1d0d955fb1f39486c18162f222deb82b">st_memsize</a>(<a class="code" href="../../d3/d09/ripper_8y.html#ae5267dcfc60a00436251a80cbee8455f">RCLASS_IV_INDEX_TBL</a>(obj));
<a name="l00069"></a>00069         }
<a name="l00070"></a>00070         <span class="keywordflow">if</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#aa8dd3e5d8cda3d760b2bbcd5ecf6ed6d">RCLASS</a>(obj)-&gt;ptr-&gt;iv_tbl) {
<a name="l00071"></a>00071             size += <a class="code" href="../../dd/d24/st_8h.html#a1d0d955fb1f39486c18162f222deb82b">st_memsize</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#aa8dd3e5d8cda3d760b2bbcd5ecf6ed6d">RCLASS</a>(obj)-&gt;ptr-&gt;iv_tbl);
<a name="l00072"></a>00072         }
<a name="l00073"></a>00073         <span class="keywordflow">if</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#aa8dd3e5d8cda3d760b2bbcd5ecf6ed6d">RCLASS</a>(obj)-&gt;ptr-&gt;const_tbl) {
<a name="l00074"></a>00074             size += <a class="code" href="../../dd/d24/st_8h.html#a1d0d955fb1f39486c18162f222deb82b">st_memsize</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#aa8dd3e5d8cda3d760b2bbcd5ecf6ed6d">RCLASS</a>(obj)-&gt;ptr-&gt;const_tbl);
<a name="l00075"></a>00075         }
<a name="l00076"></a>00076         size += <span class="keyword">sizeof</span>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#aa4eb92f5ea053e6d6cfddb46f40d6c80">rb_classext_t</a>);
<a name="l00077"></a>00077         <span class="keywordflow">break</span>;
<a name="l00078"></a>00078       <span class="keywordflow">case</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a22a8c2a4bbaae9b68f65c9bb92fd4e39">T_STRING</a>:
<a name="l00079"></a>00079         size += <a class="code" href="../../d3/d4e/objspace_8c.html#a35705693dcd6c61cd5d517c6526ba62c">rb_str_memsize</a>(obj);
<a name="l00080"></a>00080         <span class="keywordflow">break</span>;
<a name="l00081"></a>00081       <span class="keywordflow">case</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#abbd332f6f94d77e0a369c7720128639e">T_ARRAY</a>:
<a name="l00082"></a>00082         size += <a class="code" href="../../dc/dcc/array_8c.html#a1ae6803976f7c0c820a9a6f981dac85a">rb_ary_memsize</a>(obj);
<a name="l00083"></a>00083         <span class="keywordflow">break</span>;
<a name="l00084"></a>00084       <span class="keywordflow">case</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a8357e81bbb60cb41b0a292a90653a5e5">T_HASH</a>:
<a name="l00085"></a>00085         <span class="keywordflow">if</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac519648e8a9b1f40f4ae6d6e3ee2c467">RHASH</a>(obj)-&gt;ntbl) {
<a name="l00086"></a>00086             size += <a class="code" href="../../dd/d24/st_8h.html#a1d0d955fb1f39486c18162f222deb82b">st_memsize</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac519648e8a9b1f40f4ae6d6e3ee2c467">RHASH</a>(obj)-&gt;ntbl);
<a name="l00087"></a>00087         }
<a name="l00088"></a>00088         <span class="keywordflow">break</span>;
<a name="l00089"></a>00089       <span class="keywordflow">case</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#afd5c1e36d171ecc04514332e8dcf6388">T_REGEXP</a>:
<a name="l00090"></a>00090         <span class="keywordflow">if</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a062a8130d6bba9a9ccde0ee143db5afd">RREGEXP</a>(obj)-&gt;ptr) {
<a name="l00091"></a>00091             size += <a class="code" href="../../d0/d86/regcomp_8c.html#aa7cd0a6158a91b332b585e3ce32035fe">onig_memsize</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a062a8130d6bba9a9ccde0ee143db5afd">RREGEXP</a>(obj)-&gt;ptr);
<a name="l00092"></a>00092         }
<a name="l00093"></a>00093         <span class="keywordflow">break</span>;
<a name="l00094"></a>00094       <span class="keywordflow">case</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a55f295817faf14e42b3cff745a7ac706">T_DATA</a>:
<a name="l00095"></a>00095         size += <a class="code" href="../../d3/d4e/objspace_8c.html#a2808ab60a7e7a458c3d440d3e4d34120">rb_objspace_data_type_memsize</a>(obj);
<a name="l00096"></a>00096         <span class="keywordflow">break</span>;
<a name="l00097"></a>00097       <span class="keywordflow">case</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#acc66e9c9228bc7ad6f292a253ce5fdf4">T_MATCH</a>:
<a name="l00098"></a>00098         <span class="keywordflow">if</span> (<a class="code" href="../../db/db6/re_8h.html#a6afb9f09fc1dc1307ed5924196af43f9">RMATCH</a>(obj)-&gt;<a class="code" href="../../d8/d5b/structrmatch.html">rmatch</a>) {
<a name="l00099"></a>00099             <span class="keyword">struct </span><a class="code" href="../../d8/d5b/structrmatch.html">rmatch</a> *rm = <a class="code" href="../../db/db6/re_8h.html#a6afb9f09fc1dc1307ed5924196af43f9">RMATCH</a>(obj)-&gt;rmatch;
<a name="l00100"></a>00100             size += <span class="keyword">sizeof</span>(<span class="keyword">struct </span><a class="code" href="../../d6/d14/structre__registers.html">re_registers</a>); <span class="comment">/* TODO: onig_region_memsize(&amp;rm-&gt;regs); */</span>
<a name="l00101"></a>00101             size += <span class="keyword">sizeof</span>(<span class="keyword">struct </span><a class="code" href="../../dd/dab/structrmatch__offset.html">rmatch_offset</a>) * rm-&gt;<a class="code" href="../../d8/d5b/structrmatch.html#a0b899cd7a0a6801d328fc09209be2249">char_offset_num_allocated</a>;
<a name="l00102"></a>00102             size += <span class="keyword">sizeof</span>(<span class="keyword">struct </span><a class="code" href="../../d8/d5b/structrmatch.html">rmatch</a>);
<a name="l00103"></a>00103         }
<a name="l00104"></a>00104         <span class="keywordflow">break</span>;
<a name="l00105"></a>00105       <span class="keywordflow">case</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a0a8afbed81f5fb3930e9d153fbd51737">T_FILE</a>:
<a name="l00106"></a>00106         <span class="keywordflow">if</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac9638ebe62bc0a0246b7b18a3afac833">RFILE</a>(obj)-&gt;fptr) {
<a name="l00107"></a>00107             size += <a class="code" href="../../d3/d4e/objspace_8c.html#a9961d1dfb2b3d7ba00a0ca9fe3fa40dc">rb_io_memsize</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac9638ebe62bc0a0246b7b18a3afac833">RFILE</a>(obj)-&gt;fptr);
<a name="l00108"></a>00108         }
<a name="l00109"></a>00109         <span class="keywordflow">break</span>;
<a name="l00110"></a>00110       <span class="keywordflow">case</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a804d1259cf2408f16969b2dc06b293fc">T_RATIONAL</a>:
<a name="l00111"></a>00111       <span class="keywordflow">case</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a05f3b14562e8d1e2d09e7a4438c1d2fa">T_COMPLEX</a>:
<a name="l00112"></a>00112         <span class="keywordflow">break</span>;
<a name="l00113"></a>00113       <span class="keywordflow">case</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a82c8c4569748b9645c958b9eaeaabb81">T_ICLASS</a>:
<a name="l00114"></a>00114         <span class="comment">/* iClass shares table with the module */</span>
<a name="l00115"></a>00115         <span class="keywordflow">break</span>;
<a name="l00116"></a>00116 
<a name="l00117"></a>00117       <span class="keywordflow">case</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3d072e0c25cf678e9b8601b957b92eae">T_FLOAT</a>:
<a name="l00118"></a>00118         <span class="keywordflow">break</span>;
<a name="l00119"></a>00119 
<a name="l00120"></a>00120       <span class="keywordflow">case</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a41ac74a27dd1eadc2ca86d10590f2163">T_BIGNUM</a>:
<a name="l00121"></a>00121         <span class="keywordflow">if</span> (!(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a1d4c05021aacd8cab989ff60f95ebe2d">RBASIC</a>(obj)-&gt;flags &amp; <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ad6856192451c57b81debeb24282a11c8">RBIGNUM_EMBED_FLAG</a>) &amp;&amp; <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a59c00018ecd3df95bd35b33fd65eba6d">RBIGNUM_DIGITS</a>(obj)) {
<a name="l00122"></a>00122             size += <a class="code" href="../../de/de6/ruby_2ruby_8h.html#afa349daf04364678d29c61ae05b277da">RBIGNUM_LEN</a>(obj) * <span class="keyword">sizeof</span>(<a class="code" href="../../d8/db0/defines_8h.html#aae70f10dc28a3f9db157d600d5ceab8b">BDIGIT</a>);
<a name="l00123"></a>00123         }
<a name="l00124"></a>00124         <span class="keywordflow">break</span>;
<a name="l00125"></a>00125       <span class="keywordflow">case</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a5f1cc49c4da51d5bdffa64be79ff6fb0">T_NODE</a>:
<a name="l00126"></a>00126         <span class="keywordflow">switch</span> (<a class="code" href="../../d3/d09/ripper_8y.html#ade12c589b26f55f089dc25d689249c11">nd_type</a>(obj)) {
<a name="l00127"></a>00127           <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#ac6983f7134e356786ebe01ddea8985cd">NODE_SCOPE</a>:
<a name="l00128"></a>00128             <span class="keywordflow">if</span> (<a class="code" href="../../d3/d09/ripper_8y.html#a80ab20436786ed07fa72606e4876cf66">RNODE</a>(obj)-&gt;u1.tbl) {
<a name="l00129"></a>00129                 <span class="comment">/* TODO: xfree(RANY(obj)-&gt;as.node.u1.tbl); */</span>
<a name="l00130"></a>00130             }
<a name="l00131"></a>00131             <span class="keywordflow">break</span>;
<a name="l00132"></a>00132           <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#afe798b4130b52162a6b58ff378c4a83e">NODE_ALLOCA</a>:
<a name="l00133"></a>00133             <span class="comment">/* TODO: xfree(RANY(obj)-&gt;as.node.u1.node); */</span>
<a name="l00134"></a>00134             ;
<a name="l00135"></a>00135         }
<a name="l00136"></a>00136         <span class="keywordflow">break</span>;                  <span class="comment">/* no need to free iv_tbl */</span>
<a name="l00137"></a>00137 
<a name="l00138"></a>00138       <span class="keywordflow">case</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a4853f60a017b2b7a126d3e23db98a954">T_STRUCT</a>:
<a name="l00139"></a>00139         <span class="keywordflow">if</span> ((<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a1d4c05021aacd8cab989ff60f95ebe2d">RBASIC</a>(obj)-&gt;flags &amp; <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a35cd6a4e08e17baf58c79050acb6978c">RSTRUCT_EMBED_LEN_MASK</a>) == 0 &amp;&amp;
<a name="l00140"></a>00140             <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a4a854cbf53611516451eea055a181fed">RSTRUCT</a>(obj)-&gt;as.heap.ptr) {
<a name="l00141"></a>00141             size += <span class="keyword">sizeof</span>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>) * <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aaeedf10e5dac36c5e7d3dd9d78f8766d">RSTRUCT_LEN</a>(obj);
<a name="l00142"></a>00142         }
<a name="l00143"></a>00143         <span class="keywordflow">break</span>;
<a name="l00144"></a>00144 
<a name="l00145"></a>00145       <span class="keywordflow">case</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ab80c70472770bcae8d33bbf6139262d0">T_ZOMBIE</a>:
<a name="l00146"></a>00146         <span class="keywordflow">break</span>;
<a name="l00147"></a>00147 
<a name="l00148"></a>00148       <span class="keywordflow">default</span>:
<a name="l00149"></a>00149         <a class="code" href="../../db/dcc/error_8c.html#a2d5fb28e54f792e7341b2c45f52f3860">rb_bug</a>(<span class="stringliteral">&quot;objspace/memsize_of(): unknown data type 0x%x(%p)&quot;</span>,
<a name="l00150"></a>00150                <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aee74f540353cd2d77d1cb37a3714bd7d">BUILTIN_TYPE</a>(obj), (<span class="keywordtype">void</span>*)obj);
<a name="l00151"></a>00151     }
<a name="l00152"></a>00152 
<a name="l00153"></a>00153     <span class="keywordflow">return</span> size;
<a name="l00154"></a>00154 }
<a name="l00155"></a>00155 
<a name="l00156"></a>00156 <span class="comment">/*</span>
<a name="l00157"></a>00157 <span class="comment"> *  call-seq:</span>
<a name="l00158"></a>00158 <span class="comment"> *    ObjectSpace.memsize_of(obj) -&gt; Integer</span>
<a name="l00159"></a>00159 <span class="comment"> *</span>
<a name="l00160"></a>00160 <span class="comment"> *  Return consuming memory size of obj.</span>
<a name="l00161"></a>00161 <span class="comment"> *</span>
<a name="l00162"></a>00162 <span class="comment"> *  Note that the return size is incomplete.  You need to deal with</span>
<a name="l00163"></a>00163 <span class="comment"> *  this information as only a *HINT*.  Especially, the size of</span>
<a name="l00164"></a>00164 <span class="comment"> *  T_DATA may not be correct.</span>
<a name="l00165"></a>00165 <span class="comment"> *</span>
<a name="l00166"></a>00166 <span class="comment"> *  This method is not expected to work except C Ruby.</span>
<a name="l00167"></a>00167 <span class="comment"> */</span>
<a name="l00168"></a>00168 
<a name="l00169"></a>00169 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l00170"></a><a class="code" href="../../d3/d4e/objspace_8c.html#ab9137e18869b215c6eb01b64ca0f8176">00170</a> <a class="code" href="../../d3/d4e/objspace_8c.html#ab9137e18869b215c6eb01b64ca0f8176">memsize_of_m</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <span class="keyword">self</span>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> obj)
<a name="l00171"></a>00171 {
<a name="l00172"></a>00172     <span class="keywordflow">return</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#af89e74d2dcf3eef15b29fa6015984af3">SIZET2NUM</a>(<a class="code" href="../../d3/d4e/objspace_8c.html#a4d95ce7a52fd4fd445835c0d67b4a4a6">memsize_of</a>(obj));
<a name="l00173"></a>00173 }
<a name="l00174"></a>00174 
<a name="l00175"></a><a class="code" href="../../d6/d97/structtotal__data.html">00175</a> <span class="keyword">struct </span><a class="code" href="../../d6/d97/structtotal__data.html">total_data</a> {
<a name="l00176"></a><a class="code" href="../../d6/d97/structtotal__data.html#a5f9a51591f97291ef3de8650ec6a5974">00176</a>     <span class="keywordtype">size_t</span> <a class="code" href="../../d6/d97/structtotal__data.html#a5f9a51591f97291ef3de8650ec6a5974">total</a>;
<a name="l00177"></a><a class="code" href="../../d6/d97/structtotal__data.html#aca1626c53eaf027e90a46dc320025542">00177</a>     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <a class="code" href="../../d6/d97/structtotal__data.html#aca1626c53eaf027e90a46dc320025542">klass</a>;
<a name="l00178"></a>00178 };
<a name="l00179"></a>00179 
<a name="l00180"></a>00180 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l00181"></a><a class="code" href="../../d3/d4e/objspace_8c.html#a951777cb99743d9d7d3d4ab6de16d251">00181</a> <a class="code" href="../../d3/d4e/objspace_8c.html#a951777cb99743d9d7d3d4ab6de16d251">total_i</a>(<span class="keywordtype">void</span> *vstart, <span class="keywordtype">void</span> *vend, <span class="keywordtype">size_t</span> stride, <span class="keywordtype">void</span> *ptr)
<a name="l00182"></a>00182 {
<a name="l00183"></a>00183     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> v;
<a name="l00184"></a>00184     <span class="keyword">struct </span><a class="code" href="../../d6/d97/structtotal__data.html">total_data</a> *data = (<span class="keyword">struct </span><a class="code" href="../../d6/d97/structtotal__data.html">total_data</a> *)ptr;
<a name="l00185"></a>00185 
<a name="l00186"></a>00186     <span class="keywordflow">for</span> (v = (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>)vstart; v != (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>)vend; v += stride) {
<a name="l00187"></a>00187         <span class="keywordflow">if</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a1d4c05021aacd8cab989ff60f95ebe2d">RBASIC</a>(v)-&gt;flags) {
<a name="l00188"></a>00188             <span class="keywordflow">switch</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#aee74f540353cd2d77d1cb37a3714bd7d">BUILTIN_TYPE</a>(v)) {
<a name="l00189"></a>00189               <span class="keywordflow">case</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a5efefe46b598af6f98c691fead03682d">T_NONE</a>:
<a name="l00190"></a>00190               <span class="keywordflow">case</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a82c8c4569748b9645c958b9eaeaabb81">T_ICLASS</a>:
<a name="l00191"></a>00191               <span class="keywordflow">case</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a5f1cc49c4da51d5bdffa64be79ff6fb0">T_NODE</a>:
<a name="l00192"></a>00192               <span class="keywordflow">case</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ab80c70472770bcae8d33bbf6139262d0">T_ZOMBIE</a>:
<a name="l00193"></a>00193                 <span class="keywordflow">continue</span>;
<a name="l00194"></a>00194               <span class="keywordflow">case</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ad04c63d175774c6d6e7dfaf0f0a982c9">T_CLASS</a>:
<a name="l00195"></a>00195                 <span class="keywordflow">if</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a1ae918b6cc84188a9dc6ab545f732e4d">FL_TEST</a>(v, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a081b5172ef37829bb3a258cd1ad393bc">FL_SINGLETON</a>))
<a name="l00196"></a>00196                   <span class="keywordflow">continue</span>;
<a name="l00197"></a>00197               <span class="keywordflow">default</span>:
<a name="l00198"></a>00198                 <span class="keywordflow">if</span> (data-&gt;<a class="code" href="../../d6/d97/structtotal__data.html#aca1626c53eaf027e90a46dc320025542">klass</a> == 0 || <a class="code" href="../../db/d2e/intern_8h.html#a6e65fc310dd65ebd60d68ada991da6f6">rb_obj_is_kind_of</a>(v, data-&gt;<a class="code" href="../../d6/d97/structtotal__data.html#aca1626c53eaf027e90a46dc320025542">klass</a>)) {
<a name="l00199"></a>00199                     data-&gt;<a class="code" href="../../d6/d97/structtotal__data.html#a5f9a51591f97291ef3de8650ec6a5974">total</a> += <a class="code" href="../../d3/d4e/objspace_8c.html#a4d95ce7a52fd4fd445835c0d67b4a4a6">memsize_of</a>(v);
<a name="l00200"></a>00200                 }
<a name="l00201"></a>00201             }
<a name="l00202"></a>00202         }
<a name="l00203"></a>00203     }
<a name="l00204"></a>00204 
<a name="l00205"></a>00205     <span class="keywordflow">return</span> 0;
<a name="l00206"></a>00206 }
<a name="l00207"></a>00207 
<a name="l00208"></a>00208 <span class="comment">/*</span>
<a name="l00209"></a>00209 <span class="comment"> *  call-seq:</span>
<a name="l00210"></a>00210 <span class="comment"> *    ObjectSpace.memsize_of_all([klass]) -&gt; Integer</span>
<a name="l00211"></a>00211 <span class="comment"> *</span>
<a name="l00212"></a>00212 <span class="comment"> *  Return consuming memory size of all living objects.</span>
<a name="l00213"></a>00213 <span class="comment"> *  If klass (should be Class object) is given, return the total</span>
<a name="l00214"></a>00214 <span class="comment"> *  memory size of instances of the given class.</span>
<a name="l00215"></a>00215 <span class="comment"> *</span>
<a name="l00216"></a>00216 <span class="comment"> *  Note that the returned size is incomplete.  You need to deal with</span>
<a name="l00217"></a>00217 <span class="comment"> *  this information as only a *HINT*.  Especially, the size of</span>
<a name="l00218"></a>00218 <span class="comment"> *  T_DATA may not be correct.</span>
<a name="l00219"></a>00219 <span class="comment"> *</span>
<a name="l00220"></a>00220 <span class="comment"> *  Note that this method does *NOT* return total malloc&apos;ed memory size.</span>
<a name="l00221"></a>00221 <span class="comment"> *</span>
<a name="l00222"></a>00222 <span class="comment"> *  This method can be defined by the following Ruby code:</span>
<a name="l00223"></a>00223 <span class="comment"> *</span>
<a name="l00224"></a>00224 <span class="comment"> *  def memsize_of_all klass = false</span>
<a name="l00225"></a>00225 <span class="comment"> *    total = 0</span>
<a name="l00226"></a>00226 <span class="comment"> *    ObjectSpace.each_objects{|e|</span>
<a name="l00227"></a>00227 <span class="comment"> *      total += ObjectSpace.memsize_of(e) if klass == false || e.kind_of?(klass)</span>
<a name="l00228"></a>00228 <span class="comment"> *    }</span>
<a name="l00229"></a>00229 <span class="comment"> *    total</span>
<a name="l00230"></a>00230 <span class="comment"> *  end</span>
<a name="l00231"></a>00231 <span class="comment"> *</span>
<a name="l00232"></a>00232 <span class="comment"> *  This method is not expected to work except C Ruby.</span>
<a name="l00233"></a>00233 <span class="comment"> */</span>
<a name="l00234"></a>00234 
<a name="l00235"></a>00235 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l00236"></a><a class="code" href="../../d3/d4e/objspace_8c.html#a7177314f57f728e9391b40fd6e1fbf8c">00236</a> <a class="code" href="../../d3/d4e/objspace_8c.html#a7177314f57f728e9391b40fd6e1fbf8c">memsize_of_all_m</a>(<span class="keywordtype">int</span> <a class="code" href="../../df/d77/ruby_8c.html#ad1447518f4372828b8435ae82e48499e">argc</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> *<a class="code" href="../../df/d77/ruby_8c.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <span class="keyword">self</span>)
<a name="l00237"></a>00237 {
<a name="l00238"></a>00238     <span class="keyword">struct </span><a class="code" href="../../d6/d97/structtotal__data.html">total_data</a> data = {0, 0};
<a name="l00239"></a>00239 
<a name="l00240"></a>00240     <span class="keywordflow">if</span> (argc &gt; 0) {
<a name="l00241"></a>00241         <a class="code" href="../../d7/d19/group__defmethod.html#gaa7bed88640f01bee619f85fda09d28d7">rb_scan_args</a>(argc, argv, <span class="stringliteral">&quot;01&quot;</span>, &amp;data.<a class="code" href="../../d6/d97/structtotal__data.html#aca1626c53eaf027e90a46dc320025542">klass</a>);
<a name="l00242"></a>00242     }
<a name="l00243"></a>00243 
<a name="l00244"></a>00244     <a class="code" href="../../d8/d16/gc_8c.html#ac2b65f7b2d778d973bfc7f0bf0c3dc62">rb_objspace_each_objects</a>(<a class="code" href="../../d3/d4e/objspace_8c.html#a951777cb99743d9d7d3d4ab6de16d251">total_i</a>, &amp;data);
<a name="l00245"></a>00245     <span class="keywordflow">return</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#af89e74d2dcf3eef15b29fa6015984af3">SIZET2NUM</a>(data.<a class="code" href="../../d6/d97/structtotal__data.html#a5f9a51591f97291ef3de8650ec6a5974">total</a>);
<a name="l00246"></a>00246 }
<a name="l00247"></a>00247 
<a name="l00248"></a>00248 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l00249"></a><a class="code" href="../../d3/d4e/objspace_8c.html#ab48f1e867488f28c7ba03d5b203e055f">00249</a> <a class="code" href="../../d3/d4e/objspace_8c.html#ab48f1e867488f28c7ba03d5b203e055f">set_zero_i</a>(<a class="code" href="../../de/dce/syck_8h.html#a8a45dfe133c1fd041e1b902bda9e43e8">st_data_t</a> <a class="code" href="../../dc/de5/random_8c.html#a742229490b6759a90ece7ba82ba129d5">key</a>, <a class="code" href="../../de/dce/syck_8h.html#a8a45dfe133c1fd041e1b902bda9e43e8">st_data_t</a> val, <a class="code" href="../../de/dce/syck_8h.html#a8a45dfe133c1fd041e1b902bda9e43e8">st_data_t</a> arg)
<a name="l00250"></a>00250 {
<a name="l00251"></a>00251     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> k = (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>)key;
<a name="l00252"></a>00252     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <a class="code" href="../../d3/deb/lex_8c.html#a5541f85ce416df233cce93949f0eeeca">hash</a> = (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>)arg;
<a name="l00253"></a>00253     <a class="code" href="../../d1/d04/hash_8c.html#ac477edf136d86a33bc06d1fbea67bb9a">rb_hash_aset</a>(hash, k, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(0));
<a name="l00254"></a>00254     <span class="keywordflow">return</span> <a class="code" href="../../dd/d24/st_8h.html#a0c6a172fd99de7928916e65034ed8b1fac99fc55c7f355bf9071739a4bc2ea139">ST_CONTINUE</a>;
<a name="l00255"></a>00255 }
<a name="l00256"></a>00256 
<a name="l00257"></a>00257 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l00258"></a><a class="code" href="../../d3/d4e/objspace_8c.html#a81ea822ca39890a98a35b72bf345fa09">00258</a> <a class="code" href="../../d3/d4e/objspace_8c.html#a81ea822ca39890a98a35b72bf345fa09">cos_i</a>(<span class="keywordtype">void</span> *vstart, <span class="keywordtype">void</span> *vend, <span class="keywordtype">size_t</span> stride, <span class="keywordtype">void</span> *data)
<a name="l00259"></a>00259 {
<a name="l00260"></a>00260     <span class="keywordtype">size_t</span> *counts = (<span class="keywordtype">size_t</span> *)data;
<a name="l00261"></a>00261     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> v = (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>)vstart;
<a name="l00262"></a>00262 
<a name="l00263"></a>00263     <span class="keywordflow">for</span> (;v != (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>)vend; v += stride) {
<a name="l00264"></a>00264         <span class="keywordflow">if</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a1d4c05021aacd8cab989ff60f95ebe2d">RBASIC</a>(v)-&gt;flags) {
<a name="l00265"></a>00265             counts[<a class="code" href="../../de/de6/ruby_2ruby_8h.html#aee74f540353cd2d77d1cb37a3714bd7d">BUILTIN_TYPE</a>(v)] += <a class="code" href="../../d3/d4e/objspace_8c.html#a4d95ce7a52fd4fd445835c0d67b4a4a6">memsize_of</a>(v);
<a name="l00266"></a>00266         }
<a name="l00267"></a>00267     }
<a name="l00268"></a>00268     <span class="keywordflow">return</span> 0;
<a name="l00269"></a>00269 }
<a name="l00270"></a>00270 
<a name="l00271"></a>00271 <span class="comment">/*</span>
<a name="l00272"></a>00272 <span class="comment"> *  call-seq:</span>
<a name="l00273"></a>00273 <span class="comment"> *    ObjectSpace.count_objects_size([result_hash]) -&gt; hash</span>
<a name="l00274"></a>00274 <span class="comment"> *</span>
<a name="l00275"></a>00275 <span class="comment"> *  Counts objects size (in bytes) for each type.</span>
<a name="l00276"></a>00276 <span class="comment"> *</span>
<a name="l00277"></a>00277 <span class="comment"> *  Note that this information is incomplete.  You need to deal with</span>
<a name="l00278"></a>00278 <span class="comment"> *  this information as only a *HINT*.  Especially, total size of</span>
<a name="l00279"></a>00279 <span class="comment"> *  T_DATA may not right size.</span>
<a name="l00280"></a>00280 <span class="comment"> *</span>
<a name="l00281"></a>00281 <span class="comment"> *  It returns a hash as:</span>
<a name="l00282"></a>00282 <span class="comment"> *    {:TOTAL=&gt;1461154, :T_CLASS=&gt;158280, :T_MODULE=&gt;20672, :T_STRING=&gt;527249, ...}</span>
<a name="l00283"></a>00283 <span class="comment"> *</span>
<a name="l00284"></a>00284 <span class="comment"> *  If the optional argument, result_hash, is given,</span>
<a name="l00285"></a>00285 <span class="comment"> *  it is overwritten and returned.</span>
<a name="l00286"></a>00286 <span class="comment"> *  This is intended to avoid probe effect.</span>
<a name="l00287"></a>00287 <span class="comment"> *</span>
<a name="l00288"></a>00288 <span class="comment"> *  The contents of the returned hash is implementation defined.</span>
<a name="l00289"></a>00289 <span class="comment"> *  It may be changed in future.</span>
<a name="l00290"></a>00290 <span class="comment"> *</span>
<a name="l00291"></a>00291 <span class="comment"> *  This method is not expected to work except C Ruby.</span>
<a name="l00292"></a>00292 <span class="comment"> */</span>
<a name="l00293"></a>00293 
<a name="l00294"></a>00294 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l00295"></a><a class="code" href="../../d3/d4e/objspace_8c.html#a85d2ca151ddd4781f8ff9c113ca80437">00295</a> <a class="code" href="../../d3/d4e/objspace_8c.html#a85d2ca151ddd4781f8ff9c113ca80437">count_objects_size</a>(<span class="keywordtype">int</span> <a class="code" href="../../df/d77/ruby_8c.html#ad1447518f4372828b8435ae82e48499e">argc</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> *<a class="code" href="../../df/d77/ruby_8c.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> os)
<a name="l00296"></a>00296 {
<a name="l00297"></a>00297     <span class="keywordtype">size_t</span> counts[<a class="code" href="../../d7/d6c/md5_8c.html#a2d8a5083a030f6b36bc9a5fe6d71b519">T_MASK</a>+1];
<a name="l00298"></a>00298     <span class="keywordtype">size_t</span> <a class="code" href="../../d6/d97/structtotal__data.html#a5f9a51591f97291ef3de8650ec6a5974">total</a> = 0;
<a name="l00299"></a>00299     <span class="keywordtype">size_t</span> i;
<a name="l00300"></a>00300     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <a class="code" href="../../d3/deb/lex_8c.html#a5541f85ce416df233cce93949f0eeeca">hash</a>;
<a name="l00301"></a>00301 
<a name="l00302"></a>00302     <span class="keywordflow">if</span> (<a class="code" href="../../d7/d19/group__defmethod.html#gaa7bed88640f01bee619f85fda09d28d7">rb_scan_args</a>(argc, argv, <span class="stringliteral">&quot;01&quot;</span>, &amp;hash) == 1) {
<a name="l00303"></a>00303         <span class="keywordflow">if</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a394faf7191f18552a20cb17ce14226f0">TYPE</a>(hash) != <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a8357e81bbb60cb41b0a292a90653a5e5">T_HASH</a>)
<a name="l00304"></a>00304             <a class="code" href="../../db/dcc/error_8c.html#a0f771a2840561f1838169b3d7d4616f3">rb_raise</a>(<a class="code" href="../../db/dcc/error_8c.html#a565ed9d70f4089e1b4a36e9b3381b8c6">rb_eTypeError</a>, <span class="stringliteral">&quot;non-hash given&quot;</span>);
<a name="l00305"></a>00305     }
<a name="l00306"></a>00306 
<a name="l00307"></a>00307     <span class="keywordflow">for</span> (i = 0; i &lt;= <a class="code" href="../../d7/d6c/md5_8c.html#a2d8a5083a030f6b36bc9a5fe6d71b519">T_MASK</a>; i++) {
<a name="l00308"></a>00308         counts[i] = 0;
<a name="l00309"></a>00309     }
<a name="l00310"></a>00310 
<a name="l00311"></a>00311     <a class="code" href="../../d8/d16/gc_8c.html#ac2b65f7b2d778d973bfc7f0bf0c3dc62">rb_objspace_each_objects</a>(<a class="code" href="../../d3/d4e/objspace_8c.html#a81ea822ca39890a98a35b72bf345fa09">cos_i</a>, &amp;counts[0]);
<a name="l00312"></a>00312 
<a name="l00313"></a>00313     <span class="keywordflow">if</span> (hash == <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a320970f989dc8294c8203154e3db40c1">Qnil</a>) {
<a name="l00314"></a>00314         hash = <a class="code" href="../../d1/d04/hash_8c.html#af1da586524a3a1739fd5b91272037815">rb_hash_new</a>();
<a name="l00315"></a>00315     }
<a name="l00316"></a>00316     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!<a class="code" href="../../de/de6/ruby_2ruby_8h.html#ae6e9dfb04b81ecb03ec6c087498521ea">RHASH_EMPTY_P</a>(hash)) {
<a name="l00317"></a>00317         <a class="code" href="../../dd/d24/st_8h.html#ace5a79870d2800659a653fceeca55262">st_foreach</a>(<a class="code" href="../../d9/dee/tkutil_8c.html#ad8dd7fb0cbee1955c393251e8bb97233">RHASH_TBL</a>(hash), <a class="code" href="../../d3/d4e/objspace_8c.html#ab48f1e867488f28c7ba03d5b203e055f">set_zero_i</a>, hash);
<a name="l00318"></a>00318     }
<a name="l00319"></a>00319 
<a name="l00320"></a>00320     <span class="keywordflow">for</span> (i = 0; i &lt;= <a class="code" href="../../d7/d6c/md5_8c.html#a2d8a5083a030f6b36bc9a5fe6d71b519">T_MASK</a>; i++) {
<a name="l00321"></a>00321         <span class="keywordflow">if</span> (counts[i]) {
<a name="l00322"></a>00322             <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <a class="code" href="../../d5/d9d/tcltklib_8c.html#ac765329451135abec74c45e1897abf26">type</a>;
<a name="l00323"></a>00323             <span class="keywordflow">switch</span> (i) {
<a name="l00324"></a>00324 <span class="preprocessor">#define COUNT_TYPE(t) case t: type = ID2SYM(rb_intern(#t)); break;</span>
<a name="l00325"></a>00325 <span class="preprocessor"></span>                <a class="code" href="../../d3/d4e/objspace_8c.html#a47838c29131badbfa19a6ee20c55e4b8">COUNT_TYPE</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a5efefe46b598af6f98c691fead03682d">T_NONE</a>);
<a name="l00326"></a>00326                 <a class="code" href="../../d3/d4e/objspace_8c.html#a47838c29131badbfa19a6ee20c55e4b8">COUNT_TYPE</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#abed71c72d5c3083041d52ad25630270e">T_OBJECT</a>);
<a name="l00327"></a>00327                 <a class="code" href="../../d3/d4e/objspace_8c.html#a47838c29131badbfa19a6ee20c55e4b8">COUNT_TYPE</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#ad04c63d175774c6d6e7dfaf0f0a982c9">T_CLASS</a>);
<a name="l00328"></a>00328                 <a class="code" href="../../d3/d4e/objspace_8c.html#a47838c29131badbfa19a6ee20c55e4b8">COUNT_TYPE</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a6cdc7dfe8f84777325da08a96ae5f795">T_MODULE</a>);
<a name="l00329"></a>00329                 <a class="code" href="../../d3/d4e/objspace_8c.html#a47838c29131badbfa19a6ee20c55e4b8">COUNT_TYPE</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3d072e0c25cf678e9b8601b957b92eae">T_FLOAT</a>);
<a name="l00330"></a>00330                 <a class="code" href="../../d3/d4e/objspace_8c.html#a47838c29131badbfa19a6ee20c55e4b8">COUNT_TYPE</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a22a8c2a4bbaae9b68f65c9bb92fd4e39">T_STRING</a>);
<a name="l00331"></a>00331                 <a class="code" href="../../d3/d4e/objspace_8c.html#a47838c29131badbfa19a6ee20c55e4b8">COUNT_TYPE</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#afd5c1e36d171ecc04514332e8dcf6388">T_REGEXP</a>);
<a name="l00332"></a>00332                 <a class="code" href="../../d3/d4e/objspace_8c.html#a47838c29131badbfa19a6ee20c55e4b8">COUNT_TYPE</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#abbd332f6f94d77e0a369c7720128639e">T_ARRAY</a>);
<a name="l00333"></a>00333                 <a class="code" href="../../d3/d4e/objspace_8c.html#a47838c29131badbfa19a6ee20c55e4b8">COUNT_TYPE</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a8357e81bbb60cb41b0a292a90653a5e5">T_HASH</a>);
<a name="l00334"></a>00334                 <a class="code" href="../../d3/d4e/objspace_8c.html#a47838c29131badbfa19a6ee20c55e4b8">COUNT_TYPE</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a4853f60a017b2b7a126d3e23db98a954">T_STRUCT</a>);
<a name="l00335"></a>00335                 <a class="code" href="../../d3/d4e/objspace_8c.html#a47838c29131badbfa19a6ee20c55e4b8">COUNT_TYPE</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a41ac74a27dd1eadc2ca86d10590f2163">T_BIGNUM</a>);
<a name="l00336"></a>00336                 <a class="code" href="../../d3/d4e/objspace_8c.html#a47838c29131badbfa19a6ee20c55e4b8">COUNT_TYPE</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a0a8afbed81f5fb3930e9d153fbd51737">T_FILE</a>);
<a name="l00337"></a>00337                 <a class="code" href="../../d3/d4e/objspace_8c.html#a47838c29131badbfa19a6ee20c55e4b8">COUNT_TYPE</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a55f295817faf14e42b3cff745a7ac706">T_DATA</a>);
<a name="l00338"></a>00338                 <a class="code" href="../../d3/d4e/objspace_8c.html#a47838c29131badbfa19a6ee20c55e4b8">COUNT_TYPE</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#acc66e9c9228bc7ad6f292a253ce5fdf4">T_MATCH</a>);
<a name="l00339"></a>00339                 <a class="code" href="../../d3/d4e/objspace_8c.html#a47838c29131badbfa19a6ee20c55e4b8">COUNT_TYPE</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a05f3b14562e8d1e2d09e7a4438c1d2fa">T_COMPLEX</a>);
<a name="l00340"></a>00340                 <a class="code" href="../../d3/d4e/objspace_8c.html#a47838c29131badbfa19a6ee20c55e4b8">COUNT_TYPE</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a804d1259cf2408f16969b2dc06b293fc">T_RATIONAL</a>);
<a name="l00341"></a>00341                 <a class="code" href="../../d3/d4e/objspace_8c.html#a47838c29131badbfa19a6ee20c55e4b8">COUNT_TYPE</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3a7d10c48d5dff0a5d4aa94acb74811a">T_NIL</a>);
<a name="l00342"></a>00342                 <a class="code" href="../../d3/d4e/objspace_8c.html#a47838c29131badbfa19a6ee20c55e4b8">COUNT_TYPE</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a7fc7e09f45d0ef129ea29f3a5b0c32b8">T_TRUE</a>);
<a name="l00343"></a>00343                 <a class="code" href="../../d3/d4e/objspace_8c.html#a47838c29131badbfa19a6ee20c55e4b8">COUNT_TYPE</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a9ab816c37c9173898ff256b7be9e5ea9">T_FALSE</a>);
<a name="l00344"></a>00344                 <a class="code" href="../../d3/d4e/objspace_8c.html#a47838c29131badbfa19a6ee20c55e4b8">COUNT_TYPE</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac9aadbc1e9c456506a4d7eef5cdc787e">T_SYMBOL</a>);
<a name="l00345"></a>00345                 <a class="code" href="../../d3/d4e/objspace_8c.html#a47838c29131badbfa19a6ee20c55e4b8">COUNT_TYPE</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a523855de5546c34061e030f4606db3e9">T_FIXNUM</a>);
<a name="l00346"></a>00346                 <a class="code" href="../../d3/d4e/objspace_8c.html#a47838c29131badbfa19a6ee20c55e4b8">COUNT_TYPE</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#aa4f8e81f0956ff42a2e18ae2ff115f44">T_UNDEF</a>);
<a name="l00347"></a>00347                 <a class="code" href="../../d3/d4e/objspace_8c.html#a47838c29131badbfa19a6ee20c55e4b8">COUNT_TYPE</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a5f1cc49c4da51d5bdffa64be79ff6fb0">T_NODE</a>);
<a name="l00348"></a>00348                 <a class="code" href="../../d3/d4e/objspace_8c.html#a47838c29131badbfa19a6ee20c55e4b8">COUNT_TYPE</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a82c8c4569748b9645c958b9eaeaabb81">T_ICLASS</a>);
<a name="l00349"></a>00349                 <a class="code" href="../../d3/d4e/objspace_8c.html#a47838c29131badbfa19a6ee20c55e4b8">COUNT_TYPE</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#ab80c70472770bcae8d33bbf6139262d0">T_ZOMBIE</a>);
<a name="l00350"></a>00350 <span class="preprocessor">#undef COUNT_TYPE</span>
<a name="l00351"></a>00351 <span class="preprocessor"></span>              <span class="keywordflow">default</span>: type = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aca9f83a35416ed9d6e0b860afa5eaf0f">INT2NUM</a>(i); <span class="keywordflow">break</span>;
<a name="l00352"></a>00352             }
<a name="l00353"></a>00353             total += counts[i];
<a name="l00354"></a>00354             <a class="code" href="../../d1/d04/hash_8c.html#ac477edf136d86a33bc06d1fbea67bb9a">rb_hash_aset</a>(hash, type, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#af89e74d2dcf3eef15b29fa6015984af3">SIZET2NUM</a>(counts[i]));
<a name="l00355"></a>00355         }
<a name="l00356"></a>00356     }
<a name="l00357"></a>00357     <a class="code" href="../../d1/d04/hash_8c.html#ac477edf136d86a33bc06d1fbea67bb9a">rb_hash_aset</a>(hash, <a class="code" href="../../dc/d0c/cparse_8c.html#a48bfb6519a45249fb2ec0193ea3b6e1c">ID2SYM</a>(<a class="code" href="../../dc/dcc/array_8c.html#a9cfa42d4b79c89d68c53be8b2150a503">rb_intern</a>(<span class="stringliteral">&quot;TOTAL&quot;</span>)), <a class="code" href="../../de/de6/ruby_2ruby_8h.html#af89e74d2dcf3eef15b29fa6015984af3">SIZET2NUM</a>(total));
<a name="l00358"></a>00358     <span class="keywordflow">return</span> hash;
<a name="l00359"></a>00359 }
<a name="l00360"></a>00360 
<a name="l00361"></a>00361 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l00362"></a><a class="code" href="../../d3/d4e/objspace_8c.html#a9621f4441dc039d27482031944844c8a">00362</a> <a class="code" href="../../d3/d4e/objspace_8c.html#a9621f4441dc039d27482031944844c8a">cn_i</a>(<span class="keywordtype">void</span> *vstart, <span class="keywordtype">void</span> *vend, <span class="keywordtype">size_t</span> stride, <span class="keywordtype">void</span> *n)
<a name="l00363"></a>00363 {
<a name="l00364"></a>00364     <span class="keywordtype">size_t</span> *nodes = (<span class="keywordtype">size_t</span> *)n;
<a name="l00365"></a>00365     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> v = (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>)vstart;
<a name="l00366"></a>00366 
<a name="l00367"></a>00367     <span class="keywordflow">for</span> (; v != (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>)vend; v += stride) {
<a name="l00368"></a>00368         <span class="keywordflow">if</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a1d4c05021aacd8cab989ff60f95ebe2d">RBASIC</a>(v)-&gt;flags &amp;&amp; <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aee74f540353cd2d77d1cb37a3714bd7d">BUILTIN_TYPE</a>(v) == <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a5f1cc49c4da51d5bdffa64be79ff6fb0">T_NODE</a>) {
<a name="l00369"></a>00369             <span class="keywordtype">size_t</span> s = <a class="code" href="../../d3/d09/ripper_8y.html#ade12c589b26f55f089dc25d689249c11">nd_type</a>((NODE *)v);
<a name="l00370"></a>00370             nodes[s]++;
<a name="l00371"></a>00371         }
<a name="l00372"></a>00372     }
<a name="l00373"></a>00373 
<a name="l00374"></a>00374     <span class="keywordflow">return</span> 0;
<a name="l00375"></a>00375 }
<a name="l00376"></a>00376 
<a name="l00377"></a>00377 <span class="comment">/*</span>
<a name="l00378"></a>00378 <span class="comment"> *  call-seq:</span>
<a name="l00379"></a>00379 <span class="comment"> *     ObjectSpace.count_nodes([result_hash]) -&gt; hash</span>
<a name="l00380"></a>00380 <span class="comment"> *</span>
<a name="l00381"></a>00381 <span class="comment"> *  Counts nodes for each node type.</span>
<a name="l00382"></a>00382 <span class="comment"> *</span>
<a name="l00383"></a>00383 <span class="comment"> *  This method is not for ordinary Ruby programmers, but for MRI developers</span>
<a name="l00384"></a>00384 <span class="comment"> *  who have interest in MRI performance and memory usage.</span>
<a name="l00385"></a>00385 <span class="comment"> *</span>
<a name="l00386"></a>00386 <span class="comment"> *  It returns a hash as:</span>
<a name="l00387"></a>00387 <span class="comment"> *  {:NODE_METHOD=&gt;2027, :NODE_FBODY=&gt;1927, :NODE_CFUNC=&gt;1798, ...}</span>
<a name="l00388"></a>00388 <span class="comment"> *</span>
<a name="l00389"></a>00389 <span class="comment"> *  If the optional argument, result_hash, is given,</span>
<a name="l00390"></a>00390 <span class="comment"> *  it is overwritten and returned.</span>
<a name="l00391"></a>00391 <span class="comment"> *  This is intended to avoid probe effect.</span>
<a name="l00392"></a>00392 <span class="comment"> *</span>
<a name="l00393"></a>00393 <span class="comment"> *  The contents of the returned hash is implementation defined.</span>
<a name="l00394"></a>00394 <span class="comment"> *  It may be changed in future.</span>
<a name="l00395"></a>00395 <span class="comment"> *</span>
<a name="l00396"></a>00396 <span class="comment"> *  This method is not expected to work except C Ruby.</span>
<a name="l00397"></a>00397 <span class="comment"> */</span>
<a name="l00398"></a>00398 
<a name="l00399"></a>00399 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l00400"></a><a class="code" href="../../d3/d4e/objspace_8c.html#a64298c8d36e022012363a9e4c2445ecb">00400</a> <a class="code" href="../../d3/d4e/objspace_8c.html#a64298c8d36e022012363a9e4c2445ecb">count_nodes</a>(<span class="keywordtype">int</span> <a class="code" href="../../df/d77/ruby_8c.html#ad1447518f4372828b8435ae82e48499e">argc</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> *<a class="code" href="../../df/d77/ruby_8c.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> os)
<a name="l00401"></a>00401 {
<a name="l00402"></a>00402     <span class="keywordtype">size_t</span> nodes[<a class="code" href="../../d3/d09/ripper_8y.html#a285afede2f1e1f404a29f0a75055661f">NODE_LAST</a>+1];
<a name="l00403"></a>00403     <span class="keywordtype">size_t</span> i;
<a name="l00404"></a>00404     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <a class="code" href="../../d3/deb/lex_8c.html#a5541f85ce416df233cce93949f0eeeca">hash</a>;
<a name="l00405"></a>00405 
<a name="l00406"></a>00406     <span class="keywordflow">if</span> (<a class="code" href="../../d7/d19/group__defmethod.html#gaa7bed88640f01bee619f85fda09d28d7">rb_scan_args</a>(argc, argv, <span class="stringliteral">&quot;01&quot;</span>, &amp;hash) == 1) {
<a name="l00407"></a>00407         <span class="keywordflow">if</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a394faf7191f18552a20cb17ce14226f0">TYPE</a>(hash) != <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a8357e81bbb60cb41b0a292a90653a5e5">T_HASH</a>)
<a name="l00408"></a>00408             <a class="code" href="../../db/dcc/error_8c.html#a0f771a2840561f1838169b3d7d4616f3">rb_raise</a>(<a class="code" href="../../db/dcc/error_8c.html#a565ed9d70f4089e1b4a36e9b3381b8c6">rb_eTypeError</a>, <span class="stringliteral">&quot;non-hash given&quot;</span>);
<a name="l00409"></a>00409     }
<a name="l00410"></a>00410 
<a name="l00411"></a>00411     <span class="keywordflow">for</span> (i = 0; i &lt;= <a class="code" href="../../d3/d09/ripper_8y.html#a285afede2f1e1f404a29f0a75055661f">NODE_LAST</a>; i++) {
<a name="l00412"></a>00412         nodes[i] = 0;
<a name="l00413"></a>00413     }
<a name="l00414"></a>00414 
<a name="l00415"></a>00415     <a class="code" href="../../d8/d16/gc_8c.html#ac2b65f7b2d778d973bfc7f0bf0c3dc62">rb_objspace_each_objects</a>(<a class="code" href="../../d3/d4e/objspace_8c.html#a9621f4441dc039d27482031944844c8a">cn_i</a>, &amp;nodes[0]);
<a name="l00416"></a>00416 
<a name="l00417"></a>00417     <span class="keywordflow">if</span> (hash == <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a320970f989dc8294c8203154e3db40c1">Qnil</a>) {
<a name="l00418"></a>00418         hash = <a class="code" href="../../d1/d04/hash_8c.html#af1da586524a3a1739fd5b91272037815">rb_hash_new</a>();
<a name="l00419"></a>00419     }
<a name="l00420"></a>00420     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!<a class="code" href="../../de/de6/ruby_2ruby_8h.html#ae6e9dfb04b81ecb03ec6c087498521ea">RHASH_EMPTY_P</a>(hash)) {
<a name="l00421"></a>00421         <a class="code" href="../../dd/d24/st_8h.html#ace5a79870d2800659a653fceeca55262">st_foreach</a>(<a class="code" href="../../d9/dee/tkutil_8c.html#ad8dd7fb0cbee1955c393251e8bb97233">RHASH_TBL</a>(hash), <a class="code" href="../../d3/d4e/objspace_8c.html#ab48f1e867488f28c7ba03d5b203e055f">set_zero_i</a>, hash);
<a name="l00422"></a>00422     }
<a name="l00423"></a>00423 
<a name="l00424"></a>00424     <span class="keywordflow">for</span> (i=0; i&lt;<a class="code" href="../../d3/d09/ripper_8y.html#a285afede2f1e1f404a29f0a75055661f">NODE_LAST</a>; i++) {
<a name="l00425"></a>00425         <span class="keywordflow">if</span> (nodes[i] != 0) {
<a name="l00426"></a>00426             <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <a class="code" href="../../d7/dc0/parse_8y.html#a0d7af8a92c4b0a07f71585584ef9634f">node</a>;
<a name="l00427"></a>00427             <span class="keywordflow">switch</span> (i) {
<a name="l00428"></a>00428 <span class="preprocessor">#define COUNT_NODE(n) case n: node = ID2SYM(rb_intern(#n)); break;</span>
<a name="l00429"></a>00429 <span class="preprocessor"></span>                <a class="code" href="../../d3/d4e/objspace_8c.html#ab6eb8483a261b12b34fb0ec958f184e9">COUNT_NODE</a>(<a class="code" href="../../d3/d09/ripper_8y.html#ac6983f7134e356786ebe01ddea8985cd">NODE_SCOPE</a>);
<a name="l00430"></a>00430                 <a class="code" href="../../d3/d4e/objspace_8c.html#ab6eb8483a261b12b34fb0ec958f184e9">COUNT_NODE</a>(<a class="code" href="../../d3/d09/ripper_8y.html#ae26c9ff309f6c5d0fd5c3edd0232ee0d">NODE_BLOCK</a>);
<a name="l00431"></a>00431                 <a class="code" href="../../d3/d4e/objspace_8c.html#ab6eb8483a261b12b34fb0ec958f184e9">COUNT_NODE</a>(<a class="code" href="../../d3/d09/ripper_8y.html#ab964a29f7a8cdb1e4b518b4cb7420ea5">NODE_IF</a>);
<a name="l00432"></a>00432                 <a class="code" href="../../d3/d4e/objspace_8c.html#ab6eb8483a261b12b34fb0ec958f184e9">COUNT_NODE</a>(<a class="code" href="../../d3/d09/ripper_8y.html#a73d8430547c57f3a7c0734b1a598ff8e">NODE_CASE</a>);
<a name="l00433"></a>00433                 <a class="code" href="../../d3/d4e/objspace_8c.html#ab6eb8483a261b12b34fb0ec958f184e9">COUNT_NODE</a>(<a class="code" href="../../d3/d09/ripper_8y.html#abe133b4015b1ff19345d5d25781fc25e">NODE_WHEN</a>);
<a name="l00434"></a>00434                 <a class="code" href="../../d3/d4e/objspace_8c.html#ab6eb8483a261b12b34fb0ec958f184e9">COUNT_NODE</a>(<a class="code" href="../../d3/d09/ripper_8y.html#a25c86d19e5399c64a4d3b1278e158272">NODE_OPT_N</a>);
<a name="l00435"></a>00435                 <a class="code" href="../../d3/d4e/objspace_8c.html#ab6eb8483a261b12b34fb0ec958f184e9">COUNT_NODE</a>(<a class="code" href="../../d3/d09/ripper_8y.html#a271e594a40ed0575457ea8d9def940ac">NODE_WHILE</a>);
<a name="l00436"></a>00436                 <a class="code" href="../../d3/d4e/objspace_8c.html#ab6eb8483a261b12b34fb0ec958f184e9">COUNT_NODE</a>(<a class="code" href="../../d3/d09/ripper_8y.html#af25da300c34f1bca6c6e4df28947cb72">NODE_UNTIL</a>);
<a name="l00437"></a>00437                 <a class="code" href="../../d3/d4e/objspace_8c.html#ab6eb8483a261b12b34fb0ec958f184e9">COUNT_NODE</a>(<a class="code" href="../../d3/d09/ripper_8y.html#a729d82aaada1fbeac7bf4592aa467b76">NODE_ITER</a>);
<a name="l00438"></a>00438                 <a class="code" href="../../d3/d4e/objspace_8c.html#ab6eb8483a261b12b34fb0ec958f184e9">COUNT_NODE</a>(<a class="code" href="../../d3/d09/ripper_8y.html#a89c760fc0f7a2209bcac44c5c7907950">NODE_FOR</a>);
<a name="l00439"></a>00439                 <a class="code" href="../../d3/d4e/objspace_8c.html#ab6eb8483a261b12b34fb0ec958f184e9">COUNT_NODE</a>(<a class="code" href="../../d3/d09/ripper_8y.html#ac20bfa82bfa40e0dbcb4c41c2d5ee603">NODE_BREAK</a>);
<a name="l00440"></a>00440                 <a class="code" href="../../d3/d4e/objspace_8c.html#ab6eb8483a261b12b34fb0ec958f184e9">COUNT_NODE</a>(<a class="code" href="../../d3/d09/ripper_8y.html#a419512cc7a70c27779dfb2fb3ca71a5a">NODE_NEXT</a>);
<a name="l00441"></a>00441                 <a class="code" href="../../d3/d4e/objspace_8c.html#ab6eb8483a261b12b34fb0ec958f184e9">COUNT_NODE</a>(<a class="code" href="../../d3/d09/ripper_8y.html#a18d2e6f19f54d07ba73aa95f4eab97d3">NODE_REDO</a>);
<a name="l00442"></a>00442                 <a class="code" href="../../d3/d4e/objspace_8c.html#ab6eb8483a261b12b34fb0ec958f184e9">COUNT_NODE</a>(<a class="code" href="../../d3/d09/ripper_8y.html#ab34acb27dadef25e21806f3c6e8e0b2e">NODE_RETRY</a>);
<a name="l00443"></a>00443                 <a class="code" href="../../d3/d4e/objspace_8c.html#ab6eb8483a261b12b34fb0ec958f184e9">COUNT_NODE</a>(<a class="code" href="../../d3/d09/ripper_8y.html#a5108b748a0833a5e734a91e4f3719510">NODE_BEGIN</a>);
<a name="l00444"></a>00444                 <a class="code" href="../../d3/d4e/objspace_8c.html#ab6eb8483a261b12b34fb0ec958f184e9">COUNT_NODE</a>(<a class="code" href="../../d3/d09/ripper_8y.html#a2e2ee74ca4f1fe85350a59ae648d6310">NODE_RESCUE</a>);
<a name="l00445"></a>00445                 <a class="code" href="../../d3/d4e/objspace_8c.html#ab6eb8483a261b12b34fb0ec958f184e9">COUNT_NODE</a>(<a class="code" href="../../d3/d09/ripper_8y.html#a1fa11202ec4f8e4011503e785d2a019b">NODE_RESBODY</a>);
<a name="l00446"></a>00446                 <a class="code" href="../../d3/d4e/objspace_8c.html#ab6eb8483a261b12b34fb0ec958f184e9">COUNT_NODE</a>(<a class="code" href="../../d3/d09/ripper_8y.html#abd2d897cf3ea6a0b59b4cafb72d99b4c">NODE_ENSURE</a>);
<a name="l00447"></a>00447                 <a class="code" href="../../d3/d4e/objspace_8c.html#ab6eb8483a261b12b34fb0ec958f184e9">COUNT_NODE</a>(<a class="code" href="../../d3/d09/ripper_8y.html#afce3dc60f5eb8de336e40138600ef910">NODE_AND</a>);
<a name="l00448"></a>00448                 <a class="code" href="../../d3/d4e/objspace_8c.html#ab6eb8483a261b12b34fb0ec958f184e9">COUNT_NODE</a>(<a class="code" href="../../d3/d09/ripper_8y.html#addcdfeefb5907f74a7b172a710c8d45e">NODE_OR</a>);
<a name="l00449"></a>00449                 <a class="code" href="../../d3/d4e/objspace_8c.html#ab6eb8483a261b12b34fb0ec958f184e9">COUNT_NODE</a>(<a class="code" href="../../d3/d09/ripper_8y.html#ad03c15faf9f8ca478889f491431b406b">NODE_MASGN</a>);
<a name="l00450"></a>00450                 <a class="code" href="../../d3/d4e/objspace_8c.html#ab6eb8483a261b12b34fb0ec958f184e9">COUNT_NODE</a>(<a class="code" href="../../d3/d09/ripper_8y.html#aa9d208a2eb1e5266beea027e10f3d472">NODE_LASGN</a>);
<a name="l00451"></a>00451                 <a class="code" href="../../d3/d4e/objspace_8c.html#ab6eb8483a261b12b34fb0ec958f184e9">COUNT_NODE</a>(<a class="code" href="../../d3/d09/ripper_8y.html#af92abe71c6571a24b59b4eb4ebb5908f">NODE_DASGN</a>);
<a name="l00452"></a>00452                 <a class="code" href="../../d3/d4e/objspace_8c.html#ab6eb8483a261b12b34fb0ec958f184e9">COUNT_NODE</a>(<a class="code" href="../../d3/d09/ripper_8y.html#aa69a9128d7cd7376dc4d76e65d90e994">NODE_DASGN_CURR</a>);
<a name="l00453"></a>00453                 <a class="code" href="../../d3/d4e/objspace_8c.html#ab6eb8483a261b12b34fb0ec958f184e9">COUNT_NODE</a>(<a class="code" href="../../d3/d09/ripper_8y.html#acc59e8bf53d75d27835d03ee9bbac630">NODE_GASGN</a>);
<a name="l00454"></a>00454                 <a class="code" href="../../d3/d4e/objspace_8c.html#ab6eb8483a261b12b34fb0ec958f184e9">COUNT_NODE</a>(<a class="code" href="../../d3/d09/ripper_8y.html#a4e3d1029dca72147900e9b1a840bf968">NODE_IASGN</a>);
<a name="l00455"></a>00455                 <a class="code" href="../../d3/d4e/objspace_8c.html#ab6eb8483a261b12b34fb0ec958f184e9">COUNT_NODE</a>(<a class="code" href="../../d3/d09/ripper_8y.html#a015923f7f402969debebc4d989678ea4">NODE_IASGN2</a>);
<a name="l00456"></a>00456                 <a class="code" href="../../d3/d4e/objspace_8c.html#ab6eb8483a261b12b34fb0ec958f184e9">COUNT_NODE</a>(<a class="code" href="../../d3/d09/ripper_8y.html#a62bbab89538c1de14389202f9797ab3d">NODE_CDECL</a>);
<a name="l00457"></a>00457                 <a class="code" href="../../d3/d4e/objspace_8c.html#ab6eb8483a261b12b34fb0ec958f184e9">COUNT_NODE</a>(<a class="code" href="../../d3/d09/ripper_8y.html#ae0d7af3d0cea1ce334874826929507bf">NODE_CVASGN</a>);
<a name="l00458"></a>00458                 <a class="code" href="../../d3/d4e/objspace_8c.html#ab6eb8483a261b12b34fb0ec958f184e9">COUNT_NODE</a>(<a class="code" href="../../d3/d09/ripper_8y.html#a45ce5181ec29d7d5e45ff5931918dafc">NODE_CVDECL</a>);
<a name="l00459"></a>00459                 <a class="code" href="../../d3/d4e/objspace_8c.html#ab6eb8483a261b12b34fb0ec958f184e9">COUNT_NODE</a>(<a class="code" href="../../d3/d09/ripper_8y.html#a7ed32e1efe76c3f34ccf1ac4c9def39c">NODE_OP_ASGN1</a>);
<a name="l00460"></a>00460                 <a class="code" href="../../d3/d4e/objspace_8c.html#ab6eb8483a261b12b34fb0ec958f184e9">COUNT_NODE</a>(<a class="code" href="../../d3/d09/ripper_8y.html#a6a3094139c05b14867151b55cffdbad0">NODE_OP_ASGN2</a>);
<a name="l00461"></a>00461                 <a class="code" href="../../d3/d4e/objspace_8c.html#ab6eb8483a261b12b34fb0ec958f184e9">COUNT_NODE</a>(<a class="code" href="../../d3/d09/ripper_8y.html#a844d8faea88bfbb66bc0b43a20019df1">NODE_OP_ASGN_AND</a>);
<a name="l00462"></a>00462                 <a class="code" href="../../d3/d4e/objspace_8c.html#ab6eb8483a261b12b34fb0ec958f184e9">COUNT_NODE</a>(<a class="code" href="../../d3/d09/ripper_8y.html#a19f6bacf83d13be68f94e4d54a02bc5d">NODE_OP_ASGN_OR</a>);
<a name="l00463"></a>00463                 <a class="code" href="../../d3/d4e/objspace_8c.html#ab6eb8483a261b12b34fb0ec958f184e9">COUNT_NODE</a>(<a class="code" href="../../d3/d09/ripper_8y.html#ae72a414c065eefb25d29b0376ee93e3d">NODE_CALL</a>);
<a name="l00464"></a>00464                 <a class="code" href="../../d3/d4e/objspace_8c.html#ab6eb8483a261b12b34fb0ec958f184e9">COUNT_NODE</a>(<a class="code" href="../../d3/d09/ripper_8y.html#a611c4facbf6699e4b795320442ace55f">NODE_FCALL</a>);
<a name="l00465"></a>00465                 <a class="code" href="../../d3/d4e/objspace_8c.html#ab6eb8483a261b12b34fb0ec958f184e9">COUNT_NODE</a>(<a class="code" href="../../d3/d09/ripper_8y.html#ae2efc36a65904690f165fda092b0a8b1">NODE_VCALL</a>);
<a name="l00466"></a>00466                 <a class="code" href="../../d3/d4e/objspace_8c.html#ab6eb8483a261b12b34fb0ec958f184e9">COUNT_NODE</a>(<a class="code" href="../../d3/d09/ripper_8y.html#ab986d79d4c826e86db4b17dd331e7b80">NODE_SUPER</a>);
<a name="l00467"></a>00467                 <a class="code" href="../../d3/d4e/objspace_8c.html#ab6eb8483a261b12b34fb0ec958f184e9">COUNT_NODE</a>(<a class="code" href="../../d3/d09/ripper_8y.html#a5966d8a24f1a0b7ab182a430c3f92ccd">NODE_ZSUPER</a>);
<a name="l00468"></a>00468                 <a class="code" href="../../d3/d4e/objspace_8c.html#ab6eb8483a261b12b34fb0ec958f184e9">COUNT_NODE</a>(<a class="code" href="../../d3/d09/ripper_8y.html#a490d1fc6f7f9e81a1815e9b1c3080d94">NODE_ARRAY</a>);
<a name="l00469"></a>00469                 <a class="code" href="../../d3/d4e/objspace_8c.html#ab6eb8483a261b12b34fb0ec958f184e9">COUNT_NODE</a>(<a class="code" href="../../d3/d09/ripper_8y.html#acb7153a88fb24c846bd6751ca2fa9316">NODE_ZARRAY</a>);
<a name="l00470"></a>00470                 <a class="code" href="../../d3/d4e/objspace_8c.html#ab6eb8483a261b12b34fb0ec958f184e9">COUNT_NODE</a>(<a class="code" href="../../d3/d09/ripper_8y.html#a5d6b8dc54e03236c06b5092e4c5d5b07">NODE_VALUES</a>);
<a name="l00471"></a>00471                 <a class="code" href="../../d3/d4e/objspace_8c.html#ab6eb8483a261b12b34fb0ec958f184e9">COUNT_NODE</a>(<a class="code" href="../../d3/d09/ripper_8y.html#a9e0e908fdac1fc1cfcfba007f8ab1f6b">NODE_HASH</a>);
<a name="l00472"></a>00472                 <a class="code" href="../../d3/d4e/objspace_8c.html#ab6eb8483a261b12b34fb0ec958f184e9">COUNT_NODE</a>(<a class="code" href="../../d3/d09/ripper_8y.html#a0740a4cb8cfb60e24ac741779344739b">NODE_RETURN</a>);
<a name="l00473"></a>00473                 <a class="code" href="../../d3/d4e/objspace_8c.html#ab6eb8483a261b12b34fb0ec958f184e9">COUNT_NODE</a>(<a class="code" href="../../d3/d09/ripper_8y.html#a210571fb93e1d6ca4c50d6e897cd1d60">NODE_YIELD</a>);
<a name="l00474"></a>00474                 <a class="code" href="../../d3/d4e/objspace_8c.html#ab6eb8483a261b12b34fb0ec958f184e9">COUNT_NODE</a>(<a class="code" href="../../d3/d09/ripper_8y.html#aeb55bab156cfba6fcec9991e963bce3c">NODE_LVAR</a>);
<a name="l00475"></a>00475                 <a class="code" href="../../d3/d4e/objspace_8c.html#ab6eb8483a261b12b34fb0ec958f184e9">COUNT_NODE</a>(<a class="code" href="../../d3/d09/ripper_8y.html#af01a3b936fc2a83332b8314ef6b00697">NODE_DVAR</a>);
<a name="l00476"></a>00476                 <a class="code" href="../../d3/d4e/objspace_8c.html#ab6eb8483a261b12b34fb0ec958f184e9">COUNT_NODE</a>(<a class="code" href="../../d3/d09/ripper_8y.html#a19a08624c33d66f2ef3cfb66af6d9d9f">NODE_GVAR</a>);
<a name="l00477"></a>00477                 <a class="code" href="../../d3/d4e/objspace_8c.html#ab6eb8483a261b12b34fb0ec958f184e9">COUNT_NODE</a>(<a class="code" href="../../d3/d09/ripper_8y.html#a64cab035c0744c9f375bdf575e0cac2f">NODE_IVAR</a>);
<a name="l00478"></a>00478                 <a class="code" href="../../d3/d4e/objspace_8c.html#ab6eb8483a261b12b34fb0ec958f184e9">COUNT_NODE</a>(<a class="code" href="../../d3/d09/ripper_8y.html#a4162517fa8cb8e9bc4b9d9f6e8c32692">NODE_CONST</a>);
<a name="l00479"></a>00479                 <a class="code" href="../../d3/d4e/objspace_8c.html#ab6eb8483a261b12b34fb0ec958f184e9">COUNT_NODE</a>(<a class="code" href="../../d3/d09/ripper_8y.html#accf6c145831fd42cf9d6c816498ec82b">NODE_CVAR</a>);
<a name="l00480"></a>00480                 <a class="code" href="../../d3/d4e/objspace_8c.html#ab6eb8483a261b12b34fb0ec958f184e9">COUNT_NODE</a>(<a class="code" href="../../d3/d09/ripper_8y.html#a3ea55c01c2adc06cf9da2a42925ccf03">NODE_NTH_REF</a>);
<a name="l00481"></a>00481                 <a class="code" href="../../d3/d4e/objspace_8c.html#ab6eb8483a261b12b34fb0ec958f184e9">COUNT_NODE</a>(<a class="code" href="../../d3/d09/ripper_8y.html#a276fc132dec9ae10a63bf430e66a1064">NODE_BACK_REF</a>);
<a name="l00482"></a>00482                 <a class="code" href="../../d3/d4e/objspace_8c.html#ab6eb8483a261b12b34fb0ec958f184e9">COUNT_NODE</a>(<a class="code" href="../../d3/d09/ripper_8y.html#a4621f705bd2dfef90360d8d333d52015">NODE_MATCH</a>);
<a name="l00483"></a>00483                 <a class="code" href="../../d3/d4e/objspace_8c.html#ab6eb8483a261b12b34fb0ec958f184e9">COUNT_NODE</a>(<a class="code" href="../../d3/d09/ripper_8y.html#ada6ce553369f37deef93f9019262450a">NODE_MATCH2</a>);
<a name="l00484"></a>00484                 <a class="code" href="../../d3/d4e/objspace_8c.html#ab6eb8483a261b12b34fb0ec958f184e9">COUNT_NODE</a>(<a class="code" href="../../d3/d09/ripper_8y.html#af18fb86fc2079d7f21c0e918001865cd">NODE_MATCH3</a>);
<a name="l00485"></a>00485                 <a class="code" href="../../d3/d4e/objspace_8c.html#ab6eb8483a261b12b34fb0ec958f184e9">COUNT_NODE</a>(<a class="code" href="../../d3/d09/ripper_8y.html#af19d1c1d9f26c7b19546967449e887f6">NODE_LIT</a>);
<a name="l00486"></a>00486                 <a class="code" href="../../d3/d4e/objspace_8c.html#ab6eb8483a261b12b34fb0ec958f184e9">COUNT_NODE</a>(<a class="code" href="../../d3/d09/ripper_8y.html#aac55f53b58d8cbef84a61f2d744e7643">NODE_STR</a>);
<a name="l00487"></a>00487                 <a class="code" href="../../d3/d4e/objspace_8c.html#ab6eb8483a261b12b34fb0ec958f184e9">COUNT_NODE</a>(<a class="code" href="../../d3/d09/ripper_8y.html#a6487236f9718bcfe094a657cb0efd498">NODE_DSTR</a>);
<a name="l00488"></a>00488                 <a class="code" href="../../d3/d4e/objspace_8c.html#ab6eb8483a261b12b34fb0ec958f184e9">COUNT_NODE</a>(<a class="code" href="../../d3/d09/ripper_8y.html#a4850c3a60b6471d48bbb7b574cc3c3ca">NODE_XSTR</a>);
<a name="l00489"></a>00489                 <a class="code" href="../../d3/d4e/objspace_8c.html#ab6eb8483a261b12b34fb0ec958f184e9">COUNT_NODE</a>(<a class="code" href="../../d3/d09/ripper_8y.html#ac175ada0354ab81202c744d1db266a85">NODE_DXSTR</a>);
<a name="l00490"></a>00490                 <a class="code" href="../../d3/d4e/objspace_8c.html#ab6eb8483a261b12b34fb0ec958f184e9">COUNT_NODE</a>(<a class="code" href="../../d3/d09/ripper_8y.html#ad557cd9d6e3e99782e148e0ed5712826">NODE_EVSTR</a>);
<a name="l00491"></a>00491                 <a class="code" href="../../d3/d4e/objspace_8c.html#ab6eb8483a261b12b34fb0ec958f184e9">COUNT_NODE</a>(<a class="code" href="../../d3/d09/ripper_8y.html#a12aabedfc8eee47d21349ce818f3e60c">NODE_DREGX</a>);
<a name="l00492"></a>00492                 <a class="code" href="../../d3/d4e/objspace_8c.html#ab6eb8483a261b12b34fb0ec958f184e9">COUNT_NODE</a>(<a class="code" href="../../d3/d09/ripper_8y.html#a43e52cd8b79e69a358e2ff4082094d2b">NODE_DREGX_ONCE</a>);
<a name="l00493"></a>00493                 <a class="code" href="../../d3/d4e/objspace_8c.html#ab6eb8483a261b12b34fb0ec958f184e9">COUNT_NODE</a>(<a class="code" href="../../d3/d09/ripper_8y.html#a18b66c00780c5dbaa65fd104893c1027">NODE_ARGS</a>);
<a name="l00494"></a>00494                 <a class="code" href="../../d3/d4e/objspace_8c.html#ab6eb8483a261b12b34fb0ec958f184e9">COUNT_NODE</a>(<a class="code" href="../../d3/d09/ripper_8y.html#ad3b89428ec7a30b3ddeeba50778a1fd1">NODE_ARGS_AUX</a>);
<a name="l00495"></a>00495                 <a class="code" href="../../d3/d4e/objspace_8c.html#ab6eb8483a261b12b34fb0ec958f184e9">COUNT_NODE</a>(<a class="code" href="../../d3/d09/ripper_8y.html#af2b1989d52a7af5b39c0d680a9d27595">NODE_OPT_ARG</a>);
<a name="l00496"></a>00496                 <a class="code" href="../../d3/d4e/objspace_8c.html#ab6eb8483a261b12b34fb0ec958f184e9">COUNT_NODE</a>(<a class="code" href="../../d3/d09/ripper_8y.html#abe6cc100457a63dd4d47006cfd6a0a66">NODE_POSTARG</a>);
<a name="l00497"></a>00497                 <a class="code" href="../../d3/d4e/objspace_8c.html#ab6eb8483a261b12b34fb0ec958f184e9">COUNT_NODE</a>(<a class="code" href="../../d3/d09/ripper_8y.html#a796ba7c9f501e5f81b4f6f06972250fd">NODE_ARGSCAT</a>);
<a name="l00498"></a>00498                 <a class="code" href="../../d3/d4e/objspace_8c.html#ab6eb8483a261b12b34fb0ec958f184e9">COUNT_NODE</a>(<a class="code" href="../../d3/d09/ripper_8y.html#a15dc4d72c7b3a577d28e6131a63926d9">NODE_ARGSPUSH</a>);
<a name="l00499"></a>00499                 <a class="code" href="../../d3/d4e/objspace_8c.html#ab6eb8483a261b12b34fb0ec958f184e9">COUNT_NODE</a>(<a class="code" href="../../d3/d09/ripper_8y.html#a985f27752acfb29eca912c28522329c3">NODE_SPLAT</a>);
<a name="l00500"></a>00500                 <a class="code" href="../../d3/d4e/objspace_8c.html#ab6eb8483a261b12b34fb0ec958f184e9">COUNT_NODE</a>(<a class="code" href="../../d3/d09/ripper_8y.html#ac44e1d75073efc2baad77a3eae558bb3">NODE_TO_ARY</a>);
<a name="l00501"></a>00501                 <a class="code" href="../../d3/d4e/objspace_8c.html#ab6eb8483a261b12b34fb0ec958f184e9">COUNT_NODE</a>(<a class="code" href="../../d3/d09/ripper_8y.html#a6df4a7704528f1713bab81f999b0176c">NODE_BLOCK_ARG</a>);
<a name="l00502"></a>00502                 <a class="code" href="../../d3/d4e/objspace_8c.html#ab6eb8483a261b12b34fb0ec958f184e9">COUNT_NODE</a>(<a class="code" href="../../d3/d09/ripper_8y.html#aac25fa5ac2c9b236539991db75bbe3b7">NODE_BLOCK_PASS</a>);
<a name="l00503"></a>00503                 <a class="code" href="../../d3/d4e/objspace_8c.html#ab6eb8483a261b12b34fb0ec958f184e9">COUNT_NODE</a>(<a class="code" href="../../d3/d09/ripper_8y.html#a0ce7b90eaf281deb02709b014b182134">NODE_DEFN</a>);
<a name="l00504"></a>00504                 <a class="code" href="../../d3/d4e/objspace_8c.html#ab6eb8483a261b12b34fb0ec958f184e9">COUNT_NODE</a>(<a class="code" href="../../d3/d09/ripper_8y.html#a1aa42b99b85e6641856c375c18999ebc">NODE_DEFS</a>);
<a name="l00505"></a>00505                 <a class="code" href="../../d3/d4e/objspace_8c.html#ab6eb8483a261b12b34fb0ec958f184e9">COUNT_NODE</a>(<a class="code" href="../../d3/d09/ripper_8y.html#a0b706295869ed8e7a099d11f8ef9a584">NODE_ALIAS</a>);
<a name="l00506"></a>00506                 <a class="code" href="../../d3/d4e/objspace_8c.html#ab6eb8483a261b12b34fb0ec958f184e9">COUNT_NODE</a>(<a class="code" href="../../d3/d09/ripper_8y.html#a533349938d03fe5c779f78036adf8796">NODE_VALIAS</a>);
<a name="l00507"></a>00507                 <a class="code" href="../../d3/d4e/objspace_8c.html#ab6eb8483a261b12b34fb0ec958f184e9">COUNT_NODE</a>(<a class="code" href="../../d3/d09/ripper_8y.html#abfeac49b2473bade38a545bedf938fdd">NODE_UNDEF</a>);
<a name="l00508"></a>00508                 <a class="code" href="../../d3/d4e/objspace_8c.html#ab6eb8483a261b12b34fb0ec958f184e9">COUNT_NODE</a>(<a class="code" href="../../d3/d09/ripper_8y.html#abb6f5b1caf75e58982beec5eb2b616ab">NODE_CLASS</a>);
<a name="l00509"></a>00509                 <a class="code" href="../../d3/d4e/objspace_8c.html#ab6eb8483a261b12b34fb0ec958f184e9">COUNT_NODE</a>(<a class="code" href="../../d3/d09/ripper_8y.html#ac8b0046f8276f3b5175c782f6c2a9380">NODE_MODULE</a>);
<a name="l00510"></a>00510                 <a class="code" href="../../d3/d4e/objspace_8c.html#ab6eb8483a261b12b34fb0ec958f184e9">COUNT_NODE</a>(<a class="code" href="../../d3/d09/ripper_8y.html#a6b27bbbd70ada5579b4863a16c28d77e">NODE_SCLASS</a>);
<a name="l00511"></a>00511                 <a class="code" href="../../d3/d4e/objspace_8c.html#ab6eb8483a261b12b34fb0ec958f184e9">COUNT_NODE</a>(<a class="code" href="../../d3/d09/ripper_8y.html#aff107642c64833eb6f64e7043c4d2b5c">NODE_COLON2</a>);
<a name="l00512"></a>00512                 <a class="code" href="../../d3/d4e/objspace_8c.html#ab6eb8483a261b12b34fb0ec958f184e9">COUNT_NODE</a>(<a class="code" href="../../d3/d09/ripper_8y.html#a614c6f2b1367102fbde526a5eb2871af">NODE_COLON3</a>);
<a name="l00513"></a>00513                 <a class="code" href="../../d3/d4e/objspace_8c.html#ab6eb8483a261b12b34fb0ec958f184e9">COUNT_NODE</a>(<a class="code" href="../../d3/d09/ripper_8y.html#af08e3ddc6c11af4918239aef9490687f">NODE_DOT2</a>);
<a name="l00514"></a>00514                 <a class="code" href="../../d3/d4e/objspace_8c.html#ab6eb8483a261b12b34fb0ec958f184e9">COUNT_NODE</a>(<a class="code" href="../../d3/d09/ripper_8y.html#a9a66d4437b952e9a6bbcbcad6801fc31">NODE_DOT3</a>);
<a name="l00515"></a>00515                 <a class="code" href="../../d3/d4e/objspace_8c.html#ab6eb8483a261b12b34fb0ec958f184e9">COUNT_NODE</a>(<a class="code" href="../../d3/d09/ripper_8y.html#a8b309511f0b3dabe54732e6f19739609">NODE_FLIP2</a>);
<a name="l00516"></a>00516                 <a class="code" href="../../d3/d4e/objspace_8c.html#ab6eb8483a261b12b34fb0ec958f184e9">COUNT_NODE</a>(<a class="code" href="../../d3/d09/ripper_8y.html#ab356b7f8605576fa62c0b0bdf41d8ff3">NODE_FLIP3</a>);
<a name="l00517"></a>00517                 <a class="code" href="../../d3/d4e/objspace_8c.html#ab6eb8483a261b12b34fb0ec958f184e9">COUNT_NODE</a>(<a class="code" href="../../d3/d09/ripper_8y.html#a4beb90d7425a19420390f5f402c7cd7b">NODE_SELF</a>);
<a name="l00518"></a>00518                 <a class="code" href="../../d3/d4e/objspace_8c.html#ab6eb8483a261b12b34fb0ec958f184e9">COUNT_NODE</a>(<a class="code" href="../../d3/d09/ripper_8y.html#a52160547548851ab924923b8ca1dcb42">NODE_NIL</a>);
<a name="l00519"></a>00519                 <a class="code" href="../../d3/d4e/objspace_8c.html#ab6eb8483a261b12b34fb0ec958f184e9">COUNT_NODE</a>(<a class="code" href="../../d3/d09/ripper_8y.html#a00911cb328ad9df305f886837c76923c">NODE_TRUE</a>);
<a name="l00520"></a>00520                 <a class="code" href="../../d3/d4e/objspace_8c.html#ab6eb8483a261b12b34fb0ec958f184e9">COUNT_NODE</a>(<a class="code" href="../../d3/d09/ripper_8y.html#aa66ba820f9577731ad767ba777d2e633">NODE_FALSE</a>);
<a name="l00521"></a>00521                 <a class="code" href="../../d3/d4e/objspace_8c.html#ab6eb8483a261b12b34fb0ec958f184e9">COUNT_NODE</a>(<a class="code" href="../../d3/d09/ripper_8y.html#a1ef166bb056e61d3375c561896bf24e7">NODE_ERRINFO</a>);
<a name="l00522"></a>00522                 <a class="code" href="../../d3/d4e/objspace_8c.html#ab6eb8483a261b12b34fb0ec958f184e9">COUNT_NODE</a>(<a class="code" href="../../d3/d09/ripper_8y.html#a9a02a48d7532185f602ab2eee4e7b79a">NODE_DEFINED</a>);
<a name="l00523"></a>00523                 <a class="code" href="../../d3/d4e/objspace_8c.html#ab6eb8483a261b12b34fb0ec958f184e9">COUNT_NODE</a>(<a class="code" href="../../d3/d09/ripper_8y.html#aa672b8251edf71e8aee4a1a542451a92">NODE_POSTEXE</a>);
<a name="l00524"></a>00524                 <a class="code" href="../../d3/d4e/objspace_8c.html#ab6eb8483a261b12b34fb0ec958f184e9">COUNT_NODE</a>(<a class="code" href="../../d3/d09/ripper_8y.html#afe798b4130b52162a6b58ff378c4a83e">NODE_ALLOCA</a>);
<a name="l00525"></a>00525                 <a class="code" href="../../d3/d4e/objspace_8c.html#ab6eb8483a261b12b34fb0ec958f184e9">COUNT_NODE</a>(<a class="code" href="../../d3/d09/ripper_8y.html#afee064f5c28bb1773944e2719f402a66">NODE_BMETHOD</a>);
<a name="l00526"></a>00526                 <a class="code" href="../../d3/d4e/objspace_8c.html#ab6eb8483a261b12b34fb0ec958f184e9">COUNT_NODE</a>(<a class="code" href="../../d3/d09/ripper_8y.html#ab6c10c18e64cb034995aea5a620eb07f">NODE_MEMO</a>);
<a name="l00527"></a>00527                 <a class="code" href="../../d3/d4e/objspace_8c.html#ab6eb8483a261b12b34fb0ec958f184e9">COUNT_NODE</a>(<a class="code" href="../../d3/d09/ripper_8y.html#a836cfaf74dc2a521d7bee753fcf0b0a0">NODE_IFUNC</a>);
<a name="l00528"></a>00528                 <a class="code" href="../../d3/d4e/objspace_8c.html#ab6eb8483a261b12b34fb0ec958f184e9">COUNT_NODE</a>(<a class="code" href="../../d3/d09/ripper_8y.html#ab102222ffbe5118d93d37b103876fc44">NODE_DSYM</a>);
<a name="l00529"></a>00529                 <a class="code" href="../../d3/d4e/objspace_8c.html#ab6eb8483a261b12b34fb0ec958f184e9">COUNT_NODE</a>(<a class="code" href="../../d3/d09/ripper_8y.html#a1423dff9c55fd36cca257ffb758ca4a6">NODE_ATTRASGN</a>);
<a name="l00530"></a>00530                 <a class="code" href="../../d3/d4e/objspace_8c.html#ab6eb8483a261b12b34fb0ec958f184e9">COUNT_NODE</a>(<a class="code" href="../../d3/d09/ripper_8y.html#a76b74f188d07df52edd15169b49ff1c5">NODE_PRELUDE</a>);
<a name="l00531"></a>00531                 <a class="code" href="../../d3/d4e/objspace_8c.html#ab6eb8483a261b12b34fb0ec958f184e9">COUNT_NODE</a>(<a class="code" href="../../d3/d09/ripper_8y.html#aebc63da450ca40eb13dac5c5cd0ed4e0">NODE_LAMBDA</a>);
<a name="l00532"></a>00532                 <a class="code" href="../../d3/d4e/objspace_8c.html#ab6eb8483a261b12b34fb0ec958f184e9">COUNT_NODE</a>(<a class="code" href="../../d3/d09/ripper_8y.html#ad13c06599208704f1b6ce18e61e08646">NODE_OPTBLOCK</a>);
<a name="l00533"></a>00533 <span class="preprocessor">#undef COUNT_NODE</span>
<a name="l00534"></a>00534 <span class="preprocessor"></span>              <span class="keywordflow">default</span>: node = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(nodes[i]);
<a name="l00535"></a>00535             }
<a name="l00536"></a>00536             <a class="code" href="../../d1/d04/hash_8c.html#ac477edf136d86a33bc06d1fbea67bb9a">rb_hash_aset</a>(hash, node, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#af89e74d2dcf3eef15b29fa6015984af3">SIZET2NUM</a>(nodes[i]));
<a name="l00537"></a>00537         }
<a name="l00538"></a>00538     }
<a name="l00539"></a>00539     <span class="keywordflow">return</span> hash;
<a name="l00540"></a>00540 }
<a name="l00541"></a>00541 
<a name="l00542"></a>00542 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l00543"></a><a class="code" href="../../d3/d4e/objspace_8c.html#a801f5967f522e5b6172a28ee424c38b3">00543</a> <a class="code" href="../../d3/d4e/objspace_8c.html#a801f5967f522e5b6172a28ee424c38b3">cto_i</a>(<span class="keywordtype">void</span> *vstart, <span class="keywordtype">void</span> *vend, <span class="keywordtype">size_t</span> stride, <span class="keywordtype">void</span> *data)
<a name="l00544"></a>00544 {
<a name="l00545"></a>00545     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <a class="code" href="../../d3/deb/lex_8c.html#a5541f85ce416df233cce93949f0eeeca">hash</a> = (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>)data;
<a name="l00546"></a>00546     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> v = (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>)vstart;
<a name="l00547"></a>00547 
<a name="l00548"></a>00548     <span class="keywordflow">for</span> (; v != (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>)vend; v += stride) {
<a name="l00549"></a>00549         <span class="keywordflow">if</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a1d4c05021aacd8cab989ff60f95ebe2d">RBASIC</a>(v)-&gt;flags &amp;&amp; <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aee74f540353cd2d77d1cb37a3714bd7d">BUILTIN_TYPE</a>(v) == <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a55f295817faf14e42b3cff745a7ac706">T_DATA</a>) {
<a name="l00550"></a>00550             <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> counter;
<a name="l00551"></a>00551             <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <a class="code" href="../../dc/de5/random_8c.html#a742229490b6759a90ece7ba82ba129d5">key</a> = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a1d4c05021aacd8cab989ff60f95ebe2d">RBASIC</a>(v)-&gt;klass;
<a name="l00552"></a>00552 
<a name="l00553"></a>00553             <span class="keywordflow">if</span> (key == 0) {
<a name="l00554"></a>00554                 <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d6/da0/nkf-utf8_2nkf_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a> = <a class="code" href="../../d8/d16/gc_8c.html#acc22a6c614d2f714a6716085ca9f63e7">rb_objspace_data_type_name</a>(v);
<a name="l00555"></a>00555                 <span class="keywordflow">if</span> (name == 0) name = <span class="stringliteral">&quot;unknown&quot;</span>;
<a name="l00556"></a>00556                 key = <a class="code" href="../../dc/d0c/cparse_8c.html#a48bfb6519a45249fb2ec0193ea3b6e1c">ID2SYM</a>(<a class="code" href="../../dc/dcc/array_8c.html#a9cfa42d4b79c89d68c53be8b2150a503">rb_intern</a>(name));
<a name="l00557"></a>00557             }
<a name="l00558"></a>00558 
<a name="l00559"></a>00559             counter = <a class="code" href="../../d1/d04/hash_8c.html#ab7063832c7ed02351e87922a78e35c32">rb_hash_aref</a>(hash, key);
<a name="l00560"></a>00560             <span class="keywordflow">if</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a4832bad8845a35fc50f7a160901854a1">NIL_P</a>(counter)) {
<a name="l00561"></a>00561                 counter = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(1);
<a name="l00562"></a>00562             }
<a name="l00563"></a>00563             <span class="keywordflow">else</span> {
<a name="l00564"></a>00564                 counter = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a9444c431b3cb1184e7523fc572f2c758">FIX2INT</a>(counter) + 1);
<a name="l00565"></a>00565             }
<a name="l00566"></a>00566 
<a name="l00567"></a>00567             <a class="code" href="../../d1/d04/hash_8c.html#ac477edf136d86a33bc06d1fbea67bb9a">rb_hash_aset</a>(hash, key, counter);
<a name="l00568"></a>00568         }
<a name="l00569"></a>00569     }
<a name="l00570"></a>00570 
<a name="l00571"></a>00571     <span class="keywordflow">return</span> 0;
<a name="l00572"></a>00572 }
<a name="l00573"></a>00573 
<a name="l00574"></a>00574 <span class="comment">/*</span>
<a name="l00575"></a>00575 <span class="comment"> *  call-seq:</span>
<a name="l00576"></a>00576 <span class="comment"> *     ObjectSpace.count_tdata_objects([result_hash]) -&gt; hash</span>
<a name="l00577"></a>00577 <span class="comment"> *</span>
<a name="l00578"></a>00578 <span class="comment"> *  Counts objects for each T_DATA type.</span>
<a name="l00579"></a>00579 <span class="comment"> *</span>
<a name="l00580"></a>00580 <span class="comment"> *  This method is not for ordinary Ruby programmers, but for MRI developers</span>
<a name="l00581"></a>00581 <span class="comment"> *  who interest on MRI performance.</span>
<a name="l00582"></a>00582 <span class="comment"> *</span>
<a name="l00583"></a>00583 <span class="comment"> *  It returns a hash as:</span>
<a name="l00584"></a>00584 <span class="comment"> *  {RubyVM::InstructionSequence=&gt;504, :parser=&gt;5, :barrier=&gt;6,</span>
<a name="l00585"></a>00585 <span class="comment"> *   :mutex=&gt;6, Proc=&gt;60, RubyVM::Env=&gt;57, Mutex=&gt;1, Encoding=&gt;99,</span>
<a name="l00586"></a>00586 <span class="comment"> *   ThreadGroup=&gt;1, Binding=&gt;1, Thread=&gt;1, RubyVM=&gt;1, :iseq=&gt;1,</span>
<a name="l00587"></a>00587 <span class="comment"> *   Random=&gt;1, ARGF.class=&gt;1, Data=&gt;1, :autoload=&gt;3, Time=&gt;2}</span>
<a name="l00588"></a>00588 <span class="comment"> *  # T_DATA objects existing at startup on r32276.</span>
<a name="l00589"></a>00589 <span class="comment"> *</span>
<a name="l00590"></a>00590 <span class="comment"> *  If the optional argument, result_hash, is given,</span>
<a name="l00591"></a>00591 <span class="comment"> *  it is overwritten and returned.</span>
<a name="l00592"></a>00592 <span class="comment"> *  This is intended to avoid probe effect.</span>
<a name="l00593"></a>00593 <span class="comment"> *</span>
<a name="l00594"></a>00594 <span class="comment"> *  The contents of the returned hash is implementation defined.</span>
<a name="l00595"></a>00595 <span class="comment"> *  It may be changed in future.</span>
<a name="l00596"></a>00596 <span class="comment"> *</span>
<a name="l00597"></a>00597 <span class="comment"> *  In this version, keys are Class object or Symbol object.</span>
<a name="l00598"></a>00598 <span class="comment"> *  If object is kind of normal (accessible) object, the key is Class object.</span>
<a name="l00599"></a>00599 <span class="comment"> *  If object is not a kind of normal (internal) object, the key is symbol</span>
<a name="l00600"></a>00600 <span class="comment"> *  name, registered by rb_data_type_struct.</span>
<a name="l00601"></a>00601 <span class="comment"> *</span>
<a name="l00602"></a>00602 <span class="comment"> *  This method is not expected to work except C Ruby.</span>
<a name="l00603"></a>00603 <span class="comment"> *</span>
<a name="l00604"></a>00604 <span class="comment"> */</span>
<a name="l00605"></a>00605 
<a name="l00606"></a>00606 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l00607"></a><a class="code" href="../../d3/d4e/objspace_8c.html#ac98da51ab95ad35618d4a021deb13334">00607</a> <a class="code" href="../../d3/d4e/objspace_8c.html#ac98da51ab95ad35618d4a021deb13334">count_tdata_objects</a>(<span class="keywordtype">int</span> <a class="code" href="../../df/d77/ruby_8c.html#ad1447518f4372828b8435ae82e48499e">argc</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> *<a class="code" href="../../df/d77/ruby_8c.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <span class="keyword">self</span>)
<a name="l00608"></a>00608 {
<a name="l00609"></a>00609     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <a class="code" href="../../d3/deb/lex_8c.html#a5541f85ce416df233cce93949f0eeeca">hash</a>;
<a name="l00610"></a>00610 
<a name="l00611"></a>00611     <span class="keywordflow">if</span> (<a class="code" href="../../d7/d19/group__defmethod.html#gaa7bed88640f01bee619f85fda09d28d7">rb_scan_args</a>(argc, argv, <span class="stringliteral">&quot;01&quot;</span>, &amp;hash) == 1) {
<a name="l00612"></a>00612         <span class="keywordflow">if</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a394faf7191f18552a20cb17ce14226f0">TYPE</a>(hash) != <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a8357e81bbb60cb41b0a292a90653a5e5">T_HASH</a>)
<a name="l00613"></a>00613             <a class="code" href="../../db/dcc/error_8c.html#a0f771a2840561f1838169b3d7d4616f3">rb_raise</a>(<a class="code" href="../../db/dcc/error_8c.html#a565ed9d70f4089e1b4a36e9b3381b8c6">rb_eTypeError</a>, <span class="stringliteral">&quot;non-hash given&quot;</span>);
<a name="l00614"></a>00614     }
<a name="l00615"></a>00615 
<a name="l00616"></a>00616     <span class="keywordflow">if</span> (hash == <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a320970f989dc8294c8203154e3db40c1">Qnil</a>) {
<a name="l00617"></a>00617         hash = <a class="code" href="../../d1/d04/hash_8c.html#af1da586524a3a1739fd5b91272037815">rb_hash_new</a>();
<a name="l00618"></a>00618     }
<a name="l00619"></a>00619     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!<a class="code" href="../../de/de6/ruby_2ruby_8h.html#ae6e9dfb04b81ecb03ec6c087498521ea">RHASH_EMPTY_P</a>(hash)) {
<a name="l00620"></a>00620         <a class="code" href="../../dd/d24/st_8h.html#ace5a79870d2800659a653fceeca55262">st_foreach</a>(<a class="code" href="../../d9/dee/tkutil_8c.html#ad8dd7fb0cbee1955c393251e8bb97233">RHASH_TBL</a>(hash), <a class="code" href="../../d3/d4e/objspace_8c.html#ab48f1e867488f28c7ba03d5b203e055f">set_zero_i</a>, hash);
<a name="l00621"></a>00621     }
<a name="l00622"></a>00622 
<a name="l00623"></a>00623     <a class="code" href="../../d8/d16/gc_8c.html#ac2b65f7b2d778d973bfc7f0bf0c3dc62">rb_objspace_each_objects</a>(<a class="code" href="../../d3/d4e/objspace_8c.html#a801f5967f522e5b6172a28ee424c38b3">cto_i</a>, (<span class="keywordtype">void</span> *)hash);
<a name="l00624"></a>00624 
<a name="l00625"></a>00625     <span class="keywordflow">return</span> hash;
<a name="l00626"></a>00626 }
<a name="l00627"></a>00627 
<a name="l00628"></a>00628 <span class="comment">/* objspace library extends ObjectSpace module and add several</span>
<a name="l00629"></a>00629 <span class="comment"> * methods to get internal statistic information about</span>
<a name="l00630"></a>00630 <span class="comment"> * object/memory management.</span>
<a name="l00631"></a>00631 <span class="comment"> *</span>
<a name="l00632"></a>00632 <span class="comment"> * Generally, you *SHOULD NOT*use this library if you do not know</span>
<a name="l00633"></a>00633 <span class="comment"> * about the MRI implementation.  Mainly, this library is for (memory)</span>
<a name="l00634"></a>00634 <span class="comment"> * profiler developers and MRI developers who need to know how MRI</span>
<a name="l00635"></a>00635 <span class="comment"> * memory usage.</span>
<a name="l00636"></a>00636 <span class="comment"> */</span>
<a name="l00637"></a>00637 
<a name="l00638"></a>00638 <span class="keywordtype">void</span>
<a name="l00639"></a><a class="code" href="../../d3/d4e/objspace_8c.html#ab97350fabb566c0f56518627bc6f5f3c">00639</a> <a class="code" href="../../d3/d4e/objspace_8c.html#ab97350fabb566c0f56518627bc6f5f3c">Init_objspace</a>(<span class="keywordtype">void</span>)
<a name="l00640"></a>00640 {
<a name="l00641"></a>00641     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> rb_mObjSpace = <a class="code" href="../../db/d2e/intern_8h.html#a17a81c1a7d754e5ab49fc4b4369b6c8c">rb_const_get</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a57c96ead3ef230b4838e65fe037c346e">rb_cObject</a>, <a class="code" href="../../dc/dcc/array_8c.html#a9cfa42d4b79c89d68c53be8b2150a503">rb_intern</a>(<span class="stringliteral">&quot;ObjectSpace&quot;</span>));
<a name="l00642"></a>00642 
<a name="l00643"></a>00643     <a class="code" href="../../d7/d19/group__defmethod.html#gafc7122dde38ecff13de3e9d19a30aaeb" title="Defines a module function for module.">rb_define_module_function</a>(rb_mObjSpace, <span class="stringliteral">&quot;memsize_of&quot;</span>, <a class="code" href="../../d3/d4e/objspace_8c.html#ab9137e18869b215c6eb01b64ca0f8176">memsize_of_m</a>, 1);
<a name="l00644"></a>00644     <a class="code" href="../../d7/d19/group__defmethod.html#gafc7122dde38ecff13de3e9d19a30aaeb" title="Defines a module function for module.">rb_define_module_function</a>(rb_mObjSpace, <span class="stringliteral">&quot;memsize_of_all&quot;</span>,
<a name="l00645"></a>00645                               <a class="code" href="../../d3/d4e/objspace_8c.html#a7177314f57f728e9391b40fd6e1fbf8c">memsize_of_all_m</a>, -1);
<a name="l00646"></a>00646 
<a name="l00647"></a>00647     <a class="code" href="../../d7/d19/group__defmethod.html#gafc7122dde38ecff13de3e9d19a30aaeb" title="Defines a module function for module.">rb_define_module_function</a>(rb_mObjSpace, <span class="stringliteral">&quot;count_objects_size&quot;</span>, <a class="code" href="../../d3/d4e/objspace_8c.html#a85d2ca151ddd4781f8ff9c113ca80437">count_objects_size</a>, -1);
<a name="l00648"></a>00648     <a class="code" href="../../d7/d19/group__defmethod.html#gafc7122dde38ecff13de3e9d19a30aaeb" title="Defines a module function for module.">rb_define_module_function</a>(rb_mObjSpace, <span class="stringliteral">&quot;count_nodes&quot;</span>, <a class="code" href="../../d3/d4e/objspace_8c.html#a64298c8d36e022012363a9e4c2445ecb">count_nodes</a>, -1);
<a name="l00649"></a>00649     <a class="code" href="../../d7/d19/group__defmethod.html#gafc7122dde38ecff13de3e9d19a30aaeb" title="Defines a module function for module.">rb_define_module_function</a>(rb_mObjSpace, <span class="stringliteral">&quot;count_tdata_objects&quot;</span>, <a class="code" href="../../d3/d4e/objspace_8c.html#ac98da51ab95ad35618d4a021deb13334">count_tdata_objects</a>, -1);
<a name="l00650"></a>00650 }
<a name="l00651"></a>00651 
</pre></div></div>
<hr size="1"/><address style="text-align: right;"><small>Generated on 1 Mar 2013 for Ruby by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
