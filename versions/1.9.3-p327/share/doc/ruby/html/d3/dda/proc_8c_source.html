<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Ruby: proc.c Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="../../index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="../../files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="../../globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<h1>proc.c</h1><a href="../../d3/dda/proc_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/**********************************************************************</span>
<a name="l00002"></a>00002 <span class="comment"></span>
<a name="l00003"></a>00003 <span class="comment">  proc.c - Proc, Binding, Env</span>
<a name="l00004"></a>00004 <span class="comment"></span>
<a name="l00005"></a>00005 <span class="comment">  $Author: naruse $</span>
<a name="l00006"></a>00006 <span class="comment">  created at: Wed Jan 17 12:13:14 2007</span>
<a name="l00007"></a>00007 <span class="comment"></span>
<a name="l00008"></a>00008 <span class="comment">  Copyright (C) 2004-2007 Koichi Sasada</span>
<a name="l00009"></a>00009 <span class="comment"></span>
<a name="l00010"></a>00010 <span class="comment">**********************************************************************/</span>
<a name="l00011"></a>00011 
<a name="l00012"></a>00012 <span class="preprocessor">#include &quot;<a class="code" href="../../dd/dd0/eval__intern_8h.html">eval_intern.h</a>&quot;</span>
<a name="l00013"></a>00013 <span class="preprocessor">#include &quot;<a class="code" href="../../db/dde/internal_8h.html">internal.h</a>&quot;</span>
<a name="l00014"></a>00014 <span class="preprocessor">#include &quot;<a class="code" href="../../d0/daa/gc_8h.html">gc.h</a>&quot;</span>
<a name="l00015"></a>00015 <span class="preprocessor">#include &quot;<a class="code" href="../../d7/dc8/iseq_8h.html">iseq.h</a>&quot;</span>
<a name="l00016"></a>00016 
<a name="l00017"></a><a class="code" href="../../d7/d6e/struct_m_e_t_h_o_d.html">00017</a> <span class="keyword">struct </span><a class="code" href="../../d7/d6e/struct_m_e_t_h_o_d.html">METHOD</a> {
<a name="l00018"></a><a class="code" href="../../d7/d6e/struct_m_e_t_h_o_d.html#a1a31194e3ece53464051ce683ef36eb0">00018</a>     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <a class="code" href="../../d7/d6e/struct_m_e_t_h_o_d.html#a1a31194e3ece53464051ce683ef36eb0">recv</a>;
<a name="l00019"></a><a class="code" href="../../d7/d6e/struct_m_e_t_h_o_d.html#aa00af10f714836e05ea2c9dd5d55f01e">00019</a>     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <a class="code" href="../../d7/d6e/struct_m_e_t_h_o_d.html#aa00af10f714836e05ea2c9dd5d55f01e">rclass</a>;
<a name="l00020"></a><a class="code" href="../../d7/d6e/struct_m_e_t_h_o_d.html#a009ecbfb566836ce3a94e7038a8a9f57">00020</a>     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#afa5b9137f051ac26d7ccc8824f178233">ID</a> <a class="code" href="../../d7/d6e/struct_m_e_t_h_o_d.html#a009ecbfb566836ce3a94e7038a8a9f57">id</a>;
<a name="l00021"></a><a class="code" href="../../d7/d6e/struct_m_e_t_h_o_d.html#a5042d3b2ef85e71b1a66e49da661733a">00021</a>     <a class="code" href="../../d7/db7/structrb__method__entry__struct.html">rb_method_entry_t</a> *<a class="code" href="../../d7/d6e/struct_m_e_t_h_o_d.html#a5042d3b2ef85e71b1a66e49da661733a">me</a>;
<a name="l00022"></a><a class="code" href="../../d7/d6e/struct_m_e_t_h_o_d.html#a32c4c4f8d467f1d7f23ef02bbe3bce2d">00022</a>     <span class="keyword">struct </span><a class="code" href="../../d4/dd6/structunlinked__method__entry__list__entry.html">unlinked_method_entry_list_entry</a> *<a class="code" href="../../d7/d6e/struct_m_e_t_h_o_d.html#a32c4c4f8d467f1d7f23ef02bbe3bce2d">ume</a>;
<a name="l00023"></a>00023 };
<a name="l00024"></a>00024 
<a name="l00025"></a><a class="code" href="../../d3/dda/proc_8c.html#a10ba809b8df9f1df50915f5dbc7b2cb2">00025</a> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a23383895e4060d0b44efa71dae926aa0">rb_cUnboundMethod</a>;
<a name="l00026"></a><a class="code" href="../../d3/dda/proc_8c.html#afa58cbaf2b08f11d19301ffbe5dbc3d1">00026</a> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ae48870c64516ad4fcc5bafe96d01e126">rb_cMethod</a>;
<a name="l00027"></a><a class="code" href="../../d3/dda/proc_8c.html#a6918fd005d7163d912b258c8c032255a">00027</a> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ad07e23922ca1fa3e87647edf4fab6d38">rb_cBinding</a>;
<a name="l00028"></a><a class="code" href="../../d3/dda/proc_8c.html#ae1a1d292d17969bdad89fc96c40d20c7">00028</a> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#abd0d5fa9d171dbf020e85958391437f9">rb_cProc</a>;
<a name="l00029"></a>00029 
<a name="l00030"></a>00030 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <a class="code" href="../../d3/dda/proc_8c.html#a8a4909696602de41227239b31a9ee19e">bmcall</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>);
<a name="l00031"></a>00031 <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d3/dda/proc_8c.html#a7f35da9e01e956b215307b9871d20553">method_arity</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>);
<a name="l00032"></a>00032 
<a name="l00033"></a>00033 <span class="comment">/* Proc */</span>
<a name="l00034"></a>00034 
<a name="l00035"></a><a class="code" href="../../d3/dda/proc_8c.html#a1a518cf87411d1e474335ddb66091741">00035</a> <span class="preprocessor">#define IS_METHOD_PROC_NODE(node) (nd_type(node) == NODE_IFUNC &amp;&amp; (node)-&gt;nd_cfnc == bmcall)</span>
<a name="l00036"></a>00036 <span class="preprocessor"></span>
<a name="l00037"></a>00037 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00038"></a><a class="code" href="../../d3/dda/proc_8c.html#aeaf3fda57dd0ee7332077040a02e4491">00038</a> <a class="code" href="../../d3/dda/proc_8c.html#aeaf3fda57dd0ee7332077040a02e4491">proc_free</a>(<span class="keywordtype">void</span> *ptr)
<a name="l00039"></a>00039 {
<a name="l00040"></a>00040     <a class="code" href="../../d0/daa/gc_8h.html#a5d959738efb454623a7dad84d728262a">RUBY_FREE_ENTER</a>(<span class="stringliteral">&quot;proc&quot;</span>);
<a name="l00041"></a>00041     <span class="keywordflow">if</span> (ptr) {
<a name="l00042"></a>00042         <a class="code" href="../../d8/d16/gc_8c.html#a0bffec5b2cc004adcebb6802e7620387">ruby_xfree</a>(ptr);
<a name="l00043"></a>00043     }
<a name="l00044"></a>00044     <a class="code" href="../../d0/daa/gc_8h.html#af304d34de3474d75064e0cba170b7bf5">RUBY_FREE_LEAVE</a>(<span class="stringliteral">&quot;proc&quot;</span>);
<a name="l00045"></a>00045 }
<a name="l00046"></a>00046 
<a name="l00047"></a>00047 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00048"></a><a class="code" href="../../d3/dda/proc_8c.html#afc91b2f540461f66138eb1367e9ad5b0">00048</a> <a class="code" href="../../d3/dda/proc_8c.html#afc91b2f540461f66138eb1367e9ad5b0">proc_mark</a>(<span class="keywordtype">void</span> *ptr)
<a name="l00049"></a>00049 {
<a name="l00050"></a>00050     <a class="code" href="../../d5/d77/structrb__proc__t.html">rb_proc_t</a> *proc;
<a name="l00051"></a>00051     <a class="code" href="../../d0/daa/gc_8h.html#a2aa4d10eb84bae94811007f68c795fb7">RUBY_MARK_ENTER</a>(<span class="stringliteral">&quot;proc&quot;</span>);
<a name="l00052"></a>00052     <span class="keywordflow">if</span> (ptr) {
<a name="l00053"></a>00053         proc = ptr;
<a name="l00054"></a>00054         <a class="code" href="../../d0/daa/gc_8h.html#afad3c58fae104a867be4305d1f96414a">RUBY_MARK_UNLESS_NULL</a>(proc-&gt;<a class="code" href="../../d5/d77/structrb__proc__t.html#acdb9a8c85422bf299615f7942ffbc916">envval</a>);
<a name="l00055"></a>00055         <a class="code" href="../../d0/daa/gc_8h.html#afad3c58fae104a867be4305d1f96414a">RUBY_MARK_UNLESS_NULL</a>(proc-&gt;<a class="code" href="../../d5/d77/structrb__proc__t.html#a6541c1e61b0734aef20b7c2af3b4de5e">blockprocval</a>);
<a name="l00056"></a>00056         <a class="code" href="../../d0/daa/gc_8h.html#afad3c58fae104a867be4305d1f96414a">RUBY_MARK_UNLESS_NULL</a>(proc-&gt;<a class="code" href="../../d5/d77/structrb__proc__t.html#acf80b0e350012548c28cba1ea64a7a6e">block</a>.<a class="code" href="../../da/dc0/structrb__block__struct.html#a305ea0fcc6d1233de416bd8e7edab218">proc</a>);
<a name="l00057"></a>00057         <a class="code" href="../../d0/daa/gc_8h.html#afad3c58fae104a867be4305d1f96414a">RUBY_MARK_UNLESS_NULL</a>(proc-&gt;<a class="code" href="../../d5/d77/structrb__proc__t.html#acf80b0e350012548c28cba1ea64a7a6e">block</a>.<a class="code" href="../../da/dc0/structrb__block__struct.html#ad54e1ec45ab21ef384fe9e4346570397">self</a>);
<a name="l00058"></a>00058         <span class="keywordflow">if</span> (proc-&gt;<a class="code" href="../../d5/d77/structrb__proc__t.html#acf80b0e350012548c28cba1ea64a7a6e">block</a>.<a class="code" href="../../da/dc0/structrb__block__struct.html#a8e2b3b9218b4a184f198872404e81605">iseq</a> &amp;&amp; <a class="code" href="../../d8/d32/vm__core_8h.html#aa933aeb7a703c7cc2d136492acbbef22">RUBY_VM_IFUNC_P</a>(proc-&gt;<a class="code" href="../../d5/d77/structrb__proc__t.html#acf80b0e350012548c28cba1ea64a7a6e">block</a>.<a class="code" href="../../da/dc0/structrb__block__struct.html#a8e2b3b9218b4a184f198872404e81605">iseq</a>)) {
<a name="l00059"></a>00059             <a class="code" href="../../d0/daa/gc_8h.html#afad3c58fae104a867be4305d1f96414a">RUBY_MARK_UNLESS_NULL</a>((<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>)(proc-&gt;<a class="code" href="../../d5/d77/structrb__proc__t.html#acf80b0e350012548c28cba1ea64a7a6e">block</a>.<a class="code" href="../../da/dc0/structrb__block__struct.html#a8e2b3b9218b4a184f198872404e81605">iseq</a>));
<a name="l00060"></a>00060         }
<a name="l00061"></a>00061     }
<a name="l00062"></a>00062     <a class="code" href="../../d0/daa/gc_8h.html#a036115d8c044f5c847e760c57b08e5a9">RUBY_MARK_LEAVE</a>(<span class="stringliteral">&quot;proc&quot;</span>);
<a name="l00063"></a>00063 }
<a name="l00064"></a>00064 
<a name="l00065"></a>00065 <span class="keyword">static</span> <span class="keywordtype">size_t</span>
<a name="l00066"></a><a class="code" href="../../d3/dda/proc_8c.html#a0054d3e6753dcde796f8ad468ad7877a">00066</a> <a class="code" href="../../d3/dda/proc_8c.html#a0054d3e6753dcde796f8ad468ad7877a">proc_memsize</a>(<span class="keyword">const</span> <span class="keywordtype">void</span> *ptr)
<a name="l00067"></a>00067 {
<a name="l00068"></a>00068     <span class="keywordflow">return</span> ptr ? <span class="keyword">sizeof</span>(<a class="code" href="../../d5/d77/structrb__proc__t.html">rb_proc_t</a>) : 0;
<a name="l00069"></a>00069 }
<a name="l00070"></a>00070 
<a name="l00071"></a><a class="code" href="../../d3/dda/proc_8c.html#a6681b66b2e9cf314081509fac9363224">00071</a> <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="../../d7/de2/structrb__data__type__struct.html">rb_data_type_t</a> <a class="code" href="../../d3/dda/proc_8c.html#a6681b66b2e9cf314081509fac9363224">proc_data_type</a> = {
<a name="l00072"></a>00072     <span class="stringliteral">&quot;proc&quot;</span>,
<a name="l00073"></a>00073     {
<a name="l00074"></a>00074         <a class="code" href="../../d3/dda/proc_8c.html#afc91b2f540461f66138eb1367e9ad5b0">proc_mark</a>,
<a name="l00075"></a>00075         <a class="code" href="../../d3/dda/proc_8c.html#aeaf3fda57dd0ee7332077040a02e4491">proc_free</a>,
<a name="l00076"></a>00076         <a class="code" href="../../d3/dda/proc_8c.html#a0054d3e6753dcde796f8ad468ad7877a">proc_memsize</a>,
<a name="l00077"></a>00077     },
<a name="l00078"></a>00078 };
<a name="l00079"></a>00079 
<a name="l00080"></a>00080 <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l00081"></a><a class="code" href="../../d8/d32/vm__core_8h.html#afdfd5397f25a751a5bf34dbfeb0968ba">00081</a> <a class="code" href="../../d3/dda/proc_8c.html#afdfd5397f25a751a5bf34dbfeb0968ba">rb_proc_alloc</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> klass)
<a name="l00082"></a>00082 {
<a name="l00083"></a>00083     <a class="code" href="../../d5/d77/structrb__proc__t.html">rb_proc_t</a> *proc;
<a name="l00084"></a>00084     <span class="keywordflow">return</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#acb14aa93d3dc60a9d16570270154e6fa">TypedData_Make_Struct</a>(klass, <a class="code" href="../../d5/d77/structrb__proc__t.html">rb_proc_t</a>, &amp;proc_data_type, proc);
<a name="l00085"></a>00085 }
<a name="l00086"></a>00086 
<a name="l00087"></a>00087 <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l00088"></a><a class="code" href="../../d3/dda/proc_8c.html#af32b6897f09ac349d2cec9030de73d90">00088</a> <a class="code" href="../../db/d2e/intern_8h.html#a465568c66f9f2f257916e3a2f7f14aae">rb_obj_is_proc</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> proc)
<a name="l00089"></a>00089 {
<a name="l00090"></a>00090     <span class="keywordflow">if</span> (<a class="code" href="../../db/dcc/error_8c.html#a2a5803d0e60feb0ed8f37e7a38e8df47">rb_typeddata_is_kind_of</a>(proc, &amp;proc_data_type)) {
<a name="l00091"></a>00091         <span class="keywordflow">return</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aacea3516b33941ce8149098e223a7466">Qtrue</a>;
<a name="l00092"></a>00092     }
<a name="l00093"></a>00093     <span class="keywordflow">else</span> {
<a name="l00094"></a>00094         <span class="keywordflow">return</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aba0717d2689eb68797421a02ab9295c6">Qfalse</a>;
<a name="l00095"></a>00095     }
<a name="l00096"></a>00096 }
<a name="l00097"></a>00097 
<a name="l00098"></a>00098 <span class="comment">/* :nodoc: */</span>
<a name="l00099"></a>00099 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l00100"></a><a class="code" href="../../d3/dda/proc_8c.html#ac612f38db3a5646950553e152b878bda">00100</a> <a class="code" href="../../d3/dda/proc_8c.html#ac612f38db3a5646950553e152b878bda">proc_dup</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <span class="keyword">self</span>)
<a name="l00101"></a>00101 {
<a name="l00102"></a>00102     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> procval = <a class="code" href="../../d3/dda/proc_8c.html#afdfd5397f25a751a5bf34dbfeb0968ba">rb_proc_alloc</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#abd0d5fa9d171dbf020e85958391437f9">rb_cProc</a>);
<a name="l00103"></a>00103     <a class="code" href="../../d5/d77/structrb__proc__t.html">rb_proc_t</a> *src, *dst;
<a name="l00104"></a>00104     <a class="code" href="../../d8/d32/vm__core_8h.html#ad9cb04a311c21bdbbd936d8f8b7237db">GetProcPtr</a>(<span class="keyword">self</span>, src);
<a name="l00105"></a>00105     <a class="code" href="../../d8/d32/vm__core_8h.html#ad9cb04a311c21bdbbd936d8f8b7237db">GetProcPtr</a>(procval, dst);
<a name="l00106"></a>00106 
<a name="l00107"></a>00107     dst-&gt;<a class="code" href="../../d5/d77/structrb__proc__t.html#acf80b0e350012548c28cba1ea64a7a6e">block</a> = src-&gt;<a class="code" href="../../d5/d77/structrb__proc__t.html#acf80b0e350012548c28cba1ea64a7a6e">block</a>;
<a name="l00108"></a>00108     dst-&gt;<a class="code" href="../../d5/d77/structrb__proc__t.html#acf80b0e350012548c28cba1ea64a7a6e">block</a>.<a class="code" href="../../da/dc0/structrb__block__struct.html#a305ea0fcc6d1233de416bd8e7edab218">proc</a> = procval;
<a name="l00109"></a>00109     dst-&gt;<a class="code" href="../../d5/d77/structrb__proc__t.html#a6541c1e61b0734aef20b7c2af3b4de5e">blockprocval</a> = src-&gt;<a class="code" href="../../d5/d77/structrb__proc__t.html#a6541c1e61b0734aef20b7c2af3b4de5e">blockprocval</a>;
<a name="l00110"></a>00110     dst-&gt;<a class="code" href="../../d5/d77/structrb__proc__t.html#acdb9a8c85422bf299615f7942ffbc916">envval</a> = src-&gt;<a class="code" href="../../d5/d77/structrb__proc__t.html#acdb9a8c85422bf299615f7942ffbc916">envval</a>;
<a name="l00111"></a>00111     dst-&gt;<a class="code" href="../../d5/d77/structrb__proc__t.html#aceef0bead8eaa17dd1217f6078e9cd75">safe_level</a> = src-&gt;<a class="code" href="../../d5/d77/structrb__proc__t.html#aceef0bead8eaa17dd1217f6078e9cd75">safe_level</a>;
<a name="l00112"></a>00112     dst-&gt;<a class="code" href="../../d5/d77/structrb__proc__t.html#a7ec13535f2806b214e34a7db8460056b">is_lambda</a> = src-&gt;<a class="code" href="../../d5/d77/structrb__proc__t.html#a7ec13535f2806b214e34a7db8460056b">is_lambda</a>;
<a name="l00113"></a>00113 
<a name="l00114"></a>00114     <span class="keywordflow">return</span> procval;
<a name="l00115"></a>00115 }
<a name="l00116"></a>00116 
<a name="l00117"></a>00117 <span class="comment">/* :nodoc: */</span>
<a name="l00118"></a>00118 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l00119"></a><a class="code" href="../../d3/dda/proc_8c.html#aeaab69bcd87e28863c939732d726cad1">00119</a> <a class="code" href="../../d3/dda/proc_8c.html#aeaab69bcd87e28863c939732d726cad1">proc_clone</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <span class="keyword">self</span>)
<a name="l00120"></a>00120 {
<a name="l00121"></a>00121     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> procval = <a class="code" href="../../d3/dda/proc_8c.html#ac612f38db3a5646950553e152b878bda">proc_dup</a>(<span class="keyword">self</span>);
<a name="l00122"></a>00122     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a463c7ae434592ae6bd98e4e216382a10">CLONESETUP</a>(procval, <span class="keyword">self</span>);
<a name="l00123"></a>00123     <span class="keywordflow">return</span> procval;
<a name="l00124"></a>00124 }
<a name="l00125"></a>00125 
<a name="l00126"></a>00126 <span class="comment">/*</span>
<a name="l00127"></a>00127 <span class="comment"> * call-seq:</span>
<a name="l00128"></a>00128 <span class="comment"> *   prc.lambda? -&gt; true or false</span>
<a name="l00129"></a>00129 <span class="comment"> *</span>
<a name="l00130"></a>00130 <span class="comment"> * Returns +true+ for a Proc object for which argument handling is rigid.</span>
<a name="l00131"></a>00131 <span class="comment"> * Such procs are typically generated by +lambda+.</span>
<a name="l00132"></a>00132 <span class="comment"> *</span>
<a name="l00133"></a>00133 <span class="comment"> * A Proc object generated by +proc+ ignores extra arguments.</span>
<a name="l00134"></a>00134 <span class="comment"> *</span>
<a name="l00135"></a>00135 <span class="comment"> *   proc {|a,b| [a,b] }.call(1,2,3)    #=&gt; [1,2]</span>
<a name="l00136"></a>00136 <span class="comment"> *</span>
<a name="l00137"></a>00137 <span class="comment"> * It provides +nil+ for missing arguments.</span>
<a name="l00138"></a>00138 <span class="comment"> *</span>
<a name="l00139"></a>00139 <span class="comment"> *   proc {|a,b| [a,b] }.call(1)        #=&gt; [1,nil]</span>
<a name="l00140"></a>00140 <span class="comment"> *</span>
<a name="l00141"></a>00141 <span class="comment"> * It expands a single array argument.</span>
<a name="l00142"></a>00142 <span class="comment"> *</span>
<a name="l00143"></a>00143 <span class="comment"> *   proc {|a,b| [a,b] }.call([1,2])    #=&gt; [1,2]</span>
<a name="l00144"></a>00144 <span class="comment"> *</span>
<a name="l00145"></a>00145 <span class="comment"> * A Proc object generated by +lambda+ doesn&apos;t have such tricks.</span>
<a name="l00146"></a>00146 <span class="comment"> *</span>
<a name="l00147"></a>00147 <span class="comment"> *   lambda {|a,b| [a,b] }.call(1,2,3)  #=&gt; ArgumentError</span>
<a name="l00148"></a>00148 <span class="comment"> *   lambda {|a,b| [a,b] }.call(1)      #=&gt; ArgumentError</span>
<a name="l00149"></a>00149 <span class="comment"> *   lambda {|a,b| [a,b] }.call([1,2])  #=&gt; ArgumentError</span>
<a name="l00150"></a>00150 <span class="comment"> *</span>
<a name="l00151"></a>00151 <span class="comment"> * Proc#lambda? is a predicate for the tricks.</span>
<a name="l00152"></a>00152 <span class="comment"> * It returns +true+ if no tricks apply.</span>
<a name="l00153"></a>00153 <span class="comment"> *</span>
<a name="l00154"></a>00154 <span class="comment"> *   lambda {}.lambda?            #=&gt; true</span>
<a name="l00155"></a>00155 <span class="comment"> *   proc {}.lambda?              #=&gt; false</span>
<a name="l00156"></a>00156 <span class="comment"> *</span>
<a name="l00157"></a>00157 <span class="comment"> * Proc.new is the same as +proc+.</span>
<a name="l00158"></a>00158 <span class="comment"> *</span>
<a name="l00159"></a>00159 <span class="comment"> *   Proc.new {}.lambda?          #=&gt; false</span>
<a name="l00160"></a>00160 <span class="comment"> *</span>
<a name="l00161"></a>00161 <span class="comment"> * +lambda+, +proc+ and Proc.new preserve the tricks of</span>
<a name="l00162"></a>00162 <span class="comment"> * a Proc object given by &lt;code&gt;&amp;&lt;/code&gt; argument.</span>
<a name="l00163"></a>00163 <span class="comment"> *</span>
<a name="l00164"></a>00164 <span class="comment"> *   lambda(&amp;lambda {}).lambda?   #=&gt; true</span>
<a name="l00165"></a>00165 <span class="comment"> *   proc(&amp;lambda {}).lambda?     #=&gt; true</span>
<a name="l00166"></a>00166 <span class="comment"> *   Proc.new(&amp;lambda {}).lambda? #=&gt; true</span>
<a name="l00167"></a>00167 <span class="comment"> *</span>
<a name="l00168"></a>00168 <span class="comment"> *   lambda(&amp;proc {}).lambda?     #=&gt; false</span>
<a name="l00169"></a>00169 <span class="comment"> *   proc(&amp;proc {}).lambda?       #=&gt; false</span>
<a name="l00170"></a>00170 <span class="comment"> *   Proc.new(&amp;proc {}).lambda?   #=&gt; false</span>
<a name="l00171"></a>00171 <span class="comment"> *</span>
<a name="l00172"></a>00172 <span class="comment"> * A Proc object generated by &lt;code&gt;&amp;&lt;/code&gt; argument has the tricks</span>
<a name="l00173"></a>00173 <span class="comment"> *</span>
<a name="l00174"></a>00174 <span class="comment"> *   def n(&amp;b) b.lambda? end</span>
<a name="l00175"></a>00175 <span class="comment"> *   n {}                         #=&gt; false</span>
<a name="l00176"></a>00176 <span class="comment"> *</span>
<a name="l00177"></a>00177 <span class="comment"> * The &lt;code&gt;&amp;&lt;/code&gt; argument preserves the tricks if a Proc object</span>
<a name="l00178"></a>00178 <span class="comment"> * is given by &lt;code&gt;&amp;&lt;/code&gt; argument.</span>
<a name="l00179"></a>00179 <span class="comment"> *</span>
<a name="l00180"></a>00180 <span class="comment"> *   n(&amp;lambda {})                #=&gt; true</span>
<a name="l00181"></a>00181 <span class="comment"> *   n(&amp;proc {})                  #=&gt; false</span>
<a name="l00182"></a>00182 <span class="comment"> *   n(&amp;Proc.new {})              #=&gt; false</span>
<a name="l00183"></a>00183 <span class="comment"> *</span>
<a name="l00184"></a>00184 <span class="comment"> * A Proc object converted from a method has no tricks.</span>
<a name="l00185"></a>00185 <span class="comment"> *</span>
<a name="l00186"></a>00186 <span class="comment"> *   def m() end</span>
<a name="l00187"></a>00187 <span class="comment"> *   method(:m).to_proc.lambda?   #=&gt; true</span>
<a name="l00188"></a>00188 <span class="comment"> *</span>
<a name="l00189"></a>00189 <span class="comment"> *   n(&amp;method(:m))               #=&gt; true</span>
<a name="l00190"></a>00190 <span class="comment"> *   n(&amp;method(:m).to_proc)       #=&gt; true</span>
<a name="l00191"></a>00191 <span class="comment"> *</span>
<a name="l00192"></a>00192 <span class="comment"> * +define_method+ is treated the same as method definition.</span>
<a name="l00193"></a>00193 <span class="comment"> * The defined method has no tricks.</span>
<a name="l00194"></a>00194 <span class="comment"> *</span>
<a name="l00195"></a>00195 <span class="comment"> *   class C</span>
<a name="l00196"></a>00196 <span class="comment"> *     define_method(:d) {}</span>
<a name="l00197"></a>00197 <span class="comment"> *   end</span>
<a name="l00198"></a>00198 <span class="comment"> *   C.new.d(1,2)       #=&gt; ArgumentError</span>
<a name="l00199"></a>00199 <span class="comment"> *   C.new.method(:d).to_proc.lambda?   #=&gt; true</span>
<a name="l00200"></a>00200 <span class="comment"> *</span>
<a name="l00201"></a>00201 <span class="comment"> * +define_method+ always defines a method without the tricks,</span>
<a name="l00202"></a>00202 <span class="comment"> * even if a non-lambda Proc object is given.</span>
<a name="l00203"></a>00203 <span class="comment"> * This is the only exception for which the tricks are not preserved.</span>
<a name="l00204"></a>00204 <span class="comment"> *</span>
<a name="l00205"></a>00205 <span class="comment"> *   class C</span>
<a name="l00206"></a>00206 <span class="comment"> *     define_method(:e, &amp;proc {})</span>
<a name="l00207"></a>00207 <span class="comment"> *   end</span>
<a name="l00208"></a>00208 <span class="comment"> *   C.new.e(1,2)       #=&gt; ArgumentError</span>
<a name="l00209"></a>00209 <span class="comment"> *   C.new.method(:e).to_proc.lambda?   #=&gt; true</span>
<a name="l00210"></a>00210 <span class="comment"> *</span>
<a name="l00211"></a>00211 <span class="comment"> * This exception insures that methods never have tricks</span>
<a name="l00212"></a>00212 <span class="comment"> * and makes it easy to have wrappers to define methods that behave as usual.</span>
<a name="l00213"></a>00213 <span class="comment"> *</span>
<a name="l00214"></a>00214 <span class="comment"> *   class C</span>
<a name="l00215"></a>00215 <span class="comment"> *     def self.def2(name, &amp;body)</span>
<a name="l00216"></a>00216 <span class="comment"> *       define_method(name, &amp;body)</span>
<a name="l00217"></a>00217 <span class="comment"> *     end</span>
<a name="l00218"></a>00218 <span class="comment"> *</span>
<a name="l00219"></a>00219 <span class="comment"> *     def2(:f) {}</span>
<a name="l00220"></a>00220 <span class="comment"> *   end</span>
<a name="l00221"></a>00221 <span class="comment"> *   C.new.f(1,2)       #=&gt; ArgumentError</span>
<a name="l00222"></a>00222 <span class="comment"> *</span>
<a name="l00223"></a>00223 <span class="comment"> * The wrapper &lt;i&gt;def2&lt;/i&gt; defines a method which has no tricks.</span>
<a name="l00224"></a>00224 <span class="comment"> *</span>
<a name="l00225"></a>00225 <span class="comment"> */</span>
<a name="l00226"></a>00226 
<a name="l00227"></a>00227 <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l00228"></a><a class="code" href="../../d3/dda/proc_8c.html#a8a2a321c98efe1888c311ffad217bc43">00228</a> <a class="code" href="../../db/d2e/intern_8h.html#a9a96293850077b10b7da7df2fef00df6">rb_proc_lambda_p</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> procval)
<a name="l00229"></a>00229 {
<a name="l00230"></a>00230     <a class="code" href="../../d5/d77/structrb__proc__t.html">rb_proc_t</a> *proc;
<a name="l00231"></a>00231     <a class="code" href="../../d8/d32/vm__core_8h.html#ad9cb04a311c21bdbbd936d8f8b7237db">GetProcPtr</a>(procval, proc);
<a name="l00232"></a>00232 
<a name="l00233"></a>00233     <span class="keywordflow">return</span> proc-&gt;<a class="code" href="../../d5/d77/structrb__proc__t.html#a7ec13535f2806b214e34a7db8460056b">is_lambda</a> ? <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aacea3516b33941ce8149098e223a7466">Qtrue</a> : <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aba0717d2689eb68797421a02ab9295c6">Qfalse</a>;
<a name="l00234"></a>00234 }
<a name="l00235"></a>00235 
<a name="l00236"></a>00236 <span class="comment">/* Binding */</span>
<a name="l00237"></a>00237 
<a name="l00238"></a>00238 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00239"></a><a class="code" href="../../d3/dda/proc_8c.html#a3f8bafcbaa75bc34eb3dcac950ac615e">00239</a> <a class="code" href="../../d3/dda/proc_8c.html#a3f8bafcbaa75bc34eb3dcac950ac615e">binding_free</a>(<span class="keywordtype">void</span> *ptr)
<a name="l00240"></a>00240 {
<a name="l00241"></a>00241     <a class="code" href="../../d3/d76/structrb__binding__t.html">rb_binding_t</a> *bind;
<a name="l00242"></a>00242     <a class="code" href="../../d0/daa/gc_8h.html#a5d959738efb454623a7dad84d728262a">RUBY_FREE_ENTER</a>(<span class="stringliteral">&quot;binding&quot;</span>);
<a name="l00243"></a>00243     <span class="keywordflow">if</span> (ptr) {
<a name="l00244"></a>00244         bind = ptr;
<a name="l00245"></a>00245         <a class="code" href="../../d8/d16/gc_8c.html#a0bffec5b2cc004adcebb6802e7620387">ruby_xfree</a>(ptr);
<a name="l00246"></a>00246     }
<a name="l00247"></a>00247     <a class="code" href="../../d0/daa/gc_8h.html#af304d34de3474d75064e0cba170b7bf5">RUBY_FREE_LEAVE</a>(<span class="stringliteral">&quot;binding&quot;</span>);
<a name="l00248"></a>00248 }
<a name="l00249"></a>00249 
<a name="l00250"></a>00250 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00251"></a><a class="code" href="../../d3/dda/proc_8c.html#a1eff57e0558859fe1fa3079001dcba3d">00251</a> <a class="code" href="../../d3/dda/proc_8c.html#a1eff57e0558859fe1fa3079001dcba3d">binding_mark</a>(<span class="keywordtype">void</span> *ptr)
<a name="l00252"></a>00252 {
<a name="l00253"></a>00253     <a class="code" href="../../d3/d76/structrb__binding__t.html">rb_binding_t</a> *bind;
<a name="l00254"></a>00254     <a class="code" href="../../d0/daa/gc_8h.html#a2aa4d10eb84bae94811007f68c795fb7">RUBY_MARK_ENTER</a>(<span class="stringliteral">&quot;binding&quot;</span>);
<a name="l00255"></a>00255     <span class="keywordflow">if</span> (ptr) {
<a name="l00256"></a>00256         bind = ptr;
<a name="l00257"></a>00257         <a class="code" href="../../d0/daa/gc_8h.html#afad3c58fae104a867be4305d1f96414a">RUBY_MARK_UNLESS_NULL</a>(bind-&gt;<a class="code" href="../../d3/d76/structrb__binding__t.html#a65f58a22eb376363f727c34b7fde7400">env</a>);
<a name="l00258"></a>00258         <a class="code" href="../../d0/daa/gc_8h.html#afad3c58fae104a867be4305d1f96414a">RUBY_MARK_UNLESS_NULL</a>(bind-&gt;<a class="code" href="../../d3/d76/structrb__binding__t.html#a5a10eb6f5295cb4561fd868122acdd56">filename</a>);
<a name="l00259"></a>00259     }
<a name="l00260"></a>00260     <a class="code" href="../../d0/daa/gc_8h.html#a036115d8c044f5c847e760c57b08e5a9">RUBY_MARK_LEAVE</a>(<span class="stringliteral">&quot;binding&quot;</span>);
<a name="l00261"></a>00261 }
<a name="l00262"></a>00262 
<a name="l00263"></a>00263 <span class="keyword">static</span> <span class="keywordtype">size_t</span>
<a name="l00264"></a><a class="code" href="../../d3/dda/proc_8c.html#af15554a3dceef839ff9a980a93e3ecd9">00264</a> <a class="code" href="../../d3/dda/proc_8c.html#af15554a3dceef839ff9a980a93e3ecd9">binding_memsize</a>(<span class="keyword">const</span> <span class="keywordtype">void</span> *ptr)
<a name="l00265"></a>00265 {
<a name="l00266"></a>00266     <span class="keywordflow">return</span> ptr ? <span class="keyword">sizeof</span>(<a class="code" href="../../d3/d76/structrb__binding__t.html">rb_binding_t</a>) : 0;
<a name="l00267"></a>00267 }
<a name="l00268"></a>00268 
<a name="l00269"></a><a class="code" href="../../d3/dda/proc_8c.html#ae922be73c1719dd9f23305020de96078">00269</a> <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="../../d7/de2/structrb__data__type__struct.html">rb_data_type_t</a> <a class="code" href="../../d3/dda/proc_8c.html#ae922be73c1719dd9f23305020de96078">binding_data_type</a> = {
<a name="l00270"></a>00270     <span class="stringliteral">&quot;binding&quot;</span>,
<a name="l00271"></a>00271     {
<a name="l00272"></a>00272         <a class="code" href="../../d3/dda/proc_8c.html#a1eff57e0558859fe1fa3079001dcba3d">binding_mark</a>,
<a name="l00273"></a>00273         <a class="code" href="../../d3/dda/proc_8c.html#a3f8bafcbaa75bc34eb3dcac950ac615e">binding_free</a>,
<a name="l00274"></a>00274         <a class="code" href="../../d3/dda/proc_8c.html#af15554a3dceef839ff9a980a93e3ecd9">binding_memsize</a>,
<a name="l00275"></a>00275     },
<a name="l00276"></a>00276 };
<a name="l00277"></a>00277 
<a name="l00278"></a>00278 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l00279"></a><a class="code" href="../../d3/dda/proc_8c.html#ae3a34a34187caef2f3225b4bf75ff56b">00279</a> <a class="code" href="../../d3/dda/proc_8c.html#ae3a34a34187caef2f3225b4bf75ff56b">binding_alloc</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> klass)
<a name="l00280"></a>00280 {
<a name="l00281"></a>00281     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> obj;
<a name="l00282"></a>00282     <a class="code" href="../../d3/d76/structrb__binding__t.html">rb_binding_t</a> *bind;
<a name="l00283"></a>00283     obj = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#acb14aa93d3dc60a9d16570270154e6fa">TypedData_Make_Struct</a>(klass, <a class="code" href="../../d3/d76/structrb__binding__t.html">rb_binding_t</a>, &amp;binding_data_type, bind);
<a name="l00284"></a>00284     <span class="keywordflow">return</span> obj;
<a name="l00285"></a>00285 }
<a name="l00286"></a>00286 
<a name="l00287"></a>00287 <span class="comment">/* :nodoc: */</span>
<a name="l00288"></a>00288 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l00289"></a><a class="code" href="../../d3/dda/proc_8c.html#a8f4a8c3f049376d9334f740b0b80b1ab">00289</a> <a class="code" href="../../d3/dda/proc_8c.html#a8f4a8c3f049376d9334f740b0b80b1ab">binding_dup</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <span class="keyword">self</span>)
<a name="l00290"></a>00290 {
<a name="l00291"></a>00291     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> bindval = <a class="code" href="../../d3/dda/proc_8c.html#ae3a34a34187caef2f3225b4bf75ff56b">binding_alloc</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#ad07e23922ca1fa3e87647edf4fab6d38">rb_cBinding</a>);
<a name="l00292"></a>00292     <a class="code" href="../../d3/d76/structrb__binding__t.html">rb_binding_t</a> *src, *dst;
<a name="l00293"></a>00293     <a class="code" href="../../d8/d32/vm__core_8h.html#a491d77ec5480e1530e447dbb42481f5b">GetBindingPtr</a>(<span class="keyword">self</span>, src);
<a name="l00294"></a>00294     <a class="code" href="../../d8/d32/vm__core_8h.html#a491d77ec5480e1530e447dbb42481f5b">GetBindingPtr</a>(bindval, dst);
<a name="l00295"></a>00295     dst-&gt;<a class="code" href="../../d3/d76/structrb__binding__t.html#a65f58a22eb376363f727c34b7fde7400">env</a> = src-&gt;<a class="code" href="../../d3/d76/structrb__binding__t.html#a65f58a22eb376363f727c34b7fde7400">env</a>;
<a name="l00296"></a>00296     dst-&gt;<a class="code" href="../../d3/d76/structrb__binding__t.html#a5a10eb6f5295cb4561fd868122acdd56">filename</a> = src-&gt;<a class="code" href="../../d3/d76/structrb__binding__t.html#a5a10eb6f5295cb4561fd868122acdd56">filename</a>;
<a name="l00297"></a>00297     dst-&gt;<a class="code" href="../../d3/d76/structrb__binding__t.html#a22c208816904df3cefa5ebfa8fe3fd58">line_no</a> = src-&gt;<a class="code" href="../../d3/d76/structrb__binding__t.html#a22c208816904df3cefa5ebfa8fe3fd58">line_no</a>;
<a name="l00298"></a>00298     <span class="keywordflow">return</span> bindval;
<a name="l00299"></a>00299 }
<a name="l00300"></a>00300 
<a name="l00301"></a>00301 <span class="comment">/* :nodoc: */</span>
<a name="l00302"></a>00302 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l00303"></a><a class="code" href="../../d3/dda/proc_8c.html#a6e542c9334f97273c080205e2728ad30">00303</a> <a class="code" href="../../d3/dda/proc_8c.html#a6e542c9334f97273c080205e2728ad30">binding_clone</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <span class="keyword">self</span>)
<a name="l00304"></a>00304 {
<a name="l00305"></a>00305     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> bindval = <a class="code" href="../../d3/dda/proc_8c.html#a8f4a8c3f049376d9334f740b0b80b1ab">binding_dup</a>(<span class="keyword">self</span>);
<a name="l00306"></a>00306     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a463c7ae434592ae6bd98e4e216382a10">CLONESETUP</a>(bindval, <span class="keyword">self</span>);
<a name="l00307"></a>00307     <span class="keywordflow">return</span> bindval;
<a name="l00308"></a>00308 }
<a name="l00309"></a>00309 
<a name="l00310"></a>00310 <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l00311"></a><a class="code" href="../../d3/dda/proc_8c.html#ae311913aafd9469008cdf681aeae9ed6">00311</a> <a class="code" href="../../db/d2e/intern_8h.html#ae311913aafd9469008cdf681aeae9ed6">rb_binding_new</a>(<span class="keywordtype">void</span>)
<a name="l00312"></a>00312 {
<a name="l00313"></a>00313     <a class="code" href="../../d2/d66/structrb__thread__struct.html">rb_thread_t</a> *th = <a class="code" href="../../d8/d32/vm__core_8h.html#a8deb84ec6023e3229db88ac2c9da6138">GET_THREAD</a>();
<a name="l00314"></a>00314     <a class="code" href="../../dd/d84/structrb__control__frame__t.html">rb_control_frame_t</a> *cfp = <a class="code" href="../../de/de9/vm_8c.html#a2709ccd7eeff81c0f749a7678223857e">rb_vm_get_ruby_level_next_cfp</a>(th, th-&gt;<a class="code" href="../../d2/d66/structrb__thread__struct.html#a2ed7f694d58d876aa6f0fae6986bc921">cfp</a>);
<a name="l00315"></a>00315     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> bindval = <a class="code" href="../../d3/dda/proc_8c.html#ae3a34a34187caef2f3225b4bf75ff56b">binding_alloc</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#ad07e23922ca1fa3e87647edf4fab6d38">rb_cBinding</a>);
<a name="l00316"></a>00316     <a class="code" href="../../d3/d76/structrb__binding__t.html">rb_binding_t</a> *bind;
<a name="l00317"></a>00317 
<a name="l00318"></a>00318     <span class="keywordflow">if</span> (cfp == 0) {
<a name="l00319"></a>00319         <a class="code" href="../../db/dcc/error_8c.html#a0f771a2840561f1838169b3d7d4616f3">rb_raise</a>(<a class="code" href="../../db/dcc/error_8c.html#a95ad3953d535707e2cf2b1d837f5e253">rb_eRuntimeError</a>, <span class="stringliteral">&quot;Can&apos;t create Binding Object on top of Fiber.&quot;</span>);
<a name="l00320"></a>00320     }
<a name="l00321"></a>00321 
<a name="l00322"></a>00322     <a class="code" href="../../d8/d32/vm__core_8h.html#a491d77ec5480e1530e447dbb42481f5b">GetBindingPtr</a>(bindval, bind);
<a name="l00323"></a>00323     bind-&gt;<a class="code" href="../../d3/d76/structrb__binding__t.html#a65f58a22eb376363f727c34b7fde7400">env</a> = <a class="code" href="../../de/de9/vm_8c.html#a38087978d8bc36f8cd48b62b70b15000">rb_vm_make_env_object</a>(th, cfp);
<a name="l00324"></a>00324     bind-&gt;<a class="code" href="../../d3/d76/structrb__binding__t.html#a5a10eb6f5295cb4561fd868122acdd56">filename</a> = cfp-&gt;<a class="code" href="../../dd/d84/structrb__control__frame__t.html#a4b25ca925a9f60481173632b9c09d4e0">iseq</a>-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a06859fa5de56f2ede3cb692f1d9215e2">filename</a>;
<a name="l00325"></a>00325     bind-&gt;<a class="code" href="../../d3/d76/structrb__binding__t.html#a22c208816904df3cefa5ebfa8fe3fd58">line_no</a> = <a class="code" href="../../de/de9/vm_8c.html#a70289cbb34babceed6243d9471e70e5f">rb_vm_get_sourceline</a>(cfp);
<a name="l00326"></a>00326     <span class="keywordflow">return</span> bindval;
<a name="l00327"></a>00327 }
<a name="l00328"></a>00328 
<a name="l00329"></a>00329 <span class="comment">/*</span>
<a name="l00330"></a>00330 <span class="comment"> *  call-seq:</span>
<a name="l00331"></a>00331 <span class="comment"> *     binding -&gt; a_binding</span>
<a name="l00332"></a>00332 <span class="comment"> *</span>
<a name="l00333"></a>00333 <span class="comment"> *  Returns a +Binding+ object, describing the variable and</span>
<a name="l00334"></a>00334 <span class="comment"> *  method bindings at the point of call. This object can be used when</span>
<a name="l00335"></a>00335 <span class="comment"> *  calling +eval+ to execute the evaluated command in this</span>
<a name="l00336"></a>00336 <span class="comment"> *  environment. See also the description of class +Binding+.</span>
<a name="l00337"></a>00337 <span class="comment"> *</span>
<a name="l00338"></a>00338 <span class="comment"> *     def get_binding(param)</span>
<a name="l00339"></a>00339 <span class="comment"> *       return binding</span>
<a name="l00340"></a>00340 <span class="comment"> *     end</span>
<a name="l00341"></a>00341 <span class="comment"> *     b = get_binding(&quot;hello&quot;)</span>
<a name="l00342"></a>00342 <span class="comment"> *     eval(&quot;param&quot;, b)   #=&gt; &quot;hello&quot;</span>
<a name="l00343"></a>00343 <span class="comment"> */</span>
<a name="l00344"></a>00344 
<a name="l00345"></a>00345 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l00346"></a><a class="code" href="../../d3/dda/proc_8c.html#aaf7aa767b45b033de065b3cf54e72371">00346</a> <a class="code" href="../../d3/dda/proc_8c.html#aaf7aa767b45b033de065b3cf54e72371">rb_f_binding</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <span class="keyword">self</span>)
<a name="l00347"></a>00347 {
<a name="l00348"></a>00348     <span class="keywordflow">return</span> <a class="code" href="../../db/d2e/intern_8h.html#ae311913aafd9469008cdf681aeae9ed6">rb_binding_new</a>();
<a name="l00349"></a>00349 }
<a name="l00350"></a>00350 
<a name="l00351"></a>00351 <span class="comment">/*</span>
<a name="l00352"></a>00352 <span class="comment"> *  call-seq:</span>
<a name="l00353"></a>00353 <span class="comment"> *     binding.eval(string [, filename [,lineno]])  -&gt; obj</span>
<a name="l00354"></a>00354 <span class="comment"> *</span>
<a name="l00355"></a>00355 <span class="comment"> *  Evaluates the Ruby expression(s) in &lt;em&gt;string&lt;/em&gt;, in the</span>
<a name="l00356"></a>00356 <span class="comment"> *  &lt;em&gt;binding&lt;/em&gt;&apos;s context.  If the optional &lt;em&gt;filename&lt;/em&gt; and</span>
<a name="l00357"></a>00357 <span class="comment"> *  &lt;em&gt;lineno&lt;/em&gt; parameters are present, they will be used when</span>
<a name="l00358"></a>00358 <span class="comment"> *  reporting syntax errors.</span>
<a name="l00359"></a>00359 <span class="comment"> *</span>
<a name="l00360"></a>00360 <span class="comment"> *     def get_binding(param)</span>
<a name="l00361"></a>00361 <span class="comment"> *       return binding</span>
<a name="l00362"></a>00362 <span class="comment"> *     end</span>
<a name="l00363"></a>00363 <span class="comment"> *     b = get_binding(&quot;hello&quot;)</span>
<a name="l00364"></a>00364 <span class="comment"> *     b.eval(&quot;param&quot;)   #=&gt; &quot;hello&quot;</span>
<a name="l00365"></a>00365 <span class="comment"> */</span>
<a name="l00366"></a>00366 
<a name="l00367"></a>00367 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l00368"></a><a class="code" href="../../d3/dda/proc_8c.html#af635113489a23aa748424e0c3badf51a">00368</a> <a class="code" href="../../d3/dda/proc_8c.html#af635113489a23aa748424e0c3badf51a">bind_eval</a>(<span class="keywordtype">int</span> <a class="code" href="../../df/d77/ruby_8c.html#ad1447518f4372828b8435ae82e48499e">argc</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> *<a class="code" href="../../df/d77/ruby_8c.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> bindval)
<a name="l00369"></a>00369 {
<a name="l00370"></a>00370     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <a class="code" href="../../d3/d09/ripper_8y.html#a8187411843a6284ffb964ef3fb9fcab3">args</a>[4];
<a name="l00371"></a>00371 
<a name="l00372"></a>00372     <a class="code" href="../../d7/d19/group__defmethod.html#gaa7bed88640f01bee619f85fda09d28d7">rb_scan_args</a>(argc, argv, <span class="stringliteral">&quot;12&quot;</span>, &amp;args[0], &amp;args[2], &amp;args[3]);
<a name="l00373"></a>00373     args[1] = bindval;
<a name="l00374"></a>00374     <span class="keywordflow">return</span> <a class="code" href="../../dd/dd0/eval__intern_8h.html#a4f3e84d7460d619a4f67cd559da19902">rb_f_eval</a>(argc+1, args, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a320970f989dc8294c8203154e3db40c1">Qnil</a> <span class="comment">/* self will be searched in eval */</span>);
<a name="l00375"></a>00375 }
<a name="l00376"></a>00376 
<a name="l00377"></a>00377 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l00378"></a><a class="code" href="../../d3/dda/proc_8c.html#a6584f9a448ed7805f8e72a53c763b79b">00378</a> <a class="code" href="../../d3/dda/proc_8c.html#a6584f9a448ed7805f8e72a53c763b79b">proc_new</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> klass, <span class="keywordtype">int</span> is_lambda)
<a name="l00379"></a>00379 {
<a name="l00380"></a>00380     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> procval = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a320970f989dc8294c8203154e3db40c1">Qnil</a>;
<a name="l00381"></a>00381     <a class="code" href="../../d2/d66/structrb__thread__struct.html">rb_thread_t</a> *th = <a class="code" href="../../d8/d32/vm__core_8h.html#a8deb84ec6023e3229db88ac2c9da6138">GET_THREAD</a>();
<a name="l00382"></a>00382     <a class="code" href="../../dd/d84/structrb__control__frame__t.html">rb_control_frame_t</a> *cfp = th-&gt;<a class="code" href="../../d2/d66/structrb__thread__struct.html#a2ed7f694d58d876aa6f0fae6986bc921">cfp</a>;
<a name="l00383"></a>00383     <a class="code" href="../../da/dc0/structrb__block__struct.html">rb_block_t</a> *block;
<a name="l00384"></a>00384 
<a name="l00385"></a>00385     <span class="keywordflow">if</span> ((<a class="code" href="../../d8/d32/vm__core_8h.html#a373f1cafd944ff9e99986582d0fd695b">GC_GUARDED_PTR_REF</a>(cfp-&gt;<a class="code" href="../../dd/d84/structrb__control__frame__t.html#af3314cb37c8a27353101bf6f35574946">lfp</a>[0])) != 0) {
<a name="l00386"></a>00386 
<a name="l00387"></a>00387         block = <a class="code" href="../../d8/d32/vm__core_8h.html#a373f1cafd944ff9e99986582d0fd695b">GC_GUARDED_PTR_REF</a>(cfp-&gt;<a class="code" href="../../dd/d84/structrb__control__frame__t.html#af3314cb37c8a27353101bf6f35574946">lfp</a>[0]);
<a name="l00388"></a>00388     }
<a name="l00389"></a>00389     <span class="keywordflow">else</span> {
<a name="l00390"></a>00390         cfp = <a class="code" href="../../d8/d32/vm__core_8h.html#af087c881c3c493e3a4e326852e8ed2a9">RUBY_VM_PREVIOUS_CONTROL_FRAME</a>(cfp);
<a name="l00391"></a>00391 
<a name="l00392"></a>00392         <span class="keywordflow">if</span> ((<a class="code" href="../../d8/d32/vm__core_8h.html#a373f1cafd944ff9e99986582d0fd695b">GC_GUARDED_PTR_REF</a>(cfp-&gt;<a class="code" href="../../dd/d84/structrb__control__frame__t.html#af3314cb37c8a27353101bf6f35574946">lfp</a>[0])) != 0) {
<a name="l00393"></a>00393 
<a name="l00394"></a>00394             block = <a class="code" href="../../d8/d32/vm__core_8h.html#a373f1cafd944ff9e99986582d0fd695b">GC_GUARDED_PTR_REF</a>(cfp-&gt;<a class="code" href="../../dd/d84/structrb__control__frame__t.html#af3314cb37c8a27353101bf6f35574946">lfp</a>[0]);
<a name="l00395"></a>00395 
<a name="l00396"></a>00396             <span class="keywordflow">if</span> (is_lambda) {
<a name="l00397"></a>00397                 <a class="code" href="../../db/dcc/error_8c.html#aa5b1972d475e9a090c8ef607ce033008">rb_warn</a>(<span class="stringliteral">&quot;tried to create Proc object without a block&quot;</span>);
<a name="l00398"></a>00398             }
<a name="l00399"></a>00399         }
<a name="l00400"></a>00400         <span class="keywordflow">else</span> {
<a name="l00401"></a>00401             <a class="code" href="../../db/dcc/error_8c.html#a0f771a2840561f1838169b3d7d4616f3">rb_raise</a>(<a class="code" href="../../db/dcc/error_8c.html#ab5e2a9fec766c75176fbb262bfe6a596">rb_eArgError</a>,
<a name="l00402"></a>00402                      <span class="stringliteral">&quot;tried to create Proc object without a block&quot;</span>);
<a name="l00403"></a>00403         }
<a name="l00404"></a>00404     }
<a name="l00405"></a>00405 
<a name="l00406"></a>00406     procval = block-&gt;<a class="code" href="../../da/dc0/structrb__block__struct.html#a305ea0fcc6d1233de416bd8e7edab218">proc</a>;
<a name="l00407"></a>00407 
<a name="l00408"></a>00408     <span class="keywordflow">if</span> (procval) {
<a name="l00409"></a>00409         <span class="keywordflow">if</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a1d4c05021aacd8cab989ff60f95ebe2d">RBASIC</a>(procval)-&gt;klass == klass) {
<a name="l00410"></a>00410             <span class="keywordflow">return</span> procval;
<a name="l00411"></a>00411         }
<a name="l00412"></a>00412         <span class="keywordflow">else</span> {
<a name="l00413"></a>00413             <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> newprocval = <a class="code" href="../../d3/dda/proc_8c.html#ac612f38db3a5646950553e152b878bda">proc_dup</a>(procval);
<a name="l00414"></a>00414             <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a1d4c05021aacd8cab989ff60f95ebe2d">RBASIC</a>(newprocval)-&gt;klass = klass;
<a name="l00415"></a>00415             <span class="keywordflow">return</span> newprocval;
<a name="l00416"></a>00416         }
<a name="l00417"></a>00417     }
<a name="l00418"></a>00418 
<a name="l00419"></a>00419     procval = <a class="code" href="../../de/de9/vm_8c.html#a7e8d71dee905abc403d671561b12f4e8">rb_vm_make_proc</a>(th, block, klass);
<a name="l00420"></a>00420 
<a name="l00421"></a>00421     <span class="keywordflow">if</span> (is_lambda) {
<a name="l00422"></a>00422         <a class="code" href="../../d5/d77/structrb__proc__t.html">rb_proc_t</a> *proc;
<a name="l00423"></a>00423         <a class="code" href="../../d8/d32/vm__core_8h.html#ad9cb04a311c21bdbbd936d8f8b7237db">GetProcPtr</a>(procval, proc);
<a name="l00424"></a>00424         proc-&gt;<a class="code" href="../../d5/d77/structrb__proc__t.html#a7ec13535f2806b214e34a7db8460056b">is_lambda</a> = <a class="code" href="../../d1/d5c/nkf_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00425"></a>00425     }
<a name="l00426"></a>00426     <span class="keywordflow">return</span> procval;
<a name="l00427"></a>00427 }
<a name="l00428"></a>00428 
<a name="l00429"></a>00429 <span class="comment">/*</span>
<a name="l00430"></a>00430 <span class="comment"> *  call-seq:</span>
<a name="l00431"></a>00431 <span class="comment"> *     Proc.new {|...| block } -&gt; a_proc</span>
<a name="l00432"></a>00432 <span class="comment"> *     Proc.new                -&gt; a_proc</span>
<a name="l00433"></a>00433 <span class="comment"> *</span>
<a name="l00434"></a>00434 <span class="comment"> *  Creates a new &lt;code&gt;Proc&lt;/code&gt; object, bound to the current</span>
<a name="l00435"></a>00435 <span class="comment"> *  context. &lt;code&gt;Proc::new&lt;/code&gt; may be called without a block only</span>
<a name="l00436"></a>00436 <span class="comment"> *  within a method with an attached block, in which case that block is</span>
<a name="l00437"></a>00437 <span class="comment"> *  converted to the &lt;code&gt;Proc&lt;/code&gt; object.</span>
<a name="l00438"></a>00438 <span class="comment"> *</span>
<a name="l00439"></a>00439 <span class="comment"> *     def proc_from</span>
<a name="l00440"></a>00440 <span class="comment"> *       Proc.new</span>
<a name="l00441"></a>00441 <span class="comment"> *     end</span>
<a name="l00442"></a>00442 <span class="comment"> *     proc = proc_from { &quot;hello&quot; }</span>
<a name="l00443"></a>00443 <span class="comment"> *     proc.call   #=&gt; &quot;hello&quot;</span>
<a name="l00444"></a>00444 <span class="comment"> */</span>
<a name="l00445"></a>00445 
<a name="l00446"></a>00446 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l00447"></a><a class="code" href="../../d3/dda/proc_8c.html#af949462992fdb218af024db37354675c">00447</a> <a class="code" href="../../d3/dda/proc_8c.html#af949462992fdb218af024db37354675c">rb_proc_s_new</a>(<span class="keywordtype">int</span> <a class="code" href="../../df/d77/ruby_8c.html#ad1447518f4372828b8435ae82e48499e">argc</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> *<a class="code" href="../../df/d77/ruby_8c.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> klass)
<a name="l00448"></a>00448 {
<a name="l00449"></a>00449     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> block = <a class="code" href="../../d3/dda/proc_8c.html#a6584f9a448ed7805f8e72a53c763b79b">proc_new</a>(klass, <a class="code" href="../../d1/d5c/nkf_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>);
<a name="l00450"></a>00450 
<a name="l00451"></a>00451     <a class="code" href="../../d3/d57/eval_8c.html#ad3ae1a7723c48c35c5323b9d45c565fa">rb_obj_call_init</a>(block, argc, argv);
<a name="l00452"></a>00452     <span class="keywordflow">return</span> block;
<a name="l00453"></a>00453 }
<a name="l00454"></a>00454 
<a name="l00455"></a>00455 <span class="comment">/*</span>
<a name="l00456"></a>00456 <span class="comment"> * call-seq:</span>
<a name="l00457"></a>00457 <span class="comment"> *   proc   { |...| block }  -&gt; a_proc</span>
<a name="l00458"></a>00458 <span class="comment"> *</span>
<a name="l00459"></a>00459 <span class="comment"> * Equivalent to &lt;code&gt;Proc.new&lt;/code&gt;.</span>
<a name="l00460"></a>00460 <span class="comment"> */</span>
<a name="l00461"></a>00461 
<a name="l00462"></a>00462 <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l00463"></a><a class="code" href="../../d3/dda/proc_8c.html#a7b330d2905c5f0c9a68cef4ebba5c00f">00463</a> <a class="code" href="../../db/d2e/intern_8h.html#a7b330d2905c5f0c9a68cef4ebba5c00f">rb_block_proc</a>(<span class="keywordtype">void</span>)
<a name="l00464"></a>00464 {
<a name="l00465"></a>00465     <span class="keywordflow">return</span> <a class="code" href="../../d3/dda/proc_8c.html#a6584f9a448ed7805f8e72a53c763b79b">proc_new</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#abd0d5fa9d171dbf020e85958391437f9">rb_cProc</a>, <a class="code" href="../../d1/d5c/nkf_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>);
<a name="l00466"></a>00466 }
<a name="l00467"></a>00467 
<a name="l00468"></a>00468 <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l00469"></a><a class="code" href="../../d3/dda/proc_8c.html#acd98b4a614a453bc439758cd68a32985">00469</a> <a class="code" href="../../d3/dda/proc_8c.html#acd98b4a614a453bc439758cd68a32985">rb_block_lambda</a>(<span class="keywordtype">void</span>)
<a name="l00470"></a>00470 {
<a name="l00471"></a>00471     <span class="keywordflow">return</span> <a class="code" href="../../d3/dda/proc_8c.html#a6584f9a448ed7805f8e72a53c763b79b">proc_new</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#abd0d5fa9d171dbf020e85958391437f9">rb_cProc</a>, <a class="code" href="../../d1/d5c/nkf_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l00472"></a>00472 }
<a name="l00473"></a>00473 
<a name="l00474"></a>00474 <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l00475"></a><a class="code" href="../../d3/dda/proc_8c.html#a65356554cf019b5dde6a447942bd036e">00475</a> <a class="code" href="../../db/d2e/intern_8h.html#a65356554cf019b5dde6a447942bd036e">rb_f_lambda</a>(<span class="keywordtype">void</span>)
<a name="l00476"></a>00476 {
<a name="l00477"></a>00477     <a class="code" href="../../db/dcc/error_8c.html#aa5b1972d475e9a090c8ef607ce033008">rb_warn</a>(<span class="stringliteral">&quot;rb_f_lambda() is deprecated; use rb_block_proc() instead&quot;</span>);
<a name="l00478"></a>00478     <span class="keywordflow">return</span> <a class="code" href="../../d3/dda/proc_8c.html#acd98b4a614a453bc439758cd68a32985">rb_block_lambda</a>();
<a name="l00479"></a>00479 }
<a name="l00480"></a>00480 
<a name="l00481"></a>00481 <span class="comment">/*</span>
<a name="l00482"></a>00482 <span class="comment"> * call-seq:</span>
<a name="l00483"></a>00483 <span class="comment"> *   lambda { |...| block }  -&gt; a_proc</span>
<a name="l00484"></a>00484 <span class="comment"> *</span>
<a name="l00485"></a>00485 <span class="comment"> * Equivalent to &lt;code&gt;Proc.new&lt;/code&gt;, except the resulting Proc objects</span>
<a name="l00486"></a>00486 <span class="comment"> * check the number of parameters passed when called.</span>
<a name="l00487"></a>00487 <span class="comment"> */</span>
<a name="l00488"></a>00488 
<a name="l00489"></a>00489 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l00490"></a><a class="code" href="../../d3/dda/proc_8c.html#a637a43e2bb4cf4cee32d165730d9469f">00490</a> <a class="code" href="../../d3/dda/proc_8c.html#a637a43e2bb4cf4cee32d165730d9469f">proc_lambda</a>(<span class="keywordtype">void</span>)
<a name="l00491"></a>00491 {
<a name="l00492"></a>00492     <span class="keywordflow">return</span> <a class="code" href="../../d3/dda/proc_8c.html#acd98b4a614a453bc439758cd68a32985">rb_block_lambda</a>();
<a name="l00493"></a>00493 }
<a name="l00494"></a>00494 
<a name="l00495"></a>00495 <span class="comment">/*  Document-method: ===</span>
<a name="l00496"></a>00496 <span class="comment"> *</span>
<a name="l00497"></a>00497 <span class="comment"> *  call-seq:</span>
<a name="l00498"></a>00498 <span class="comment"> *     proc === obj   -&gt; result_of_proc</span>
<a name="l00499"></a>00499 <span class="comment"> *</span>
<a name="l00500"></a>00500 <span class="comment"> *  Invokes the block with +obj+ as the proc&apos;s parameter like Proc#call.  It</span>
<a name="l00501"></a>00501 <span class="comment"> *  is to allow a proc object to be a target of +when+ clause in a case</span>
<a name="l00502"></a>00502 <span class="comment"> *  statement.</span>
<a name="l00503"></a>00503 <span class="comment"> */</span>
<a name="l00504"></a>00504 
<a name="l00505"></a>00505 <span class="comment">/* CHECKME: are the argument checking semantics correct? */</span>
<a name="l00506"></a>00506 
<a name="l00507"></a>00507 <span class="comment">/*</span>
<a name="l00508"></a>00508 <span class="comment"> *  call-seq:</span>
<a name="l00509"></a>00509 <span class="comment"> *     prc.call(params,...)   -&gt; obj</span>
<a name="l00510"></a>00510 <span class="comment"> *     prc[params,...]        -&gt; obj</span>
<a name="l00511"></a>00511 <span class="comment"> *     prc.(params,...)       -&gt; obj</span>
<a name="l00512"></a>00512 <span class="comment"> *</span>
<a name="l00513"></a>00513 <span class="comment"> *  Invokes the block, setting the block&apos;s parameters to the values in</span>
<a name="l00514"></a>00514 <span class="comment"> *  &lt;i&gt;params&lt;/i&gt; using something close to method calling semantics.</span>
<a name="l00515"></a>00515 <span class="comment"> *  Generates a warning if multiple values are passed to a proc that</span>
<a name="l00516"></a>00516 <span class="comment"> *  expects just one (previously this silently converted the parameters</span>
<a name="l00517"></a>00517 <span class="comment"> *  to an array).  Note that prc.() invokes prc.call() with the parameters</span>
<a name="l00518"></a>00518 <span class="comment"> *  given.  It&apos;s a syntax sugar to hide &quot;call&quot;.</span>
<a name="l00519"></a>00519 <span class="comment"> *</span>
<a name="l00520"></a>00520 <span class="comment"> *  For procs created using &lt;code&gt;lambda&lt;/code&gt; or &lt;code&gt;-&gt;()&lt;/code&gt; an error</span>
<a name="l00521"></a>00521 <span class="comment"> *  is generated if the wrong number of parameters are passed to a Proc with</span>
<a name="l00522"></a>00522 <span class="comment"> *  multiple parameters.  For procs created using &lt;code&gt;Proc.new&lt;/code&gt; or</span>
<a name="l00523"></a>00523 <span class="comment"> *  &lt;code&gt;Kernel.proc&lt;/code&gt;, extra parameters are silently discarded.</span>
<a name="l00524"></a>00524 <span class="comment"> *</span>
<a name="l00525"></a>00525 <span class="comment"> *  Returns the value of the last expression evaluated in the block. See</span>
<a name="l00526"></a>00526 <span class="comment"> *  also &lt;code&gt;Proc#yield&lt;/code&gt;.</span>
<a name="l00527"></a>00527 <span class="comment"> *</span>
<a name="l00528"></a>00528 <span class="comment"> *     a_proc = Proc.new {|a, *b| b.collect {|i| i*a }}</span>
<a name="l00529"></a>00529 <span class="comment"> *     a_proc.call(9, 1, 2, 3)   #=&gt; [9, 18, 27]</span>
<a name="l00530"></a>00530 <span class="comment"> *     a_proc[9, 1, 2, 3]        #=&gt; [9, 18, 27]</span>
<a name="l00531"></a>00531 <span class="comment"> *     a_proc = lambda {|a,b| a}</span>
<a name="l00532"></a>00532 <span class="comment"> *     a_proc.call(1,2,3)</span>
<a name="l00533"></a>00533 <span class="comment"> *</span>
<a name="l00534"></a>00534 <span class="comment"> *  &lt;em&gt;produces:&lt;/em&gt;</span>
<a name="l00535"></a>00535 <span class="comment"> *</span>
<a name="l00536"></a>00536 <span class="comment"> *     prog.rb:4:in `block in &lt;main&gt;&apos;: wrong number of arguments (3 for 2) (ArgumentError)</span>
<a name="l00537"></a>00537 <span class="comment"> *      from prog.rb:5:in `call&apos;</span>
<a name="l00538"></a>00538 <span class="comment"> *      from prog.rb:5:in `&lt;main&gt;&apos;</span>
<a name="l00539"></a>00539 <span class="comment"> *</span>
<a name="l00540"></a>00540 <span class="comment"> */</span>
<a name="l00541"></a>00541 
<a name="l00542"></a>00542 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l00543"></a><a class="code" href="../../d3/dda/proc_8c.html#a5640ece4bd96326864dcd4beaec4bdc5">00543</a> <a class="code" href="../../d3/dda/proc_8c.html#a5640ece4bd96326864dcd4beaec4bdc5">proc_call</a>(<span class="keywordtype">int</span> <a class="code" href="../../df/d77/ruby_8c.html#ad1447518f4372828b8435ae82e48499e">argc</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> *<a class="code" href="../../df/d77/ruby_8c.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> procval)
<a name="l00544"></a>00544 {
<a name="l00545"></a>00545     <a class="code" href="../../d5/d77/structrb__proc__t.html">rb_proc_t</a> *proc;
<a name="l00546"></a>00546     <a class="code" href="../../da/dc0/structrb__block__struct.html">rb_block_t</a> *blockptr = 0;
<a name="l00547"></a>00547     <a class="code" href="../../d6/de3/structrb__iseq__struct.html">rb_iseq_t</a> *iseq;
<a name="l00548"></a>00548     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> passed_procval;
<a name="l00549"></a>00549     <a class="code" href="../../d8/d32/vm__core_8h.html#ad9cb04a311c21bdbbd936d8f8b7237db">GetProcPtr</a>(procval, proc);
<a name="l00550"></a>00550 
<a name="l00551"></a>00551     iseq = proc-&gt;<a class="code" href="../../d5/d77/structrb__proc__t.html#acf80b0e350012548c28cba1ea64a7a6e">block</a>.<a class="code" href="../../da/dc0/structrb__block__struct.html#a8e2b3b9218b4a184f198872404e81605">iseq</a>;
<a name="l00552"></a>00552     <span class="keywordflow">if</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#aee74f540353cd2d77d1cb37a3714bd7d">BUILTIN_TYPE</a>(iseq) == <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a5f1cc49c4da51d5bdffa64be79ff6fb0">T_NODE</a> || iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a18ca49729d098ee7f25c9d3c3f0d9547">arg_block</a> != -1) {
<a name="l00553"></a>00553         <span class="keywordflow">if</span> (<a class="code" href="../../d3/d57/eval_8c.html#aea346c4eb8bc06df88422e956bb05fec">rb_block_given_p</a>()) {
<a name="l00554"></a>00554             <a class="code" href="../../d5/d77/structrb__proc__t.html">rb_proc_t</a> *passed_proc;
<a name="l00555"></a>00555             <a class="code" href="../../d8/df4/generator_8h.html#ad2bf389f3fddea7bd3befa162c70561a">RB_GC_GUARD</a>(passed_procval) = <a class="code" href="../../db/d2e/intern_8h.html#a7b330d2905c5f0c9a68cef4ebba5c00f">rb_block_proc</a>();
<a name="l00556"></a>00556             <a class="code" href="../../d8/d32/vm__core_8h.html#ad9cb04a311c21bdbbd936d8f8b7237db">GetProcPtr</a>(passed_procval, passed_proc);
<a name="l00557"></a>00557             blockptr = &amp;passed_proc-&gt;<a class="code" href="../../d5/d77/structrb__proc__t.html#acf80b0e350012548c28cba1ea64a7a6e">block</a>;
<a name="l00558"></a>00558         }
<a name="l00559"></a>00559     }
<a name="l00560"></a>00560 
<a name="l00561"></a>00561     <span class="keywordflow">return</span> <a class="code" href="../../de/de9/vm_8c.html#a87fd97e34aa2d7399db658edb02ea083">rb_vm_invoke_proc</a>(<a class="code" href="../../d8/d32/vm__core_8h.html#a8deb84ec6023e3229db88ac2c9da6138">GET_THREAD</a>(), proc, proc-&gt;<a class="code" href="../../d5/d77/structrb__proc__t.html#acf80b0e350012548c28cba1ea64a7a6e">block</a>.<a class="code" href="../../da/dc0/structrb__block__struct.html#ad54e1ec45ab21ef384fe9e4346570397">self</a>,
<a name="l00562"></a>00562                              argc, argv, blockptr);
<a name="l00563"></a>00563 }
<a name="l00564"></a>00564 
<a name="l00565"></a>00565 <span class="preprocessor">#if SIZEOF_LONG &gt; SIZEOF_INT</span>
<a name="l00566"></a>00566 <span class="preprocessor"></span><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span>
<a name="l00567"></a>00567 <a class="code" href="../../d3/dda/proc_8c.html#a4200f9fe2afc8140313fbc922d98d258">check_argc</a>(<span class="keywordtype">long</span> <a class="code" href="../../df/d77/ruby_8c.html#ad1447518f4372828b8435ae82e48499e">argc</a>)
<a name="l00568"></a>00568 {
<a name="l00569"></a>00569     <span class="keywordflow">if</span> (argc &gt; INT_MAX || argc &lt; 0) {
<a name="l00570"></a>00570         <a class="code" href="../../db/dcc/error_8c.html#a0f771a2840561f1838169b3d7d4616f3">rb_raise</a>(<a class="code" href="../../db/dcc/error_8c.html#ab5e2a9fec766c75176fbb262bfe6a596">rb_eArgError</a>, <span class="stringliteral">&quot;too many arguments (%lu)&quot;</span>,
<a name="l00571"></a>00571                  (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)argc);
<a name="l00572"></a>00572     }
<a name="l00573"></a>00573     <span class="keywordflow">return</span> (<span class="keywordtype">int</span>)argc;
<a name="l00574"></a>00574 }
<a name="l00575"></a>00575 <span class="preprocessor">#else</span>
<a name="l00576"></a><a class="code" href="../../d3/dda/proc_8c.html#a4200f9fe2afc8140313fbc922d98d258">00576</a> <span class="preprocessor"></span><span class="preprocessor">#define check_argc(argc) (argc)</span>
<a name="l00577"></a>00577 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00578"></a>00578 <span class="preprocessor"></span>
<a name="l00579"></a>00579 <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l00580"></a><a class="code" href="../../d3/dda/proc_8c.html#a0bd87bd6f8286f716fd1723579bc4bcf">00580</a> <a class="code" href="../../db/d2e/intern_8h.html#ac83215f3f701e797bb43ac8cbaae1aae">rb_proc_call</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <span class="keyword">self</span>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <a class="code" href="../../d3/d09/ripper_8y.html#a8187411843a6284ffb964ef3fb9fcab3">args</a>)
<a name="l00581"></a>00581 {
<a name="l00582"></a>00582     <a class="code" href="../../d5/d77/structrb__proc__t.html">rb_proc_t</a> *proc;
<a name="l00583"></a>00583     <a class="code" href="../../d8/d32/vm__core_8h.html#ad9cb04a311c21bdbbd936d8f8b7237db">GetProcPtr</a>(<span class="keyword">self</span>, proc);
<a name="l00584"></a>00584     <span class="keywordflow">return</span> <a class="code" href="../../de/de9/vm_8c.html#a87fd97e34aa2d7399db658edb02ea083">rb_vm_invoke_proc</a>(<a class="code" href="../../d8/d32/vm__core_8h.html#a8deb84ec6023e3229db88ac2c9da6138">GET_THREAD</a>(), proc, proc-&gt;<a class="code" href="../../d5/d77/structrb__proc__t.html#acf80b0e350012548c28cba1ea64a7a6e">block</a>.<a class="code" href="../../da/dc0/structrb__block__struct.html#ad54e1ec45ab21ef384fe9e4346570397">self</a>,
<a name="l00585"></a>00585                              <a class="code" href="../../d3/dda/proc_8c.html#a4200f9fe2afc8140313fbc922d98d258">check_argc</a>(<a class="code" href="../../d8/df4/generator_8h.html#ae988773ed219452578f881fc7189c486">RARRAY_LEN</a>(args)), <a class="code" href="../../d8/df4/generator_8h.html#abb794fe2d7c73eea87e7ba2273939a8e">RARRAY_PTR</a>(args), 0);
<a name="l00586"></a>00586 }
<a name="l00587"></a>00587 
<a name="l00588"></a>00588 <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l00589"></a><a class="code" href="../../d3/dda/proc_8c.html#a4874276774b9f31ad45e4b3d5ef9461a">00589</a> <a class="code" href="../../db/d2e/intern_8h.html#a55046c9120a3018843e93b629445953e">rb_proc_call_with_block</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <span class="keyword">self</span>, <span class="keywordtype">int</span> argc, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> *<a class="code" href="../../df/d77/ruby_8c.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> pass_procval)
<a name="l00590"></a>00590 {
<a name="l00591"></a>00591     <a class="code" href="../../d5/d77/structrb__proc__t.html">rb_proc_t</a> *proc;
<a name="l00592"></a>00592     <a class="code" href="../../da/dc0/structrb__block__struct.html">rb_block_t</a> *block = 0;
<a name="l00593"></a>00593     <a class="code" href="../../d8/d32/vm__core_8h.html#ad9cb04a311c21bdbbd936d8f8b7237db">GetProcPtr</a>(<span class="keyword">self</span>, proc);
<a name="l00594"></a>00594 
<a name="l00595"></a>00595     <span class="keywordflow">if</span> (!<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a4832bad8845a35fc50f7a160901854a1">NIL_P</a>(pass_procval)) {
<a name="l00596"></a>00596         <a class="code" href="../../d5/d77/structrb__proc__t.html">rb_proc_t</a> *pass_proc;
<a name="l00597"></a>00597         <a class="code" href="../../d8/d32/vm__core_8h.html#ad9cb04a311c21bdbbd936d8f8b7237db">GetProcPtr</a>(pass_procval, pass_proc);
<a name="l00598"></a>00598         block = &amp;pass_proc-&gt;<a class="code" href="../../d5/d77/structrb__proc__t.html#acf80b0e350012548c28cba1ea64a7a6e">block</a>;
<a name="l00599"></a>00599     }
<a name="l00600"></a>00600 
<a name="l00601"></a>00601     <span class="keywordflow">return</span> <a class="code" href="../../de/de9/vm_8c.html#a87fd97e34aa2d7399db658edb02ea083">rb_vm_invoke_proc</a>(<a class="code" href="../../d8/d32/vm__core_8h.html#a8deb84ec6023e3229db88ac2c9da6138">GET_THREAD</a>(), proc, proc-&gt;<a class="code" href="../../d5/d77/structrb__proc__t.html#acf80b0e350012548c28cba1ea64a7a6e">block</a>.<a class="code" href="../../da/dc0/structrb__block__struct.html#ad54e1ec45ab21ef384fe9e4346570397">self</a>,
<a name="l00602"></a>00602                              argc, argv, block);
<a name="l00603"></a>00603 }
<a name="l00604"></a>00604 
<a name="l00605"></a>00605 <span class="comment">/*</span>
<a name="l00606"></a>00606 <span class="comment"> *  call-seq:</span>
<a name="l00607"></a>00607 <span class="comment"> *     prc.arity -&gt; fixnum</span>
<a name="l00608"></a>00608 <span class="comment"> *</span>
<a name="l00609"></a>00609 <span class="comment"> *  Returns the number of arguments that would not be ignored. If the block</span>
<a name="l00610"></a>00610 <span class="comment"> *  is declared to take no arguments, returns 0. If the block is known</span>
<a name="l00611"></a>00611 <span class="comment"> *  to take exactly n arguments, returns n. If the block has optional</span>
<a name="l00612"></a>00612 <span class="comment"> *  arguments, return -n-1, where n is the number of mandatory</span>
<a name="l00613"></a>00613 <span class="comment"> *  arguments. A &lt;code&gt;proc&lt;/code&gt; with no argument declarations</span>
<a name="l00614"></a>00614 <span class="comment"> *  is the same a block declaring &lt;code&gt;||&lt;/code&gt; as its arguments.</span>
<a name="l00615"></a>00615 <span class="comment"> *</span>
<a name="l00616"></a>00616 <span class="comment"> *     Proc.new {}.arity          #=&gt;  0</span>
<a name="l00617"></a>00617 <span class="comment"> *     Proc.new {||}.arity        #=&gt;  0</span>
<a name="l00618"></a>00618 <span class="comment"> *     Proc.new {|a|}.arity       #=&gt;  1</span>
<a name="l00619"></a>00619 <span class="comment"> *     Proc.new {|a,b|}.arity     #=&gt;  2</span>
<a name="l00620"></a>00620 <span class="comment"> *     Proc.new {|a,b,c|}.arity   #=&gt;  3</span>
<a name="l00621"></a>00621 <span class="comment"> *     Proc.new {|*a|}.arity      #=&gt; -1</span>
<a name="l00622"></a>00622 <span class="comment"> *     Proc.new {|a,*b|}.arity    #=&gt; -2</span>
<a name="l00623"></a>00623 <span class="comment"> *     Proc.new {|a,*b, c|}.arity    #=&gt; -3</span>
<a name="l00624"></a>00624 <span class="comment"> */</span>
<a name="l00625"></a>00625 
<a name="l00626"></a>00626 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l00627"></a><a class="code" href="../../d3/dda/proc_8c.html#a4147fc7a7a93445816658c810dbac43e">00627</a> <a class="code" href="../../d3/dda/proc_8c.html#a4147fc7a7a93445816658c810dbac43e">proc_arity</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <span class="keyword">self</span>)
<a name="l00628"></a>00628 {
<a name="l00629"></a>00629     <span class="keywordtype">int</span> arity = <a class="code" href="../../db/d2e/intern_8h.html#a2d07fdb0461b17bb54671e2cbc5778d8">rb_proc_arity</a>(<span class="keyword">self</span>);
<a name="l00630"></a>00630     <span class="keywordflow">return</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(arity);
<a name="l00631"></a>00631 }
<a name="l00632"></a>00632 
<a name="l00633"></a>00633 <span class="keywordtype">int</span>
<a name="l00634"></a><a class="code" href="../../d3/dda/proc_8c.html#a73516961f335d664b2991078c5e17645">00634</a> <a class="code" href="../../db/d2e/intern_8h.html#a2d07fdb0461b17bb54671e2cbc5778d8">rb_proc_arity</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <span class="keyword">self</span>)
<a name="l00635"></a>00635 {
<a name="l00636"></a>00636     <a class="code" href="../../d5/d77/structrb__proc__t.html">rb_proc_t</a> *proc;
<a name="l00637"></a>00637     <a class="code" href="../../d6/de3/structrb__iseq__struct.html">rb_iseq_t</a> *iseq;
<a name="l00638"></a>00638     <a class="code" href="../../d8/d32/vm__core_8h.html#ad9cb04a311c21bdbbd936d8f8b7237db">GetProcPtr</a>(<span class="keyword">self</span>, proc);
<a name="l00639"></a>00639     iseq = proc-&gt;<a class="code" href="../../d5/d77/structrb__proc__t.html#acf80b0e350012548c28cba1ea64a7a6e">block</a>.<a class="code" href="../../da/dc0/structrb__block__struct.html#a8e2b3b9218b4a184f198872404e81605">iseq</a>;
<a name="l00640"></a>00640     <span class="keywordflow">if</span> (iseq) {
<a name="l00641"></a>00641         <span class="keywordflow">if</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#aee74f540353cd2d77d1cb37a3714bd7d">BUILTIN_TYPE</a>(iseq) != <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a5f1cc49c4da51d5bdffa64be79ff6fb0">T_NODE</a>) {
<a name="l00642"></a>00642             <span class="keywordflow">if</span> (iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a21bd6b9b1c875df9484cc16f8dd9c73e">arg_rest</a> &lt; 0) {
<a name="l00643"></a>00643                 <span class="keywordflow">return</span> iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a5fd0acd110681eeb0f95c3b283451a0a" title="argument information">argc</a>;
<a name="l00644"></a>00644             }
<a name="l00645"></a>00645             <span class="keywordflow">else</span> {
<a name="l00646"></a>00646                 <span class="keywordflow">return</span> -(iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a5fd0acd110681eeb0f95c3b283451a0a" title="argument information">argc</a> + 1 + iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a4915a4238c8e8e7106337e5e1c609576">arg_post_len</a>);
<a name="l00647"></a>00647             }
<a name="l00648"></a>00648         }
<a name="l00649"></a>00649         <span class="keywordflow">else</span> {
<a name="l00650"></a>00650             NODE *<a class="code" href="../../d7/dc0/parse_8y.html#a0d7af8a92c4b0a07f71585584ef9634f">node</a> = (NODE *)iseq;
<a name="l00651"></a>00651             <span class="keywordflow">if</span> (<a class="code" href="../../d3/dda/proc_8c.html#a1a518cf87411d1e474335ddb66091741">IS_METHOD_PROC_NODE</a>(node)) {
<a name="l00652"></a>00652                 <span class="comment">/* method(:foo).to_proc.arity */</span>
<a name="l00653"></a>00653                 <span class="keywordflow">return</span> <a class="code" href="../../d3/dda/proc_8c.html#a7f35da9e01e956b215307b9871d20553">method_arity</a>(node-&gt;nd_tval);
<a name="l00654"></a>00654             }
<a name="l00655"></a>00655         }
<a name="l00656"></a>00656     }
<a name="l00657"></a>00657     <span class="keywordflow">return</span> -1;
<a name="l00658"></a>00658 }
<a name="l00659"></a>00659 
<a name="l00660"></a><a class="code" href="../../d3/dda/proc_8c.html#a67538e5c8312f56b5a41b8208ee5c5d1">00660</a> <span class="preprocessor">#define get_proc_iseq rb_proc_get_iseq</span>
<a name="l00661"></a>00661 <span class="preprocessor"></span>
<a name="l00662"></a>00662 <a class="code" href="../../d6/de3/structrb__iseq__struct.html">rb_iseq_t</a> *
<a name="l00663"></a><a class="code" href="../../d3/dda/proc_8c.html#aa620c3f0d60d5fb7953a1a998c5663d4">00663</a> <a class="code" href="../../d7/dc8/iseq_8h.html#ab6b718e0282cd6c03e61c4e66c22d781">rb_proc_get_iseq</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <span class="keyword">self</span>, <span class="keywordtype">int</span> *is_proc)
<a name="l00664"></a>00664 {
<a name="l00665"></a>00665     <a class="code" href="../../d5/d77/structrb__proc__t.html">rb_proc_t</a> *proc;
<a name="l00666"></a>00666     <a class="code" href="../../d6/de3/structrb__iseq__struct.html">rb_iseq_t</a> *iseq;
<a name="l00667"></a>00667 
<a name="l00668"></a>00668     <a class="code" href="../../d8/d32/vm__core_8h.html#ad9cb04a311c21bdbbd936d8f8b7237db">GetProcPtr</a>(<span class="keyword">self</span>, proc);
<a name="l00669"></a>00669     iseq = proc-&gt;<a class="code" href="../../d5/d77/structrb__proc__t.html#acf80b0e350012548c28cba1ea64a7a6e">block</a>.<a class="code" href="../../da/dc0/structrb__block__struct.html#a8e2b3b9218b4a184f198872404e81605">iseq</a>;
<a name="l00670"></a>00670     <span class="keywordflow">if</span> (is_proc) *is_proc = !proc-&gt;<a class="code" href="../../d5/d77/structrb__proc__t.html#a7ec13535f2806b214e34a7db8460056b">is_lambda</a>;
<a name="l00671"></a>00671     <span class="keywordflow">if</span> (!<a class="code" href="../../d8/d32/vm__core_8h.html#a79d03ad9b9cf8b7a8ca2b849e495a74f">RUBY_VM_NORMAL_ISEQ_P</a>(iseq)) {
<a name="l00672"></a>00672         NODE *<a class="code" href="../../d7/dc0/parse_8y.html#a0d7af8a92c4b0a07f71585584ef9634f">node</a> = (NODE *)iseq;
<a name="l00673"></a>00673         iseq = 0;
<a name="l00674"></a>00674         <span class="keywordflow">if</span> (<a class="code" href="../../d3/dda/proc_8c.html#a1a518cf87411d1e474335ddb66091741">IS_METHOD_PROC_NODE</a>(node)) {
<a name="l00675"></a>00675             <span class="comment">/* method(:foo).to_proc */</span>
<a name="l00676"></a>00676             iseq = <a class="code" href="../../d7/dc8/iseq_8h.html#ab5b6d8f8d16cb0a7aca7e95040682084">rb_method_get_iseq</a>(node-&gt;nd_tval);
<a name="l00677"></a>00677             <span class="keywordflow">if</span> (is_proc) *is_proc = 0;
<a name="l00678"></a>00678         }
<a name="l00679"></a>00679     }
<a name="l00680"></a>00680     <span class="keywordflow">return</span> iseq;
<a name="l00681"></a>00681 }
<a name="l00682"></a>00682 
<a name="l00683"></a>00683 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l00684"></a><a class="code" href="../../d3/dda/proc_8c.html#ada097a6efbfd8d1e62683d981b21eef7">00684</a> <a class="code" href="../../d3/dda/proc_8c.html#ada097a6efbfd8d1e62683d981b21eef7">iseq_location</a>(<a class="code" href="../../d6/de3/structrb__iseq__struct.html">rb_iseq_t</a> *iseq)
<a name="l00685"></a>00685 {
<a name="l00686"></a>00686     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> loc[2];
<a name="l00687"></a>00687 
<a name="l00688"></a>00688     <span class="keywordflow">if</span> (!iseq) <span class="keywordflow">return</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a320970f989dc8294c8203154e3db40c1">Qnil</a>;
<a name="l00689"></a>00689     loc[0] = iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a06859fa5de56f2ede3cb692f1d9215e2">filename</a>;
<a name="l00690"></a>00690     <span class="keywordflow">if</span> (iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a7d6b0dd003b6703454061024b11481ad">insn_info_table</a>) {
<a name="l00691"></a>00691         loc[1] = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(<a class="code" href="../../dd/d74/iseq_8c.html#a2bf706296b2f128f187282d9594fb8ee">rb_iseq_first_lineno</a>(iseq));
<a name="l00692"></a>00692     }
<a name="l00693"></a>00693     <span class="keywordflow">else</span> {
<a name="l00694"></a>00694         loc[1] = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a320970f989dc8294c8203154e3db40c1">Qnil</a>;
<a name="l00695"></a>00695     }
<a name="l00696"></a>00696     <span class="keywordflow">return</span> <a class="code" href="../../dc/dcc/array_8c.html#a575a99eebf6ce65893ed83c2b6783d2d">rb_ary_new4</a>(2, loc);
<a name="l00697"></a>00697 }
<a name="l00698"></a>00698 
<a name="l00699"></a>00699 <span class="comment">/*</span>
<a name="l00700"></a>00700 <span class="comment"> * call-seq:</span>
<a name="l00701"></a>00701 <span class="comment"> *    prc.source_location  -&gt; [String, Fixnum]</span>
<a name="l00702"></a>00702 <span class="comment"> *</span>
<a name="l00703"></a>00703 <span class="comment"> * Returns the Ruby source filename and line number containing this proc</span>
<a name="l00704"></a>00704 <span class="comment"> * or +nil+ if this proc was not defined in Ruby (i.e. native)</span>
<a name="l00705"></a>00705 <span class="comment"> */</span>
<a name="l00706"></a>00706 
<a name="l00707"></a>00707 <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l00708"></a><a class="code" href="../../d3/dda/proc_8c.html#ac3a12eb7e4f35538dfd8cdd35d7f1155">00708</a> <a class="code" href="../../d3/dda/proc_8c.html#ac3a12eb7e4f35538dfd8cdd35d7f1155">rb_proc_location</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <span class="keyword">self</span>)
<a name="l00709"></a>00709 {
<a name="l00710"></a>00710     <span class="keywordflow">return</span> <a class="code" href="../../d3/dda/proc_8c.html#ada097a6efbfd8d1e62683d981b21eef7">iseq_location</a>(<a class="code" href="../../d3/dda/proc_8c.html#a67538e5c8312f56b5a41b8208ee5c5d1">get_proc_iseq</a>(<span class="keyword">self</span>, 0));
<a name="l00711"></a>00711 }
<a name="l00712"></a>00712 
<a name="l00713"></a>00713 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l00714"></a><a class="code" href="../../d3/dda/proc_8c.html#a1ebd05bf80391d27cbd99fb76967b14e">00714</a> <a class="code" href="../../d3/dda/proc_8c.html#a1ebd05bf80391d27cbd99fb76967b14e">unnamed_parameters</a>(<span class="keywordtype">int</span> arity)
<a name="l00715"></a>00715 {
<a name="l00716"></a>00716     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> a, param = <a class="code" href="../../dc/dcc/array_8c.html#a43a7bd246935ab63c233b4ae34d61d75">rb_ary_new2</a>((arity &lt; 0) ? -arity : arity);
<a name="l00717"></a>00717     <span class="keywordtype">int</span> n = (arity &lt; 0) ? ~arity : arity;
<a name="l00718"></a>00718     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#afa5b9137f051ac26d7ccc8824f178233">ID</a> req, rest;
<a name="l00719"></a>00719     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aa50b9d5bc665eb5545f6857c89232161">CONST_ID</a>(req, <span class="stringliteral">&quot;req&quot;</span>);
<a name="l00720"></a>00720     a = <a class="code" href="../../dc/dcc/array_8c.html#a8317ecd6a0abb5ad08c50c732f30059b">rb_ary_new3</a>(1, <a class="code" href="../../dc/d0c/cparse_8c.html#a48bfb6519a45249fb2ec0193ea3b6e1c">ID2SYM</a>(req));
<a name="l00721"></a>00721     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a7ae8fa209abf837905d53c1c4be7c75d">OBJ_FREEZE</a>(a);
<a name="l00722"></a>00722     <span class="keywordflow">for</span> (; n; --n) {
<a name="l00723"></a>00723         <a class="code" href="../../dc/dcc/array_8c.html#a59d553a8cd781364b8bcb0deae25cca2">rb_ary_push</a>(param, a);
<a name="l00724"></a>00724     }
<a name="l00725"></a>00725     <span class="keywordflow">if</span> (arity &lt; 0) {
<a name="l00726"></a>00726         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aa50b9d5bc665eb5545f6857c89232161">CONST_ID</a>(rest, <span class="stringliteral">&quot;rest&quot;</span>);
<a name="l00727"></a>00727         <a class="code" href="../../dc/dcc/array_8c.html#a1d7683de2cd34217808092d90ffd0869">rb_ary_store</a>(param, ~arity, <a class="code" href="../../dc/dcc/array_8c.html#a8317ecd6a0abb5ad08c50c732f30059b">rb_ary_new3</a>(1, <a class="code" href="../../dc/d0c/cparse_8c.html#a48bfb6519a45249fb2ec0193ea3b6e1c">ID2SYM</a>(rest)));
<a name="l00728"></a>00728     }
<a name="l00729"></a>00729     <span class="keywordflow">return</span> param;
<a name="l00730"></a>00730 }
<a name="l00731"></a>00731 
<a name="l00732"></a>00732 <span class="comment">/*</span>
<a name="l00733"></a>00733 <span class="comment"> * call-seq:</span>
<a name="l00734"></a>00734 <span class="comment"> *    prc.parameters  -&gt; array</span>
<a name="l00735"></a>00735 <span class="comment"> *</span>
<a name="l00736"></a>00736 <span class="comment"> * Returns the parameter information of this proc.</span>
<a name="l00737"></a>00737 <span class="comment"> *</span>
<a name="l00738"></a>00738 <span class="comment"> *    prc = lambda{|x, y=42, *other|}</span>
<a name="l00739"></a>00739 <span class="comment"> *    prc.parameters  #=&gt; [[:req, :x], [:opt, :y], [:rest, :other]]</span>
<a name="l00740"></a>00740 <span class="comment"> */</span>
<a name="l00741"></a>00741 
<a name="l00742"></a>00742 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l00743"></a><a class="code" href="../../d3/dda/proc_8c.html#af66d622b83c9cb9a469063cf86946179">00743</a> <a class="code" href="../../d3/dda/proc_8c.html#af66d622b83c9cb9a469063cf86946179">rb_proc_parameters</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <span class="keyword">self</span>)
<a name="l00744"></a>00744 {
<a name="l00745"></a>00745     <span class="keywordtype">int</span> is_proc;
<a name="l00746"></a>00746     <a class="code" href="../../d6/de3/structrb__iseq__struct.html">rb_iseq_t</a> *iseq = <a class="code" href="../../d3/dda/proc_8c.html#a67538e5c8312f56b5a41b8208ee5c5d1">get_proc_iseq</a>(<span class="keyword">self</span>, &amp;is_proc);
<a name="l00747"></a>00747     <span class="keywordflow">if</span> (!iseq) {
<a name="l00748"></a>00748         <span class="keywordflow">return</span> <a class="code" href="../../d3/dda/proc_8c.html#a1ebd05bf80391d27cbd99fb76967b14e">unnamed_parameters</a>(<a class="code" href="../../db/d2e/intern_8h.html#a2d07fdb0461b17bb54671e2cbc5778d8">rb_proc_arity</a>(<span class="keyword">self</span>));
<a name="l00749"></a>00749     }
<a name="l00750"></a>00750     <span class="keywordflow">return</span> <a class="code" href="../../dd/d74/iseq_8c.html#a482bd449b1ad733210e57d697c544cc7">rb_iseq_parameters</a>(iseq, is_proc);
<a name="l00751"></a>00751 }
<a name="l00752"></a>00752 
<a name="l00753"></a>00753 <span class="comment">/*</span>
<a name="l00754"></a>00754 <span class="comment"> * call-seq:</span>
<a name="l00755"></a>00755 <span class="comment"> *   prc == other_proc   -&gt;  true or false</span>
<a name="l00756"></a>00756 <span class="comment"> *</span>
<a name="l00757"></a>00757 <span class="comment"> * Returns &lt;code&gt;true&lt;/code&gt; if &lt;i&gt;prc&lt;/i&gt; is the same object as</span>
<a name="l00758"></a>00758 <span class="comment"> * &lt;i&gt;other_proc&lt;/i&gt;, or if they are both procs with the same body.</span>
<a name="l00759"></a>00759 <span class="comment"> */</span>
<a name="l00760"></a>00760 
<a name="l00761"></a>00761 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l00762"></a><a class="code" href="../../d3/dda/proc_8c.html#ac8bf103785a400842c43af3db3a6e6a8">00762</a> <a class="code" href="../../d3/dda/proc_8c.html#ac8bf103785a400842c43af3db3a6e6a8">proc_eq</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <span class="keyword">self</span>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> other)
<a name="l00763"></a>00763 {
<a name="l00764"></a>00764     <span class="keywordflow">if</span> (<span class="keyword">self</span> == other) {
<a name="l00765"></a>00765         <span class="keywordflow">return</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aacea3516b33941ce8149098e223a7466">Qtrue</a>;
<a name="l00766"></a>00766     }
<a name="l00767"></a>00767     <span class="keywordflow">else</span> {
<a name="l00768"></a>00768         <span class="keywordflow">if</span> (<a class="code" href="../../db/d2e/intern_8h.html#a465568c66f9f2f257916e3a2f7f14aae">rb_obj_is_proc</a>(other)) {
<a name="l00769"></a>00769             <a class="code" href="../../d5/d77/structrb__proc__t.html">rb_proc_t</a> *p1, *p2;
<a name="l00770"></a>00770             <a class="code" href="../../d8/d32/vm__core_8h.html#ad9cb04a311c21bdbbd936d8f8b7237db">GetProcPtr</a>(<span class="keyword">self</span>, p1);
<a name="l00771"></a>00771             <a class="code" href="../../d8/d32/vm__core_8h.html#ad9cb04a311c21bdbbd936d8f8b7237db">GetProcPtr</a>(other, p2);
<a name="l00772"></a>00772             <span class="keywordflow">if</span> (p1-&gt;<a class="code" href="../../d5/d77/structrb__proc__t.html#acdb9a8c85422bf299615f7942ffbc916">envval</a> == p2-&gt;<a class="code" href="../../d5/d77/structrb__proc__t.html#acdb9a8c85422bf299615f7942ffbc916">envval</a> &amp;&amp;
<a name="l00773"></a>00773                 p1-&gt;<a class="code" href="../../d5/d77/structrb__proc__t.html#acf80b0e350012548c28cba1ea64a7a6e">block</a>.<a class="code" href="../../da/dc0/structrb__block__struct.html#a8e2b3b9218b4a184f198872404e81605">iseq</a>-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a6fd527787fc64d5e9d11478af447a85f">iseq_size</a> == p2-&gt;<a class="code" href="../../d5/d77/structrb__proc__t.html#acf80b0e350012548c28cba1ea64a7a6e">block</a>.<a class="code" href="../../da/dc0/structrb__block__struct.html#a8e2b3b9218b4a184f198872404e81605">iseq</a>-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a6fd527787fc64d5e9d11478af447a85f">iseq_size</a> &amp;&amp;
<a name="l00774"></a>00774                 p1-&gt;<a class="code" href="../../d5/d77/structrb__proc__t.html#acf80b0e350012548c28cba1ea64a7a6e">block</a>.<a class="code" href="../../da/dc0/structrb__block__struct.html#a8e2b3b9218b4a184f198872404e81605">iseq</a>-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#afbae994355f91f3ea547570debb757c0">local_size</a> == p2-&gt;<a class="code" href="../../d5/d77/structrb__proc__t.html#acf80b0e350012548c28cba1ea64a7a6e">block</a>.<a class="code" href="../../da/dc0/structrb__block__struct.html#a8e2b3b9218b4a184f198872404e81605">iseq</a>-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#afbae994355f91f3ea547570debb757c0">local_size</a> &amp;&amp;
<a name="l00775"></a>00775                 <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a42f38632bba2bb73abb03716754f3230">MEMCMP</a>(p1-&gt;<a class="code" href="../../d5/d77/structrb__proc__t.html#acf80b0e350012548c28cba1ea64a7a6e">block</a>.<a class="code" href="../../da/dc0/structrb__block__struct.html#a8e2b3b9218b4a184f198872404e81605">iseq</a>-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a8699ab44e2c44e7f8df87e26a9c7bee8">iseq</a>, p2-&gt;<a class="code" href="../../d5/d77/structrb__proc__t.html#acf80b0e350012548c28cba1ea64a7a6e">block</a>.<a class="code" href="../../da/dc0/structrb__block__struct.html#a8e2b3b9218b4a184f198872404e81605">iseq</a>-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a8699ab44e2c44e7f8df87e26a9c7bee8">iseq</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>,
<a name="l00776"></a>00776                        p1-&gt;<a class="code" href="../../d5/d77/structrb__proc__t.html#acf80b0e350012548c28cba1ea64a7a6e">block</a>.<a class="code" href="../../da/dc0/structrb__block__struct.html#a8e2b3b9218b4a184f198872404e81605">iseq</a>-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a6fd527787fc64d5e9d11478af447a85f">iseq_size</a>) == 0) {
<a name="l00777"></a>00777                 <span class="keywordflow">return</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aacea3516b33941ce8149098e223a7466">Qtrue</a>;
<a name="l00778"></a>00778             }
<a name="l00779"></a>00779         }
<a name="l00780"></a>00780     }
<a name="l00781"></a>00781     <span class="keywordflow">return</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aba0717d2689eb68797421a02ab9295c6">Qfalse</a>;
<a name="l00782"></a>00782 }
<a name="l00783"></a>00783 
<a name="l00784"></a>00784 <span class="comment">/*</span>
<a name="l00785"></a>00785 <span class="comment"> * call-seq:</span>
<a name="l00786"></a>00786 <span class="comment"> *   prc.hash   -&gt;  integer</span>
<a name="l00787"></a>00787 <span class="comment"> *</span>
<a name="l00788"></a>00788 <span class="comment"> * Returns a hash value corresponding to proc body.</span>
<a name="l00789"></a>00789 <span class="comment"> */</span>
<a name="l00790"></a>00790 
<a name="l00791"></a>00791 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l00792"></a><a class="code" href="../../d3/dda/proc_8c.html#aec40448c8ed3a89f90f22ef609be383a">00792</a> <a class="code" href="../../d3/dda/proc_8c.html#aec40448c8ed3a89f90f22ef609be383a">proc_hash</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <span class="keyword">self</span>)
<a name="l00793"></a>00793 {
<a name="l00794"></a>00794     <a class="code" href="../../dd/d24/st_8h.html#ac214e5cdcf0de6a2108b9643e7fc12e0">st_index_t</a> <a class="code" href="../../d3/deb/lex_8c.html#a5541f85ce416df233cce93949f0eeeca">hash</a>;
<a name="l00795"></a>00795     <a class="code" href="../../d5/d77/structrb__proc__t.html">rb_proc_t</a> *proc;
<a name="l00796"></a>00796     <a class="code" href="../../d8/d32/vm__core_8h.html#ad9cb04a311c21bdbbd936d8f8b7237db">GetProcPtr</a>(<span class="keyword">self</span>, proc);
<a name="l00797"></a>00797     hash = <a class="code" href="../../db/d2e/intern_8h.html#a574cdfa6fbf8c714858e4e7fb9c89019">rb_hash_start</a>((<a class="code" href="../../dd/d24/st_8h.html#ac214e5cdcf0de6a2108b9643e7fc12e0">st_index_t</a>)proc-&gt;<a class="code" href="../../d5/d77/structrb__proc__t.html#acf80b0e350012548c28cba1ea64a7a6e">block</a>.<a class="code" href="../../da/dc0/structrb__block__struct.html#a8e2b3b9218b4a184f198872404e81605">iseq</a>);
<a name="l00798"></a>00798     hash = <a class="code" href="../../db/d2e/intern_8h.html#a17289f18a17e3942ae41a002036f1308">rb_hash_uint</a>(hash, (<a class="code" href="../../dd/d24/st_8h.html#ac214e5cdcf0de6a2108b9643e7fc12e0">st_index_t</a>)proc-&gt;<a class="code" href="../../d5/d77/structrb__proc__t.html#acdb9a8c85422bf299615f7942ffbc916">envval</a>);
<a name="l00799"></a>00799     hash = <a class="code" href="../../db/d2e/intern_8h.html#a17289f18a17e3942ae41a002036f1308">rb_hash_uint</a>(hash, (<a class="code" href="../../dd/d24/st_8h.html#ac214e5cdcf0de6a2108b9643e7fc12e0">st_index_t</a>)proc-&gt;<a class="code" href="../../d5/d77/structrb__proc__t.html#acf80b0e350012548c28cba1ea64a7a6e">block</a>.<a class="code" href="../../da/dc0/structrb__block__struct.html#a834e1c9b35a06714deeb62097636564f">lfp</a> &gt;&gt; 16);
<a name="l00800"></a>00800     hash = <a class="code" href="../../db/d2e/intern_8h.html#a2394b60da89a848717643532411efcbd">rb_hash_end</a>(hash);
<a name="l00801"></a>00801     <span class="keywordflow">return</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a2ead2f64c81efed352e79e89f29b8fc8">LONG2FIX</a>(hash);
<a name="l00802"></a>00802 }
<a name="l00803"></a>00803 
<a name="l00804"></a>00804 <span class="comment">/*</span>
<a name="l00805"></a>00805 <span class="comment"> * call-seq:</span>
<a name="l00806"></a>00806 <span class="comment"> *   prc.to_s   -&gt; string</span>
<a name="l00807"></a>00807 <span class="comment"> *</span>
<a name="l00808"></a>00808 <span class="comment"> * Returns the unique identifier for this proc, along with</span>
<a name="l00809"></a>00809 <span class="comment"> * an indication of where the proc was defined.</span>
<a name="l00810"></a>00810 <span class="comment"> */</span>
<a name="l00811"></a>00811 
<a name="l00812"></a>00812 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l00813"></a><a class="code" href="../../d3/dda/proc_8c.html#aa821d48536c026d91cdb7fd03f6b88c2">00813</a> <a class="code" href="../../d3/dda/proc_8c.html#aa821d48536c026d91cdb7fd03f6b88c2">proc_to_s</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <span class="keyword">self</span>)
<a name="l00814"></a>00814 {
<a name="l00815"></a>00815     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str = 0;
<a name="l00816"></a>00816     <a class="code" href="../../d5/d77/structrb__proc__t.html">rb_proc_t</a> *proc;
<a name="l00817"></a>00817     <span class="keyword">const</span> <span class="keywordtype">char</span> *cname = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a9b4f42ada717bfbe7a78830639476aed">rb_obj_classname</a>(<span class="keyword">self</span>);
<a name="l00818"></a>00818     <a class="code" href="../../d6/de3/structrb__iseq__struct.html">rb_iseq_t</a> *iseq;
<a name="l00819"></a>00819     <span class="keyword">const</span> <span class="keywordtype">char</span> *is_lambda;
<a name="l00820"></a>00820 
<a name="l00821"></a>00821     <a class="code" href="../../d8/d32/vm__core_8h.html#ad9cb04a311c21bdbbd936d8f8b7237db">GetProcPtr</a>(<span class="keyword">self</span>, proc);
<a name="l00822"></a>00822     iseq = proc-&gt;<a class="code" href="../../d5/d77/structrb__proc__t.html#acf80b0e350012548c28cba1ea64a7a6e">block</a>.<a class="code" href="../../da/dc0/structrb__block__struct.html#a8e2b3b9218b4a184f198872404e81605">iseq</a>;
<a name="l00823"></a>00823     is_lambda = proc-&gt;<a class="code" href="../../d5/d77/structrb__proc__t.html#a7ec13535f2806b214e34a7db8460056b">is_lambda</a> ? <span class="stringliteral">&quot; (lambda)&quot;</span> : <span class="stringliteral">&quot;&quot;</span>;
<a name="l00824"></a>00824 
<a name="l00825"></a>00825     <span class="keywordflow">if</span> (<a class="code" href="../../d8/d32/vm__core_8h.html#a79d03ad9b9cf8b7a8ca2b849e495a74f">RUBY_VM_NORMAL_ISEQ_P</a>(iseq)) {
<a name="l00826"></a>00826         <span class="keywordtype">int</span> line_no = 0;
<a name="l00827"></a>00827 
<a name="l00828"></a>00828         <span class="keywordflow">if</span> (iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a7d6b0dd003b6703454061024b11481ad">insn_info_table</a>) {
<a name="l00829"></a>00829             line_no = <a class="code" href="../../dd/d74/iseq_8c.html#a2bf706296b2f128f187282d9594fb8ee">rb_iseq_first_lineno</a>(iseq);
<a name="l00830"></a>00830         }
<a name="l00831"></a>00831         str = <a class="code" href="../../d9/d2d/sprintf_8c.html#a05c34a91ab36c6a463c861df47808fae">rb_sprintf</a>(<span class="stringliteral">&quot;#&lt;%s:%p@%s:%d%s&gt;&quot;</span>, cname, (<span class="keywordtype">void</span> *)<span class="keyword">self</span>,
<a name="l00832"></a>00832                          <a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a06859fa5de56f2ede3cb692f1d9215e2">filename</a>),
<a name="l00833"></a>00833                          line_no, is_lambda);
<a name="l00834"></a>00834     }
<a name="l00835"></a>00835     <span class="keywordflow">else</span> {
<a name="l00836"></a>00836         str = <a class="code" href="../../d9/d2d/sprintf_8c.html#a05c34a91ab36c6a463c861df47808fae">rb_sprintf</a>(<span class="stringliteral">&quot;#&lt;%s:%p%s&gt;&quot;</span>, cname, (<span class="keywordtype">void</span> *)proc-&gt;<a class="code" href="../../d5/d77/structrb__proc__t.html#acf80b0e350012548c28cba1ea64a7a6e">block</a>.<a class="code" href="../../da/dc0/structrb__block__struct.html#a8e2b3b9218b4a184f198872404e81605">iseq</a>,
<a name="l00837"></a>00837                          is_lambda);
<a name="l00838"></a>00838     }
<a name="l00839"></a>00839 
<a name="l00840"></a>00840     <span class="keywordflow">if</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a621bc62b1fd82640c1078daf90e1c061">OBJ_TAINTED</a>(<span class="keyword">self</span>)) {
<a name="l00841"></a>00841         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#afd75ea0cb81c17e76c73e593d1d8a860">OBJ_TAINT</a>(str);
<a name="l00842"></a>00842     }
<a name="l00843"></a>00843     <span class="keywordflow">return</span> str;
<a name="l00844"></a>00844 }
<a name="l00845"></a>00845 
<a name="l00846"></a>00846 <span class="comment">/*</span>
<a name="l00847"></a>00847 <span class="comment"> *  call-seq:</span>
<a name="l00848"></a>00848 <span class="comment"> *     prc.to_proc -&gt; prc</span>
<a name="l00849"></a>00849 <span class="comment"> *</span>
<a name="l00850"></a>00850 <span class="comment"> *  Part of the protocol for converting objects to &lt;code&gt;Proc&lt;/code&gt;</span>
<a name="l00851"></a>00851 <span class="comment"> *  objects. Instances of class &lt;code&gt;Proc&lt;/code&gt; simply return</span>
<a name="l00852"></a>00852 <span class="comment"> *  themselves.</span>
<a name="l00853"></a>00853 <span class="comment"> */</span>
<a name="l00854"></a>00854 
<a name="l00855"></a>00855 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l00856"></a><a class="code" href="../../d3/dda/proc_8c.html#ae78cccc514c03fdca2da79fe525890e8">00856</a> <a class="code" href="../../d3/dda/proc_8c.html#ae78cccc514c03fdca2da79fe525890e8">proc_to_proc</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <span class="keyword">self</span>)
<a name="l00857"></a>00857 {
<a name="l00858"></a>00858     <span class="keywordflow">return</span> <span class="keyword">self</span>;
<a name="l00859"></a>00859 }
<a name="l00860"></a>00860 
<a name="l00861"></a>00861 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00862"></a><a class="code" href="../../d3/dda/proc_8c.html#ad90e96c4e67bf6d32e578a9c00bc5e3d">00862</a> <a class="code" href="../../d3/dda/proc_8c.html#ad90e96c4e67bf6d32e578a9c00bc5e3d">bm_mark</a>(<span class="keywordtype">void</span> *ptr)
<a name="l00863"></a>00863 {
<a name="l00864"></a>00864     <span class="keyword">struct </span><a class="code" href="../../d7/d6e/struct_m_e_t_h_o_d.html">METHOD</a> *data = ptr;
<a name="l00865"></a>00865     <a class="code" href="../../d8/d16/gc_8c.html#a98250264e6adf4924cf2becf80122325">rb_gc_mark</a>(data-&gt;<a class="code" href="../../d7/d6e/struct_m_e_t_h_o_d.html#aa00af10f714836e05ea2c9dd5d55f01e">rclass</a>);
<a name="l00866"></a>00866     <a class="code" href="../../d8/d16/gc_8c.html#a98250264e6adf4924cf2becf80122325">rb_gc_mark</a>(data-&gt;<a class="code" href="../../d7/d6e/struct_m_e_t_h_o_d.html#a1a31194e3ece53464051ce683ef36eb0">recv</a>);
<a name="l00867"></a>00867     <span class="keywordflow">if</span> (data-&gt;<a class="code" href="../../d7/d6e/struct_m_e_t_h_o_d.html#a5042d3b2ef85e71b1a66e49da661733a">me</a>) <a class="code" href="../../d8/d16/gc_8c.html#aac91fd74442afdfbafcdaf2c54f92240">rb_mark_method_entry</a>(data-&gt;<a class="code" href="../../d7/d6e/struct_m_e_t_h_o_d.html#a5042d3b2ef85e71b1a66e49da661733a">me</a>);
<a name="l00868"></a>00868 }
<a name="l00869"></a>00869 
<a name="l00870"></a>00870 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00871"></a><a class="code" href="../../d3/dda/proc_8c.html#a668d9e2409d10e2f8abc09fb17acc390">00871</a> <a class="code" href="../../d3/dda/proc_8c.html#a668d9e2409d10e2f8abc09fb17acc390">bm_free</a>(<span class="keywordtype">void</span> *ptr)
<a name="l00872"></a>00872 {
<a name="l00873"></a>00873     <span class="keyword">struct </span><a class="code" href="../../d7/d6e/struct_m_e_t_h_o_d.html">METHOD</a> *data = ptr;
<a name="l00874"></a>00874     <span class="keyword">struct </span><a class="code" href="../../d4/dd6/structunlinked__method__entry__list__entry.html">unlinked_method_entry_list_entry</a> *ume = data-&gt;<a class="code" href="../../d7/d6e/struct_m_e_t_h_o_d.html#a32c4c4f8d467f1d7f23ef02bbe3bce2d">ume</a>;
<a name="l00875"></a>00875     ume-&gt;<a class="code" href="../../d4/dd6/structunlinked__method__entry__list__entry.html#add9432cc138ba8162cf3db4dd6bbab71">me</a> = data-&gt;<a class="code" href="../../d7/d6e/struct_m_e_t_h_o_d.html#a5042d3b2ef85e71b1a66e49da661733a">me</a>;
<a name="l00876"></a>00876     ume-&gt;<a class="code" href="../../d4/dd6/structunlinked__method__entry__list__entry.html#a35d3ed3a6899a5781537d0cb422a54ee">next</a> = <a class="code" href="../../d8/d32/vm__core_8h.html#a6cfcd3997994924c8cd13c3b5c099ec6">GET_VM</a>()-&gt;unlinked_method_entry_list;
<a name="l00877"></a>00877     <a class="code" href="../../d8/d32/vm__core_8h.html#a6cfcd3997994924c8cd13c3b5c099ec6">GET_VM</a>()-&gt;unlinked_method_entry_list = ume;
<a name="l00878"></a>00878     <a class="code" href="../../d8/db0/defines_8h.html#a2c3897f7c46ca54a2e0dd7b24a40c7cb">xfree</a>(ptr);
<a name="l00879"></a>00879 }
<a name="l00880"></a>00880 
<a name="l00881"></a>00881 <span class="keyword">static</span> <span class="keywordtype">size_t</span>
<a name="l00882"></a><a class="code" href="../../d3/dda/proc_8c.html#ae0bc16abc13c933702cdca68c2272f09">00882</a> <a class="code" href="../../d3/dda/proc_8c.html#ae0bc16abc13c933702cdca68c2272f09">bm_memsize</a>(<span class="keyword">const</span> <span class="keywordtype">void</span> *ptr)
<a name="l00883"></a>00883 {
<a name="l00884"></a>00884     <span class="keywordflow">return</span> ptr ? <span class="keyword">sizeof</span>(<span class="keyword">struct </span><a class="code" href="../../d7/d6e/struct_m_e_t_h_o_d.html">METHOD</a>) : 0;
<a name="l00885"></a>00885 }
<a name="l00886"></a>00886 
<a name="l00887"></a><a class="code" href="../../d3/dda/proc_8c.html#a8456ae397367f452540413ae45c0a5f3">00887</a> static <a class="code" href="../../d8/d4e/strftime_8c.html#a2c212835823e3c54a8ab6d95c652660e">const</a> <a class="code" href="../../d7/de2/structrb__data__type__struct.html">rb_data_type_t</a> <a class="code" href="../../d3/dda/proc_8c.html#a8456ae397367f452540413ae45c0a5f3">method_data_type</a> = {
<a name="l00888"></a>00888     <span class="stringliteral">&quot;method&quot;</span>,
<a name="l00889"></a>00889     {
<a name="l00890"></a>00890         <a class="code" href="../../d3/dda/proc_8c.html#ad90e96c4e67bf6d32e578a9c00bc5e3d">bm_mark</a>,
<a name="l00891"></a>00891         <a class="code" href="../../d3/dda/proc_8c.html#a668d9e2409d10e2f8abc09fb17acc390">bm_free</a>,
<a name="l00892"></a>00892         <a class="code" href="../../d3/dda/proc_8c.html#ae0bc16abc13c933702cdca68c2272f09">bm_memsize</a>,
<a name="l00893"></a>00893     },
<a name="l00894"></a>00894 };
<a name="l00895"></a>00895 
<a name="l00896"></a>00896 <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l00897"></a><a class="code" href="../../d3/dda/proc_8c.html#a6a214b9a3ab784a115de1bcb5020191e">00897</a> <a class="code" href="../../db/d2e/intern_8h.html#a42d20e898f60dacf8c07fac18922a0de">rb_obj_is_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> m)
<a name="l00898"></a>00898 {
<a name="l00899"></a>00899     <span class="keywordflow">if</span> (<a class="code" href="../../db/dcc/error_8c.html#a2a5803d0e60feb0ed8f37e7a38e8df47">rb_typeddata_is_kind_of</a>(m, &amp;<a class="code" href="../../d3/dda/proc_8c.html#a8456ae397367f452540413ae45c0a5f3">method_data_type</a>)) {
<a name="l00900"></a>00900         <span class="keywordflow">return</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aacea3516b33941ce8149098e223a7466">Qtrue</a>;
<a name="l00901"></a>00901     }
<a name="l00902"></a>00902     <span class="keywordflow">else</span> {
<a name="l00903"></a>00903         <span class="keywordflow">return</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aba0717d2689eb68797421a02ab9295c6">Qfalse</a>;
<a name="l00904"></a>00904     }
<a name="l00905"></a>00905 }
<a name="l00906"></a>00906 
<a name="l00907"></a>00907 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l00908"></a><a class="code" href="../../d3/dda/proc_8c.html#abbffb4e7c85544105cb5f4aee23a945d">00908</a> <a class="code" href="../../d3/dda/proc_8c.html#abbffb4e7c85544105cb5f4aee23a945d">mnew</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> klass, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> obj, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#afa5b9137f051ac26d7ccc8824f178233">ID</a> <span class="keywordtype">id</span>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> mclass, <span class="keywordtype">int</span> scope)
<a name="l00909"></a>00909 {
<a name="l00910"></a>00910     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> method;
<a name="l00911"></a>00911     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> rclass = klass;
<a name="l00912"></a>00912     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#afa5b9137f051ac26d7ccc8824f178233">ID</a> rid = id;
<a name="l00913"></a>00913     <span class="keyword">struct </span><a class="code" href="../../d7/d6e/struct_m_e_t_h_o_d.html">METHOD</a> *data;
<a name="l00914"></a>00914     <a class="code" href="../../d7/db7/structrb__method__entry__struct.html">rb_method_entry_t</a> *<a class="code" href="../../d7/d6e/struct_m_e_t_h_o_d.html#a5042d3b2ef85e71b1a66e49da661733a">me</a>, meb;
<a name="l00915"></a>00915     <a class="code" href="../../d6/dab/structrb__method__definition__struct.html">rb_method_definition_t</a> *def = 0;
<a name="l00916"></a>00916     <a class="code" href="../../db/d0a/method_8h.html#a1e54ff32a6191e40451e1523c61ca439">rb_method_flag_t</a> flag = <a class="code" href="../../db/d0a/method_8h.html#a1e54ff32a6191e40451e1523c61ca439a67eab9ddcfb8fc376407c923b8e2346d">NOEX_UNDEF</a>;
<a name="l00917"></a>00917 
<a name="l00918"></a>00918   again:
<a name="l00919"></a>00919     me = <a class="code" href="../../db/d0a/method_8h.html#af8cbec769b20978aec8c47c2291427cf">rb_method_entry</a>(klass, <span class="keywordtype">id</span>);
<a name="l00920"></a>00920     <span class="keywordflow">if</span> (<a class="code" href="../../db/d0a/method_8h.html#aaa8e7bfb9a59a81763a11e426287f124">UNDEFINED_METHOD_ENTRY_P</a>(me)) {
<a name="l00921"></a>00921         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#afa5b9137f051ac26d7ccc8824f178233">ID</a> rmiss = <a class="code" href="../../dc/dcc/array_8c.html#a9cfa42d4b79c89d68c53be8b2150a503">rb_intern</a>(<span class="stringliteral">&quot;respond_to_missing?&quot;</span>);
<a name="l00922"></a>00922         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <a class="code" href="../../dd/dc0/date__core_8c.html#a8157485e687f56a6ae2f3ee0a8cb1580">sym</a> = <a class="code" href="../../dc/d0c/cparse_8c.html#a48bfb6519a45249fb2ec0193ea3b6e1c">ID2SYM</a>(<span class="keywordtype">id</span>);
<a name="l00923"></a>00923 
<a name="l00924"></a>00924         <span class="keywordflow">if</span> (obj != <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a2edf6990280eb2637623ccd421dee4f0">Qundef</a> &amp;&amp; !<a class="code" href="../../db/d2e/intern_8h.html#a882b0bb698bfba8a3835bfd51018edba">rb_method_basic_definition_p</a>(klass, rmiss)) {
<a name="l00925"></a>00925             <span class="keywordflow">if</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a117741045763c090b26e30a85bd0e0a6">RTEST</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a6a973fe624aa9aa9ba0cdeb6792d3187" title="Calls a method.">rb_funcall</a>(obj, rmiss, 2, sym, scope ? <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aba0717d2689eb68797421a02ab9295c6">Qfalse</a> : <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aacea3516b33941ce8149098e223a7466">Qtrue</a>))) {
<a name="l00926"></a>00926                 def = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac8df5a8a8961bd9e16be385fef28c2f2">ALLOC</a>(<a class="code" href="../../d6/dab/structrb__method__definition__struct.html">rb_method_definition_t</a>);
<a name="l00927"></a>00927                 def-&gt;<a class="code" href="../../d6/dab/structrb__method__definition__struct.html#a60ad63aa9037403df6e773853973c41b">type</a> = <a class="code" href="../../db/d0a/method_8h.html#a88a981f6cc69187ed9c2de2630a1687aa63a0d73143740232b3482d940bfe52f8">VM_METHOD_TYPE_MISSING</a>;
<a name="l00928"></a>00928                 def-&gt;<a class="code" href="../../d6/dab/structrb__method__definition__struct.html#a7fc0edb8505a61f8ae8bf2544fa7f676">original_id</a> = id;
<a name="l00929"></a>00929                 def-&gt;<a class="code" href="../../d6/dab/structrb__method__definition__struct.html#a8e0ba2187ce82efc9805217145c1bf77">alias_count</a> = 0;
<a name="l00930"></a>00930 
<a name="l00931"></a>00931                 meb.<a class="code" href="../../d7/db7/structrb__method__entry__struct.html#acd723fa7190ed8785ef776bfd3b0d1f4">flag</a> = 0;
<a name="l00932"></a>00932                 meb.<a class="code" href="../../d7/db7/structrb__method__entry__struct.html#a83823dc98ec32525da1b065abf79403b">mark</a> = 0;
<a name="l00933"></a>00933                 meb.<a class="code" href="../../d7/db7/structrb__method__entry__struct.html#a31439bd620e98940410ba59244a85eae">called_id</a> = id;
<a name="l00934"></a>00934                 meb.<a class="code" href="../../d7/db7/structrb__method__entry__struct.html#a9ce0871480ac405b00673b25234738de">klass</a> = klass;
<a name="l00935"></a>00935                 meb.<a class="code" href="../../d7/db7/structrb__method__entry__struct.html#a6c868c50e67b757c6324dfef0f3184dc">def</a> = def;
<a name="l00936"></a>00936                 me = &amp;meb;
<a name="l00937"></a>00937                 def = 0;
<a name="l00938"></a>00938 
<a name="l00939"></a>00939                 <span class="keywordflow">goto</span> gen_method;
<a name="l00940"></a>00940             }
<a name="l00941"></a>00941         }
<a name="l00942"></a>00942         <a class="code" href="../../d5/d1d/eval__error_8c.html#affaf09156cf5a6097927e28eda79d369">rb_print_undef</a>(klass, <span class="keywordtype">id</span>, 0);
<a name="l00943"></a>00943     }
<a name="l00944"></a>00944     def = me-&gt;<a class="code" href="../../d7/db7/structrb__method__entry__struct.html#a6c868c50e67b757c6324dfef0f3184dc">def</a>;
<a name="l00945"></a>00945     <span class="keywordflow">if</span> (flag == <a class="code" href="../../db/d0a/method_8h.html#a1e54ff32a6191e40451e1523c61ca439a67eab9ddcfb8fc376407c923b8e2346d">NOEX_UNDEF</a>) {
<a name="l00946"></a>00946         flag = me-&gt;<a class="code" href="../../d7/db7/structrb__method__entry__struct.html#acd723fa7190ed8785ef776bfd3b0d1f4">flag</a>;
<a name="l00947"></a>00947         <span class="keywordflow">if</span> (scope &amp;&amp; (flag &amp; <a class="code" href="../../db/d0a/method_8h.html#a1e54ff32a6191e40451e1523c61ca439a7098707ff488047cda2e2b8cb67d0bc8">NOEX_MASK</a>) != <a class="code" href="../../db/d0a/method_8h.html#a1e54ff32a6191e40451e1523c61ca439acbaffd02a49dab8af6ca3bcde9336f30">NOEX_PUBLIC</a>) {
<a name="l00948"></a>00948             <span class="keyword">const</span> <span class="keywordtype">char</span> *v = <span class="stringliteral">&quot;&quot;</span>;
<a name="l00949"></a>00949             <span class="keywordflow">switch</span> (flag &amp; NOEX_MASK) {
<a name="l00950"></a>00950                 <span class="keywordflow">case</span> <a class="code" href="../../db/d0a/method_8h.html#a1e54ff32a6191e40451e1523c61ca439a155818970b18d63d59c83d22bc61803d">NOEX_PRIVATE</a>: v = <span class="stringliteral">&quot;private&quot;</span>; <span class="keywordflow">break</span>;
<a name="l00951"></a>00951                 <span class="keywordflow">case</span> <a class="code" href="../../db/d0a/method_8h.html#a1e54ff32a6191e40451e1523c61ca439a0854498e40d4e26dd716a0ceba556439">NOEX_PROTECTED</a>: v = <span class="stringliteral">&quot;protected&quot;</span>; <span class="keywordflow">break</span>;
<a name="l00952"></a>00952             }
<a name="l00953"></a>00953             <a class="code" href="../../db/dcc/error_8c.html#a362a64d927d726ab487a66d265187cab">rb_name_error</a>(<span class="keywordtype">id</span>, <span class="stringliteral">&quot;method `%s&apos; for %s `%s&apos; is %s&quot;</span>,
<a name="l00954"></a>00954                           <a class="code" href="../../d5/d11/ripper_8c.html#a877bc58c495643fcf49dc64c44631e72">rb_id2name</a>(<span class="keywordtype">id</span>),
<a name="l00955"></a>00955                           (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a394faf7191f18552a20cb17ce14226f0">TYPE</a>(klass) == <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a6cdc7dfe8f84777325da08a96ae5f795">T_MODULE</a>) ? <span class="stringliteral">&quot;module&quot;</span> : <span class="stringliteral">&quot;class&quot;</span>,
<a name="l00956"></a>00956                           <a class="code" href="../../de/de6/ruby_2ruby_8h.html#afd98e957d0d96017f7a07dd83772fadc">rb_class2name</a>(klass),
<a name="l00957"></a>00957                           v);
<a name="l00958"></a>00958         }
<a name="l00959"></a>00959     }
<a name="l00960"></a>00960     <span class="keywordflow">if</span> (def &amp;&amp; def-&gt;<a class="code" href="../../d6/dab/structrb__method__definition__struct.html#a60ad63aa9037403df6e773853973c41b">type</a> == <a class="code" href="../../db/d0a/method_8h.html#a88a981f6cc69187ed9c2de2630a1687aaa25014eba914ecd4478a515ff4690aa1">VM_METHOD_TYPE_ZSUPER</a>) {
<a name="l00961"></a>00961         klass = <a class="code" href="../../d3/d09/ripper_8y.html#a19d17315b6b34045cdffec9912342b91">RCLASS_SUPER</a>(me-&gt;<a class="code" href="../../d7/db7/structrb__method__entry__struct.html#a9ce0871480ac405b00673b25234738de">klass</a>);
<a name="l00962"></a>00962         <span class="keywordtype">id</span> = def-&gt;<a class="code" href="../../d6/dab/structrb__method__definition__struct.html#a7fc0edb8505a61f8ae8bf2544fa7f676">original_id</a>;
<a name="l00963"></a>00963         <span class="keywordflow">goto</span> again;
<a name="l00964"></a>00964     }
<a name="l00965"></a>00965 
<a name="l00966"></a>00966     klass = me-&gt;<a class="code" href="../../d7/db7/structrb__method__entry__struct.html#a9ce0871480ac405b00673b25234738de">klass</a>;
<a name="l00967"></a>00967 
<a name="l00968"></a>00968     <span class="keywordflow">while</span> (rclass != klass &amp;&amp;
<a name="l00969"></a>00969            (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a1ae918b6cc84188a9dc6ab545f732e4d">FL_TEST</a>(rclass, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a081b5172ef37829bb3a258cd1ad393bc">FL_SINGLETON</a>) || <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a394faf7191f18552a20cb17ce14226f0">TYPE</a>(rclass) == <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a82c8c4569748b9645c958b9eaeaabb81">T_ICLASS</a>)) {
<a name="l00970"></a>00970         rclass = <a class="code" href="../../d3/d09/ripper_8y.html#a19d17315b6b34045cdffec9912342b91">RCLASS_SUPER</a>(rclass);
<a name="l00971"></a>00971     }
<a name="l00972"></a>00972 
<a name="l00973"></a>00973     <span class="keywordflow">if</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a394faf7191f18552a20cb17ce14226f0">TYPE</a>(klass) == <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a82c8c4569748b9645c958b9eaeaabb81">T_ICLASS</a>) {
<a name="l00974"></a>00974         klass = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a1d4c05021aacd8cab989ff60f95ebe2d">RBASIC</a>(klass)-&gt;klass;
<a name="l00975"></a>00975     }
<a name="l00976"></a>00976 
<a name="l00977"></a>00977   gen_method:
<a name="l00978"></a>00978     method = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#acb14aa93d3dc60a9d16570270154e6fa">TypedData_Make_Struct</a>(mclass, <span class="keyword">struct</span> <a class="code" href="../../d7/d6e/struct_m_e_t_h_o_d.html">METHOD</a>, &amp;<a class="code" href="../../d3/dda/proc_8c.html#a8456ae397367f452540413ae45c0a5f3">method_data_type</a>, data);
<a name="l00979"></a>00979 
<a name="l00980"></a>00980     data-&gt;<a class="code" href="../../d7/d6e/struct_m_e_t_h_o_d.html#a1a31194e3ece53464051ce683ef36eb0">recv</a> = obj;
<a name="l00981"></a>00981     data-&gt;<a class="code" href="../../d7/d6e/struct_m_e_t_h_o_d.html#aa00af10f714836e05ea2c9dd5d55f01e">rclass</a> = rclass;
<a name="l00982"></a>00982     data-&gt;<a class="code" href="../../d7/d6e/struct_m_e_t_h_o_d.html#a009ecbfb566836ce3a94e7038a8a9f57">id</a> = rid;
<a name="l00983"></a>00983     data-&gt;<a class="code" href="../../d7/d6e/struct_m_e_t_h_o_d.html#a5042d3b2ef85e71b1a66e49da661733a">me</a> = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac8df5a8a8961bd9e16be385fef28c2f2">ALLOC</a>(<a class="code" href="../../d7/db7/structrb__method__entry__struct.html">rb_method_entry_t</a>);
<a name="l00984"></a>00984     *data-&gt;<a class="code" href="../../d7/d6e/struct_m_e_t_h_o_d.html#a5042d3b2ef85e71b1a66e49da661733a">me</a> = *me;
<a name="l00985"></a>00985     data-&gt;<a class="code" href="../../d7/d6e/struct_m_e_t_h_o_d.html#a5042d3b2ef85e71b1a66e49da661733a">me</a>-&gt;<a class="code" href="../../d7/db7/structrb__method__entry__struct.html#a6c868c50e67b757c6324dfef0f3184dc">def</a>-&gt;<a class="code" href="../../d6/dab/structrb__method__definition__struct.html#a8e0ba2187ce82efc9805217145c1bf77">alias_count</a>++;
<a name="l00986"></a>00986     data-&gt;<a class="code" href="../../d7/d6e/struct_m_e_t_h_o_d.html#a32c4c4f8d467f1d7f23ef02bbe3bce2d">ume</a> = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac8df5a8a8961bd9e16be385fef28c2f2">ALLOC</a>(<span class="keyword">struct</span> <a class="code" href="../../d4/dd6/structunlinked__method__entry__list__entry.html">unlinked_method_entry_list_entry</a>);
<a name="l00987"></a>00987 
<a name="l00988"></a>00988     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3bf9ab455a1e0e3e8cfc6ebabd8f12df">OBJ_INFECT</a>(method, klass);
<a name="l00989"></a>00989 
<a name="l00990"></a>00990     <span class="keywordflow">return</span> method;
<a name="l00991"></a>00991 }
<a name="l00992"></a>00992 
<a name="l00993"></a>00993 
<a name="l00994"></a>00994 <span class="comment">/**********************************************************************</span>
<a name="l00995"></a>00995 <span class="comment"> *</span>
<a name="l00996"></a>00996 <span class="comment"> * Document-class : Method</span>
<a name="l00997"></a>00997 <span class="comment"> *</span>
<a name="l00998"></a>00998 <span class="comment"> *  Method objects are created by &lt;code&gt;Object#method&lt;/code&gt;, and are</span>
<a name="l00999"></a>00999 <span class="comment"> *  associated with a particular object (not just with a class). They</span>
<a name="l01000"></a>01000 <span class="comment"> *  may be used to invoke the method within the object, and as a block</span>
<a name="l01001"></a>01001 <span class="comment"> *  associated with an iterator. They may also be unbound from one</span>
<a name="l01002"></a>01002 <span class="comment"> *  object (creating an &lt;code&gt;UnboundMethod&lt;/code&gt;) and bound to</span>
<a name="l01003"></a>01003 <span class="comment"> *  another.</span>
<a name="l01004"></a>01004 <span class="comment"> *</span>
<a name="l01005"></a>01005 <span class="comment"> *     class Thing</span>
<a name="l01006"></a>01006 <span class="comment"> *       def square(n)</span>
<a name="l01007"></a>01007 <span class="comment"> *         n*n</span>
<a name="l01008"></a>01008 <span class="comment"> *       end</span>
<a name="l01009"></a>01009 <span class="comment"> *     end</span>
<a name="l01010"></a>01010 <span class="comment"> *     thing = Thing.new</span>
<a name="l01011"></a>01011 <span class="comment"> *     meth  = thing.method(:square)</span>
<a name="l01012"></a>01012 <span class="comment"> *</span>
<a name="l01013"></a>01013 <span class="comment"> *     meth.call(9)                 #=&gt; 81</span>
<a name="l01014"></a>01014 <span class="comment"> *     [ 1, 2, 3 ].collect(&amp;meth)   #=&gt; [1, 4, 9]</span>
<a name="l01015"></a>01015 <span class="comment"> *</span>
<a name="l01016"></a>01016 <span class="comment"> */</span>
<a name="l01017"></a>01017 
<a name="l01018"></a>01018 <span class="comment">/*</span>
<a name="l01019"></a>01019 <span class="comment"> * call-seq:</span>
<a name="l01020"></a>01020 <span class="comment"> *   meth == other_meth  -&gt; true or false</span>
<a name="l01021"></a>01021 <span class="comment"> *</span>
<a name="l01022"></a>01022 <span class="comment"> * Two method objects are equal if they are bound to the same</span>
<a name="l01023"></a>01023 <span class="comment"> * object and refer to the same method definition.</span>
<a name="l01024"></a>01024 <span class="comment"> */</span>
<a name="l01025"></a>01025 
<a name="l01026"></a>01026 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l01027"></a><a class="code" href="../../d3/dda/proc_8c.html#ad959c9dd97194b7e1f1e3530ce7e3995">01027</a> <a class="code" href="../../d3/dda/proc_8c.html#ad959c9dd97194b7e1f1e3530ce7e3995">method_eq</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> method, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> other)
<a name="l01028"></a>01028 {
<a name="l01029"></a>01029     <span class="keyword">struct </span><a class="code" href="../../d7/d6e/struct_m_e_t_h_o_d.html">METHOD</a> *m1, *m2;
<a name="l01030"></a>01030 
<a name="l01031"></a>01031     <span class="keywordflow">if</span> (!<a class="code" href="../../db/d2e/intern_8h.html#a42d20e898f60dacf8c07fac18922a0de">rb_obj_is_method</a>(other))
<a name="l01032"></a>01032         <span class="keywordflow">return</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aba0717d2689eb68797421a02ab9295c6">Qfalse</a>;
<a name="l01033"></a>01033     <span class="keywordflow">if</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#ad07df58de9895cbc33c10f02540d2d4d">CLASS_OF</a>(method) != <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ad07df58de9895cbc33c10f02540d2d4d">CLASS_OF</a>(other))
<a name="l01034"></a>01034         <span class="keywordflow">return</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aba0717d2689eb68797421a02ab9295c6">Qfalse</a>;
<a name="l01035"></a>01035 
<a name="l01036"></a>01036     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ad89ba7bea614853fc11183fd9c85eb5c">Check_TypedStruct</a>(method, &amp;<a class="code" href="../../d3/dda/proc_8c.html#a8456ae397367f452540413ae45c0a5f3">method_data_type</a>);
<a name="l01037"></a>01037     m1 = (<span class="keyword">struct </span><a class="code" href="../../d7/d6e/struct_m_e_t_h_o_d.html">METHOD</a> *)<a class="code" href="../../de/de6/ruby_2ruby_8h.html#abb509cfdf6560a9f795b1f6932d93691">DATA_PTR</a>(method);
<a name="l01038"></a>01038     m2 = (<span class="keyword">struct </span><a class="code" href="../../d7/d6e/struct_m_e_t_h_o_d.html">METHOD</a> *)<a class="code" href="../../de/de6/ruby_2ruby_8h.html#abb509cfdf6560a9f795b1f6932d93691">DATA_PTR</a>(other);
<a name="l01039"></a>01039 
<a name="l01040"></a>01040     <span class="keywordflow">if</span> (!<a class="code" href="../../db/d0a/method_8h.html#a0c1ae88a35467b0de5f25e21e3150117">rb_method_entry_eq</a>(m1-&gt;<a class="code" href="../../d7/d6e/struct_m_e_t_h_o_d.html#a5042d3b2ef85e71b1a66e49da661733a">me</a>, m2-&gt;<a class="code" href="../../d7/d6e/struct_m_e_t_h_o_d.html#a5042d3b2ef85e71b1a66e49da661733a">me</a>) ||
<a name="l01041"></a>01041         m1-&gt;<a class="code" href="../../d7/d6e/struct_m_e_t_h_o_d.html#aa00af10f714836e05ea2c9dd5d55f01e">rclass</a> != m2-&gt;<a class="code" href="../../d7/d6e/struct_m_e_t_h_o_d.html#aa00af10f714836e05ea2c9dd5d55f01e">rclass</a> ||
<a name="l01042"></a>01042         m1-&gt;<a class="code" href="../../d7/d6e/struct_m_e_t_h_o_d.html#a1a31194e3ece53464051ce683ef36eb0">recv</a> != m2-&gt;<a class="code" href="../../d7/d6e/struct_m_e_t_h_o_d.html#a1a31194e3ece53464051ce683ef36eb0">recv</a>) {
<a name="l01043"></a>01043         <span class="keywordflow">return</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aba0717d2689eb68797421a02ab9295c6">Qfalse</a>;
<a name="l01044"></a>01044     }
<a name="l01045"></a>01045 
<a name="l01046"></a>01046     <span class="keywordflow">return</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aacea3516b33941ce8149098e223a7466">Qtrue</a>;
<a name="l01047"></a>01047 }
<a name="l01048"></a>01048 
<a name="l01049"></a>01049 <span class="comment">/*</span>
<a name="l01050"></a>01050 <span class="comment"> * call-seq:</span>
<a name="l01051"></a>01051 <span class="comment"> *    meth.hash   -&gt; integer</span>
<a name="l01052"></a>01052 <span class="comment"> *</span>
<a name="l01053"></a>01053 <span class="comment"> * Returns a hash value corresponding to the method object.</span>
<a name="l01054"></a>01054 <span class="comment"> */</span>
<a name="l01055"></a>01055 
<a name="l01056"></a>01056 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l01057"></a><a class="code" href="../../d3/dda/proc_8c.html#a9d3c1cf10f62ae5e98f1086c0c9a5afe">01057</a> <a class="code" href="../../d3/dda/proc_8c.html#a9d3c1cf10f62ae5e98f1086c0c9a5afe">method_hash</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> method)
<a name="l01058"></a>01058 {
<a name="l01059"></a>01059     <span class="keyword">struct </span><a class="code" href="../../d7/d6e/struct_m_e_t_h_o_d.html">METHOD</a> *m;
<a name="l01060"></a>01060     <a class="code" href="../../dd/d24/st_8h.html#ac214e5cdcf0de6a2108b9643e7fc12e0">st_index_t</a> <a class="code" href="../../d3/deb/lex_8c.html#a5541f85ce416df233cce93949f0eeeca">hash</a>;
<a name="l01061"></a>01061 
<a name="l01062"></a>01062     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a8dce6624396c492cdd1af3a4c5871556">TypedData_Get_Struct</a>(method, <span class="keyword">struct</span> <a class="code" href="../../d7/d6e/struct_m_e_t_h_o_d.html">METHOD</a>, &amp;<a class="code" href="../../d3/dda/proc_8c.html#a8456ae397367f452540413ae45c0a5f3">method_data_type</a>, m);
<a name="l01063"></a>01063     hash = <a class="code" href="../../db/d2e/intern_8h.html#a574cdfa6fbf8c714858e4e7fb9c89019">rb_hash_start</a>((<a class="code" href="../../dd/d24/st_8h.html#ac214e5cdcf0de6a2108b9643e7fc12e0">st_index_t</a>)m-&gt;<a class="code" href="../../d7/d6e/struct_m_e_t_h_o_d.html#aa00af10f714836e05ea2c9dd5d55f01e">rclass</a>);
<a name="l01064"></a>01064     hash = <a class="code" href="../../db/d2e/intern_8h.html#a17289f18a17e3942ae41a002036f1308">rb_hash_uint</a>(hash, (<a class="code" href="../../dd/d24/st_8h.html#ac214e5cdcf0de6a2108b9643e7fc12e0">st_index_t</a>)m-&gt;<a class="code" href="../../d7/d6e/struct_m_e_t_h_o_d.html#a1a31194e3ece53464051ce683ef36eb0">recv</a>);
<a name="l01065"></a>01065     hash = <a class="code" href="../../db/d2e/intern_8h.html#a17289f18a17e3942ae41a002036f1308">rb_hash_uint</a>(hash, (<a class="code" href="../../dd/d24/st_8h.html#ac214e5cdcf0de6a2108b9643e7fc12e0">st_index_t</a>)m-&gt;<a class="code" href="../../d7/d6e/struct_m_e_t_h_o_d.html#a5042d3b2ef85e71b1a66e49da661733a">me</a>-&gt;<a class="code" href="../../d7/db7/structrb__method__entry__struct.html#a6c868c50e67b757c6324dfef0f3184dc">def</a>);
<a name="l01066"></a>01066     hash = <a class="code" href="../../db/d2e/intern_8h.html#a2394b60da89a848717643532411efcbd">rb_hash_end</a>(hash);
<a name="l01067"></a>01067 
<a name="l01068"></a>01068     <span class="keywordflow">return</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(hash);
<a name="l01069"></a>01069 }
<a name="l01070"></a>01070 
<a name="l01071"></a>01071 <span class="comment">/*</span>
<a name="l01072"></a>01072 <span class="comment"> *  call-seq:</span>
<a name="l01073"></a>01073 <span class="comment"> *     meth.unbind    -&gt; unbound_method</span>
<a name="l01074"></a>01074 <span class="comment"> *</span>
<a name="l01075"></a>01075 <span class="comment"> *  Dissociates &lt;i&gt;meth&lt;/i&gt; from its current receiver. The resulting</span>
<a name="l01076"></a>01076 <span class="comment"> *  &lt;code&gt;UnboundMethod&lt;/code&gt; can subsequently be bound to a new object</span>
<a name="l01077"></a>01077 <span class="comment"> *  of the same class (see &lt;code&gt;UnboundMethod&lt;/code&gt;).</span>
<a name="l01078"></a>01078 <span class="comment"> */</span>
<a name="l01079"></a>01079 
<a name="l01080"></a>01080 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l01081"></a><a class="code" href="../../d3/dda/proc_8c.html#a671d398fb66a5cf110d35ab561e88857">01081</a> <a class="code" href="../../d3/dda/proc_8c.html#a671d398fb66a5cf110d35ab561e88857">method_unbind</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> obj)
<a name="l01082"></a>01082 {
<a name="l01083"></a>01083     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> method;
<a name="l01084"></a>01084     <span class="keyword">struct </span><a class="code" href="../../d7/d6e/struct_m_e_t_h_o_d.html">METHOD</a> *orig, *data;
<a name="l01085"></a>01085 
<a name="l01086"></a>01086     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a8dce6624396c492cdd1af3a4c5871556">TypedData_Get_Struct</a>(obj, <span class="keyword">struct</span> <a class="code" href="../../d7/d6e/struct_m_e_t_h_o_d.html">METHOD</a>, &amp;<a class="code" href="../../d3/dda/proc_8c.html#a8456ae397367f452540413ae45c0a5f3">method_data_type</a>, orig);
<a name="l01087"></a>01087     method = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#acb14aa93d3dc60a9d16570270154e6fa">TypedData_Make_Struct</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a23383895e4060d0b44efa71dae926aa0">rb_cUnboundMethod</a>, <span class="keyword">struct</span> <a class="code" href="../../d7/d6e/struct_m_e_t_h_o_d.html">METHOD</a>,
<a name="l01088"></a>01088                                    &amp;<a class="code" href="../../d3/dda/proc_8c.html#a8456ae397367f452540413ae45c0a5f3">method_data_type</a>, data);
<a name="l01089"></a>01089     data-&gt;<a class="code" href="../../d7/d6e/struct_m_e_t_h_o_d.html#a1a31194e3ece53464051ce683ef36eb0">recv</a> = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a2edf6990280eb2637623ccd421dee4f0">Qundef</a>;
<a name="l01090"></a>01090     data-&gt;<a class="code" href="../../d7/d6e/struct_m_e_t_h_o_d.html#a009ecbfb566836ce3a94e7038a8a9f57">id</a> = orig-&gt;<a class="code" href="../../d7/d6e/struct_m_e_t_h_o_d.html#a009ecbfb566836ce3a94e7038a8a9f57">id</a>;
<a name="l01091"></a>01091     data-&gt;<a class="code" href="../../d7/d6e/struct_m_e_t_h_o_d.html#a5042d3b2ef85e71b1a66e49da661733a">me</a> = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac8df5a8a8961bd9e16be385fef28c2f2">ALLOC</a>(<a class="code" href="../../d7/db7/structrb__method__entry__struct.html">rb_method_entry_t</a>);
<a name="l01092"></a>01092     *data-&gt;<a class="code" href="../../d7/d6e/struct_m_e_t_h_o_d.html#a5042d3b2ef85e71b1a66e49da661733a">me</a> = *orig-&gt;<a class="code" href="../../d7/d6e/struct_m_e_t_h_o_d.html#a5042d3b2ef85e71b1a66e49da661733a">me</a>;
<a name="l01093"></a>01093     <span class="keywordflow">if</span> (orig-&gt;<a class="code" href="../../d7/d6e/struct_m_e_t_h_o_d.html#a5042d3b2ef85e71b1a66e49da661733a">me</a>-&gt;<a class="code" href="../../d7/db7/structrb__method__entry__struct.html#a6c868c50e67b757c6324dfef0f3184dc">def</a>) orig-&gt;<a class="code" href="../../d7/d6e/struct_m_e_t_h_o_d.html#a5042d3b2ef85e71b1a66e49da661733a">me</a>-&gt;<a class="code" href="../../d7/db7/structrb__method__entry__struct.html#a6c868c50e67b757c6324dfef0f3184dc">def</a>-&gt;<a class="code" href="../../d6/dab/structrb__method__definition__struct.html#a8e0ba2187ce82efc9805217145c1bf77">alias_count</a>++;
<a name="l01094"></a>01094     data-&gt;<a class="code" href="../../d7/d6e/struct_m_e_t_h_o_d.html#aa00af10f714836e05ea2c9dd5d55f01e">rclass</a> = orig-&gt;<a class="code" href="../../d7/d6e/struct_m_e_t_h_o_d.html#aa00af10f714836e05ea2c9dd5d55f01e">rclass</a>;
<a name="l01095"></a>01095     data-&gt;<a class="code" href="../../d7/d6e/struct_m_e_t_h_o_d.html#a32c4c4f8d467f1d7f23ef02bbe3bce2d">ume</a> = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac8df5a8a8961bd9e16be385fef28c2f2">ALLOC</a>(<span class="keyword">struct</span> <a class="code" href="../../d4/dd6/structunlinked__method__entry__list__entry.html">unlinked_method_entry_list_entry</a>);
<a name="l01096"></a>01096     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3bf9ab455a1e0e3e8cfc6ebabd8f12df">OBJ_INFECT</a>(method, obj);
<a name="l01097"></a>01097 
<a name="l01098"></a>01098     <span class="keywordflow">return</span> method;
<a name="l01099"></a>01099 }
<a name="l01100"></a>01100 
<a name="l01101"></a>01101 <span class="comment">/*</span>
<a name="l01102"></a>01102 <span class="comment"> *  call-seq:</span>
<a name="l01103"></a>01103 <span class="comment"> *     meth.receiver    -&gt; object</span>
<a name="l01104"></a>01104 <span class="comment"> *</span>
<a name="l01105"></a>01105 <span class="comment"> *  Returns the bound receiver of the method object.</span>
<a name="l01106"></a>01106 <span class="comment"> */</span>
<a name="l01107"></a>01107 
<a name="l01108"></a>01108 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l01109"></a><a class="code" href="../../d3/dda/proc_8c.html#ad61ccc0e52bca025cbe6af15ff741629">01109</a> <a class="code" href="../../d3/dda/proc_8c.html#ad61ccc0e52bca025cbe6af15ff741629">method_receiver</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> obj)
<a name="l01110"></a>01110 {
<a name="l01111"></a>01111     <span class="keyword">struct </span><a class="code" href="../../d7/d6e/struct_m_e_t_h_o_d.html">METHOD</a> *data;
<a name="l01112"></a>01112 
<a name="l01113"></a>01113     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a8dce6624396c492cdd1af3a4c5871556">TypedData_Get_Struct</a>(obj, <span class="keyword">struct</span> <a class="code" href="../../d7/d6e/struct_m_e_t_h_o_d.html">METHOD</a>, &amp;<a class="code" href="../../d3/dda/proc_8c.html#a8456ae397367f452540413ae45c0a5f3">method_data_type</a>, data);
<a name="l01114"></a>01114     <span class="keywordflow">return</span> data-&gt;<a class="code" href="../../d7/d6e/struct_m_e_t_h_o_d.html#a1a31194e3ece53464051ce683ef36eb0">recv</a>;
<a name="l01115"></a>01115 }
<a name="l01116"></a>01116 
<a name="l01117"></a>01117 <span class="comment">/*</span>
<a name="l01118"></a>01118 <span class="comment"> *  call-seq:</span>
<a name="l01119"></a>01119 <span class="comment"> *     meth.name    -&gt; symbol</span>
<a name="l01120"></a>01120 <span class="comment"> *</span>
<a name="l01121"></a>01121 <span class="comment"> *  Returns the name of the method.</span>
<a name="l01122"></a>01122 <span class="comment"> */</span>
<a name="l01123"></a>01123 
<a name="l01124"></a>01124 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l01125"></a><a class="code" href="../../d3/dda/proc_8c.html#abc4c96af7623d1ba9cc053d18639621e">01125</a> <a class="code" href="../../d3/dda/proc_8c.html#abc4c96af7623d1ba9cc053d18639621e">method_name</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> obj)
<a name="l01126"></a>01126 {
<a name="l01127"></a>01127     <span class="keyword">struct </span><a class="code" href="../../d7/d6e/struct_m_e_t_h_o_d.html">METHOD</a> *data;
<a name="l01128"></a>01128 
<a name="l01129"></a>01129     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a8dce6624396c492cdd1af3a4c5871556">TypedData_Get_Struct</a>(obj, <span class="keyword">struct</span> <a class="code" href="../../d7/d6e/struct_m_e_t_h_o_d.html">METHOD</a>, &amp;<a class="code" href="../../d3/dda/proc_8c.html#a8456ae397367f452540413ae45c0a5f3">method_data_type</a>, data);
<a name="l01130"></a>01130     <span class="keywordflow">return</span> <a class="code" href="../../dc/d0c/cparse_8c.html#a48bfb6519a45249fb2ec0193ea3b6e1c">ID2SYM</a>(data-&gt;<a class="code" href="../../d7/d6e/struct_m_e_t_h_o_d.html#a009ecbfb566836ce3a94e7038a8a9f57">id</a>);
<a name="l01131"></a>01131 }
<a name="l01132"></a>01132 
<a name="l01133"></a>01133 <span class="comment">/*</span>
<a name="l01134"></a>01134 <span class="comment"> *  call-seq:</span>
<a name="l01135"></a>01135 <span class="comment"> *     meth.owner    -&gt; class_or_module</span>
<a name="l01136"></a>01136 <span class="comment"> *</span>
<a name="l01137"></a>01137 <span class="comment"> *  Returns the class or module that defines the method.</span>
<a name="l01138"></a>01138 <span class="comment"> */</span>
<a name="l01139"></a>01139 
<a name="l01140"></a>01140 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l01141"></a><a class="code" href="../../d3/dda/proc_8c.html#afa673dcf9cdafabea7c3729b3fa4a541">01141</a> <a class="code" href="../../d3/dda/proc_8c.html#afa673dcf9cdafabea7c3729b3fa4a541">method_owner</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> obj)
<a name="l01142"></a>01142 {
<a name="l01143"></a>01143     <span class="keyword">struct </span><a class="code" href="../../d7/d6e/struct_m_e_t_h_o_d.html">METHOD</a> *data;
<a name="l01144"></a>01144 
<a name="l01145"></a>01145     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a8dce6624396c492cdd1af3a4c5871556">TypedData_Get_Struct</a>(obj, <span class="keyword">struct</span> <a class="code" href="../../d7/d6e/struct_m_e_t_h_o_d.html">METHOD</a>, &amp;<a class="code" href="../../d3/dda/proc_8c.html#a8456ae397367f452540413ae45c0a5f3">method_data_type</a>, data);
<a name="l01146"></a>01146     <span class="keywordflow">return</span> data-&gt;<a class="code" href="../../d7/d6e/struct_m_e_t_h_o_d.html#a5042d3b2ef85e71b1a66e49da661733a">me</a>-&gt;<a class="code" href="../../d7/db7/structrb__method__entry__struct.html#a9ce0871480ac405b00673b25234738de">klass</a>;
<a name="l01147"></a>01147 }
<a name="l01148"></a>01148 
<a name="l01149"></a>01149 <span class="comment">/*</span>
<a name="l01150"></a>01150 <span class="comment"> *  call-seq:</span>
<a name="l01151"></a>01151 <span class="comment"> *     obj.method(sym)    -&gt; method</span>
<a name="l01152"></a>01152 <span class="comment"> *</span>
<a name="l01153"></a>01153 <span class="comment"> *  Looks up the named method as a receiver in &lt;i&gt;obj&lt;/i&gt;, returning a</span>
<a name="l01154"></a>01154 <span class="comment"> *  &lt;code&gt;Method&lt;/code&gt; object (or raising &lt;code&gt;NameError&lt;/code&gt;). The</span>
<a name="l01155"></a>01155 <span class="comment"> *  &lt;code&gt;Method&lt;/code&gt; object acts as a closure in &lt;i&gt;obj&lt;/i&gt;&apos;s object</span>
<a name="l01156"></a>01156 <span class="comment"> *  instance, so instance variables and the value of &lt;code&gt;self&lt;/code&gt;</span>
<a name="l01157"></a>01157 <span class="comment"> *  remain available.</span>
<a name="l01158"></a>01158 <span class="comment"> *</span>
<a name="l01159"></a>01159 <span class="comment"> *     class Demo</span>
<a name="l01160"></a>01160 <span class="comment"> *       def initialize(n)</span>
<a name="l01161"></a>01161 <span class="comment"> *         @iv = n</span>
<a name="l01162"></a>01162 <span class="comment"> *       end</span>
<a name="l01163"></a>01163 <span class="comment"> *       def hello()</span>
<a name="l01164"></a>01164 <span class="comment"> *         &quot;Hello, @iv = #{@iv}&quot;</span>
<a name="l01165"></a>01165 <span class="comment"> *       end</span>
<a name="l01166"></a>01166 <span class="comment"> *     end</span>
<a name="l01167"></a>01167 <span class="comment"> *</span>
<a name="l01168"></a>01168 <span class="comment"> *     k = Demo.new(99)</span>
<a name="l01169"></a>01169 <span class="comment"> *     m = k.method(:hello)</span>
<a name="l01170"></a>01170 <span class="comment"> *     m.call   #=&gt; &quot;Hello, @iv = 99&quot;</span>
<a name="l01171"></a>01171 <span class="comment"> *</span>
<a name="l01172"></a>01172 <span class="comment"> *     l = Demo.new(&apos;Fred&apos;)</span>
<a name="l01173"></a>01173 <span class="comment"> *     m = l.method(&quot;hello&quot;)</span>
<a name="l01174"></a>01174 <span class="comment"> *     m.call   #=&gt; &quot;Hello, @iv = Fred&quot;</span>
<a name="l01175"></a>01175 <span class="comment"> */</span>
<a name="l01176"></a>01176 
<a name="l01177"></a>01177 <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l01178"></a><a class="code" href="../../d3/dda/proc_8c.html#ab5f1548277f9f8064666a690da28811e">01178</a> <a class="code" href="../../db/d2e/intern_8h.html#a313ca14c01fde0789cc8ec03ae3d9762">rb_obj_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> obj, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> vid)
<a name="l01179"></a>01179 {
<a name="l01180"></a>01180     <span class="keywordflow">return</span> <a class="code" href="../../d3/dda/proc_8c.html#abbffb4e7c85544105cb5f4aee23a945d">mnew</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#ad07df58de9895cbc33c10f02540d2d4d">CLASS_OF</a>(obj), obj, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#afe85fbdbbfefb46b9c12e725c9a04970">rb_to_id</a>(vid), <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ae48870c64516ad4fcc5bafe96d01e126">rb_cMethod</a>, <a class="code" href="../../d1/d5c/nkf_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>);
<a name="l01181"></a>01181 }
<a name="l01182"></a>01182 
<a name="l01183"></a>01183 <span class="comment">/*</span>
<a name="l01184"></a>01184 <span class="comment"> *  call-seq:</span>
<a name="l01185"></a>01185 <span class="comment"> *     obj.public_method(sym)    -&gt; method</span>
<a name="l01186"></a>01186 <span class="comment"> *</span>
<a name="l01187"></a>01187 <span class="comment"> *  Similar to _method_, searches public method only.</span>
<a name="l01188"></a>01188 <span class="comment"> */</span>
<a name="l01189"></a>01189 
<a name="l01190"></a>01190 <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l01191"></a><a class="code" href="../../d3/dda/proc_8c.html#aecc2ba47440cc681506a63576f552cdf">01191</a> <a class="code" href="../../d3/dda/proc_8c.html#aecc2ba47440cc681506a63576f552cdf">rb_obj_public_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> obj, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> vid)
<a name="l01192"></a>01192 {
<a name="l01193"></a>01193     <span class="keywordflow">return</span> <a class="code" href="../../d3/dda/proc_8c.html#abbffb4e7c85544105cb5f4aee23a945d">mnew</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#ad07df58de9895cbc33c10f02540d2d4d">CLASS_OF</a>(obj), obj, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#afe85fbdbbfefb46b9c12e725c9a04970">rb_to_id</a>(vid), <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ae48870c64516ad4fcc5bafe96d01e126">rb_cMethod</a>, <a class="code" href="../../d1/d5c/nkf_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l01194"></a>01194 }
<a name="l01195"></a>01195 
<a name="l01196"></a>01196 <span class="comment">/*</span>
<a name="l01197"></a>01197 <span class="comment"> *  call-seq:</span>
<a name="l01198"></a>01198 <span class="comment"> *     mod.instance_method(symbol)   -&gt; unbound_method</span>
<a name="l01199"></a>01199 <span class="comment"> *</span>
<a name="l01200"></a>01200 <span class="comment"> *  Returns an +UnboundMethod+ representing the given</span>
<a name="l01201"></a>01201 <span class="comment"> *  instance method in _mod_.</span>
<a name="l01202"></a>01202 <span class="comment"> *</span>
<a name="l01203"></a>01203 <span class="comment"> *     class Interpreter</span>
<a name="l01204"></a>01204 <span class="comment"> *       def do_a() print &quot;there, &quot;; end</span>
<a name="l01205"></a>01205 <span class="comment"> *       def do_d() print &quot;Hello &quot;;  end</span>
<a name="l01206"></a>01206 <span class="comment"> *       def do_e() print &quot;!\n&quot;;     end</span>
<a name="l01207"></a>01207 <span class="comment"> *       def do_v() print &quot;Dave&quot;;    end</span>
<a name="l01208"></a>01208 <span class="comment"> *       Dispatcher = {</span>
<a name="l01209"></a>01209 <span class="comment"> *         &quot;a&quot; =&gt; instance_method(:do_a),</span>
<a name="l01210"></a>01210 <span class="comment"> *         &quot;d&quot; =&gt; instance_method(:do_d),</span>
<a name="l01211"></a>01211 <span class="comment"> *         &quot;e&quot; =&gt; instance_method(:do_e),</span>
<a name="l01212"></a>01212 <span class="comment"> *         &quot;v&quot; =&gt; instance_method(:do_v)</span>
<a name="l01213"></a>01213 <span class="comment"> *       }</span>
<a name="l01214"></a>01214 <span class="comment"> *       def interpret(string)</span>
<a name="l01215"></a>01215 <span class="comment"> *         string.each_char {|b| Dispatcher[b].bind(self).call }</span>
<a name="l01216"></a>01216 <span class="comment"> *       end</span>
<a name="l01217"></a>01217 <span class="comment"> *     end</span>
<a name="l01218"></a>01218 <span class="comment"> *</span>
<a name="l01219"></a>01219 <span class="comment"> *     interpreter = Interpreter.new</span>
<a name="l01220"></a>01220 <span class="comment"> *     interpreter.interpret(&apos;dave&apos;)</span>
<a name="l01221"></a>01221 <span class="comment"> *</span>
<a name="l01222"></a>01222 <span class="comment"> *  &lt;em&gt;produces:&lt;/em&gt;</span>
<a name="l01223"></a>01223 <span class="comment"> *</span>
<a name="l01224"></a>01224 <span class="comment"> *     Hello there, Dave!</span>
<a name="l01225"></a>01225 <span class="comment"> */</span>
<a name="l01226"></a>01226 
<a name="l01227"></a>01227 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l01228"></a><a class="code" href="../../d3/dda/proc_8c.html#a6ee7bf619e3f7c1cb03b49d800634a70">01228</a> <a class="code" href="../../d3/dda/proc_8c.html#a6ee7bf619e3f7c1cb03b49d800634a70">rb_mod_instance_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <a class="code" href="../../d1/d6f/date__strftime_8c.html#aa84d960185b18347956518e4d00766b4">mod</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> vid)
<a name="l01229"></a>01229 {
<a name="l01230"></a>01230     <span class="keywordflow">return</span> <a class="code" href="../../d3/dda/proc_8c.html#abbffb4e7c85544105cb5f4aee23a945d">mnew</a>(mod, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a2edf6990280eb2637623ccd421dee4f0">Qundef</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#afe85fbdbbfefb46b9c12e725c9a04970">rb_to_id</a>(vid), <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a23383895e4060d0b44efa71dae926aa0">rb_cUnboundMethod</a>, <a class="code" href="../../d1/d5c/nkf_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>);
<a name="l01231"></a>01231 }
<a name="l01232"></a>01232 
<a name="l01233"></a>01233 <span class="comment">/*</span>
<a name="l01234"></a>01234 <span class="comment"> *  call-seq:</span>
<a name="l01235"></a>01235 <span class="comment"> *     mod.public_instance_method(symbol)   -&gt; unbound_method</span>
<a name="l01236"></a>01236 <span class="comment"> *</span>
<a name="l01237"></a>01237 <span class="comment"> *  Similar to _instance_method_, searches public method only.</span>
<a name="l01238"></a>01238 <span class="comment"> */</span>
<a name="l01239"></a>01239 
<a name="l01240"></a>01240 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l01241"></a><a class="code" href="../../d3/dda/proc_8c.html#aac8652823da9b40312b817f4983b3416">01241</a> <a class="code" href="../../d3/dda/proc_8c.html#aac8652823da9b40312b817f4983b3416">rb_mod_public_instance_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <a class="code" href="../../d1/d6f/date__strftime_8c.html#aa84d960185b18347956518e4d00766b4">mod</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> vid)
<a name="l01242"></a>01242 {
<a name="l01243"></a>01243     <span class="keywordflow">return</span> <a class="code" href="../../d3/dda/proc_8c.html#abbffb4e7c85544105cb5f4aee23a945d">mnew</a>(mod, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a2edf6990280eb2637623ccd421dee4f0">Qundef</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#afe85fbdbbfefb46b9c12e725c9a04970">rb_to_id</a>(vid), <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a23383895e4060d0b44efa71dae926aa0">rb_cUnboundMethod</a>, <a class="code" href="../../d1/d5c/nkf_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l01244"></a>01244 }
<a name="l01245"></a>01245 
<a name="l01246"></a>01246 <span class="comment">/*</span>
<a name="l01247"></a>01247 <span class="comment"> *  call-seq:</span>
<a name="l01248"></a>01248 <span class="comment"> *     define_method(symbol, method)     -&gt; new_method</span>
<a name="l01249"></a>01249 <span class="comment"> *     define_method(symbol) { block }   -&gt; proc</span>
<a name="l01250"></a>01250 <span class="comment"> *</span>
<a name="l01251"></a>01251 <span class="comment"> *  Defines an instance method in the receiver. The _method_</span>
<a name="l01252"></a>01252 <span class="comment"> *  parameter can be a +Proc+, a +Method+ or an +UnboundMethod+ object.</span>
<a name="l01253"></a>01253 <span class="comment"> *  If a block is specified, it is used as the method body. This block</span>
<a name="l01254"></a>01254 <span class="comment"> *  is evaluated using &lt;code&gt;instance_eval&lt;/code&gt;, a point that is</span>
<a name="l01255"></a>01255 <span class="comment"> *  tricky to demonstrate because &lt;code&gt;define_method&lt;/code&gt; is private.</span>
<a name="l01256"></a>01256 <span class="comment"> *  (This is why we resort to the +send+ hack in this example.)</span>
<a name="l01257"></a>01257 <span class="comment"> *</span>
<a name="l01258"></a>01258 <span class="comment"> *     class A</span>
<a name="l01259"></a>01259 <span class="comment"> *       def fred</span>
<a name="l01260"></a>01260 <span class="comment"> *         puts &quot;In Fred&quot;</span>
<a name="l01261"></a>01261 <span class="comment"> *       end</span>
<a name="l01262"></a>01262 <span class="comment"> *       def create_method(name, &amp;block)</span>
<a name="l01263"></a>01263 <span class="comment"> *         self.class.send(:define_method, name, &amp;block)</span>
<a name="l01264"></a>01264 <span class="comment"> *       end</span>
<a name="l01265"></a>01265 <span class="comment"> *       define_method(:wilma) { puts &quot;Charge it!&quot; }</span>
<a name="l01266"></a>01266 <span class="comment"> *     end</span>
<a name="l01267"></a>01267 <span class="comment"> *     class B &lt; A</span>
<a name="l01268"></a>01268 <span class="comment"> *       define_method(:barney, instance_method(:fred))</span>
<a name="l01269"></a>01269 <span class="comment"> *     end</span>
<a name="l01270"></a>01270 <span class="comment"> *     a = B.new</span>
<a name="l01271"></a>01271 <span class="comment"> *     a.barney</span>
<a name="l01272"></a>01272 <span class="comment"> *     a.wilma</span>
<a name="l01273"></a>01273 <span class="comment"> *     a.create_method(:betty) { p self }</span>
<a name="l01274"></a>01274 <span class="comment"> *     a.betty</span>
<a name="l01275"></a>01275 <span class="comment"> *</span>
<a name="l01276"></a>01276 <span class="comment"> *  &lt;em&gt;produces:&lt;/em&gt;</span>
<a name="l01277"></a>01277 <span class="comment"> *</span>
<a name="l01278"></a>01278 <span class="comment"> *     In Fred</span>
<a name="l01279"></a>01279 <span class="comment"> *     Charge it!</span>
<a name="l01280"></a>01280 <span class="comment"> *     #&lt;B:0x401b39e8&gt;</span>
<a name="l01281"></a>01281 <span class="comment"> */</span>
<a name="l01282"></a>01282 
<a name="l01283"></a>01283 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l01284"></a><a class="code" href="../../d3/dda/proc_8c.html#aa6a19b54751d0226272b4a7bf300c43b">01284</a> <a class="code" href="../../d3/dda/proc_8c.html#aa6a19b54751d0226272b4a7bf300c43b">rb_mod_define_method</a>(<span class="keywordtype">int</span> argc, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> *<a class="code" href="../../df/d77/ruby_8c.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <a class="code" href="../../d1/d6f/date__strftime_8c.html#aa84d960185b18347956518e4d00766b4">mod</a>)
<a name="l01285"></a>01285 {
<a name="l01286"></a>01286     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#afa5b9137f051ac26d7ccc8824f178233">ID</a> <a class="code" href="../../d6/da0/nkf-utf8_2nkf_8c.html#a64ae40793ade89d800a8c5646d2980fc">id</a>;
<a name="l01287"></a>01287     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> body;
<a name="l01288"></a>01288     <span class="keywordtype">int</span> noex = <a class="code" href="../../db/d0a/method_8h.html#a1e54ff32a6191e40451e1523c61ca439acbaffd02a49dab8af6ca3bcde9336f30">NOEX_PUBLIC</a>;
<a name="l01289"></a>01289 
<a name="l01290"></a>01290     <span class="keywordflow">if</span> (argc == 1) {
<a name="l01291"></a>01291         <span class="keywordtype">id</span> = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#afe85fbdbbfefb46b9c12e725c9a04970">rb_to_id</a>(argv[0]);
<a name="l01292"></a>01292         body = <a class="code" href="../../d3/dda/proc_8c.html#acd98b4a614a453bc439758cd68a32985">rb_block_lambda</a>();
<a name="l01293"></a>01293     }
<a name="l01294"></a>01294     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (argc == 2) {
<a name="l01295"></a>01295         <span class="keywordtype">id</span> = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#afe85fbdbbfefb46b9c12e725c9a04970">rb_to_id</a>(argv[0]);
<a name="l01296"></a>01296         body = argv[1];
<a name="l01297"></a>01297         <span class="keywordflow">if</span> (!<a class="code" href="../../db/d2e/intern_8h.html#a42d20e898f60dacf8c07fac18922a0de">rb_obj_is_method</a>(body) &amp;&amp; !<a class="code" href="../../db/d2e/intern_8h.html#a465568c66f9f2f257916e3a2f7f14aae">rb_obj_is_proc</a>(body)) {
<a name="l01298"></a>01298             <a class="code" href="../../db/dcc/error_8c.html#a0f771a2840561f1838169b3d7d4616f3">rb_raise</a>(<a class="code" href="../../db/dcc/error_8c.html#a565ed9d70f4089e1b4a36e9b3381b8c6">rb_eTypeError</a>,
<a name="l01299"></a>01299                      <span class="stringliteral">&quot;wrong argument type %s (expected Proc/Method)&quot;</span>,
<a name="l01300"></a>01300                      <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a9b4f42ada717bfbe7a78830639476aed">rb_obj_classname</a>(body));
<a name="l01301"></a>01301         }
<a name="l01302"></a>01302     }
<a name="l01303"></a>01303     <span class="keywordflow">else</span> {
<a name="l01304"></a>01304         <a class="code" href="../../db/dcc/error_8c.html#a0f771a2840561f1838169b3d7d4616f3">rb_raise</a>(<a class="code" href="../../db/dcc/error_8c.html#ab5e2a9fec766c75176fbb262bfe6a596">rb_eArgError</a>, <span class="stringliteral">&quot;wrong number of arguments (%d for 1)&quot;</span>, argc);
<a name="l01305"></a>01305     }
<a name="l01306"></a>01306 
<a name="l01307"></a>01307     <span class="keywordflow">if</span> (<a class="code" href="../../db/d2e/intern_8h.html#a42d20e898f60dacf8c07fac18922a0de">rb_obj_is_method</a>(body)) {
<a name="l01308"></a>01308         <span class="keyword">struct </span><a class="code" href="../../d7/d6e/struct_m_e_t_h_o_d.html">METHOD</a> *method = (<span class="keyword">struct </span><a class="code" href="../../d7/d6e/struct_m_e_t_h_o_d.html">METHOD</a> *)<a class="code" href="../../de/de6/ruby_2ruby_8h.html#abb509cfdf6560a9f795b1f6932d93691">DATA_PTR</a>(body);
<a name="l01309"></a>01309         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <a class="code" href="../../d7/d6e/struct_m_e_t_h_o_d.html#aa00af10f714836e05ea2c9dd5d55f01e">rclass</a> = method-&gt;<a class="code" href="../../d7/d6e/struct_m_e_t_h_o_d.html#aa00af10f714836e05ea2c9dd5d55f01e">rclass</a>;
<a name="l01310"></a>01310         <span class="keywordflow">if</span> (rclass != mod &amp;&amp; !<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a117741045763c090b26e30a85bd0e0a6">RTEST</a>(<a class="code" href="../../db/d2e/intern_8h.html#af0b73a807aed3ba16db6c716eef9a8e5">rb_class_inherited_p</a>(mod, rclass))) {
<a name="l01311"></a>01311             <span class="keywordflow">if</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a1ae918b6cc84188a9dc6ab545f732e4d">FL_TEST</a>(rclass, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a081b5172ef37829bb3a258cd1ad393bc">FL_SINGLETON</a>)) {
<a name="l01312"></a>01312                 <a class="code" href="../../db/dcc/error_8c.html#a0f771a2840561f1838169b3d7d4616f3">rb_raise</a>(<a class="code" href="../../db/dcc/error_8c.html#a565ed9d70f4089e1b4a36e9b3381b8c6">rb_eTypeError</a>,
<a name="l01313"></a>01313                          <span class="stringliteral">&quot;can&apos;t bind singleton method to a different class&quot;</span>);
<a name="l01314"></a>01314             }
<a name="l01315"></a>01315             <span class="keywordflow">else</span> {
<a name="l01316"></a>01316                 <a class="code" href="../../db/dcc/error_8c.html#a0f771a2840561f1838169b3d7d4616f3">rb_raise</a>(<a class="code" href="../../db/dcc/error_8c.html#a565ed9d70f4089e1b4a36e9b3381b8c6">rb_eTypeError</a>,
<a name="l01317"></a>01317                          <span class="stringliteral">&quot;bind argument must be a subclass of %s&quot;</span>,
<a name="l01318"></a>01318                          <a class="code" href="../../de/de6/ruby_2ruby_8h.html#afd98e957d0d96017f7a07dd83772fadc">rb_class2name</a>(rclass));
<a name="l01319"></a>01319             }
<a name="l01320"></a>01320         }
<a name="l01321"></a>01321         <a class="code" href="../../db/d0a/method_8h.html#a1b4e7cbe648b25d7ce1c4351e5fa764f">rb_method_entry_set</a>(mod, <span class="keywordtype">id</span>, method-&gt;<a class="code" href="../../d7/d6e/struct_m_e_t_h_o_d.html#a5042d3b2ef85e71b1a66e49da661733a">me</a>, noex);
<a name="l01322"></a>01322     }
<a name="l01323"></a>01323     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../db/d2e/intern_8h.html#a465568c66f9f2f257916e3a2f7f14aae">rb_obj_is_proc</a>(body)) {
<a name="l01324"></a>01324         <a class="code" href="../../d5/d77/structrb__proc__t.html">rb_proc_t</a> *proc;
<a name="l01325"></a>01325         body = <a class="code" href="../../d3/dda/proc_8c.html#ac612f38db3a5646950553e152b878bda">proc_dup</a>(body);
<a name="l01326"></a>01326         <a class="code" href="../../d8/d32/vm__core_8h.html#ad9cb04a311c21bdbbd936d8f8b7237db">GetProcPtr</a>(body, proc);
<a name="l01327"></a>01327         <span class="keywordflow">if</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#aee74f540353cd2d77d1cb37a3714bd7d">BUILTIN_TYPE</a>(proc-&gt;<a class="code" href="../../d5/d77/structrb__proc__t.html#acf80b0e350012548c28cba1ea64a7a6e">block</a>.<a class="code" href="../../da/dc0/structrb__block__struct.html#a8e2b3b9218b4a184f198872404e81605">iseq</a>) != <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a5f1cc49c4da51d5bdffa64be79ff6fb0">T_NODE</a>) {
<a name="l01328"></a>01328             proc-&gt;<a class="code" href="../../d5/d77/structrb__proc__t.html#acf80b0e350012548c28cba1ea64a7a6e">block</a>.<a class="code" href="../../da/dc0/structrb__block__struct.html#a8e2b3b9218b4a184f198872404e81605">iseq</a>-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a0f4b700a7d7866d0c5bcabf6d2a1be0b">defined_method_id</a> = id;
<a name="l01329"></a>01329             proc-&gt;<a class="code" href="../../d5/d77/structrb__proc__t.html#acf80b0e350012548c28cba1ea64a7a6e">block</a>.<a class="code" href="../../da/dc0/structrb__block__struct.html#a8e2b3b9218b4a184f198872404e81605">iseq</a>-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a8817d34a572e6fd1c75da386036f7d7d">klass</a> = mod;
<a name="l01330"></a>01330             proc-&gt;<a class="code" href="../../d5/d77/structrb__proc__t.html#a7ec13535f2806b214e34a7db8460056b">is_lambda</a> = <a class="code" href="../../d1/d5c/nkf_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l01331"></a>01331             proc-&gt;<a class="code" href="../../d5/d77/structrb__proc__t.html#ab758491302d7ae34dba60f7c39b97c95">is_from_method</a> = <a class="code" href="../../d1/d5c/nkf_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l01332"></a>01332         }
<a name="l01333"></a>01333         <a class="code" href="../../db/d0a/method_8h.html#af24b4bc2104eeb955b312d41bb492c5c">rb_add_method</a>(mod, <span class="keywordtype">id</span>, <a class="code" href="../../db/d0a/method_8h.html#a88a981f6cc69187ed9c2de2630a1687aa851a2c8d2c25891b7d1ce87759b31de0">VM_METHOD_TYPE_BMETHOD</a>, (<span class="keywordtype">void</span> *)body, noex);
<a name="l01334"></a>01334     }
<a name="l01335"></a>01335     <span class="keywordflow">else</span> {
<a name="l01336"></a>01336         <span class="comment">/* type error */</span>
<a name="l01337"></a>01337         <a class="code" href="../../db/dcc/error_8c.html#a0f771a2840561f1838169b3d7d4616f3">rb_raise</a>(<a class="code" href="../../db/dcc/error_8c.html#a565ed9d70f4089e1b4a36e9b3381b8c6">rb_eTypeError</a>, <span class="stringliteral">&quot;wrong argument type (expected Proc/Method)&quot;</span>);
<a name="l01338"></a>01338     }
<a name="l01339"></a>01339 
<a name="l01340"></a>01340     <span class="keywordflow">return</span> body;
<a name="l01341"></a>01341 }
<a name="l01342"></a>01342 
<a name="l01343"></a>01343 <span class="comment">/*</span>
<a name="l01344"></a>01344 <span class="comment"> *  call-seq:</span>
<a name="l01345"></a>01345 <span class="comment"> *     define_singleton_method(symbol, method) -&gt; new_method</span>
<a name="l01346"></a>01346 <span class="comment"> *     define_singleton_method(symbol) { block } -&gt; proc</span>
<a name="l01347"></a>01347 <span class="comment"> *</span>
<a name="l01348"></a>01348 <span class="comment"> *  Defines a singleton method in the receiver. The _method_</span>
<a name="l01349"></a>01349 <span class="comment"> *  parameter can be a +Proc+, a +Method+ or an +UnboundMethod+ object.</span>
<a name="l01350"></a>01350 <span class="comment"> *  If a block is specified, it is used as the method body.</span>
<a name="l01351"></a>01351 <span class="comment"> *</span>
<a name="l01352"></a>01352 <span class="comment"> *     class A</span>
<a name="l01353"></a>01353 <span class="comment"> *       class &lt;&lt; self</span>
<a name="l01354"></a>01354 <span class="comment"> *         def class_name</span>
<a name="l01355"></a>01355 <span class="comment"> *           to_s</span>
<a name="l01356"></a>01356 <span class="comment"> *         end</span>
<a name="l01357"></a>01357 <span class="comment"> *       end</span>
<a name="l01358"></a>01358 <span class="comment"> *     end</span>
<a name="l01359"></a>01359 <span class="comment"> *     A.define_singleton_method(:who_am_i) do</span>
<a name="l01360"></a>01360 <span class="comment"> *       &quot;I am: #{class_name}&quot;</span>
<a name="l01361"></a>01361 <span class="comment"> *     end</span>
<a name="l01362"></a>01362 <span class="comment"> *     A.who_am_i   # ==&gt; &quot;I am: A&quot;</span>
<a name="l01363"></a>01363 <span class="comment"> *</span>
<a name="l01364"></a>01364 <span class="comment"> *     guy = &quot;Bob&quot;</span>
<a name="l01365"></a>01365 <span class="comment"> *     guy.define_singleton_method(:hello) { &quot;#{self}: Hello there!&quot; }</span>
<a name="l01366"></a>01366 <span class="comment"> *     guy.hello    #=&gt;  &quot;Bob: Hello there!&quot;</span>
<a name="l01367"></a>01367 <span class="comment"> */</span>
<a name="l01368"></a>01368 
<a name="l01369"></a>01369 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l01370"></a><a class="code" href="../../d3/dda/proc_8c.html#a18c896f2a702ff9899764326287dbc44">01370</a> <a class="code" href="../../d3/dda/proc_8c.html#a18c896f2a702ff9899764326287dbc44">rb_obj_define_method</a>(<span class="keywordtype">int</span> argc, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> *<a class="code" href="../../df/d77/ruby_8c.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> obj)
<a name="l01371"></a>01371 {
<a name="l01372"></a>01372     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> klass = <a class="code" href="../../de/ddf/group__class.html#ga3778543a2798adab7bc12ed325c0b5d0" title="Returns the singleton class of obj.">rb_singleton_class</a>(obj);
<a name="l01373"></a>01373 
<a name="l01374"></a>01374     <span class="keywordflow">return</span> <a class="code" href="../../d3/dda/proc_8c.html#aa6a19b54751d0226272b4a7bf300c43b">rb_mod_define_method</a>(argc, argv, klass);
<a name="l01375"></a>01375 }
<a name="l01376"></a>01376 
<a name="l01377"></a>01377 
<a name="l01378"></a>01378 <span class="comment">/*</span>
<a name="l01379"></a>01379 <span class="comment"> * MISSING: documentation</span>
<a name="l01380"></a>01380 <span class="comment"> */</span>
<a name="l01381"></a>01381 
<a name="l01382"></a>01382 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l01383"></a><a class="code" href="../../d3/dda/proc_8c.html#a8d0e940e710da96966744bfaabd29b09">01383</a> <a class="code" href="../../d3/dda/proc_8c.html#a8d0e940e710da96966744bfaabd29b09">method_clone</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <span class="keyword">self</span>)
<a name="l01384"></a>01384 {
<a name="l01385"></a>01385     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> clone;
<a name="l01386"></a>01386     <span class="keyword">struct </span><a class="code" href="../../d7/d6e/struct_m_e_t_h_o_d.html">METHOD</a> *orig, *data;
<a name="l01387"></a>01387 
<a name="l01388"></a>01388     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a8dce6624396c492cdd1af3a4c5871556">TypedData_Get_Struct</a>(<span class="keyword">self</span>, <span class="keyword">struct</span> <a class="code" href="../../d7/d6e/struct_m_e_t_h_o_d.html">METHOD</a>, &amp;<a class="code" href="../../d3/dda/proc_8c.html#a8456ae397367f452540413ae45c0a5f3">method_data_type</a>, orig);
<a name="l01389"></a>01389     clone = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#acb14aa93d3dc60a9d16570270154e6fa">TypedData_Make_Struct</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#ad07df58de9895cbc33c10f02540d2d4d">CLASS_OF</a>(<span class="keyword">self</span>), <span class="keyword">struct</span> <a class="code" href="../../d7/d6e/struct_m_e_t_h_o_d.html">METHOD</a>, &amp;<a class="code" href="../../d3/dda/proc_8c.html#a8456ae397367f452540413ae45c0a5f3">method_data_type</a>, data);
<a name="l01390"></a>01390     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a463c7ae434592ae6bd98e4e216382a10">CLONESETUP</a>(clone, <span class="keyword">self</span>);
<a name="l01391"></a>01391     *data = *orig;
<a name="l01392"></a>01392     data-&gt;<a class="code" href="../../d7/d6e/struct_m_e_t_h_o_d.html#a5042d3b2ef85e71b1a66e49da661733a">me</a> = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac8df5a8a8961bd9e16be385fef28c2f2">ALLOC</a>(<a class="code" href="../../d7/db7/structrb__method__entry__struct.html">rb_method_entry_t</a>);
<a name="l01393"></a>01393     *data-&gt;<a class="code" href="../../d7/d6e/struct_m_e_t_h_o_d.html#a5042d3b2ef85e71b1a66e49da661733a">me</a> = *orig-&gt;<a class="code" href="../../d7/d6e/struct_m_e_t_h_o_d.html#a5042d3b2ef85e71b1a66e49da661733a">me</a>;
<a name="l01394"></a>01394     <span class="keywordflow">if</span> (data-&gt;<a class="code" href="../../d7/d6e/struct_m_e_t_h_o_d.html#a5042d3b2ef85e71b1a66e49da661733a">me</a>-&gt;<a class="code" href="../../d7/db7/structrb__method__entry__struct.html#a6c868c50e67b757c6324dfef0f3184dc">def</a>) data-&gt;<a class="code" href="../../d7/d6e/struct_m_e_t_h_o_d.html#a5042d3b2ef85e71b1a66e49da661733a">me</a>-&gt;<a class="code" href="../../d7/db7/structrb__method__entry__struct.html#a6c868c50e67b757c6324dfef0f3184dc">def</a>-&gt;<a class="code" href="../../d6/dab/structrb__method__definition__struct.html#a8e0ba2187ce82efc9805217145c1bf77">alias_count</a>++;
<a name="l01395"></a>01395     data-&gt;<a class="code" href="../../d7/d6e/struct_m_e_t_h_o_d.html#a32c4c4f8d467f1d7f23ef02bbe3bce2d">ume</a> = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac8df5a8a8961bd9e16be385fef28c2f2">ALLOC</a>(<span class="keyword">struct</span> <a class="code" href="../../d4/dd6/structunlinked__method__entry__list__entry.html">unlinked_method_entry_list_entry</a>);
<a name="l01396"></a>01396 
<a name="l01397"></a>01397     <span class="keywordflow">return</span> clone;
<a name="l01398"></a>01398 }
<a name="l01399"></a>01399 
<a name="l01400"></a>01400 <span class="comment">/*</span>
<a name="l01401"></a>01401 <span class="comment"> *  call-seq:</span>
<a name="l01402"></a>01402 <span class="comment"> *     meth.call(args, ...)    -&gt; obj</span>
<a name="l01403"></a>01403 <span class="comment"> *     meth[args, ...]         -&gt; obj</span>
<a name="l01404"></a>01404 <span class="comment"> *</span>
<a name="l01405"></a>01405 <span class="comment"> *  Invokes the &lt;i&gt;meth&lt;/i&gt; with the specified arguments, returning the</span>
<a name="l01406"></a>01406 <span class="comment"> *  method&apos;s return value.</span>
<a name="l01407"></a>01407 <span class="comment"> *</span>
<a name="l01408"></a>01408 <span class="comment"> *     m = 12.method(&quot;+&quot;)</span>
<a name="l01409"></a>01409 <span class="comment"> *     m.call(3)    #=&gt; 15</span>
<a name="l01410"></a>01410 <span class="comment"> *     m.call(20)   #=&gt; 32</span>
<a name="l01411"></a>01411 <span class="comment"> */</span>
<a name="l01412"></a>01412 
<a name="l01413"></a>01413 <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l01414"></a><a class="code" href="../../d3/dda/proc_8c.html#a6b2ab131472d353578c082df95722dc0">01414</a> <a class="code" href="../../db/d2e/intern_8h.html#a0c43557c40369d54f475f26fb34678fb">rb_method_call</a>(<span class="keywordtype">int</span> argc, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> *<a class="code" href="../../df/d77/ruby_8c.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> method)
<a name="l01415"></a>01415 {
<a name="l01416"></a>01416     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <a class="code" href="../../d8/d90/nkf_8c.html#a5ea5ac7abf5cce39283e422add1067d5">result</a> = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a320970f989dc8294c8203154e3db40c1">Qnil</a>;        <span class="comment">/* OK */</span>
<a name="l01417"></a>01417     <span class="keyword">struct </span><a class="code" href="../../d7/d6e/struct_m_e_t_h_o_d.html">METHOD</a> *data;
<a name="l01418"></a>01418     <span class="keywordtype">int</span> <a class="code" href="../../d5/d1d/gb18030_8c.html#adc6e5733fc3c22f0a7b2914188c49c90">state</a>;
<a name="l01419"></a>01419     <span class="keyword">volatile</span> <span class="keywordtype">int</span> safe = -1;
<a name="l01420"></a>01420 
<a name="l01421"></a>01421     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a8dce6624396c492cdd1af3a4c5871556">TypedData_Get_Struct</a>(method, <span class="keyword">struct</span> <a class="code" href="../../d7/d6e/struct_m_e_t_h_o_d.html">METHOD</a>, &amp;<a class="code" href="../../d3/dda/proc_8c.html#a8456ae397367f452540413ae45c0a5f3">method_data_type</a>, data);
<a name="l01422"></a>01422     <span class="keywordflow">if</span> (data-&gt;<a class="code" href="../../d7/d6e/struct_m_e_t_h_o_d.html#a1a31194e3ece53464051ce683ef36eb0">recv</a> == <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a2edf6990280eb2637623ccd421dee4f0">Qundef</a>) {
<a name="l01423"></a>01423         <a class="code" href="../../db/dcc/error_8c.html#a0f771a2840561f1838169b3d7d4616f3">rb_raise</a>(<a class="code" href="../../db/dcc/error_8c.html#a565ed9d70f4089e1b4a36e9b3381b8c6">rb_eTypeError</a>, <span class="stringliteral">&quot;can&apos;t call unbound method; bind first&quot;</span>);
<a name="l01424"></a>01424     }
<a name="l01425"></a>01425     <a class="code" href="../../dd/dd0/eval__intern_8h.html#ac0e28e3418925cd969f30157281642bf">PUSH_TAG</a>();
<a name="l01426"></a>01426     <span class="keywordflow">if</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a621bc62b1fd82640c1078daf90e1c061">OBJ_TAINTED</a>(method)) {
<a name="l01427"></a>01427         safe = <a class="code" href="../../d5/d9d/tcltklib_8c.html#a6f520624fabb8332dc98fd223491bf8d">rb_safe_level</a>();
<a name="l01428"></a>01428         <span class="keywordflow">if</span> (<a class="code" href="../../d5/d9d/tcltklib_8c.html#a6f520624fabb8332dc98fd223491bf8d">rb_safe_level</a>() &lt; 4) {
<a name="l01429"></a>01429             <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a2dc3c261c5388aa84c552741c90f243f">rb_set_safe_level_force</a>(4);
<a name="l01430"></a>01430         }
<a name="l01431"></a>01431     }
<a name="l01432"></a>01432     <span class="keywordflow">if</span> ((state = <a class="code" href="../../dd/dd0/eval__intern_8h.html#a3441e3967c633da99c3dcd025494053e">EXEC_TAG</a>()) == 0) {
<a name="l01433"></a>01433         <a class="code" href="../../d2/d66/structrb__thread__struct.html">rb_thread_t</a> *th = <a class="code" href="../../d8/d32/vm__core_8h.html#a8deb84ec6023e3229db88ac2c9da6138">GET_THREAD</a>();
<a name="l01434"></a>01434 
<a name="l01435"></a>01435         <a class="code" href="../../dd/dd0/eval__intern_8h.html#acbef3bd279007c591271b22acfd61fb1">PASS_PASSED_BLOCK_TH</a>(th);
<a name="l01436"></a>01436         result = <a class="code" href="../../d8/d32/vm__core_8h.html#a4522a567e9c2cd8808ba0252cc4dc66d">rb_vm_call</a>(th, data-&gt;<a class="code" href="../../d7/d6e/struct_m_e_t_h_o_d.html#a1a31194e3ece53464051ce683ef36eb0">recv</a>, data-&gt;<a class="code" href="../../d7/d6e/struct_m_e_t_h_o_d.html#a009ecbfb566836ce3a94e7038a8a9f57">id</a>,  argc, argv, data-&gt;<a class="code" href="../../d7/d6e/struct_m_e_t_h_o_d.html#a5042d3b2ef85e71b1a66e49da661733a">me</a>);
<a name="l01437"></a>01437     }
<a name="l01438"></a>01438     <a class="code" href="../../dd/dd0/eval__intern_8h.html#accfba89bbfaf289dc5fff2d2f235f2f1">POP_TAG</a>();
<a name="l01439"></a>01439     <span class="keywordflow">if</span> (safe &gt;= 0)
<a name="l01440"></a>01440         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a2dc3c261c5388aa84c552741c90f243f">rb_set_safe_level_force</a>(safe);
<a name="l01441"></a>01441     <span class="keywordflow">if</span> (state)
<a name="l01442"></a>01442         <a class="code" href="../../dd/dd0/eval__intern_8h.html#a24884166ae699029ade34fd36bedd688">JUMP_TAG</a>(state);
<a name="l01443"></a>01443     <span class="keywordflow">return</span> result;
<a name="l01444"></a>01444 }
<a name="l01445"></a>01445 
<a name="l01446"></a>01446 <span class="comment">/**********************************************************************</span>
<a name="l01447"></a>01447 <span class="comment"> *</span>
<a name="l01448"></a>01448 <span class="comment"> * Document-class: UnboundMethod</span>
<a name="l01449"></a>01449 <span class="comment"> *</span>
<a name="l01450"></a>01450 <span class="comment"> *  Ruby supports two forms of objectified methods. Class</span>
<a name="l01451"></a>01451 <span class="comment"> *  &lt;code&gt;Method&lt;/code&gt; is used to represent methods that are associated</span>
<a name="l01452"></a>01452 <span class="comment"> *  with a particular object: these method objects are bound to that</span>
<a name="l01453"></a>01453 <span class="comment"> *  object. Bound method objects for an object can be created using</span>
<a name="l01454"></a>01454 <span class="comment"> *  &lt;code&gt;Object#method&lt;/code&gt;.</span>
<a name="l01455"></a>01455 <span class="comment"> *</span>
<a name="l01456"></a>01456 <span class="comment"> *  Ruby also supports unbound methods; methods objects that are not</span>
<a name="l01457"></a>01457 <span class="comment"> *  associated with a particular object. These can be created either by</span>
<a name="l01458"></a>01458 <span class="comment"> *  calling &lt;code&gt;Module#instance_method&lt;/code&gt; or by calling</span>
<a name="l01459"></a>01459 <span class="comment"> *  &lt;code&gt;unbind&lt;/code&gt; on a bound method object. The result of both of</span>
<a name="l01460"></a>01460 <span class="comment"> *  these is an &lt;code&gt;UnboundMethod&lt;/code&gt; object.</span>
<a name="l01461"></a>01461 <span class="comment"> *</span>
<a name="l01462"></a>01462 <span class="comment"> *  Unbound methods can only be called after they are bound to an</span>
<a name="l01463"></a>01463 <span class="comment"> *  object. That object must be be a kind_of? the method&apos;s original</span>
<a name="l01464"></a>01464 <span class="comment"> *  class.</span>
<a name="l01465"></a>01465 <span class="comment"> *</span>
<a name="l01466"></a>01466 <span class="comment"> *     class Square</span>
<a name="l01467"></a>01467 <span class="comment"> *       def area</span>
<a name="l01468"></a>01468 <span class="comment"> *         @side * @side</span>
<a name="l01469"></a>01469 <span class="comment"> *       end</span>
<a name="l01470"></a>01470 <span class="comment"> *       def initialize(side)</span>
<a name="l01471"></a>01471 <span class="comment"> *         @side = side</span>
<a name="l01472"></a>01472 <span class="comment"> *       end</span>
<a name="l01473"></a>01473 <span class="comment"> *     end</span>
<a name="l01474"></a>01474 <span class="comment"> *</span>
<a name="l01475"></a>01475 <span class="comment"> *     area_un = Square.instance_method(:area)</span>
<a name="l01476"></a>01476 <span class="comment"> *</span>
<a name="l01477"></a>01477 <span class="comment"> *     s = Square.new(12)</span>
<a name="l01478"></a>01478 <span class="comment"> *     area = area_un.bind(s)</span>
<a name="l01479"></a>01479 <span class="comment"> *     area.call   #=&gt; 144</span>
<a name="l01480"></a>01480 <span class="comment"> *</span>
<a name="l01481"></a>01481 <span class="comment"> *  Unbound methods are a reference to the method at the time it was</span>
<a name="l01482"></a>01482 <span class="comment"> *  objectified: subsequent changes to the underlying class will not</span>
<a name="l01483"></a>01483 <span class="comment"> *  affect the unbound method.</span>
<a name="l01484"></a>01484 <span class="comment"> *</span>
<a name="l01485"></a>01485 <span class="comment"> *     class Test</span>
<a name="l01486"></a>01486 <span class="comment"> *       def test</span>
<a name="l01487"></a>01487 <span class="comment"> *         :original</span>
<a name="l01488"></a>01488 <span class="comment"> *       end</span>
<a name="l01489"></a>01489 <span class="comment"> *     end</span>
<a name="l01490"></a>01490 <span class="comment"> *     um = Test.instance_method(:test)</span>
<a name="l01491"></a>01491 <span class="comment"> *     class Test</span>
<a name="l01492"></a>01492 <span class="comment"> *       def test</span>
<a name="l01493"></a>01493 <span class="comment"> *         :modified</span>
<a name="l01494"></a>01494 <span class="comment"> *       end</span>
<a name="l01495"></a>01495 <span class="comment"> *     end</span>
<a name="l01496"></a>01496 <span class="comment"> *     t = Test.new</span>
<a name="l01497"></a>01497 <span class="comment"> *     t.test            #=&gt; :modified</span>
<a name="l01498"></a>01498 <span class="comment"> *     um.bind(t).call   #=&gt; :original</span>
<a name="l01499"></a>01499 <span class="comment"> *</span>
<a name="l01500"></a>01500 <span class="comment"> */</span>
<a name="l01501"></a>01501 
<a name="l01502"></a>01502 <span class="comment">/*</span>
<a name="l01503"></a>01503 <span class="comment"> *  call-seq:</span>
<a name="l01504"></a>01504 <span class="comment"> *     umeth.bind(obj) -&gt; method</span>
<a name="l01505"></a>01505 <span class="comment"> *</span>
<a name="l01506"></a>01506 <span class="comment"> *  Bind &lt;i&gt;umeth&lt;/i&gt; to &lt;i&gt;obj&lt;/i&gt;. If &lt;code&gt;Klass&lt;/code&gt; was the class</span>
<a name="l01507"></a>01507 <span class="comment"> *  from which &lt;i&gt;umeth&lt;/i&gt; was obtained,</span>
<a name="l01508"></a>01508 <span class="comment"> *  &lt;code&gt;obj.kind_of?(Klass)&lt;/code&gt; must be true.</span>
<a name="l01509"></a>01509 <span class="comment"> *</span>
<a name="l01510"></a>01510 <span class="comment"> *     class A</span>
<a name="l01511"></a>01511 <span class="comment"> *       def test</span>
<a name="l01512"></a>01512 <span class="comment"> *         puts &quot;In test, class = #{self.class}&quot;</span>
<a name="l01513"></a>01513 <span class="comment"> *       end</span>
<a name="l01514"></a>01514 <span class="comment"> *     end</span>
<a name="l01515"></a>01515 <span class="comment"> *     class B &lt; A</span>
<a name="l01516"></a>01516 <span class="comment"> *     end</span>
<a name="l01517"></a>01517 <span class="comment"> *     class C &lt; B</span>
<a name="l01518"></a>01518 <span class="comment"> *     end</span>
<a name="l01519"></a>01519 <span class="comment"> *</span>
<a name="l01520"></a>01520 <span class="comment"> *</span>
<a name="l01521"></a>01521 <span class="comment"> *     um = B.instance_method(:test)</span>
<a name="l01522"></a>01522 <span class="comment"> *     bm = um.bind(C.new)</span>
<a name="l01523"></a>01523 <span class="comment"> *     bm.call</span>
<a name="l01524"></a>01524 <span class="comment"> *     bm = um.bind(B.new)</span>
<a name="l01525"></a>01525 <span class="comment"> *     bm.call</span>
<a name="l01526"></a>01526 <span class="comment"> *     bm = um.bind(A.new)</span>
<a name="l01527"></a>01527 <span class="comment"> *     bm.call</span>
<a name="l01528"></a>01528 <span class="comment"> *</span>
<a name="l01529"></a>01529 <span class="comment"> *  &lt;em&gt;produces:&lt;/em&gt;</span>
<a name="l01530"></a>01530 <span class="comment"> *</span>
<a name="l01531"></a>01531 <span class="comment"> *     In test, class = C</span>
<a name="l01532"></a>01532 <span class="comment"> *     In test, class = B</span>
<a name="l01533"></a>01533 <span class="comment"> *     prog.rb:16:in `bind&apos;: bind argument must be an instance of B (TypeError)</span>
<a name="l01534"></a>01534 <span class="comment"> *      from prog.rb:16</span>
<a name="l01535"></a>01535 <span class="comment"> */</span>
<a name="l01536"></a>01536 
<a name="l01537"></a>01537 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l01538"></a><a class="code" href="../../d3/dda/proc_8c.html#aa11ac7837645a53ac91bf1ee5a0739fa">01538</a> <a class="code" href="../../d3/dda/proc_8c.html#aa11ac7837645a53ac91bf1ee5a0739fa">umethod_bind</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> method, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <a class="code" href="../../d7/d6e/struct_m_e_t_h_o_d.html#a1a31194e3ece53464051ce683ef36eb0">recv</a>)
<a name="l01539"></a>01539 {
<a name="l01540"></a>01540     <span class="keyword">struct </span><a class="code" href="../../d7/d6e/struct_m_e_t_h_o_d.html">METHOD</a> *data, *bound;
<a name="l01541"></a>01541 
<a name="l01542"></a>01542     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a8dce6624396c492cdd1af3a4c5871556">TypedData_Get_Struct</a>(method, <span class="keyword">struct</span> <a class="code" href="../../d7/d6e/struct_m_e_t_h_o_d.html">METHOD</a>, &amp;<a class="code" href="../../d3/dda/proc_8c.html#a8456ae397367f452540413ae45c0a5f3">method_data_type</a>, data);
<a name="l01543"></a>01543 
<a name="l01544"></a>01544     <span class="keywordflow">if</span> (data-&gt;<a class="code" href="../../d7/d6e/struct_m_e_t_h_o_d.html#aa00af10f714836e05ea2c9dd5d55f01e">rclass</a> != <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ad07df58de9895cbc33c10f02540d2d4d">CLASS_OF</a>(recv) &amp;&amp; !<a class="code" href="../../db/d2e/intern_8h.html#a6e65fc310dd65ebd60d68ada991da6f6">rb_obj_is_kind_of</a>(recv, data-&gt;<a class="code" href="../../d7/d6e/struct_m_e_t_h_o_d.html#aa00af10f714836e05ea2c9dd5d55f01e">rclass</a>)) {
<a name="l01545"></a>01545         <span class="keywordflow">if</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a1ae918b6cc84188a9dc6ab545f732e4d">FL_TEST</a>(data-&gt;<a class="code" href="../../d7/d6e/struct_m_e_t_h_o_d.html#aa00af10f714836e05ea2c9dd5d55f01e">rclass</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a081b5172ef37829bb3a258cd1ad393bc">FL_SINGLETON</a>)) {
<a name="l01546"></a>01546             <a class="code" href="../../db/dcc/error_8c.html#a0f771a2840561f1838169b3d7d4616f3">rb_raise</a>(<a class="code" href="../../db/dcc/error_8c.html#a565ed9d70f4089e1b4a36e9b3381b8c6">rb_eTypeError</a>,
<a name="l01547"></a>01547                      <span class="stringliteral">&quot;singleton method called for a different object&quot;</span>);
<a name="l01548"></a>01548         }
<a name="l01549"></a>01549         <span class="keywordflow">else</span> {
<a name="l01550"></a>01550             <a class="code" href="../../db/dcc/error_8c.html#a0f771a2840561f1838169b3d7d4616f3">rb_raise</a>(<a class="code" href="../../db/dcc/error_8c.html#a565ed9d70f4089e1b4a36e9b3381b8c6">rb_eTypeError</a>, <span class="stringliteral">&quot;bind argument must be an instance of %s&quot;</span>,
<a name="l01551"></a>01551                      <a class="code" href="../../de/de6/ruby_2ruby_8h.html#afd98e957d0d96017f7a07dd83772fadc">rb_class2name</a>(data-&gt;<a class="code" href="../../d7/d6e/struct_m_e_t_h_o_d.html#aa00af10f714836e05ea2c9dd5d55f01e">rclass</a>));
<a name="l01552"></a>01552         }
<a name="l01553"></a>01553     }
<a name="l01554"></a>01554 
<a name="l01555"></a>01555     method = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#acb14aa93d3dc60a9d16570270154e6fa">TypedData_Make_Struct</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#ae48870c64516ad4fcc5bafe96d01e126">rb_cMethod</a>, <span class="keyword">struct</span> <a class="code" href="../../d7/d6e/struct_m_e_t_h_o_d.html">METHOD</a>, &amp;<a class="code" href="../../d3/dda/proc_8c.html#a8456ae397367f452540413ae45c0a5f3">method_data_type</a>, bound);
<a name="l01556"></a>01556     *bound = *data;
<a name="l01557"></a>01557     bound-&gt;<a class="code" href="../../d7/d6e/struct_m_e_t_h_o_d.html#a5042d3b2ef85e71b1a66e49da661733a">me</a> = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac8df5a8a8961bd9e16be385fef28c2f2">ALLOC</a>(<a class="code" href="../../d7/db7/structrb__method__entry__struct.html">rb_method_entry_t</a>);
<a name="l01558"></a>01558     *bound-&gt;<a class="code" href="../../d7/d6e/struct_m_e_t_h_o_d.html#a5042d3b2ef85e71b1a66e49da661733a">me</a> = *data-&gt;<a class="code" href="../../d7/d6e/struct_m_e_t_h_o_d.html#a5042d3b2ef85e71b1a66e49da661733a">me</a>;
<a name="l01559"></a>01559     <span class="keywordflow">if</span> (bound-&gt;<a class="code" href="../../d7/d6e/struct_m_e_t_h_o_d.html#a5042d3b2ef85e71b1a66e49da661733a">me</a>-&gt;<a class="code" href="../../d7/db7/structrb__method__entry__struct.html#a6c868c50e67b757c6324dfef0f3184dc">def</a>) bound-&gt;<a class="code" href="../../d7/d6e/struct_m_e_t_h_o_d.html#a5042d3b2ef85e71b1a66e49da661733a">me</a>-&gt;<a class="code" href="../../d7/db7/structrb__method__entry__struct.html#a6c868c50e67b757c6324dfef0f3184dc">def</a>-&gt;<a class="code" href="../../d6/dab/structrb__method__definition__struct.html#a8e0ba2187ce82efc9805217145c1bf77">alias_count</a>++;
<a name="l01560"></a>01560     bound-&gt;<a class="code" href="../../d7/d6e/struct_m_e_t_h_o_d.html#a1a31194e3ece53464051ce683ef36eb0">recv</a> = recv;
<a name="l01561"></a>01561     bound-&gt;<a class="code" href="../../d7/d6e/struct_m_e_t_h_o_d.html#aa00af10f714836e05ea2c9dd5d55f01e">rclass</a> = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ad07df58de9895cbc33c10f02540d2d4d">CLASS_OF</a>(recv);
<a name="l01562"></a>01562     data-&gt;<a class="code" href="../../d7/d6e/struct_m_e_t_h_o_d.html#a32c4c4f8d467f1d7f23ef02bbe3bce2d">ume</a> = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac8df5a8a8961bd9e16be385fef28c2f2">ALLOC</a>(<span class="keyword">struct</span> <a class="code" href="../../d4/dd6/structunlinked__method__entry__list__entry.html">unlinked_method_entry_list_entry</a>);
<a name="l01563"></a>01563 
<a name="l01564"></a>01564     <span class="keywordflow">return</span> method;
<a name="l01565"></a>01565 }
<a name="l01566"></a>01566 
<a name="l01567"></a>01567 <span class="keywordtype">int</span>
<a name="l01568"></a><a class="code" href="../../d3/dda/proc_8c.html#a1aebafc093da93cbb5651bd92189bbd2">01568</a> <a class="code" href="../../db/d0a/method_8h.html#a1aebafc093da93cbb5651bd92189bbd2">rb_method_entry_arity</a>(<span class="keyword">const</span> <a class="code" href="../../d7/db7/structrb__method__entry__struct.html">rb_method_entry_t</a> *<a class="code" href="../../d7/d6e/struct_m_e_t_h_o_d.html#a5042d3b2ef85e71b1a66e49da661733a">me</a>)
<a name="l01569"></a>01569 {
<a name="l01570"></a>01570     <span class="keyword">const</span> <a class="code" href="../../d6/dab/structrb__method__definition__struct.html">rb_method_definition_t</a> *def = me-&gt;<a class="code" href="../../d7/db7/structrb__method__entry__struct.html#a6c868c50e67b757c6324dfef0f3184dc">def</a>;
<a name="l01571"></a>01571     <span class="keywordflow">if</span> (!def) <span class="keywordflow">return</span> 0;
<a name="l01572"></a>01572     <span class="keywordflow">switch</span> (def-&gt;<a class="code" href="../../d6/dab/structrb__method__definition__struct.html#a60ad63aa9037403df6e773853973c41b">type</a>) {
<a name="l01573"></a>01573       <span class="keywordflow">case</span> <a class="code" href="../../db/d0a/method_8h.html#a88a981f6cc69187ed9c2de2630a1687aa1691810af54507b018d2639b60e8057d">VM_METHOD_TYPE_CFUNC</a>:
<a name="l01574"></a>01574         <span class="keywordflow">if</span> (def-&gt;<a class="code" href="../../d6/dab/structrb__method__definition__struct.html#a83806aa27bac8990f4f9ce83377c76e7">body</a>.<a class="code" href="../../d6/dab/structrb__method__definition__struct.html#abd329358f778cc61d4983a63b33c587e">cfunc</a>.<a class="code" href="../../d1/d2e/structrb__method__cfunc__struct.html#a1f7a9ee0ee4ac74e422517923d65c6ed">argc</a> &lt; 0)
<a name="l01575"></a>01575             <span class="keywordflow">return</span> -1;
<a name="l01576"></a>01576         <span class="keywordflow">return</span> <a class="code" href="../../d3/dda/proc_8c.html#a4200f9fe2afc8140313fbc922d98d258">check_argc</a>(def-&gt;<a class="code" href="../../d6/dab/structrb__method__definition__struct.html#a83806aa27bac8990f4f9ce83377c76e7">body</a>.<a class="code" href="../../d6/dab/structrb__method__definition__struct.html#abd329358f778cc61d4983a63b33c587e">cfunc</a>.<a class="code" href="../../d1/d2e/structrb__method__cfunc__struct.html#a1f7a9ee0ee4ac74e422517923d65c6ed">argc</a>);
<a name="l01577"></a>01577       <span class="keywordflow">case</span> <a class="code" href="../../db/d0a/method_8h.html#a88a981f6cc69187ed9c2de2630a1687aaa25014eba914ecd4478a515ff4690aa1">VM_METHOD_TYPE_ZSUPER</a>:
<a name="l01578"></a>01578         <span class="keywordflow">return</span> -1;
<a name="l01579"></a>01579       <span class="keywordflow">case</span> <a class="code" href="../../db/d0a/method_8h.html#a88a981f6cc69187ed9c2de2630a1687aa0afa124f1dfc47ee89ab883b2591573b">VM_METHOD_TYPE_ATTRSET</a>:
<a name="l01580"></a>01580         <span class="keywordflow">return</span> 1;
<a name="l01581"></a>01581       <span class="keywordflow">case</span> <a class="code" href="../../db/d0a/method_8h.html#a88a981f6cc69187ed9c2de2630a1687aa876dfcf064e4f083567badb52e606e0e">VM_METHOD_TYPE_IVAR</a>:
<a name="l01582"></a>01582         <span class="keywordflow">return</span> 0;
<a name="l01583"></a>01583       <span class="keywordflow">case</span> <a class="code" href="../../db/d0a/method_8h.html#a88a981f6cc69187ed9c2de2630a1687aa851a2c8d2c25891b7d1ce87759b31de0">VM_METHOD_TYPE_BMETHOD</a>:
<a name="l01584"></a>01584         <span class="keywordflow">return</span> <a class="code" href="../../db/d2e/intern_8h.html#a2d07fdb0461b17bb54671e2cbc5778d8">rb_proc_arity</a>(def-&gt;<a class="code" href="../../d6/dab/structrb__method__definition__struct.html#a83806aa27bac8990f4f9ce83377c76e7">body</a>.<a class="code" href="../../d6/dab/structrb__method__definition__struct.html#a75d163b2711e8ab402ba04853f72d246">proc</a>);
<a name="l01585"></a>01585       <span class="keywordflow">case</span> <a class="code" href="../../db/d0a/method_8h.html#a88a981f6cc69187ed9c2de2630a1687aa09fd70c8c3426502348b7df7c121e505">VM_METHOD_TYPE_ISEQ</a>: {
<a name="l01586"></a>01586         <a class="code" href="../../d6/de3/structrb__iseq__struct.html">rb_iseq_t</a> *iseq = def-&gt;<a class="code" href="../../d6/dab/structrb__method__definition__struct.html#a83806aa27bac8990f4f9ce83377c76e7">body</a>.<a class="code" href="../../d6/dab/structrb__method__definition__struct.html#aadf9737964ff683c467dfc1b820b1016">iseq</a>;
<a name="l01587"></a>01587         <span class="keywordflow">if</span> (iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a21bd6b9b1c875df9484cc16f8dd9c73e">arg_rest</a> == -1 &amp;&amp; iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#ad71990c5fa4c678e369e18bddbaf1639">arg_opts</a> == 0) {
<a name="l01588"></a>01588             <span class="keywordflow">return</span> iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a5fd0acd110681eeb0f95c3b283451a0a" title="argument information">argc</a>;
<a name="l01589"></a>01589         }
<a name="l01590"></a>01590         <span class="keywordflow">else</span> {
<a name="l01591"></a>01591             <span class="keywordflow">return</span> -(iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a5fd0acd110681eeb0f95c3b283451a0a" title="argument information">argc</a> + 1 + iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a4915a4238c8e8e7106337e5e1c609576">arg_post_len</a>);
<a name="l01592"></a>01592         }
<a name="l01593"></a>01593       }
<a name="l01594"></a>01594       <span class="keywordflow">case</span> <a class="code" href="../../db/d0a/method_8h.html#a88a981f6cc69187ed9c2de2630a1687aaffd01b8301fa1cc0cbd6a6aca6583153">VM_METHOD_TYPE_UNDEF</a>:
<a name="l01595"></a>01595       <span class="keywordflow">case</span> <a class="code" href="../../db/d0a/method_8h.html#a88a981f6cc69187ed9c2de2630a1687aa5d67e9c72f82a6988ec1a37a93ee55b5">VM_METHOD_TYPE_NOTIMPLEMENTED</a>:
<a name="l01596"></a>01596         <span class="keywordflow">return</span> 0;
<a name="l01597"></a>01597       <span class="keywordflow">case</span> <a class="code" href="../../db/d0a/method_8h.html#a88a981f6cc69187ed9c2de2630a1687aa63a0d73143740232b3482d940bfe52f8">VM_METHOD_TYPE_MISSING</a>:
<a name="l01598"></a>01598         <span class="keywordflow">return</span> -1;
<a name="l01599"></a>01599       <span class="keywordflow">case</span> <a class="code" href="../../db/d0a/method_8h.html#a88a981f6cc69187ed9c2de2630a1687aa2eada169dedcc0ee758832fca8dffd2a">VM_METHOD_TYPE_OPTIMIZED</a>: {
<a name="l01600"></a>01600         <span class="keywordflow">switch</span> (def-&gt;<a class="code" href="../../d6/dab/structrb__method__definition__struct.html#a83806aa27bac8990f4f9ce83377c76e7">body</a>.<a class="code" href="../../d6/dab/structrb__method__definition__struct.html#a2396d9b2430f318c570fe2ef1cebf659">optimize_type</a>) {
<a name="l01601"></a>01601           <span class="keywordflow">case</span> OPTIMIZED_METHOD_TYPE_SEND:
<a name="l01602"></a>01602             <span class="keywordflow">return</span> -1;
<a name="l01603"></a>01603           <span class="keywordflow">default</span>:
<a name="l01604"></a>01604             <span class="keywordflow">break</span>;
<a name="l01605"></a>01605         }
<a name="l01606"></a>01606       }
<a name="l01607"></a>01607     }
<a name="l01608"></a>01608     <a class="code" href="../../db/dcc/error_8c.html#a2d5fb28e54f792e7341b2c45f52f3860">rb_bug</a>(<span class="stringliteral">&quot;rb_method_entry_arity: invalid method entry type (%d)&quot;</span>, def-&gt;<a class="code" href="../../d6/dab/structrb__method__definition__struct.html#a60ad63aa9037403df6e773853973c41b">type</a>);
<a name="l01609"></a>01609 }
<a name="l01610"></a>01610 
<a name="l01611"></a>01611 <span class="comment">/*</span>
<a name="l01612"></a>01612 <span class="comment"> *  call-seq:</span>
<a name="l01613"></a>01613 <span class="comment"> *     meth.arity    -&gt; fixnum</span>
<a name="l01614"></a>01614 <span class="comment"> *</span>
<a name="l01615"></a>01615 <span class="comment"> *  Returns an indication of the number of arguments accepted by a</span>
<a name="l01616"></a>01616 <span class="comment"> *  method. Returns a nonnegative integer for methods that take a fixed</span>
<a name="l01617"></a>01617 <span class="comment"> *  number of arguments. For Ruby methods that take a variable number of</span>
<a name="l01618"></a>01618 <span class="comment"> *  arguments, returns -n-1, where n is the number of required</span>
<a name="l01619"></a>01619 <span class="comment"> *  arguments. For methods written in C, returns -1 if the call takes a</span>
<a name="l01620"></a>01620 <span class="comment"> *  variable number of arguments.</span>
<a name="l01621"></a>01621 <span class="comment"> *</span>
<a name="l01622"></a>01622 <span class="comment"> *     class C</span>
<a name="l01623"></a>01623 <span class="comment"> *       def one;    end</span>
<a name="l01624"></a>01624 <span class="comment"> *       def two(a); end</span>
<a name="l01625"></a>01625 <span class="comment"> *       def three(*a);  end</span>
<a name="l01626"></a>01626 <span class="comment"> *       def four(a, b); end</span>
<a name="l01627"></a>01627 <span class="comment"> *       def five(a, b, *c);    end</span>
<a name="l01628"></a>01628 <span class="comment"> *       def six(a, b, *c, &amp;d); end</span>
<a name="l01629"></a>01629 <span class="comment"> *     end</span>
<a name="l01630"></a>01630 <span class="comment"> *     c = C.new</span>
<a name="l01631"></a>01631 <span class="comment"> *     c.method(:one).arity     #=&gt; 0</span>
<a name="l01632"></a>01632 <span class="comment"> *     c.method(:two).arity     #=&gt; 1</span>
<a name="l01633"></a>01633 <span class="comment"> *     c.method(:three).arity   #=&gt; -1</span>
<a name="l01634"></a>01634 <span class="comment"> *     c.method(:four).arity    #=&gt; 2</span>
<a name="l01635"></a>01635 <span class="comment"> *     c.method(:five).arity    #=&gt; -3</span>
<a name="l01636"></a>01636 <span class="comment"> *     c.method(:six).arity     #=&gt; -3</span>
<a name="l01637"></a>01637 <span class="comment"> *</span>
<a name="l01638"></a>01638 <span class="comment"> *     &quot;cat&quot;.method(:size).arity      #=&gt; 0</span>
<a name="l01639"></a>01639 <span class="comment"> *     &quot;cat&quot;.method(:replace).arity   #=&gt; 1</span>
<a name="l01640"></a>01640 <span class="comment"> *     &quot;cat&quot;.method(:squeeze).arity   #=&gt; -1</span>
<a name="l01641"></a>01641 <span class="comment"> *     &quot;cat&quot;.method(:count).arity     #=&gt; -1</span>
<a name="l01642"></a>01642 <span class="comment"> */</span>
<a name="l01643"></a>01643 
<a name="l01644"></a>01644 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l01645"></a><a class="code" href="../../d3/dda/proc_8c.html#aeb2f11e919df26ba1e2e12a4fda06fd5">01645</a> <a class="code" href="../../d3/dda/proc_8c.html#aeb2f11e919df26ba1e2e12a4fda06fd5">method_arity_m</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> method)
<a name="l01646"></a>01646 {
<a name="l01647"></a>01647     <span class="keywordtype">int</span> n = <a class="code" href="../../d3/dda/proc_8c.html#a7f35da9e01e956b215307b9871d20553">method_arity</a>(method);
<a name="l01648"></a>01648     <span class="keywordflow">return</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(n);
<a name="l01649"></a>01649 }
<a name="l01650"></a>01650 
<a name="l01651"></a>01651 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l01652"></a><a class="code" href="../../d3/dda/proc_8c.html#a7f35da9e01e956b215307b9871d20553">01652</a> <a class="code" href="../../d3/dda/proc_8c.html#a7f35da9e01e956b215307b9871d20553">method_arity</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> method)
<a name="l01653"></a>01653 {
<a name="l01654"></a>01654     <span class="keyword">struct </span><a class="code" href="../../d7/d6e/struct_m_e_t_h_o_d.html">METHOD</a> *data;
<a name="l01655"></a>01655 
<a name="l01656"></a>01656     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a8dce6624396c492cdd1af3a4c5871556">TypedData_Get_Struct</a>(method, <span class="keyword">struct</span> <a class="code" href="../../d7/d6e/struct_m_e_t_h_o_d.html">METHOD</a>, &amp;<a class="code" href="../../d3/dda/proc_8c.html#a8456ae397367f452540413ae45c0a5f3">method_data_type</a>, data);
<a name="l01657"></a>01657     <span class="keywordflow">return</span> <a class="code" href="../../db/d0a/method_8h.html#a1aebafc093da93cbb5651bd92189bbd2">rb_method_entry_arity</a>(data-&gt;<a class="code" href="../../d7/d6e/struct_m_e_t_h_o_d.html#a5042d3b2ef85e71b1a66e49da661733a">me</a>);
<a name="l01658"></a>01658 }
<a name="l01659"></a>01659 
<a name="l01660"></a>01660 <span class="keywordtype">int</span>
<a name="l01661"></a><a class="code" href="../../d3/dda/proc_8c.html#a8d6ba28344f95d5c2009fd4f02d3424d">01661</a> <a class="code" href="../../db/d2e/intern_8h.html#a95a3f2ec8edf7b98881d3ad09c92d42e">rb_mod_method_arity</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <a class="code" href="../../d1/d6f/date__strftime_8c.html#aa84d960185b18347956518e4d00766b4">mod</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#afa5b9137f051ac26d7ccc8824f178233">ID</a> <span class="keywordtype">id</span>)
<a name="l01662"></a>01662 {
<a name="l01663"></a>01663     <a class="code" href="../../d7/db7/structrb__method__entry__struct.html">rb_method_entry_t</a> *<a class="code" href="../../d7/d6e/struct_m_e_t_h_o_d.html#a5042d3b2ef85e71b1a66e49da661733a">me</a> = <a class="code" href="../../db/d0a/method_8h.html#af8cbec769b20978aec8c47c2291427cf">rb_method_entry</a>(mod, <span class="keywordtype">id</span>);
<a name="l01664"></a>01664     <span class="keywordflow">return</span> <a class="code" href="../../db/d0a/method_8h.html#a1aebafc093da93cbb5651bd92189bbd2">rb_method_entry_arity</a>(me);
<a name="l01665"></a>01665 }
<a name="l01666"></a>01666 
<a name="l01667"></a>01667 <span class="keywordtype">int</span>
<a name="l01668"></a><a class="code" href="../../d3/dda/proc_8c.html#ac1ace40ccccb86a7f3ebd60a5a472273">01668</a> <a class="code" href="../../db/d2e/intern_8h.html#a5e46f5df7f6f06843a4e69a05ece695d">rb_obj_method_arity</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> obj, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#afa5b9137f051ac26d7ccc8824f178233">ID</a> <span class="keywordtype">id</span>)
<a name="l01669"></a>01669 {
<a name="l01670"></a>01670     <span class="keywordflow">return</span> <a class="code" href="../../db/d2e/intern_8h.html#a95a3f2ec8edf7b98881d3ad09c92d42e">rb_mod_method_arity</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#ad07df58de9895cbc33c10f02540d2d4d">CLASS_OF</a>(obj), <span class="keywordtype">id</span>);
<a name="l01671"></a>01671 }
<a name="l01672"></a>01672 
<a name="l01673"></a>01673 <span class="keyword">static</span> <span class="keyword">inline</span> <a class="code" href="../../d6/dab/structrb__method__definition__struct.html">rb_method_definition_t</a> *
<a name="l01674"></a><a class="code" href="../../d3/dda/proc_8c.html#af547152576c528a14375056764386381">01674</a> <a class="code" href="../../d3/dda/proc_8c.html#af547152576c528a14375056764386381">method_get_def</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> method)
<a name="l01675"></a>01675 {
<a name="l01676"></a>01676     <span class="keyword">struct </span><a class="code" href="../../d7/d6e/struct_m_e_t_h_o_d.html">METHOD</a> *data;
<a name="l01677"></a>01677 
<a name="l01678"></a>01678     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a8dce6624396c492cdd1af3a4c5871556">TypedData_Get_Struct</a>(method, <span class="keyword">struct</span> <a class="code" href="../../d7/d6e/struct_m_e_t_h_o_d.html">METHOD</a>, &amp;<a class="code" href="../../d3/dda/proc_8c.html#a8456ae397367f452540413ae45c0a5f3">method_data_type</a>, data);
<a name="l01679"></a>01679     <span class="keywordflow">return</span> data-&gt;<a class="code" href="../../d7/d6e/struct_m_e_t_h_o_d.html#a5042d3b2ef85e71b1a66e49da661733a">me</a>-&gt;<a class="code" href="../../d7/db7/structrb__method__entry__struct.html#a6c868c50e67b757c6324dfef0f3184dc">def</a>;
<a name="l01680"></a>01680 }
<a name="l01681"></a>01681 
<a name="l01682"></a>01682 <span class="keyword">static</span> <a class="code" href="../../d6/de3/structrb__iseq__struct.html">rb_iseq_t</a> *
<a name="l01683"></a><a class="code" href="../../d3/dda/proc_8c.html#a86526a85e18fe99fd6d3529e0ee91963">01683</a> <a class="code" href="../../d3/dda/proc_8c.html#a86526a85e18fe99fd6d3529e0ee91963">method_get_iseq</a>(<a class="code" href="../../d6/dab/structrb__method__definition__struct.html">rb_method_definition_t</a> *def)
<a name="l01684"></a>01684 {
<a name="l01685"></a>01685     <span class="keywordflow">switch</span> (def-&gt;<a class="code" href="../../d6/dab/structrb__method__definition__struct.html#a60ad63aa9037403df6e773853973c41b">type</a>) {
<a name="l01686"></a>01686       <span class="keywordflow">case</span> <a class="code" href="../../db/d0a/method_8h.html#a88a981f6cc69187ed9c2de2630a1687aa851a2c8d2c25891b7d1ce87759b31de0">VM_METHOD_TYPE_BMETHOD</a>:
<a name="l01687"></a>01687         <span class="keywordflow">return</span> <a class="code" href="../../d3/dda/proc_8c.html#a67538e5c8312f56b5a41b8208ee5c5d1">get_proc_iseq</a>(def-&gt;<a class="code" href="../../d6/dab/structrb__method__definition__struct.html#a83806aa27bac8990f4f9ce83377c76e7">body</a>.<a class="code" href="../../d6/dab/structrb__method__definition__struct.html#a75d163b2711e8ab402ba04853f72d246">proc</a>, 0);
<a name="l01688"></a>01688       <span class="keywordflow">case</span> <a class="code" href="../../db/d0a/method_8h.html#a88a981f6cc69187ed9c2de2630a1687aa09fd70c8c3426502348b7df7c121e505">VM_METHOD_TYPE_ISEQ</a>:
<a name="l01689"></a>01689         <span class="keywordflow">return</span> def-&gt;<a class="code" href="../../d6/dab/structrb__method__definition__struct.html#a83806aa27bac8990f4f9ce83377c76e7">body</a>.<a class="code" href="../../d6/dab/structrb__method__definition__struct.html#aadf9737964ff683c467dfc1b820b1016">iseq</a>;
<a name="l01690"></a>01690       <span class="keywordflow">default</span>:
<a name="l01691"></a>01691         <span class="keywordflow">return</span> 0;
<a name="l01692"></a>01692     }
<a name="l01693"></a>01693 }
<a name="l01694"></a>01694 
<a name="l01695"></a>01695 <a class="code" href="../../d6/de3/structrb__iseq__struct.html">rb_iseq_t</a> *
<a name="l01696"></a><a class="code" href="../../d3/dda/proc_8c.html#a86eba375123d5e2e68d42588bf468be5">01696</a> <a class="code" href="../../d7/dc8/iseq_8h.html#ab5b6d8f8d16cb0a7aca7e95040682084">rb_method_get_iseq</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> method)
<a name="l01697"></a>01697 {
<a name="l01698"></a>01698     <span class="keywordflow">return</span> <a class="code" href="../../d3/dda/proc_8c.html#a86526a85e18fe99fd6d3529e0ee91963">method_get_iseq</a>(<a class="code" href="../../d3/dda/proc_8c.html#af547152576c528a14375056764386381">method_get_def</a>(method));
<a name="l01699"></a>01699 }
<a name="l01700"></a>01700 
<a name="l01701"></a>01701 <span class="comment">/*</span>
<a name="l01702"></a>01702 <span class="comment"> * call-seq:</span>
<a name="l01703"></a>01703 <span class="comment"> *    meth.source_location  -&gt; [String, Fixnum]</span>
<a name="l01704"></a>01704 <span class="comment"> *</span>
<a name="l01705"></a>01705 <span class="comment"> * Returns the Ruby source filename and line number containing this method</span>
<a name="l01706"></a>01706 <span class="comment"> * or nil if this method was not defined in Ruby (i.e. native)</span>
<a name="l01707"></a>01707 <span class="comment"> */</span>
<a name="l01708"></a>01708 
<a name="l01709"></a>01709 <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l01710"></a><a class="code" href="../../d3/dda/proc_8c.html#accbc09fa63e28b2af7cba85a731a916e">01710</a> <a class="code" href="../../d3/dda/proc_8c.html#accbc09fa63e28b2af7cba85a731a916e">rb_method_location</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> method)
<a name="l01711"></a>01711 {
<a name="l01712"></a>01712     <a class="code" href="../../d6/dab/structrb__method__definition__struct.html">rb_method_definition_t</a> *def = <a class="code" href="../../d3/dda/proc_8c.html#af547152576c528a14375056764386381">method_get_def</a>(method);
<a name="l01713"></a>01713     <span class="keywordflow">if</span> (def-&gt;<a class="code" href="../../d6/dab/structrb__method__definition__struct.html#a60ad63aa9037403df6e773853973c41b">type</a> == <a class="code" href="../../db/d0a/method_8h.html#a88a981f6cc69187ed9c2de2630a1687aa0afa124f1dfc47ee89ab883b2591573b">VM_METHOD_TYPE_ATTRSET</a> || def-&gt;<a class="code" href="../../d6/dab/structrb__method__definition__struct.html#a60ad63aa9037403df6e773853973c41b">type</a> == <a class="code" href="../../db/d0a/method_8h.html#a88a981f6cc69187ed9c2de2630a1687aa876dfcf064e4f083567badb52e606e0e">VM_METHOD_TYPE_IVAR</a>) {
<a name="l01714"></a>01714         <span class="keywordflow">if</span> (!def-&gt;<a class="code" href="../../d6/dab/structrb__method__definition__struct.html#a83806aa27bac8990f4f9ce83377c76e7">body</a>.<a class="code" href="../../d6/dab/structrb__method__definition__struct.html#a8dc19a3a32e0b6fe94d3418cddb06170">attr</a>.<a class="code" href="../../d2/d79/structrb__method__attr__struct.html#a4c08c4ffa6528eef639b645a6bf864b6">location</a>)
<a name="l01715"></a>01715             <span class="keywordflow">return</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a320970f989dc8294c8203154e3db40c1">Qnil</a>;
<a name="l01716"></a>01716         <span class="keywordflow">return</span> <a class="code" href="../../dc/dcc/array_8c.html#a4ed6dfd78eb5519d446c519e364ef3ab">rb_ary_dup</a>(def-&gt;<a class="code" href="../../d6/dab/structrb__method__definition__struct.html#a83806aa27bac8990f4f9ce83377c76e7">body</a>.<a class="code" href="../../d6/dab/structrb__method__definition__struct.html#a8dc19a3a32e0b6fe94d3418cddb06170">attr</a>.<a class="code" href="../../d2/d79/structrb__method__attr__struct.html#a4c08c4ffa6528eef639b645a6bf864b6">location</a>);
<a name="l01717"></a>01717     }
<a name="l01718"></a>01718     <span class="keywordflow">return</span> <a class="code" href="../../d3/dda/proc_8c.html#ada097a6efbfd8d1e62683d981b21eef7">iseq_location</a>(<a class="code" href="../../d3/dda/proc_8c.html#a86526a85e18fe99fd6d3529e0ee91963">method_get_iseq</a>(def));
<a name="l01719"></a>01719 }
<a name="l01720"></a>01720 
<a name="l01721"></a>01721 <span class="comment">/*</span>
<a name="l01722"></a>01722 <span class="comment"> * call-seq:</span>
<a name="l01723"></a>01723 <span class="comment"> *    meth.parameters  -&gt; array</span>
<a name="l01724"></a>01724 <span class="comment"> *</span>
<a name="l01725"></a>01725 <span class="comment"> * Returns the parameter information of this method.</span>
<a name="l01726"></a>01726 <span class="comment"> */</span>
<a name="l01727"></a>01727 
<a name="l01728"></a>01728 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l01729"></a><a class="code" href="../../d3/dda/proc_8c.html#adbe6a5429a2beceb1ae2eac33e16662d">01729</a> <a class="code" href="../../d3/dda/proc_8c.html#adbe6a5429a2beceb1ae2eac33e16662d">rb_method_parameters</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> method)
<a name="l01730"></a>01730 {
<a name="l01731"></a>01731     <a class="code" href="../../d6/de3/structrb__iseq__struct.html">rb_iseq_t</a> *iseq = <a class="code" href="../../d7/dc8/iseq_8h.html#ab5b6d8f8d16cb0a7aca7e95040682084">rb_method_get_iseq</a>(method);
<a name="l01732"></a>01732     <span class="keywordflow">if</span> (!iseq) {
<a name="l01733"></a>01733         <span class="keywordflow">return</span> <a class="code" href="../../d3/dda/proc_8c.html#a1ebd05bf80391d27cbd99fb76967b14e">unnamed_parameters</a>(<a class="code" href="../../d3/dda/proc_8c.html#a7f35da9e01e956b215307b9871d20553">method_arity</a>(method));
<a name="l01734"></a>01734     }
<a name="l01735"></a>01735     <span class="keywordflow">return</span> <a class="code" href="../../dd/d74/iseq_8c.html#a482bd449b1ad733210e57d697c544cc7">rb_iseq_parameters</a>(iseq, 0);
<a name="l01736"></a>01736 }
<a name="l01737"></a>01737 
<a name="l01738"></a>01738 <span class="comment">/*</span>
<a name="l01739"></a>01739 <span class="comment"> *  call-seq:</span>
<a name="l01740"></a>01740 <span class="comment"> *   meth.to_s      -&gt;  string</span>
<a name="l01741"></a>01741 <span class="comment"> *   meth.inspect   -&gt;  string</span>
<a name="l01742"></a>01742 <span class="comment"> *</span>
<a name="l01743"></a>01743 <span class="comment"> *  Returns the name of the underlying method.</span>
<a name="l01744"></a>01744 <span class="comment"> *</span>
<a name="l01745"></a>01745 <span class="comment"> *    &quot;cat&quot;.method(:count).inspect   #=&gt; &quot;#&lt;Method: String#count&gt;&quot;</span>
<a name="l01746"></a>01746 <span class="comment"> */</span>
<a name="l01747"></a>01747 
<a name="l01748"></a>01748 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l01749"></a><a class="code" href="../../d3/dda/proc_8c.html#a1592e1f35640a9f82f0cca73ebe3bec1">01749</a> <a class="code" href="../../d3/dda/proc_8c.html#a1592e1f35640a9f82f0cca73ebe3bec1">method_inspect</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> method)
<a name="l01750"></a>01750 {
<a name="l01751"></a>01751     <span class="keyword">struct </span><a class="code" href="../../d7/d6e/struct_m_e_t_h_o_d.html">METHOD</a> *data;
<a name="l01752"></a>01752     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str;
<a name="l01753"></a>01753     <span class="keyword">const</span> <span class="keywordtype">char</span> *s;
<a name="l01754"></a>01754     <span class="keyword">const</span> <span class="keywordtype">char</span> *sharp = <span class="stringliteral">&quot;#&quot;</span>;
<a name="l01755"></a>01755 
<a name="l01756"></a>01756     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a8dce6624396c492cdd1af3a4c5871556">TypedData_Get_Struct</a>(method, <span class="keyword">struct</span> <a class="code" href="../../d7/d6e/struct_m_e_t_h_o_d.html">METHOD</a>, &amp;<a class="code" href="../../d3/dda/proc_8c.html#a8456ae397367f452540413ae45c0a5f3">method_data_type</a>, data);
<a name="l01757"></a>01757     str = <a class="code" href="../../db/d2e/intern_8h.html#a428d54807c6e5b98fa840f5e6d642355">rb_str_buf_new2</a>(<span class="stringliteral">&quot;#&lt;&quot;</span>);
<a name="l01758"></a>01758     s = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a9b4f42ada717bfbe7a78830639476aed">rb_obj_classname</a>(method);
<a name="l01759"></a>01759     <a class="code" href="../../db/d2e/intern_8h.html#a7866feb2bb4aee9e8fbfd43195638255">rb_str_buf_cat2</a>(str, s);
<a name="l01760"></a>01760     <a class="code" href="../../db/d2e/intern_8h.html#a7866feb2bb4aee9e8fbfd43195638255">rb_str_buf_cat2</a>(str, <span class="stringliteral">&quot;: &quot;</span>);
<a name="l01761"></a>01761 
<a name="l01762"></a>01762     <span class="keywordflow">if</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a1ae918b6cc84188a9dc6ab545f732e4d">FL_TEST</a>(data-&gt;<a class="code" href="../../d7/d6e/struct_m_e_t_h_o_d.html#a5042d3b2ef85e71b1a66e49da661733a">me</a>-&gt;<a class="code" href="../../d7/db7/structrb__method__entry__struct.html#a9ce0871480ac405b00673b25234738de">klass</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a081b5172ef37829bb3a258cd1ad393bc">FL_SINGLETON</a>)) {
<a name="l01763"></a>01763         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> v = <a class="code" href="../../db/d2e/intern_8h.html#ad05f3639fd927a08b07d12e2960936d4">rb_iv_get</a>(data-&gt;<a class="code" href="../../d7/d6e/struct_m_e_t_h_o_d.html#a5042d3b2ef85e71b1a66e49da661733a">me</a>-&gt;<a class="code" href="../../d7/db7/structrb__method__entry__struct.html#a9ce0871480ac405b00673b25234738de">klass</a>, <span class="stringliteral">&quot;__attached__&quot;</span>);
<a name="l01764"></a>01764 
<a name="l01765"></a>01765         <span class="keywordflow">if</span> (data-&gt;<a class="code" href="../../d7/d6e/struct_m_e_t_h_o_d.html#a1a31194e3ece53464051ce683ef36eb0">recv</a> == <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a2edf6990280eb2637623ccd421dee4f0">Qundef</a>) {
<a name="l01766"></a>01766             <a class="code" href="../../db/d2e/intern_8h.html#abea58f4d2559060d5821ff7d3d35a496">rb_str_buf_append</a>(str, <a class="code" href="../../db/d2e/intern_8h.html#acbb281bacf6b80f460143348e26142e9">rb_inspect</a>(data-&gt;<a class="code" href="../../d7/d6e/struct_m_e_t_h_o_d.html#a5042d3b2ef85e71b1a66e49da661733a">me</a>-&gt;<a class="code" href="../../d7/db7/structrb__method__entry__struct.html#a9ce0871480ac405b00673b25234738de">klass</a>));
<a name="l01767"></a>01767         }
<a name="l01768"></a>01768         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (data-&gt;<a class="code" href="../../d7/d6e/struct_m_e_t_h_o_d.html#a1a31194e3ece53464051ce683ef36eb0">recv</a> == v) {
<a name="l01769"></a>01769             <a class="code" href="../../db/d2e/intern_8h.html#abea58f4d2559060d5821ff7d3d35a496">rb_str_buf_append</a>(str, <a class="code" href="../../db/d2e/intern_8h.html#acbb281bacf6b80f460143348e26142e9">rb_inspect</a>(v));
<a name="l01770"></a>01770             sharp = <span class="stringliteral">&quot;.&quot;</span>;
<a name="l01771"></a>01771         }
<a name="l01772"></a>01772         <span class="keywordflow">else</span> {
<a name="l01773"></a>01773             <a class="code" href="../../db/d2e/intern_8h.html#abea58f4d2559060d5821ff7d3d35a496">rb_str_buf_append</a>(str, <a class="code" href="../../db/d2e/intern_8h.html#acbb281bacf6b80f460143348e26142e9">rb_inspect</a>(data-&gt;<a class="code" href="../../d7/d6e/struct_m_e_t_h_o_d.html#a1a31194e3ece53464051ce683ef36eb0">recv</a>));
<a name="l01774"></a>01774             <a class="code" href="../../db/d2e/intern_8h.html#a7866feb2bb4aee9e8fbfd43195638255">rb_str_buf_cat2</a>(str, <span class="stringliteral">&quot;(&quot;</span>);
<a name="l01775"></a>01775             <a class="code" href="../../db/d2e/intern_8h.html#abea58f4d2559060d5821ff7d3d35a496">rb_str_buf_append</a>(str, <a class="code" href="../../db/d2e/intern_8h.html#acbb281bacf6b80f460143348e26142e9">rb_inspect</a>(v));
<a name="l01776"></a>01776             <a class="code" href="../../db/d2e/intern_8h.html#a7866feb2bb4aee9e8fbfd43195638255">rb_str_buf_cat2</a>(str, <span class="stringliteral">&quot;)&quot;</span>);
<a name="l01777"></a>01777             sharp = <span class="stringliteral">&quot;.&quot;</span>;
<a name="l01778"></a>01778         }
<a name="l01779"></a>01779     }
<a name="l01780"></a>01780     <span class="keywordflow">else</span> {
<a name="l01781"></a>01781         <a class="code" href="../../db/d2e/intern_8h.html#a7866feb2bb4aee9e8fbfd43195638255">rb_str_buf_cat2</a>(str, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#afd98e957d0d96017f7a07dd83772fadc">rb_class2name</a>(data-&gt;<a class="code" href="../../d7/d6e/struct_m_e_t_h_o_d.html#aa00af10f714836e05ea2c9dd5d55f01e">rclass</a>));
<a name="l01782"></a>01782         <span class="keywordflow">if</span> (data-&gt;<a class="code" href="../../d7/d6e/struct_m_e_t_h_o_d.html#aa00af10f714836e05ea2c9dd5d55f01e">rclass</a> != data-&gt;<a class="code" href="../../d7/d6e/struct_m_e_t_h_o_d.html#a5042d3b2ef85e71b1a66e49da661733a">me</a>-&gt;<a class="code" href="../../d7/db7/structrb__method__entry__struct.html#a9ce0871480ac405b00673b25234738de">klass</a>) {
<a name="l01783"></a>01783             <a class="code" href="../../db/d2e/intern_8h.html#a7866feb2bb4aee9e8fbfd43195638255">rb_str_buf_cat2</a>(str, <span class="stringliteral">&quot;(&quot;</span>);
<a name="l01784"></a>01784             <a class="code" href="../../db/d2e/intern_8h.html#a7866feb2bb4aee9e8fbfd43195638255">rb_str_buf_cat2</a>(str, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#afd98e957d0d96017f7a07dd83772fadc">rb_class2name</a>(data-&gt;<a class="code" href="../../d7/d6e/struct_m_e_t_h_o_d.html#a5042d3b2ef85e71b1a66e49da661733a">me</a>-&gt;<a class="code" href="../../d7/db7/structrb__method__entry__struct.html#a9ce0871480ac405b00673b25234738de">klass</a>));
<a name="l01785"></a>01785             <a class="code" href="../../db/d2e/intern_8h.html#a7866feb2bb4aee9e8fbfd43195638255">rb_str_buf_cat2</a>(str, <span class="stringliteral">&quot;)&quot;</span>);
<a name="l01786"></a>01786         }
<a name="l01787"></a>01787     }
<a name="l01788"></a>01788     <a class="code" href="../../db/d2e/intern_8h.html#a7866feb2bb4aee9e8fbfd43195638255">rb_str_buf_cat2</a>(str, sharp);
<a name="l01789"></a>01789     <a class="code" href="../../db/d2e/intern_8h.html#ab592dcd9e193dea76fb0ff58b5d907e4">rb_str_append</a>(str, <a class="code" href="../../d5/d11/ripper_8c.html#aec42ef320e57234e789bdda6d655716f">rb_id2str</a>(data-&gt;<a class="code" href="../../d7/d6e/struct_m_e_t_h_o_d.html#a5042d3b2ef85e71b1a66e49da661733a">me</a>-&gt;<a class="code" href="../../d7/db7/structrb__method__entry__struct.html#a6c868c50e67b757c6324dfef0f3184dc">def</a>-&gt;<a class="code" href="../../d6/dab/structrb__method__definition__struct.html#a7fc0edb8505a61f8ae8bf2544fa7f676">original_id</a>));
<a name="l01790"></a>01790     <span class="keywordflow">if</span> (data-&gt;<a class="code" href="../../d7/d6e/struct_m_e_t_h_o_d.html#a5042d3b2ef85e71b1a66e49da661733a">me</a>-&gt;<a class="code" href="../../d7/db7/structrb__method__entry__struct.html#a6c868c50e67b757c6324dfef0f3184dc">def</a>-&gt;<a class="code" href="../../d6/dab/structrb__method__definition__struct.html#a60ad63aa9037403df6e773853973c41b">type</a> == <a class="code" href="../../db/d0a/method_8h.html#a88a981f6cc69187ed9c2de2630a1687aa5d67e9c72f82a6988ec1a37a93ee55b5">VM_METHOD_TYPE_NOTIMPLEMENTED</a>) {
<a name="l01791"></a>01791         <a class="code" href="../../db/d2e/intern_8h.html#a7866feb2bb4aee9e8fbfd43195638255">rb_str_buf_cat2</a>(str, <span class="stringliteral">&quot; (not-implemented)&quot;</span>);
<a name="l01792"></a>01792     }
<a name="l01793"></a>01793     <a class="code" href="../../db/d2e/intern_8h.html#a7866feb2bb4aee9e8fbfd43195638255">rb_str_buf_cat2</a>(str, <span class="stringliteral">&quot;&gt;&quot;</span>);
<a name="l01794"></a>01794 
<a name="l01795"></a>01795     <span class="keywordflow">return</span> str;
<a name="l01796"></a>01796 }
<a name="l01797"></a>01797 
<a name="l01798"></a>01798 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l01799"></a><a class="code" href="../../d3/dda/proc_8c.html#a0fc7262734605527a6cea84686888a49">01799</a> <a class="code" href="../../d3/dda/proc_8c.html#a0fc7262734605527a6cea84686888a49">mproc</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> method)
<a name="l01800"></a>01800 {
<a name="l01801"></a>01801     <span class="keywordflow">return</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a6a973fe624aa9aa9ba0cdeb6792d3187" title="Calls a method.">rb_funcall</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a320970f989dc8294c8203154e3db40c1">Qnil</a>, <a class="code" href="../../dc/dcc/array_8c.html#a9cfa42d4b79c89d68c53be8b2150a503">rb_intern</a>(<span class="stringliteral">&quot;proc&quot;</span>), 0);
<a name="l01802"></a>01802 }
<a name="l01803"></a>01803 
<a name="l01804"></a>01804 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l01805"></a><a class="code" href="../../d3/dda/proc_8c.html#a923da7b10a1cbca6dbfbceb0a566caab">01805</a> <a class="code" href="../../d3/dda/proc_8c.html#a923da7b10a1cbca6dbfbceb0a566caab">mlambda</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> method)
<a name="l01806"></a>01806 {
<a name="l01807"></a>01807     <span class="keywordflow">return</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a6a973fe624aa9aa9ba0cdeb6792d3187" title="Calls a method.">rb_funcall</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a320970f989dc8294c8203154e3db40c1">Qnil</a>, <a class="code" href="../../dc/dcc/array_8c.html#a9cfa42d4b79c89d68c53be8b2150a503">rb_intern</a>(<span class="stringliteral">&quot;lambda&quot;</span>), 0);
<a name="l01808"></a>01808 }
<a name="l01809"></a>01809 
<a name="l01810"></a>01810 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l01811"></a><a class="code" href="../../d3/dda/proc_8c.html#a8a4909696602de41227239b31a9ee19e">01811</a> <a class="code" href="../../d3/dda/proc_8c.html#a8a4909696602de41227239b31a9ee19e">bmcall</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <a class="code" href="../../d3/d09/ripper_8y.html#a8187411843a6284ffb964ef3fb9fcab3">args</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> method)
<a name="l01812"></a>01812 {
<a name="l01813"></a>01813     <span class="keyword">volatile</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> a;
<a name="l01814"></a>01814     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> ret;
<a name="l01815"></a>01815     <span class="keywordtype">int</span> argc;
<a name="l01816"></a>01816 
<a name="l01817"></a>01817     <span class="keywordflow">if</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#ad07df58de9895cbc33c10f02540d2d4d">CLASS_OF</a>(args) != <a class="code" href="../../dc/dcc/array_8c.html#a2ae422f2c99d019bdfe5b12008c82b90">rb_cArray</a>) {
<a name="l01818"></a>01818         args = <a class="code" href="../../dc/dcc/array_8c.html#a8317ecd6a0abb5ad08c50c732f30059b">rb_ary_new3</a>(1, args);
<a name="l01819"></a>01819         argc = 1;
<a name="l01820"></a>01820     }
<a name="l01821"></a>01821     <span class="keywordflow">else</span> {
<a name="l01822"></a>01822         argc = <a class="code" href="../../d3/dda/proc_8c.html#a4200f9fe2afc8140313fbc922d98d258">check_argc</a>(<a class="code" href="../../d8/df4/generator_8h.html#ae988773ed219452578f881fc7189c486">RARRAY_LEN</a>(args));
<a name="l01823"></a>01823     }
<a name="l01824"></a>01824     ret = <a class="code" href="../../db/d2e/intern_8h.html#a0c43557c40369d54f475f26fb34678fb">rb_method_call</a>(argc, <a class="code" href="../../d8/df4/generator_8h.html#abb794fe2d7c73eea87e7ba2273939a8e">RARRAY_PTR</a>(args), method);
<a name="l01825"></a>01825     <a class="code" href="../../d8/df4/generator_8h.html#ad2bf389f3fddea7bd3befa162c70561a">RB_GC_GUARD</a>(a) = args;
<a name="l01826"></a>01826     <span class="keywordflow">return</span> ret;
<a name="l01827"></a>01827 }
<a name="l01828"></a>01828 
<a name="l01829"></a>01829 <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l01830"></a><a class="code" href="../../d3/dda/proc_8c.html#ae6cec9742f1565fb6f2224572112570f">01830</a> <a class="code" href="../../db/d2e/intern_8h.html#a8a4a55d3f2ed6d9ece055553e48755d5">rb_proc_new</a>(
<a name="l01831"></a>01831     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> (*<a class="code" href="../../dc/dd1/ossl__ssl_8c.html#a131c09b7f9c9a0b52e6f79f651cfd574">func</a>)(<a class="code" href="../../d8/db0/defines_8h.html#af4fd7cbafda9af704310f78516042dfb">ANYARGS</a>), <span class="comment">/* VALUE yieldarg[, VALUE procarg] */</span>
<a name="l01832"></a>01832     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> val)
<a name="l01833"></a>01833 {
<a name="l01834"></a>01834     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> procval = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#afea09dbabdc6d85523d774fac9606e34">rb_iterate</a>(<a class="code" href="../../d3/dda/proc_8c.html#a0fc7262734605527a6cea84686888a49">mproc</a>, 0, <a class="code" href="../../dc/dd1/ossl__ssl_8c.html#a131c09b7f9c9a0b52e6f79f651cfd574">func</a>, val);
<a name="l01835"></a>01835     <span class="keywordflow">return</span> procval;
<a name="l01836"></a>01836 }
<a name="l01837"></a>01837 
<a name="l01838"></a>01838 <span class="comment">/*</span>
<a name="l01839"></a>01839 <span class="comment"> *  call-seq:</span>
<a name="l01840"></a>01840 <span class="comment"> *     meth.to_proc    -&gt; prc</span>
<a name="l01841"></a>01841 <span class="comment"> *</span>
<a name="l01842"></a>01842 <span class="comment"> *  Returns a &lt;code&gt;Proc&lt;/code&gt; object corresponding to this method.</span>
<a name="l01843"></a>01843 <span class="comment"> */</span>
<a name="l01844"></a>01844 
<a name="l01845"></a>01845 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l01846"></a><a class="code" href="../../d3/dda/proc_8c.html#a752312046aa6c7f1a85c5e3ad28bab95">01846</a> <a class="code" href="../../d3/dda/proc_8c.html#a752312046aa6c7f1a85c5e3ad28bab95">method_proc</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> method)
<a name="l01847"></a>01847 {
<a name="l01848"></a>01848     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> procval;
<a name="l01849"></a>01849     <a class="code" href="../../d5/d77/structrb__proc__t.html">rb_proc_t</a> *proc;
<a name="l01850"></a>01850     <span class="comment">/*</span>
<a name="l01851"></a>01851 <span class="comment">     * class Method</span>
<a name="l01852"></a>01852 <span class="comment">     *   def to_proc</span>
<a name="l01853"></a>01853 <span class="comment">     *     proc{|*args|</span>
<a name="l01854"></a>01854 <span class="comment">     *       self.call(*args)</span>
<a name="l01855"></a>01855 <span class="comment">     *     }</span>
<a name="l01856"></a>01856 <span class="comment">     *   end</span>
<a name="l01857"></a>01857 <span class="comment">     * end</span>
<a name="l01858"></a>01858 <span class="comment">     */</span>
<a name="l01859"></a>01859     procval = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#afea09dbabdc6d85523d774fac9606e34">rb_iterate</a>(<a class="code" href="../../d3/dda/proc_8c.html#a923da7b10a1cbca6dbfbceb0a566caab">mlambda</a>, 0, <a class="code" href="../../d3/dda/proc_8c.html#a8a4909696602de41227239b31a9ee19e">bmcall</a>, method);
<a name="l01860"></a>01860     <a class="code" href="../../d8/d32/vm__core_8h.html#ad9cb04a311c21bdbbd936d8f8b7237db">GetProcPtr</a>(procval, proc);
<a name="l01861"></a>01861     proc-&gt;<a class="code" href="../../d5/d77/structrb__proc__t.html#ab758491302d7ae34dba60f7c39b97c95">is_from_method</a> = 1;
<a name="l01862"></a>01862     <span class="keywordflow">return</span> procval;
<a name="l01863"></a>01863 }
<a name="l01864"></a>01864 
<a name="l01865"></a>01865 <span class="comment">/*</span>
<a name="l01866"></a>01866 <span class="comment"> * call_seq:</span>
<a name="l01867"></a>01867 <span class="comment"> *   local_jump_error.exit_value  -&gt; obj</span>
<a name="l01868"></a>01868 <span class="comment"> *</span>
<a name="l01869"></a>01869 <span class="comment"> * Returns the exit value associated with this +LocalJumpError+.</span>
<a name="l01870"></a>01870 <span class="comment"> */</span>
<a name="l01871"></a>01871 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l01872"></a><a class="code" href="../../d3/dda/proc_8c.html#a409dadf390708ff4572168b8c2d14c44">01872</a> <a class="code" href="../../d3/dda/proc_8c.html#a409dadf390708ff4572168b8c2d14c44">localjump_xvalue</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> exc)
<a name="l01873"></a>01873 {
<a name="l01874"></a>01874     <span class="keywordflow">return</span> <a class="code" href="../../db/d2e/intern_8h.html#ad05f3639fd927a08b07d12e2960936d4">rb_iv_get</a>(exc, <span class="stringliteral">&quot;@exit_value&quot;</span>);
<a name="l01875"></a>01875 }
<a name="l01876"></a>01876 
<a name="l01877"></a>01877 <span class="comment">/*</span>
<a name="l01878"></a>01878 <span class="comment"> * call-seq:</span>
<a name="l01879"></a>01879 <span class="comment"> *    local_jump_error.reason   -&gt; symbol</span>
<a name="l01880"></a>01880 <span class="comment"> *</span>
<a name="l01881"></a>01881 <span class="comment"> * The reason this block was terminated:</span>
<a name="l01882"></a>01882 <span class="comment"> * :break, :redo, :retry, :next, :return, or :noreason.</span>
<a name="l01883"></a>01883 <span class="comment"> */</span>
<a name="l01884"></a>01884 
<a name="l01885"></a>01885 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l01886"></a><a class="code" href="../../d3/dda/proc_8c.html#a876679fbfe4b9bff0c26c6728114aba2">01886</a> <a class="code" href="../../d3/dda/proc_8c.html#a876679fbfe4b9bff0c26c6728114aba2">localjump_reason</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> exc)
<a name="l01887"></a>01887 {
<a name="l01888"></a>01888     <span class="keywordflow">return</span> <a class="code" href="../../db/d2e/intern_8h.html#ad05f3639fd927a08b07d12e2960936d4">rb_iv_get</a>(exc, <span class="stringliteral">&quot;@reason&quot;</span>);
<a name="l01889"></a>01889 }
<a name="l01890"></a>01890 
<a name="l01891"></a>01891 <span class="comment">/*</span>
<a name="l01892"></a>01892 <span class="comment"> *  call-seq:</span>
<a name="l01893"></a>01893 <span class="comment"> *     prc.binding    -&gt; binding</span>
<a name="l01894"></a>01894 <span class="comment"> *</span>
<a name="l01895"></a>01895 <span class="comment"> *  Returns the binding associated with &lt;i&gt;prc&lt;/i&gt;. Note that</span>
<a name="l01896"></a>01896 <span class="comment"> *  &lt;code&gt;Kernel#eval&lt;/code&gt; accepts either a &lt;code&gt;Proc&lt;/code&gt; or a</span>
<a name="l01897"></a>01897 <span class="comment"> *  &lt;code&gt;Binding&lt;/code&gt; object as its second parameter.</span>
<a name="l01898"></a>01898 <span class="comment"> *</span>
<a name="l01899"></a>01899 <span class="comment"> *     def fred(param)</span>
<a name="l01900"></a>01900 <span class="comment"> *       proc {}</span>
<a name="l01901"></a>01901 <span class="comment"> *     end</span>
<a name="l01902"></a>01902 <span class="comment"> *</span>
<a name="l01903"></a>01903 <span class="comment"> *     b = fred(99)</span>
<a name="l01904"></a>01904 <span class="comment"> *     eval(&quot;param&quot;, b.binding)   #=&gt; 99</span>
<a name="l01905"></a>01905 <span class="comment"> */</span>
<a name="l01906"></a>01906 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l01907"></a><a class="code" href="../../d3/dda/proc_8c.html#a675c412cbe69064e78a7e71540ae22ef">01907</a> <a class="code" href="../../d3/dda/proc_8c.html#a675c412cbe69064e78a7e71540ae22ef">proc_binding</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <span class="keyword">self</span>)
<a name="l01908"></a>01908 {
<a name="l01909"></a>01909     <a class="code" href="../../d5/d77/structrb__proc__t.html">rb_proc_t</a> *proc;
<a name="l01910"></a>01910     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> bindval;
<a name="l01911"></a>01911     <a class="code" href="../../d3/d76/structrb__binding__t.html">rb_binding_t</a> *bind;
<a name="l01912"></a>01912 
<a name="l01913"></a>01913     <a class="code" href="../../d8/d32/vm__core_8h.html#ad9cb04a311c21bdbbd936d8f8b7237db">GetProcPtr</a>(<span class="keyword">self</span>, proc);
<a name="l01914"></a>01914     <span class="keywordflow">if</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a394faf7191f18552a20cb17ce14226f0">TYPE</a>(proc-&gt;<a class="code" href="../../d5/d77/structrb__proc__t.html#acf80b0e350012548c28cba1ea64a7a6e">block</a>.<a class="code" href="../../da/dc0/structrb__block__struct.html#a8e2b3b9218b4a184f198872404e81605">iseq</a>) == <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a5f1cc49c4da51d5bdffa64be79ff6fb0">T_NODE</a>) {
<a name="l01915"></a>01915         <span class="keywordflow">if</span> (!<a class="code" href="../../d3/dda/proc_8c.html#a1a518cf87411d1e474335ddb66091741">IS_METHOD_PROC_NODE</a>((NODE *)proc-&gt;<a class="code" href="../../d5/d77/structrb__proc__t.html#acf80b0e350012548c28cba1ea64a7a6e">block</a>.<a class="code" href="../../da/dc0/structrb__block__struct.html#a8e2b3b9218b4a184f198872404e81605">iseq</a>)) {
<a name="l01916"></a>01916             <a class="code" href="../../db/dcc/error_8c.html#a0f771a2840561f1838169b3d7d4616f3">rb_raise</a>(<a class="code" href="../../db/dcc/error_8c.html#ab5e2a9fec766c75176fbb262bfe6a596">rb_eArgError</a>, <span class="stringliteral">&quot;Can&apos;t create Binding from C level Proc&quot;</span>);
<a name="l01917"></a>01917         }
<a name="l01918"></a>01918     }
<a name="l01919"></a>01919 
<a name="l01920"></a>01920     bindval = <a class="code" href="../../d3/dda/proc_8c.html#ae3a34a34187caef2f3225b4bf75ff56b">binding_alloc</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#ad07e23922ca1fa3e87647edf4fab6d38">rb_cBinding</a>);
<a name="l01921"></a>01921     <a class="code" href="../../d8/d32/vm__core_8h.html#a491d77ec5480e1530e447dbb42481f5b">GetBindingPtr</a>(bindval, bind);
<a name="l01922"></a>01922     bind-&gt;<a class="code" href="../../d3/d76/structrb__binding__t.html#a65f58a22eb376363f727c34b7fde7400">env</a> = proc-&gt;<a class="code" href="../../d5/d77/structrb__proc__t.html#acdb9a8c85422bf299615f7942ffbc916">envval</a>;
<a name="l01923"></a>01923     <span class="keywordflow">if</span> (<a class="code" href="../../d8/d32/vm__core_8h.html#a79d03ad9b9cf8b7a8ca2b849e495a74f">RUBY_VM_NORMAL_ISEQ_P</a>(proc-&gt;<a class="code" href="../../d5/d77/structrb__proc__t.html#acf80b0e350012548c28cba1ea64a7a6e">block</a>.<a class="code" href="../../da/dc0/structrb__block__struct.html#a8e2b3b9218b4a184f198872404e81605">iseq</a>)) {
<a name="l01924"></a>01924         bind-&gt;<a class="code" href="../../d3/d76/structrb__binding__t.html#a5a10eb6f5295cb4561fd868122acdd56">filename</a> = proc-&gt;<a class="code" href="../../d5/d77/structrb__proc__t.html#acf80b0e350012548c28cba1ea64a7a6e">block</a>.<a class="code" href="../../da/dc0/structrb__block__struct.html#a8e2b3b9218b4a184f198872404e81605">iseq</a>-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a06859fa5de56f2ede3cb692f1d9215e2">filename</a>;
<a name="l01925"></a>01925         bind-&gt;<a class="code" href="../../d3/d76/structrb__binding__t.html#a22c208816904df3cefa5ebfa8fe3fd58">line_no</a> = <a class="code" href="../../dd/d74/iseq_8c.html#a2bf706296b2f128f187282d9594fb8ee">rb_iseq_first_lineno</a>(proc-&gt;<a class="code" href="../../d5/d77/structrb__proc__t.html#acf80b0e350012548c28cba1ea64a7a6e">block</a>.<a class="code" href="../../da/dc0/structrb__block__struct.html#a8e2b3b9218b4a184f198872404e81605">iseq</a>);
<a name="l01926"></a>01926     }
<a name="l01927"></a>01927     <span class="keywordflow">else</span> {
<a name="l01928"></a>01928         bind-&gt;<a class="code" href="../../d3/d76/structrb__binding__t.html#a5a10eb6f5295cb4561fd868122acdd56">filename</a> = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a320970f989dc8294c8203154e3db40c1">Qnil</a>;
<a name="l01929"></a>01929         bind-&gt;<a class="code" href="../../d3/d76/structrb__binding__t.html#a22c208816904df3cefa5ebfa8fe3fd58">line_no</a> = 0;
<a name="l01930"></a>01930     }
<a name="l01931"></a>01931     <span class="keywordflow">return</span> bindval;
<a name="l01932"></a>01932 }
<a name="l01933"></a>01933 
<a name="l01934"></a>01934 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <a class="code" href="../../d3/dda/proc_8c.html#a501387892518c4c9e5837eae15d9c8f8">curry</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> dummy, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <a class="code" href="../../d3/d09/ripper_8y.html#a8187411843a6284ffb964ef3fb9fcab3">args</a>, <span class="keywordtype">int</span> argc, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> *<a class="code" href="../../df/d77/ruby_8c.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> passed_proc);
<a name="l01935"></a>01935 
<a name="l01936"></a>01936 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l01937"></a><a class="code" href="../../d3/dda/proc_8c.html#a839c511bc76ee26df68ac44aa694d2f1">01937</a> <a class="code" href="../../d3/dda/proc_8c.html#a839c511bc76ee26df68ac44aa694d2f1">make_curry_proc</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> proc, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> passed, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> arity)
<a name="l01938"></a>01938 {
<a name="l01939"></a>01939     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <a class="code" href="../../d3/d09/ripper_8y.html#a8187411843a6284ffb964ef3fb9fcab3">args</a> = <a class="code" href="../../dc/dcc/array_8c.html#a8317ecd6a0abb5ad08c50c732f30059b">rb_ary_new3</a>(3, proc, passed, arity);
<a name="l01940"></a>01940     <a class="code" href="../../d5/d77/structrb__proc__t.html">rb_proc_t</a> *procp;
<a name="l01941"></a>01941     <span class="keywordtype">int</span> is_lambda;
<a name="l01942"></a>01942 
<a name="l01943"></a>01943     <a class="code" href="../../d8/d32/vm__core_8h.html#ad9cb04a311c21bdbbd936d8f8b7237db">GetProcPtr</a>(proc, procp);
<a name="l01944"></a>01944     is_lambda = procp-&gt;<a class="code" href="../../d5/d77/structrb__proc__t.html#a7ec13535f2806b214e34a7db8460056b">is_lambda</a>;
<a name="l01945"></a>01945     <a class="code" href="../../dc/dcc/array_8c.html#a5c9cea42948e39b586c78aacdf65fc08">rb_ary_freeze</a>(passed);
<a name="l01946"></a>01946     <a class="code" href="../../dc/dcc/array_8c.html#a5c9cea42948e39b586c78aacdf65fc08">rb_ary_freeze</a>(args);
<a name="l01947"></a>01947     proc = <a class="code" href="../../db/d2e/intern_8h.html#a8a4a55d3f2ed6d9ece055553e48755d5">rb_proc_new</a>(<a class="code" href="../../d3/dda/proc_8c.html#a501387892518c4c9e5837eae15d9c8f8">curry</a>, args);
<a name="l01948"></a>01948     <a class="code" href="../../d8/d32/vm__core_8h.html#ad9cb04a311c21bdbbd936d8f8b7237db">GetProcPtr</a>(proc, procp);
<a name="l01949"></a>01949     procp-&gt;<a class="code" href="../../d5/d77/structrb__proc__t.html#a7ec13535f2806b214e34a7db8460056b">is_lambda</a> = is_lambda;
<a name="l01950"></a>01950     <span class="keywordflow">return</span> proc;
<a name="l01951"></a>01951 }
<a name="l01952"></a>01952 
<a name="l01953"></a>01953 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l01954"></a><a class="code" href="../../d3/dda/proc_8c.html#a501387892518c4c9e5837eae15d9c8f8">01954</a> <a class="code" href="../../d3/dda/proc_8c.html#a501387892518c4c9e5837eae15d9c8f8">curry</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> dummy, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <a class="code" href="../../d3/d09/ripper_8y.html#a8187411843a6284ffb964ef3fb9fcab3">args</a>, <span class="keywordtype">int</span> argc, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> *<a class="code" href="../../df/d77/ruby_8c.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> passed_proc)
<a name="l01955"></a>01955 {
<a name="l01956"></a>01956     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> proc, passed, arity;
<a name="l01957"></a>01957     proc = <a class="code" href="../../d8/df4/generator_8h.html#abb794fe2d7c73eea87e7ba2273939a8e">RARRAY_PTR</a>(args)[0];
<a name="l01958"></a>01958     passed = <a class="code" href="../../d8/df4/generator_8h.html#abb794fe2d7c73eea87e7ba2273939a8e">RARRAY_PTR</a>(args)[1];
<a name="l01959"></a>01959     arity = <a class="code" href="../../d8/df4/generator_8h.html#abb794fe2d7c73eea87e7ba2273939a8e">RARRAY_PTR</a>(args)[2];
<a name="l01960"></a>01960 
<a name="l01961"></a>01961     passed = <a class="code" href="../../dc/dcc/array_8c.html#ac236ce3676b98965f6ac36aab0a39401">rb_ary_plus</a>(passed, <a class="code" href="../../dc/dcc/array_8c.html#a575a99eebf6ce65893ed83c2b6783d2d">rb_ary_new4</a>(argc, argv));
<a name="l01962"></a>01962     <a class="code" href="../../dc/dcc/array_8c.html#a5c9cea42948e39b586c78aacdf65fc08">rb_ary_freeze</a>(passed);
<a name="l01963"></a>01963 
<a name="l01964"></a>01964     <span class="keywordflow">if</span> (<a class="code" href="../../d8/df4/generator_8h.html#ae988773ed219452578f881fc7189c486">RARRAY_LEN</a>(passed) &lt; <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a9444c431b3cb1184e7523fc572f2c758">FIX2INT</a>(arity)) {
<a name="l01965"></a>01965         <span class="keywordflow">if</span> (!<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a4832bad8845a35fc50f7a160901854a1">NIL_P</a>(passed_proc)) {
<a name="l01966"></a>01966             <a class="code" href="../../db/dcc/error_8c.html#aa5b1972d475e9a090c8ef607ce033008">rb_warn</a>(<span class="stringliteral">&quot;given block not used&quot;</span>);
<a name="l01967"></a>01967         }
<a name="l01968"></a>01968         arity = <a class="code" href="../../d3/dda/proc_8c.html#a839c511bc76ee26df68ac44aa694d2f1">make_curry_proc</a>(proc, passed, arity);
<a name="l01969"></a>01969         <span class="keywordflow">return</span> arity;
<a name="l01970"></a>01970     }
<a name="l01971"></a>01971     <span class="keywordflow">else</span> {
<a name="l01972"></a>01972         <span class="keywordflow">return</span> <a class="code" href="../../db/d2e/intern_8h.html#a55046c9120a3018843e93b629445953e">rb_proc_call_with_block</a>(proc, <a class="code" href="../../d3/dda/proc_8c.html#a4200f9fe2afc8140313fbc922d98d258">check_argc</a>(<a class="code" href="../../d8/df4/generator_8h.html#ae988773ed219452578f881fc7189c486">RARRAY_LEN</a>(passed)),
<a name="l01973"></a>01973                                        <a class="code" href="../../d8/df4/generator_8h.html#abb794fe2d7c73eea87e7ba2273939a8e">RARRAY_PTR</a>(passed), passed_proc);
<a name="l01974"></a>01974     }
<a name="l01975"></a>01975 }
<a name="l01976"></a>01976 
<a name="l01977"></a>01977  <span class="comment">/*</span>
<a name="l01978"></a>01978 <span class="comment">  *  call-seq:</span>
<a name="l01979"></a>01979 <span class="comment">  *     prc.curry         -&gt; a_proc</span>
<a name="l01980"></a>01980 <span class="comment">  *     prc.curry(arity)  -&gt; a_proc</span>
<a name="l01981"></a>01981 <span class="comment">  *</span>
<a name="l01982"></a>01982 <span class="comment">  *  Returns a curried proc. If the optional &lt;i&gt;arity&lt;/i&gt; argument is given,</span>
<a name="l01983"></a>01983 <span class="comment">  *  it determines the number of arguments.</span>
<a name="l01984"></a>01984 <span class="comment">  *  A curried proc receives some arguments. If a sufficient number of</span>
<a name="l01985"></a>01985 <span class="comment">  *  arguments are supplied, it passes the supplied arguments to the original</span>
<a name="l01986"></a>01986 <span class="comment">  *  proc and returns the result. Otherwise, returns another curried proc that</span>
<a name="l01987"></a>01987 <span class="comment">  *  takes the rest of arguments.</span>
<a name="l01988"></a>01988 <span class="comment">  *</span>
<a name="l01989"></a>01989 <span class="comment">  *     b = proc {|x, y, z| (x||0) + (y||0) + (z||0) }</span>
<a name="l01990"></a>01990 <span class="comment">  *     p b.curry[1][2][3]           #=&gt; 6</span>
<a name="l01991"></a>01991 <span class="comment">  *     p b.curry[1, 2][3, 4]        #=&gt; 6</span>
<a name="l01992"></a>01992 <span class="comment">  *     p b.curry(5)[1][2][3][4][5]  #=&gt; 6</span>
<a name="l01993"></a>01993 <span class="comment">  *     p b.curry(5)[1, 2][3, 4][5]  #=&gt; 6</span>
<a name="l01994"></a>01994 <span class="comment">  *     p b.curry(1)[1]              #=&gt; 1</span>
<a name="l01995"></a>01995 <span class="comment">  *</span>
<a name="l01996"></a>01996 <span class="comment">  *     b = proc {|x, y, z, *w| (x||0) + (y||0) + (z||0) + w.inject(0, &amp;:+) }</span>
<a name="l01997"></a>01997 <span class="comment">  *     p b.curry[1][2][3]           #=&gt; 6</span>
<a name="l01998"></a>01998 <span class="comment">  *     p b.curry[1, 2][3, 4]        #=&gt; 10</span>
<a name="l01999"></a>01999 <span class="comment">  *     p b.curry(5)[1][2][3][4][5]  #=&gt; 15</span>
<a name="l02000"></a>02000 <span class="comment">  *     p b.curry(5)[1, 2][3, 4][5]  #=&gt; 15</span>
<a name="l02001"></a>02001 <span class="comment">  *     p b.curry(1)[1]              #=&gt; 1</span>
<a name="l02002"></a>02002 <span class="comment">  *</span>
<a name="l02003"></a>02003 <span class="comment">  *     b = lambda {|x, y, z| (x||0) + (y||0) + (z||0) }</span>
<a name="l02004"></a>02004 <span class="comment">  *     p b.curry[1][2][3]           #=&gt; 6</span>
<a name="l02005"></a>02005 <span class="comment">  *     p b.curry[1, 2][3, 4]        #=&gt; wrong number of arguments (4 for 3)</span>
<a name="l02006"></a>02006 <span class="comment">  *     p b.curry(5)                 #=&gt; wrong number of arguments (5 for 3)</span>
<a name="l02007"></a>02007 <span class="comment">  *     p b.curry(1)                 #=&gt; wrong number of arguments (1 for 3)</span>
<a name="l02008"></a>02008 <span class="comment">  *</span>
<a name="l02009"></a>02009 <span class="comment">  *     b = lambda {|x, y, z, *w| (x||0) + (y||0) + (z||0) + w.inject(0, &amp;:+) }</span>
<a name="l02010"></a>02010 <span class="comment">  *     p b.curry[1][2][3]           #=&gt; 6</span>
<a name="l02011"></a>02011 <span class="comment">  *     p b.curry[1, 2][3, 4]        #=&gt; 10</span>
<a name="l02012"></a>02012 <span class="comment">  *     p b.curry(5)[1][2][3][4][5]  #=&gt; 15</span>
<a name="l02013"></a>02013 <span class="comment">  *     p b.curry(5)[1, 2][3, 4][5]  #=&gt; 15</span>
<a name="l02014"></a>02014 <span class="comment">  *     p b.curry(1)                 #=&gt; wrong number of arguments (1 for 3)</span>
<a name="l02015"></a>02015 <span class="comment">  *</span>
<a name="l02016"></a>02016 <span class="comment">  *     b = proc { :foo }</span>
<a name="l02017"></a>02017 <span class="comment">  *     p b.curry[]                  #=&gt; :foo</span>
<a name="l02018"></a>02018 <span class="comment">  */</span>
<a name="l02019"></a>02019 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l02020"></a><a class="code" href="../../d3/dda/proc_8c.html#ac760a8e9d65cf3bd421830ef5ddd828b">02020</a> <a class="code" href="../../d3/dda/proc_8c.html#ac760a8e9d65cf3bd421830ef5ddd828b">proc_curry</a>(<span class="keywordtype">int</span> argc, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> *<a class="code" href="../../df/d77/ruby_8c.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <span class="keyword">self</span>)
<a name="l02021"></a>02021 {
<a name="l02022"></a>02022     <span class="keywordtype">int</span> sarity, marity = <a class="code" href="../../db/d2e/intern_8h.html#a2d07fdb0461b17bb54671e2cbc5778d8">rb_proc_arity</a>(<span class="keyword">self</span>);
<a name="l02023"></a>02023     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> arity, opt = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aba0717d2689eb68797421a02ab9295c6">Qfalse</a>;
<a name="l02024"></a>02024 
<a name="l02025"></a>02025     <span class="keywordflow">if</span> (marity &lt; 0) {
<a name="l02026"></a>02026         marity = -marity - 1;
<a name="l02027"></a>02027         opt = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aacea3516b33941ce8149098e223a7466">Qtrue</a>;
<a name="l02028"></a>02028     }
<a name="l02029"></a>02029 
<a name="l02030"></a>02030     <a class="code" href="../../d7/d19/group__defmethod.html#gaa7bed88640f01bee619f85fda09d28d7">rb_scan_args</a>(argc, argv, <span class="stringliteral">&quot;01&quot;</span>, &amp;arity);
<a name="l02031"></a>02031     <span class="keywordflow">if</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a4832bad8845a35fc50f7a160901854a1">NIL_P</a>(arity)) {
<a name="l02032"></a>02032         arity = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(marity);
<a name="l02033"></a>02033     }
<a name="l02034"></a>02034     <span class="keywordflow">else</span> {
<a name="l02035"></a>02035         sarity = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a9444c431b3cb1184e7523fc572f2c758">FIX2INT</a>(arity);
<a name="l02036"></a>02036         <span class="keywordflow">if</span> (<a class="code" href="../../db/d2e/intern_8h.html#a9a96293850077b10b7da7df2fef00df6">rb_proc_lambda_p</a>(<span class="keyword">self</span>) &amp;&amp; (sarity &lt; marity || (sarity &gt; marity &amp;&amp; !opt))) {
<a name="l02037"></a>02037             <a class="code" href="../../db/dcc/error_8c.html#a0f771a2840561f1838169b3d7d4616f3">rb_raise</a>(<a class="code" href="../../db/dcc/error_8c.html#ab5e2a9fec766c75176fbb262bfe6a596">rb_eArgError</a>, <span class="stringliteral">&quot;wrong number of arguments (%d for %d)&quot;</span>, sarity, marity);
<a name="l02038"></a>02038         }
<a name="l02039"></a>02039     }
<a name="l02040"></a>02040 
<a name="l02041"></a>02041     <span class="keywordflow">return</span> <a class="code" href="../../d3/dda/proc_8c.html#a839c511bc76ee26df68ac44aa694d2f1">make_curry_proc</a>(<span class="keyword">self</span>, <a class="code" href="../../dc/dcc/array_8c.html#a9518114fd36cb4ef4656ec1dc63348c9">rb_ary_new</a>(), arity);
<a name="l02042"></a>02042 }
<a name="l02043"></a>02043 
<a name="l02044"></a>02044 <span class="comment">/*</span>
<a name="l02045"></a>02045 <span class="comment"> *  Document-class: LocalJumpError</span>
<a name="l02046"></a>02046 <span class="comment"> *</span>
<a name="l02047"></a>02047 <span class="comment"> *  Raised when Ruby can&apos;t yield as requested.</span>
<a name="l02048"></a>02048 <span class="comment"> *</span>
<a name="l02049"></a>02049 <span class="comment"> *  A typical scenario is attempting to yield when no block is given:</span>
<a name="l02050"></a>02050 <span class="comment"> *</span>
<a name="l02051"></a>02051 <span class="comment"> *     def call_block</span>
<a name="l02052"></a>02052 <span class="comment"> *       yield 42</span>
<a name="l02053"></a>02053 <span class="comment"> *     end</span>
<a name="l02054"></a>02054 <span class="comment"> *     call_block</span>
<a name="l02055"></a>02055 <span class="comment"> *</span>
<a name="l02056"></a>02056 <span class="comment"> *  &lt;em&gt;raises the exception:&lt;/em&gt;</span>
<a name="l02057"></a>02057 <span class="comment"> *</span>
<a name="l02058"></a>02058 <span class="comment"> *     LocalJumpError: no block given (yield)</span>
<a name="l02059"></a>02059 <span class="comment"> *</span>
<a name="l02060"></a>02060 <span class="comment"> *  A more subtle example:</span>
<a name="l02061"></a>02061 <span class="comment"> *</span>
<a name="l02062"></a>02062 <span class="comment"> *     def get_me_a_return</span>
<a name="l02063"></a>02063 <span class="comment"> *       Proc.new { return 42 }</span>
<a name="l02064"></a>02064 <span class="comment"> *     end</span>
<a name="l02065"></a>02065 <span class="comment"> *     get_me_a_return.call</span>
<a name="l02066"></a>02066 <span class="comment"> *</span>
<a name="l02067"></a>02067 <span class="comment"> *  &lt;em&gt;raises the exception:&lt;/em&gt;</span>
<a name="l02068"></a>02068 <span class="comment"> *</span>
<a name="l02069"></a>02069 <span class="comment"> *     LocalJumpError: unexpected return</span>
<a name="l02070"></a>02070 <span class="comment"> */</span>
<a name="l02071"></a>02071 
<a name="l02072"></a>02072 <span class="comment">/*</span>
<a name="l02073"></a>02073 <span class="comment"> *  Document-class: SystemStackError</span>
<a name="l02074"></a>02074 <span class="comment"> *</span>
<a name="l02075"></a>02075 <span class="comment"> *  Raised in case of a stack overflow.</span>
<a name="l02076"></a>02076 <span class="comment"> *</span>
<a name="l02077"></a>02077 <span class="comment"> *     def me_myself_and_i</span>
<a name="l02078"></a>02078 <span class="comment"> *       me_myself_and_i</span>
<a name="l02079"></a>02079 <span class="comment"> *     end</span>
<a name="l02080"></a>02080 <span class="comment"> *     me_myself_and_i</span>
<a name="l02081"></a>02081 <span class="comment"> *</span>
<a name="l02082"></a>02082 <span class="comment"> *  &lt;em&gt;raises the exception:&lt;/em&gt;</span>
<a name="l02083"></a>02083 <span class="comment"> *</span>
<a name="l02084"></a>02084 <span class="comment"> *    SystemStackError: stack level too deep</span>
<a name="l02085"></a>02085 <span class="comment"> */</span>
<a name="l02086"></a>02086 
<a name="l02087"></a>02087 <span class="comment">/*</span>
<a name="l02088"></a>02088 <span class="comment"> *  &lt;code&gt;Proc&lt;/code&gt; objects are blocks of code that have been bound to</span>
<a name="l02089"></a>02089 <span class="comment"> *  a set of local variables. Once bound, the code may be called in</span>
<a name="l02090"></a>02090 <span class="comment"> *  different contexts and still access those variables.</span>
<a name="l02091"></a>02091 <span class="comment"> *</span>
<a name="l02092"></a>02092 <span class="comment"> *     def gen_times(factor)</span>
<a name="l02093"></a>02093 <span class="comment"> *       return Proc.new {|n| n*factor }</span>
<a name="l02094"></a>02094 <span class="comment"> *     end</span>
<a name="l02095"></a>02095 <span class="comment"> *</span>
<a name="l02096"></a>02096 <span class="comment"> *     times3 = gen_times(3)</span>
<a name="l02097"></a>02097 <span class="comment"> *     times5 = gen_times(5)</span>
<a name="l02098"></a>02098 <span class="comment"> *</span>
<a name="l02099"></a>02099 <span class="comment"> *     times3.call(12)               #=&gt; 36</span>
<a name="l02100"></a>02100 <span class="comment"> *     times5.call(5)                #=&gt; 25</span>
<a name="l02101"></a>02101 <span class="comment"> *     times3.call(times5.call(4))   #=&gt; 60</span>
<a name="l02102"></a>02102 <span class="comment"> *</span>
<a name="l02103"></a>02103 <span class="comment"> */</span>
<a name="l02104"></a>02104 
<a name="l02105"></a>02105 <span class="keywordtype">void</span>
<a name="l02106"></a><a class="code" href="../../d3/dda/proc_8c.html#a012dfbcf7f1355e52239132b688b25fd">02106</a> <a class="code" href="../../d3/dda/proc_8c.html#a012dfbcf7f1355e52239132b688b25fd">Init_Proc</a>(<span class="keywordtype">void</span>)
<a name="l02107"></a>02107 {
<a name="l02108"></a>02108     <span class="comment">/* Proc */</span>
<a name="l02109"></a>02109     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#abd0d5fa9d171dbf020e85958391437f9">rb_cProc</a> = <a class="code" href="../../de/ddf/group__class.html#ga15d068dbe88a3bab3700b03bebb7fbac" title="Defines a top-level class.">rb_define_class</a>(<span class="stringliteral">&quot;Proc&quot;</span>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a57c96ead3ef230b4838e65fe037c346e">rb_cObject</a>);
<a name="l02110"></a>02110     <a class="code" href="../../db/d2e/intern_8h.html#ad38ee02dc6ba34e3d05a60bac4a900f8">rb_undef_alloc_func</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#abd0d5fa9d171dbf020e85958391437f9">rb_cProc</a>);
<a name="l02111"></a>02111     <a class="code" href="../../d7/d19/group__defmethod.html#gaacfe6a2ec444bdc7f573afb75ea251fe" title="Defines a singleton method for obj.">rb_define_singleton_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#abd0d5fa9d171dbf020e85958391437f9">rb_cProc</a>, <span class="stringliteral">&quot;new&quot;</span>, <a class="code" href="../../d3/dda/proc_8c.html#af949462992fdb218af024db37354675c">rb_proc_s_new</a>, -1);
<a name="l02112"></a>02112 
<a name="l02113"></a>02113 <span class="preprocessor">#if 0 </span><span class="comment">/* incomplete. */</span>
<a name="l02114"></a>02114     <a class="code" href="../../db/d0a/method_8h.html#af24b4bc2104eeb955b312d41bb492c5c">rb_add_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#abd0d5fa9d171dbf020e85958391437f9">rb_cProc</a>, <a class="code" href="../../dc/dcc/array_8c.html#a9cfa42d4b79c89d68c53be8b2150a503">rb_intern</a>(<span class="stringliteral">&quot;call&quot;</span>), <a class="code" href="../../db/d0a/method_8h.html#a88a981f6cc69187ed9c2de2630a1687aa2eada169dedcc0ee758832fca8dffd2a">VM_METHOD_TYPE_OPTIMIZED</a>,
<a name="l02115"></a>02115                   (<span class="keywordtype">void</span> *)OPTIMIZED_METHOD_TYPE_CALL, 0);
<a name="l02116"></a>02116     <a class="code" href="../../db/d0a/method_8h.html#af24b4bc2104eeb955b312d41bb492c5c">rb_add_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#abd0d5fa9d171dbf020e85958391437f9">rb_cProc</a>, <a class="code" href="../../dc/dcc/array_8c.html#a9cfa42d4b79c89d68c53be8b2150a503">rb_intern</a>(<span class="stringliteral">&quot;[]&quot;</span>), <a class="code" href="../../db/d0a/method_8h.html#a88a981f6cc69187ed9c2de2630a1687aa2eada169dedcc0ee758832fca8dffd2a">VM_METHOD_TYPE_OPTIMIZED</a>,
<a name="l02117"></a>02117                   (<span class="keywordtype">void</span> *)OPTIMIZED_METHOD_TYPE_CALL, 0);
<a name="l02118"></a>02118     <a class="code" href="../../db/d0a/method_8h.html#af24b4bc2104eeb955b312d41bb492c5c">rb_add_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#abd0d5fa9d171dbf020e85958391437f9">rb_cProc</a>, <a class="code" href="../../dc/dcc/array_8c.html#a9cfa42d4b79c89d68c53be8b2150a503">rb_intern</a>(<span class="stringliteral">&quot;===&quot;</span>), <a class="code" href="../../db/d0a/method_8h.html#a88a981f6cc69187ed9c2de2630a1687aa2eada169dedcc0ee758832fca8dffd2a">VM_METHOD_TYPE_OPTIMIZED</a>,
<a name="l02119"></a>02119                   (<span class="keywordtype">void</span> *)OPTIMIZED_METHOD_TYPE_CALL, 0);
<a name="l02120"></a>02120     <a class="code" href="../../db/d0a/method_8h.html#af24b4bc2104eeb955b312d41bb492c5c">rb_add_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#abd0d5fa9d171dbf020e85958391437f9">rb_cProc</a>, <a class="code" href="../../dc/dcc/array_8c.html#a9cfa42d4b79c89d68c53be8b2150a503">rb_intern</a>(<span class="stringliteral">&quot;yield&quot;</span>), <a class="code" href="../../db/d0a/method_8h.html#a88a981f6cc69187ed9c2de2630a1687aa2eada169dedcc0ee758832fca8dffd2a">VM_METHOD_TYPE_OPTIMIZED</a>,
<a name="l02121"></a>02121                   (<span class="keywordtype">void</span> *)OPTIMIZED_METHOD_TYPE_CALL, 0);
<a name="l02122"></a>02122 <span class="preprocessor">#else</span>
<a name="l02123"></a>02123 <span class="preprocessor"></span>    <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#abd0d5fa9d171dbf020e85958391437f9">rb_cProc</a>, <span class="stringliteral">&quot;call&quot;</span>, <a class="code" href="../../d3/dda/proc_8c.html#a5640ece4bd96326864dcd4beaec4bdc5">proc_call</a>, -1);
<a name="l02124"></a>02124     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#abd0d5fa9d171dbf020e85958391437f9">rb_cProc</a>, <span class="stringliteral">&quot;[]&quot;</span>, <a class="code" href="../../d3/dda/proc_8c.html#a5640ece4bd96326864dcd4beaec4bdc5">proc_call</a>, -1);
<a name="l02125"></a>02125     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#abd0d5fa9d171dbf020e85958391437f9">rb_cProc</a>, <span class="stringliteral">&quot;===&quot;</span>, <a class="code" href="../../d3/dda/proc_8c.html#a5640ece4bd96326864dcd4beaec4bdc5">proc_call</a>, -1);
<a name="l02126"></a>02126     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#abd0d5fa9d171dbf020e85958391437f9">rb_cProc</a>, <span class="stringliteral">&quot;yield&quot;</span>, <a class="code" href="../../d3/dda/proc_8c.html#a5640ece4bd96326864dcd4beaec4bdc5">proc_call</a>, -1);
<a name="l02127"></a>02127 <span class="preprocessor">#endif</span>
<a name="l02128"></a>02128 <span class="preprocessor"></span>    <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#abd0d5fa9d171dbf020e85958391437f9">rb_cProc</a>, <span class="stringliteral">&quot;to_proc&quot;</span>, <a class="code" href="../../d3/dda/proc_8c.html#ae78cccc514c03fdca2da79fe525890e8">proc_to_proc</a>, 0);
<a name="l02129"></a>02129     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#abd0d5fa9d171dbf020e85958391437f9">rb_cProc</a>, <span class="stringliteral">&quot;arity&quot;</span>, <a class="code" href="../../d3/dda/proc_8c.html#a4147fc7a7a93445816658c810dbac43e">proc_arity</a>, 0);
<a name="l02130"></a>02130     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#abd0d5fa9d171dbf020e85958391437f9">rb_cProc</a>, <span class="stringliteral">&quot;clone&quot;</span>, <a class="code" href="../../d3/dda/proc_8c.html#aeaab69bcd87e28863c939732d726cad1">proc_clone</a>, 0);
<a name="l02131"></a>02131     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#abd0d5fa9d171dbf020e85958391437f9">rb_cProc</a>, <span class="stringliteral">&quot;dup&quot;</span>, <a class="code" href="../../d3/dda/proc_8c.html#ac612f38db3a5646950553e152b878bda">proc_dup</a>, 0);
<a name="l02132"></a>02132     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#abd0d5fa9d171dbf020e85958391437f9">rb_cProc</a>, <span class="stringliteral">&quot;==&quot;</span>, <a class="code" href="../../d3/dda/proc_8c.html#ac8bf103785a400842c43af3db3a6e6a8">proc_eq</a>, 1);
<a name="l02133"></a>02133     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#abd0d5fa9d171dbf020e85958391437f9">rb_cProc</a>, <span class="stringliteral">&quot;eql?&quot;</span>, <a class="code" href="../../d3/dda/proc_8c.html#ac8bf103785a400842c43af3db3a6e6a8">proc_eq</a>, 1);
<a name="l02134"></a>02134     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#abd0d5fa9d171dbf020e85958391437f9">rb_cProc</a>, <span class="stringliteral">&quot;hash&quot;</span>, <a class="code" href="../../d3/dda/proc_8c.html#aec40448c8ed3a89f90f22ef609be383a">proc_hash</a>, 0);
<a name="l02135"></a>02135     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#abd0d5fa9d171dbf020e85958391437f9">rb_cProc</a>, <span class="stringliteral">&quot;to_s&quot;</span>, <a class="code" href="../../d3/dda/proc_8c.html#aa821d48536c026d91cdb7fd03f6b88c2">proc_to_s</a>, 0);
<a name="l02136"></a>02136     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#abd0d5fa9d171dbf020e85958391437f9">rb_cProc</a>, <span class="stringliteral">&quot;lambda?&quot;</span>, <a class="code" href="../../db/d2e/intern_8h.html#a9a96293850077b10b7da7df2fef00df6">rb_proc_lambda_p</a>, 0);
<a name="l02137"></a>02137     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#abd0d5fa9d171dbf020e85958391437f9">rb_cProc</a>, <span class="stringliteral">&quot;binding&quot;</span>, <a class="code" href="../../d3/dda/proc_8c.html#a675c412cbe69064e78a7e71540ae22ef">proc_binding</a>, 0);
<a name="l02138"></a>02138     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#abd0d5fa9d171dbf020e85958391437f9">rb_cProc</a>, <span class="stringliteral">&quot;curry&quot;</span>, <a class="code" href="../../d3/dda/proc_8c.html#ac760a8e9d65cf3bd421830ef5ddd828b">proc_curry</a>, -1);
<a name="l02139"></a>02139     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#abd0d5fa9d171dbf020e85958391437f9">rb_cProc</a>, <span class="stringliteral">&quot;source_location&quot;</span>, <a class="code" href="../../d3/dda/proc_8c.html#ac3a12eb7e4f35538dfd8cdd35d7f1155">rb_proc_location</a>, 0);
<a name="l02140"></a>02140     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#abd0d5fa9d171dbf020e85958391437f9">rb_cProc</a>, <span class="stringliteral">&quot;parameters&quot;</span>, <a class="code" href="../../d3/dda/proc_8c.html#af66d622b83c9cb9a469063cf86946179">rb_proc_parameters</a>, 0);
<a name="l02141"></a>02141 
<a name="l02142"></a>02142     <span class="comment">/* Exceptions */</span>
<a name="l02143"></a>02143     <a class="code" href="../../d3/d57/eval_8c.html#a0d9f0f9371f3273e30d146f54767da6f">rb_eLocalJumpError</a> = <a class="code" href="../../de/ddf/group__class.html#ga15d068dbe88a3bab3700b03bebb7fbac" title="Defines a top-level class.">rb_define_class</a>(<span class="stringliteral">&quot;LocalJumpError&quot;</span>, <a class="code" href="../../db/dcc/error_8c.html#a3fc1bd0a9e1211aef38f81d600345ed9">rb_eStandardError</a>);
<a name="l02144"></a>02144     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../d3/d57/eval_8c.html#a0d9f0f9371f3273e30d146f54767da6f">rb_eLocalJumpError</a>, <span class="stringliteral">&quot;exit_value&quot;</span>, <a class="code" href="../../d3/dda/proc_8c.html#a409dadf390708ff4572168b8c2d14c44">localjump_xvalue</a>, 0);
<a name="l02145"></a>02145     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../d3/d57/eval_8c.html#a0d9f0f9371f3273e30d146f54767da6f">rb_eLocalJumpError</a>, <span class="stringliteral">&quot;reason&quot;</span>, <a class="code" href="../../d3/dda/proc_8c.html#a876679fbfe4b9bff0c26c6728114aba2">localjump_reason</a>, 0);
<a name="l02146"></a>02146 
<a name="l02147"></a>02147     <a class="code" href="../../d3/d57/eval_8c.html#ad54662e76ff877fbae8138b3dd09bab4">rb_eSysStackError</a> = <a class="code" href="../../de/ddf/group__class.html#ga15d068dbe88a3bab3700b03bebb7fbac" title="Defines a top-level class.">rb_define_class</a>(<span class="stringliteral">&quot;SystemStackError&quot;</span>, <a class="code" href="../../db/dcc/error_8c.html#ac5bd9245454f935493c41daa4f2651ae">rb_eException</a>);
<a name="l02148"></a>02148     <a class="code" href="../../d8/d32/vm__core_8h.html#a7acad2ca9baf84e4d6cb6e68cd3da73f">sysstack_error</a> = <a class="code" href="../../db/dcc/error_8c.html#a4989eeb5742cad6359a2ed77859674de">rb_exc_new3</a>(<a class="code" href="../../d3/d57/eval_8c.html#ad54662e76ff877fbae8138b3dd09bab4">rb_eSysStackError</a>,
<a name="l02149"></a>02149                                  <a class="code" href="../../db/d2e/intern_8h.html#a8ea3742679211f408cb5769de6cf0d46">rb_obj_freeze</a>(<a class="code" href="../../db/d2e/intern_8h.html#a03acd62c0b1edebbe1d61f957c19b7ac">rb_str_new2</a>(<span class="stringliteral">&quot;stack level too deep&quot;</span>)));
<a name="l02150"></a>02150     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#afd75ea0cb81c17e76c73e593d1d8a860">OBJ_TAINT</a>(<a class="code" href="../../d8/d32/vm__core_8h.html#a7acad2ca9baf84e4d6cb6e68cd3da73f">sysstack_error</a>);
<a name="l02151"></a>02151 
<a name="l02152"></a>02152     <span class="comment">/* utility functions */</span>
<a name="l02153"></a>02153     <a class="code" href="../../d7/d19/group__defmethod.html#gac08f58e00836e4e2586689e45b781bdd" title="Defines a global function.">rb_define_global_function</a>(<span class="stringliteral">&quot;proc&quot;</span>, <a class="code" href="../../db/d2e/intern_8h.html#a7b330d2905c5f0c9a68cef4ebba5c00f">rb_block_proc</a>, 0);
<a name="l02154"></a>02154     <a class="code" href="../../d7/d19/group__defmethod.html#gac08f58e00836e4e2586689e45b781bdd" title="Defines a global function.">rb_define_global_function</a>(<span class="stringliteral">&quot;lambda&quot;</span>, <a class="code" href="../../d3/dda/proc_8c.html#a637a43e2bb4cf4cee32d165730d9469f">proc_lambda</a>, 0);
<a name="l02155"></a>02155 
<a name="l02156"></a>02156     <span class="comment">/* Method */</span>
<a name="l02157"></a>02157     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ae48870c64516ad4fcc5bafe96d01e126">rb_cMethod</a> = <a class="code" href="../../de/ddf/group__class.html#ga15d068dbe88a3bab3700b03bebb7fbac" title="Defines a top-level class.">rb_define_class</a>(<span class="stringliteral">&quot;Method&quot;</span>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a57c96ead3ef230b4838e65fe037c346e">rb_cObject</a>);
<a name="l02158"></a>02158     <a class="code" href="../../db/d2e/intern_8h.html#ad38ee02dc6ba34e3d05a60bac4a900f8">rb_undef_alloc_func</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#ae48870c64516ad4fcc5bafe96d01e126">rb_cMethod</a>);
<a name="l02159"></a>02159     <a class="code" href="../../d7/d19/group__defmethod.html#ga879be4a71b806afb2854833fc1c45981">rb_undef_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#ad07df58de9895cbc33c10f02540d2d4d">CLASS_OF</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#ae48870c64516ad4fcc5bafe96d01e126">rb_cMethod</a>), <span class="stringliteral">&quot;new&quot;</span>);
<a name="l02160"></a>02160     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#ae48870c64516ad4fcc5bafe96d01e126">rb_cMethod</a>, <span class="stringliteral">&quot;==&quot;</span>, <a class="code" href="../../d3/dda/proc_8c.html#ad959c9dd97194b7e1f1e3530ce7e3995">method_eq</a>, 1);
<a name="l02161"></a>02161     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#ae48870c64516ad4fcc5bafe96d01e126">rb_cMethod</a>, <span class="stringliteral">&quot;eql?&quot;</span>, <a class="code" href="../../d3/dda/proc_8c.html#ad959c9dd97194b7e1f1e3530ce7e3995">method_eq</a>, 1);
<a name="l02162"></a>02162     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#ae48870c64516ad4fcc5bafe96d01e126">rb_cMethod</a>, <span class="stringliteral">&quot;hash&quot;</span>, <a class="code" href="../../d3/dda/proc_8c.html#a9d3c1cf10f62ae5e98f1086c0c9a5afe">method_hash</a>, 0);
<a name="l02163"></a>02163     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#ae48870c64516ad4fcc5bafe96d01e126">rb_cMethod</a>, <span class="stringliteral">&quot;clone&quot;</span>, <a class="code" href="../../d3/dda/proc_8c.html#a8d0e940e710da96966744bfaabd29b09">method_clone</a>, 0);
<a name="l02164"></a>02164     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#ae48870c64516ad4fcc5bafe96d01e126">rb_cMethod</a>, <span class="stringliteral">&quot;call&quot;</span>, <a class="code" href="../../db/d2e/intern_8h.html#a0c43557c40369d54f475f26fb34678fb">rb_method_call</a>, -1);
<a name="l02165"></a>02165     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#ae48870c64516ad4fcc5bafe96d01e126">rb_cMethod</a>, <span class="stringliteral">&quot;[]&quot;</span>, <a class="code" href="../../db/d2e/intern_8h.html#a0c43557c40369d54f475f26fb34678fb">rb_method_call</a>, -1);
<a name="l02166"></a>02166     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#ae48870c64516ad4fcc5bafe96d01e126">rb_cMethod</a>, <span class="stringliteral">&quot;arity&quot;</span>, <a class="code" href="../../d3/dda/proc_8c.html#aeb2f11e919df26ba1e2e12a4fda06fd5">method_arity_m</a>, 0);
<a name="l02167"></a>02167     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#ae48870c64516ad4fcc5bafe96d01e126">rb_cMethod</a>, <span class="stringliteral">&quot;inspect&quot;</span>, <a class="code" href="../../d3/dda/proc_8c.html#a1592e1f35640a9f82f0cca73ebe3bec1">method_inspect</a>, 0);
<a name="l02168"></a>02168     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#ae48870c64516ad4fcc5bafe96d01e126">rb_cMethod</a>, <span class="stringliteral">&quot;to_s&quot;</span>, <a class="code" href="../../d3/dda/proc_8c.html#a1592e1f35640a9f82f0cca73ebe3bec1">method_inspect</a>, 0);
<a name="l02169"></a>02169     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#ae48870c64516ad4fcc5bafe96d01e126">rb_cMethod</a>, <span class="stringliteral">&quot;to_proc&quot;</span>, <a class="code" href="../../d3/dda/proc_8c.html#a752312046aa6c7f1a85c5e3ad28bab95">method_proc</a>, 0);
<a name="l02170"></a>02170     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#ae48870c64516ad4fcc5bafe96d01e126">rb_cMethod</a>, <span class="stringliteral">&quot;receiver&quot;</span>, <a class="code" href="../../d3/dda/proc_8c.html#ad61ccc0e52bca025cbe6af15ff741629">method_receiver</a>, 0);
<a name="l02171"></a>02171     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#ae48870c64516ad4fcc5bafe96d01e126">rb_cMethod</a>, <span class="stringliteral">&quot;name&quot;</span>, <a class="code" href="../../d3/dda/proc_8c.html#abc4c96af7623d1ba9cc053d18639621e">method_name</a>, 0);
<a name="l02172"></a>02172     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#ae48870c64516ad4fcc5bafe96d01e126">rb_cMethod</a>, <span class="stringliteral">&quot;owner&quot;</span>, <a class="code" href="../../d3/dda/proc_8c.html#afa673dcf9cdafabea7c3729b3fa4a541">method_owner</a>, 0);
<a name="l02173"></a>02173     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#ae48870c64516ad4fcc5bafe96d01e126">rb_cMethod</a>, <span class="stringliteral">&quot;unbind&quot;</span>, <a class="code" href="../../d3/dda/proc_8c.html#a671d398fb66a5cf110d35ab561e88857">method_unbind</a>, 0);
<a name="l02174"></a>02174     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#ae48870c64516ad4fcc5bafe96d01e126">rb_cMethod</a>, <span class="stringliteral">&quot;source_location&quot;</span>, <a class="code" href="../../d3/dda/proc_8c.html#accbc09fa63e28b2af7cba85a731a916e">rb_method_location</a>, 0);
<a name="l02175"></a>02175     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#ae48870c64516ad4fcc5bafe96d01e126">rb_cMethod</a>, <span class="stringliteral">&quot;parameters&quot;</span>, <a class="code" href="../../d3/dda/proc_8c.html#adbe6a5429a2beceb1ae2eac33e16662d">rb_method_parameters</a>, 0);
<a name="l02176"></a>02176     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a2f79a80cd4cd92563255889fdcc303b8">rb_mKernel</a>, <span class="stringliteral">&quot;method&quot;</span>, <a class="code" href="../../db/d2e/intern_8h.html#a313ca14c01fde0789cc8ec03ae3d9762">rb_obj_method</a>, 1);
<a name="l02177"></a>02177     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a2f79a80cd4cd92563255889fdcc303b8">rb_mKernel</a>, <span class="stringliteral">&quot;public_method&quot;</span>, <a class="code" href="../../d3/dda/proc_8c.html#aecc2ba47440cc681506a63576f552cdf">rb_obj_public_method</a>, 1);
<a name="l02178"></a>02178 
<a name="l02179"></a>02179     <span class="comment">/* UnboundMethod */</span>
<a name="l02180"></a>02180     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a23383895e4060d0b44efa71dae926aa0">rb_cUnboundMethod</a> = <a class="code" href="../../de/ddf/group__class.html#ga15d068dbe88a3bab3700b03bebb7fbac" title="Defines a top-level class.">rb_define_class</a>(<span class="stringliteral">&quot;UnboundMethod&quot;</span>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a57c96ead3ef230b4838e65fe037c346e">rb_cObject</a>);
<a name="l02181"></a>02181     <a class="code" href="../../db/d2e/intern_8h.html#ad38ee02dc6ba34e3d05a60bac4a900f8">rb_undef_alloc_func</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a23383895e4060d0b44efa71dae926aa0">rb_cUnboundMethod</a>);
<a name="l02182"></a>02182     <a class="code" href="../../d7/d19/group__defmethod.html#ga879be4a71b806afb2854833fc1c45981">rb_undef_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#ad07df58de9895cbc33c10f02540d2d4d">CLASS_OF</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a23383895e4060d0b44efa71dae926aa0">rb_cUnboundMethod</a>), <span class="stringliteral">&quot;new&quot;</span>);
<a name="l02183"></a>02183     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a23383895e4060d0b44efa71dae926aa0">rb_cUnboundMethod</a>, <span class="stringliteral">&quot;==&quot;</span>, <a class="code" href="../../d3/dda/proc_8c.html#ad959c9dd97194b7e1f1e3530ce7e3995">method_eq</a>, 1);
<a name="l02184"></a>02184     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a23383895e4060d0b44efa71dae926aa0">rb_cUnboundMethod</a>, <span class="stringliteral">&quot;eql?&quot;</span>, <a class="code" href="../../d3/dda/proc_8c.html#ad959c9dd97194b7e1f1e3530ce7e3995">method_eq</a>, 1);
<a name="l02185"></a>02185     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a23383895e4060d0b44efa71dae926aa0">rb_cUnboundMethod</a>, <span class="stringliteral">&quot;hash&quot;</span>, <a class="code" href="../../d3/dda/proc_8c.html#a9d3c1cf10f62ae5e98f1086c0c9a5afe">method_hash</a>, 0);
<a name="l02186"></a>02186     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a23383895e4060d0b44efa71dae926aa0">rb_cUnboundMethod</a>, <span class="stringliteral">&quot;clone&quot;</span>, <a class="code" href="../../d3/dda/proc_8c.html#a8d0e940e710da96966744bfaabd29b09">method_clone</a>, 0);
<a name="l02187"></a>02187     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a23383895e4060d0b44efa71dae926aa0">rb_cUnboundMethod</a>, <span class="stringliteral">&quot;arity&quot;</span>, <a class="code" href="../../d3/dda/proc_8c.html#aeb2f11e919df26ba1e2e12a4fda06fd5">method_arity_m</a>, 0);
<a name="l02188"></a>02188     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a23383895e4060d0b44efa71dae926aa0">rb_cUnboundMethod</a>, <span class="stringliteral">&quot;inspect&quot;</span>, <a class="code" href="../../d3/dda/proc_8c.html#a1592e1f35640a9f82f0cca73ebe3bec1">method_inspect</a>, 0);
<a name="l02189"></a>02189     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a23383895e4060d0b44efa71dae926aa0">rb_cUnboundMethod</a>, <span class="stringliteral">&quot;to_s&quot;</span>, <a class="code" href="../../d3/dda/proc_8c.html#a1592e1f35640a9f82f0cca73ebe3bec1">method_inspect</a>, 0);
<a name="l02190"></a>02190     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a23383895e4060d0b44efa71dae926aa0">rb_cUnboundMethod</a>, <span class="stringliteral">&quot;name&quot;</span>, <a class="code" href="../../d3/dda/proc_8c.html#abc4c96af7623d1ba9cc053d18639621e">method_name</a>, 0);
<a name="l02191"></a>02191     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a23383895e4060d0b44efa71dae926aa0">rb_cUnboundMethod</a>, <span class="stringliteral">&quot;owner&quot;</span>, <a class="code" href="../../d3/dda/proc_8c.html#afa673dcf9cdafabea7c3729b3fa4a541">method_owner</a>, 0);
<a name="l02192"></a>02192     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a23383895e4060d0b44efa71dae926aa0">rb_cUnboundMethod</a>, <span class="stringliteral">&quot;bind&quot;</span>, <a class="code" href="../../d3/dda/proc_8c.html#aa11ac7837645a53ac91bf1ee5a0739fa">umethod_bind</a>, 1);
<a name="l02193"></a>02193     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a23383895e4060d0b44efa71dae926aa0">rb_cUnboundMethod</a>, <span class="stringliteral">&quot;source_location&quot;</span>, <a class="code" href="../../d3/dda/proc_8c.html#accbc09fa63e28b2af7cba85a731a916e">rb_method_location</a>, 0);
<a name="l02194"></a>02194     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a23383895e4060d0b44efa71dae926aa0">rb_cUnboundMethod</a>, <span class="stringliteral">&quot;parameters&quot;</span>, <a class="code" href="../../d3/dda/proc_8c.html#adbe6a5429a2beceb1ae2eac33e16662d">rb_method_parameters</a>, 0);
<a name="l02195"></a>02195 
<a name="l02196"></a>02196     <span class="comment">/* Module#*_method */</span>
<a name="l02197"></a>02197     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#ad35b93cf98ae9c41f3394fd51383f774">rb_cModule</a>, <span class="stringliteral">&quot;instance_method&quot;</span>, <a class="code" href="../../d3/dda/proc_8c.html#a6ee7bf619e3f7c1cb03b49d800634a70">rb_mod_instance_method</a>, 1);
<a name="l02198"></a>02198     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#ad35b93cf98ae9c41f3394fd51383f774">rb_cModule</a>, <span class="stringliteral">&quot;public_instance_method&quot;</span>, <a class="code" href="../../d3/dda/proc_8c.html#aac8652823da9b40312b817f4983b3416">rb_mod_public_instance_method</a>, 1);
<a name="l02199"></a>02199     <a class="code" href="../../d7/d19/group__defmethod.html#ga69c4f84891831d013e9e64972de90d78">rb_define_private_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#ad35b93cf98ae9c41f3394fd51383f774">rb_cModule</a>, <span class="stringliteral">&quot;define_method&quot;</span>, <a class="code" href="../../d3/dda/proc_8c.html#aa6a19b54751d0226272b4a7bf300c43b">rb_mod_define_method</a>, -1);
<a name="l02200"></a>02200 
<a name="l02201"></a>02201     <span class="comment">/* Kernel */</span>
<a name="l02202"></a>02202     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a2f79a80cd4cd92563255889fdcc303b8">rb_mKernel</a>, <span class="stringliteral">&quot;define_singleton_method&quot;</span>, <a class="code" href="../../d3/dda/proc_8c.html#a18c896f2a702ff9899764326287dbc44">rb_obj_define_method</a>, -1);
<a name="l02203"></a>02203 }
<a name="l02204"></a>02204 
<a name="l02205"></a>02205 <span class="comment">/*</span>
<a name="l02206"></a>02206 <span class="comment"> *  Objects of class &lt;code&gt;Binding&lt;/code&gt; encapsulate the execution</span>
<a name="l02207"></a>02207 <span class="comment"> *  context at some particular place in the code and retain this context</span>
<a name="l02208"></a>02208 <span class="comment"> *  for future use. The variables, methods, value of &lt;code&gt;self&lt;/code&gt;,</span>
<a name="l02209"></a>02209 <span class="comment"> *  and possibly an iterator block that can be accessed in this context</span>
<a name="l02210"></a>02210 <span class="comment"> *  are all retained. Binding objects can be created using</span>
<a name="l02211"></a>02211 <span class="comment"> *  &lt;code&gt;Kernel#binding&lt;/code&gt;, and are made available to the callback</span>
<a name="l02212"></a>02212 <span class="comment"> *  of &lt;code&gt;Kernel#set_trace_func&lt;/code&gt;.</span>
<a name="l02213"></a>02213 <span class="comment"> *</span>
<a name="l02214"></a>02214 <span class="comment"> *  These binding objects can be passed as the second argument of the</span>
<a name="l02215"></a>02215 <span class="comment"> *  &lt;code&gt;Kernel#eval&lt;/code&gt; method, establishing an environment for the</span>
<a name="l02216"></a>02216 <span class="comment"> *  evaluation.</span>
<a name="l02217"></a>02217 <span class="comment"> *</span>
<a name="l02218"></a>02218 <span class="comment"> *     class Demo</span>
<a name="l02219"></a>02219 <span class="comment"> *       def initialize(n)</span>
<a name="l02220"></a>02220 <span class="comment"> *         @secret = n</span>
<a name="l02221"></a>02221 <span class="comment"> *       end</span>
<a name="l02222"></a>02222 <span class="comment"> *       def get_binding</span>
<a name="l02223"></a>02223 <span class="comment"> *         return binding()</span>
<a name="l02224"></a>02224 <span class="comment"> *       end</span>
<a name="l02225"></a>02225 <span class="comment"> *     end</span>
<a name="l02226"></a>02226 <span class="comment"> *</span>
<a name="l02227"></a>02227 <span class="comment"> *     k1 = Demo.new(99)</span>
<a name="l02228"></a>02228 <span class="comment"> *     b1 = k1.get_binding</span>
<a name="l02229"></a>02229 <span class="comment"> *     k2 = Demo.new(-3)</span>
<a name="l02230"></a>02230 <span class="comment"> *     b2 = k2.get_binding</span>
<a name="l02231"></a>02231 <span class="comment"> *</span>
<a name="l02232"></a>02232 <span class="comment"> *     eval(&quot;@secret&quot;, b1)   #=&gt; 99</span>
<a name="l02233"></a>02233 <span class="comment"> *     eval(&quot;@secret&quot;, b2)   #=&gt; -3</span>
<a name="l02234"></a>02234 <span class="comment"> *     eval(&quot;@secret&quot;)       #=&gt; nil</span>
<a name="l02235"></a>02235 <span class="comment"> *</span>
<a name="l02236"></a>02236 <span class="comment"> *  Binding objects have no class-specific methods.</span>
<a name="l02237"></a>02237 <span class="comment"> *</span>
<a name="l02238"></a>02238 <span class="comment"> */</span>
<a name="l02239"></a>02239 
<a name="l02240"></a>02240 <span class="keywordtype">void</span>
<a name="l02241"></a><a class="code" href="../../d3/dda/proc_8c.html#aa3ca2b74ffabc41ab1d02f3f109f76c2">02241</a> <a class="code" href="../../d3/dda/proc_8c.html#aa3ca2b74ffabc41ab1d02f3f109f76c2">Init_Binding</a>(<span class="keywordtype">void</span>)
<a name="l02242"></a>02242 {
<a name="l02243"></a>02243     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ad07e23922ca1fa3e87647edf4fab6d38">rb_cBinding</a> = <a class="code" href="../../de/ddf/group__class.html#ga15d068dbe88a3bab3700b03bebb7fbac" title="Defines a top-level class.">rb_define_class</a>(<span class="stringliteral">&quot;Binding&quot;</span>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a57c96ead3ef230b4838e65fe037c346e">rb_cObject</a>);
<a name="l02244"></a>02244     <a class="code" href="../../db/d2e/intern_8h.html#ad38ee02dc6ba34e3d05a60bac4a900f8">rb_undef_alloc_func</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#ad07e23922ca1fa3e87647edf4fab6d38">rb_cBinding</a>);
<a name="l02245"></a>02245     <a class="code" href="../../d7/d19/group__defmethod.html#ga879be4a71b806afb2854833fc1c45981">rb_undef_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#ad07df58de9895cbc33c10f02540d2d4d">CLASS_OF</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#ad07e23922ca1fa3e87647edf4fab6d38">rb_cBinding</a>), <span class="stringliteral">&quot;new&quot;</span>);
<a name="l02246"></a>02246     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#ad07e23922ca1fa3e87647edf4fab6d38">rb_cBinding</a>, <span class="stringliteral">&quot;clone&quot;</span>, <a class="code" href="../../d3/dda/proc_8c.html#a6e542c9334f97273c080205e2728ad30">binding_clone</a>, 0);
<a name="l02247"></a>02247     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#ad07e23922ca1fa3e87647edf4fab6d38">rb_cBinding</a>, <span class="stringliteral">&quot;dup&quot;</span>, <a class="code" href="../../d3/dda/proc_8c.html#a8f4a8c3f049376d9334f740b0b80b1ab">binding_dup</a>, 0);
<a name="l02248"></a>02248     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#ad07e23922ca1fa3e87647edf4fab6d38">rb_cBinding</a>, <span class="stringliteral">&quot;eval&quot;</span>, <a class="code" href="../../d3/dda/proc_8c.html#af635113489a23aa748424e0c3badf51a">bind_eval</a>, -1);
<a name="l02249"></a>02249     <a class="code" href="../../d7/d19/group__defmethod.html#gac08f58e00836e4e2586689e45b781bdd" title="Defines a global function.">rb_define_global_function</a>(<span class="stringliteral">&quot;binding&quot;</span>, <a class="code" href="../../d3/dda/proc_8c.html#aaf7aa767b45b033de065b3cf54e72371">rb_f_binding</a>, 0);
<a name="l02250"></a>02250 }
<a name="l02251"></a>02251 
<a name="l02252"></a>02252 
</pre></div></div>
<hr size="1"/><address style="text-align: right;"><small>Generated on 1 Mar 2013 for Ruby by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
