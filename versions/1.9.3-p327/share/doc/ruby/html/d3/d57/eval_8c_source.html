<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Ruby: eval.c Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="../../index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="../../files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="../../globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<h1>eval.c</h1><a href="../../d3/d57/eval_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/**********************************************************************</span>
<a name="l00002"></a>00002 <span class="comment"></span>
<a name="l00003"></a>00003 <span class="comment">  eval.c -</span>
<a name="l00004"></a>00004 <span class="comment"></span>
<a name="l00005"></a>00005 <span class="comment">  $Author: marcandre $</span>
<a name="l00006"></a>00006 <span class="comment">  created at: Thu Jun 10 14:22:17 JST 1993</span>
<a name="l00007"></a>00007 <span class="comment"></span>
<a name="l00008"></a>00008 <span class="comment">  Copyright (C) 1993-2007 Yukihiro Matsumoto</span>
<a name="l00009"></a>00009 <span class="comment">  Copyright (C) 2000  Network Applied Communication Laboratory, Inc.</span>
<a name="l00010"></a>00010 <span class="comment">  Copyright (C) 2000  Information-technology Promotion Agency, Japan</span>
<a name="l00011"></a>00011 <span class="comment"></span>
<a name="l00012"></a>00012 <span class="comment">**********************************************************************/</span>
<a name="l00013"></a>00013 
<a name="l00014"></a>00014 <span class="preprocessor">#include &quot;<a class="code" href="../../dd/dd0/eval__intern_8h.html">eval_intern.h</a>&quot;</span>
<a name="l00015"></a>00015 <span class="preprocessor">#include &quot;<a class="code" href="../../d7/dc8/iseq_8h.html">iseq.h</a>&quot;</span>
<a name="l00016"></a>00016 <span class="preprocessor">#include &quot;<a class="code" href="../../d0/daa/gc_8h.html">gc.h</a>&quot;</span>
<a name="l00017"></a>00017 <span class="preprocessor">#include &quot;<a class="code" href="../../da/d0a/vm_8h.html">ruby/vm.h</a>&quot;</span>
<a name="l00018"></a>00018 <span class="preprocessor">#include &quot;<a class="code" href="../../d5/de3/encoding_8h.html">ruby/encoding.h</a>&quot;</span>
<a name="l00019"></a>00019 <span class="preprocessor">#include &quot;<a class="code" href="../../db/dde/internal_8h.html">internal.h</a>&quot;</span>
<a name="l00020"></a>00020 <span class="preprocessor">#include &quot;<a class="code" href="../../d8/d32/vm__core_8h.html">vm_core.h</a>&quot;</span>
<a name="l00021"></a>00021 
<a name="l00022"></a><a class="code" href="../../d3/d57/eval_8c.html#a4ac8fee05a285361c33a2b0d9c2d555c">00022</a> <span class="preprocessor">#define numberof(array) (int)(sizeof(array) / sizeof((array)[0]))</span>
<a name="l00023"></a>00023 <span class="preprocessor"></span>
<a name="l00024"></a>00024 <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a7a711d5127a34da8c3ed48f401579289">NORETURN</a>(<span class="keywordtype">void</span> <a class="code" href="../../d3/d57/eval_8c.html#a6d01f6401233090eaa124a57ced0fb3a">rb_raise_jump</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>));
<a name="l00025"></a>00025 
<a name="l00026"></a><a class="code" href="../../d3/d57/eval_8c.html#a0d9f0f9371f3273e30d146f54767da6f">00026</a> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <a class="code" href="../../d3/d57/eval_8c.html#a0d9f0f9371f3273e30d146f54767da6f">rb_eLocalJumpError</a>;
<a name="l00027"></a><a class="code" href="../../d3/d57/eval_8c.html#ad54662e76ff877fbae8138b3dd09bab4">00027</a> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <a class="code" href="../../d3/d57/eval_8c.html#ad54662e76ff877fbae8138b3dd09bab4">rb_eSysStackError</a>;
<a name="l00028"></a>00028 
<a name="l00029"></a><a class="code" href="../../d3/d57/eval_8c.html#a8a9edae7f9045c2c18fb899dc8823e68">00029</a> <span class="preprocessor">#define exception_error GET_VM()-&gt;special_exceptions[ruby_error_reenter]</span>
<a name="l00030"></a>00030 <span class="preprocessor"></span>
<a name="l00031"></a>00031 <span class="preprocessor">#include &quot;<a class="code" href="../../d5/d1d/eval__error_8c.html">eval_error.c</a>&quot;</span>
<a name="l00032"></a>00032 <span class="preprocessor">#include &quot;<a class="code" href="../../d6/d9b/eval__jump_8c.html">eval_jump.c</a>&quot;</span>
<a name="l00033"></a>00033 
<a name="l00034"></a>00034 <span class="comment">/* initialize ruby */</span>
<a name="l00035"></a>00035 
<a name="l00036"></a>00036 <span class="keywordtype">void</span>
<a name="l00037"></a><a class="code" href="../../de/de6/ruby_2ruby_8h.html#a2fe207a5a5fd5da2bf5948cb084a1c5b">00037</a> <a class="code" href="../../d3/d57/eval_8c.html#a2fe207a5a5fd5da2bf5948cb084a1c5b">ruby_init</a>(<span class="keywordtype">void</span>)
<a name="l00038"></a>00038 {
<a name="l00039"></a>00039     <span class="keyword">static</span> <span class="keywordtype">int</span> initialized = 0;
<a name="l00040"></a>00040     <span class="keywordtype">int</span> <a class="code" href="../../d5/d1d/gb18030_8c.html#adc6e5733fc3c22f0a7b2914188c49c90">state</a>;
<a name="l00041"></a>00041 
<a name="l00042"></a>00042     <span class="keywordflow">if</span> (initialized)
<a name="l00043"></a>00043         <span class="keywordflow">return</span>;
<a name="l00044"></a>00044     initialized = 1;
<a name="l00045"></a>00045 
<a name="l00046"></a>00046     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ab7d9aa9836c379212b86b985909f7303">ruby_init_stack</a>((<span class="keywordtype">void</span> *)&amp;state);
<a name="l00047"></a>00047     <a class="code" href="../../de/de9/vm_8c.html#aebe8178dca87b6a8883017e6921029c2">Init_BareVM</a>();
<a name="l00048"></a>00048     <a class="code" href="../../d8/d16/gc_8c.html#a28562cb36223b2cae4ba88ef1c81a5c9">Init_heap</a>();
<a name="l00049"></a>00049 
<a name="l00050"></a>00050     <a class="code" href="../../dd/dd0/eval__intern_8h.html#ac0e28e3418925cd969f30157281642bf">PUSH_TAG</a>();
<a name="l00051"></a>00051     <span class="keywordflow">if</span> ((state = <a class="code" href="../../dd/dd0/eval__intern_8h.html#a3441e3967c633da99c3dcd025494053e">EXEC_TAG</a>()) == 0) {
<a name="l00052"></a>00052         <a class="code" href="../../d9/dfe/inits_8c.html#ae0229dc446b11cc110a247329ffe6488">rb_call_inits</a>();
<a name="l00053"></a>00053         <a class="code" href="../../db/d2e/intern_8h.html#ad6a1cc74c8bfe75b72688ca185c14db8">ruby_prog_init</a>();
<a name="l00054"></a>00054     }
<a name="l00055"></a>00055     <a class="code" href="../../dd/dd0/eval__intern_8h.html#accfba89bbfaf289dc5fff2d2f235f2f1">POP_TAG</a>();
<a name="l00056"></a>00056 
<a name="l00057"></a>00057     <span class="keywordflow">if</span> (state) {
<a name="l00058"></a>00058         <a class="code" href="../../d5/d1d/eval__error_8c.html#a9e3c5d5204c41ea28ab55fb027a7f146">error_print</a>();
<a name="l00059"></a>00059         exit(<a class="code" href="../../dd/dd0/eval__intern_8h.html#a73efe787c131b385070f25d18b7c9aa4">EXIT_FAILURE</a>);
<a name="l00060"></a>00060     }
<a name="l00061"></a>00061     <a class="code" href="../../d8/d32/vm__core_8h.html#a6cfcd3997994924c8cd13c3b5c099ec6">GET_VM</a>()-&gt;running = 1;
<a name="l00062"></a>00062 }
<a name="l00063"></a>00063 
<a name="l00064"></a>00064 <span class="keywordtype">void</span> *
<a name="l00065"></a><a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3824f3c01b994922cb9c6e26d49acffb">00065</a> <a class="code" href="../../d3/d57/eval_8c.html#aba16bea5d2286f98939691138a60ac01">ruby_options</a>(<span class="keywordtype">int</span> <a class="code" href="../../df/d77/ruby_8c.html#ad1447518f4372828b8435ae82e48499e">argc</a>, <span class="keywordtype">char</span> **<a class="code" href="../../df/d77/ruby_8c.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>)
<a name="l00066"></a>00066 {
<a name="l00067"></a>00067     <span class="keywordtype">int</span> <a class="code" href="../../d5/d1d/gb18030_8c.html#adc6e5733fc3c22f0a7b2914188c49c90">state</a>;
<a name="l00068"></a>00068     <span class="keywordtype">void</span> *<span class="keyword">volatile</span> iseq = 0;
<a name="l00069"></a>00069 
<a name="l00070"></a>00070     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ab7d9aa9836c379212b86b985909f7303">ruby_init_stack</a>((<span class="keywordtype">void</span> *)&amp;iseq);
<a name="l00071"></a>00071     <a class="code" href="../../dd/dd0/eval__intern_8h.html#ac0e28e3418925cd969f30157281642bf">PUSH_TAG</a>();
<a name="l00072"></a>00072     <span class="keywordflow">if</span> ((state = <a class="code" href="../../dd/dd0/eval__intern_8h.html#a3441e3967c633da99c3dcd025494053e">EXEC_TAG</a>()) == 0) {
<a name="l00073"></a>00073         <a class="code" href="../../dd/dd0/eval__intern_8h.html#ae04396c4a051215fa7a77469d9547933">SAVE_ROOT_JMPBUF</a>(<a class="code" href="../../d8/d32/vm__core_8h.html#a8deb84ec6023e3229db88ac2c9da6138">GET_THREAD</a>(), iseq = <a class="code" href="../../db/d2e/intern_8h.html#a77b3346dd4a545359a66113f1e888556">ruby_process_options</a>(argc, argv));
<a name="l00074"></a>00074     }
<a name="l00075"></a>00075     <span class="keywordflow">else</span> {
<a name="l00076"></a>00076         <a class="code" href="../../d3/de7/thread_8c.html#ac5abc5929f7fc2c05cbbd8e5eab8b664">rb_clear_trace_func</a>();
<a name="l00077"></a>00077         state = <a class="code" href="../../d5/d1d/eval__error_8c.html#a2a46db9211e42178912e4c974c391238">error_handle</a>(state);
<a name="l00078"></a>00078         iseq = (<span class="keywordtype">void</span> *)<a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(state);
<a name="l00079"></a>00079     }
<a name="l00080"></a>00080     <a class="code" href="../../dd/dd0/eval__intern_8h.html#accfba89bbfaf289dc5fff2d2f235f2f1">POP_TAG</a>();
<a name="l00081"></a>00081     <span class="keywordflow">return</span> iseq;
<a name="l00082"></a>00082 }
<a name="l00083"></a>00083 
<a name="l00084"></a>00084 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00085"></a><a class="code" href="../../d3/d57/eval_8c.html#a0e202191d97655d76b47a8965e3b9b66">00085</a> <a class="code" href="../../d3/d57/eval_8c.html#a0e202191d97655d76b47a8965e3b9b66">ruby_finalize_0</a>(<span class="keywordtype">void</span>)
<a name="l00086"></a>00086 {
<a name="l00087"></a>00087     <a class="code" href="../../dd/dd0/eval__intern_8h.html#ac0e28e3418925cd969f30157281642bf">PUSH_TAG</a>();
<a name="l00088"></a>00088     <span class="keywordflow">if</span> (<a class="code" href="../../dd/dd0/eval__intern_8h.html#a3441e3967c633da99c3dcd025494053e">EXEC_TAG</a>() == 0) {
<a name="l00089"></a>00089         <a class="code" href="../../db/d2e/intern_8h.html#a788154635f0bf34ce4cf22db341886f0">rb_trap_exit</a>();
<a name="l00090"></a>00090     }
<a name="l00091"></a>00091     <a class="code" href="../../dd/dd0/eval__intern_8h.html#accfba89bbfaf289dc5fff2d2f235f2f1">POP_TAG</a>();
<a name="l00092"></a>00092     <a class="code" href="../../d6/d9b/eval__jump_8c.html#af6fa0917a38e43eccb0c25d5a20778f3">rb_exec_end_proc</a>();
<a name="l00093"></a>00093     <a class="code" href="../../d3/de7/thread_8c.html#ac5abc5929f7fc2c05cbbd8e5eab8b664">rb_clear_trace_func</a>();
<a name="l00094"></a>00094 }
<a name="l00095"></a>00095 
<a name="l00096"></a>00096 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00097"></a><a class="code" href="../../d3/d57/eval_8c.html#a28424d81a7673058865e3e12e3768868">00097</a> <a class="code" href="../../d3/d57/eval_8c.html#a28424d81a7673058865e3e12e3768868">ruby_finalize_1</a>(<span class="keywordtype">void</span>)
<a name="l00098"></a>00098 {
<a name="l00099"></a>00099     <a class="code" href="../../db/d2e/intern_8h.html#ae0fc89013d9cf6ab2afea16f82750789">ruby_sig_finalize</a>();
<a name="l00100"></a>00100     <a class="code" href="../../d8/d32/vm__core_8h.html#a8deb84ec6023e3229db88ac2c9da6138">GET_THREAD</a>()-&gt;errinfo = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a320970f989dc8294c8203154e3db40c1">Qnil</a>;
<a name="l00101"></a>00101     <a class="code" href="../../d8/d16/gc_8c.html#ac23f4325e1613f037383bfa0a925a81e">rb_gc_call_finalizer_at_exit</a>();
<a name="l00102"></a>00102 }
<a name="l00103"></a>00103 
<a name="l00104"></a>00104 <span class="keywordtype">void</span>
<a name="l00105"></a><a class="code" href="../../db/d2e/intern_8h.html#a5efbdb123063db473a9b82d8250c0b96">00105</a> <a class="code" href="../../d3/d57/eval_8c.html#a5efbdb123063db473a9b82d8250c0b96">ruby_finalize</a>(<span class="keywordtype">void</span>)
<a name="l00106"></a>00106 {
<a name="l00107"></a>00107     <a class="code" href="../../d3/d57/eval_8c.html#a0e202191d97655d76b47a8965e3b9b66">ruby_finalize_0</a>();
<a name="l00108"></a>00108     <a class="code" href="../../d3/d57/eval_8c.html#a28424d81a7673058865e3e12e3768868">ruby_finalize_1</a>();
<a name="l00109"></a>00109 }
<a name="l00110"></a>00110 
<a name="l00111"></a>00111 <span class="keywordtype">int</span>
<a name="l00112"></a><a class="code" href="../../db/d2e/intern_8h.html#ad9a4bb7e06e2ea58231480dc5b3abcdc">00112</a> <a class="code" href="../../d3/d57/eval_8c.html#a9ed88aaffd7cc6e96903df0b31956d88">ruby_cleanup</a>(<span class="keyword">volatile</span> <span class="keywordtype">int</span> ex)
<a name="l00113"></a>00113 {
<a name="l00114"></a>00114     <span class="keywordtype">int</span> <a class="code" href="../../d5/d1d/gb18030_8c.html#adc6e5733fc3c22f0a7b2914188c49c90">state</a>;
<a name="l00115"></a>00115     <span class="keyword">volatile</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> errs[2];
<a name="l00116"></a>00116     <a class="code" href="../../d2/d66/structrb__thread__struct.html">rb_thread_t</a> *th = <a class="code" href="../../d8/d32/vm__core_8h.html#a8deb84ec6023e3229db88ac2c9da6138">GET_THREAD</a>();
<a name="l00117"></a>00117     <span class="keywordtype">int</span> nerr;
<a name="l00118"></a>00118 
<a name="l00119"></a>00119     <a class="code" href="../../d3/de7/thread_8c.html#ac46256e91e4796220065f97cd0842a10">rb_threadptr_interrupt</a>(th);
<a name="l00120"></a>00120     <a class="code" href="../../d3/de7/thread_8c.html#a1ef1042de9adc6b17f182fe1d0466342">rb_threadptr_check_signal</a>(th);
<a name="l00121"></a>00121     <a class="code" href="../../dd/dd0/eval__intern_8h.html#ac0e28e3418925cd969f30157281642bf">PUSH_TAG</a>();
<a name="l00122"></a>00122     <span class="keywordflow">if</span> ((state = <a class="code" href="../../dd/dd0/eval__intern_8h.html#a3441e3967c633da99c3dcd025494053e">EXEC_TAG</a>()) == 0) {
<a name="l00123"></a>00123         <a class="code" href="../../dd/dd0/eval__intern_8h.html#ae04396c4a051215fa7a77469d9547933">SAVE_ROOT_JMPBUF</a>(th, { <a class="code" href="../../d8/d32/vm__core_8h.html#aa94ad6b88de1b239d85ddb282a26a23e">RUBY_VM_CHECK_INTS</a>(); });
<a name="l00124"></a>00124     }
<a name="l00125"></a>00125     <a class="code" href="../../dd/dd0/eval__intern_8h.html#accfba89bbfaf289dc5fff2d2f235f2f1">POP_TAG</a>();
<a name="l00126"></a>00126 
<a name="l00127"></a>00127     errs[1] = th-&gt;<a class="code" href="../../d2/d66/structrb__thread__struct.html#a173e2da61fa57c7044fd7874a8c7a924">errinfo</a>;
<a name="l00128"></a>00128     th-&gt;<a class="code" href="../../d2/d66/structrb__thread__struct.html#adc5048ddde96e3ea2e6b22c3e58ce696">safe_level</a> = 0;
<a name="l00129"></a>00129     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ab7d9aa9836c379212b86b985909f7303">ruby_init_stack</a>(&amp;errs[<a class="code" href="../../d0/daa/gc_8h.html#ad79961092b2737e9102a9bcf9ca2dbed">STACK_UPPER</a>(errs, 0, 1)]);
<a name="l00130"></a>00130 
<a name="l00131"></a>00131     <a class="code" href="../../dd/dd0/eval__intern_8h.html#ac0e28e3418925cd969f30157281642bf">PUSH_TAG</a>();
<a name="l00132"></a>00132     <span class="keywordflow">if</span> ((state = <a class="code" href="../../dd/dd0/eval__intern_8h.html#a3441e3967c633da99c3dcd025494053e">EXEC_TAG</a>()) == 0) {
<a name="l00133"></a>00133         <a class="code" href="../../dd/dd0/eval__intern_8h.html#ae04396c4a051215fa7a77469d9547933">SAVE_ROOT_JMPBUF</a>(th, <a class="code" href="../../d3/d57/eval_8c.html#a0e202191d97655d76b47a8965e3b9b66">ruby_finalize_0</a>());
<a name="l00134"></a>00134     }
<a name="l00135"></a>00135     <a class="code" href="../../dd/dd0/eval__intern_8h.html#accfba89bbfaf289dc5fff2d2f235f2f1">POP_TAG</a>();
<a name="l00136"></a>00136 
<a name="l00137"></a>00137     errs[0] = th-&gt;<a class="code" href="../../d2/d66/structrb__thread__struct.html#a173e2da61fa57c7044fd7874a8c7a924">errinfo</a>;
<a name="l00138"></a>00138     <a class="code" href="../../dd/dd0/eval__intern_8h.html#ac0e28e3418925cd969f30157281642bf">PUSH_TAG</a>();
<a name="l00139"></a>00139     <span class="keywordflow">if</span> ((state = <a class="code" href="../../dd/dd0/eval__intern_8h.html#a3441e3967c633da99c3dcd025494053e">EXEC_TAG</a>()) == 0) {
<a name="l00140"></a>00140         <a class="code" href="../../dd/dd0/eval__intern_8h.html#ae04396c4a051215fa7a77469d9547933">SAVE_ROOT_JMPBUF</a>(th, <a class="code" href="../../dd/dd0/eval__intern_8h.html#a8e4269ed2cb019b35ffc45e1e69a335b">rb_thread_terminate_all</a>());
<a name="l00141"></a>00141     }
<a name="l00142"></a>00142     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ex == 0) {
<a name="l00143"></a>00143         ex = state;
<a name="l00144"></a>00144     }
<a name="l00145"></a>00145     th-&gt;<a class="code" href="../../d2/d66/structrb__thread__struct.html#a173e2da61fa57c7044fd7874a8c7a924">errinfo</a> = errs[1];
<a name="l00146"></a>00146     ex = <a class="code" href="../../d5/d1d/eval__error_8c.html#a2a46db9211e42178912e4c974c391238">error_handle</a>(ex);
<a name="l00147"></a>00147     <a class="code" href="../../d3/d57/eval_8c.html#a28424d81a7673058865e3e12e3768868">ruby_finalize_1</a>();
<a name="l00148"></a>00148 
<a name="l00149"></a>00149     <span class="comment">/* unlock again if finalizer took mutexes. */</span>
<a name="l00150"></a>00150     <a class="code" href="../../d3/de7/thread_8c.html#aa411c64669553c03fd84487a7b700d1c">rb_threadptr_unlock_all_locking_mutexes</a>(<a class="code" href="../../d8/d32/vm__core_8h.html#a8deb84ec6023e3229db88ac2c9da6138">GET_THREAD</a>());
<a name="l00151"></a>00151     <a class="code" href="../../dd/dd0/eval__intern_8h.html#accfba89bbfaf289dc5fff2d2f235f2f1">POP_TAG</a>();
<a name="l00152"></a>00152     <a class="code" href="../../d3/de7/thread_8c.html#aee3187a245b600621afed826f8338f36">rb_thread_stop_timer_thread</a>(1);
<a name="l00153"></a>00153 
<a name="l00154"></a>00154 <span class="preprocessor">#if EXIT_SUCCESS != 0 || EXIT_FAILURE != 1</span>
<a name="l00155"></a>00155 <span class="preprocessor"></span>    <span class="keywordflow">switch</span> (ex) {
<a name="l00156"></a>00156 <span class="preprocessor">#if EXIT_SUCCESS != 0</span>
<a name="l00157"></a>00157 <span class="preprocessor"></span>      <span class="keywordflow">case</span> 0: ex = <a class="code" href="../../db/dcc/error_8c.html#a687984f47d8cce148d1b914d2b79612a">EXIT_SUCCESS</a>; <span class="keywordflow">break</span>;
<a name="l00158"></a>00158 <span class="preprocessor">#endif</span>
<a name="l00159"></a>00159 <span class="preprocessor"></span><span class="preprocessor">#if EXIT_FAILURE != 1</span>
<a name="l00160"></a>00160 <span class="preprocessor"></span>      <span class="keywordflow">case</span> 1: ex = <a class="code" href="../../dd/dd0/eval__intern_8h.html#a73efe787c131b385070f25d18b7c9aa4">EXIT_FAILURE</a>; <span class="keywordflow">break</span>;
<a name="l00161"></a>00161 <span class="preprocessor">#endif</span>
<a name="l00162"></a>00162 <span class="preprocessor"></span>    }
<a name="l00163"></a>00163 <span class="preprocessor">#endif</span>
<a name="l00164"></a>00164 <span class="preprocessor"></span>
<a name="l00165"></a>00165     state = 0;
<a name="l00166"></a>00166     <span class="keywordflow">for</span> (nerr = 0; nerr &lt; <a class="code" href="../../dc/dcc/array_8c.html#a4ac8fee05a285361c33a2b0d9c2d555c">numberof</a>(errs); ++nerr) {
<a name="l00167"></a>00167         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <a class="code" href="../../d5/df2/win32_8c.html#a6ce68847c12434f60d1b2654a3dc3409">err</a> = errs[nerr];
<a name="l00168"></a>00168 
<a name="l00169"></a>00169         <span class="keywordflow">if</span> (!<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a117741045763c090b26e30a85bd0e0a6">RTEST</a>(err)) <span class="keywordflow">continue</span>;
<a name="l00170"></a>00170 
<a name="l00171"></a>00171         <span class="comment">/* th-&gt;errinfo contains a NODE while break&apos;ing */</span>
<a name="l00172"></a>00172         <span class="keywordflow">if</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a394faf7191f18552a20cb17ce14226f0">TYPE</a>(err) == <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a5f1cc49c4da51d5bdffa64be79ff6fb0">T_NODE</a>) <span class="keywordflow">continue</span>;
<a name="l00173"></a>00173 
<a name="l00174"></a>00174         <span class="keywordflow">if</span> (<a class="code" href="../../db/d2e/intern_8h.html#a6e65fc310dd65ebd60d68ada991da6f6">rb_obj_is_kind_of</a>(err, <a class="code" href="../../db/dcc/error_8c.html#a34c7841e8f21712bc79d7bd6f64483b3">rb_eSystemExit</a>)) {
<a name="l00175"></a>00175             ex = <a class="code" href="../../d5/d1d/eval__error_8c.html#a101535c9924e37baf8475b9ed6742c29">sysexit_status</a>(err);
<a name="l00176"></a>00176             <span class="keywordflow">break</span>;
<a name="l00177"></a>00177         }
<a name="l00178"></a>00178         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../db/d2e/intern_8h.html#a6e65fc310dd65ebd60d68ada991da6f6">rb_obj_is_kind_of</a>(err, <a class="code" href="../../db/dcc/error_8c.html#afe50bdef992922d9d0a0b1110bacb016">rb_eSignal</a>)) {
<a name="l00179"></a>00179             <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> sig = <a class="code" href="../../db/d2e/intern_8h.html#ad05f3639fd927a08b07d12e2960936d4">rb_iv_get</a>(err, <span class="stringliteral">&quot;signo&quot;</span>);
<a name="l00180"></a>00180             state = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a877c38180d23c5447d976c70dda89d69">NUM2INT</a>(sig);
<a name="l00181"></a>00181             <span class="keywordflow">break</span>;
<a name="l00182"></a>00182         }
<a name="l00183"></a>00183         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ex == <a class="code" href="../../db/dcc/error_8c.html#a687984f47d8cce148d1b914d2b79612a">EXIT_SUCCESS</a>) {
<a name="l00184"></a>00184             ex = <a class="code" href="../../dd/dd0/eval__intern_8h.html#a73efe787c131b385070f25d18b7c9aa4">EXIT_FAILURE</a>;
<a name="l00185"></a>00185         }
<a name="l00186"></a>00186     }
<a name="l00187"></a>00187     <a class="code" href="../../da/d0a/vm_8h.html#a64b7830f0ac2f5c4e03c3659051b3e4b">ruby_vm_destruct</a>(<a class="code" href="../../d8/d32/vm__core_8h.html#a6cfcd3997994924c8cd13c3b5c099ec6">GET_VM</a>());
<a name="l00188"></a>00188     <span class="keywordflow">if</span> (state) <a class="code" href="../../db/d2e/intern_8h.html#ae1c2fc2fe1ebf3e93695130f0ed2d5c9">ruby_default_signal</a>(state);
<a name="l00189"></a>00189 
<a name="l00190"></a>00190     <span class="keywordflow">return</span> ex;
<a name="l00191"></a>00191 }
<a name="l00192"></a>00192 
<a name="l00193"></a>00193 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l00194"></a><a class="code" href="../../d3/d57/eval_8c.html#a9041378e26e9277492c32c684849df31">00194</a> <a class="code" href="../../d3/d57/eval_8c.html#a9041378e26e9277492c32c684849df31">ruby_exec_internal</a>(<span class="keywordtype">void</span> *n)
<a name="l00195"></a>00195 {
<a name="l00196"></a>00196     <span class="keyword">volatile</span> <span class="keywordtype">int</span> <a class="code" href="../../d5/d1d/gb18030_8c.html#adc6e5733fc3c22f0a7b2914188c49c90">state</a>;
<a name="l00197"></a>00197     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> iseq = (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>)n;
<a name="l00198"></a>00198     <a class="code" href="../../d2/d66/structrb__thread__struct.html">rb_thread_t</a> *th = <a class="code" href="../../d8/d32/vm__core_8h.html#a8deb84ec6023e3229db88ac2c9da6138">GET_THREAD</a>();
<a name="l00199"></a>00199 
<a name="l00200"></a>00200     <span class="keywordflow">if</span> (!n) <span class="keywordflow">return</span> 0;
<a name="l00201"></a>00201 
<a name="l00202"></a>00202     <a class="code" href="../../dd/dd0/eval__intern_8h.html#ac0e28e3418925cd969f30157281642bf">PUSH_TAG</a>();
<a name="l00203"></a>00203     <span class="keywordflow">if</span> ((state = <a class="code" href="../../dd/dd0/eval__intern_8h.html#a3441e3967c633da99c3dcd025494053e">EXEC_TAG</a>()) == 0) {
<a name="l00204"></a>00204         <a class="code" href="../../dd/dd0/eval__intern_8h.html#ae04396c4a051215fa7a77469d9547933">SAVE_ROOT_JMPBUF</a>(th, {
<a name="l00205"></a>00205             th-&gt;<a class="code" href="../../d2/d66/structrb__thread__struct.html#aad6cc8c9d9f511c12cca5af8c8aa6e77">base_block</a> = 0;
<a name="l00206"></a>00206             <a class="code" href="../../de/de9/vm_8c.html#a1561358bc5896c1fd390837e6faeb45f">rb_iseq_eval_main</a>(iseq);
<a name="l00207"></a>00207         });
<a name="l00208"></a>00208     }
<a name="l00209"></a>00209     <a class="code" href="../../dd/dd0/eval__intern_8h.html#accfba89bbfaf289dc5fff2d2f235f2f1">POP_TAG</a>();
<a name="l00210"></a>00210     <span class="keywordflow">return</span> state;
<a name="l00211"></a>00211 }
<a name="l00212"></a>00212 
<a name="l00213"></a>00213 <span class="keywordtype">void</span>
<a name="l00214"></a><a class="code" href="../../d3/d57/eval_8c.html#a47d7347c6190a6a0160902a894a55dae">00214</a> <a class="code" href="../../d3/d57/eval_8c.html#a47d7347c6190a6a0160902a894a55dae">ruby_stop</a>(<span class="keywordtype">int</span> ex)
<a name="l00215"></a>00215 {
<a name="l00216"></a>00216     exit(<a class="code" href="../../d3/d57/eval_8c.html#a9ed88aaffd7cc6e96903df0b31956d88">ruby_cleanup</a>(ex));
<a name="l00217"></a>00217 }
<a name="l00218"></a>00218 
<a name="l00219"></a>00219 <span class="keywordtype">int</span>
<a name="l00220"></a><a class="code" href="../../de/de6/ruby_2ruby_8h.html#af1e7523c41d03fef5f1ed44b4a00c80f">00220</a> <a class="code" href="../../d3/d57/eval_8c.html#af1e7523c41d03fef5f1ed44b4a00c80f">ruby_executable_node</a>(<span class="keywordtype">void</span> *n, <span class="keywordtype">int</span> *status)
<a name="l00221"></a>00221 {
<a name="l00222"></a>00222     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> v = (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>)n;
<a name="l00223"></a>00223     <span class="keywordtype">int</span> s;
<a name="l00224"></a>00224 
<a name="l00225"></a>00225     <span class="keywordflow">switch</span> (v) {
<a name="l00226"></a>00226       <span class="keywordflow">case</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aacea3516b33941ce8149098e223a7466">Qtrue</a>:  s = <a class="code" href="../../db/dcc/error_8c.html#a687984f47d8cce148d1b914d2b79612a">EXIT_SUCCESS</a>; <span class="keywordflow">break</span>;
<a name="l00227"></a>00227       <span class="keywordflow">case</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aba0717d2689eb68797421a02ab9295c6">Qfalse</a>: s = <a class="code" href="../../dd/dd0/eval__intern_8h.html#a73efe787c131b385070f25d18b7c9aa4">EXIT_FAILURE</a>; <span class="keywordflow">break</span>;
<a name="l00228"></a>00228       <span class="keywordflow">default</span>:
<a name="l00229"></a>00229         <span class="keywordflow">if</span> (!<a class="code" href="../../de/de6/ruby_2ruby_8h.html#acf2fcf97dcf9c7c35452730eb3e2aeb2">FIXNUM_P</a>(v)) <span class="keywordflow">return</span> <a class="code" href="../../d1/d5c/nkf_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00230"></a>00230         s = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a9444c431b3cb1184e7523fc572f2c758">FIX2INT</a>(v);
<a name="l00231"></a>00231     }
<a name="l00232"></a>00232     <span class="keywordflow">if</span> (status) *status = s;
<a name="l00233"></a>00233     <span class="keywordflow">return</span> <a class="code" href="../../d1/d5c/nkf_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00234"></a>00234 }
<a name="l00235"></a>00235 
<a name="l00236"></a>00236 <span class="keywordtype">int</span>
<a name="l00237"></a><a class="code" href="../../de/de6/ruby_2ruby_8h.html#a51d48a44030d6d47f385ad691935cabf">00237</a> <a class="code" href="../../d0/d22/goruby_8c.html#a363efd3b81046ed07af9eeb1489bc30b">ruby_run_node</a>(<span class="keywordtype">void</span> *n)
<a name="l00238"></a>00238 {
<a name="l00239"></a>00239     <span class="keywordtype">int</span> status;
<a name="l00240"></a>00240     <span class="keywordflow">if</span> (!<a class="code" href="../../d3/d57/eval_8c.html#af1e7523c41d03fef5f1ed44b4a00c80f">ruby_executable_node</a>(n, &amp;status)) {
<a name="l00241"></a>00241         <a class="code" href="../../d3/d57/eval_8c.html#a9ed88aaffd7cc6e96903df0b31956d88">ruby_cleanup</a>(0);
<a name="l00242"></a>00242         <span class="keywordflow">return</span> status;
<a name="l00243"></a>00243     }
<a name="l00244"></a>00244     <span class="keywordflow">return</span> <a class="code" href="../../d3/d57/eval_8c.html#a9ed88aaffd7cc6e96903df0b31956d88">ruby_cleanup</a>(<a class="code" href="../../d3/d57/eval_8c.html#a37e32e7c9181dda6e68eb8e9627baf0c">ruby_exec_node</a>(n));
<a name="l00245"></a>00245 }
<a name="l00246"></a>00246 
<a name="l00247"></a>00247 <span class="keywordtype">int</span>
<a name="l00248"></a><a class="code" href="../../de/de6/ruby_2ruby_8h.html#aa8ab92fa66ba44c3480ec04f0a47676f">00248</a> <a class="code" href="../../d3/d57/eval_8c.html#a37e32e7c9181dda6e68eb8e9627baf0c">ruby_exec_node</a>(<span class="keywordtype">void</span> *n)
<a name="l00249"></a>00249 {
<a name="l00250"></a>00250     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ab7d9aa9836c379212b86b985909f7303">ruby_init_stack</a>((<span class="keywordtype">void</span> *)&amp;n);
<a name="l00251"></a>00251     <span class="keywordflow">return</span> <a class="code" href="../../d3/d57/eval_8c.html#a9041378e26e9277492c32c684849df31">ruby_exec_internal</a>(n);
<a name="l00252"></a>00252 }
<a name="l00253"></a>00253 
<a name="l00254"></a>00254 <span class="comment">/*</span>
<a name="l00255"></a>00255 <span class="comment"> *  call-seq:</span>
<a name="l00256"></a>00256 <span class="comment"> *     Module.nesting    -&gt; array</span>
<a name="l00257"></a>00257 <span class="comment"> *</span>
<a name="l00258"></a>00258 <span class="comment"> *  Returns the list of +Modules+ nested at the point of call.</span>
<a name="l00259"></a>00259 <span class="comment"> *</span>
<a name="l00260"></a>00260 <span class="comment"> *     module M1</span>
<a name="l00261"></a>00261 <span class="comment"> *       module M2</span>
<a name="l00262"></a>00262 <span class="comment"> *         $a = Module.nesting</span>
<a name="l00263"></a>00263 <span class="comment"> *       end</span>
<a name="l00264"></a>00264 <span class="comment"> *     end</span>
<a name="l00265"></a>00265 <span class="comment"> *     $a           #=&gt; [M1::M2, M1]</span>
<a name="l00266"></a>00266 <span class="comment"> *     $a[0].name   #=&gt; &quot;M1::M2&quot;</span>
<a name="l00267"></a>00267 <span class="comment"> */</span>
<a name="l00268"></a>00268 
<a name="l00269"></a>00269 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l00270"></a><a class="code" href="../../d3/d57/eval_8c.html#ad6fa4b5b5bddb1fe097beaa8ba048fea">00270</a> <a class="code" href="../../d3/d57/eval_8c.html#ad6fa4b5b5bddb1fe097beaa8ba048fea">rb_mod_nesting</a>(<span class="keywordtype">void</span>)
<a name="l00271"></a>00271 {
<a name="l00272"></a>00272     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> ary = <a class="code" href="../../dc/dcc/array_8c.html#a9518114fd36cb4ef4656ec1dc63348c9">rb_ary_new</a>();
<a name="l00273"></a>00273     <span class="keyword">const</span> NODE *cref = <a class="code" href="../../dd/dd0/eval__intern_8h.html#a148afe59d50d9a0f3bde4d9968d8a2f5">rb_vm_cref</a>();
<a name="l00274"></a>00274 
<a name="l00275"></a>00275     <span class="keywordflow">while</span> (cref &amp;&amp; cref-&gt;nd_next) {
<a name="l00276"></a>00276         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> klass = cref-&gt;nd_clss;
<a name="l00277"></a>00277         <span class="keywordflow">if</span> (!(cref-&gt;flags &amp; <a class="code" href="../../d3/d09/ripper_8y.html#a9406fd129ecdab137a8540b5aec60bfb">NODE_FL_CREF_PUSHED_BY_EVAL</a>) &amp;&amp;
<a name="l00278"></a>00278             !<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a4832bad8845a35fc50f7a160901854a1">NIL_P</a>(klass)) {
<a name="l00279"></a>00279             <a class="code" href="../../dc/dcc/array_8c.html#a59d553a8cd781364b8bcb0deae25cca2">rb_ary_push</a>(ary, klass);
<a name="l00280"></a>00280         }
<a name="l00281"></a>00281         cref = cref-&gt;nd_next;
<a name="l00282"></a>00282     }
<a name="l00283"></a>00283     <span class="keywordflow">return</span> ary;
<a name="l00284"></a>00284 }
<a name="l00285"></a>00285 
<a name="l00286"></a>00286 <span class="comment">/*</span>
<a name="l00287"></a>00287 <span class="comment"> *  call-seq:</span>
<a name="l00288"></a>00288 <span class="comment"> *     Module.constants   -&gt; array</span>
<a name="l00289"></a>00289 <span class="comment"> *     Module.constants(inherited)   -&gt; array</span>
<a name="l00290"></a>00290 <span class="comment"> *</span>
<a name="l00291"></a>00291 <span class="comment"> *  In the first form, returns an array of the names of all</span>
<a name="l00292"></a>00292 <span class="comment"> *  constants accessible from the point of call.</span>
<a name="l00293"></a>00293 <span class="comment"> *  This list includes the names of all modules and classes</span>
<a name="l00294"></a>00294 <span class="comment"> *  defined in the global scope.</span>
<a name="l00295"></a>00295 <span class="comment"> *</span>
<a name="l00296"></a>00296 <span class="comment"> *     Module.constants.first(4)</span>
<a name="l00297"></a>00297 <span class="comment"> *        # =&gt; [:ARGF, :ARGV, :ArgumentError, :Array]</span>
<a name="l00298"></a>00298 <span class="comment"> *</span>
<a name="l00299"></a>00299 <span class="comment"> *     Module.constants.include?(:SEEK_SET)   # =&gt; false</span>
<a name="l00300"></a>00300 <span class="comment"> *</span>
<a name="l00301"></a>00301 <span class="comment"> *     class IO</span>
<a name="l00302"></a>00302 <span class="comment"> *       Module.constants.include?(:SEEK_SET) # =&gt; true</span>
<a name="l00303"></a>00303 <span class="comment"> *     end</span>
<a name="l00304"></a>00304 <span class="comment"> *</span>
<a name="l00305"></a>00305 <span class="comment"> *  The second form calls the instance method +constants+.</span>
<a name="l00306"></a>00306 <span class="comment"> */</span>
<a name="l00307"></a>00307 
<a name="l00308"></a>00308 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l00309"></a><a class="code" href="../../d3/d57/eval_8c.html#ac10a70a3c86b4daee46e13f25c18178d">00309</a> <a class="code" href="../../d3/d57/eval_8c.html#ac10a70a3c86b4daee46e13f25c18178d">rb_mod_s_constants</a>(<span class="keywordtype">int</span> <a class="code" href="../../df/d77/ruby_8c.html#ad1447518f4372828b8435ae82e48499e">argc</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> *<a class="code" href="../../df/d77/ruby_8c.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <a class="code" href="../../d1/d6f/date__strftime_8c.html#aa84d960185b18347956518e4d00766b4">mod</a>)
<a name="l00310"></a>00310 {
<a name="l00311"></a>00311     <span class="keyword">const</span> NODE *cref = <a class="code" href="../../dd/dd0/eval__intern_8h.html#a148afe59d50d9a0f3bde4d9968d8a2f5">rb_vm_cref</a>();
<a name="l00312"></a>00312     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> klass;
<a name="l00313"></a>00313     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> cbase = 0;
<a name="l00314"></a>00314     <span class="keywordtype">void</span> *data = 0;
<a name="l00315"></a>00315 
<a name="l00316"></a>00316     <span class="keywordflow">if</span> (argc &gt; 0) {
<a name="l00317"></a>00317         <span class="keywordflow">return</span> <a class="code" href="../../db/d2e/intern_8h.html#a21c2334bc5af5641baba32aa49fa44b7">rb_mod_constants</a>(argc, argv, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ad35b93cf98ae9c41f3394fd51383f774">rb_cModule</a>);
<a name="l00318"></a>00318     }
<a name="l00319"></a>00319 
<a name="l00320"></a>00320     <span class="keywordflow">while</span> (cref) {
<a name="l00321"></a>00321         klass = cref-&gt;nd_clss;
<a name="l00322"></a>00322         <span class="keywordflow">if</span> (!(cref-&gt;flags &amp; <a class="code" href="../../d3/d09/ripper_8y.html#a9406fd129ecdab137a8540b5aec60bfb">NODE_FL_CREF_PUSHED_BY_EVAL</a>) &amp;&amp;
<a name="l00323"></a>00323             !<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a4832bad8845a35fc50f7a160901854a1">NIL_P</a>(klass)) {
<a name="l00324"></a>00324             data = <a class="code" href="../../db/d2e/intern_8h.html#a525c62da571744411721ea424c3c1f82">rb_mod_const_at</a>(cref-&gt;nd_clss, data);
<a name="l00325"></a>00325             <span class="keywordflow">if</span> (!cbase) {
<a name="l00326"></a>00326                 cbase = klass;
<a name="l00327"></a>00327             }
<a name="l00328"></a>00328         }
<a name="l00329"></a>00329         cref = cref-&gt;nd_next;
<a name="l00330"></a>00330     }
<a name="l00331"></a>00331 
<a name="l00332"></a>00332     <span class="keywordflow">if</span> (cbase) {
<a name="l00333"></a>00333         data = <a class="code" href="../../db/d2e/intern_8h.html#af4f2ac89183b58e001fc95c31f24510d">rb_mod_const_of</a>(cbase, data);
<a name="l00334"></a>00334     }
<a name="l00335"></a>00335     <span class="keywordflow">return</span> <a class="code" href="../../db/d2e/intern_8h.html#a2d7c1c1a91c9fed34f18d2d060f719b5">rb_const_list</a>(data);
<a name="l00336"></a>00336 }
<a name="l00337"></a>00337 
<a name="l00338"></a>00338 <span class="keywordtype">void</span>
<a name="l00339"></a><a class="code" href="../../db/d2e/intern_8h.html#a87c965c3d941b2fa480c09ad63797a43">00339</a> <a class="code" href="../../d3/d57/eval_8c.html#ab67dfbc570c0707224ff634290846a54">rb_frozen_class_p</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> klass)
<a name="l00340"></a>00340 {
<a name="l00341"></a>00341     <span class="keyword">const</span> <span class="keywordtype">char</span> *desc = <span class="stringliteral">&quot;something(?!)&quot;</span>;
<a name="l00342"></a>00342 
<a name="l00343"></a>00343     <span class="keywordflow">if</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a73db79f74bad2fb5258a2ae7ee6ef117">OBJ_FROZEN</a>(klass)) {
<a name="l00344"></a>00344         <span class="keywordflow">if</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a1ae918b6cc84188a9dc6ab545f732e4d">FL_TEST</a>(klass, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a081b5172ef37829bb3a258cd1ad393bc">FL_SINGLETON</a>))
<a name="l00345"></a>00345             desc = <span class="stringliteral">&quot;object&quot;</span>;
<a name="l00346"></a>00346         <span class="keywordflow">else</span> {
<a name="l00347"></a>00347             <span class="keywordflow">switch</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a394faf7191f18552a20cb17ce14226f0">TYPE</a>(klass)) {
<a name="l00348"></a>00348               <span class="keywordflow">case</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a6cdc7dfe8f84777325da08a96ae5f795">T_MODULE</a>:
<a name="l00349"></a>00349               <span class="keywordflow">case</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a82c8c4569748b9645c958b9eaeaabb81">T_ICLASS</a>:
<a name="l00350"></a>00350                 desc = <span class="stringliteral">&quot;module&quot;</span>;
<a name="l00351"></a>00351                 <span class="keywordflow">break</span>;
<a name="l00352"></a>00352               <span class="keywordflow">case</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ad04c63d175774c6d6e7dfaf0f0a982c9">T_CLASS</a>:
<a name="l00353"></a>00353                 desc = <span class="stringliteral">&quot;class&quot;</span>;
<a name="l00354"></a>00354                 <span class="keywordflow">break</span>;
<a name="l00355"></a>00355             }
<a name="l00356"></a>00356         }
<a name="l00357"></a>00357         <a class="code" href="../../db/dcc/error_8c.html#a43f95a8ece1ff4fb9aaf61a26fb4f345">rb_error_frozen</a>(desc);
<a name="l00358"></a>00358     }
<a name="l00359"></a>00359 }
<a name="l00360"></a>00360 
<a name="l00361"></a>00361 <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a7a711d5127a34da8c3ed48f401579289">NORETURN</a>(<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/d57/eval_8c.html#a7eced32b6e0f949d6e01d491355ef56d">rb_longjmp</a>(<span class="keywordtype">int</span>, <span class="keyword">volatile</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>));
<a name="l00362"></a>00362 
<a name="l00363"></a>00363 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00364"></a><a class="code" href="../../d3/d57/eval_8c.html#af0913129306ef2263a4260fedf9736b8">00364</a> <a class="code" href="../../d3/d57/eval_8c.html#af0913129306ef2263a4260fedf9736b8">setup_exception</a>(<a class="code" href="../../d2/d66/structrb__thread__struct.html">rb_thread_t</a> *th, <span class="keywordtype">int</span> tag, <span class="keyword">volatile</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> mesg)
<a name="l00365"></a>00365 {
<a name="l00366"></a>00366     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> at;
<a name="l00367"></a>00367     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> e;
<a name="l00368"></a>00368     <span class="keyword">const</span> <span class="keywordtype">char</span> *file;
<a name="l00369"></a>00369     <span class="keyword">volatile</span> <span class="keywordtype">int</span> line = 0;
<a name="l00370"></a>00370 
<a name="l00371"></a>00371     <span class="keywordflow">if</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a4832bad8845a35fc50f7a160901854a1">NIL_P</a>(mesg)) {
<a name="l00372"></a>00372         mesg = th-&gt;<a class="code" href="../../d2/d66/structrb__thread__struct.html#a173e2da61fa57c7044fd7874a8c7a924">errinfo</a>;
<a name="l00373"></a>00373         <span class="keywordflow">if</span> (<a class="code" href="../../dd/dd0/eval__intern_8h.html#a440e34bdbd19fc24b8ede36df5fd656a">INTERNAL_EXCEPTION_P</a>(mesg)) <a class="code" href="../../dd/dd0/eval__intern_8h.html#a24884166ae699029ade34fd36bedd688">JUMP_TAG</a>(<a class="code" href="../../dd/dd0/eval__intern_8h.html#a7490e601d6a9d97a79d4d895ad73c93a">TAG_FATAL</a>);
<a name="l00374"></a>00374     }
<a name="l00375"></a>00375     <span class="keywordflow">if</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a4832bad8845a35fc50f7a160901854a1">NIL_P</a>(mesg)) {
<a name="l00376"></a>00376         mesg = <a class="code" href="../../db/dcc/error_8c.html#aab1a41e4022b414d0334959ae7dd3b21">rb_exc_new</a>(<a class="code" href="../../db/dcc/error_8c.html#a95ad3953d535707e2cf2b1d837f5e253">rb_eRuntimeError</a>, 0, 0);
<a name="l00377"></a>00377     }
<a name="l00378"></a>00378 
<a name="l00379"></a>00379     file = <a class="code" href="../../d5/d9d/tcltklib_8c.html#aaa4f8c9b566fd7fb6873866c423c2016">rb_sourcefile</a>();
<a name="l00380"></a>00380     <span class="keywordflow">if</span> (file) line = <a class="code" href="../../db/d2e/intern_8h.html#af5f87f9d39ea7433dc0de2f655bd6359">rb_sourceline</a>();
<a name="l00381"></a>00381     <span class="keywordflow">if</span> (file &amp;&amp; !<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a4832bad8845a35fc50f7a160901854a1">NIL_P</a>(mesg)) {
<a name="l00382"></a>00382         <span class="keywordflow">if</span> (mesg == <a class="code" href="../../d8/d32/vm__core_8h.html#a7acad2ca9baf84e4d6cb6e68cd3da73f">sysstack_error</a>) {
<a name="l00383"></a>00383             at = <a class="code" href="../../d9/d2d/sprintf_8c.html#a216ef515f4c79ee337820c5f637b802c">rb_enc_sprintf</a>(<a class="code" href="../../d5/db5/encoding_8c.html#a1e215012f16414c044f6a212973c95a8">rb_usascii_encoding</a>(), <span class="stringliteral">&quot;%s:%d&quot;</span>, file, line);
<a name="l00384"></a>00384             at = <a class="code" href="../../dc/dcc/array_8c.html#a8317ecd6a0abb5ad08c50c732f30059b">rb_ary_new3</a>(1, at);
<a name="l00385"></a>00385             <a class="code" href="../../db/d2e/intern_8h.html#a7e5b0d4c40fecb26c1ac946f674a690e">rb_iv_set</a>(mesg, <span class="stringliteral">&quot;bt&quot;</span>, at);
<a name="l00386"></a>00386         }
<a name="l00387"></a>00387         <span class="keywordflow">else</span> {
<a name="l00388"></a>00388             at = <a class="code" href="../../d5/d1d/eval__error_8c.html#a8c5771bb88d43a65e3e3b2d50ac41574">get_backtrace</a>(mesg);
<a name="l00389"></a>00389             <span class="keywordflow">if</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a4832bad8845a35fc50f7a160901854a1">NIL_P</a>(at)) {
<a name="l00390"></a>00390                 at = <a class="code" href="../../db/d2e/intern_8h.html#af0aa399e9d58b72afe77901446157a04">rb_make_backtrace</a>();
<a name="l00391"></a>00391                 <span class="keywordflow">if</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a73db79f74bad2fb5258a2ae7ee6ef117">OBJ_FROZEN</a>(mesg)) {
<a name="l00392"></a>00392                     mesg = <a class="code" href="../../db/d2e/intern_8h.html#a303b384bd946cba1101841237c5c27d0">rb_obj_dup</a>(mesg);
<a name="l00393"></a>00393                 }
<a name="l00394"></a>00394                 <a class="code" href="../../d5/d1d/eval__error_8c.html#a7c6f670a9d7255ea9226fb230f7657c4">set_backtrace</a>(mesg, at);
<a name="l00395"></a>00395             }
<a name="l00396"></a>00396         }
<a name="l00397"></a>00397     }
<a name="l00398"></a>00398     <span class="keywordflow">if</span> (!<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a4832bad8845a35fc50f7a160901854a1">NIL_P</a>(mesg)) {
<a name="l00399"></a>00399         th-&gt;<a class="code" href="../../d2/d66/structrb__thread__struct.html#a173e2da61fa57c7044fd7874a8c7a924">errinfo</a> = mesg;
<a name="l00400"></a>00400     }
<a name="l00401"></a>00401 
<a name="l00402"></a>00402     <span class="keywordflow">if</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a117741045763c090b26e30a85bd0e0a6">RTEST</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a01ed2eb085103197c53c2b5c63b8f637">ruby_debug</a>) &amp;&amp; !<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a4832bad8845a35fc50f7a160901854a1">NIL_P</a>(e = th-&gt;<a class="code" href="../../d2/d66/structrb__thread__struct.html#a173e2da61fa57c7044fd7874a8c7a924">errinfo</a>) &amp;&amp;
<a name="l00403"></a>00403         !<a class="code" href="../../db/d2e/intern_8h.html#a6e65fc310dd65ebd60d68ada991da6f6">rb_obj_is_kind_of</a>(e, <a class="code" href="../../db/dcc/error_8c.html#a34c7841e8f21712bc79d7bd6f64483b3">rb_eSystemExit</a>)) {
<a name="l00404"></a>00404         <span class="keywordtype">int</span> status;
<a name="l00405"></a>00405 
<a name="l00406"></a>00406         <a class="code" href="../../dd/dd0/eval__intern_8h.html#ac0e28e3418925cd969f30157281642bf">PUSH_TAG</a>();
<a name="l00407"></a>00407         <span class="keywordflow">if</span> ((status = <a class="code" href="../../dd/dd0/eval__intern_8h.html#a3441e3967c633da99c3dcd025494053e">EXEC_TAG</a>()) == 0) {
<a name="l00408"></a>00408             <a class="code" href="../../d8/df4/generator_8h.html#ad2bf389f3fddea7bd3befa162c70561a">RB_GC_GUARD</a>(e) = <a class="code" href="../../db/d2e/intern_8h.html#acae5350f5d539c4654e4e33690256a9f">rb_obj_as_string</a>(e);
<a name="l00409"></a>00409             <span class="keywordflow">if</span> (file &amp;&amp; line) {
<a name="l00410"></a>00410                 <a class="code" href="../../d5/d1d/eval__error_8c.html#a6dcd8084483016da9ae3be01ae42bcbd">warn_printf</a>(<span class="stringliteral">&quot;Exception `%s&apos; at %s:%d - %s\n&quot;</span>,
<a name="l00411"></a>00411                             <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a9b4f42ada717bfbe7a78830639476aed">rb_obj_classname</a>(th-&gt;<a class="code" href="../../d2/d66/structrb__thread__struct.html#a173e2da61fa57c7044fd7874a8c7a924">errinfo</a>),
<a name="l00412"></a>00412                             file, line, <a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(e));
<a name="l00413"></a>00413             }
<a name="l00414"></a>00414             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (file) {
<a name="l00415"></a>00415                 <a class="code" href="../../d5/d1d/eval__error_8c.html#a6dcd8084483016da9ae3be01ae42bcbd">warn_printf</a>(<span class="stringliteral">&quot;Exception `%s&apos; at %s - %s\n&quot;</span>,
<a name="l00416"></a>00416                             <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a9b4f42ada717bfbe7a78830639476aed">rb_obj_classname</a>(th-&gt;<a class="code" href="../../d2/d66/structrb__thread__struct.html#a173e2da61fa57c7044fd7874a8c7a924">errinfo</a>),
<a name="l00417"></a>00417                             file, <a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(e));
<a name="l00418"></a>00418             }
<a name="l00419"></a>00419             <span class="keywordflow">else</span> {
<a name="l00420"></a>00420                 <a class="code" href="../../d5/d1d/eval__error_8c.html#a6dcd8084483016da9ae3be01ae42bcbd">warn_printf</a>(<span class="stringliteral">&quot;Exception `%s&apos; - %s\n&quot;</span>,
<a name="l00421"></a>00421                             <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a9b4f42ada717bfbe7a78830639476aed">rb_obj_classname</a>(th-&gt;<a class="code" href="../../d2/d66/structrb__thread__struct.html#a173e2da61fa57c7044fd7874a8c7a924">errinfo</a>),
<a name="l00422"></a>00422                             <a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(e));
<a name="l00423"></a>00423             }
<a name="l00424"></a>00424         }
<a name="l00425"></a>00425         <a class="code" href="../../dd/dd0/eval__intern_8h.html#accfba89bbfaf289dc5fff2d2f235f2f1">POP_TAG</a>();
<a name="l00426"></a>00426         <span class="keywordflow">if</span> (status == <a class="code" href="../../dd/dd0/eval__intern_8h.html#a7490e601d6a9d97a79d4d895ad73c93a">TAG_FATAL</a> &amp;&amp; th-&gt;<a class="code" href="../../d2/d66/structrb__thread__struct.html#a173e2da61fa57c7044fd7874a8c7a924">errinfo</a> == <a class="code" href="../../d3/d57/eval_8c.html#a8a9edae7f9045c2c18fb899dc8823e68">exception_error</a>) {
<a name="l00427"></a>00427             th-&gt;<a class="code" href="../../d2/d66/structrb__thread__struct.html#a173e2da61fa57c7044fd7874a8c7a924">errinfo</a> = mesg;
<a name="l00428"></a>00428         }
<a name="l00429"></a>00429         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (status) {
<a name="l00430"></a>00430             <a class="code" href="../../dd/dd0/eval__intern_8h.html#a6512318e5e31b15826e44b778e45b6d2">rb_threadptr_reset_raised</a>(th);
<a name="l00431"></a>00431             <a class="code" href="../../dd/dd0/eval__intern_8h.html#a24884166ae699029ade34fd36bedd688">JUMP_TAG</a>(status);
<a name="l00432"></a>00432         }
<a name="l00433"></a>00433     }
<a name="l00434"></a>00434 
<a name="l00435"></a>00435     <span class="keywordflow">if</span> (<a class="code" href="../../dd/dd0/eval__intern_8h.html#a3514e2b9aa4169e9b24f1d2bdf586b00">rb_threadptr_set_raised</a>(th)) {
<a name="l00436"></a>00436         th-&gt;<a class="code" href="../../d2/d66/structrb__thread__struct.html#a173e2da61fa57c7044fd7874a8c7a924">errinfo</a> = <a class="code" href="../../d3/d57/eval_8c.html#a8a9edae7f9045c2c18fb899dc8823e68">exception_error</a>;
<a name="l00437"></a>00437         <a class="code" href="../../dd/dd0/eval__intern_8h.html#a6512318e5e31b15826e44b778e45b6d2">rb_threadptr_reset_raised</a>(th);
<a name="l00438"></a>00438         <a class="code" href="../../dd/dd0/eval__intern_8h.html#a24884166ae699029ade34fd36bedd688">JUMP_TAG</a>(<a class="code" href="../../dd/dd0/eval__intern_8h.html#a7490e601d6a9d97a79d4d895ad73c93a">TAG_FATAL</a>);
<a name="l00439"></a>00439     }
<a name="l00440"></a>00440 
<a name="l00441"></a>00441     <a class="code" href="../../dd/dd0/eval__intern_8h.html#a1cd4f6c8cf208511a51931e828c76593">rb_trap_restore_mask</a>();
<a name="l00442"></a>00442 
<a name="l00443"></a>00443     <span class="keywordflow">if</span> (tag != <a class="code" href="../../dd/dd0/eval__intern_8h.html#a7490e601d6a9d97a79d4d895ad73c93a">TAG_FATAL</a>) {
<a name="l00444"></a>00444         <a class="code" href="../../d8/d32/vm__core_8h.html#a724eed84e4b041ec1867e198ee129192">EXEC_EVENT_HOOK</a>(th, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a154f51ed6ab72cff2e819dc5c089105f">RUBY_EVENT_RAISE</a>, th-&gt;<a class="code" href="../../d2/d66/structrb__thread__struct.html#a2ed7f694d58d876aa6f0fae6986bc921">cfp</a>-&gt;<a class="code" href="../../dd/d84/structrb__control__frame__t.html#a4c11a50358317e1207affd6d7b4ad576">self</a>, 0, 0);
<a name="l00445"></a>00445     }
<a name="l00446"></a>00446 }
<a name="l00447"></a>00447 
<a name="l00448"></a>00448 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00449"></a><a class="code" href="../../d3/d57/eval_8c.html#a7eced32b6e0f949d6e01d491355ef56d">00449</a> <a class="code" href="../../d3/d57/eval_8c.html#a7eced32b6e0f949d6e01d491355ef56d">rb_longjmp</a>(<span class="keywordtype">int</span> tag, <span class="keyword">volatile</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> mesg)
<a name="l00450"></a>00450 {
<a name="l00451"></a>00451     <a class="code" href="../../d2/d66/structrb__thread__struct.html">rb_thread_t</a> *th = <a class="code" href="../../d8/d32/vm__core_8h.html#a8deb84ec6023e3229db88ac2c9da6138">GET_THREAD</a>();
<a name="l00452"></a>00452     <a class="code" href="../../d3/d57/eval_8c.html#af0913129306ef2263a4260fedf9736b8">setup_exception</a>(th, tag, mesg);
<a name="l00453"></a>00453     <a class="code" href="../../dd/dd0/eval__intern_8h.html#a4a34b7bc20283967d79d84b2f236dda4">rb_thread_raised_clear</a>(th);
<a name="l00454"></a>00454     <a class="code" href="../../dd/dd0/eval__intern_8h.html#a24884166ae699029ade34fd36bedd688">JUMP_TAG</a>(tag);
<a name="l00455"></a>00455 }
<a name="l00456"></a>00456 
<a name="l00457"></a>00457 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <a class="code" href="../../d3/d57/eval_8c.html#a77333a33565b0f193c7f79900a6352c0">make_exception</a>(<span class="keywordtype">int</span> <a class="code" href="../../df/d77/ruby_8c.html#ad1447518f4372828b8435ae82e48499e">argc</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> *<a class="code" href="../../df/d77/ruby_8c.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>, <span class="keywordtype">int</span> isstr);
<a name="l00458"></a>00458 
<a name="l00459"></a>00459 <span class="keywordtype">void</span>
<a name="l00460"></a><a class="code" href="../../d3/d57/eval_8c.html#a237939d28c83950b84fb6a45ccca53a0">00460</a> <a class="code" href="../../d3/d57/eval_8c.html#a237939d28c83950b84fb6a45ccca53a0">rb_exc_raise</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> mesg)
<a name="l00461"></a>00461 {
<a name="l00462"></a>00462     <span class="keywordflow">if</span> (!<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a4832bad8845a35fc50f7a160901854a1">NIL_P</a>(mesg)) {
<a name="l00463"></a>00463         mesg = <a class="code" href="../../d3/d57/eval_8c.html#a77333a33565b0f193c7f79900a6352c0">make_exception</a>(1, &amp;mesg, <a class="code" href="../../d1/d5c/nkf_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>);
<a name="l00464"></a>00464     }
<a name="l00465"></a>00465     <a class="code" href="../../d3/d57/eval_8c.html#a7eced32b6e0f949d6e01d491355ef56d">rb_longjmp</a>(<a class="code" href="../../dd/dd0/eval__intern_8h.html#a0b034bce069147e233776bc1dcc74c01">TAG_RAISE</a>, mesg);
<a name="l00466"></a>00466 }
<a name="l00467"></a>00467 
<a name="l00468"></a>00468 <span class="keywordtype">void</span>
<a name="l00469"></a><a class="code" href="../../d3/d57/eval_8c.html#a8f9180b3900ec87c7aecc0f0597c08b2">00469</a> <a class="code" href="../../d3/d57/eval_8c.html#a8f9180b3900ec87c7aecc0f0597c08b2">rb_exc_fatal</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> mesg)
<a name="l00470"></a>00470 {
<a name="l00471"></a>00471     <span class="keywordflow">if</span> (!<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a4832bad8845a35fc50f7a160901854a1">NIL_P</a>(mesg)) {
<a name="l00472"></a>00472         mesg = <a class="code" href="../../d3/d57/eval_8c.html#a77333a33565b0f193c7f79900a6352c0">make_exception</a>(1, &amp;mesg, <a class="code" href="../../d1/d5c/nkf_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>);
<a name="l00473"></a>00473     }
<a name="l00474"></a>00474     <a class="code" href="../../d3/d57/eval_8c.html#a7eced32b6e0f949d6e01d491355ef56d">rb_longjmp</a>(<a class="code" href="../../dd/dd0/eval__intern_8h.html#a7490e601d6a9d97a79d4d895ad73c93a">TAG_FATAL</a>, mesg);
<a name="l00475"></a>00475 }
<a name="l00476"></a>00476 
<a name="l00477"></a>00477 <span class="keywordtype">void</span>
<a name="l00478"></a><a class="code" href="../../db/d2e/intern_8h.html#a4d8d5988dde879949caf90661fcbf6c9">00478</a> <a class="code" href="../../d3/d57/eval_8c.html#a4d8d5988dde879949caf90661fcbf6c9">rb_interrupt</a>(<span class="keywordtype">void</span>)
<a name="l00479"></a>00479 {
<a name="l00480"></a>00480     <a class="code" href="../../db/dcc/error_8c.html#a0f771a2840561f1838169b3d7d4616f3">rb_raise</a>(<a class="code" href="../../db/dcc/error_8c.html#a8378eac5be044398a53aca753116817b">rb_eInterrupt</a>, <span class="stringliteral">&quot;%s&quot;</span>, <span class="stringliteral">&quot;&quot;</span>);
<a name="l00481"></a>00481 }
<a name="l00482"></a>00482 
<a name="l00483"></a>00483 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <a class="code" href="../../d3/d57/eval_8c.html#a04b7c381dd86f77646019756d25a149e">get_errinfo</a>(<span class="keywordtype">void</span>);
<a name="l00484"></a>00484 
<a name="l00485"></a>00485 <span class="comment">/*</span>
<a name="l00486"></a>00486 <span class="comment"> *  call-seq:</span>
<a name="l00487"></a>00487 <span class="comment"> *     raise</span>
<a name="l00488"></a>00488 <span class="comment"> *     raise(string)</span>
<a name="l00489"></a>00489 <span class="comment"> *     raise(exception [, string [, array]])</span>
<a name="l00490"></a>00490 <span class="comment"> *     fail</span>
<a name="l00491"></a>00491 <span class="comment"> *     fail(string)</span>
<a name="l00492"></a>00492 <span class="comment"> *     fail(exception [, string [, array]])</span>
<a name="l00493"></a>00493 <span class="comment"> *</span>
<a name="l00494"></a>00494 <span class="comment"> *  With no arguments, raises the exception in &lt;code&gt;$!&lt;/code&gt; or raises</span>
<a name="l00495"></a>00495 <span class="comment"> *  a &lt;code&gt;RuntimeError&lt;/code&gt; if &lt;code&gt;$!&lt;/code&gt; is +nil+.</span>
<a name="l00496"></a>00496 <span class="comment"> *  With a single +String+ argument, raises a</span>
<a name="l00497"></a>00497 <span class="comment"> *  +RuntimeError+ with the string as a message. Otherwise,</span>
<a name="l00498"></a>00498 <span class="comment"> *  the first parameter should be the name of an +Exception+</span>
<a name="l00499"></a>00499 <span class="comment"> *  class (or an object that returns an +Exception+ object when sent</span>
<a name="l00500"></a>00500 <span class="comment"> *  an +exception+ message). The optional second parameter sets the</span>
<a name="l00501"></a>00501 <span class="comment"> *  message associated with the exception, and the third parameter is an</span>
<a name="l00502"></a>00502 <span class="comment"> *  array of callback information. Exceptions are caught by the</span>
<a name="l00503"></a>00503 <span class="comment"> *  +rescue+ clause of &lt;code&gt;begin...end&lt;/code&gt; blocks.</span>
<a name="l00504"></a>00504 <span class="comment"> *</span>
<a name="l00505"></a>00505 <span class="comment"> *     raise &quot;Failed to create socket&quot;</span>
<a name="l00506"></a>00506 <span class="comment"> *     raise ArgumentError, &quot;No parameters&quot;, caller</span>
<a name="l00507"></a>00507 <span class="comment"> */</span>
<a name="l00508"></a>00508 
<a name="l00509"></a>00509 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l00510"></a><a class="code" href="../../d3/d57/eval_8c.html#a24cf0af9fab4e1d1968a229bed775d9f">00510</a> <a class="code" href="../../d3/d57/eval_8c.html#a24cf0af9fab4e1d1968a229bed775d9f">rb_f_raise</a>(<span class="keywordtype">int</span> <a class="code" href="../../df/d77/ruby_8c.html#ad1447518f4372828b8435ae82e48499e">argc</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> *<a class="code" href="../../df/d77/ruby_8c.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>)
<a name="l00511"></a>00511 {
<a name="l00512"></a>00512     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <a class="code" href="../../d5/df2/win32_8c.html#a6ce68847c12434f60d1b2654a3dc3409">err</a>;
<a name="l00513"></a>00513     <span class="keywordflow">if</span> (argc == 0) {
<a name="l00514"></a>00514         err = <a class="code" href="../../d3/d57/eval_8c.html#a04b7c381dd86f77646019756d25a149e">get_errinfo</a>();
<a name="l00515"></a>00515         <span class="keywordflow">if</span> (!<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a4832bad8845a35fc50f7a160901854a1">NIL_P</a>(err)) {
<a name="l00516"></a>00516             argc = 1;
<a name="l00517"></a>00517             argv = &amp;err;
<a name="l00518"></a>00518         }
<a name="l00519"></a>00519     }
<a name="l00520"></a>00520     <a class="code" href="../../d3/d57/eval_8c.html#a6d01f6401233090eaa124a57ced0fb3a">rb_raise_jump</a>(<a class="code" href="../../d3/d57/eval_8c.html#ad34672a68a00c2f8b30502646b9d4ee0">rb_make_exception</a>(argc, argv));
<a name="l00521"></a>00521     <span class="keywordflow">return</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a320970f989dc8294c8203154e3db40c1">Qnil</a>;                <span class="comment">/* not reached */</span>
<a name="l00522"></a>00522 }
<a name="l00523"></a>00523 
<a name="l00524"></a>00524 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l00525"></a><a class="code" href="../../d3/d57/eval_8c.html#a77333a33565b0f193c7f79900a6352c0">00525</a> <a class="code" href="../../d3/d57/eval_8c.html#a77333a33565b0f193c7f79900a6352c0">make_exception</a>(<span class="keywordtype">int</span> <a class="code" href="../../df/d77/ruby_8c.html#ad1447518f4372828b8435ae82e48499e">argc</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> *<a class="code" href="../../df/d77/ruby_8c.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>, <span class="keywordtype">int</span> isstr)
<a name="l00526"></a>00526 {
<a name="l00527"></a>00527     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> mesg;
<a name="l00528"></a>00528     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#afa5b9137f051ac26d7ccc8824f178233">ID</a> exception;
<a name="l00529"></a>00529     <span class="keywordtype">int</span> n;
<a name="l00530"></a>00530 
<a name="l00531"></a>00531     mesg = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a320970f989dc8294c8203154e3db40c1">Qnil</a>;
<a name="l00532"></a>00532     <span class="keywordflow">switch</span> (argc) {
<a name="l00533"></a>00533       <span class="keywordflow">case</span> 0:
<a name="l00534"></a>00534         <span class="keywordflow">break</span>;
<a name="l00535"></a>00535       <span class="keywordflow">case</span> 1:
<a name="l00536"></a>00536         <span class="keywordflow">if</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a4832bad8845a35fc50f7a160901854a1">NIL_P</a>(argv[0]))
<a name="l00537"></a>00537             <span class="keywordflow">break</span>;
<a name="l00538"></a>00538         <span class="keywordflow">if</span> (isstr) {
<a name="l00539"></a>00539             mesg = <a class="code" href="../../db/d2e/intern_8h.html#a669b6063704b2d304844bd1553217cf0">rb_check_string_type</a>(argv[0]);
<a name="l00540"></a>00540             <span class="keywordflow">if</span> (!<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a4832bad8845a35fc50f7a160901854a1">NIL_P</a>(mesg)) {
<a name="l00541"></a>00541                 mesg = <a class="code" href="../../db/dcc/error_8c.html#a4989eeb5742cad6359a2ed77859674de">rb_exc_new3</a>(<a class="code" href="../../db/dcc/error_8c.html#a95ad3953d535707e2cf2b1d837f5e253">rb_eRuntimeError</a>, mesg);
<a name="l00542"></a>00542                 <span class="keywordflow">break</span>;
<a name="l00543"></a>00543             }
<a name="l00544"></a>00544         }
<a name="l00545"></a>00545         n = 0;
<a name="l00546"></a>00546         <span class="keywordflow">goto</span> exception_call;
<a name="l00547"></a>00547 
<a name="l00548"></a>00548       <span class="keywordflow">case</span> 2:
<a name="l00549"></a>00549       <span class="keywordflow">case</span> 3:
<a name="l00550"></a>00550         n = 1;
<a name="l00551"></a>00551       exception_call:
<a name="l00552"></a>00552         <span class="keywordflow">if</span> (argv[0] == <a class="code" href="../../d8/d32/vm__core_8h.html#a7acad2ca9baf84e4d6cb6e68cd3da73f">sysstack_error</a>) <span class="keywordflow">return</span> argv[0];
<a name="l00553"></a>00553         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aa50b9d5bc665eb5545f6857c89232161">CONST_ID</a>(exception, <span class="stringliteral">&quot;exception&quot;</span>);
<a name="l00554"></a>00554         mesg = <a class="code" href="../../db/d2e/intern_8h.html#a9c3f641e5ef22868b06b3ae22a640f18">rb_check_funcall</a>(argv[0], exception, n, argv+1);
<a name="l00555"></a>00555         <span class="keywordflow">if</span> (mesg == <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a2edf6990280eb2637623ccd421dee4f0">Qundef</a>) {
<a name="l00556"></a>00556             <a class="code" href="../../db/dcc/error_8c.html#a0f771a2840561f1838169b3d7d4616f3">rb_raise</a>(<a class="code" href="../../db/dcc/error_8c.html#a565ed9d70f4089e1b4a36e9b3381b8c6">rb_eTypeError</a>, <span class="stringliteral">&quot;exception class/object expected&quot;</span>);
<a name="l00557"></a>00557         }
<a name="l00558"></a>00558         <span class="keywordflow">break</span>;
<a name="l00559"></a>00559       <span class="keywordflow">default</span>:
<a name="l00560"></a>00560         <a class="code" href="../../db/dcc/error_8c.html#a0f771a2840561f1838169b3d7d4616f3">rb_raise</a>(<a class="code" href="../../db/dcc/error_8c.html#ab5e2a9fec766c75176fbb262bfe6a596">rb_eArgError</a>, <span class="stringliteral">&quot;wrong number of arguments (%d for 0..3)&quot;</span>, argc);
<a name="l00561"></a>00561         <span class="keywordflow">break</span>;
<a name="l00562"></a>00562     }
<a name="l00563"></a>00563     <span class="keywordflow">if</span> (argc &gt; 0) {
<a name="l00564"></a>00564         <span class="keywordflow">if</span> (!<a class="code" href="../../db/d2e/intern_8h.html#a6e65fc310dd65ebd60d68ada991da6f6">rb_obj_is_kind_of</a>(mesg, <a class="code" href="../../db/dcc/error_8c.html#ac5bd9245454f935493c41daa4f2651ae">rb_eException</a>))
<a name="l00565"></a>00565             <a class="code" href="../../db/dcc/error_8c.html#a0f771a2840561f1838169b3d7d4616f3">rb_raise</a>(<a class="code" href="../../db/dcc/error_8c.html#a565ed9d70f4089e1b4a36e9b3381b8c6">rb_eTypeError</a>, <span class="stringliteral">&quot;exception object expected&quot;</span>);
<a name="l00566"></a>00566         <span class="keywordflow">if</span> (argc &gt; 2)
<a name="l00567"></a>00567             <a class="code" href="../../d5/d1d/eval__error_8c.html#a7c6f670a9d7255ea9226fb230f7657c4">set_backtrace</a>(mesg, argv[2]);
<a name="l00568"></a>00568     }
<a name="l00569"></a>00569 
<a name="l00570"></a>00570     <span class="keywordflow">return</span> mesg;
<a name="l00571"></a>00571 }
<a name="l00572"></a>00572 
<a name="l00573"></a>00573 <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l00574"></a><a class="code" href="../../db/d2e/intern_8h.html#a1f2a77775f17eaf22822472d5a364bfe">00574</a> <a class="code" href="../../d3/d57/eval_8c.html#ad34672a68a00c2f8b30502646b9d4ee0">rb_make_exception</a>(<span class="keywordtype">int</span> <a class="code" href="../../df/d77/ruby_8c.html#ad1447518f4372828b8435ae82e48499e">argc</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> *<a class="code" href="../../df/d77/ruby_8c.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>)
<a name="l00575"></a>00575 {
<a name="l00576"></a>00576     <span class="keywordflow">return</span> <a class="code" href="../../d3/d57/eval_8c.html#a77333a33565b0f193c7f79900a6352c0">make_exception</a>(argc, argv, <a class="code" href="../../d1/d5c/nkf_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l00577"></a>00577 }
<a name="l00578"></a>00578 
<a name="l00579"></a>00579 <span class="keywordtype">void</span>
<a name="l00580"></a><a class="code" href="../../d3/d57/eval_8c.html#a6d01f6401233090eaa124a57ced0fb3a">00580</a> <a class="code" href="../../d3/d57/eval_8c.html#a6d01f6401233090eaa124a57ced0fb3a">rb_raise_jump</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> mesg)
<a name="l00581"></a>00581 {
<a name="l00582"></a>00582     <a class="code" href="../../d2/d66/structrb__thread__struct.html">rb_thread_t</a> *th = <a class="code" href="../../d8/d32/vm__core_8h.html#a8deb84ec6023e3229db88ac2c9da6138">GET_THREAD</a>();
<a name="l00583"></a>00583     <a class="code" href="../../dd/d84/structrb__control__frame__t.html">rb_control_frame_t</a> *cfp = th-&gt;<a class="code" href="../../d2/d66/structrb__thread__struct.html#a2ed7f694d58d876aa6f0fae6986bc921">cfp</a>;
<a name="l00584"></a>00584     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> klass = cfp-&gt;<a class="code" href="../../dd/d84/structrb__control__frame__t.html#aa0ec76f80ebaf0668b688c4e4e5e3e3f">me</a>-&gt;<a class="code" href="../../d7/db7/structrb__method__entry__struct.html#a9ce0871480ac405b00673b25234738de">klass</a>;
<a name="l00585"></a>00585     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <span class="keyword">self</span> = cfp-&gt;<a class="code" href="../../dd/d84/structrb__control__frame__t.html#a4c11a50358317e1207affd6d7b4ad576">self</a>;
<a name="l00586"></a>00586     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#afa5b9137f051ac26d7ccc8824f178233">ID</a> mid = cfp-&gt;<a class="code" href="../../dd/d84/structrb__control__frame__t.html#aa0ec76f80ebaf0668b688c4e4e5e3e3f">me</a>-&gt;<a class="code" href="../../d7/db7/structrb__method__entry__struct.html#a31439bd620e98940410ba59244a85eae">called_id</a>;
<a name="l00587"></a>00587 
<a name="l00588"></a>00588     th-&gt;<a class="code" href="../../d2/d66/structrb__thread__struct.html#a2ed7f694d58d876aa6f0fae6986bc921">cfp</a> = <a class="code" href="../../d8/d32/vm__core_8h.html#af087c881c3c493e3a4e326852e8ed2a9">RUBY_VM_PREVIOUS_CONTROL_FRAME</a>(th-&gt;<a class="code" href="../../d2/d66/structrb__thread__struct.html#a2ed7f694d58d876aa6f0fae6986bc921">cfp</a>);
<a name="l00589"></a>00589 
<a name="l00590"></a>00590     <a class="code" href="../../d3/d57/eval_8c.html#af0913129306ef2263a4260fedf9736b8">setup_exception</a>(th, <a class="code" href="../../dd/dd0/eval__intern_8h.html#a0b034bce069147e233776bc1dcc74c01">TAG_RAISE</a>, mesg);
<a name="l00591"></a>00591 
<a name="l00592"></a>00592     <a class="code" href="../../d8/d32/vm__core_8h.html#a724eed84e4b041ec1867e198ee129192">EXEC_EVENT_HOOK</a>(th, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aa8f8ed837ea1ef257ef6575f6785ca34">RUBY_EVENT_C_RETURN</a>, <span class="keyword">self</span>, mid, klass);
<a name="l00593"></a>00593     <a class="code" href="../../dd/dd0/eval__intern_8h.html#a4a34b7bc20283967d79d84b2f236dda4">rb_thread_raised_clear</a>(th);
<a name="l00594"></a>00594     <a class="code" href="../../dd/dd0/eval__intern_8h.html#a24884166ae699029ade34fd36bedd688">JUMP_TAG</a>(<a class="code" href="../../dd/dd0/eval__intern_8h.html#a0b034bce069147e233776bc1dcc74c01">TAG_RAISE</a>);
<a name="l00595"></a>00595 }
<a name="l00596"></a>00596 
<a name="l00597"></a>00597 <span class="keywordtype">void</span>
<a name="l00598"></a><a class="code" href="../../d3/d57/eval_8c.html#ae48d70c45901eab8b89fb181fc9d1f3b">00598</a> <a class="code" href="../../d3/d57/eval_8c.html#ae48d70c45901eab8b89fb181fc9d1f3b">rb_jump_tag</a>(<span class="keywordtype">int</span> tag)
<a name="l00599"></a>00599 {
<a name="l00600"></a>00600     <a class="code" href="../../dd/dd0/eval__intern_8h.html#a24884166ae699029ade34fd36bedd688">JUMP_TAG</a>(tag);
<a name="l00601"></a>00601 }
<a name="l00602"></a>00602 
<a name="l00603"></a>00603 <span class="keywordtype">int</span>
<a name="l00604"></a><a class="code" href="../../de/de6/ruby_2ruby_8h.html#aea346c4eb8bc06df88422e956bb05fec">00604</a> <a class="code" href="../../d3/d57/eval_8c.html#aea346c4eb8bc06df88422e956bb05fec">rb_block_given_p</a>(<span class="keywordtype">void</span>)
<a name="l00605"></a>00605 {
<a name="l00606"></a>00606     <a class="code" href="../../d2/d66/structrb__thread__struct.html">rb_thread_t</a> *th = <a class="code" href="../../d8/d32/vm__core_8h.html#a8deb84ec6023e3229db88ac2c9da6138">GET_THREAD</a>();
<a name="l00607"></a>00607 
<a name="l00608"></a>00608     <span class="keywordflow">if</span> ((th-&gt;<a class="code" href="../../d2/d66/structrb__thread__struct.html#a2ed7f694d58d876aa6f0fae6986bc921">cfp</a>-&gt;<a class="code" href="../../dd/d84/structrb__control__frame__t.html#af3314cb37c8a27353101bf6f35574946">lfp</a>[0] &amp; 0x02) == 0 &amp;&amp;
<a name="l00609"></a>00609         <a class="code" href="../../d8/d32/vm__core_8h.html#a373f1cafd944ff9e99986582d0fd695b">GC_GUARDED_PTR_REF</a>(th-&gt;<a class="code" href="../../d2/d66/structrb__thread__struct.html#a2ed7f694d58d876aa6f0fae6986bc921">cfp</a>-&gt;<a class="code" href="../../dd/d84/structrb__control__frame__t.html#af3314cb37c8a27353101bf6f35574946">lfp</a>[0])) {
<a name="l00610"></a>00610         <span class="keywordflow">return</span> <a class="code" href="../../d1/d5c/nkf_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00611"></a>00611     }
<a name="l00612"></a>00612     <span class="keywordflow">else</span> {
<a name="l00613"></a>00613         <span class="keywordflow">return</span> <a class="code" href="../../d1/d5c/nkf_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00614"></a>00614     }
<a name="l00615"></a>00615 }
<a name="l00616"></a>00616 
<a name="l00617"></a>00617 <span class="keywordtype">int</span>
<a name="l00618"></a><a class="code" href="../../d3/d57/eval_8c.html#a9a8895fcdfdbff21aa30ddf92c1e4e6d">00618</a> <a class="code" href="../../d3/d57/eval_8c.html#a9a8895fcdfdbff21aa30ddf92c1e4e6d">rb_iterator_p</a>(<span class="keywordtype">void</span>)
<a name="l00619"></a>00619 {
<a name="l00620"></a>00620     <span class="keywordflow">return</span> <a class="code" href="../../d3/d57/eval_8c.html#aea346c4eb8bc06df88422e956bb05fec">rb_block_given_p</a>();
<a name="l00621"></a>00621 }
<a name="l00622"></a>00622 
<a name="l00623"></a><a class="code" href="../../d3/d57/eval_8c.html#af1c44c481affdca9f221f315a12601bf">00623</a> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <a class="code" href="../../d3/d57/eval_8c.html#af1c44c481affdca9f221f315a12601bf">rb_eThreadError</a>;
<a name="l00624"></a>00624 
<a name="l00625"></a>00625 <span class="keywordtype">void</span>
<a name="l00626"></a><a class="code" href="../../de/de6/ruby_2ruby_8h.html#a49604e794ae31041198e7750d1d28481">00626</a> <a class="code" href="../../d3/d57/eval_8c.html#a49604e794ae31041198e7750d1d28481">rb_need_block</a>(<span class="keywordtype">void</span>)
<a name="l00627"></a>00627 {
<a name="l00628"></a>00628     <span class="keywordflow">if</span> (!<a class="code" href="../../d3/d57/eval_8c.html#aea346c4eb8bc06df88422e956bb05fec">rb_block_given_p</a>()) {
<a name="l00629"></a>00629         <a class="code" href="../../de/de9/vm_8c.html#a0402672d92f48e0018ab5f8aeda270e6">rb_vm_localjump_error</a>(<span class="stringliteral">&quot;no block given&quot;</span>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a320970f989dc8294c8203154e3db40c1">Qnil</a>, 0);
<a name="l00630"></a>00630     }
<a name="l00631"></a>00631 }
<a name="l00632"></a>00632 
<a name="l00633"></a>00633 <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l00634"></a><a class="code" href="../../de/de6/ruby_2ruby_8h.html#a1706fdd8f7668611284373af56e11e5b">00634</a> <a class="code" href="../../d3/d57/eval_8c.html#a2e28de157b82ffc63ecff4782dba649c">rb_rescue2</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> (* b_proc) (<a class="code" href="../../d8/db0/defines_8h.html#af4fd7cbafda9af704310f78516042dfb">ANYARGS</a>), <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> data1,
<a name="l00635"></a>00635            <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> (* r_proc) (<a class="code" href="../../d8/db0/defines_8h.html#af4fd7cbafda9af704310f78516042dfb">ANYARGS</a>), <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> data2, ...)
<a name="l00636"></a>00636 {
<a name="l00637"></a>00637     <span class="keywordtype">int</span> <a class="code" href="../../d5/d1d/gb18030_8c.html#adc6e5733fc3c22f0a7b2914188c49c90">state</a>;
<a name="l00638"></a>00638     <a class="code" href="../../d2/d66/structrb__thread__struct.html">rb_thread_t</a> *th = <a class="code" href="../../d8/d32/vm__core_8h.html#a8deb84ec6023e3229db88ac2c9da6138">GET_THREAD</a>();
<a name="l00639"></a>00639     <a class="code" href="../../dd/d84/structrb__control__frame__t.html">rb_control_frame_t</a> *cfp = th-&gt;<a class="code" href="../../d2/d66/structrb__thread__struct.html#a2ed7f694d58d876aa6f0fae6986bc921">cfp</a>;
<a name="l00640"></a>00640     <span class="keyword">volatile</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <a class="code" href="../../d8/d90/nkf_8c.html#a5ea5ac7abf5cce39283e422add1067d5">result</a>;
<a name="l00641"></a>00641     <span class="keyword">volatile</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> e_info = th-&gt;<a class="code" href="../../d2/d66/structrb__thread__struct.html#a173e2da61fa57c7044fd7874a8c7a924">errinfo</a>;
<a name="l00642"></a>00642     va_list <a class="code" href="../../d3/d09/ripper_8y.html#a8187411843a6284ffb964ef3fb9fcab3">args</a>;
<a name="l00643"></a>00643 
<a name="l00644"></a>00644     <a class="code" href="../../dd/dd0/eval__intern_8h.html#ac0e28e3418925cd969f30157281642bf">PUSH_TAG</a>();
<a name="l00645"></a>00645     <span class="keywordflow">if</span> ((state = <a class="code" href="../../dd/dd0/eval__intern_8h.html#a3441e3967c633da99c3dcd025494053e">EXEC_TAG</a>()) == 0) {
<a name="l00646"></a>00646       retry_entry:
<a name="l00647"></a>00647         result = (*b_proc) (data1);
<a name="l00648"></a>00648     }
<a name="l00649"></a>00649     <span class="keywordflow">else</span> {
<a name="l00650"></a>00650         th-&gt;<a class="code" href="../../d2/d66/structrb__thread__struct.html#a2ed7f694d58d876aa6f0fae6986bc921">cfp</a> = cfp; <span class="comment">/* restore */</span>
<a name="l00651"></a>00651 
<a name="l00652"></a>00652         <span class="keywordflow">if</span> (state == <a class="code" href="../../dd/dd0/eval__intern_8h.html#a0b034bce069147e233776bc1dcc74c01">TAG_RAISE</a>) {
<a name="l00653"></a>00653             <span class="keywordtype">int</span> handle = <a class="code" href="../../d1/d5c/nkf_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00654"></a>00654             <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> eclass;
<a name="l00655"></a>00655 
<a name="l00656"></a>00656             <a class="code" href="../../d5/d9d/tcltklib_8c.html#a3a0a28ba6e22644006c9bafb793f8a2c">va_init_list</a>(args, data2);
<a name="l00657"></a>00657             <span class="keywordflow">while</span> ((eclass = va_arg(args, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>)) != 0) {
<a name="l00658"></a>00658                 <span class="keywordflow">if</span> (<a class="code" href="../../db/d2e/intern_8h.html#a6e65fc310dd65ebd60d68ada991da6f6">rb_obj_is_kind_of</a>(th-&gt;<a class="code" href="../../d2/d66/structrb__thread__struct.html#a173e2da61fa57c7044fd7874a8c7a924">errinfo</a>, eclass)) {
<a name="l00659"></a>00659                     handle = <a class="code" href="../../d1/d5c/nkf_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00660"></a>00660                     <span class="keywordflow">break</span>;
<a name="l00661"></a>00661                 }
<a name="l00662"></a>00662             }
<a name="l00663"></a>00663             va_end(args);
<a name="l00664"></a>00664 
<a name="l00665"></a>00665             <span class="keywordflow">if</span> (handle) {
<a name="l00666"></a>00666                 <span class="keywordflow">if</span> (r_proc) {
<a name="l00667"></a>00667                     <a class="code" href="../../dd/dd0/eval__intern_8h.html#ac0e28e3418925cd969f30157281642bf">PUSH_TAG</a>();
<a name="l00668"></a>00668                     <span class="keywordflow">if</span> ((state = <a class="code" href="../../dd/dd0/eval__intern_8h.html#a3441e3967c633da99c3dcd025494053e">EXEC_TAG</a>()) == 0) {
<a name="l00669"></a>00669                         result = (*r_proc) (data2, th-&gt;<a class="code" href="../../d2/d66/structrb__thread__struct.html#a173e2da61fa57c7044fd7874a8c7a924">errinfo</a>);
<a name="l00670"></a>00670                     }
<a name="l00671"></a>00671                     <a class="code" href="../../dd/dd0/eval__intern_8h.html#accfba89bbfaf289dc5fff2d2f235f2f1">POP_TAG</a>();
<a name="l00672"></a>00672                     <span class="keywordflow">if</span> (state == <a class="code" href="../../dd/dd0/eval__intern_8h.html#a277f73abdf66e83f4fc75b93d6e87b72">TAG_RETRY</a>) {
<a name="l00673"></a>00673                         state = 0;
<a name="l00674"></a>00674                         th-&gt;<a class="code" href="../../d2/d66/structrb__thread__struct.html#a173e2da61fa57c7044fd7874a8c7a924">errinfo</a> = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a320970f989dc8294c8203154e3db40c1">Qnil</a>;
<a name="l00675"></a>00675                         <span class="keywordflow">goto</span> retry_entry;
<a name="l00676"></a>00676                     }
<a name="l00677"></a>00677                 }
<a name="l00678"></a>00678                 <span class="keywordflow">else</span> {
<a name="l00679"></a>00679                     result = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a320970f989dc8294c8203154e3db40c1">Qnil</a>;
<a name="l00680"></a>00680                     state = 0;
<a name="l00681"></a>00681                 }
<a name="l00682"></a>00682                 <span class="keywordflow">if</span> (state == 0) {
<a name="l00683"></a>00683                     th-&gt;<a class="code" href="../../d2/d66/structrb__thread__struct.html#a173e2da61fa57c7044fd7874a8c7a924">errinfo</a> = e_info;
<a name="l00684"></a>00684                 }
<a name="l00685"></a>00685             }
<a name="l00686"></a>00686         }
<a name="l00687"></a>00687     }
<a name="l00688"></a>00688     <a class="code" href="../../dd/dd0/eval__intern_8h.html#accfba89bbfaf289dc5fff2d2f235f2f1">POP_TAG</a>();
<a name="l00689"></a>00689     <span class="keywordflow">if</span> (state)
<a name="l00690"></a>00690         <a class="code" href="../../dd/dd0/eval__intern_8h.html#a24884166ae699029ade34fd36bedd688">JUMP_TAG</a>(state);
<a name="l00691"></a>00691 
<a name="l00692"></a>00692     <span class="keywordflow">return</span> result;
<a name="l00693"></a>00693 }
<a name="l00694"></a>00694 
<a name="l00695"></a>00695 <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l00696"></a><a class="code" href="../../de/de6/ruby_2ruby_8h.html#a7842f83d286e4e2218c8adaac6b4a126">00696</a> <a class="code" href="../../d3/d57/eval_8c.html#a8935de1c570989c6ccc34d0336b2b75a">rb_rescue</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> (* b_proc)(<a class="code" href="../../d8/db0/defines_8h.html#af4fd7cbafda9af704310f78516042dfb">ANYARGS</a>), <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> data1,
<a name="l00697"></a>00697           <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> (* r_proc)(<a class="code" href="../../d8/db0/defines_8h.html#af4fd7cbafda9af704310f78516042dfb">ANYARGS</a>), <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> data2)
<a name="l00698"></a>00698 {
<a name="l00699"></a>00699     <span class="keywordflow">return</span> <a class="code" href="../../d3/d57/eval_8c.html#a2e28de157b82ffc63ecff4782dba649c">rb_rescue2</a>(b_proc, data1, r_proc, data2, <a class="code" href="../../db/dcc/error_8c.html#a3fc1bd0a9e1211aef38f81d600345ed9">rb_eStandardError</a>,
<a name="l00700"></a>00700                       (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>)0);
<a name="l00701"></a>00701 }
<a name="l00702"></a>00702 
<a name="l00703"></a>00703 <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l00704"></a><a class="code" href="../../db/d2e/intern_8h.html#a9704277391f6eedf7d6b47e3b2007db2">00704</a> <a class="code" href="../../d3/d57/eval_8c.html#a6aa7fb1169ed41978a16375b6f921b0e">rb_protect</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> (* proc) (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>), <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> data, <span class="keywordtype">int</span> * <a class="code" href="../../d5/d1d/gb18030_8c.html#adc6e5733fc3c22f0a7b2914188c49c90">state</a>)
<a name="l00705"></a>00705 {
<a name="l00706"></a>00706     <span class="keyword">volatile</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <a class="code" href="../../d8/d90/nkf_8c.html#a5ea5ac7abf5cce39283e422add1067d5">result</a> = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a320970f989dc8294c8203154e3db40c1">Qnil</a>;
<a name="l00707"></a>00707     <span class="keywordtype">int</span> status;
<a name="l00708"></a>00708     <a class="code" href="../../d2/d66/structrb__thread__struct.html">rb_thread_t</a> *th = <a class="code" href="../../d8/d32/vm__core_8h.html#a8deb84ec6023e3229db88ac2c9da6138">GET_THREAD</a>();
<a name="l00709"></a>00709     <a class="code" href="../../dd/d84/structrb__control__frame__t.html">rb_control_frame_t</a> *cfp = th-&gt;<a class="code" href="../../d2/d66/structrb__thread__struct.html#a2ed7f694d58d876aa6f0fae6986bc921">cfp</a>;
<a name="l00710"></a>00710     <span class="keyword">struct </span><a class="code" href="../../d5/d29/structrb__vm__protect__tag.html">rb_vm_protect_tag</a> protect_tag;
<a name="l00711"></a>00711     <a class="code" href="../../d8/d32/vm__core_8h.html#aaacd8bc40d781eb8daece677943a8132">rb_jmpbuf_t</a> org_jmpbuf;
<a name="l00712"></a>00712 
<a name="l00713"></a>00713     protect_tag.<a class="code" href="../../d5/d29/structrb__vm__protect__tag.html#a27662c6d6520000a54a146dbbfab162c">prev</a> = th-&gt;<a class="code" href="../../d2/d66/structrb__thread__struct.html#abad8fbdd52a64077a09b01ba9e813226">protect_tag</a>;
<a name="l00714"></a>00714 
<a name="l00715"></a>00715     <a class="code" href="../../dd/dd0/eval__intern_8h.html#ac0e28e3418925cd969f30157281642bf">PUSH_TAG</a>();
<a name="l00716"></a>00716     th-&gt;<a class="code" href="../../d2/d66/structrb__thread__struct.html#abad8fbdd52a64077a09b01ba9e813226">protect_tag</a> = &amp;protect_tag;
<a name="l00717"></a>00717     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a04ab67335215e8362c63ed27ae2d1c40">MEMCPY</a>(&amp;org_jmpbuf, &amp;(th)-&gt;root_jmpbuf, <a class="code" href="../../d8/d32/vm__core_8h.html#aaacd8bc40d781eb8daece677943a8132">rb_jmpbuf_t</a>, 1);
<a name="l00718"></a>00718     <span class="keywordflow">if</span> ((status = <a class="code" href="../../dd/dd0/eval__intern_8h.html#a3441e3967c633da99c3dcd025494053e">EXEC_TAG</a>()) == 0) {
<a name="l00719"></a>00719         <a class="code" href="../../dd/dd0/eval__intern_8h.html#ae04396c4a051215fa7a77469d9547933">SAVE_ROOT_JMPBUF</a>(th, result = (*proc) (data));
<a name="l00720"></a>00720     }
<a name="l00721"></a>00721     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a04ab67335215e8362c63ed27ae2d1c40">MEMCPY</a>(&amp;(th)-&gt;root_jmpbuf, &amp;org_jmpbuf, <a class="code" href="../../d8/d32/vm__core_8h.html#aaacd8bc40d781eb8daece677943a8132">rb_jmpbuf_t</a>, 1);
<a name="l00722"></a>00722     th-&gt;<a class="code" href="../../d2/d66/structrb__thread__struct.html#abad8fbdd52a64077a09b01ba9e813226">protect_tag</a> = protect_tag.<a class="code" href="../../d5/d29/structrb__vm__protect__tag.html#a27662c6d6520000a54a146dbbfab162c">prev</a>;
<a name="l00723"></a>00723     <a class="code" href="../../dd/dd0/eval__intern_8h.html#accfba89bbfaf289dc5fff2d2f235f2f1">POP_TAG</a>();
<a name="l00724"></a>00724 
<a name="l00725"></a>00725     <span class="keywordflow">if</span> (state) {
<a name="l00726"></a>00726         *state = status;
<a name="l00727"></a>00727     }
<a name="l00728"></a>00728     <span class="keywordflow">if</span> (status != 0) {
<a name="l00729"></a>00729         th-&gt;<a class="code" href="../../d2/d66/structrb__thread__struct.html#a2ed7f694d58d876aa6f0fae6986bc921">cfp</a> = cfp;
<a name="l00730"></a>00730         <span class="keywordflow">return</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a320970f989dc8294c8203154e3db40c1">Qnil</a>;
<a name="l00731"></a>00731     }
<a name="l00732"></a>00732 
<a name="l00733"></a>00733     <span class="keywordflow">return</span> result;
<a name="l00734"></a>00734 }
<a name="l00735"></a>00735 
<a name="l00736"></a>00736 <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l00737"></a><a class="code" href="../../de/de6/ruby_2ruby_8h.html#a8b1c5de6814870cca906f4a320fd10a2">00737</a> <a class="code" href="../../d3/d57/eval_8c.html#a8061198378fb16adeb931f90540b2839">rb_ensure</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> (*b_proc)(<a class="code" href="../../d8/db0/defines_8h.html#af4fd7cbafda9af704310f78516042dfb">ANYARGS</a>), <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> data1, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> (*e_proc)(<a class="code" href="../../d8/db0/defines_8h.html#af4fd7cbafda9af704310f78516042dfb">ANYARGS</a>), <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> data2)
<a name="l00738"></a>00738 {
<a name="l00739"></a>00739     <span class="keywordtype">int</span> <a class="code" href="../../d5/d1d/gb18030_8c.html#adc6e5733fc3c22f0a7b2914188c49c90">state</a>;
<a name="l00740"></a>00740     <span class="keyword">volatile</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <a class="code" href="../../d8/d90/nkf_8c.html#a5ea5ac7abf5cce39283e422add1067d5">result</a> = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a320970f989dc8294c8203154e3db40c1">Qnil</a>;
<a name="l00741"></a>00741 
<a name="l00742"></a>00742     <a class="code" href="../../dd/dd0/eval__intern_8h.html#ac0e28e3418925cd969f30157281642bf">PUSH_TAG</a>();
<a name="l00743"></a>00743     <span class="keywordflow">if</span> ((state = <a class="code" href="../../dd/dd0/eval__intern_8h.html#a3441e3967c633da99c3dcd025494053e">EXEC_TAG</a>()) == 0) {
<a name="l00744"></a>00744         result = (*b_proc) (data1);
<a name="l00745"></a>00745     }
<a name="l00746"></a>00746     <a class="code" href="../../dd/dd0/eval__intern_8h.html#accfba89bbfaf289dc5fff2d2f235f2f1">POP_TAG</a>();
<a name="l00747"></a>00747     <span class="comment">/* TODO: fix me */</span>
<a name="l00748"></a>00748     <span class="comment">/* retval = prot_tag ? prot_tag-&gt;retval : Qnil; */</span>     <span class="comment">/* save retval */</span>
<a name="l00749"></a>00749     (*e_proc) (data2);
<a name="l00750"></a>00750     <span class="keywordflow">if</span> (state)
<a name="l00751"></a>00751         <a class="code" href="../../dd/dd0/eval__intern_8h.html#a24884166ae699029ade34fd36bedd688">JUMP_TAG</a>(state);
<a name="l00752"></a>00752     <span class="keywordflow">return</span> result;
<a name="l00753"></a>00753 }
<a name="l00754"></a>00754 
<a name="l00755"></a>00755 <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="../../d7/db7/structrb__method__entry__struct.html">rb_method_entry_t</a> *
<a name="l00756"></a><a class="code" href="../../d3/d57/eval_8c.html#aba0d81133ecd0f94d4dfc3b9ee2b46aa">00756</a> <a class="code" href="../../d3/d57/eval_8c.html#aba0d81133ecd0f94d4dfc3b9ee2b46aa">method_entry_of_iseq</a>(<a class="code" href="../../dd/d84/structrb__control__frame__t.html">rb_control_frame_t</a> *cfp, <a class="code" href="../../d6/de3/structrb__iseq__struct.html">rb_iseq_t</a> *iseq)
<a name="l00757"></a>00757 {
<a name="l00758"></a>00758     <a class="code" href="../../d2/d66/structrb__thread__struct.html">rb_thread_t</a> *th = <a class="code" href="../../d8/d32/vm__core_8h.html#a8deb84ec6023e3229db88ac2c9da6138">GET_THREAD</a>();
<a name="l00759"></a>00759     <a class="code" href="../../dd/d84/structrb__control__frame__t.html">rb_control_frame_t</a> *cfp_limit;
<a name="l00760"></a>00760 
<a name="l00761"></a>00761     cfp_limit = (<a class="code" href="../../dd/d84/structrb__control__frame__t.html">rb_control_frame_t</a> *)(th-&gt;<a class="code" href="../../d2/d66/structrb__thread__struct.html#a3fd7aab45a1c539bc9ca022acfc1ad51">stack</a> + th-&gt;<a class="code" href="../../d2/d66/structrb__thread__struct.html#a1587dec1a575fb9f8d6a689ef4fdb6b5">stack_size</a>);
<a name="l00762"></a>00762     <span class="keywordflow">while</span> (cfp_limit &gt; cfp) {
<a name="l00763"></a>00763         <span class="keywordflow">if</span> (cfp-&gt;<a class="code" href="../../dd/d84/structrb__control__frame__t.html#a4b25ca925a9f60481173632b9c09d4e0">iseq</a> == iseq)
<a name="l00764"></a>00764             <span class="keywordflow">return</span> cfp-&gt;<a class="code" href="../../dd/d84/structrb__control__frame__t.html#aa0ec76f80ebaf0668b688c4e4e5e3e3f">me</a>;
<a name="l00765"></a>00765         cfp = <a class="code" href="../../d8/d32/vm__core_8h.html#af087c881c3c493e3a4e326852e8ed2a9">RUBY_VM_PREVIOUS_CONTROL_FRAME</a>(cfp);
<a name="l00766"></a>00766     }
<a name="l00767"></a>00767     <span class="keywordflow">return</span> 0;
<a name="l00768"></a>00768 }
<a name="l00769"></a>00769 
<a name="l00770"></a>00770 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#afa5b9137f051ac26d7ccc8824f178233">ID</a>
<a name="l00771"></a><a class="code" href="../../d3/d57/eval_8c.html#a1bc5e9b49222e024c00706ca096c3d3d">00771</a> <a class="code" href="../../d3/d57/eval_8c.html#a1bc5e9b49222e024c00706ca096c3d3d">frame_func_id</a>(<a class="code" href="../../dd/d84/structrb__control__frame__t.html">rb_control_frame_t</a> *cfp)
<a name="l00772"></a>00772 {
<a name="l00773"></a>00773     <span class="keyword">const</span> <a class="code" href="../../d7/db7/structrb__method__entry__struct.html">rb_method_entry_t</a> *me_local;
<a name="l00774"></a>00774     <a class="code" href="../../d6/de3/structrb__iseq__struct.html">rb_iseq_t</a> *iseq = cfp-&gt;<a class="code" href="../../dd/d84/structrb__control__frame__t.html#a4b25ca925a9f60481173632b9c09d4e0">iseq</a>;
<a name="l00775"></a>00775     <span class="keywordflow">if</span> (cfp-&gt;<a class="code" href="../../dd/d84/structrb__control__frame__t.html#aa0ec76f80ebaf0668b688c4e4e5e3e3f">me</a>) {
<a name="l00776"></a>00776         <span class="keywordflow">return</span> cfp-&gt;<a class="code" href="../../dd/d84/structrb__control__frame__t.html#aa0ec76f80ebaf0668b688c4e4e5e3e3f">me</a>-&gt;<a class="code" href="../../d7/db7/structrb__method__entry__struct.html#a6c868c50e67b757c6324dfef0f3184dc">def</a>-&gt;<a class="code" href="../../d6/dab/structrb__method__definition__struct.html#a7fc0edb8505a61f8ae8bf2544fa7f676">original_id</a>;
<a name="l00777"></a>00777     }
<a name="l00778"></a>00778     <span class="keywordflow">while</span> (iseq) {
<a name="l00779"></a>00779         <span class="keywordflow">if</span> (<a class="code" href="../../d8/d32/vm__core_8h.html#aa933aeb7a703c7cc2d136492acbbef22">RUBY_VM_IFUNC_P</a>(iseq)) {
<a name="l00780"></a>00780             NODE *ifunc = (NODE *)iseq;
<a name="l00781"></a>00781             <span class="keywordflow">if</span> (ifunc-&gt;nd_aid) <span class="keywordflow">return</span> ifunc-&gt;nd_aid;
<a name="l00782"></a>00782             <span class="keywordflow">return</span> <a class="code" href="../../dc/dcc/array_8c.html#a9cfa42d4b79c89d68c53be8b2150a503">rb_intern</a>(<span class="stringliteral">&quot;&lt;ifunc&gt;&quot;</span>);
<a name="l00783"></a>00783         }
<a name="l00784"></a>00784         me_local = <a class="code" href="../../d3/d57/eval_8c.html#aba0d81133ecd0f94d4dfc3b9ee2b46aa">method_entry_of_iseq</a>(cfp, iseq);
<a name="l00785"></a>00785         <span class="keywordflow">if</span> (me_local) {
<a name="l00786"></a>00786             cfp-&gt;<a class="code" href="../../dd/d84/structrb__control__frame__t.html#aa0ec76f80ebaf0668b688c4e4e5e3e3f">me</a> = me_local;
<a name="l00787"></a>00787             <span class="keywordflow">return</span> me_local-&gt;<a class="code" href="../../d7/db7/structrb__method__entry__struct.html#a6c868c50e67b757c6324dfef0f3184dc">def</a>-&gt;<a class="code" href="../../d6/dab/structrb__method__definition__struct.html#a7fc0edb8505a61f8ae8bf2544fa7f676">original_id</a>;
<a name="l00788"></a>00788         }
<a name="l00789"></a>00789         <span class="keywordflow">if</span> (iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a0f4b700a7d7866d0c5bcabf6d2a1be0b">defined_method_id</a>) {
<a name="l00790"></a>00790             <span class="keywordflow">return</span> iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a0f4b700a7d7866d0c5bcabf6d2a1be0b">defined_method_id</a>;
<a name="l00791"></a>00791         }
<a name="l00792"></a>00792         <span class="keywordflow">if</span> (iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a0f5705507c4c80bc69c3f031dd0daae9">local_iseq</a> == iseq) {
<a name="l00793"></a>00793             <span class="keywordflow">break</span>;
<a name="l00794"></a>00794         }
<a name="l00795"></a>00795         iseq = iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#afce02da209c0bf9a09ef4ea0af68e623">parent_iseq</a>;
<a name="l00796"></a>00796     }
<a name="l00797"></a>00797     <span class="keywordflow">return</span> 0;
<a name="l00798"></a>00798 }
<a name="l00799"></a>00799 
<a name="l00800"></a>00800 <a class="code" href="../../de/de6/ruby_2ruby_8h.html#afa5b9137f051ac26d7ccc8824f178233">ID</a>
<a name="l00801"></a><a class="code" href="../../db/d2e/intern_8h.html#a2adee42611e910ced8da650e59a961a3">00801</a> <a class="code" href="../../d3/d57/eval_8c.html#a2adee42611e910ced8da650e59a961a3">rb_frame_this_func</a>(<span class="keywordtype">void</span>)
<a name="l00802"></a>00802 {
<a name="l00803"></a>00803     <span class="keywordflow">return</span> <a class="code" href="../../d3/d57/eval_8c.html#a1bc5e9b49222e024c00706ca096c3d3d">frame_func_id</a>(<a class="code" href="../../d8/d32/vm__core_8h.html#a8deb84ec6023e3229db88ac2c9da6138">GET_THREAD</a>()-&gt;cfp);
<a name="l00804"></a>00804 }
<a name="l00805"></a>00805 
<a name="l00806"></a>00806 <a class="code" href="../../de/de6/ruby_2ruby_8h.html#afa5b9137f051ac26d7ccc8824f178233">ID</a>
<a name="l00807"></a><a class="code" href="../../db/d2e/intern_8h.html#a16eb77144d8d67c75e6c321b3c0ea8a0">00807</a> <a class="code" href="../../d3/d57/eval_8c.html#a16eb77144d8d67c75e6c321b3c0ea8a0">rb_frame_callee</a>(<span class="keywordtype">void</span>)
<a name="l00808"></a>00808 {
<a name="l00809"></a>00809     <span class="keywordflow">return</span> <a class="code" href="../../d3/d57/eval_8c.html#a1bc5e9b49222e024c00706ca096c3d3d">frame_func_id</a>(<a class="code" href="../../d8/d32/vm__core_8h.html#a8deb84ec6023e3229db88ac2c9da6138">GET_THREAD</a>()-&gt;cfp);
<a name="l00810"></a>00810 }
<a name="l00811"></a>00811 
<a name="l00812"></a>00812 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#afa5b9137f051ac26d7ccc8824f178233">ID</a>
<a name="l00813"></a><a class="code" href="../../d3/d57/eval_8c.html#a3ec2ec51e9207aaa9ae2b9b79114c102">00813</a> <a class="code" href="../../d3/d57/eval_8c.html#a3ec2ec51e9207aaa9ae2b9b79114c102">rb_frame_caller</a>(<span class="keywordtype">void</span>)
<a name="l00814"></a>00814 {
<a name="l00815"></a>00815     <a class="code" href="../../d2/d66/structrb__thread__struct.html">rb_thread_t</a> *th = <a class="code" href="../../d8/d32/vm__core_8h.html#a8deb84ec6023e3229db88ac2c9da6138">GET_THREAD</a>();
<a name="l00816"></a>00816     <a class="code" href="../../dd/d84/structrb__control__frame__t.html">rb_control_frame_t</a> *prev_cfp = <a class="code" href="../../d8/d32/vm__core_8h.html#af087c881c3c493e3a4e326852e8ed2a9">RUBY_VM_PREVIOUS_CONTROL_FRAME</a>(th-&gt;<a class="code" href="../../d2/d66/structrb__thread__struct.html#a2ed7f694d58d876aa6f0fae6986bc921">cfp</a>);
<a name="l00817"></a>00817     <span class="comment">/* check if prev_cfp can be accessible */</span>
<a name="l00818"></a>00818     <span class="keywordflow">if</span> ((<span class="keywordtype">void</span> *)(th-&gt;<a class="code" href="../../d2/d66/structrb__thread__struct.html#a3fd7aab45a1c539bc9ca022acfc1ad51">stack</a> + th-&gt;<a class="code" href="../../d2/d66/structrb__thread__struct.html#a1587dec1a575fb9f8d6a689ef4fdb6b5">stack_size</a>) == (<span class="keywordtype">void</span> *)(prev_cfp)) {
<a name="l00819"></a>00819         <span class="keywordflow">return</span> 0;
<a name="l00820"></a>00820     }
<a name="l00821"></a>00821     <span class="keywordflow">return</span> <a class="code" href="../../d3/d57/eval_8c.html#a1bc5e9b49222e024c00706ca096c3d3d">frame_func_id</a>(prev_cfp);
<a name="l00822"></a>00822 }
<a name="l00823"></a>00823 
<a name="l00824"></a>00824 <span class="keywordtype">void</span>
<a name="l00825"></a><a class="code" href="../../db/d2e/intern_8h.html#a6c9b6fe2b70d01e176fa50b4aa4da39c">00825</a> <a class="code" href="../../d3/d57/eval_8c.html#a6c9b6fe2b70d01e176fa50b4aa4da39c">rb_frame_pop</a>(<span class="keywordtype">void</span>)
<a name="l00826"></a>00826 {
<a name="l00827"></a>00827     <a class="code" href="../../d2/d66/structrb__thread__struct.html">rb_thread_t</a> *th = <a class="code" href="../../d8/d32/vm__core_8h.html#a8deb84ec6023e3229db88ac2c9da6138">GET_THREAD</a>();
<a name="l00828"></a>00828     th-&gt;<a class="code" href="../../d2/d66/structrb__thread__struct.html#a2ed7f694d58d876aa6f0fae6986bc921">cfp</a> = <a class="code" href="../../d8/d32/vm__core_8h.html#af087c881c3c493e3a4e326852e8ed2a9">RUBY_VM_PREVIOUS_CONTROL_FRAME</a>(th-&gt;<a class="code" href="../../d2/d66/structrb__thread__struct.html#a2ed7f694d58d876aa6f0fae6986bc921">cfp</a>);
<a name="l00829"></a>00829 }
<a name="l00830"></a>00830 
<a name="l00831"></a>00831 <span class="comment">/*</span>
<a name="l00832"></a>00832 <span class="comment"> *  call-seq:</span>
<a name="l00833"></a>00833 <span class="comment"> *     append_features(mod)   -&gt; mod</span>
<a name="l00834"></a>00834 <span class="comment"> *</span>
<a name="l00835"></a>00835 <span class="comment"> *  When this module is included in another, Ruby calls</span>
<a name="l00836"></a>00836 <span class="comment"> *  &lt;code&gt;append_features&lt;/code&gt; in this module, passing it the</span>
<a name="l00837"></a>00837 <span class="comment"> *  receiving module in _mod_. Ruby&apos;s default implementation is</span>
<a name="l00838"></a>00838 <span class="comment"> *  to add the constants, methods, and module variables of this module</span>
<a name="l00839"></a>00839 <span class="comment"> *  to _mod_ if this module has not already been added to</span>
<a name="l00840"></a>00840 <span class="comment"> *  _mod_ or one of its ancestors. See also &lt;code&gt;Module#include&lt;/code&gt;.</span>
<a name="l00841"></a>00841 <span class="comment"> */</span>
<a name="l00842"></a>00842 
<a name="l00843"></a>00843 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l00844"></a><a class="code" href="../../d3/d57/eval_8c.html#ac52a8af550d2bef1669b07a9403dc485">00844</a> <a class="code" href="../../d3/d57/eval_8c.html#ac52a8af550d2bef1669b07a9403dc485">rb_mod_append_features</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> module, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> include)
<a name="l00845"></a>00845 {
<a name="l00846"></a>00846     <span class="keywordflow">switch</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a394faf7191f18552a20cb17ce14226f0">TYPE</a>(include)) {
<a name="l00847"></a>00847       <span class="keywordflow">case</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ad04c63d175774c6d6e7dfaf0f0a982c9">T_CLASS</a>:
<a name="l00848"></a>00848       <span class="keywordflow">case</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a6cdc7dfe8f84777325da08a96ae5f795">T_MODULE</a>:
<a name="l00849"></a>00849         <span class="keywordflow">break</span>;
<a name="l00850"></a>00850       <span class="keywordflow">default</span>:
<a name="l00851"></a>00851         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ad5a1e03b0a66824f95f6aaf07b4a4052">Check_Type</a>(include, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ad04c63d175774c6d6e7dfaf0f0a982c9">T_CLASS</a>);
<a name="l00852"></a>00852         <span class="keywordflow">break</span>;
<a name="l00853"></a>00853     }
<a name="l00854"></a>00854     <a class="code" href="../../de/ddf/group__class.html#ga1301940bb86315055d67464ed2cee477">rb_include_module</a>(include, module);
<a name="l00855"></a>00855 
<a name="l00856"></a>00856     <span class="keywordflow">return</span> module;
<a name="l00857"></a>00857 }
<a name="l00858"></a>00858 
<a name="l00859"></a>00859 <span class="comment">/*</span>
<a name="l00860"></a>00860 <span class="comment"> *  call-seq:</span>
<a name="l00861"></a>00861 <span class="comment"> *     include(module, ...)    -&gt; self</span>
<a name="l00862"></a>00862 <span class="comment"> *</span>
<a name="l00863"></a>00863 <span class="comment"> *  Invokes &lt;code&gt;Module.append_features&lt;/code&gt; on each parameter in reverse order.</span>
<a name="l00864"></a>00864 <span class="comment"> */</span>
<a name="l00865"></a>00865 
<a name="l00866"></a>00866 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l00867"></a><a class="code" href="../../d3/d57/eval_8c.html#a97eab16e8b5362dfa7b2ba6ce0f2af55">00867</a> <a class="code" href="../../d3/d57/eval_8c.html#a97eab16e8b5362dfa7b2ba6ce0f2af55">rb_mod_include</a>(<span class="keywordtype">int</span> <a class="code" href="../../df/d77/ruby_8c.html#ad1447518f4372828b8435ae82e48499e">argc</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> *<a class="code" href="../../df/d77/ruby_8c.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> module)
<a name="l00868"></a>00868 {
<a name="l00869"></a>00869     <span class="keywordtype">int</span> i;
<a name="l00870"></a>00870 
<a name="l00871"></a>00871     <span class="keywordflow">for</span> (i = 0; i &lt; argc; i++)
<a name="l00872"></a>00872         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ad5a1e03b0a66824f95f6aaf07b4a4052">Check_Type</a>(argv[i], <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a6cdc7dfe8f84777325da08a96ae5f795">T_MODULE</a>);
<a name="l00873"></a>00873     <span class="keywordflow">while</span> (argc--) {
<a name="l00874"></a>00874         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a6a973fe624aa9aa9ba0cdeb6792d3187" title="Calls a method.">rb_funcall</a>(argv[argc], <a class="code" href="../../dc/dcc/array_8c.html#a9cfa42d4b79c89d68c53be8b2150a503">rb_intern</a>(<span class="stringliteral">&quot;append_features&quot;</span>), 1, module);
<a name="l00875"></a>00875         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a6a973fe624aa9aa9ba0cdeb6792d3187" title="Calls a method.">rb_funcall</a>(argv[argc], <a class="code" href="../../dc/dcc/array_8c.html#a9cfa42d4b79c89d68c53be8b2150a503">rb_intern</a>(<span class="stringliteral">&quot;included&quot;</span>), 1, module);
<a name="l00876"></a>00876     }
<a name="l00877"></a>00877     <span class="keywordflow">return</span> module;
<a name="l00878"></a>00878 }
<a name="l00879"></a>00879 
<a name="l00880"></a>00880 <span class="keywordtype">void</span>
<a name="l00881"></a><a class="code" href="../../db/d2e/intern_8h.html#aa9ccafe3c0640a14716a3c94b111a70c">00881</a> <a class="code" href="../../d3/d57/eval_8c.html#ad3ae1a7723c48c35c5323b9d45c565fa">rb_obj_call_init</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> obj, <span class="keywordtype">int</span> <a class="code" href="../../df/d77/ruby_8c.html#ad1447518f4372828b8435ae82e48499e">argc</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> *<a class="code" href="../../df/d77/ruby_8c.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>)
<a name="l00882"></a>00882 {
<a name="l00883"></a>00883     <a class="code" href="../../dd/dd0/eval__intern_8h.html#a57de3330fdac31c27df5b36e4cada1e8">PASS_PASSED_BLOCK</a>();
<a name="l00884"></a>00884     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#adafa8fd17636821445380e7e1881355e" title="Calls a method.">rb_funcall2</a>(obj, idInitialize, argc, argv);
<a name="l00885"></a>00885 }
<a name="l00886"></a>00886 
<a name="l00887"></a>00887 <span class="keywordtype">void</span>
<a name="l00888"></a><a class="code" href="../../de/de6/ruby_2ruby_8h.html#ad3f158699384e54ab8631f5084d9d387">00888</a> <a class="code" href="../../d3/d57/eval_8c.html#a157fb11af4678daed6923e40acaaf9b2">rb_extend_object</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> obj, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> module)
<a name="l00889"></a>00889 {
<a name="l00890"></a>00890     <a class="code" href="../../de/ddf/group__class.html#ga1301940bb86315055d67464ed2cee477">rb_include_module</a>(<a class="code" href="../../de/ddf/group__class.html#ga3778543a2798adab7bc12ed325c0b5d0" title="Returns the singleton class of obj.">rb_singleton_class</a>(obj), module);
<a name="l00891"></a>00891 }
<a name="l00892"></a>00892 
<a name="l00893"></a>00893 <span class="comment">/*</span>
<a name="l00894"></a>00894 <span class="comment"> *  call-seq:</span>
<a name="l00895"></a>00895 <span class="comment"> *     extend_object(obj)    -&gt; obj</span>
<a name="l00896"></a>00896 <span class="comment"> *</span>
<a name="l00897"></a>00897 <span class="comment"> *  Extends the specified object by adding this module&apos;s constants and</span>
<a name="l00898"></a>00898 <span class="comment"> *  methods (which are added as singleton methods). This is the callback</span>
<a name="l00899"></a>00899 <span class="comment"> *  method used by &lt;code&gt;Object#extend&lt;/code&gt;.</span>
<a name="l00900"></a>00900 <span class="comment"> *</span>
<a name="l00901"></a>00901 <span class="comment"> *     module Picky</span>
<a name="l00902"></a>00902 <span class="comment"> *       def Picky.extend_object(o)</span>
<a name="l00903"></a>00903 <span class="comment"> *         if String === o</span>
<a name="l00904"></a>00904 <span class="comment"> *           puts &quot;Can&apos;t add Picky to a String&quot;</span>
<a name="l00905"></a>00905 <span class="comment"> *         else</span>
<a name="l00906"></a>00906 <span class="comment"> *           puts &quot;Picky added to #{o.class}&quot;</span>
<a name="l00907"></a>00907 <span class="comment"> *           super</span>
<a name="l00908"></a>00908 <span class="comment"> *         end</span>
<a name="l00909"></a>00909 <span class="comment"> *       end</span>
<a name="l00910"></a>00910 <span class="comment"> *     end</span>
<a name="l00911"></a>00911 <span class="comment"> *     (s = Array.new).extend Picky  # Call Object.extend</span>
<a name="l00912"></a>00912 <span class="comment"> *     (s = &quot;quick brown fox&quot;).extend Picky</span>
<a name="l00913"></a>00913 <span class="comment"> *</span>
<a name="l00914"></a>00914 <span class="comment"> *  &lt;em&gt;produces:&lt;/em&gt;</span>
<a name="l00915"></a>00915 <span class="comment"> *</span>
<a name="l00916"></a>00916 <span class="comment"> *     Picky added to Array</span>
<a name="l00917"></a>00917 <span class="comment"> *     Can&apos;t add Picky to a String</span>
<a name="l00918"></a>00918 <span class="comment"> */</span>
<a name="l00919"></a>00919 
<a name="l00920"></a>00920 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l00921"></a><a class="code" href="../../d3/d57/eval_8c.html#ac23ac222bbc0b1ee8209760d27f0c736">00921</a> <a class="code" href="../../d3/d57/eval_8c.html#ac23ac222bbc0b1ee8209760d27f0c736">rb_mod_extend_object</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <a class="code" href="../../d1/d6f/date__strftime_8c.html#aa84d960185b18347956518e4d00766b4">mod</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> obj)
<a name="l00922"></a>00922 {
<a name="l00923"></a>00923     <a class="code" href="../../d3/d57/eval_8c.html#a157fb11af4678daed6923e40acaaf9b2">rb_extend_object</a>(obj, mod);
<a name="l00924"></a>00924     <span class="keywordflow">return</span> obj;
<a name="l00925"></a>00925 }
<a name="l00926"></a>00926 
<a name="l00927"></a>00927 <span class="comment">/*</span>
<a name="l00928"></a>00928 <span class="comment"> *  call-seq:</span>
<a name="l00929"></a>00929 <span class="comment"> *     obj.extend(module, ...)    -&gt; obj</span>
<a name="l00930"></a>00930 <span class="comment"> *</span>
<a name="l00931"></a>00931 <span class="comment"> *  Adds to _obj_ the instance methods from each module given as a</span>
<a name="l00932"></a>00932 <span class="comment"> *  parameter.</span>
<a name="l00933"></a>00933 <span class="comment"> *</span>
<a name="l00934"></a>00934 <span class="comment"> *     module Mod</span>
<a name="l00935"></a>00935 <span class="comment"> *       def hello</span>
<a name="l00936"></a>00936 <span class="comment"> *         &quot;Hello from Mod.\n&quot;</span>
<a name="l00937"></a>00937 <span class="comment"> *       end</span>
<a name="l00938"></a>00938 <span class="comment"> *     end</span>
<a name="l00939"></a>00939 <span class="comment"> *</span>
<a name="l00940"></a>00940 <span class="comment"> *     class Klass</span>
<a name="l00941"></a>00941 <span class="comment"> *       def hello</span>
<a name="l00942"></a>00942 <span class="comment"> *         &quot;Hello from Klass.\n&quot;</span>
<a name="l00943"></a>00943 <span class="comment"> *       end</span>
<a name="l00944"></a>00944 <span class="comment"> *     end</span>
<a name="l00945"></a>00945 <span class="comment"> *</span>
<a name="l00946"></a>00946 <span class="comment"> *     k = Klass.new</span>
<a name="l00947"></a>00947 <span class="comment"> *     k.hello         #=&gt; &quot;Hello from Klass.\n&quot;</span>
<a name="l00948"></a>00948 <span class="comment"> *     k.extend(Mod)   #=&gt; #&lt;Klass:0x401b3bc8&gt;</span>
<a name="l00949"></a>00949 <span class="comment"> *     k.hello         #=&gt; &quot;Hello from Mod.\n&quot;</span>
<a name="l00950"></a>00950 <span class="comment"> */</span>
<a name="l00951"></a>00951 
<a name="l00952"></a>00952 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l00953"></a><a class="code" href="../../d3/d57/eval_8c.html#a16b45463622559a654a3c0f7bafb91b0">00953</a> <a class="code" href="../../d3/d57/eval_8c.html#a16b45463622559a654a3c0f7bafb91b0">rb_obj_extend</a>(<span class="keywordtype">int</span> <a class="code" href="../../df/d77/ruby_8c.html#ad1447518f4372828b8435ae82e48499e">argc</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> *<a class="code" href="../../df/d77/ruby_8c.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> obj)
<a name="l00954"></a>00954 {
<a name="l00955"></a>00955     <span class="keywordtype">int</span> i;
<a name="l00956"></a>00956 
<a name="l00957"></a>00957     <span class="keywordflow">if</span> (argc == 0) {
<a name="l00958"></a>00958         <a class="code" href="../../db/dcc/error_8c.html#a0f771a2840561f1838169b3d7d4616f3">rb_raise</a>(<a class="code" href="../../db/dcc/error_8c.html#ab5e2a9fec766c75176fbb262bfe6a596">rb_eArgError</a>, <span class="stringliteral">&quot;wrong number of arguments (at least 1)&quot;</span>);
<a name="l00959"></a>00959     }
<a name="l00960"></a>00960     <span class="keywordflow">for</span> (i = 0; i &lt; argc; i++)
<a name="l00961"></a>00961         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ad5a1e03b0a66824f95f6aaf07b4a4052">Check_Type</a>(argv[i], <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a6cdc7dfe8f84777325da08a96ae5f795">T_MODULE</a>);
<a name="l00962"></a>00962     <span class="keywordflow">while</span> (argc--) {
<a name="l00963"></a>00963         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a6a973fe624aa9aa9ba0cdeb6792d3187" title="Calls a method.">rb_funcall</a>(argv[argc], <a class="code" href="../../dc/dcc/array_8c.html#a9cfa42d4b79c89d68c53be8b2150a503">rb_intern</a>(<span class="stringliteral">&quot;extend_object&quot;</span>), 1, obj);
<a name="l00964"></a>00964         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a6a973fe624aa9aa9ba0cdeb6792d3187" title="Calls a method.">rb_funcall</a>(argv[argc], <a class="code" href="../../dc/dcc/array_8c.html#a9cfa42d4b79c89d68c53be8b2150a503">rb_intern</a>(<span class="stringliteral">&quot;extended&quot;</span>), 1, obj);
<a name="l00965"></a>00965     }
<a name="l00966"></a>00966     <span class="keywordflow">return</span> obj;
<a name="l00967"></a>00967 }
<a name="l00968"></a>00968 
<a name="l00969"></a>00969 <span class="comment">/*</span>
<a name="l00970"></a>00970 <span class="comment"> *  call-seq:</span>
<a name="l00971"></a>00971 <span class="comment"> *     include(module, ...)   -&gt; self</span>
<a name="l00972"></a>00972 <span class="comment"> *</span>
<a name="l00973"></a>00973 <span class="comment"> *  Invokes &lt;code&gt;Module.append_features&lt;/code&gt;</span>
<a name="l00974"></a>00974 <span class="comment"> *  on each parameter in turn. Effectively adds the methods and constants</span>
<a name="l00975"></a>00975 <span class="comment"> *  in each module to the receiver.</span>
<a name="l00976"></a>00976 <span class="comment"> */</span>
<a name="l00977"></a>00977 
<a name="l00978"></a>00978 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l00979"></a><a class="code" href="../../d3/d57/eval_8c.html#a19c948920308f936942b87d8f357f1bb">00979</a> <a class="code" href="../../d3/d57/eval_8c.html#a19c948920308f936942b87d8f357f1bb">top_include</a>(<span class="keywordtype">int</span> <a class="code" href="../../df/d77/ruby_8c.html#ad1447518f4372828b8435ae82e48499e">argc</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> *<a class="code" href="../../df/d77/ruby_8c.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <span class="keyword">self</span>)
<a name="l00980"></a>00980 {
<a name="l00981"></a>00981     <a class="code" href="../../d2/d66/structrb__thread__struct.html">rb_thread_t</a> *th = <a class="code" href="../../d8/d32/vm__core_8h.html#a8deb84ec6023e3229db88ac2c9da6138">GET_THREAD</a>();
<a name="l00982"></a>00982 
<a name="l00983"></a>00983     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a98b91af598acb64fe8497413ce498766">rb_secure</a>(4);
<a name="l00984"></a>00984     <span class="keywordflow">if</span> (th-&gt;<a class="code" href="../../d2/d66/structrb__thread__struct.html#a63addaa5b39a83e287f7b8747398ab57">top_wrapper</a>) {
<a name="l00985"></a>00985         <a class="code" href="../../db/dcc/error_8c.html#afd461c64916576849b159b21a26123da">rb_warning</a>
<a name="l00986"></a>00986             (<span class="stringliteral">&quot;main#include in the wrapped load is effective only in wrapper module&quot;</span>);
<a name="l00987"></a>00987         <span class="keywordflow">return</span> <a class="code" href="../../d3/d57/eval_8c.html#a97eab16e8b5362dfa7b2ba6ce0f2af55">rb_mod_include</a>(argc, argv, th-&gt;<a class="code" href="../../d2/d66/structrb__thread__struct.html#a63addaa5b39a83e287f7b8747398ab57">top_wrapper</a>);
<a name="l00988"></a>00988     }
<a name="l00989"></a>00989     <span class="keywordflow">return</span> <a class="code" href="../../d3/d57/eval_8c.html#a97eab16e8b5362dfa7b2ba6ce0f2af55">rb_mod_include</a>(argc, argv, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a57c96ead3ef230b4838e65fe037c346e">rb_cObject</a>);
<a name="l00990"></a>00990 }
<a name="l00991"></a>00991 
<a name="l00992"></a>00992 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> *
<a name="l00993"></a><a class="code" href="../../d3/d57/eval_8c.html#a87148323ff310c2841d373af48b2706e">00993</a> <a class="code" href="../../d3/d57/eval_8c.html#a87148323ff310c2841d373af48b2706e">errinfo_place</a>(<a class="code" href="../../d2/d66/structrb__thread__struct.html">rb_thread_t</a> *th)
<a name="l00994"></a>00994 {
<a name="l00995"></a>00995     <a class="code" href="../../dd/d84/structrb__control__frame__t.html">rb_control_frame_t</a> *cfp = th-&gt;<a class="code" href="../../d2/d66/structrb__thread__struct.html#a2ed7f694d58d876aa6f0fae6986bc921">cfp</a>;
<a name="l00996"></a>00996     <a class="code" href="../../dd/d84/structrb__control__frame__t.html">rb_control_frame_t</a> *end_cfp = <a class="code" href="../../d8/d32/vm__core_8h.html#a0a82c3322af87ad5e0eb5854d7f98d3b">RUBY_VM_END_CONTROL_FRAME</a>(th);
<a name="l00997"></a>00997 
<a name="l00998"></a>00998     <span class="keywordflow">while</span> (<a class="code" href="../../d8/d32/vm__core_8h.html#aa9e5e350ea2fe026133e2e648c6951e9">RUBY_VM_VALID_CONTROL_FRAME_P</a>(cfp, end_cfp)) {
<a name="l00999"></a>00999         <span class="keywordflow">if</span> (<a class="code" href="../../d8/d32/vm__core_8h.html#a79d03ad9b9cf8b7a8ca2b849e495a74f">RUBY_VM_NORMAL_ISEQ_P</a>(cfp-&gt;<a class="code" href="../../dd/d84/structrb__control__frame__t.html#a4b25ca925a9f60481173632b9c09d4e0">iseq</a>)) {
<a name="l01000"></a>01000             <span class="keywordflow">if</span> (cfp-&gt;<a class="code" href="../../dd/d84/structrb__control__frame__t.html#a4b25ca925a9f60481173632b9c09d4e0">iseq</a>-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#af8bc7dbae6f61d836b5bb9fb50b6cfb8">type</a> == ISEQ_TYPE_RESCUE) {
<a name="l01001"></a>01001                 <span class="keywordflow">return</span> &amp;cfp-&gt;<a class="code" href="../../dd/d84/structrb__control__frame__t.html#ac1cafd093e114d3ec99ebeca0ffeb048">dfp</a>[-2];
<a name="l01002"></a>01002             }
<a name="l01003"></a>01003             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (cfp-&gt;<a class="code" href="../../dd/d84/structrb__control__frame__t.html#a4b25ca925a9f60481173632b9c09d4e0">iseq</a>-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#af8bc7dbae6f61d836b5bb9fb50b6cfb8">type</a> == ISEQ_TYPE_ENSURE &amp;&amp;
<a name="l01004"></a>01004                      <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a394faf7191f18552a20cb17ce14226f0">TYPE</a>(cfp-&gt;<a class="code" href="../../dd/d84/structrb__control__frame__t.html#ac1cafd093e114d3ec99ebeca0ffeb048">dfp</a>[-2]) != <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a5f1cc49c4da51d5bdffa64be79ff6fb0">T_NODE</a> &amp;&amp;
<a name="l01005"></a>01005                      !<a class="code" href="../../de/de6/ruby_2ruby_8h.html#acf2fcf97dcf9c7c35452730eb3e2aeb2">FIXNUM_P</a>(cfp-&gt;<a class="code" href="../../dd/d84/structrb__control__frame__t.html#ac1cafd093e114d3ec99ebeca0ffeb048">dfp</a>[-2])) {
<a name="l01006"></a>01006                 <span class="keywordflow">return</span> &amp;cfp-&gt;<a class="code" href="../../dd/d84/structrb__control__frame__t.html#ac1cafd093e114d3ec99ebeca0ffeb048">dfp</a>[-2];
<a name="l01007"></a>01007             }
<a name="l01008"></a>01008         }
<a name="l01009"></a>01009         cfp = <a class="code" href="../../d8/d32/vm__core_8h.html#af087c881c3c493e3a4e326852e8ed2a9">RUBY_VM_PREVIOUS_CONTROL_FRAME</a>(cfp);
<a name="l01010"></a>01010     }
<a name="l01011"></a>01011     <span class="keywordflow">return</span> 0;
<a name="l01012"></a>01012 }
<a name="l01013"></a>01013 
<a name="l01014"></a>01014 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l01015"></a><a class="code" href="../../d3/d57/eval_8c.html#a317e814e58675a73ee2d7b695f8785a6">01015</a> <a class="code" href="../../d3/d57/eval_8c.html#a317e814e58675a73ee2d7b695f8785a6">get_thread_errinfo</a>(<a class="code" href="../../d2/d66/structrb__thread__struct.html">rb_thread_t</a> *th)
<a name="l01016"></a>01016 {
<a name="l01017"></a>01017     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> *ptr = <a class="code" href="../../d3/d57/eval_8c.html#a87148323ff310c2841d373af48b2706e">errinfo_place</a>(th);
<a name="l01018"></a>01018     <span class="keywordflow">if</span> (ptr) {
<a name="l01019"></a>01019         <span class="keywordflow">return</span> *ptr;
<a name="l01020"></a>01020     }
<a name="l01021"></a>01021     <span class="keywordflow">else</span> {
<a name="l01022"></a>01022         <span class="keywordflow">return</span> th-&gt;<a class="code" href="../../d2/d66/structrb__thread__struct.html#a173e2da61fa57c7044fd7874a8c7a924">errinfo</a>;
<a name="l01023"></a>01023     }
<a name="l01024"></a>01024 }
<a name="l01025"></a>01025 
<a name="l01026"></a>01026 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l01027"></a><a class="code" href="../../d3/d57/eval_8c.html#a04b7c381dd86f77646019756d25a149e">01027</a> <a class="code" href="../../d3/d57/eval_8c.html#a04b7c381dd86f77646019756d25a149e">get_errinfo</a>(<span class="keywordtype">void</span>)
<a name="l01028"></a>01028 {
<a name="l01029"></a>01029     <span class="keywordflow">return</span> <a class="code" href="../../d3/d57/eval_8c.html#a317e814e58675a73ee2d7b695f8785a6">get_thread_errinfo</a>(<a class="code" href="../../d8/d32/vm__core_8h.html#a8deb84ec6023e3229db88ac2c9da6138">GET_THREAD</a>());
<a name="l01030"></a>01030 }
<a name="l01031"></a>01031 
<a name="l01032"></a>01032 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l01033"></a><a class="code" href="../../d3/d57/eval_8c.html#a095039338e5b94dadbfe8b67480c030c">01033</a> <a class="code" href="../../d3/d57/eval_8c.html#a095039338e5b94dadbfe8b67480c030c">errinfo_getter</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#afa5b9137f051ac26d7ccc8824f178233">ID</a> <span class="keywordtype">id</span>)
<a name="l01034"></a>01034 {
<a name="l01035"></a>01035     <span class="keywordflow">return</span> <a class="code" href="../../d3/d57/eval_8c.html#a04b7c381dd86f77646019756d25a149e">get_errinfo</a>();
<a name="l01036"></a>01036 }
<a name="l01037"></a>01037 
<a name="l01038"></a>01038 <span class="preprocessor">#if 0</span>
<a name="l01039"></a>01039 <span class="preprocessor"></span><span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l01040"></a>01040 errinfo_setter(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> val, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#afa5b9137f051ac26d7ccc8824f178233">ID</a> <span class="keywordtype">id</span>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> *var)
<a name="l01041"></a>01041 {
<a name="l01042"></a>01042     <span class="keywordflow">if</span> (!<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a4832bad8845a35fc50f7a160901854a1">NIL_P</a>(val) &amp;&amp; !<a class="code" href="../../db/d2e/intern_8h.html#a6e65fc310dd65ebd60d68ada991da6f6">rb_obj_is_kind_of</a>(val, <a class="code" href="../../db/dcc/error_8c.html#ac5bd9245454f935493c41daa4f2651ae">rb_eException</a>)) {
<a name="l01043"></a>01043         <a class="code" href="../../db/dcc/error_8c.html#a0f771a2840561f1838169b3d7d4616f3">rb_raise</a>(<a class="code" href="../../db/dcc/error_8c.html#a565ed9d70f4089e1b4a36e9b3381b8c6">rb_eTypeError</a>, <span class="stringliteral">&quot;assigning non-exception to $!&quot;</span>);
<a name="l01044"></a>01044     }
<a name="l01045"></a>01045     <span class="keywordflow">else</span> {
<a name="l01046"></a>01046         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> *ptr = <a class="code" href="../../d3/d57/eval_8c.html#a87148323ff310c2841d373af48b2706e">errinfo_place</a>(<a class="code" href="../../d8/d32/vm__core_8h.html#a8deb84ec6023e3229db88ac2c9da6138">GET_THREAD</a>());
<a name="l01047"></a>01047         <span class="keywordflow">if</span> (ptr) {
<a name="l01048"></a>01048             *ptr = val;
<a name="l01049"></a>01049         }
<a name="l01050"></a>01050         <span class="keywordflow">else</span> {
<a name="l01051"></a>01051             <a class="code" href="../../db/dcc/error_8c.html#a0f771a2840561f1838169b3d7d4616f3">rb_raise</a>(<a class="code" href="../../db/dcc/error_8c.html#a95ad3953d535707e2cf2b1d837f5e253">rb_eRuntimeError</a>, <span class="stringliteral">&quot;errinfo_setter: not in rescue clause.&quot;</span>);
<a name="l01052"></a>01052         }
<a name="l01053"></a>01053     }
<a name="l01054"></a>01054 }
<a name="l01055"></a>01055 <span class="preprocessor">#endif</span>
<a name="l01056"></a>01056 <span class="preprocessor"></span>
<a name="l01057"></a>01057 <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l01058"></a><a class="code" href="../../de/de6/ruby_2ruby_8h.html#ad40cecf24bc0e8f386df839518ad6f56">01058</a> <a class="code" href="../../d5/d9d/tcltklib_8c.html#a89cd18829599d193ee75073219cc42c4">rb_errinfo</a>(<span class="keywordtype">void</span>)
<a name="l01059"></a>01059 {
<a name="l01060"></a>01060     <a class="code" href="../../d2/d66/structrb__thread__struct.html">rb_thread_t</a> *th = <a class="code" href="../../d8/d32/vm__core_8h.html#a8deb84ec6023e3229db88ac2c9da6138">GET_THREAD</a>();
<a name="l01061"></a>01061     <span class="keywordflow">return</span> th-&gt;<a class="code" href="../../d2/d66/structrb__thread__struct.html#a173e2da61fa57c7044fd7874a8c7a924">errinfo</a>;
<a name="l01062"></a>01062 }
<a name="l01063"></a>01063 
<a name="l01064"></a>01064 <span class="keywordtype">void</span>
<a name="l01065"></a><a class="code" href="../../de/de6/ruby_2ruby_8h.html#a7ba4ead274632087bd4e0228365a1f8a">01065</a> <a class="code" href="../../d3/d57/eval_8c.html#a4484d744216a0afdf26dce14f1190973">rb_set_errinfo</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <a class="code" href="../../d5/df2/win32_8c.html#a6ce68847c12434f60d1b2654a3dc3409">err</a>)
<a name="l01066"></a>01066 {
<a name="l01067"></a>01067     <span class="keywordflow">if</span> (!<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a4832bad8845a35fc50f7a160901854a1">NIL_P</a>(err) &amp;&amp; !<a class="code" href="../../db/d2e/intern_8h.html#a6e65fc310dd65ebd60d68ada991da6f6">rb_obj_is_kind_of</a>(err, <a class="code" href="../../db/dcc/error_8c.html#ac5bd9245454f935493c41daa4f2651ae">rb_eException</a>)) {
<a name="l01068"></a>01068         <a class="code" href="../../db/dcc/error_8c.html#a0f771a2840561f1838169b3d7d4616f3">rb_raise</a>(<a class="code" href="../../db/dcc/error_8c.html#a565ed9d70f4089e1b4a36e9b3381b8c6">rb_eTypeError</a>, <span class="stringliteral">&quot;assigning non-exception to $!&quot;</span>);
<a name="l01069"></a>01069     }
<a name="l01070"></a>01070     <a class="code" href="../../d8/d32/vm__core_8h.html#a8deb84ec6023e3229db88ac2c9da6138">GET_THREAD</a>()-&gt;errinfo = err;
<a name="l01071"></a>01071 }
<a name="l01072"></a>01072 
<a name="l01073"></a>01073 <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l01074"></a><a class="code" href="../../d3/d57/eval_8c.html#ae9799dfa35d3d40663b6b5afc34968df">01074</a> <a class="code" href="../../d3/d57/eval_8c.html#ae9799dfa35d3d40663b6b5afc34968df">rb_rubylevel_errinfo</a>(<span class="keywordtype">void</span>)
<a name="l01075"></a>01075 {
<a name="l01076"></a>01076     <span class="keywordflow">return</span> <a class="code" href="../../d3/d57/eval_8c.html#a04b7c381dd86f77646019756d25a149e">get_errinfo</a>();
<a name="l01077"></a>01077 }
<a name="l01078"></a>01078 
<a name="l01079"></a>01079 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l01080"></a><a class="code" href="../../d3/d57/eval_8c.html#af4a61d7507c1b035693c500c9732096f">01080</a> <a class="code" href="../../d3/d57/eval_8c.html#af4a61d7507c1b035693c500c9732096f">errat_getter</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#afa5b9137f051ac26d7ccc8824f178233">ID</a> <span class="keywordtype">id</span>)
<a name="l01081"></a>01081 {
<a name="l01082"></a>01082     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <a class="code" href="../../d5/df2/win32_8c.html#a6ce68847c12434f60d1b2654a3dc3409">err</a> = <a class="code" href="../../d3/d57/eval_8c.html#a04b7c381dd86f77646019756d25a149e">get_errinfo</a>();
<a name="l01083"></a>01083     <span class="keywordflow">if</span> (!<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a4832bad8845a35fc50f7a160901854a1">NIL_P</a>(err)) {
<a name="l01084"></a>01084         <span class="keywordflow">return</span> <a class="code" href="../../d5/d1d/eval__error_8c.html#a8c5771bb88d43a65e3e3b2d50ac41574">get_backtrace</a>(err);
<a name="l01085"></a>01085     }
<a name="l01086"></a>01086     <span class="keywordflow">else</span> {
<a name="l01087"></a>01087         <span class="keywordflow">return</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a320970f989dc8294c8203154e3db40c1">Qnil</a>;
<a name="l01088"></a>01088     }
<a name="l01089"></a>01089 }
<a name="l01090"></a>01090 
<a name="l01091"></a>01091 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l01092"></a><a class="code" href="../../d3/d57/eval_8c.html#a0c49d0f9cdb49876089f07695c45b753">01092</a> <a class="code" href="../../d3/d57/eval_8c.html#a0c49d0f9cdb49876089f07695c45b753">errat_setter</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> val, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#afa5b9137f051ac26d7ccc8824f178233">ID</a> <span class="keywordtype">id</span>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> *var)
<a name="l01093"></a>01093 {
<a name="l01094"></a>01094     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <a class="code" href="../../d5/df2/win32_8c.html#a6ce68847c12434f60d1b2654a3dc3409">err</a> = <a class="code" href="../../d3/d57/eval_8c.html#a04b7c381dd86f77646019756d25a149e">get_errinfo</a>();
<a name="l01095"></a>01095     <span class="keywordflow">if</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a4832bad8845a35fc50f7a160901854a1">NIL_P</a>(err)) {
<a name="l01096"></a>01096         <a class="code" href="../../db/dcc/error_8c.html#a0f771a2840561f1838169b3d7d4616f3">rb_raise</a>(<a class="code" href="../../db/dcc/error_8c.html#ab5e2a9fec766c75176fbb262bfe6a596">rb_eArgError</a>, <span class="stringliteral">&quot;$! not set&quot;</span>);
<a name="l01097"></a>01097     }
<a name="l01098"></a>01098     <a class="code" href="../../d5/d1d/eval__error_8c.html#a7c6f670a9d7255ea9226fb230f7657c4">set_backtrace</a>(err, val);
<a name="l01099"></a>01099 }
<a name="l01100"></a>01100 
<a name="l01101"></a>01101 <span class="comment">/*</span>
<a name="l01102"></a>01102 <span class="comment"> *  call-seq:</span>
<a name="l01103"></a>01103 <span class="comment"> *     __method__         -&gt; symbol</span>
<a name="l01104"></a>01104 <span class="comment"> *     __callee__         -&gt; symbol</span>
<a name="l01105"></a>01105 <span class="comment"> *</span>
<a name="l01106"></a>01106 <span class="comment"> *  Returns the name of the current method as a Symbol.</span>
<a name="l01107"></a>01107 <span class="comment"> *  If called outside of a method, it returns &lt;code&gt;nil&lt;/code&gt;.</span>
<a name="l01108"></a>01108 <span class="comment"> *</span>
<a name="l01109"></a>01109 <span class="comment"> */</span>
<a name="l01110"></a>01110 
<a name="l01111"></a>01111 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l01112"></a><a class="code" href="../../d3/d57/eval_8c.html#a6e5139d254c0cbf145679cbb3693bf63">01112</a> <a class="code" href="../../d3/d57/eval_8c.html#a6e5139d254c0cbf145679cbb3693bf63">rb_f_method_name</a>(<span class="keywordtype">void</span>)
<a name="l01113"></a>01113 {
<a name="l01114"></a>01114     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#afa5b9137f051ac26d7ccc8824f178233">ID</a> fname = <a class="code" href="../../d3/d57/eval_8c.html#a3ec2ec51e9207aaa9ae2b9b79114c102">rb_frame_caller</a>(); <span class="comment">/* need *caller* ID */</span>
<a name="l01115"></a>01115 
<a name="l01116"></a>01116     <span class="keywordflow">if</span> (fname) {
<a name="l01117"></a>01117         <span class="keywordflow">return</span> <a class="code" href="../../dc/d0c/cparse_8c.html#a48bfb6519a45249fb2ec0193ea3b6e1c">ID2SYM</a>(fname);
<a name="l01118"></a>01118     }
<a name="l01119"></a>01119     <span class="keywordflow">else</span> {
<a name="l01120"></a>01120         <span class="keywordflow">return</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a320970f989dc8294c8203154e3db40c1">Qnil</a>;
<a name="l01121"></a>01121     }
<a name="l01122"></a>01122 }
<a name="l01123"></a>01123 
<a name="l01124"></a>01124 <span class="keywordtype">void</span>
<a name="l01125"></a><a class="code" href="../../d3/d57/eval_8c.html#a59da0fae8592f2851a2f5090ce781fe4">01125</a> <a class="code" href="../../d3/d57/eval_8c.html#a59da0fae8592f2851a2f5090ce781fe4">Init_eval</a>(<span class="keywordtype">void</span>)
<a name="l01126"></a>01126 {
<a name="l01127"></a>01127     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a16645ebd6327288fc96a4df38d58f36b">rb_define_virtual_variable</a>(<span class="stringliteral">&quot;$@&quot;</span>, <a class="code" href="../../d3/d57/eval_8c.html#af4a61d7507c1b035693c500c9732096f">errat_getter</a>, <a class="code" href="../../d3/d57/eval_8c.html#a0c49d0f9cdb49876089f07695c45b753">errat_setter</a>);
<a name="l01128"></a>01128     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a16645ebd6327288fc96a4df38d58f36b">rb_define_virtual_variable</a>(<span class="stringliteral">&quot;$!&quot;</span>, <a class="code" href="../../d3/d57/eval_8c.html#a095039338e5b94dadbfe8b67480c030c">errinfo_getter</a>, 0);
<a name="l01129"></a>01129 
<a name="l01130"></a>01130     <a class="code" href="../../d7/d19/group__defmethod.html#gac08f58e00836e4e2586689e45b781bdd" title="Defines a global function.">rb_define_global_function</a>(<span class="stringliteral">&quot;raise&quot;</span>, <a class="code" href="../../d3/d57/eval_8c.html#a24cf0af9fab4e1d1968a229bed775d9f">rb_f_raise</a>, -1);
<a name="l01131"></a>01131     <a class="code" href="../../d7/d19/group__defmethod.html#gac08f58e00836e4e2586689e45b781bdd" title="Defines a global function.">rb_define_global_function</a>(<span class="stringliteral">&quot;fail&quot;</span>, <a class="code" href="../../d3/d57/eval_8c.html#a24cf0af9fab4e1d1968a229bed775d9f">rb_f_raise</a>, -1);
<a name="l01132"></a>01132 
<a name="l01133"></a>01133     <a class="code" href="../../d7/d19/group__defmethod.html#gac08f58e00836e4e2586689e45b781bdd" title="Defines a global function.">rb_define_global_function</a>(<span class="stringliteral">&quot;global_variables&quot;</span>, <a class="code" href="../../db/d2e/intern_8h.html#ae23cdd71e334f8ef89ebe3b9f1e0514d">rb_f_global_variables</a>, 0);    <span class="comment">/* in variable.c */</span>
<a name="l01134"></a>01134 
<a name="l01135"></a>01135     <a class="code" href="../../d7/d19/group__defmethod.html#gac08f58e00836e4e2586689e45b781bdd" title="Defines a global function.">rb_define_global_function</a>(<span class="stringliteral">&quot;__method__&quot;</span>, <a class="code" href="../../d3/d57/eval_8c.html#a6e5139d254c0cbf145679cbb3693bf63">rb_f_method_name</a>, 0);
<a name="l01136"></a>01136     <a class="code" href="../../d7/d19/group__defmethod.html#gac08f58e00836e4e2586689e45b781bdd" title="Defines a global function.">rb_define_global_function</a>(<span class="stringliteral">&quot;__callee__&quot;</span>, <a class="code" href="../../d3/d57/eval_8c.html#a6e5139d254c0cbf145679cbb3693bf63">rb_f_method_name</a>, 0);
<a name="l01137"></a>01137 
<a name="l01138"></a>01138     <a class="code" href="../../d7/d19/group__defmethod.html#ga69c4f84891831d013e9e64972de90d78">rb_define_private_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#ad35b93cf98ae9c41f3394fd51383f774">rb_cModule</a>, <span class="stringliteral">&quot;append_features&quot;</span>, <a class="code" href="../../d3/d57/eval_8c.html#ac52a8af550d2bef1669b07a9403dc485">rb_mod_append_features</a>, 1);
<a name="l01139"></a>01139     <a class="code" href="../../d7/d19/group__defmethod.html#ga69c4f84891831d013e9e64972de90d78">rb_define_private_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#ad35b93cf98ae9c41f3394fd51383f774">rb_cModule</a>, <span class="stringliteral">&quot;extend_object&quot;</span>, <a class="code" href="../../d3/d57/eval_8c.html#ac23ac222bbc0b1ee8209760d27f0c736">rb_mod_extend_object</a>, 1);
<a name="l01140"></a>01140     <a class="code" href="../../d7/d19/group__defmethod.html#ga69c4f84891831d013e9e64972de90d78">rb_define_private_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#ad35b93cf98ae9c41f3394fd51383f774">rb_cModule</a>, <span class="stringliteral">&quot;include&quot;</span>, <a class="code" href="../../d3/d57/eval_8c.html#a97eab16e8b5362dfa7b2ba6ce0f2af55">rb_mod_include</a>, -1);
<a name="l01141"></a>01141 
<a name="l01142"></a>01142     <a class="code" href="../../d7/d19/group__defmethod.html#ga879be4a71b806afb2854833fc1c45981">rb_undef_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a39a2be92a95d7219204ab58d8f40533d">rb_cClass</a>, <span class="stringliteral">&quot;module_function&quot;</span>);
<a name="l01143"></a>01143 
<a name="l01144"></a>01144     <a class="code" href="../../d3/d80/vm__eval_8c.html#a2d1180a3b912593f588c8586832254ab">Init_vm_eval</a>();
<a name="l01145"></a>01145     <a class="code" href="../../de/d63/vm__method_8c.html#a37b3f339e60819a9fbd0a5d5772d46bd">Init_eval_method</a>();
<a name="l01146"></a>01146 
<a name="l01147"></a>01147     <a class="code" href="../../d7/d19/group__defmethod.html#gaacfe6a2ec444bdc7f573afb75ea251fe" title="Defines a singleton method for obj.">rb_define_singleton_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#ad35b93cf98ae9c41f3394fd51383f774">rb_cModule</a>, <span class="stringliteral">&quot;nesting&quot;</span>, <a class="code" href="../../d3/d57/eval_8c.html#ad6fa4b5b5bddb1fe097beaa8ba048fea">rb_mod_nesting</a>, 0);
<a name="l01148"></a>01148     <a class="code" href="../../d7/d19/group__defmethod.html#gaacfe6a2ec444bdc7f573afb75ea251fe" title="Defines a singleton method for obj.">rb_define_singleton_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#ad35b93cf98ae9c41f3394fd51383f774">rb_cModule</a>, <span class="stringliteral">&quot;constants&quot;</span>, <a class="code" href="../../d3/d57/eval_8c.html#ac10a70a3c86b4daee46e13f25c18178d">rb_mod_s_constants</a>, -1);
<a name="l01149"></a>01149 
<a name="l01150"></a>01150     <a class="code" href="../../d7/d19/group__defmethod.html#gaacfe6a2ec444bdc7f573afb75ea251fe" title="Defines a singleton method for obj.">rb_define_singleton_method</a>(<a class="code" href="../../dd/dd0/eval__intern_8h.html#aa1fe1e87b9459fc45f42b15a0600611a">rb_vm_top_self</a>(), <span class="stringliteral">&quot;include&quot;</span>, <a class="code" href="../../d3/d57/eval_8c.html#a19c948920308f936942b87d8f357f1bb">top_include</a>, -1);
<a name="l01151"></a>01151 
<a name="l01152"></a>01152     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a2f79a80cd4cd92563255889fdcc303b8">rb_mKernel</a>, <span class="stringliteral">&quot;extend&quot;</span>, <a class="code" href="../../d3/d57/eval_8c.html#a16b45463622559a654a3c0f7bafb91b0">rb_obj_extend</a>, -1);
<a name="l01153"></a>01153 
<a name="l01154"></a>01154     <a class="code" href="../../d7/d19/group__defmethod.html#gac08f58e00836e4e2586689e45b781bdd" title="Defines a global function.">rb_define_global_function</a>(<span class="stringliteral">&quot;trace_var&quot;</span>, <a class="code" href="../../db/d2e/intern_8h.html#ab7df960814180cb899fac131c22c5acd">rb_f_trace_var</a>, -1); <span class="comment">/* in variable.c */</span>
<a name="l01155"></a>01155     <a class="code" href="../../d7/d19/group__defmethod.html#gac08f58e00836e4e2586689e45b781bdd" title="Defines a global function.">rb_define_global_function</a>(<span class="stringliteral">&quot;untrace_var&quot;</span>, <a class="code" href="../../db/d2e/intern_8h.html#a8e23a8a8a3df1d97ccc69e4013b59fbf">rb_f_untrace_var</a>, -1);     <span class="comment">/* in variable.c */</span>
<a name="l01156"></a>01156 
<a name="l01157"></a>01157     <a class="code" href="../../d3/d57/eval_8c.html#a8a9edae7f9045c2c18fb899dc8823e68">exception_error</a> = <a class="code" href="../../db/dcc/error_8c.html#a4989eeb5742cad6359a2ed77859674de">rb_exc_new3</a>(<a class="code" href="../../db/dcc/error_8c.html#a7df09bfc26c0ffa7592f91fdcf64fcec">rb_eFatal</a>,
<a name="l01158"></a>01158                                   <a class="code" href="../../db/d2e/intern_8h.html#a8ea3742679211f408cb5769de6cf0d46">rb_obj_freeze</a>(<a class="code" href="../../db/d2e/intern_8h.html#a03acd62c0b1edebbe1d61f957c19b7ac">rb_str_new2</a>(<span class="stringliteral">&quot;exception reentered&quot;</span>)));
<a name="l01159"></a>01159     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#afd75ea0cb81c17e76c73e593d1d8a860">OBJ_TAINT</a>(<a class="code" href="../../d3/d57/eval_8c.html#a8a9edae7f9045c2c18fb899dc8823e68">exception_error</a>);
<a name="l01160"></a>01160     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a7ae8fa209abf837905d53c1c4be7c75d">OBJ_FREEZE</a>(<a class="code" href="../../d3/d57/eval_8c.html#a8a9edae7f9045c2c18fb899dc8823e68">exception_error</a>);
<a name="l01161"></a>01161 }
<a name="l01162"></a>01162 
</pre></div></div>
<hr size="1"/><address style="text-align: right;"><small>Generated on 1 Mar 2013 for Ruby by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
