<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Ruby: compile.c Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="../../index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="../../files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="../../globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<h1>compile.c</h1><a href="../../d2/d47/compile_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/**********************************************************************</span>
<a name="l00002"></a>00002 <span class="comment"></span>
<a name="l00003"></a>00003 <span class="comment">  compile.c - ruby node tree -&gt; VM instruction sequence</span>
<a name="l00004"></a>00004 <span class="comment"></span>
<a name="l00005"></a>00005 <span class="comment">  $Author: naruse $</span>
<a name="l00006"></a>00006 <span class="comment">  created at: 04/01/01 03:42:15 JST</span>
<a name="l00007"></a>00007 <span class="comment"></span>
<a name="l00008"></a>00008 <span class="comment">  Copyright (C) 2004-2007 Koichi Sasada</span>
<a name="l00009"></a>00009 <span class="comment"></span>
<a name="l00010"></a>00010 <span class="comment">**********************************************************************/</span>
<a name="l00011"></a>00011 
<a name="l00012"></a>00012 <span class="preprocessor">#include &quot;<a class="code" href="../../de/de6/ruby_2ruby_8h.html">ruby/ruby.h</a>&quot;</span>
<a name="l00013"></a>00013 <span class="preprocessor">#include &quot;<a class="code" href="../../db/dde/internal_8h.html">internal.h</a>&quot;</span>
<a name="l00014"></a>00014 <span class="preprocessor">#include &lt;math.h&gt;</span>
<a name="l00015"></a>00015 
<a name="l00016"></a><a class="code" href="../../d2/d47/compile_8c.html#ac534a37407a3de663a0d57412e882fc0">00016</a> <span class="preprocessor">#define USE_INSN_STACK_INCREASE 1</span>
<a name="l00017"></a>00017 <span class="preprocessor"></span><span class="preprocessor">#include &quot;<a class="code" href="../../d8/d32/vm__core_8h.html">vm_core.h</a>&quot;</span>
<a name="l00018"></a>00018 <span class="preprocessor">#include &quot;<a class="code" href="../../d7/dc8/iseq_8h.html">iseq.h</a>&quot;</span>
<a name="l00019"></a>00019 <span class="preprocessor">#include &quot;<a class="code" href="../../d5/df8/insns_8inc.html">insns.inc</a>&quot;</span>
<a name="l00020"></a>00020 <span class="preprocessor">#include &quot;<a class="code" href="../../d9/d0e/insns__info_8inc.html">insns_info.inc</a>&quot;</span>
<a name="l00021"></a>00021 
<a name="l00022"></a><a class="code" href="../../d2/d47/compile_8c.html#a4ac8fee05a285361c33a2b0d9c2d555c">00022</a> <span class="preprocessor">#define numberof(array) (int)(sizeof(array) / sizeof((array)[0]))</span>
<a name="l00023"></a><a class="code" href="../../d2/d47/compile_8c.html#acd55fe1710206f036b5e80795eae3284">00023</a> <span class="preprocessor"></span><span class="preprocessor">#define FIXNUM_INC(n, i) ((n)+(INT2FIX(i)&amp;~FIXNUM_FLAG))</span>
<a name="l00024"></a><a class="code" href="../../d2/d47/compile_8c.html#aeef39742c5d024aaafaab1499c58fbf1">00024</a> <span class="preprocessor"></span><span class="preprocessor">#define FIXNUM_OR(n, i) ((n)|INT2FIX(i))</span>
<a name="l00025"></a>00025 <span class="preprocessor"></span>
<a name="l00026"></a><a class="code" href="../../dc/dd8/structiseq__link__element.html">00026</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../dc/dd8/structiseq__link__element.html">iseq_link_element</a> {
<a name="l00027"></a>00027     <span class="keyword">enum</span> {
<a name="l00028"></a><a class="code" href="../../dc/dd8/structiseq__link__element.html#a2f14d3948b7323903550ae96d35ae56da8a83ec5d1dad4cbe833406c449030359">00028</a>         <a class="code" href="../../dc/dd8/structiseq__link__element.html#a2f14d3948b7323903550ae96d35ae56da8a83ec5d1dad4cbe833406c449030359">ISEQ_ELEMENT_NONE</a>,
<a name="l00029"></a><a class="code" href="../../dc/dd8/structiseq__link__element.html#a2f14d3948b7323903550ae96d35ae56da598fabcacf68ba1ef27974e61f8a64b9">00029</a>         <a class="code" href="../../dc/dd8/structiseq__link__element.html#a2f14d3948b7323903550ae96d35ae56da598fabcacf68ba1ef27974e61f8a64b9">ISEQ_ELEMENT_LABEL</a>,
<a name="l00030"></a><a class="code" href="../../dc/dd8/structiseq__link__element.html#a2f14d3948b7323903550ae96d35ae56daa48e836123ef90a1785bfd2a928499f4">00030</a>         <a class="code" href="../../dc/dd8/structiseq__link__element.html#a2f14d3948b7323903550ae96d35ae56daa48e836123ef90a1785bfd2a928499f4">ISEQ_ELEMENT_INSN</a>,
<a name="l00031"></a><a class="code" href="../../dc/dd8/structiseq__link__element.html#a2f14d3948b7323903550ae96d35ae56da4bfaff520676ad1f2d3cee91798d5ade">00031</a>         <a class="code" href="../../dc/dd8/structiseq__link__element.html#a2f14d3948b7323903550ae96d35ae56da4bfaff520676ad1f2d3cee91798d5ade">ISEQ_ELEMENT_ADJUST</a>
<a name="l00032"></a>00032     } <a class="code" href="../../dc/dd8/structiseq__link__element.html#a36dbc4d260432e7b26802451326ac92f">type</a>;
<a name="l00033"></a><a class="code" href="../../dc/dd8/structiseq__link__element.html#aaae92b0ba47e61c8c36eba5dac082957">00033</a>     <span class="keyword">struct </span><a class="code" href="../../dc/dd8/structiseq__link__element.html">iseq_link_element</a> *<a class="code" href="../../dc/dd8/structiseq__link__element.html#aaae92b0ba47e61c8c36eba5dac082957">next</a>;
<a name="l00034"></a><a class="code" href="../../dc/dd8/structiseq__link__element.html#a9b8195e4fd0634def4fb75be28bef536">00034</a>     <span class="keyword">struct </span><a class="code" href="../../dc/dd8/structiseq__link__element.html">iseq_link_element</a> *<a class="code" href="../../dc/dd8/structiseq__link__element.html#a9b8195e4fd0634def4fb75be28bef536">prev</a>;
<a name="l00035"></a>00035 } <a class="code" href="../../dc/dd8/structiseq__link__element.html">LINK_ELEMENT</a>;
<a name="l00036"></a>00036 
<a name="l00037"></a><a class="code" href="../../d4/dcd/structiseq__link__anchor.html">00037</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d4/dcd/structiseq__link__anchor.html">iseq_link_anchor</a> {
<a name="l00038"></a><a class="code" href="../../d4/dcd/structiseq__link__anchor.html#a38f0d32636c5b0b20f8b82816530f20c">00038</a>     <a class="code" href="../../dc/dd8/structiseq__link__element.html">LINK_ELEMENT</a> <a class="code" href="../../d4/dcd/structiseq__link__anchor.html#a38f0d32636c5b0b20f8b82816530f20c">anchor</a>;
<a name="l00039"></a><a class="code" href="../../d4/dcd/structiseq__link__anchor.html#a51b3384a1d06e26fdf1214c219f19927">00039</a>     <a class="code" href="../../dc/dd8/structiseq__link__element.html">LINK_ELEMENT</a> *<a class="code" href="../../d4/dcd/structiseq__link__anchor.html#a51b3384a1d06e26fdf1214c219f19927">last</a>;
<a name="l00040"></a>00040 } <a class="code" href="../../d4/dcd/structiseq__link__anchor.html">LINK_ANCHOR</a>;
<a name="l00041"></a>00041 
<a name="l00042"></a><a class="code" href="../../d8/dc5/structiseq__label__data.html">00042</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d8/dc5/structiseq__label__data.html">iseq_label_data</a> {
<a name="l00043"></a><a class="code" href="../../d8/dc5/structiseq__label__data.html#abf04ba28589819eff2e67e3884a040f0">00043</a>     <a class="code" href="../../dc/dd8/structiseq__link__element.html">LINK_ELEMENT</a> <a class="code" href="../../d8/dc5/structiseq__label__data.html#abf04ba28589819eff2e67e3884a040f0">link</a>;
<a name="l00044"></a><a class="code" href="../../d8/dc5/structiseq__label__data.html#ae41778d86068bb63216de9834cfbce7e">00044</a>     <span class="keywordtype">int</span> <a class="code" href="../../d8/dc5/structiseq__label__data.html#ae41778d86068bb63216de9834cfbce7e">label_no</a>;
<a name="l00045"></a><a class="code" href="../../d8/dc5/structiseq__label__data.html#abc4000df6eb58ca5faf57f9ee446b116">00045</a>     <span class="keywordtype">int</span> <a class="code" href="../../d8/dc5/structiseq__label__data.html#abc4000df6eb58ca5faf57f9ee446b116">position</a>;
<a name="l00046"></a><a class="code" href="../../d8/dc5/structiseq__label__data.html#ac15f213f0f9e22b989778d50ef8b8328">00046</a>     <span class="keywordtype">int</span> <a class="code" href="../../d8/dc5/structiseq__label__data.html#ac15f213f0f9e22b989778d50ef8b8328">sc_state</a>;
<a name="l00047"></a><a class="code" href="../../d8/dc5/structiseq__label__data.html#aac5ed967044526293b00efef682e8a66">00047</a>     <span class="keywordtype">int</span> <span class="keyword">set</span>;
<a name="l00048"></a><a class="code" href="../../d8/dc5/structiseq__label__data.html#ae4b50f2e5fc116dfc1d17ac227840e2e">00048</a>     <span class="keywordtype">int</span> <a class="code" href="../../d8/dc5/structiseq__label__data.html#ae4b50f2e5fc116dfc1d17ac227840e2e">sp</a>;
<a name="l00049"></a>00049 } <a class="code" href="../../d8/dc5/structiseq__label__data.html">LABEL</a>;
<a name="l00050"></a>00050 
<a name="l00051"></a><a class="code" href="../../db/d57/structiseq__insn__data.html">00051</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../db/d57/structiseq__insn__data.html">iseq_insn_data</a> {
<a name="l00052"></a><a class="code" href="../../db/d57/structiseq__insn__data.html#aa7e061b84452f211dffd6accf084fa31">00052</a>     <a class="code" href="../../dc/dd8/structiseq__link__element.html">LINK_ELEMENT</a> <a class="code" href="../../db/d57/structiseq__insn__data.html#aa7e061b84452f211dffd6accf084fa31">link</a>;
<a name="l00053"></a><a class="code" href="../../db/d57/structiseq__insn__data.html#ab1f1e3095532dd0ece9bb256047a027e">00053</a>     <span class="keyword">enum</span> ruby_vminsn_type <a class="code" href="../../db/d57/structiseq__insn__data.html#ab1f1e3095532dd0ece9bb256047a027e">insn_id</a>;
<a name="l00054"></a><a class="code" href="../../db/d57/structiseq__insn__data.html#a7da955a957d6555a0c0454dee8508669">00054</a>     <span class="keywordtype">int</span> <a class="code" href="../../db/d57/structiseq__insn__data.html#a7da955a957d6555a0c0454dee8508669">line_no</a>;
<a name="l00055"></a><a class="code" href="../../db/d57/structiseq__insn__data.html#aec0e69fa21d100503fd6b901003b3c27">00055</a>     <span class="keywordtype">int</span> <a class="code" href="../../db/d57/structiseq__insn__data.html#aec0e69fa21d100503fd6b901003b3c27">operand_size</a>;
<a name="l00056"></a><a class="code" href="../../db/d57/structiseq__insn__data.html#a2400b3da3accd8be533c97b47f186acd">00056</a>     <span class="keywordtype">int</span> <a class="code" href="../../db/d57/structiseq__insn__data.html#a2400b3da3accd8be533c97b47f186acd">sc_state</a>;
<a name="l00057"></a><a class="code" href="../../db/d57/structiseq__insn__data.html#ae83a50dd669328f4915717f99d8805c5">00057</a>     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> *<a class="code" href="../../db/d57/structiseq__insn__data.html#ae83a50dd669328f4915717f99d8805c5">operands</a>;
<a name="l00058"></a>00058 } <a class="code" href="../../db/d57/structiseq__insn__data.html">INSN</a>;
<a name="l00059"></a>00059 
<a name="l00060"></a><a class="code" href="../../d1/d19/structiseq__adjust__data.html">00060</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d1/d19/structiseq__adjust__data.html">iseq_adjust_data</a> {
<a name="l00061"></a><a class="code" href="../../d1/d19/structiseq__adjust__data.html#a5ab16054d00eb1f86cf4de8d9544040e">00061</a>     <a class="code" href="../../dc/dd8/structiseq__link__element.html">LINK_ELEMENT</a> <a class="code" href="../../d1/d19/structiseq__adjust__data.html#a5ab16054d00eb1f86cf4de8d9544040e">link</a>;
<a name="l00062"></a><a class="code" href="../../d1/d19/structiseq__adjust__data.html#a0d755f7879e8378b46a8c3c2431fb65e">00062</a>     <a class="code" href="../../d8/dc5/structiseq__label__data.html">LABEL</a> *<a class="code" href="../../d1/d19/structiseq__adjust__data.html#a0d755f7879e8378b46a8c3c2431fb65e">label</a>;
<a name="l00063"></a><a class="code" href="../../d1/d19/structiseq__adjust__data.html#acd27d315d7852871c7fb9dcb15acb438">00063</a>     <span class="keywordtype">int</span> <a class="code" href="../../d1/d19/structiseq__adjust__data.html#acd27d315d7852871c7fb9dcb15acb438">line_no</a>;
<a name="l00064"></a>00064 } <a class="code" href="../../d1/d19/structiseq__adjust__data.html">ADJUST</a>;
<a name="l00065"></a>00065 
<a name="l00066"></a><a class="code" href="../../da/d32/structensure__range.html">00066</a> <span class="keyword">struct </span><a class="code" href="../../da/d32/structensure__range.html">ensure_range</a> {
<a name="l00067"></a><a class="code" href="../../da/d32/structensure__range.html#a8ad1f4748dfe9dcf6667452d0d3e8ed0">00067</a>     <a class="code" href="../../d8/dc5/structiseq__label__data.html">LABEL</a> *<a class="code" href="../../da/d32/structensure__range.html#a8ad1f4748dfe9dcf6667452d0d3e8ed0">begin</a>;
<a name="l00068"></a><a class="code" href="../../da/d32/structensure__range.html#aa15081d5666a57e4df5a74bbad8cda12">00068</a>     <a class="code" href="../../d8/dc5/structiseq__label__data.html">LABEL</a> *<a class="code" href="../../da/d32/structensure__range.html#aa15081d5666a57e4df5a74bbad8cda12">end</a>;
<a name="l00069"></a><a class="code" href="../../da/d32/structensure__range.html#a2db4411cce7aefb5b8c9a9ce4dadd2e7">00069</a>     <span class="keyword">struct </span><a class="code" href="../../da/d32/structensure__range.html">ensure_range</a> *<a class="code" href="../../da/d32/structensure__range.html#a2db4411cce7aefb5b8c9a9ce4dadd2e7">next</a>;
<a name="l00070"></a>00070 };
<a name="l00071"></a>00071 
<a name="l00072"></a><a class="code" href="../../d6/dca/structiseq__compile__data__ensure__node__stack.html">00072</a> <span class="keyword">struct </span><a class="code" href="../../d6/dca/structiseq__compile__data__ensure__node__stack.html">iseq_compile_data_ensure_node_stack</a> {
<a name="l00073"></a><a class="code" href="../../d6/dca/structiseq__compile__data__ensure__node__stack.html#a9aa4970b49eac1b043120fa7be4efad4">00073</a>     NODE *<a class="code" href="../../d6/dca/structiseq__compile__data__ensure__node__stack.html#a9aa4970b49eac1b043120fa7be4efad4">ensure_node</a>;
<a name="l00074"></a><a class="code" href="../../d6/dca/structiseq__compile__data__ensure__node__stack.html#a4da021e50680d45890063a5f7f8160ae">00074</a>     <span class="keyword">struct </span><a class="code" href="../../d6/dca/structiseq__compile__data__ensure__node__stack.html">iseq_compile_data_ensure_node_stack</a> *<a class="code" href="../../d6/dca/structiseq__compile__data__ensure__node__stack.html#a4da021e50680d45890063a5f7f8160ae">prev</a>;
<a name="l00075"></a><a class="code" href="../../d6/dca/structiseq__compile__data__ensure__node__stack.html#ac7ba7bd330d22b7ff0bfc0deb1217947">00075</a>     <span class="keyword">struct </span><a class="code" href="../../da/d32/structensure__range.html">ensure_range</a> *<a class="code" href="../../d6/dca/structiseq__compile__data__ensure__node__stack.html#ac7ba7bd330d22b7ff0bfc0deb1217947">erange</a>;
<a name="l00076"></a>00076 };
<a name="l00077"></a>00077 
<a name="l00091"></a>00091 <span class="preprocessor">#ifndef CPDEBUG</span>
<a name="l00092"></a><a class="code" href="../../d2/d47/compile_8c.html#a85e98a20e8f374c559aa921162387be1">00092</a> <span class="preprocessor"></span><span class="preprocessor">#define CPDEBUG 0</span>
<a name="l00093"></a>00093 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00094"></a>00094 <span class="preprocessor"></span>
<a name="l00095"></a>00095 <span class="preprocessor">#if CPDEBUG &gt;= 0</span>
<a name="l00096"></a><a class="code" href="../../d2/d47/compile_8c.html#a0c123c89fd53eedc6774ffc0b00f16dd">00096</a> <span class="preprocessor"></span><span class="preprocessor">#define compile_debug CPDEBUG</span>
<a name="l00097"></a>00097 <span class="preprocessor"></span><span class="preprocessor">#else</span>
<a name="l00098"></a>00098 <span class="preprocessor"></span><span class="preprocessor">#define compile_debug iseq-&gt;compile_data-&gt;option-&gt;debug_level</span>
<a name="l00099"></a>00099 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00100"></a>00100 <span class="preprocessor"></span>
<a name="l00101"></a>00101 <span class="preprocessor">#if CPDEBUG</span>
<a name="l00102"></a>00102 <span class="preprocessor"></span>
<a name="l00103"></a>00103 <span class="preprocessor">#define compile_debug_print_indent(level) \</span>
<a name="l00104"></a>00104 <span class="preprocessor">    ruby_debug_print_indent((level), compile_debug, gl_node_level * 2)</span>
<a name="l00105"></a>00105 <span class="preprocessor"></span>
<a name="l00106"></a>00106 <span class="preprocessor">#define debugp(header, value) (void) \</span>
<a name="l00107"></a>00107 <span class="preprocessor">  (compile_debug_print_indent(1) &amp;&amp; \</span>
<a name="l00108"></a>00108 <span class="preprocessor">   ruby_debug_print_value(1, compile_debug, (header), (value)))</span>
<a name="l00109"></a>00109 <span class="preprocessor"></span>
<a name="l00110"></a>00110 <span class="preprocessor">#define debugi(header, id)  (void) \</span>
<a name="l00111"></a>00111 <span class="preprocessor">  (compile_debug_print_indent(1) &amp;&amp; \</span>
<a name="l00112"></a>00112 <span class="preprocessor">   ruby_debug_print_id(1, compile_debug, (header), (id)))</span>
<a name="l00113"></a>00113 <span class="preprocessor"></span>
<a name="l00114"></a>00114 <span class="preprocessor">#define debugp_param(header, value)  (void) \</span>
<a name="l00115"></a>00115 <span class="preprocessor">  (compile_debug_print_indent(1) &amp;&amp; \</span>
<a name="l00116"></a>00116 <span class="preprocessor">   ruby_debug_print_value(1, compile_debug, (header), (value)))</span>
<a name="l00117"></a>00117 <span class="preprocessor"></span>
<a name="l00118"></a>00118 <span class="preprocessor">#define debugp_verbose(header, value)  (void) \</span>
<a name="l00119"></a>00119 <span class="preprocessor">  (compile_debug_print_indent(2) &amp;&amp; \</span>
<a name="l00120"></a>00120 <span class="preprocessor">   ruby_debug_print_value(2, compile_debug, (header), (value)))</span>
<a name="l00121"></a>00121 <span class="preprocessor"></span>
<a name="l00122"></a>00122 <span class="preprocessor">#define debugp_verbose_node(header, value)  (void) \</span>
<a name="l00123"></a>00123 <span class="preprocessor">  (compile_debug_print_indent(10) &amp;&amp; \</span>
<a name="l00124"></a>00124 <span class="preprocessor">   ruby_debug_print_value(10, compile_debug, (header), (value)))</span>
<a name="l00125"></a>00125 <span class="preprocessor"></span>
<a name="l00126"></a>00126 <span class="preprocessor">#define debug_node_start(node)  ((void) \</span>
<a name="l00127"></a>00127 <span class="preprocessor">  (compile_debug_print_indent(1) &amp;&amp; \</span>
<a name="l00128"></a>00128 <span class="preprocessor">   (ruby_debug_print_node(1, CPDEBUG, &quot;&quot;, (NODE *)(node)), gl_node_level)), \</span>
<a name="l00129"></a>00129 <span class="preprocessor">   gl_node_level++)</span>
<a name="l00130"></a>00130 <span class="preprocessor"></span>
<a name="l00131"></a>00131 <span class="preprocessor">#define debug_node_end()  gl_node_level --;</span>
<a name="l00132"></a>00132 <span class="preprocessor"></span>
<a name="l00133"></a>00133 <span class="preprocessor">#else</span>
<a name="l00134"></a>00134 <span class="preprocessor"></span>
<a name="l00135"></a>00135 <span class="keyword">static</span> <span class="keyword">inline</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#afa5b9137f051ac26d7ccc8824f178233">ID</a>
<a name="l00136"></a><a class="code" href="../../d2/d47/compile_8c.html#a15c812b536fb65d95c913e133bdec814">00136</a> <a class="code" href="../../d2/d47/compile_8c.html#a15c812b536fb65d95c913e133bdec814">r_id</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#afa5b9137f051ac26d7ccc8824f178233">ID</a> <span class="keywordtype">id</span>)
<a name="l00137"></a>00137 {
<a name="l00138"></a>00138     <span class="keywordflow">return</span> id;
<a name="l00139"></a>00139 }
<a name="l00140"></a>00140 
<a name="l00141"></a>00141 <span class="keyword">static</span> <span class="keyword">inline</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l00142"></a><a class="code" href="../../d2/d47/compile_8c.html#a648dba11f07067ce0c4752424f60c264">00142</a> <a class="code" href="../../d2/d47/compile_8c.html#a648dba11f07067ce0c4752424f60c264">r_value</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> value)
<a name="l00143"></a>00143 {
<a name="l00144"></a>00144     <span class="keywordflow">return</span> value;
<a name="l00145"></a>00145 }
<a name="l00146"></a>00146 
<a name="l00147"></a><a class="code" href="../../d2/d47/compile_8c.html#a9156fef334af9c349bedf159ff008bb4">00147</a> <span class="preprocessor">#define debugi(header, id)                 r_id(id)</span>
<a name="l00148"></a><a class="code" href="../../d2/d47/compile_8c.html#af07f1ce539841357da73a8007f52eed9">00148</a> <span class="preprocessor"></span><span class="preprocessor">#define debugp(header, value)              r_value(value)</span>
<a name="l00149"></a><a class="code" href="../../d2/d47/compile_8c.html#a1a8012db9123255ade930735018c11c8">00149</a> <span class="preprocessor"></span><span class="preprocessor">#define debugp_verbose(header, value)      r_value(value)</span>
<a name="l00150"></a><a class="code" href="../../d2/d47/compile_8c.html#aebef04d9a63a926bdacfd9c578f92dc0">00150</a> <span class="preprocessor"></span><span class="preprocessor">#define debugp_verbose_node(header, value) r_value(value)</span>
<a name="l00151"></a><a class="code" href="../../d2/d47/compile_8c.html#ad983bdc29f9c5bde5ab33d14c3d143e6">00151</a> <span class="preprocessor"></span><span class="preprocessor">#define debugp_param(header, value)        r_value(value)</span>
<a name="l00152"></a><a class="code" href="../../d2/d47/compile_8c.html#ad6f547f3bb2685a3a6732463b3dd1d34">00152</a> <span class="preprocessor"></span><span class="preprocessor">#define debug_node_start(node)             ((void)0)</span>
<a name="l00153"></a><a class="code" href="../../d2/d47/compile_8c.html#a4f7ac050d78d7eb204448c261e105474">00153</a> <span class="preprocessor"></span><span class="preprocessor">#define debug_node_end()                   ((void)0)</span>
<a name="l00154"></a>00154 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00155"></a>00155 <span class="preprocessor"></span>
<a name="l00156"></a>00156 <span class="preprocessor">#if CPDEBUG &gt; 1 || CPDEBUG &lt; 0</span>
<a name="l00157"></a>00157 <span class="preprocessor"></span><span class="preprocessor">#define debugs if (compile_debug_print_indent(1)) ruby_debug_printf</span>
<a name="l00158"></a>00158 <span class="preprocessor"></span><span class="preprocessor">#define debug_compile(msg, v) ((void)(compile_debug_print_indent(1) &amp;&amp; fputs((msg), stderr)), (v))</span>
<a name="l00159"></a>00159 <span class="preprocessor"></span><span class="preprocessor">#else</span>
<a name="l00160"></a><a class="code" href="../../d2/d47/compile_8c.html#a72ae3dfc8896ca7c87ed2aed1810db43">00160</a> <span class="preprocessor"></span><span class="preprocessor">#define debugs                             if(0)printf</span>
<a name="l00161"></a><a class="code" href="../../d2/d47/compile_8c.html#a7c4e8be7123289596dbb7c6c9b88152b">00161</a> <span class="preprocessor"></span><span class="preprocessor">#define debug_compile(msg, v) (v)</span>
<a name="l00162"></a>00162 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00163"></a>00163 <span class="preprocessor"></span>
<a name="l00164"></a>00164 
<a name="l00165"></a>00165 <span class="comment">/* create new label */</span>
<a name="l00166"></a><a class="code" href="../../d2/d47/compile_8c.html#a1d6d5d8dac7aff9ac863255a0905c0f9">00166</a> <span class="preprocessor">#define NEW_LABEL(l) new_label_body(iseq, (l))</span>
<a name="l00167"></a>00167 <span class="preprocessor"></span>
<a name="l00168"></a><a class="code" href="../../d2/d47/compile_8c.html#ac1566fa4c45feb883039e2de91e2ff53">00168</a> <span class="preprocessor">#define iseq_filename(iseq) \</span>
<a name="l00169"></a>00169 <span class="preprocessor">  (((rb_iseq_t*)DATA_PTR(iseq))-&gt;filename)</span>
<a name="l00170"></a>00170 <span class="preprocessor"></span>
<a name="l00171"></a><a class="code" href="../../d2/d47/compile_8c.html#abcadf20817c0ce5c74e3e7d568aef4b7">00171</a> <span class="preprocessor">#define iseq_filepath(iseq) \</span>
<a name="l00172"></a>00172 <span class="preprocessor">  (((rb_iseq_t*)DATA_PTR(iseq))-&gt;filepath)</span>
<a name="l00173"></a>00173 <span class="preprocessor"></span>
<a name="l00174"></a><a class="code" href="../../d2/d47/compile_8c.html#a988d32e5fce03fdcc541a7418d7b01f9">00174</a> <span class="preprocessor">#define NEW_ISEQVAL(node, name, type, line_no)       \</span>
<a name="l00175"></a>00175 <span class="preprocessor">  new_child_iseq(iseq, (node), (name), 0, (type), (line_no))</span>
<a name="l00176"></a>00176 <span class="preprocessor"></span>
<a name="l00177"></a><a class="code" href="../../d2/d47/compile_8c.html#a8b46ed4917f951327df16ff64ed8f67c">00177</a> <span class="preprocessor">#define NEW_CHILD_ISEQVAL(node, name, type, line_no)       \</span>
<a name="l00178"></a>00178 <span class="preprocessor">  new_child_iseq(iseq, (node), (name), iseq-&gt;self, (type), (line_no))</span>
<a name="l00179"></a>00179 <span class="preprocessor"></span>
<a name="l00180"></a>00180 <span class="comment">/* add instructions */</span>
<a name="l00181"></a><a class="code" href="../../d2/d47/compile_8c.html#afd9d72d069724385c83bcc32d6746b1e">00181</a> <span class="preprocessor">#define ADD_SEQ(seq1, seq2) \</span>
<a name="l00182"></a>00182 <span class="preprocessor">  APPEND_LIST((seq1), (seq2))</span>
<a name="l00183"></a>00183 <span class="preprocessor"></span>
<a name="l00184"></a>00184 <span class="comment">/* add an instruction */</span>
<a name="l00185"></a><a class="code" href="../../d2/d47/compile_8c.html#aa5b45ae61de3350f0830a32589bbb7ee">00185</a> <span class="preprocessor">#define ADD_INSN(seq, line, insn) \</span>
<a name="l00186"></a>00186 <span class="preprocessor">  ADD_ELEM((seq), (LINK_ELEMENT *) new_insn_body(iseq, (line), BIN(insn), 0))</span>
<a name="l00187"></a>00187 <span class="preprocessor"></span>
<a name="l00188"></a>00188 <span class="comment">/* add an instruction with label operand */</span>
<a name="l00189"></a><a class="code" href="../../d2/d47/compile_8c.html#ace57e2f70722586d3764284364cfb5ad">00189</a> <span class="preprocessor">#define ADD_INSNL(seq, line, insn, label) \</span>
<a name="l00190"></a>00190 <span class="preprocessor">  ADD_ELEM((seq), (LINK_ELEMENT *) \</span>
<a name="l00191"></a>00191 <span class="preprocessor">           new_insn_body(iseq, (line), BIN(insn), 1, (VALUE)(label)))</span>
<a name="l00192"></a>00192 <span class="preprocessor"></span>
<a name="l00193"></a>00193 <span class="comment">/* add an instruction with some operands (1, 2, 3, 5) */</span>
<a name="l00194"></a><a class="code" href="../../d2/d47/compile_8c.html#a3cfeb7549a1249a8b78f9d6ff1e74c5a">00194</a> <span class="preprocessor">#define ADD_INSN1(seq, line, insn, op1) \</span>
<a name="l00195"></a>00195 <span class="preprocessor">  ADD_ELEM((seq), (LINK_ELEMENT *) \</span>
<a name="l00196"></a>00196 <span class="preprocessor">           new_insn_body(iseq, (line), BIN(insn), 1, (VALUE)(op1)))</span>
<a name="l00197"></a>00197 <span class="preprocessor"></span>
<a name="l00198"></a><a class="code" href="../../d2/d47/compile_8c.html#a9e17ccfd8b31ec3afcb91be39a6d453f">00198</a> <span class="preprocessor">#define ADD_INSN2(seq, line, insn, op1, op2) \</span>
<a name="l00199"></a>00199 <span class="preprocessor">  ADD_ELEM((seq), (LINK_ELEMENT *) \</span>
<a name="l00200"></a>00200 <span class="preprocessor">           new_insn_body(iseq, (line), BIN(insn), 2, (VALUE)(op1), (VALUE)(op2)))</span>
<a name="l00201"></a>00201 <span class="preprocessor"></span>
<a name="l00202"></a><a class="code" href="../../d2/d47/compile_8c.html#af8e927ae02d27d3a3934dcc65a2d21c9">00202</a> <span class="preprocessor">#define ADD_INSN3(seq, line, insn, op1, op2, op3) \</span>
<a name="l00203"></a>00203 <span class="preprocessor">  ADD_ELEM((seq), (LINK_ELEMENT *) \</span>
<a name="l00204"></a>00204 <span class="preprocessor">           new_insn_body(iseq, (line), BIN(insn), 3, (VALUE)(op1), (VALUE)(op2), (VALUE)(op3)))</span>
<a name="l00205"></a>00205 <span class="preprocessor"></span>
<a name="l00206"></a>00206 <span class="comment">/* Specific Insn factory */</span>
<a name="l00207"></a><a class="code" href="../../d2/d47/compile_8c.html#ab1941f9308f4508ab33b8828fec890fd">00207</a> <span class="preprocessor">#define ADD_SEND(seq, line, id, argc) \</span>
<a name="l00208"></a>00208 <span class="preprocessor">  ADD_SEND_R((seq), (line), (id), (argc), (VALUE)Qfalse, (VALUE)INT2FIX(0))</span>
<a name="l00209"></a>00209 <span class="preprocessor"></span>
<a name="l00210"></a><a class="code" href="../../d2/d47/compile_8c.html#a50d9af29f829b84d8d09dbd8a6ccde89">00210</a> <span class="preprocessor">#define ADD_CALL_RECEIVER(seq, line) \</span>
<a name="l00211"></a>00211 <span class="preprocessor">  ADD_INSN((seq), (line), putself)</span>
<a name="l00212"></a>00212 <span class="preprocessor"></span>
<a name="l00213"></a><a class="code" href="../../d2/d47/compile_8c.html#ab48821feeaaab5e4b16d951222546ef4">00213</a> <span class="preprocessor">#define ADD_CALL(seq, line, id, argc) \</span>
<a name="l00214"></a>00214 <span class="preprocessor">  ADD_SEND_R((seq), (line), (id), (argc), (VALUE)Qfalse, (VALUE)INT2FIX(VM_CALL_FCALL_BIT))</span>
<a name="l00215"></a>00215 <span class="preprocessor"></span>
<a name="l00216"></a><a class="code" href="../../d2/d47/compile_8c.html#aeddf6949862a74eba2b7f2fa8f6fa1c4">00216</a> <span class="preprocessor">#define ADD_CALL_WITH_BLOCK(seq, line, id, argc, block) \</span>
<a name="l00217"></a>00217 <span class="preprocessor">  ADD_SEND_R((seq), (line), (id), (argc), (block), (VALUE)INT2FIX(VM_CALL_FCALL_BIT))</span>
<a name="l00218"></a>00218 <span class="preprocessor"></span>
<a name="l00219"></a><a class="code" href="../../d2/d47/compile_8c.html#a8e30721d838a4a66104bbecb561ef0c9">00219</a> <span class="preprocessor">#define ADD_SEND_R(seq, line, id, argc, block, flag) \</span>
<a name="l00220"></a>00220 <span class="preprocessor">  ADD_ELEM((seq), (LINK_ELEMENT *) \</span>
<a name="l00221"></a>00221 <span class="preprocessor">           new_insn_send(iseq, (line), \</span>
<a name="l00222"></a>00222 <span class="preprocessor">                         (VALUE)(id), (VALUE)(argc), (VALUE)(block), (VALUE)(flag)))</span>
<a name="l00223"></a>00223 <span class="preprocessor"></span>
<a name="l00224"></a><a class="code" href="../../d2/d47/compile_8c.html#a1da9ded6df71178c67dd7252e3c64ea1">00224</a> <span class="preprocessor">#define ADD_TRACE(seq, line, event) \</span>
<a name="l00225"></a>00225 <span class="preprocessor">  do { \</span>
<a name="l00226"></a>00226 <span class="preprocessor">      if ((event) == RUBY_EVENT_LINE &amp;&amp; iseq-&gt;coverage &amp;&amp; \</span>
<a name="l00227"></a>00227 <span class="preprocessor">          (line) != iseq-&gt;compile_data-&gt;last_coverable_line) { \</span>
<a name="l00228"></a>00228 <span class="preprocessor">          RARRAY_PTR(iseq-&gt;coverage)[(line) - 1] = INT2FIX(0); \</span>
<a name="l00229"></a>00229 <span class="preprocessor">          iseq-&gt;compile_data-&gt;last_coverable_line = (line); \</span>
<a name="l00230"></a>00230 <span class="preprocessor">          ADD_INSN1((seq), (line), trace, INT2FIX(RUBY_EVENT_COVERAGE)); \</span>
<a name="l00231"></a>00231 <span class="preprocessor">      } \</span>
<a name="l00232"></a>00232 <span class="preprocessor">      if (iseq-&gt;compile_data-&gt;option-&gt;trace_instruction) { \</span>
<a name="l00233"></a>00233 <span class="preprocessor">          ADD_INSN1((seq), (line), trace, INT2FIX(event)); \</span>
<a name="l00234"></a>00234 <span class="preprocessor">      } \</span>
<a name="l00235"></a>00235 <span class="preprocessor">  }while(0);</span>
<a name="l00236"></a>00236 <span class="preprocessor"></span>
<a name="l00237"></a>00237 <span class="comment">/* add label */</span>
<a name="l00238"></a><a class="code" href="../../d2/d47/compile_8c.html#a5a380bb449656575d6b77ccb8eb7e5ae">00238</a> <span class="preprocessor">#define ADD_LABEL(seq, label) \</span>
<a name="l00239"></a>00239 <span class="preprocessor">  ADD_ELEM((seq), (LINK_ELEMENT *) (label))</span>
<a name="l00240"></a>00240 <span class="preprocessor"></span>
<a name="l00241"></a><a class="code" href="../../d2/d47/compile_8c.html#a3300101eaba3d9747c940283c66849fa">00241</a> <span class="preprocessor">#define APPEND_LABEL(seq, before, label) \</span>
<a name="l00242"></a>00242 <span class="preprocessor">  APPEND_ELEM((seq), (before), (LINK_ELEMENT *) (label))</span>
<a name="l00243"></a>00243 <span class="preprocessor"></span>
<a name="l00244"></a><a class="code" href="../../d2/d47/compile_8c.html#a8b64a8adfda023035ad3a2cf77040fb6">00244</a> <span class="preprocessor">#define ADD_ADJUST(seq, line, label) \</span>
<a name="l00245"></a>00245 <span class="preprocessor">  ADD_ELEM((seq), (LINK_ELEMENT *) new_adjust_body(iseq, (label), (line)))</span>
<a name="l00246"></a>00246 <span class="preprocessor"></span>
<a name="l00247"></a><a class="code" href="../../d2/d47/compile_8c.html#ad4c05d22ae467c4287c7aa617c4a66d6">00247</a> <span class="preprocessor">#define ADD_ADJUST_RESTORE(seq, label) \</span>
<a name="l00248"></a>00248 <span class="preprocessor">  ADD_ELEM((seq), (LINK_ELEMENT *) new_adjust_body(iseq, (label), -1))</span>
<a name="l00249"></a>00249 <span class="preprocessor"></span>
<a name="l00250"></a><a class="code" href="../../d2/d47/compile_8c.html#a668f1779f1e5158e6ad8d4b6d92638db">00250</a> <span class="preprocessor">#define ADD_CATCH_ENTRY(type, ls, le, iseqv, lc)                \</span>
<a name="l00251"></a>00251 <span class="preprocessor">    (rb_ary_push(iseq-&gt;compile_data-&gt;catch_table_ary,           \</span>
<a name="l00252"></a>00252 <span class="preprocessor">                 rb_ary_new3(5, (type),                         \</span>
<a name="l00253"></a>00253 <span class="preprocessor">                             (VALUE)(ls) | 1, (VALUE)(le) | 1,  \</span>
<a name="l00254"></a>00254 <span class="preprocessor">                             (iseqv), (VALUE)(lc) | 1)))</span>
<a name="l00255"></a>00255 <span class="preprocessor"></span>
<a name="l00256"></a>00256 <span class="comment">/* compile node */</span>
<a name="l00257"></a><a class="code" href="../../d2/d47/compile_8c.html#a0cacd6cfca69df35e1535d2f21532c47">00257</a> <span class="preprocessor">#define COMPILE(anchor, desc, node) \</span>
<a name="l00258"></a>00258 <span class="preprocessor">  (debug_compile(&quot;== &quot; desc &quot;\n&quot;, \</span>
<a name="l00259"></a>00259 <span class="preprocessor">                 iseq_compile_each(iseq, (anchor), (node), 0)))</span>
<a name="l00260"></a>00260 <span class="preprocessor"></span>
<a name="l00261"></a>00261 <span class="comment">/* compile node, this node&apos;s value will be popped */</span>
<a name="l00262"></a><a class="code" href="../../d2/d47/compile_8c.html#a4e7115fce9f91ee84931798cc3474229">00262</a> <span class="preprocessor">#define COMPILE_POPED(anchor, desc, node)    \</span>
<a name="l00263"></a>00263 <span class="preprocessor">  (debug_compile(&quot;== &quot; desc &quot;\n&quot;, \</span>
<a name="l00264"></a>00264 <span class="preprocessor">                 iseq_compile_each(iseq, (anchor), (node), 1)))</span>
<a name="l00265"></a>00265 <span class="preprocessor"></span>
<a name="l00266"></a>00266 <span class="comment">/* compile node, which is popped when &apos;poped&apos; is true */</span>
<a name="l00267"></a><a class="code" href="../../d2/d47/compile_8c.html#a04d4dbcbb97179b5908eb025e13c7752">00267</a> <span class="preprocessor">#define COMPILE_(anchor, desc, node, poped)  \</span>
<a name="l00268"></a>00268 <span class="preprocessor">  (debug_compile(&quot;== &quot; desc &quot;\n&quot;, \</span>
<a name="l00269"></a>00269 <span class="preprocessor">                 iseq_compile_each(iseq, (anchor), (node), (poped))))</span>
<a name="l00270"></a>00270 <span class="preprocessor"></span>
<a name="l00271"></a><a class="code" href="../../d2/d47/compile_8c.html#accd7d8e5aae40bb4eecd61fb8d6c65cc">00271</a> <span class="preprocessor">#define OPERAND_AT(insn, idx) \</span>
<a name="l00272"></a>00272 <span class="preprocessor">  (((INSN*)(insn))-&gt;operands[(idx)])</span>
<a name="l00273"></a>00273 <span class="preprocessor"></span>
<a name="l00274"></a><a class="code" href="../../d2/d47/compile_8c.html#ac515317ffa886c9ac546e8f8f86e23cf">00274</a> <span class="preprocessor">#define INSN_OF(insn) \</span>
<a name="l00275"></a>00275 <span class="preprocessor">  (((INSN*)(insn))-&gt;insn_id)</span>
<a name="l00276"></a>00276 <span class="preprocessor"></span>
<a name="l00277"></a>00277 <span class="comment">/* error */</span>
<a name="l00278"></a><a class="code" href="../../d2/d47/compile_8c.html#ae84f2851369429ff178e5d2c6eaae309">00278</a> <span class="preprocessor">#define COMPILE_ERROR(strs)                        \</span>
<a name="l00279"></a>00279 <span class="preprocessor">{                                                  \</span>
<a name="l00280"></a>00280 <span class="preprocessor">  VALUE tmp = GET_THREAD()-&gt;errinfo;               \</span>
<a name="l00281"></a>00281 <span class="preprocessor">  if (compile_debug) rb_compile_bug strs;          \</span>
<a name="l00282"></a>00282 <span class="preprocessor">  GET_THREAD()-&gt;errinfo = iseq-&gt;compile_data-&gt;err_info;  \</span>
<a name="l00283"></a>00283 <span class="preprocessor">  rb_compile_error strs;                           \</span>
<a name="l00284"></a>00284 <span class="preprocessor">  iseq-&gt;compile_data-&gt;err_info = GET_THREAD()-&gt;errinfo; \</span>
<a name="l00285"></a>00285 <span class="preprocessor">  GET_THREAD()-&gt;errinfo = tmp;                     \</span>
<a name="l00286"></a>00286 <span class="preprocessor">  ret = 0;                                         \</span>
<a name="l00287"></a>00287 <span class="preprocessor">  break;                                           \</span>
<a name="l00288"></a>00288 <span class="preprocessor">}</span>
<a name="l00289"></a>00289 <span class="preprocessor"></span>
<a name="l00290"></a><a class="code" href="../../d2/d47/compile_8c.html#af94c9e3c1e8a00be6cb2ab8851055473">00290</a> <span class="preprocessor">#define ERROR_ARGS ruby_sourcefile, nd_line(node),</span>
<a name="l00291"></a>00291 <span class="preprocessor"></span>
<a name="l00292"></a>00292 
<a name="l00293"></a><a class="code" href="../../d2/d47/compile_8c.html#a652dda0d529b866959c19fe27293968e">00293</a> <span class="preprocessor">#define COMPILE_OK 1</span>
<a name="l00294"></a><a class="code" href="../../d2/d47/compile_8c.html#aa724e736e164cb8324479ba5b87e386c">00294</a> <span class="preprocessor"></span><span class="preprocessor">#define COMPILE_NG 0</span>
<a name="l00295"></a>00295 <span class="preprocessor"></span>
<a name="l00296"></a>00296 
<a name="l00297"></a>00297 <span class="comment">/* leave name uninitialized so that compiler warn if INIT_ANCHOR is</span>
<a name="l00298"></a>00298 <span class="comment"> * missing */</span>
<a name="l00299"></a><a class="code" href="../../d2/d47/compile_8c.html#aa9d6014cec8d3adcb228b81620eac795">00299</a> <span class="preprocessor">#define DECL_ANCHOR(name) \</span>
<a name="l00300"></a>00300 <span class="preprocessor">  LINK_ANCHOR *name, name##_body__ = {{0,},}</span>
<a name="l00301"></a><a class="code" href="../../d2/d47/compile_8c.html#ac32b1f7d8de8f10f33a147030d8b7544">00301</a> <span class="preprocessor"></span><span class="preprocessor">#define INIT_ANCHOR(name) \</span>
<a name="l00302"></a>00302 <span class="preprocessor">  (name##_body__.last = &amp;name##_body__.anchor, name = &amp;name##_body__)</span>
<a name="l00303"></a>00303 <span class="preprocessor"></span>
<a name="l00304"></a><a class="code" href="../../d2/d47/compile_8c.html#ade60ac907df6825c414be22c432ba82a">00304</a> <span class="preprocessor">#define hide_obj(obj) do {OBJ_FREEZE(obj); RBASIC(obj)-&gt;klass = 0;} while (0)</span>
<a name="l00305"></a>00305 <span class="preprocessor"></span>
<a name="l00306"></a>00306 <span class="preprocessor">#include &quot;<a class="code" href="../../d8/d2e/optinsn_8inc.html">optinsn.inc</a>&quot;</span>
<a name="l00307"></a>00307 <span class="preprocessor">#if OPT_INSTRUCTIONS_UNIFICATION</span>
<a name="l00308"></a>00308 <span class="preprocessor"></span><span class="preprocessor">#include &quot;<a class="code" href="../../d3/dce/optunifs_8inc.html">optunifs.inc</a>&quot;</span>
<a name="l00309"></a>00309 <span class="preprocessor">#endif</span>
<a name="l00310"></a>00310 <span class="preprocessor"></span>
<a name="l00311"></a>00311 <span class="comment">/* for debug */</span>
<a name="l00312"></a>00312 <span class="preprocessor">#if CPDEBUG &lt; 0</span>
<a name="l00313"></a>00313 <span class="preprocessor"></span><span class="preprocessor">#define ISEQ_ARG iseq,</span>
<a name="l00314"></a>00314 <span class="preprocessor"></span><span class="preprocessor">#define ISEQ_ARG_DECLARE rb_iseq_t *iseq,</span>
<a name="l00315"></a>00315 <span class="preprocessor"></span><span class="preprocessor">#else</span>
<a name="l00316"></a><a class="code" href="../../d2/d47/compile_8c.html#a12c4cb4450c6658fbb55cb329ecc5585">00316</a> <span class="preprocessor"></span><span class="preprocessor">#define ISEQ_ARG</span>
<a name="l00317"></a><a class="code" href="../../d2/d47/compile_8c.html#a3a1b3a7337c866c2a49b896d11423d3e">00317</a> <span class="preprocessor"></span><span class="preprocessor">#define ISEQ_ARG_DECLARE</span>
<a name="l00318"></a>00318 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00319"></a>00319 <span class="preprocessor"></span>
<a name="l00320"></a>00320 <span class="preprocessor">#if CPDEBUG</span>
<a name="l00321"></a>00321 <span class="preprocessor"></span><span class="preprocessor">#define gl_node_level iseq-&gt;compile_data-&gt;node_level</span>
<a name="l00322"></a>00322 <span class="preprocessor"></span><span class="preprocessor">#if 0</span>
<a name="l00323"></a>00323 <span class="preprocessor"></span><span class="keyword">static</span> <span class="keywordtype">void</span> debug_list(<a class="code" href="../../d2/d47/compile_8c.html#a3a1b3a7337c866c2a49b896d11423d3e">ISEQ_ARG_DECLARE</a> <a class="code" href="../../d4/dcd/structiseq__link__anchor.html">LINK_ANCHOR</a> *anchor);
<a name="l00324"></a>00324 <span class="preprocessor">#endif</span>
<a name="l00325"></a>00325 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00326"></a>00326 <span class="preprocessor"></span>
<a name="l00327"></a>00327 <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d2/d47/compile_8c.html#aee9a7dcbd2c223a7790c416972f221c7">dump_disasm_list</a>(<a class="code" href="../../dc/dd8/structiseq__link__element.html">LINK_ELEMENT</a> *elem);
<a name="l00328"></a>00328 
<a name="l00329"></a>00329 <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d2/d47/compile_8c.html#a7023a7b2b11a4a2e586982cd2433a287">insn_data_length</a>(<a class="code" href="../../db/d57/structiseq__insn__data.html">INSN</a> *iobj);
<a name="l00330"></a>00330 <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d2/d47/compile_8c.html#ab4ffd76d837f5780720b66918da794c3">insn_data_line_no</a>(<a class="code" href="../../db/d57/structiseq__insn__data.html">INSN</a> *iobj);
<a name="l00331"></a>00331 <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d2/d47/compile_8c.html#a75f827592179e7c7f0ce0dcff815ee15">calc_sp_depth</a>(<span class="keywordtype">int</span> depth, <a class="code" href="../../db/d57/structiseq__insn__data.html">INSN</a> *iobj);
<a name="l00332"></a>00332 
<a name="l00333"></a>00333 <span class="keyword">static</span> <a class="code" href="../../db/d57/structiseq__insn__data.html">INSN</a> *<a class="code" href="../../d2/d47/compile_8c.html#af32e6981fd21b9b2cb65ed85904c4d5a">new_insn_body</a>(<a class="code" href="../../d6/de3/structrb__iseq__struct.html">rb_iseq_t</a> *iseq, <span class="keywordtype">int</span> line_no, <span class="keywordtype">int</span> insn_id, <span class="keywordtype">int</span> <a class="code" href="../../df/d77/ruby_8c.html#ad1447518f4372828b8435ae82e48499e">argc</a>, ...);
<a name="l00334"></a>00334 <span class="keyword">static</span> <a class="code" href="../../d8/dc5/structiseq__label__data.html">LABEL</a> *<a class="code" href="../../d2/d47/compile_8c.html#a92e2d92bf96dc2e155357940a977ee1e">new_label_body</a>(<a class="code" href="../../d6/de3/structrb__iseq__struct.html">rb_iseq_t</a> *iseq, <span class="keywordtype">long</span> line);
<a name="l00335"></a>00335 <span class="keyword">static</span> <a class="code" href="../../d1/d19/structiseq__adjust__data.html">ADJUST</a> *<a class="code" href="../../d2/d47/compile_8c.html#a0ed97d20f9c399eb0608ce3a19bcbc98">new_adjust_body</a>(<a class="code" href="../../d6/de3/structrb__iseq__struct.html">rb_iseq_t</a> *iseq, <a class="code" href="../../d8/dc5/structiseq__label__data.html">LABEL</a> *label, <span class="keywordtype">int</span> line);
<a name="l00336"></a>00336 
<a name="l00337"></a>00337 <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d2/d47/compile_8c.html#a12770fd96fd1210ca094e06da53a7e9d" title="compile each node">iseq_compile_each</a>(<a class="code" href="../../d6/de3/structrb__iseq__struct.html">rb_iseq_t</a> *iseq, <a class="code" href="../../d4/dcd/structiseq__link__anchor.html">LINK_ANCHOR</a> *anchor, NODE * n, <span class="keywordtype">int</span>);
<a name="l00338"></a>00338 <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d2/d47/compile_8c.html#a0c133043da590dbf81f56e44d28936e1">iseq_setup</a>(<a class="code" href="../../d6/de3/structrb__iseq__struct.html">rb_iseq_t</a> *iseq, <a class="code" href="../../d4/dcd/structiseq__link__anchor.html">LINK_ANCHOR</a> *anchor);
<a name="l00339"></a>00339 <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d2/d47/compile_8c.html#a9ef59376c53c601bd4c014b3ce55183e">iseq_optimize</a>(<a class="code" href="../../d6/de3/structrb__iseq__struct.html">rb_iseq_t</a> *iseq, <a class="code" href="../../d4/dcd/structiseq__link__anchor.html">LINK_ANCHOR</a> *anchor);
<a name="l00340"></a>00340 <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d2/d47/compile_8c.html#aa9102caf54c32a18243dbaef6b86eb03">iseq_insns_unification</a>(<a class="code" href="../../d6/de3/structrb__iseq__struct.html">rb_iseq_t</a> *iseq, <a class="code" href="../../d4/dcd/structiseq__link__anchor.html">LINK_ANCHOR</a> *anchor);
<a name="l00341"></a>00341 
<a name="l00342"></a>00342 <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d2/d47/compile_8c.html#ab1764a6e5bad41b6e9223b512c674cf4">iseq_set_local_table</a>(<a class="code" href="../../d6/de3/structrb__iseq__struct.html">rb_iseq_t</a> *iseq, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#afa5b9137f051ac26d7ccc8824f178233">ID</a> *tbl);
<a name="l00343"></a>00343 <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d2/d47/compile_8c.html#a367d6c603cd41b5c42c6c91b0b81df60">iseq_set_exception_local_table</a>(<a class="code" href="../../d6/de3/structrb__iseq__struct.html">rb_iseq_t</a> *iseq);
<a name="l00344"></a>00344 <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d2/d47/compile_8c.html#a36a5c0b358003b37dd79f06d4fd1c272">iseq_set_arguments</a>(<a class="code" href="../../d6/de3/structrb__iseq__struct.html">rb_iseq_t</a> *iseq, <a class="code" href="../../d4/dcd/structiseq__link__anchor.html">LINK_ANCHOR</a> *anchor, NODE * <a class="code" href="../../d7/dc0/parse_8y.html#a0d7af8a92c4b0a07f71585584ef9634f">node</a>);
<a name="l00345"></a>00345 
<a name="l00346"></a>00346 <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d2/d47/compile_8c.html#a71895fceca840260c60c4c41a44ea530">iseq_set_sequence_stackcaching</a>(<a class="code" href="../../d6/de3/structrb__iseq__struct.html">rb_iseq_t</a> *iseq, <a class="code" href="../../d4/dcd/structiseq__link__anchor.html">LINK_ANCHOR</a> *anchor);
<a name="l00347"></a>00347 <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d2/d47/compile_8c.html#a6b63516ddd96e730781652cc59445164" title="ruby insn object list -&amp;gt; raw instruction sequence">iseq_set_sequence</a>(<a class="code" href="../../d6/de3/structrb__iseq__struct.html">rb_iseq_t</a> *iseq, <a class="code" href="../../d4/dcd/structiseq__link__anchor.html">LINK_ANCHOR</a> *anchor);
<a name="l00348"></a>00348 <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d2/d47/compile_8c.html#ac421ba50c875947db78307a6d6db97ef">iseq_set_exception_table</a>(<a class="code" href="../../d6/de3/structrb__iseq__struct.html">rb_iseq_t</a> *iseq);
<a name="l00349"></a>00349 <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d2/d47/compile_8c.html#a84cb808345c07d2803eb38e348193df5">iseq_set_optargs_table</a>(<a class="code" href="../../d6/de3/structrb__iseq__struct.html">rb_iseq_t</a> *iseq);
<a name="l00350"></a>00350 
<a name="l00351"></a>00351 <span class="comment">/*</span>
<a name="l00352"></a>00352 <span class="comment"> * To make Array to LinkedList, use link_anchor</span>
<a name="l00353"></a>00353 <span class="comment"> */</span>
<a name="l00354"></a>00354 
<a name="l00355"></a>00355 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00356"></a><a class="code" href="../../d2/d47/compile_8c.html#a729411c47b67655aa1b56fd37fad90ae">00356</a> <a class="code" href="../../d2/d47/compile_8c.html#a729411c47b67655aa1b56fd37fad90ae">verify_list</a>(<a class="code" href="../../d2/d47/compile_8c.html#a3a1b3a7337c866c2a49b896d11423d3e">ISEQ_ARG_DECLARE</a> <span class="keyword">const</span> <span class="keywordtype">char</span> *info, <a class="code" href="../../d4/dcd/structiseq__link__anchor.html">LINK_ANCHOR</a> *anchor)
<a name="l00357"></a>00357 {
<a name="l00358"></a>00358 <span class="preprocessor">#if CPDEBUG</span>
<a name="l00359"></a>00359 <span class="preprocessor"></span>    <span class="keywordtype">int</span> flag = 0;
<a name="l00360"></a>00360     <a class="code" href="../../dc/dd8/structiseq__link__element.html">LINK_ELEMENT</a> *<a class="code" href="../../d5/db5/encoding_8c.html#a05f70dacbe595d27364e1e014efb0c8e">list</a>, *plist;
<a name="l00361"></a>00361 
<a name="l00362"></a>00362     <span class="keywordflow">if</span> (!<a class="code" href="../../d2/d47/compile_8c.html#a0c123c89fd53eedc6774ffc0b00f16dd">compile_debug</a>) <span class="keywordflow">return</span>;
<a name="l00363"></a>00363 
<a name="l00364"></a>00364     list = anchor-&gt;<a class="code" href="../../d4/dcd/structiseq__link__anchor.html#a38f0d32636c5b0b20f8b82816530f20c">anchor</a>.<a class="code" href="../../dc/dd8/structiseq__link__element.html#aaae92b0ba47e61c8c36eba5dac082957">next</a>;
<a name="l00365"></a>00365     plist = &amp;anchor-&gt;<a class="code" href="../../d4/dcd/structiseq__link__anchor.html#a38f0d32636c5b0b20f8b82816530f20c">anchor</a>;
<a name="l00366"></a>00366     <span class="keywordflow">while</span> (list) {
<a name="l00367"></a>00367         <span class="keywordflow">if</span> (plist != list-&gt;<a class="code" href="../../dc/dd8/structiseq__link__element.html#a9b8195e4fd0634def4fb75be28bef536">prev</a>) {
<a name="l00368"></a>00368             flag += 1;
<a name="l00369"></a>00369         }
<a name="l00370"></a>00370         plist = list;
<a name="l00371"></a>00371         list = list-&gt;<a class="code" href="../../dc/dd8/structiseq__link__element.html#aaae92b0ba47e61c8c36eba5dac082957">next</a>;
<a name="l00372"></a>00372     }
<a name="l00373"></a>00373 
<a name="l00374"></a>00374     <span class="keywordflow">if</span> (anchor-&gt;<a class="code" href="../../d4/dcd/structiseq__link__anchor.html#a51b3384a1d06e26fdf1214c219f19927">last</a> != plist &amp;&amp; anchor-&gt;<a class="code" href="../../d4/dcd/structiseq__link__anchor.html#a51b3384a1d06e26fdf1214c219f19927">last</a> != 0) {
<a name="l00375"></a>00375         flag |= 0x70000;
<a name="l00376"></a>00376     }
<a name="l00377"></a>00377 
<a name="l00378"></a>00378     <span class="keywordflow">if</span> (flag != 0) {
<a name="l00379"></a>00379         <a class="code" href="../../db/dcc/error_8c.html#a2d5fb28e54f792e7341b2c45f52f3860">rb_bug</a>(<span class="stringliteral">&quot;list verify error: %08x (%s)&quot;</span>, flag, info);
<a name="l00380"></a>00380     }
<a name="l00381"></a>00381 <span class="preprocessor">#endif</span>
<a name="l00382"></a>00382 <span class="preprocessor"></span>}
<a name="l00383"></a>00383 <span class="preprocessor">#if CPDEBUG &lt; 0</span>
<a name="l00384"></a>00384 <span class="preprocessor"></span><span class="preprocessor">#define verify_list(info, anchor) verify_list(iseq, (info), (anchor))</span>
<a name="l00385"></a>00385 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00386"></a>00386 <span class="preprocessor"></span>
<a name="l00387"></a>00387 <span class="comment">/*</span>
<a name="l00388"></a>00388 <span class="comment"> * elem1, elem2 =&gt; elem1, elem2, elem</span>
<a name="l00389"></a>00389 <span class="comment"> */</span>
<a name="l00390"></a>00390 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00391"></a><a class="code" href="../../d2/d47/compile_8c.html#a46920e7a34d0b9584a59215104163d11">00391</a> <a class="code" href="../../d2/d47/compile_8c.html#a46920e7a34d0b9584a59215104163d11">ADD_ELEM</a>(<a class="code" href="../../d2/d47/compile_8c.html#a3a1b3a7337c866c2a49b896d11423d3e">ISEQ_ARG_DECLARE</a> <a class="code" href="../../d4/dcd/structiseq__link__anchor.html">LINK_ANCHOR</a> *anchor, <a class="code" href="../../dc/dd8/structiseq__link__element.html">LINK_ELEMENT</a> *elem)
<a name="l00392"></a>00392 {
<a name="l00393"></a>00393     elem-&gt;<a class="code" href="../../dc/dd8/structiseq__link__element.html#a9b8195e4fd0634def4fb75be28bef536">prev</a> = anchor-&gt;last;
<a name="l00394"></a>00394     anchor-&gt;last-&gt;<a class="code" href="../../dc/dd8/structiseq__link__element.html#aaae92b0ba47e61c8c36eba5dac082957">next</a> = elem;
<a name="l00395"></a>00395     anchor-&gt;last = elem;
<a name="l00396"></a>00396     <a class="code" href="../../d2/d47/compile_8c.html#a729411c47b67655aa1b56fd37fad90ae">verify_list</a>(<span class="stringliteral">&quot;add&quot;</span>, anchor);
<a name="l00397"></a>00397 }
<a name="l00398"></a>00398 
<a name="l00399"></a>00399 <span class="comment">/*</span>
<a name="l00400"></a>00400 <span class="comment"> * elem1, before, elem2 =&gt; elem1, before, elem, elem2</span>
<a name="l00401"></a>00401 <span class="comment"> */</span>
<a name="l00402"></a>00402 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00403"></a><a class="code" href="../../d2/d47/compile_8c.html#ad5a34d79dc0d546c479a62bb4e2853d9">00403</a> <a class="code" href="../../d2/d47/compile_8c.html#ad5a34d79dc0d546c479a62bb4e2853d9">APPEND_ELEM</a>(<a class="code" href="../../d2/d47/compile_8c.html#a3a1b3a7337c866c2a49b896d11423d3e">ISEQ_ARG_DECLARE</a> <a class="code" href="../../d4/dcd/structiseq__link__anchor.html">LINK_ANCHOR</a> *anchor, <a class="code" href="../../dc/dd8/structiseq__link__element.html">LINK_ELEMENT</a> *before, <a class="code" href="../../dc/dd8/structiseq__link__element.html">LINK_ELEMENT</a> *elem)
<a name="l00404"></a>00404 {
<a name="l00405"></a>00405     elem-&gt;<a class="code" href="../../dc/dd8/structiseq__link__element.html#a9b8195e4fd0634def4fb75be28bef536">prev</a> = before;
<a name="l00406"></a>00406     elem-&gt;<a class="code" href="../../dc/dd8/structiseq__link__element.html#aaae92b0ba47e61c8c36eba5dac082957">next</a> = before-&gt;<a class="code" href="../../dc/dd8/structiseq__link__element.html#aaae92b0ba47e61c8c36eba5dac082957">next</a>;
<a name="l00407"></a>00407     elem-&gt;<a class="code" href="../../dc/dd8/structiseq__link__element.html#aaae92b0ba47e61c8c36eba5dac082957">next</a>-&gt;<a class="code" href="../../dc/dd8/structiseq__link__element.html#a9b8195e4fd0634def4fb75be28bef536">prev</a> = elem;
<a name="l00408"></a>00408     before-&gt;<a class="code" href="../../dc/dd8/structiseq__link__element.html#aaae92b0ba47e61c8c36eba5dac082957">next</a> = elem;
<a name="l00409"></a>00409     <span class="keywordflow">if</span> (before == anchor-&gt;last) anchor-&gt;last = elem;
<a name="l00410"></a>00410     <a class="code" href="../../d2/d47/compile_8c.html#a729411c47b67655aa1b56fd37fad90ae">verify_list</a>(<span class="stringliteral">&quot;add&quot;</span>, anchor);
<a name="l00411"></a>00411 }
<a name="l00412"></a>00412 <span class="preprocessor">#if CPDEBUG &lt; 0</span>
<a name="l00413"></a>00413 <span class="preprocessor"></span><span class="preprocessor">#define ADD_ELEM(anchor, elem) ADD_ELEM(iseq, (anchor), (elem))</span>
<a name="l00414"></a>00414 <span class="preprocessor"></span><span class="preprocessor">#define APPEND_ELEM(anchor, before, elem) ADD_ELEM(iseq, (anchor), (before), (elem))</span>
<a name="l00415"></a>00415 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00416"></a>00416 <span class="preprocessor"></span>
<a name="l00417"></a>00417 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l00418"></a><a class="code" href="../../d2/d47/compile_8c.html#aad5c64f89a1b6d0b28c93478609a1734">00418</a> <a class="code" href="../../d2/d47/compile_8c.html#aad5c64f89a1b6d0b28c93478609a1734">iseq_add_mark_object</a>(<a class="code" href="../../d6/de3/structrb__iseq__struct.html">rb_iseq_t</a> *iseq, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> v)
<a name="l00419"></a>00419 {
<a name="l00420"></a>00420     <span class="keywordflow">if</span> (!<a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac59489a7ed093e29019047d13e79c009">SPECIAL_CONST_P</a>(v)) {
<a name="l00421"></a>00421         <a class="code" href="../../dc/dcc/array_8c.html#a59d553a8cd781364b8bcb0deae25cca2">rb_ary_push</a>(iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a6da853dddaa2899bf03c6d343f025ea9">mark_ary</a>, v);
<a name="l00422"></a>00422     }
<a name="l00423"></a>00423     <span class="keywordflow">return</span> <a class="code" href="../../d2/d47/compile_8c.html#a652dda0d529b866959c19fe27293968e">COMPILE_OK</a>;
<a name="l00424"></a>00424 }
<a name="l00425"></a>00425 
<a name="l00426"></a><a class="code" href="../../d2/d47/compile_8c.html#aca52b28c4504720708a4fab8675dc407">00426</a> <span class="preprocessor">#define ruby_sourcefile         RSTRING_PTR(iseq-&gt;filename)</span>
<a name="l00427"></a>00427 <span class="preprocessor"></span>
<a name="l00428"></a>00428 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l00429"></a><a class="code" href="../../d2/d47/compile_8c.html#ad09bab1521a935e4affe9c1faf9a27c5">00429</a> <a class="code" href="../../d2/d47/compile_8c.html#ad09bab1521a935e4affe9c1faf9a27c5">iseq_add_mark_object_compile_time</a>(<a class="code" href="../../d6/de3/structrb__iseq__struct.html">rb_iseq_t</a> *iseq, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> v)
<a name="l00430"></a>00430 {
<a name="l00431"></a>00431     <span class="keywordflow">if</span> (!<a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac59489a7ed093e29019047d13e79c009">SPECIAL_CONST_P</a>(v)) {
<a name="l00432"></a>00432         <a class="code" href="../../dc/dcc/array_8c.html#a59d553a8cd781364b8bcb0deae25cca2">rb_ary_push</a>(iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a947d34698fb5a71f4938532fff27a0f7">compile_data</a>-&gt;<a class="code" href="../../d4/dd8/structiseq__compile__data.html#a6d5c1690d0b5bb9a673b9de8f06bea33">mark_ary</a>, v);
<a name="l00433"></a>00433     }
<a name="l00434"></a>00434     <span class="keywordflow">return</span> <a class="code" href="../../d2/d47/compile_8c.html#a652dda0d529b866959c19fe27293968e">COMPILE_OK</a>;
<a name="l00435"></a>00435 }
<a name="l00436"></a>00436 
<a name="l00437"></a>00437 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l00438"></a><a class="code" href="../../d2/d47/compile_8c.html#a9fb1c0472b0a8fdd61bb60233faccd7a">00438</a> <a class="code" href="../../d2/d47/compile_8c.html#a9fb1c0472b0a8fdd61bb60233faccd7a">validate_label</a>(<a class="code" href="../../de/dce/syck_8h.html#a8a45dfe133c1fd041e1b902bda9e43e8">st_data_t</a> <a class="code" href="../../d6/da0/nkf-utf8_2nkf_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <a class="code" href="../../de/dce/syck_8h.html#a8a45dfe133c1fd041e1b902bda9e43e8">st_data_t</a> label, <a class="code" href="../../de/dce/syck_8h.html#a8a45dfe133c1fd041e1b902bda9e43e8">st_data_t</a> arg)
<a name="l00439"></a>00439 {
<a name="l00440"></a>00440     <a class="code" href="../../d6/de3/structrb__iseq__struct.html">rb_iseq_t</a> *iseq = (<a class="code" href="../../d6/de3/structrb__iseq__struct.html">rb_iseq_t</a> *)arg;
<a name="l00441"></a>00441     <a class="code" href="../../d8/dc5/structiseq__label__data.html">LABEL</a> *lobj = (<a class="code" href="../../d8/dc5/structiseq__label__data.html">LABEL</a> *)label;
<a name="l00442"></a>00442     <span class="keywordflow">if</span> (!lobj-&gt;<a class="code" href="../../d8/dc5/structiseq__label__data.html#abf04ba28589819eff2e67e3884a040f0">link</a>.<a class="code" href="../../dc/dd8/structiseq__link__element.html#aaae92b0ba47e61c8c36eba5dac082957">next</a>) {
<a name="l00443"></a>00443         <span class="keywordflow">do</span> {
<a name="l00444"></a>00444             <span class="keywordtype">int</span> ret;
<a name="l00445"></a>00445             <a class="code" href="../../d2/d47/compile_8c.html#ae84f2851369429ff178e5d2c6eaae309">COMPILE_ERROR</a>((<a class="code" href="../../d2/d47/compile_8c.html#aca52b28c4504720708a4fab8675dc407">ruby_sourcefile</a>, lobj-&gt;<a class="code" href="../../d8/dc5/structiseq__label__data.html#abc4000df6eb58ca5faf57f9ee446b116">position</a>,
<a name="l00446"></a>00446                            <span class="stringliteral">&quot;%s: undefined label&quot;</span>, <a class="code" href="../../d5/d11/ripper_8c.html#a877bc58c495643fcf49dc64c44631e72">rb_id2name</a>((<a class="code" href="../../de/de6/ruby_2ruby_8h.html#afa5b9137f051ac26d7ccc8824f178233">ID</a>)name)));
<a name="l00447"></a>00447         } <span class="keywordflow">while</span> (0);
<a name="l00448"></a>00448     }
<a name="l00449"></a>00449     <span class="keywordflow">return</span> <a class="code" href="../../dd/d24/st_8h.html#a0c6a172fd99de7928916e65034ed8b1fac99fc55c7f355bf9071739a4bc2ea139">ST_CONTINUE</a>;
<a name="l00450"></a>00450 }
<a name="l00451"></a>00451 
<a name="l00452"></a>00452 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00453"></a><a class="code" href="../../d2/d47/compile_8c.html#ab083c72a68599ad0ab6eb5ab054a8f92">00453</a> <a class="code" href="../../d2/d47/compile_8c.html#ab083c72a68599ad0ab6eb5ab054a8f92">validate_labels</a>(<a class="code" href="../../d6/de3/structrb__iseq__struct.html">rb_iseq_t</a> *iseq, <a class="code" href="../../d0/ddd/structst__table.html">st_table</a> *labels_table)
<a name="l00454"></a>00454 {
<a name="l00455"></a>00455     <a class="code" href="../../dd/d24/st_8h.html#ace5a79870d2800659a653fceeca55262">st_foreach</a>(labels_table, <a class="code" href="../../d2/d47/compile_8c.html#a9fb1c0472b0a8fdd61bb60233faccd7a">validate_label</a>, (<a class="code" href="../../de/dce/syck_8h.html#a8a45dfe133c1fd041e1b902bda9e43e8">st_data_t</a>)iseq);
<a name="l00456"></a>00456     <span class="keywordflow">if</span> (!<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a4832bad8845a35fc50f7a160901854a1">NIL_P</a>(iseq-&gt;compile_data-&gt;err_info)) {
<a name="l00457"></a>00457         <a class="code" href="../../d3/d57/eval_8c.html#a237939d28c83950b84fb6a45ccca53a0">rb_exc_raise</a>(iseq-&gt;compile_data-&gt;err_info);
<a name="l00458"></a>00458     }
<a name="l00459"></a>00459 }
<a name="l00460"></a>00460 
<a name="l00461"></a>00461 <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l00462"></a><a class="code" href="../../d7/dc8/iseq_8h.html#ae3803cca8b6973f69bedafecd0101373">00462</a> <a class="code" href="../../d2/d47/compile_8c.html#ae3803cca8b6973f69bedafecd0101373">rb_iseq_compile_node</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <span class="keyword">self</span>, NODE *<a class="code" href="../../d7/dc0/parse_8y.html#a0d7af8a92c4b0a07f71585584ef9634f">node</a>)
<a name="l00463"></a>00463 {
<a name="l00464"></a>00464     <a class="code" href="../../d2/d47/compile_8c.html#aa9d6014cec8d3adcb228b81620eac795">DECL_ANCHOR</a>(ret);
<a name="l00465"></a>00465     <a class="code" href="../../d6/de3/structrb__iseq__struct.html">rb_iseq_t</a> *iseq;
<a name="l00466"></a>00466     <a class="code" href="../../d2/d47/compile_8c.html#ac32b1f7d8de8f10f33a147030d8b7544">INIT_ANCHOR</a>(ret);
<a name="l00467"></a>00467     <a class="code" href="../../d8/d32/vm__core_8h.html#a5e6a3515e0ad9b9d6a4c0ab577dc50b6">GetISeqPtr</a>(<span class="keyword">self</span>, iseq);
<a name="l00468"></a>00468 
<a name="l00469"></a>00469     <span class="keywordflow">if</span> (node == 0) {
<a name="l00470"></a>00470         <a class="code" href="../../d2/d47/compile_8c.html#a0cacd6cfca69df35e1535d2f21532c47">COMPILE</a>(ret, <span class="stringliteral">&quot;nil&quot;</span>, node);
<a name="l00471"></a>00471         <a class="code" href="../../d2/d47/compile_8c.html#ab1764a6e5bad41b6e9223b512c674cf4">iseq_set_local_table</a>(iseq, 0);
<a name="l00472"></a>00472     }
<a name="l00473"></a>00473     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d3/d09/ripper_8y.html#ade12c589b26f55f089dc25d689249c11">nd_type</a>(node) == <a class="code" href="../../d3/d09/ripper_8y.html#ac6983f7134e356786ebe01ddea8985cd">NODE_SCOPE</a>) {
<a name="l00474"></a>00474         <span class="comment">/* iseq type of top, method, class, block */</span>
<a name="l00475"></a>00475         <a class="code" href="../../d2/d47/compile_8c.html#ab1764a6e5bad41b6e9223b512c674cf4">iseq_set_local_table</a>(iseq, node-&gt;nd_tbl);
<a name="l00476"></a>00476         <a class="code" href="../../d2/d47/compile_8c.html#a36a5c0b358003b37dd79f06d4fd1c272">iseq_set_arguments</a>(iseq, ret, node-&gt;nd_args);
<a name="l00477"></a>00477 
<a name="l00478"></a>00478         <span class="keywordflow">switch</span> (iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#af8bc7dbae6f61d836b5bb9fb50b6cfb8">type</a>) {
<a name="l00479"></a>00479           <span class="keywordflow">case</span> ISEQ_TYPE_BLOCK: {
<a name="l00480"></a>00480             <a class="code" href="../../d8/dc5/structiseq__label__data.html">LABEL</a> *start = iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a947d34698fb5a71f4938532fff27a0f7">compile_data</a>-&gt;<a class="code" href="../../d4/dd8/structiseq__compile__data.html#a055ae44f47869f10dda6b21a2433fa1e">start_label</a> = <a class="code" href="../../d2/d47/compile_8c.html#a1d6d5d8dac7aff9ac863255a0905c0f9">NEW_LABEL</a>(0);
<a name="l00481"></a>00481             <a class="code" href="../../d8/dc5/structiseq__label__data.html">LABEL</a> *<a class="code" href="../../da/d32/structensure__range.html#aa15081d5666a57e4df5a74bbad8cda12">end</a> = iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a947d34698fb5a71f4938532fff27a0f7">compile_data</a>-&gt;<a class="code" href="../../d4/dd8/structiseq__compile__data.html#ab37fd8ba916a4fd8c59e9eec084107ad">end_label</a> = <a class="code" href="../../d2/d47/compile_8c.html#a1d6d5d8dac7aff9ac863255a0905c0f9">NEW_LABEL</a>(0);
<a name="l00482"></a>00482 
<a name="l00483"></a>00483             <a class="code" href="../../d2/d47/compile_8c.html#a5a380bb449656575d6b77ccb8eb7e5ae">ADD_LABEL</a>(ret, start);
<a name="l00484"></a>00484             <a class="code" href="../../d2/d47/compile_8c.html#a0cacd6cfca69df35e1535d2f21532c47">COMPILE</a>(ret, <span class="stringliteral">&quot;block body&quot;</span>, node-&gt;nd_body);
<a name="l00485"></a>00485             <a class="code" href="../../d2/d47/compile_8c.html#a5a380bb449656575d6b77ccb8eb7e5ae">ADD_LABEL</a>(ret, end);
<a name="l00486"></a>00486 
<a name="l00487"></a>00487             <span class="comment">/* wide range catch handler must put at last */</span>
<a name="l00488"></a>00488             <a class="code" href="../../d2/d47/compile_8c.html#a668f1779f1e5158e6ad8d4b6d92638db">ADD_CATCH_ENTRY</a>(CATCH_TYPE_REDO, start, end, 0, start);
<a name="l00489"></a>00489             <a class="code" href="../../d2/d47/compile_8c.html#a668f1779f1e5158e6ad8d4b6d92638db">ADD_CATCH_ENTRY</a>(CATCH_TYPE_NEXT, start, end, 0, end);
<a name="l00490"></a>00490             <span class="keywordflow">break</span>;
<a name="l00491"></a>00491           }
<a name="l00492"></a>00492           <span class="keywordflow">case</span> ISEQ_TYPE_CLASS: {
<a name="l00493"></a>00493             <a class="code" href="../../d2/d47/compile_8c.html#a1da9ded6df71178c67dd7252e3c64ea1">ADD_TRACE</a>(ret, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a9444c431b3cb1184e7523fc572f2c758">FIX2INT</a>(iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a9000b0748482a5d58f449b11924db4ac">line_no</a>), <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a8436bbde7ec217512e90cdb2d3a8352b">RUBY_EVENT_CLASS</a>);
<a name="l00494"></a>00494             <a class="code" href="../../d2/d47/compile_8c.html#a0cacd6cfca69df35e1535d2f21532c47">COMPILE</a>(ret, <span class="stringliteral">&quot;scoped node&quot;</span>, node-&gt;nd_body);
<a name="l00495"></a>00495             <a class="code" href="../../d2/d47/compile_8c.html#a1da9ded6df71178c67dd7252e3c64ea1">ADD_TRACE</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a008ad47ad1b6add87c9dc674e976380c">RUBY_EVENT_END</a>);
<a name="l00496"></a>00496             <span class="keywordflow">break</span>;
<a name="l00497"></a>00497           }
<a name="l00498"></a>00498           <span class="keywordflow">case</span> ISEQ_TYPE_METHOD: {
<a name="l00499"></a>00499             <a class="code" href="../../d2/d47/compile_8c.html#a1da9ded6df71178c67dd7252e3c64ea1">ADD_TRACE</a>(ret, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a9444c431b3cb1184e7523fc572f2c758">FIX2INT</a>(iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a9000b0748482a5d58f449b11924db4ac">line_no</a>), <a class="code" href="../../de/de6/ruby_2ruby_8h.html#adfe16100a553b5d5cd60c5a9d2e7c0de">RUBY_EVENT_CALL</a>);
<a name="l00500"></a>00500             <a class="code" href="../../d2/d47/compile_8c.html#a0cacd6cfca69df35e1535d2f21532c47">COMPILE</a>(ret, <span class="stringliteral">&quot;scoped node&quot;</span>, node-&gt;nd_body);
<a name="l00501"></a>00501             <a class="code" href="../../d2/d47/compile_8c.html#a1da9ded6df71178c67dd7252e3c64ea1">ADD_TRACE</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aa6ebd81993faad84c09b5080e1fde73d">RUBY_EVENT_RETURN</a>);
<a name="l00502"></a>00502             <span class="keywordflow">break</span>;
<a name="l00503"></a>00503           }
<a name="l00504"></a>00504           <span class="keywordflow">default</span>: {
<a name="l00505"></a>00505             <a class="code" href="../../d2/d47/compile_8c.html#a0cacd6cfca69df35e1535d2f21532c47">COMPILE</a>(ret, <span class="stringliteral">&quot;scoped node&quot;</span>, node-&gt;nd_body);
<a name="l00506"></a>00506             <span class="keywordflow">break</span>;
<a name="l00507"></a>00507           }
<a name="l00508"></a>00508         }
<a name="l00509"></a>00509     }
<a name="l00510"></a>00510     <span class="keywordflow">else</span> {
<a name="l00511"></a>00511         <span class="keywordflow">switch</span> (iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#af8bc7dbae6f61d836b5bb9fb50b6cfb8">type</a>) {
<a name="l00512"></a>00512           <span class="keywordflow">case</span> ISEQ_TYPE_METHOD:
<a name="l00513"></a>00513           <span class="keywordflow">case</span> ISEQ_TYPE_CLASS:
<a name="l00514"></a>00514           <span class="keywordflow">case</span> ISEQ_TYPE_BLOCK:
<a name="l00515"></a>00515           <span class="keywordflow">case</span> ISEQ_TYPE_EVAL:
<a name="l00516"></a>00516           <span class="keywordflow">case</span> ISEQ_TYPE_MAIN:
<a name="l00517"></a>00517           <span class="keywordflow">case</span> ISEQ_TYPE_TOP:
<a name="l00518"></a>00518             <a class="code" href="../../d5/d11/ripper_8c.html#ac8a9e12698ddd356976669c6116abef1">rb_compile_error</a>(<a class="code" href="../../d2/d47/compile_8c.html#af94c9e3c1e8a00be6cb2ab8851055473">ERROR_ARGS</a> <span class="stringliteral">&quot;compile/should not be reached: %s:%d&quot;</span>,
<a name="l00519"></a>00519                              __FILE__, __LINE__);
<a name="l00520"></a>00520             <span class="keywordflow">break</span>;
<a name="l00521"></a>00521           <span class="keywordflow">case</span> ISEQ_TYPE_RESCUE:
<a name="l00522"></a>00522             <a class="code" href="../../d2/d47/compile_8c.html#a367d6c603cd41b5c42c6c91b0b81df60">iseq_set_exception_local_table</a>(iseq);
<a name="l00523"></a>00523             <a class="code" href="../../d2/d47/compile_8c.html#a0cacd6cfca69df35e1535d2f21532c47">COMPILE</a>(ret, <span class="stringliteral">&quot;rescue&quot;</span>, node);
<a name="l00524"></a>00524             <span class="keywordflow">break</span>;
<a name="l00525"></a>00525           <span class="keywordflow">case</span> ISEQ_TYPE_ENSURE:
<a name="l00526"></a>00526             <a class="code" href="../../d2/d47/compile_8c.html#a367d6c603cd41b5c42c6c91b0b81df60">iseq_set_exception_local_table</a>(iseq);
<a name="l00527"></a>00527             <a class="code" href="../../d2/d47/compile_8c.html#a4e7115fce9f91ee84931798cc3474229">COMPILE_POPED</a>(ret, <span class="stringliteral">&quot;ensure&quot;</span>, node);
<a name="l00528"></a>00528             <span class="keywordflow">break</span>;
<a name="l00529"></a>00529           <span class="keywordflow">case</span> ISEQ_TYPE_DEFINED_GUARD:
<a name="l00530"></a>00530             <a class="code" href="../../d2/d47/compile_8c.html#ab1764a6e5bad41b6e9223b512c674cf4">iseq_set_local_table</a>(iseq, 0);
<a name="l00531"></a>00531             <a class="code" href="../../d2/d47/compile_8c.html#a0cacd6cfca69df35e1535d2f21532c47">COMPILE</a>(ret, <span class="stringliteral">&quot;defined guard&quot;</span>, node);
<a name="l00532"></a>00532             <span class="keywordflow">break</span>;
<a name="l00533"></a>00533           <span class="keywordflow">default</span>:
<a name="l00534"></a>00534             <a class="code" href="../../db/dcc/error_8c.html#a2d5fb28e54f792e7341b2c45f52f3860">rb_bug</a>(<span class="stringliteral">&quot;unknown scope&quot;</span>);
<a name="l00535"></a>00535         }
<a name="l00536"></a>00536     }
<a name="l00537"></a>00537 
<a name="l00538"></a>00538     <span class="keywordflow">if</span> (iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#af8bc7dbae6f61d836b5bb9fb50b6cfb8">type</a> == ISEQ_TYPE_RESCUE || iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#af8bc7dbae6f61d836b5bb9fb50b6cfb8">type</a> == ISEQ_TYPE_ENSURE) {
<a name="l00539"></a>00539         <a class="code" href="../../d2/d47/compile_8c.html#a9e17ccfd8b31ec3afcb91be39a6d453f">ADD_INSN2</a>(ret, 0, getdynamic, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(2), <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(0));
<a name="l00540"></a>00540         <a class="code" href="../../d2/d47/compile_8c.html#a3cfeb7549a1249a8b78f9d6ff1e74c5a">ADD_INSN1</a>(ret, 0, <span class="keywordflow">throw</span>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(0) <span class="comment">/* continue throw */</span> );
<a name="l00541"></a>00541     }
<a name="l00542"></a>00542     <span class="keywordflow">else</span> {
<a name="l00543"></a>00543         <a class="code" href="../../d2/d47/compile_8c.html#aa5b45ae61de3350f0830a32589bbb7ee">ADD_INSN</a>(ret, iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a947d34698fb5a71f4938532fff27a0f7">compile_data</a>-&gt;<a class="code" href="../../d4/dd8/structiseq__compile__data.html#a4047d9fbac6d3e6c2afa279f6bb83d5a">last_line</a>, leave);
<a name="l00544"></a>00544     }
<a name="l00545"></a>00545 
<a name="l00546"></a>00546 <span class="preprocessor">#if SUPPORT_JOKE</span>
<a name="l00547"></a>00547 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a947d34698fb5a71f4938532fff27a0f7">compile_data</a>-&gt;labels_table) {
<a name="l00548"></a>00548         <a class="code" href="../../d2/d47/compile_8c.html#ab083c72a68599ad0ab6eb5ab054a8f92">validate_labels</a>(iseq, iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a947d34698fb5a71f4938532fff27a0f7">compile_data</a>-&gt;labels_table);
<a name="l00549"></a>00549     }
<a name="l00550"></a>00550 <span class="preprocessor">#endif</span>
<a name="l00551"></a>00551 <span class="preprocessor"></span>    <span class="keywordflow">return</span> <a class="code" href="../../d2/d47/compile_8c.html#a0c133043da590dbf81f56e44d28936e1">iseq_setup</a>(iseq, ret);
<a name="l00552"></a>00552 }
<a name="l00553"></a>00553 
<a name="l00554"></a>00554 <span class="keywordtype">int</span>
<a name="l00555"></a><a class="code" href="../../d7/dc8/iseq_8h.html#aed84612e988053b408318de9c0a889ca">00555</a> <a class="code" href="../../d2/d47/compile_8c.html#aed84612e988053b408318de9c0a889ca">rb_iseq_translate_threaded_code</a>(<a class="code" href="../../d6/de3/structrb__iseq__struct.html">rb_iseq_t</a> *iseq)
<a name="l00556"></a>00556 {
<a name="l00557"></a>00557 <span class="preprocessor">#if OPT_DIRECT_THREADED_CODE || OPT_CALL_THREADED_CODE</span>
<a name="l00558"></a>00558 <span class="preprocessor"></span>    <span class="keyword">const</span> <span class="keywordtype">void</span> * <span class="keyword">const</span> *table = <a class="code" href="../../df/d38/vm__exec_8c.html#a0f58965aa859cf690996c8f069e4449b">rb_vm_get_insns_address_table</a>();
<a name="l00559"></a>00559     <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> i;
<a name="l00560"></a>00560 
<a name="l00561"></a>00561     iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#aa70f3e195a4350acbbc130f8a95c9958">iseq_encoded</a> = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a79041aa2bc7439c11906a86f82a52eb6">ALLOC_N</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>, iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a6fd527787fc64d5e9d11478af447a85f">iseq_size</a>);
<a name="l00562"></a>00562     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a04ab67335215e8362c63ed27ae2d1c40">MEMCPY</a>(iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#aa70f3e195a4350acbbc130f8a95c9958">iseq_encoded</a>, iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a8699ab44e2c44e7f8df87e26a9c7bee8">iseq</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>, iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a6fd527787fc64d5e9d11478af447a85f">iseq_size</a>);
<a name="l00563"></a>00563 
<a name="l00564"></a>00564     <span class="keywordflow">for</span> (i = 0; i &lt; iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a6fd527787fc64d5e9d11478af447a85f">iseq_size</a>; <span class="comment">/* */</span> ) {
<a name="l00565"></a>00565         <span class="keywordtype">int</span> insn = (int)iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#aa70f3e195a4350acbbc130f8a95c9958">iseq_encoded</a>[i];
<a name="l00566"></a>00566         <span class="keywordtype">int</span> <a class="code" href="../../d3/d15/name2ctype_8h.html#aed1cc4dca5d94cb452f79691f54f7423">len</a> = insn_len(insn);
<a name="l00567"></a>00567         iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#aa70f3e195a4350acbbc130f8a95c9958">iseq_encoded</a>[i] = (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>)table[insn];
<a name="l00568"></a>00568         i += <a class="code" href="../../d3/d15/name2ctype_8h.html#aed1cc4dca5d94cb452f79691f54f7423">len</a>;
<a name="l00569"></a>00569     }
<a name="l00570"></a>00570 <span class="preprocessor">#else</span>
<a name="l00571"></a>00571 <span class="preprocessor"></span>    iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#aa70f3e195a4350acbbc130f8a95c9958">iseq_encoded</a> = iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a8699ab44e2c44e7f8df87e26a9c7bee8">iseq</a>;
<a name="l00572"></a>00572 <span class="preprocessor">#endif</span>
<a name="l00573"></a>00573 <span class="preprocessor"></span>    <span class="keywordflow">return</span> <a class="code" href="../../d2/d47/compile_8c.html#a652dda0d529b866959c19fe27293968e">COMPILE_OK</a>;
<a name="l00574"></a>00574 }
<a name="l00575"></a>00575 
<a name="l00576"></a>00576 <span class="comment">/*********************************************/</span>
<a name="l00577"></a>00577 <span class="comment">/* definition of data structure for compiler */</span>
<a name="l00578"></a>00578 <span class="comment">/*********************************************/</span>
<a name="l00579"></a>00579 
<a name="l00580"></a>00580 <span class="keyword">static</span> <span class="keywordtype">void</span> *
<a name="l00581"></a><a class="code" href="../../d2/d47/compile_8c.html#aa24f135ae12437da748202a5329eba3e">00581</a> <a class="code" href="../../d2/d47/compile_8c.html#aa24f135ae12437da748202a5329eba3e">compile_data_alloc</a>(<a class="code" href="../../d6/de3/structrb__iseq__struct.html">rb_iseq_t</a> *iseq, <span class="keywordtype">size_t</span> <a class="code" href="../../d5/db5/encoding_8c.html#a439227feff9d7f55384e8780cfc2eb82">size</a>)
<a name="l00582"></a>00582 {
<a name="l00583"></a>00583     <span class="keywordtype">void</span> *ptr = 0;
<a name="l00584"></a>00584     <span class="keyword">struct </span><a class="code" href="../../dd/d2c/structiseq__compile__data__storage.html">iseq_compile_data_storage</a> *storage =
<a name="l00585"></a>00585         iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a947d34698fb5a71f4938532fff27a0f7">compile_data</a>-&gt;<a class="code" href="../../d4/dd8/structiseq__compile__data.html#a647ed4fb86aeef7cf66c170f5f310207">storage_current</a>;
<a name="l00586"></a>00586 
<a name="l00587"></a>00587     <span class="keywordflow">if</span> (storage-&gt;<a class="code" href="../../dd/d2c/structiseq__compile__data__storage.html#a48be29fc3686e433e82ed8b008446cd1">pos</a> + size &gt; storage-&gt;<a class="code" href="../../dd/d2c/structiseq__compile__data__storage.html#a0f5968751cad944faceb736d17cc567f">size</a>) {
<a name="l00588"></a>00588         <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> alloc_size = storage-&gt;<a class="code" href="../../dd/d2c/structiseq__compile__data__storage.html#a0f5968751cad944faceb736d17cc567f">size</a> * 2;
<a name="l00589"></a>00589 
<a name="l00590"></a>00590       retry:
<a name="l00591"></a>00591         <span class="keywordflow">if</span> (alloc_size &lt; size) {
<a name="l00592"></a>00592             alloc_size *= 2;
<a name="l00593"></a>00593             <span class="keywordflow">goto</span> retry;
<a name="l00594"></a>00594         }
<a name="l00595"></a>00595         storage-&gt;<a class="code" href="../../dd/d2c/structiseq__compile__data__storage.html#a4048cc7355b102802e72e51603ef3d3f">next</a> = (<span class="keywordtype">void</span> *)<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a79041aa2bc7439c11906a86f82a52eb6">ALLOC_N</a>(<span class="keywordtype">char</span>, alloc_size +
<a name="l00596"></a>00596                                         <span class="keyword">sizeof</span>(<span class="keyword">struct</span>
<a name="l00597"></a>00597                                                <a class="code" href="../../dd/d2c/structiseq__compile__data__storage.html">iseq_compile_data_storage</a>));
<a name="l00598"></a>00598         storage = iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a947d34698fb5a71f4938532fff27a0f7">compile_data</a>-&gt;<a class="code" href="../../d4/dd8/structiseq__compile__data.html#a647ed4fb86aeef7cf66c170f5f310207">storage_current</a> = storage-&gt;<a class="code" href="../../dd/d2c/structiseq__compile__data__storage.html#a4048cc7355b102802e72e51603ef3d3f">next</a>;
<a name="l00599"></a>00599         storage-&gt;<a class="code" href="../../dd/d2c/structiseq__compile__data__storage.html#a4048cc7355b102802e72e51603ef3d3f">next</a> = 0;
<a name="l00600"></a>00600         storage-&gt;<a class="code" href="../../dd/d2c/structiseq__compile__data__storage.html#a48be29fc3686e433e82ed8b008446cd1">pos</a> = 0;
<a name="l00601"></a>00601         storage-&gt;<a class="code" href="../../dd/d2c/structiseq__compile__data__storage.html#a0f5968751cad944faceb736d17cc567f">size</a> = alloc_size;
<a name="l00602"></a>00602         storage-&gt;<a class="code" href="../../dd/d2c/structiseq__compile__data__storage.html#abae26128d61ad5bdcb01ddacfadb372f">buff</a> = (<span class="keywordtype">char</span> *)(&amp;storage-&gt;<a class="code" href="../../dd/d2c/structiseq__compile__data__storage.html#abae26128d61ad5bdcb01ddacfadb372f">buff</a> + 1);
<a name="l00603"></a>00603     }
<a name="l00604"></a>00604 
<a name="l00605"></a>00605     ptr = (<span class="keywordtype">void</span> *)&amp;storage-&gt;<a class="code" href="../../dd/d2c/structiseq__compile__data__storage.html#abae26128d61ad5bdcb01ddacfadb372f">buff</a>[storage-&gt;<a class="code" href="../../dd/d2c/structiseq__compile__data__storage.html#a48be29fc3686e433e82ed8b008446cd1">pos</a>];
<a name="l00606"></a>00606     storage-&gt;<a class="code" href="../../dd/d2c/structiseq__compile__data__storage.html#a48be29fc3686e433e82ed8b008446cd1">pos</a> += size;
<a name="l00607"></a>00607     <span class="keywordflow">return</span> ptr;
<a name="l00608"></a>00608 }
<a name="l00609"></a>00609 
<a name="l00610"></a>00610 <span class="keyword">static</span> <a class="code" href="../../db/d57/structiseq__insn__data.html">INSN</a> *
<a name="l00611"></a><a class="code" href="../../d2/d47/compile_8c.html#a33ec56c7c2a677c8e186fadac5a094f5">00611</a> <a class="code" href="../../d2/d47/compile_8c.html#a33ec56c7c2a677c8e186fadac5a094f5">compile_data_alloc_insn</a>(<a class="code" href="../../d6/de3/structrb__iseq__struct.html">rb_iseq_t</a> *iseq)
<a name="l00612"></a>00612 {
<a name="l00613"></a>00613     <span class="keywordflow">return</span> (<a class="code" href="../../db/d57/structiseq__insn__data.html">INSN</a> *)<a class="code" href="../../d2/d47/compile_8c.html#aa24f135ae12437da748202a5329eba3e">compile_data_alloc</a>(iseq, <span class="keyword">sizeof</span>(<a class="code" href="../../db/d57/structiseq__insn__data.html">INSN</a>));
<a name="l00614"></a>00614 }
<a name="l00615"></a>00615 
<a name="l00616"></a>00616 <span class="keyword">static</span> <a class="code" href="../../d8/dc5/structiseq__label__data.html">LABEL</a> *
<a name="l00617"></a><a class="code" href="../../d2/d47/compile_8c.html#a1d24dd58b395efd5aaae0dd3c78b7ca5">00617</a> <a class="code" href="../../d2/d47/compile_8c.html#a1d24dd58b395efd5aaae0dd3c78b7ca5">compile_data_alloc_label</a>(<a class="code" href="../../d6/de3/structrb__iseq__struct.html">rb_iseq_t</a> *iseq)
<a name="l00618"></a>00618 {
<a name="l00619"></a>00619     <span class="keywordflow">return</span> (<a class="code" href="../../d8/dc5/structiseq__label__data.html">LABEL</a> *)<a class="code" href="../../d2/d47/compile_8c.html#aa24f135ae12437da748202a5329eba3e">compile_data_alloc</a>(iseq, <span class="keyword">sizeof</span>(<a class="code" href="../../d8/dc5/structiseq__label__data.html">LABEL</a>));
<a name="l00620"></a>00620 }
<a name="l00621"></a>00621 
<a name="l00622"></a>00622 <span class="keyword">static</span> <a class="code" href="../../d1/d19/structiseq__adjust__data.html">ADJUST</a> *
<a name="l00623"></a><a class="code" href="../../d2/d47/compile_8c.html#ad6ea5a55a575f7ae744aa6f4a64e6b2d">00623</a> <a class="code" href="../../d2/d47/compile_8c.html#ad6ea5a55a575f7ae744aa6f4a64e6b2d">compile_data_alloc_adjust</a>(<a class="code" href="../../d6/de3/structrb__iseq__struct.html">rb_iseq_t</a> *iseq)
<a name="l00624"></a>00624 {
<a name="l00625"></a>00625     <span class="keywordflow">return</span> (<a class="code" href="../../d1/d19/structiseq__adjust__data.html">ADJUST</a> *)<a class="code" href="../../d2/d47/compile_8c.html#aa24f135ae12437da748202a5329eba3e">compile_data_alloc</a>(iseq, <span class="keyword">sizeof</span>(<a class="code" href="../../d1/d19/structiseq__adjust__data.html">ADJUST</a>));
<a name="l00626"></a>00626 }
<a name="l00627"></a>00627 
<a name="l00628"></a>00628 <span class="comment">/*</span>
<a name="l00629"></a>00629 <span class="comment"> * elem1, elemX =&gt; elem1, elem2, elemX</span>
<a name="l00630"></a>00630 <span class="comment"> */</span>
<a name="l00631"></a>00631 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00632"></a><a class="code" href="../../d2/d47/compile_8c.html#a241e32e667b36f1289908561729a93e5">00632</a> <a class="code" href="../../d2/d47/compile_8c.html#a241e32e667b36f1289908561729a93e5">INSERT_ELEM_NEXT</a>(<a class="code" href="../../dc/dd8/structiseq__link__element.html">LINK_ELEMENT</a> *elem1, <a class="code" href="../../dc/dd8/structiseq__link__element.html">LINK_ELEMENT</a> *elem2)
<a name="l00633"></a>00633 {
<a name="l00634"></a>00634     elem2-&gt;<a class="code" href="../../dc/dd8/structiseq__link__element.html#aaae92b0ba47e61c8c36eba5dac082957">next</a> = elem1-&gt;<a class="code" href="../../dc/dd8/structiseq__link__element.html#aaae92b0ba47e61c8c36eba5dac082957">next</a>;
<a name="l00635"></a>00635     elem2-&gt;<a class="code" href="../../dc/dd8/structiseq__link__element.html#a9b8195e4fd0634def4fb75be28bef536">prev</a> = elem1;
<a name="l00636"></a>00636     elem1-&gt;<a class="code" href="../../dc/dd8/structiseq__link__element.html#aaae92b0ba47e61c8c36eba5dac082957">next</a> = elem2;
<a name="l00637"></a>00637     <span class="keywordflow">if</span> (elem2-&gt;<a class="code" href="../../dc/dd8/structiseq__link__element.html#aaae92b0ba47e61c8c36eba5dac082957">next</a>) {
<a name="l00638"></a>00638         elem2-&gt;<a class="code" href="../../dc/dd8/structiseq__link__element.html#aaae92b0ba47e61c8c36eba5dac082957">next</a>-&gt;<a class="code" href="../../dc/dd8/structiseq__link__element.html#a9b8195e4fd0634def4fb75be28bef536">prev</a> = elem2;
<a name="l00639"></a>00639     }
<a name="l00640"></a>00640 }
<a name="l00641"></a>00641 
<a name="l00642"></a>00642 <span class="preprocessor">#if 0 </span><span class="comment">/* unused */</span>
<a name="l00643"></a>00643 <span class="comment">/*</span>
<a name="l00644"></a>00644 <span class="comment"> * elemX, elem1 =&gt; elemX, elem2, elem1</span>
<a name="l00645"></a>00645 <span class="comment"> */</span>
<a name="l00646"></a>00646 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00647"></a>00647 INSERT_ELEM_PREV(<a class="code" href="../../dc/dd8/structiseq__link__element.html">LINK_ELEMENT</a> *elem1, <a class="code" href="../../dc/dd8/structiseq__link__element.html">LINK_ELEMENT</a> *elem2)
<a name="l00648"></a>00648 {
<a name="l00649"></a>00649     elem2-&gt;<a class="code" href="../../dc/dd8/structiseq__link__element.html#a9b8195e4fd0634def4fb75be28bef536">prev</a> = elem1-&gt;<a class="code" href="../../dc/dd8/structiseq__link__element.html#a9b8195e4fd0634def4fb75be28bef536">prev</a>;
<a name="l00650"></a>00650     elem2-&gt;<a class="code" href="../../dc/dd8/structiseq__link__element.html#aaae92b0ba47e61c8c36eba5dac082957">next</a> = elem1;
<a name="l00651"></a>00651     elem1-&gt;<a class="code" href="../../dc/dd8/structiseq__link__element.html#a9b8195e4fd0634def4fb75be28bef536">prev</a> = elem2;
<a name="l00652"></a>00652     <span class="keywordflow">if</span> (elem2-&gt;<a class="code" href="../../dc/dd8/structiseq__link__element.html#a9b8195e4fd0634def4fb75be28bef536">prev</a>) {
<a name="l00653"></a>00653         elem2-&gt;<a class="code" href="../../dc/dd8/structiseq__link__element.html#a9b8195e4fd0634def4fb75be28bef536">prev</a>-&gt;<a class="code" href="../../dc/dd8/structiseq__link__element.html#aaae92b0ba47e61c8c36eba5dac082957">next</a> = elem2;
<a name="l00654"></a>00654     }
<a name="l00655"></a>00655 }
<a name="l00656"></a>00656 <span class="preprocessor">#endif</span>
<a name="l00657"></a>00657 <span class="preprocessor"></span>
<a name="l00658"></a>00658 <span class="comment">/*</span>
<a name="l00659"></a>00659 <span class="comment"> * elemX, elem1, elemY =&gt; elemX, elem2, elemY</span>
<a name="l00660"></a>00660 <span class="comment"> */</span>
<a name="l00661"></a>00661 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00662"></a><a class="code" href="../../d2/d47/compile_8c.html#aeab5cc0a8fd45fad5346477d64bb70da">00662</a> <a class="code" href="../../d2/d47/compile_8c.html#aeab5cc0a8fd45fad5346477d64bb70da">REPLACE_ELEM</a>(<a class="code" href="../../dc/dd8/structiseq__link__element.html">LINK_ELEMENT</a> *elem1, <a class="code" href="../../dc/dd8/structiseq__link__element.html">LINK_ELEMENT</a> *elem2)
<a name="l00663"></a>00663 {
<a name="l00664"></a>00664     elem2-&gt;<a class="code" href="../../dc/dd8/structiseq__link__element.html#a9b8195e4fd0634def4fb75be28bef536">prev</a> = elem1-&gt;<a class="code" href="../../dc/dd8/structiseq__link__element.html#a9b8195e4fd0634def4fb75be28bef536">prev</a>;
<a name="l00665"></a>00665     elem2-&gt;<a class="code" href="../../dc/dd8/structiseq__link__element.html#aaae92b0ba47e61c8c36eba5dac082957">next</a> = elem1-&gt;<a class="code" href="../../dc/dd8/structiseq__link__element.html#aaae92b0ba47e61c8c36eba5dac082957">next</a>;
<a name="l00666"></a>00666     <span class="keywordflow">if</span> (elem1-&gt;<a class="code" href="../../dc/dd8/structiseq__link__element.html#a9b8195e4fd0634def4fb75be28bef536">prev</a>) {
<a name="l00667"></a>00667         elem1-&gt;<a class="code" href="../../dc/dd8/structiseq__link__element.html#a9b8195e4fd0634def4fb75be28bef536">prev</a>-&gt;<a class="code" href="../../dc/dd8/structiseq__link__element.html#aaae92b0ba47e61c8c36eba5dac082957">next</a> = elem2;
<a name="l00668"></a>00668     }
<a name="l00669"></a>00669     <span class="keywordflow">if</span> (elem1-&gt;<a class="code" href="../../dc/dd8/structiseq__link__element.html#aaae92b0ba47e61c8c36eba5dac082957">next</a>) {
<a name="l00670"></a>00670         elem1-&gt;<a class="code" href="../../dc/dd8/structiseq__link__element.html#aaae92b0ba47e61c8c36eba5dac082957">next</a>-&gt;<a class="code" href="../../dc/dd8/structiseq__link__element.html#a9b8195e4fd0634def4fb75be28bef536">prev</a> = elem2;
<a name="l00671"></a>00671     }
<a name="l00672"></a>00672 }
<a name="l00673"></a>00673 
<a name="l00674"></a>00674 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00675"></a><a class="code" href="../../d2/d47/compile_8c.html#aeb2ab21cdb1acd4dd79c5605c7db4cf5">00675</a> <a class="code" href="../../d2/d47/compile_8c.html#aeb2ab21cdb1acd4dd79c5605c7db4cf5">REMOVE_ELEM</a>(<a class="code" href="../../dc/dd8/structiseq__link__element.html">LINK_ELEMENT</a> *elem)
<a name="l00676"></a>00676 {
<a name="l00677"></a>00677     elem-&gt;<a class="code" href="../../dc/dd8/structiseq__link__element.html#a9b8195e4fd0634def4fb75be28bef536">prev</a>-&gt;<a class="code" href="../../dc/dd8/structiseq__link__element.html#aaae92b0ba47e61c8c36eba5dac082957">next</a> = elem-&gt;<a class="code" href="../../dc/dd8/structiseq__link__element.html#aaae92b0ba47e61c8c36eba5dac082957">next</a>;
<a name="l00678"></a>00678     <span class="keywordflow">if</span> (elem-&gt;<a class="code" href="../../dc/dd8/structiseq__link__element.html#aaae92b0ba47e61c8c36eba5dac082957">next</a>) {
<a name="l00679"></a>00679         elem-&gt;<a class="code" href="../../dc/dd8/structiseq__link__element.html#aaae92b0ba47e61c8c36eba5dac082957">next</a>-&gt;<a class="code" href="../../dc/dd8/structiseq__link__element.html#a9b8195e4fd0634def4fb75be28bef536">prev</a> = elem-&gt;<a class="code" href="../../dc/dd8/structiseq__link__element.html#a9b8195e4fd0634def4fb75be28bef536">prev</a>;
<a name="l00680"></a>00680     }
<a name="l00681"></a>00681 }
<a name="l00682"></a>00682 
<a name="l00683"></a>00683 <span class="keyword">static</span> <a class="code" href="../../dc/dd8/structiseq__link__element.html">LINK_ELEMENT</a> *
<a name="l00684"></a><a class="code" href="../../d2/d47/compile_8c.html#a7dd2b3352ea85a0b8f87dc549b9c4f1e">00684</a> <a class="code" href="../../d2/d47/compile_8c.html#a7dd2b3352ea85a0b8f87dc549b9c4f1e">FIRST_ELEMENT</a>(<a class="code" href="../../d4/dcd/structiseq__link__anchor.html">LINK_ANCHOR</a> *anchor)
<a name="l00685"></a>00685 {
<a name="l00686"></a>00686     <span class="keywordflow">return</span> anchor-&gt;<a class="code" href="../../d4/dcd/structiseq__link__anchor.html#a38f0d32636c5b0b20f8b82816530f20c">anchor</a>.<a class="code" href="../../dc/dd8/structiseq__link__element.html#aaae92b0ba47e61c8c36eba5dac082957">next</a>;
<a name="l00687"></a>00687 }
<a name="l00688"></a>00688 
<a name="l00689"></a>00689 <span class="preprocessor">#if 0 </span><span class="comment">/* unused */</span>
<a name="l00690"></a>00690 <span class="keyword">static</span> <a class="code" href="../../dc/dd8/structiseq__link__element.html">LINK_ELEMENT</a> *
<a name="l00691"></a>00691 LAST_ELEMENT(<a class="code" href="../../d4/dcd/structiseq__link__anchor.html">LINK_ANCHOR</a> *anchor)
<a name="l00692"></a>00692 {
<a name="l00693"></a>00693   <span class="keywordflow">return</span> anchor-&gt;<a class="code" href="../../d4/dcd/structiseq__link__anchor.html#a51b3384a1d06e26fdf1214c219f19927">last</a>;
<a name="l00694"></a>00694 }
<a name="l00695"></a>00695 <span class="preprocessor">#endif</span>
<a name="l00696"></a>00696 <span class="preprocessor"></span>
<a name="l00697"></a>00697 <span class="keyword">static</span> <a class="code" href="../../dc/dd8/structiseq__link__element.html">LINK_ELEMENT</a> *
<a name="l00698"></a><a class="code" href="../../d2/d47/compile_8c.html#a56c34aaed1ac9f929e9f73c680fb32c3">00698</a> <a class="code" href="../../d2/d47/compile_8c.html#a56c34aaed1ac9f929e9f73c680fb32c3">POP_ELEMENT</a>(<a class="code" href="../../d2/d47/compile_8c.html#a3a1b3a7337c866c2a49b896d11423d3e">ISEQ_ARG_DECLARE</a> <a class="code" href="../../d4/dcd/structiseq__link__anchor.html">LINK_ANCHOR</a> *anchor)
<a name="l00699"></a>00699 {
<a name="l00700"></a>00700     <a class="code" href="../../dc/dd8/structiseq__link__element.html">LINK_ELEMENT</a> *elem = anchor-&gt;last;
<a name="l00701"></a>00701     anchor-&gt;last = anchor-&gt;last-&gt;<a class="code" href="../../dc/dd8/structiseq__link__element.html#a9b8195e4fd0634def4fb75be28bef536">prev</a>;
<a name="l00702"></a>00702     anchor-&gt;last-&gt;<a class="code" href="../../dc/dd8/structiseq__link__element.html#aaae92b0ba47e61c8c36eba5dac082957">next</a> = 0;
<a name="l00703"></a>00703     <a class="code" href="../../d2/d47/compile_8c.html#a729411c47b67655aa1b56fd37fad90ae">verify_list</a>(<span class="stringliteral">&quot;pop&quot;</span>, anchor);
<a name="l00704"></a>00704     <span class="keywordflow">return</span> elem;
<a name="l00705"></a>00705 }
<a name="l00706"></a>00706 <span class="preprocessor">#if CPDEBUG &lt; 0</span>
<a name="l00707"></a>00707 <span class="preprocessor"></span><span class="preprocessor">#define POP_ELEMENT(anchor) POP_ELEMENT(iseq, (anchor))</span>
<a name="l00708"></a>00708 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00709"></a>00709 <span class="preprocessor"></span>
<a name="l00710"></a>00710 <span class="preprocessor">#if 0 </span><span class="comment">/* unused */</span>
<a name="l00711"></a>00711 <span class="keyword">static</span> <a class="code" href="../../dc/dd8/structiseq__link__element.html">LINK_ELEMENT</a> *
<a name="l00712"></a>00712 SHIFT_ELEMENT(<a class="code" href="../../d4/dcd/structiseq__link__anchor.html">LINK_ANCHOR</a> *anchor)
<a name="l00713"></a>00713 {
<a name="l00714"></a>00714     <a class="code" href="../../dc/dd8/structiseq__link__element.html">LINK_ELEMENT</a> *elem = anchor-&gt;<a class="code" href="../../d4/dcd/structiseq__link__anchor.html#a38f0d32636c5b0b20f8b82816530f20c">anchor</a>.<a class="code" href="../../dc/dd8/structiseq__link__element.html#aaae92b0ba47e61c8c36eba5dac082957">next</a>;
<a name="l00715"></a>00715     <span class="keywordflow">if</span> (elem) {
<a name="l00716"></a>00716         anchor-&gt;<a class="code" href="../../d4/dcd/structiseq__link__anchor.html#a38f0d32636c5b0b20f8b82816530f20c">anchor</a>.<a class="code" href="../../dc/dd8/structiseq__link__element.html#aaae92b0ba47e61c8c36eba5dac082957">next</a> = elem-&gt;<a class="code" href="../../dc/dd8/structiseq__link__element.html#aaae92b0ba47e61c8c36eba5dac082957">next</a>;
<a name="l00717"></a>00717     }
<a name="l00718"></a>00718     <span class="keywordflow">return</span> elem;
<a name="l00719"></a>00719 }
<a name="l00720"></a>00720 <span class="preprocessor">#endif</span>
<a name="l00721"></a>00721 <span class="preprocessor"></span>
<a name="l00722"></a>00722 <span class="preprocessor">#if 0 </span><span class="comment">/* unused */</span>
<a name="l00723"></a>00723 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l00724"></a>00724 LIST_SIZE(<a class="code" href="../../d4/dcd/structiseq__link__anchor.html">LINK_ANCHOR</a> *anchor)
<a name="l00725"></a>00725 {
<a name="l00726"></a>00726     <a class="code" href="../../dc/dd8/structiseq__link__element.html">LINK_ELEMENT</a> *elem = anchor-&gt;<a class="code" href="../../d4/dcd/structiseq__link__anchor.html#a38f0d32636c5b0b20f8b82816530f20c">anchor</a>.<a class="code" href="../../dc/dd8/structiseq__link__element.html#aaae92b0ba47e61c8c36eba5dac082957">next</a>;
<a name="l00727"></a>00727     <span class="keywordtype">int</span> <a class="code" href="../../d5/db5/encoding_8c.html#a439227feff9d7f55384e8780cfc2eb82">size</a> = 0;
<a name="l00728"></a>00728     <span class="keywordflow">while</span> (elem) {
<a name="l00729"></a>00729         size += 1;
<a name="l00730"></a>00730         elem = elem-&gt;<a class="code" href="../../dc/dd8/structiseq__link__element.html#aaae92b0ba47e61c8c36eba5dac082957">next</a>;
<a name="l00731"></a>00731     }
<a name="l00732"></a>00732     <span class="keywordflow">return</span> size;
<a name="l00733"></a>00733 }
<a name="l00734"></a>00734 <span class="preprocessor">#endif</span>
<a name="l00735"></a>00735 <span class="preprocessor"></span>
<a name="l00736"></a>00736 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l00737"></a><a class="code" href="../../d2/d47/compile_8c.html#aa32aff332271737c2a3edbb440ad4ca1">00737</a> <a class="code" href="../../d2/d47/compile_8c.html#aa32aff332271737c2a3edbb440ad4ca1">LIST_SIZE_ZERO</a>(<a class="code" href="../../d4/dcd/structiseq__link__anchor.html">LINK_ANCHOR</a> *anchor)
<a name="l00738"></a>00738 {
<a name="l00739"></a>00739     <span class="keywordflow">if</span> (anchor-&gt;<a class="code" href="../../d4/dcd/structiseq__link__anchor.html#a38f0d32636c5b0b20f8b82816530f20c">anchor</a>.<a class="code" href="../../dc/dd8/structiseq__link__element.html#aaae92b0ba47e61c8c36eba5dac082957">next</a> == 0) {
<a name="l00740"></a>00740         <span class="keywordflow">return</span> 1;
<a name="l00741"></a>00741     }
<a name="l00742"></a>00742     <span class="keywordflow">else</span> {
<a name="l00743"></a>00743         <span class="keywordflow">return</span> 0;
<a name="l00744"></a>00744     }
<a name="l00745"></a>00745 }
<a name="l00746"></a>00746 
<a name="l00747"></a>00747 <span class="comment">/*</span>
<a name="l00748"></a>00748 <span class="comment"> * anc1: e1, e2, e3</span>
<a name="l00749"></a>00749 <span class="comment"> * anc2: e4, e5</span>
<a name="l00750"></a>00750 <span class="comment"> *#=&gt;</span>
<a name="l00751"></a>00751 <span class="comment"> * anc1: e1, e2, e3, e4, e5</span>
<a name="l00752"></a>00752 <span class="comment"> * anc2: e4, e5 (broken)</span>
<a name="l00753"></a>00753 <span class="comment"> */</span>
<a name="l00754"></a>00754 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00755"></a><a class="code" href="../../d2/d47/compile_8c.html#a5a7f256f8f8db0e88898549ee18cdf36">00755</a> <a class="code" href="../../d2/d47/compile_8c.html#a5a7f256f8f8db0e88898549ee18cdf36">APPEND_LIST</a>(<a class="code" href="../../d2/d47/compile_8c.html#a3a1b3a7337c866c2a49b896d11423d3e">ISEQ_ARG_DECLARE</a> <a class="code" href="../../d4/dcd/structiseq__link__anchor.html">LINK_ANCHOR</a> *anc1, <a class="code" href="../../d4/dcd/structiseq__link__anchor.html">LINK_ANCHOR</a> *anc2)
<a name="l00756"></a>00756 {
<a name="l00757"></a>00757     <span class="keywordflow">if</span> (anc2-&gt;<a class="code" href="../../d4/dcd/structiseq__link__anchor.html#a38f0d32636c5b0b20f8b82816530f20c">anchor</a>.<a class="code" href="../../dc/dd8/structiseq__link__element.html#aaae92b0ba47e61c8c36eba5dac082957">next</a>) {
<a name="l00758"></a>00758         anc1-&gt;last-&gt;next = anc2-&gt;<a class="code" href="../../d4/dcd/structiseq__link__anchor.html#a38f0d32636c5b0b20f8b82816530f20c">anchor</a>.<a class="code" href="../../dc/dd8/structiseq__link__element.html#aaae92b0ba47e61c8c36eba5dac082957">next</a>;
<a name="l00759"></a>00759         anc2-&gt;<a class="code" href="../../d4/dcd/structiseq__link__anchor.html#a38f0d32636c5b0b20f8b82816530f20c">anchor</a>.<a class="code" href="../../dc/dd8/structiseq__link__element.html#aaae92b0ba47e61c8c36eba5dac082957">next</a>-&gt;<a class="code" href="../../dc/dd8/structiseq__link__element.html#a9b8195e4fd0634def4fb75be28bef536">prev</a> = anc1-&gt;last;
<a name="l00760"></a>00760         anc1-&gt;last = anc2-&gt;<a class="code" href="../../d4/dcd/structiseq__link__anchor.html#a51b3384a1d06e26fdf1214c219f19927">last</a>;
<a name="l00761"></a>00761     }
<a name="l00762"></a>00762     <a class="code" href="../../d2/d47/compile_8c.html#a729411c47b67655aa1b56fd37fad90ae">verify_list</a>(<span class="stringliteral">&quot;append&quot;</span>, anc1);
<a name="l00763"></a>00763 }
<a name="l00764"></a>00764 <span class="preprocessor">#if CPDEBUG &lt; 0</span>
<a name="l00765"></a>00765 <span class="preprocessor"></span><span class="preprocessor">#define APPEND_LIST(anc1, anc2) APPEND_LIST(iseq, (anc1), (anc2))</span>
<a name="l00766"></a>00766 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00767"></a>00767 <span class="preprocessor"></span>
<a name="l00768"></a>00768 <span class="comment">/*</span>
<a name="l00769"></a>00769 <span class="comment"> * anc1: e1, e2, e3</span>
<a name="l00770"></a>00770 <span class="comment"> * anc2: e4, e5</span>
<a name="l00771"></a>00771 <span class="comment"> *#=&gt;</span>
<a name="l00772"></a>00772 <span class="comment"> * anc1: e4, e5, e1, e2, e3</span>
<a name="l00773"></a>00773 <span class="comment"> * anc2: e4, e5 (broken)</span>
<a name="l00774"></a>00774 <span class="comment"> */</span>
<a name="l00775"></a>00775 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00776"></a><a class="code" href="../../d2/d47/compile_8c.html#ad41b7be766569804251497cf2d6103e5">00776</a> <a class="code" href="../../d2/d47/compile_8c.html#ad41b7be766569804251497cf2d6103e5">INSERT_LIST</a>(<a class="code" href="../../d2/d47/compile_8c.html#a3a1b3a7337c866c2a49b896d11423d3e">ISEQ_ARG_DECLARE</a> <a class="code" href="../../d4/dcd/structiseq__link__anchor.html">LINK_ANCHOR</a> *anc1, <a class="code" href="../../d4/dcd/structiseq__link__anchor.html">LINK_ANCHOR</a> *anc2)
<a name="l00777"></a>00777 {
<a name="l00778"></a>00778     <span class="keywordflow">if</span> (anc2-&gt;<a class="code" href="../../d4/dcd/structiseq__link__anchor.html#a38f0d32636c5b0b20f8b82816530f20c">anchor</a>.<a class="code" href="../../dc/dd8/structiseq__link__element.html#aaae92b0ba47e61c8c36eba5dac082957">next</a>) {
<a name="l00779"></a>00779         <a class="code" href="../../dc/dd8/structiseq__link__element.html">LINK_ELEMENT</a> *first = anc1-&gt;anchor.next;
<a name="l00780"></a>00780         anc1-&gt;anchor.next = anc2-&gt;<a class="code" href="../../d4/dcd/structiseq__link__anchor.html#a38f0d32636c5b0b20f8b82816530f20c">anchor</a>.<a class="code" href="../../dc/dd8/structiseq__link__element.html#aaae92b0ba47e61c8c36eba5dac082957">next</a>;
<a name="l00781"></a>00781         anc1-&gt;anchor.<a class="code" href="../../dc/dd8/structiseq__link__element.html#aaae92b0ba47e61c8c36eba5dac082957">next</a>-&gt;<a class="code" href="../../dc/dd8/structiseq__link__element.html#a9b8195e4fd0634def4fb75be28bef536">prev</a> = &amp;anc1-&gt;anchor;
<a name="l00782"></a>00782         anc2-&gt;<a class="code" href="../../d4/dcd/structiseq__link__anchor.html#a51b3384a1d06e26fdf1214c219f19927">last</a>-&gt;<a class="code" href="../../dc/dd8/structiseq__link__element.html#aaae92b0ba47e61c8c36eba5dac082957">next</a> = first;
<a name="l00783"></a>00783         <span class="keywordflow">if</span> (first) {
<a name="l00784"></a>00784             first-&gt;<a class="code" href="../../dc/dd8/structiseq__link__element.html#a9b8195e4fd0634def4fb75be28bef536">prev</a> = anc2-&gt;<a class="code" href="../../d4/dcd/structiseq__link__anchor.html#a51b3384a1d06e26fdf1214c219f19927">last</a>;
<a name="l00785"></a>00785         }
<a name="l00786"></a>00786         <span class="keywordflow">else</span> {
<a name="l00787"></a>00787             anc1-&gt;last = anc2-&gt;<a class="code" href="../../d4/dcd/structiseq__link__anchor.html#a51b3384a1d06e26fdf1214c219f19927">last</a>;
<a name="l00788"></a>00788         }
<a name="l00789"></a>00789     }
<a name="l00790"></a>00790 
<a name="l00791"></a>00791     <a class="code" href="../../d2/d47/compile_8c.html#a729411c47b67655aa1b56fd37fad90ae">verify_list</a>(<span class="stringliteral">&quot;append&quot;</span>, anc1);
<a name="l00792"></a>00792 }
<a name="l00793"></a>00793 <span class="preprocessor">#if CPDEBUG &lt; 0</span>
<a name="l00794"></a>00794 <span class="preprocessor"></span><span class="preprocessor">#define INSERT_LIST(anc1, anc2) INSERT_LIST(iseq, (anc1), (anc2))</span>
<a name="l00795"></a>00795 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00796"></a>00796 <span class="preprocessor"></span>
<a name="l00797"></a>00797 <span class="preprocessor">#if 0 </span><span class="comment">/* unused */</span>
<a name="l00798"></a>00798 <span class="comment">/*</span>
<a name="l00799"></a>00799 <span class="comment"> * anc1: e1, e2, e3</span>
<a name="l00800"></a>00800 <span class="comment"> * anc2: e4, e5</span>
<a name="l00801"></a>00801 <span class="comment"> *#=&gt;</span>
<a name="l00802"></a>00802 <span class="comment"> * anc1: e4, e5</span>
<a name="l00803"></a>00803 <span class="comment"> * anc2: e1, e2, e3</span>
<a name="l00804"></a>00804 <span class="comment"> */</span>
<a name="l00805"></a>00805 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00806"></a>00806 SWAP_LIST(<a class="code" href="../../d2/d47/compile_8c.html#a3a1b3a7337c866c2a49b896d11423d3e">ISEQ_ARG_DECLARE</a> <a class="code" href="../../d4/dcd/structiseq__link__anchor.html">LINK_ANCHOR</a> *anc1, <a class="code" href="../../d4/dcd/structiseq__link__anchor.html">LINK_ANCHOR</a> *anc2)
<a name="l00807"></a>00807 {
<a name="l00808"></a>00808     <a class="code" href="../../d4/dcd/structiseq__link__anchor.html">LINK_ANCHOR</a> tmp = *anc2;
<a name="l00809"></a>00809 
<a name="l00810"></a>00810     <span class="comment">/* it has bug */</span>
<a name="l00811"></a>00811     *anc2 = *anc1;
<a name="l00812"></a>00812     *anc1 = tmp;
<a name="l00813"></a>00813 
<a name="l00814"></a>00814     <a class="code" href="../../d2/d47/compile_8c.html#a729411c47b67655aa1b56fd37fad90ae">verify_list</a>(<span class="stringliteral">&quot;swap1&quot;</span>, anc1);
<a name="l00815"></a>00815     <a class="code" href="../../d2/d47/compile_8c.html#a729411c47b67655aa1b56fd37fad90ae">verify_list</a>(<span class="stringliteral">&quot;swap2&quot;</span>, anc2);
<a name="l00816"></a>00816 }
<a name="l00817"></a>00817 <span class="preprocessor">#if CPDEBUG &lt; 0</span>
<a name="l00818"></a>00818 <span class="preprocessor"></span><span class="preprocessor">#define SWAP_LIST(anc1, anc2) SWAP_LIST(iseq, (anc1), (anc2))</span>
<a name="l00819"></a>00819 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00820"></a>00820 <span class="preprocessor"></span>
<a name="l00821"></a>00821 <span class="keyword">static</span> <a class="code" href="../../d4/dcd/structiseq__link__anchor.html">LINK_ANCHOR</a> *
<a name="l00822"></a>00822 REVERSE_LIST(<a class="code" href="../../d2/d47/compile_8c.html#a3a1b3a7337c866c2a49b896d11423d3e">ISEQ_ARG_DECLARE</a> <a class="code" href="../../d4/dcd/structiseq__link__anchor.html">LINK_ANCHOR</a> *anc)
<a name="l00823"></a>00823 {
<a name="l00824"></a>00824     <a class="code" href="../../dc/dd8/structiseq__link__element.html">LINK_ELEMENT</a> *first, *<a class="code" href="../../d6/da0/nkf-utf8_2nkf_8c.html#ab0b853bc4e4e9658036bf7e604f398ad">last</a>, *elem, *e;
<a name="l00825"></a>00825     first = &amp;anc-&gt;anchor;
<a name="l00826"></a>00826     elem = first-&gt;<a class="code" href="../../dc/dd8/structiseq__link__element.html#aaae92b0ba47e61c8c36eba5dac082957">next</a>;
<a name="l00827"></a>00827     last = anc-&gt;last;
<a name="l00828"></a>00828 
<a name="l00829"></a>00829     <span class="keywordflow">if</span> (elem != 0) {
<a name="l00830"></a>00830         anc-&gt;anchor.<a class="code" href="../../dc/dd8/structiseq__link__element.html#aaae92b0ba47e61c8c36eba5dac082957">next</a> = last;
<a name="l00831"></a>00831         anc-&gt;last = elem;
<a name="l00832"></a>00832     }
<a name="l00833"></a>00833     <span class="keywordflow">else</span> {
<a name="l00834"></a>00834         <span class="comment">/* null list */</span>
<a name="l00835"></a>00835         <span class="keywordflow">return</span> anc;
<a name="l00836"></a>00836     }
<a name="l00837"></a>00837     <span class="keywordflow">while</span> (elem) {
<a name="l00838"></a>00838         e = elem-&gt;<a class="code" href="../../dc/dd8/structiseq__link__element.html#aaae92b0ba47e61c8c36eba5dac082957">next</a>;
<a name="l00839"></a>00839         elem-&gt;<a class="code" href="../../dc/dd8/structiseq__link__element.html#aaae92b0ba47e61c8c36eba5dac082957">next</a> = elem-&gt;<a class="code" href="../../dc/dd8/structiseq__link__element.html#a9b8195e4fd0634def4fb75be28bef536">prev</a>;
<a name="l00840"></a>00840         elem-&gt;<a class="code" href="../../dc/dd8/structiseq__link__element.html#a9b8195e4fd0634def4fb75be28bef536">prev</a> = e;
<a name="l00841"></a>00841         elem = e;
<a name="l00842"></a>00842     }
<a name="l00843"></a>00843 
<a name="l00844"></a>00844     first-&gt;<a class="code" href="../../dc/dd8/structiseq__link__element.html#aaae92b0ba47e61c8c36eba5dac082957">next</a> = last;
<a name="l00845"></a>00845     last-&gt;<a class="code" href="../../dc/dd8/structiseq__link__element.html#a9b8195e4fd0634def4fb75be28bef536">prev</a> = first;
<a name="l00846"></a>00846     anc-&gt;last-&gt;<a class="code" href="../../dc/dd8/structiseq__link__element.html#aaae92b0ba47e61c8c36eba5dac082957">next</a> = 0;
<a name="l00847"></a>00847 
<a name="l00848"></a>00848     <a class="code" href="../../d2/d47/compile_8c.html#a729411c47b67655aa1b56fd37fad90ae">verify_list</a>(<span class="stringliteral">&quot;reverse&quot;</span>, anc);
<a name="l00849"></a>00849     <span class="keywordflow">return</span> anc;
<a name="l00850"></a>00850 }
<a name="l00851"></a>00851 <span class="preprocessor">#if CPDEBUG &lt; 0</span>
<a name="l00852"></a>00852 <span class="preprocessor"></span><span class="preprocessor">#define REVERSE_LIST(anc) REVERSE_LIST(iseq, (anc))</span>
<a name="l00853"></a>00853 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00854"></a>00854 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00855"></a>00855 <span class="preprocessor"></span>
<a name="l00856"></a>00856 <span class="preprocessor">#if CPDEBUG &amp;&amp; 0</span>
<a name="l00857"></a>00857 <span class="preprocessor"></span><span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00858"></a>00858 debug_list(<a class="code" href="../../d2/d47/compile_8c.html#a3a1b3a7337c866c2a49b896d11423d3e">ISEQ_ARG_DECLARE</a> <a class="code" href="../../d4/dcd/structiseq__link__anchor.html">LINK_ANCHOR</a> *anchor)
<a name="l00859"></a>00859 {
<a name="l00860"></a>00860     <a class="code" href="../../dc/dd8/structiseq__link__element.html">LINK_ELEMENT</a> *<a class="code" href="../../d5/db5/encoding_8c.html#a05f70dacbe595d27364e1e014efb0c8e">list</a> = <a class="code" href="../../d2/d47/compile_8c.html#a7dd2b3352ea85a0b8f87dc549b9c4f1e">FIRST_ELEMENT</a>(anchor);
<a name="l00861"></a>00861     printf(<span class="stringliteral">&quot;----\n&quot;</span>);
<a name="l00862"></a>00862     printf(<span class="stringliteral">&quot;anch: %p, frst: %p, last: %p\n&quot;</span>, &amp;anchor-&gt;anchor,
<a name="l00863"></a>00863            anchor-&gt;anchor.next, anchor-&gt;last);
<a name="l00864"></a>00864     <span class="keywordflow">while</span> (list) {
<a name="l00865"></a>00865         printf(<span class="stringliteral">&quot;curr: %p, next: %p, prev: %p, type: %d\n&quot;</span>, list, list-&gt;<a class="code" href="../../dc/dd8/structiseq__link__element.html#aaae92b0ba47e61c8c36eba5dac082957">next</a>,
<a name="l00866"></a>00866                list-&gt;<a class="code" href="../../dc/dd8/structiseq__link__element.html#a9b8195e4fd0634def4fb75be28bef536">prev</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a9444c431b3cb1184e7523fc572f2c758">FIX2INT</a>(list-&gt;<a class="code" href="../../dc/dd8/structiseq__link__element.html#a36dbc4d260432e7b26802451326ac92f">type</a>));
<a name="l00867"></a>00867         list = list-&gt;<a class="code" href="../../dc/dd8/structiseq__link__element.html#aaae92b0ba47e61c8c36eba5dac082957">next</a>;
<a name="l00868"></a>00868     }
<a name="l00869"></a>00869     printf(<span class="stringliteral">&quot;----\n&quot;</span>);
<a name="l00870"></a>00870 
<a name="l00871"></a>00871     <a class="code" href="../../d2/d47/compile_8c.html#aee9a7dcbd2c223a7790c416972f221c7">dump_disasm_list</a>(anchor-&gt;anchor.next);
<a name="l00872"></a>00872     <a class="code" href="../../d2/d47/compile_8c.html#a729411c47b67655aa1b56fd37fad90ae">verify_list</a>(<span class="stringliteral">&quot;debug list&quot;</span>, anchor);
<a name="l00873"></a>00873 }
<a name="l00874"></a>00874 <span class="preprocessor">#if CPDEBUG &lt; 0</span>
<a name="l00875"></a>00875 <span class="preprocessor"></span><span class="preprocessor">#define debug_list(anc) debug_list(iseq, (anc))</span>
<a name="l00876"></a>00876 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00877"></a>00877 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00878"></a>00878 <span class="preprocessor"></span>
<a name="l00879"></a>00879 <span class="keyword">static</span> <a class="code" href="../../d8/dc5/structiseq__label__data.html">LABEL</a> *
<a name="l00880"></a><a class="code" href="../../d2/d47/compile_8c.html#a92e2d92bf96dc2e155357940a977ee1e">00880</a> <a class="code" href="../../d2/d47/compile_8c.html#a92e2d92bf96dc2e155357940a977ee1e">new_label_body</a>(<a class="code" href="../../d6/de3/structrb__iseq__struct.html">rb_iseq_t</a> *iseq, <span class="keywordtype">long</span> line)
<a name="l00881"></a>00881 {
<a name="l00882"></a>00882     <a class="code" href="../../d8/dc5/structiseq__label__data.html">LABEL</a> *labelobj = <a class="code" href="../../d2/d47/compile_8c.html#a1d24dd58b395efd5aaae0dd3c78b7ca5">compile_data_alloc_label</a>(iseq);
<a name="l00883"></a>00883 
<a name="l00884"></a>00884     labelobj-&gt;<a class="code" href="../../d8/dc5/structiseq__label__data.html#abf04ba28589819eff2e67e3884a040f0">link</a>.<a class="code" href="../../dc/dd8/structiseq__link__element.html#a36dbc4d260432e7b26802451326ac92f">type</a> = ISEQ_ELEMENT_LABEL;
<a name="l00885"></a>00885     labelobj-&gt;<a class="code" href="../../d8/dc5/structiseq__label__data.html#abf04ba28589819eff2e67e3884a040f0">link</a>.<a class="code" href="../../dc/dd8/structiseq__link__element.html#aaae92b0ba47e61c8c36eba5dac082957">next</a> = 0;
<a name="l00886"></a>00886 
<a name="l00887"></a>00887     labelobj-&gt;<a class="code" href="../../d8/dc5/structiseq__label__data.html#ae41778d86068bb63216de9834cfbce7e">label_no</a> = iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a947d34698fb5a71f4938532fff27a0f7">compile_data</a>-&gt;<a class="code" href="../../d4/dd8/structiseq__compile__data.html#a491d549b41273df395f0351110e55869">label_no</a>++;
<a name="l00888"></a>00888     labelobj-&gt;<a class="code" href="../../d8/dc5/structiseq__label__data.html#ac15f213f0f9e22b989778d50ef8b8328">sc_state</a> = 0;
<a name="l00889"></a>00889     labelobj-&gt;<a class="code" href="../../d8/dc5/structiseq__label__data.html#ae4b50f2e5fc116dfc1d17ac227840e2e">sp</a> = -1;
<a name="l00890"></a>00890     <span class="keywordflow">return</span> labelobj;
<a name="l00891"></a>00891 }
<a name="l00892"></a>00892 
<a name="l00893"></a>00893 <span class="keyword">static</span> <a class="code" href="../../d1/d19/structiseq__adjust__data.html">ADJUST</a> *
<a name="l00894"></a><a class="code" href="../../d2/d47/compile_8c.html#a0ed97d20f9c399eb0608ce3a19bcbc98">00894</a> <a class="code" href="../../d2/d47/compile_8c.html#a0ed97d20f9c399eb0608ce3a19bcbc98">new_adjust_body</a>(<a class="code" href="../../d6/de3/structrb__iseq__struct.html">rb_iseq_t</a> *iseq, <a class="code" href="../../d8/dc5/structiseq__label__data.html">LABEL</a> *label, <span class="keywordtype">int</span> line)
<a name="l00895"></a>00895 {
<a name="l00896"></a>00896     <a class="code" href="../../d1/d19/structiseq__adjust__data.html">ADJUST</a> *adjust = <a class="code" href="../../d2/d47/compile_8c.html#ad6ea5a55a575f7ae744aa6f4a64e6b2d">compile_data_alloc_adjust</a>(iseq);
<a name="l00897"></a>00897     adjust-&gt;<a class="code" href="../../d1/d19/structiseq__adjust__data.html#a5ab16054d00eb1f86cf4de8d9544040e">link</a>.<a class="code" href="../../dc/dd8/structiseq__link__element.html#a36dbc4d260432e7b26802451326ac92f">type</a> = ISEQ_ELEMENT_ADJUST;
<a name="l00898"></a>00898     adjust-&gt;<a class="code" href="../../d1/d19/structiseq__adjust__data.html#a5ab16054d00eb1f86cf4de8d9544040e">link</a>.<a class="code" href="../../dc/dd8/structiseq__link__element.html#aaae92b0ba47e61c8c36eba5dac082957">next</a> = 0;
<a name="l00899"></a>00899     adjust-&gt;<a class="code" href="../../d1/d19/structiseq__adjust__data.html#a0d755f7879e8378b46a8c3c2431fb65e">label</a> = label;
<a name="l00900"></a>00900     adjust-&gt;<a class="code" href="../../d1/d19/structiseq__adjust__data.html#acd27d315d7852871c7fb9dcb15acb438">line_no</a> = line;
<a name="l00901"></a>00901     <span class="keywordflow">return</span> adjust;
<a name="l00902"></a>00902 }
<a name="l00903"></a>00903 
<a name="l00904"></a>00904 <span class="keyword">static</span> <a class="code" href="../../db/d57/structiseq__insn__data.html">INSN</a> *
<a name="l00905"></a><a class="code" href="../../d2/d47/compile_8c.html#a43e3134981c54d24f0e03651e0f909b6">00905</a> <a class="code" href="../../d2/d47/compile_8c.html#a43e3134981c54d24f0e03651e0f909b6">new_insn_core</a>(<a class="code" href="../../d6/de3/structrb__iseq__struct.html">rb_iseq_t</a> *iseq, <span class="keywordtype">int</span> line_no,
<a name="l00906"></a>00906               <span class="keywordtype">int</span> insn_id, <span class="keywordtype">int</span> <a class="code" href="../../df/d77/ruby_8c.html#ad1447518f4372828b8435ae82e48499e">argc</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> *<a class="code" href="../../df/d77/ruby_8c.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>)
<a name="l00907"></a>00907 {
<a name="l00908"></a>00908     <a class="code" href="../../db/d57/structiseq__insn__data.html">INSN</a> *iobj = <a class="code" href="../../d2/d47/compile_8c.html#a33ec56c7c2a677c8e186fadac5a094f5">compile_data_alloc_insn</a>(iseq);
<a name="l00909"></a>00909     <span class="comment">/* printf(&quot;insn_id: %d, line: %d\n&quot;, insn_id, line_no); */</span>
<a name="l00910"></a>00910 
<a name="l00911"></a>00911     iobj-&gt;<a class="code" href="../../db/d57/structiseq__insn__data.html#aa7e061b84452f211dffd6accf084fa31">link</a>.<a class="code" href="../../dc/dd8/structiseq__link__element.html#a36dbc4d260432e7b26802451326ac92f">type</a> = ISEQ_ELEMENT_INSN;
<a name="l00912"></a>00912     iobj-&gt;<a class="code" href="../../db/d57/structiseq__insn__data.html#aa7e061b84452f211dffd6accf084fa31">link</a>.<a class="code" href="../../dc/dd8/structiseq__link__element.html#aaae92b0ba47e61c8c36eba5dac082957">next</a> = 0;
<a name="l00913"></a>00913     iobj-&gt;<a class="code" href="../../db/d57/structiseq__insn__data.html#ab1f1e3095532dd0ece9bb256047a027e">insn_id</a> = insn_id;
<a name="l00914"></a>00914     iobj-&gt;<a class="code" href="../../db/d57/structiseq__insn__data.html#a7da955a957d6555a0c0454dee8508669">line_no</a> = line_no;
<a name="l00915"></a>00915     iobj-&gt;<a class="code" href="../../db/d57/structiseq__insn__data.html#ae83a50dd669328f4915717f99d8805c5">operands</a> = argv;
<a name="l00916"></a>00916     iobj-&gt;<a class="code" href="../../db/d57/structiseq__insn__data.html#aec0e69fa21d100503fd6b901003b3c27">operand_size</a> = argc;
<a name="l00917"></a>00917     iobj-&gt;<a class="code" href="../../db/d57/structiseq__insn__data.html#a2400b3da3accd8be533c97b47f186acd">sc_state</a> = 0;
<a name="l00918"></a>00918     <span class="keywordflow">return</span> iobj;
<a name="l00919"></a>00919 }
<a name="l00920"></a>00920 
<a name="l00921"></a>00921 <span class="keyword">static</span> <a class="code" href="../../db/d57/structiseq__insn__data.html">INSN</a> *
<a name="l00922"></a><a class="code" href="../../d2/d47/compile_8c.html#af32e6981fd21b9b2cb65ed85904c4d5a">00922</a> <a class="code" href="../../d2/d47/compile_8c.html#af32e6981fd21b9b2cb65ed85904c4d5a">new_insn_body</a>(<a class="code" href="../../d6/de3/structrb__iseq__struct.html">rb_iseq_t</a> *iseq, <span class="keywordtype">int</span> line_no, <span class="keywordtype">int</span> insn_id, <span class="keywordtype">int</span> <a class="code" href="../../df/d77/ruby_8c.html#ad1447518f4372828b8435ae82e48499e">argc</a>, ...)
<a name="l00923"></a>00923 {
<a name="l00924"></a>00924     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> *operands = 0;
<a name="l00925"></a>00925     va_list <a class="code" href="../../df/d77/ruby_8c.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>;
<a name="l00926"></a>00926     <span class="keywordflow">if</span> (argc &gt; 0) {
<a name="l00927"></a>00927         <span class="keywordtype">int</span> i;
<a name="l00928"></a>00928         <a class="code" href="../../d5/d9d/tcltklib_8c.html#a3a0a28ba6e22644006c9bafb793f8a2c">va_init_list</a>(argv, argc);
<a name="l00929"></a>00929         operands = (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> *)<a class="code" href="../../d2/d47/compile_8c.html#aa24f135ae12437da748202a5329eba3e">compile_data_alloc</a>(iseq, <span class="keyword">sizeof</span>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>) * argc);
<a name="l00930"></a>00930         <span class="keywordflow">for</span> (i = 0; i &lt; argc; i++) {
<a name="l00931"></a>00931             <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> v = va_arg(argv, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>);
<a name="l00932"></a>00932             operands[i] = v;
<a name="l00933"></a>00933         }
<a name="l00934"></a>00934         va_end(argv);
<a name="l00935"></a>00935     }
<a name="l00936"></a>00936     <span class="keywordflow">return</span> <a class="code" href="../../d2/d47/compile_8c.html#a43e3134981c54d24f0e03651e0f909b6">new_insn_core</a>(iseq, line_no, insn_id, argc, operands);
<a name="l00937"></a>00937 }
<a name="l00938"></a>00938 
<a name="l00939"></a>00939 <span class="keyword">static</span> <a class="code" href="../../db/d57/structiseq__insn__data.html">INSN</a> *
<a name="l00940"></a><a class="code" href="../../d2/d47/compile_8c.html#a7714c9d8a6e9b5c48667aa7bd688a055">00940</a> <a class="code" href="../../d2/d47/compile_8c.html#a7714c9d8a6e9b5c48667aa7bd688a055">new_insn_send</a>(<a class="code" href="../../d6/de3/structrb__iseq__struct.html">rb_iseq_t</a> *iseq, <span class="keywordtype">int</span> line_no,
<a name="l00941"></a>00941               <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <span class="keywordtype">id</span>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <a class="code" href="../../df/d77/ruby_8c.html#ad1447518f4372828b8435ae82e48499e">argc</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> block, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> flag)
<a name="l00942"></a>00942 {
<a name="l00943"></a>00943     <a class="code" href="../../db/d57/structiseq__insn__data.html">INSN</a> *iobj = 0;
<a name="l00944"></a>00944     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> *operands =
<a name="l00945"></a>00945       (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> *)<a class="code" href="../../d2/d47/compile_8c.html#aa24f135ae12437da748202a5329eba3e">compile_data_alloc</a>(iseq, <span class="keyword">sizeof</span>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>) * 5);
<a name="l00946"></a>00946     operands[0] = id;
<a name="l00947"></a>00947     operands[1] = argc;
<a name="l00948"></a>00948     operands[2] = block;
<a name="l00949"></a>00949     operands[3] = flag;
<a name="l00950"></a>00950     operands[4] = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a72aee3eed9e9842166e381972a35e9fb">ic_size</a>++);
<a name="l00951"></a>00951     iobj = <a class="code" href="../../d2/d47/compile_8c.html#a43e3134981c54d24f0e03651e0f909b6">new_insn_core</a>(iseq, line_no, BIN(send), 5, operands);
<a name="l00952"></a>00952     <span class="keywordflow">return</span> iobj;
<a name="l00953"></a>00953 }
<a name="l00954"></a>00954 
<a name="l00955"></a>00955 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l00956"></a><a class="code" href="../../d2/d47/compile_8c.html#aeda0c546b507efe12d49a94785b457e6">00956</a> <a class="code" href="../../d2/d47/compile_8c.html#aeda0c546b507efe12d49a94785b457e6">new_child_iseq</a>(<a class="code" href="../../d6/de3/structrb__iseq__struct.html">rb_iseq_t</a> *iseq, NODE *<a class="code" href="../../d7/dc0/parse_8y.html#a0d7af8a92c4b0a07f71585584ef9634f">node</a>,
<a name="l00957"></a>00957                <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <a class="code" href="../../d6/da0/nkf-utf8_2nkf_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> parent, <span class="keyword">enum</span> iseq_type <a class="code" href="../../d5/d9d/tcltklib_8c.html#ac765329451135abec74c45e1897abf26">type</a>, <span class="keywordtype">int</span> line_no)
<a name="l00958"></a>00958 {
<a name="l00959"></a>00959     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> ret;
<a name="l00960"></a>00960 
<a name="l00961"></a>00961     <a class="code" href="../../d2/d47/compile_8c.html#a72ae3dfc8896ca7c87ed2aed1810db43">debugs</a>(<span class="stringliteral">&quot;[new_child_iseq]&gt; ---------------------------------------\n&quot;</span>);
<a name="l00962"></a>00962     ret = <a class="code" href="../../dd/d74/iseq_8c.html#a03bb99f3d96ed9d858fb7c2e29dbe42f">rb_iseq_new_with_opt</a>(node, name, <a class="code" href="../../d2/d47/compile_8c.html#ac1566fa4c45feb883039e2de91e2ff53">iseq_filename</a>(iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a46d5fb5c3de970a9540ab85d4b060957">self</a>), <a class="code" href="../../d2/d47/compile_8c.html#abcadf20817c0ce5c74e3e7d568aef4b7">iseq_filepath</a>(iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a46d5fb5c3de970a9540ab85d4b060957">self</a>), <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(line_no),
<a name="l00963"></a>00963                                parent, type, iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a947d34698fb5a71f4938532fff27a0f7">compile_data</a>-&gt;<a class="code" href="../../d4/dd8/structiseq__compile__data.html#a3cde0c1bfeea6f8a80027a9e21a9759a">option</a>);
<a name="l00964"></a>00964     <a class="code" href="../../d2/d47/compile_8c.html#a72ae3dfc8896ca7c87ed2aed1810db43">debugs</a>(<span class="stringliteral">&quot;[new_child_iseq]&lt; ---------------------------------------\n&quot;</span>);
<a name="l00965"></a>00965     <a class="code" href="../../d2/d47/compile_8c.html#aad5c64f89a1b6d0b28c93478609a1734">iseq_add_mark_object</a>(iseq, ret);
<a name="l00966"></a>00966     <span class="keywordflow">return</span> ret;
<a name="l00967"></a>00967 }
<a name="l00968"></a>00968 
<a name="l00969"></a>00969 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l00970"></a><a class="code" href="../../d2/d47/compile_8c.html#a0c133043da590dbf81f56e44d28936e1">00970</a> <a class="code" href="../../d2/d47/compile_8c.html#a0c133043da590dbf81f56e44d28936e1">iseq_setup</a>(<a class="code" href="../../d6/de3/structrb__iseq__struct.html">rb_iseq_t</a> *iseq, <a class="code" href="../../d4/dcd/structiseq__link__anchor.html">LINK_ANCHOR</a> *anchor)
<a name="l00971"></a>00971 {
<a name="l00972"></a>00972     <span class="comment">/* debugs(&quot;[compile step 2] (iseq_array_to_linkedlist)\n&quot;); */</span>
<a name="l00973"></a>00973 
<a name="l00974"></a>00974     <span class="keywordflow">if</span> (<a class="code" href="../../d2/d47/compile_8c.html#a0c123c89fd53eedc6774ffc0b00f16dd">compile_debug</a> &gt; 5)
<a name="l00975"></a>00975         <a class="code" href="../../d2/d47/compile_8c.html#aee9a7dcbd2c223a7790c416972f221c7">dump_disasm_list</a>(<a class="code" href="../../d2/d47/compile_8c.html#a7dd2b3352ea85a0b8f87dc549b9c4f1e">FIRST_ELEMENT</a>(anchor));
<a name="l00976"></a>00976 
<a name="l00977"></a>00977     <a class="code" href="../../d2/d47/compile_8c.html#a72ae3dfc8896ca7c87ed2aed1810db43">debugs</a>(<span class="stringliteral">&quot;[compile step 3.1 (iseq_optimize)]\n&quot;</span>);
<a name="l00978"></a>00978     <a class="code" href="../../d2/d47/compile_8c.html#a9ef59376c53c601bd4c014b3ce55183e">iseq_optimize</a>(iseq, anchor);
<a name="l00979"></a>00979 
<a name="l00980"></a>00980     <span class="keywordflow">if</span> (<a class="code" href="../../d2/d47/compile_8c.html#a0c123c89fd53eedc6774ffc0b00f16dd">compile_debug</a> &gt; 5)
<a name="l00981"></a>00981         <a class="code" href="../../d2/d47/compile_8c.html#aee9a7dcbd2c223a7790c416972f221c7">dump_disasm_list</a>(<a class="code" href="../../d2/d47/compile_8c.html#a7dd2b3352ea85a0b8f87dc549b9c4f1e">FIRST_ELEMENT</a>(anchor));
<a name="l00982"></a>00982 
<a name="l00983"></a>00983     <span class="keywordflow">if</span> (iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a947d34698fb5a71f4938532fff27a0f7">compile_data</a>-&gt;<a class="code" href="../../d4/dd8/structiseq__compile__data.html#a3cde0c1bfeea6f8a80027a9e21a9759a">option</a>-&gt;<a class="code" href="../../db/dc1/structrb__compile__option__struct.html#af7b3ffcc4e463f110e82b416eae740cd">instructions_unification</a>) {
<a name="l00984"></a>00984         <a class="code" href="../../d2/d47/compile_8c.html#a72ae3dfc8896ca7c87ed2aed1810db43">debugs</a>(<span class="stringliteral">&quot;[compile step 3.2 (iseq_insns_unification)]\n&quot;</span>);
<a name="l00985"></a>00985         <a class="code" href="../../d2/d47/compile_8c.html#aa9102caf54c32a18243dbaef6b86eb03">iseq_insns_unification</a>(iseq, anchor);
<a name="l00986"></a>00986         <span class="keywordflow">if</span> (<a class="code" href="../../d2/d47/compile_8c.html#a0c123c89fd53eedc6774ffc0b00f16dd">compile_debug</a> &gt; 5)
<a name="l00987"></a>00987             <a class="code" href="../../d2/d47/compile_8c.html#aee9a7dcbd2c223a7790c416972f221c7">dump_disasm_list</a>(<a class="code" href="../../d2/d47/compile_8c.html#a7dd2b3352ea85a0b8f87dc549b9c4f1e">FIRST_ELEMENT</a>(anchor));
<a name="l00988"></a>00988     }
<a name="l00989"></a>00989 
<a name="l00990"></a>00990     <span class="keywordflow">if</span> (iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a947d34698fb5a71f4938532fff27a0f7">compile_data</a>-&gt;<a class="code" href="../../d4/dd8/structiseq__compile__data.html#a3cde0c1bfeea6f8a80027a9e21a9759a">option</a>-&gt;<a class="code" href="../../db/dc1/structrb__compile__option__struct.html#a9f889b434564170ddeb63d3b3066d976">stack_caching</a>) {
<a name="l00991"></a>00991         <a class="code" href="../../d2/d47/compile_8c.html#a72ae3dfc8896ca7c87ed2aed1810db43">debugs</a>(<span class="stringliteral">&quot;[compile step 3.3 (iseq_set_sequence_stackcaching)]\n&quot;</span>);
<a name="l00992"></a>00992         <a class="code" href="../../d2/d47/compile_8c.html#a71895fceca840260c60c4c41a44ea530">iseq_set_sequence_stackcaching</a>(iseq, anchor);
<a name="l00993"></a>00993         <span class="keywordflow">if</span> (<a class="code" href="../../d2/d47/compile_8c.html#a0c123c89fd53eedc6774ffc0b00f16dd">compile_debug</a> &gt; 5)
<a name="l00994"></a>00994             <a class="code" href="../../d2/d47/compile_8c.html#aee9a7dcbd2c223a7790c416972f221c7">dump_disasm_list</a>(<a class="code" href="../../d2/d47/compile_8c.html#a7dd2b3352ea85a0b8f87dc549b9c4f1e">FIRST_ELEMENT</a>(anchor));
<a name="l00995"></a>00995     }
<a name="l00996"></a>00996 
<a name="l00997"></a>00997     <a class="code" href="../../d2/d47/compile_8c.html#a72ae3dfc8896ca7c87ed2aed1810db43">debugs</a>(<span class="stringliteral">&quot;[compile step 4.1 (iseq_set_sequence)]\n&quot;</span>);
<a name="l00998"></a>00998     <a class="code" href="../../d2/d47/compile_8c.html#a6b63516ddd96e730781652cc59445164" title="ruby insn object list -&amp;gt; raw instruction sequence">iseq_set_sequence</a>(iseq, anchor);
<a name="l00999"></a>00999     <span class="keywordflow">if</span> (<a class="code" href="../../d2/d47/compile_8c.html#a0c123c89fd53eedc6774ffc0b00f16dd">compile_debug</a> &gt; 5)
<a name="l01000"></a>01000         <a class="code" href="../../d2/d47/compile_8c.html#aee9a7dcbd2c223a7790c416972f221c7">dump_disasm_list</a>(<a class="code" href="../../d2/d47/compile_8c.html#a7dd2b3352ea85a0b8f87dc549b9c4f1e">FIRST_ELEMENT</a>(anchor));
<a name="l01001"></a>01001 
<a name="l01002"></a>01002     <a class="code" href="../../d2/d47/compile_8c.html#a72ae3dfc8896ca7c87ed2aed1810db43">debugs</a>(<span class="stringliteral">&quot;[compile step 4.2 (iseq_set_exception_table)]\n&quot;</span>);
<a name="l01003"></a>01003     <a class="code" href="../../d2/d47/compile_8c.html#ac421ba50c875947db78307a6d6db97ef">iseq_set_exception_table</a>(iseq);
<a name="l01004"></a>01004 
<a name="l01005"></a>01005     <a class="code" href="../../d2/d47/compile_8c.html#a72ae3dfc8896ca7c87ed2aed1810db43">debugs</a>(<span class="stringliteral">&quot;[compile step 4.3 (set_optargs_table)] \n&quot;</span>);
<a name="l01006"></a>01006     <a class="code" href="../../d2/d47/compile_8c.html#a84cb808345c07d2803eb38e348193df5">iseq_set_optargs_table</a>(iseq);
<a name="l01007"></a>01007 
<a name="l01008"></a>01008     <a class="code" href="../../d2/d47/compile_8c.html#a72ae3dfc8896ca7c87ed2aed1810db43">debugs</a>(<span class="stringliteral">&quot;[compile step 5 (iseq_translate_threaded_code)] \n&quot;</span>);
<a name="l01009"></a>01009     <a class="code" href="../../d2/d47/compile_8c.html#aed84612e988053b408318de9c0a889ca">rb_iseq_translate_threaded_code</a>(iseq);
<a name="l01010"></a>01010 
<a name="l01011"></a>01011     <span class="keywordflow">if</span> (<a class="code" href="../../d2/d47/compile_8c.html#a0c123c89fd53eedc6774ffc0b00f16dd">compile_debug</a> &gt; 1) {
<a name="l01012"></a>01012         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str = <a class="code" href="../../dd/d74/iseq_8c.html#aba975c0ae1fb541cd17607c2c285f3eb">rb_iseq_disasm</a>(iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a46d5fb5c3de970a9540ab85d4b060957">self</a>);
<a name="l01013"></a>01013         printf(<span class="stringliteral">&quot;%s\n&quot;</span>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#afc32c1526ac6cb40ec33cad8782c0bae">StringValueCStr</a>(str));
<a name="l01014"></a>01014         fflush(stdout);
<a name="l01015"></a>01015     }
<a name="l01016"></a>01016     <a class="code" href="../../d2/d47/compile_8c.html#a72ae3dfc8896ca7c87ed2aed1810db43">debugs</a>(<span class="stringliteral">&quot;[compile step: finish]\n&quot;</span>);
<a name="l01017"></a>01017 
<a name="l01018"></a>01018     <span class="keywordflow">return</span> 0;
<a name="l01019"></a>01019 }
<a name="l01020"></a>01020 
<a name="l01021"></a>01021 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l01022"></a><a class="code" href="../../d2/d47/compile_8c.html#a367d6c603cd41b5c42c6c91b0b81df60">01022</a> <a class="code" href="../../d2/d47/compile_8c.html#a367d6c603cd41b5c42c6c91b0b81df60">iseq_set_exception_local_table</a>(<a class="code" href="../../d6/de3/structrb__iseq__struct.html">rb_iseq_t</a> *iseq)
<a name="l01023"></a>01023 {
<a name="l01024"></a>01024     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#afa5b9137f051ac26d7ccc8824f178233">ID</a> id_dollar_bang;
<a name="l01025"></a>01025 
<a name="l01026"></a>01026     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aa50b9d5bc665eb5545f6857c89232161">CONST_ID</a>(id_dollar_bang, <span class="stringliteral">&quot;#$!&quot;</span>);
<a name="l01027"></a>01027     iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a667787a2e393a8e2a203bf1c2442276d">local_table</a> = (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#afa5b9137f051ac26d7ccc8824f178233">ID</a> *)<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a79041aa2bc7439c11906a86f82a52eb6">ALLOC_N</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#afa5b9137f051ac26d7ccc8824f178233">ID</a>, 1);
<a name="l01028"></a>01028     iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a22ff1695f19e63e6540bc574949c55b0">local_table_size</a> = 1;
<a name="l01029"></a>01029     iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#afbae994355f91f3ea547570debb757c0">local_size</a> = iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a22ff1695f19e63e6540bc574949c55b0">local_table_size</a> + 1;
<a name="l01030"></a>01030     iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a667787a2e393a8e2a203bf1c2442276d">local_table</a>[0] = id_dollar_bang;
<a name="l01031"></a>01031     <span class="keywordflow">return</span> <a class="code" href="../../d2/d47/compile_8c.html#a652dda0d529b866959c19fe27293968e">COMPILE_OK</a>;
<a name="l01032"></a>01032 }
<a name="l01033"></a>01033 
<a name="l01034"></a>01034 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l01035"></a><a class="code" href="../../d2/d47/compile_8c.html#a1f5dac08c42b9c9f9deb62a59fcbeb90">01035</a> <a class="code" href="../../d2/d47/compile_8c.html#a1f5dac08c42b9c9f9deb62a59fcbeb90">get_dyna_var_idx_at_raw</a>(<a class="code" href="../../d6/de3/structrb__iseq__struct.html">rb_iseq_t</a> *iseq, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#afa5b9137f051ac26d7ccc8824f178233">ID</a> <span class="keywordtype">id</span>)
<a name="l01036"></a>01036 {
<a name="l01037"></a>01037     <span class="keywordtype">int</span> i;
<a name="l01038"></a>01038 
<a name="l01039"></a>01039     <span class="keywordflow">for</span> (i = 0; i &lt; iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a22ff1695f19e63e6540bc574949c55b0">local_table_size</a>; i++) {
<a name="l01040"></a>01040         <span class="keywordflow">if</span> (iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a667787a2e393a8e2a203bf1c2442276d">local_table</a>[i] == <span class="keywordtype">id</span>) {
<a name="l01041"></a>01041             <span class="keywordflow">return</span> i;
<a name="l01042"></a>01042         }
<a name="l01043"></a>01043     }
<a name="l01044"></a>01044     <span class="keywordflow">return</span> -1;
<a name="l01045"></a>01045 }
<a name="l01046"></a>01046 
<a name="l01047"></a>01047 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l01048"></a><a class="code" href="../../d2/d47/compile_8c.html#a96a61ad19fe487bd51c13a2a4b151994">01048</a> <a class="code" href="../../d2/d47/compile_8c.html#a96a61ad19fe487bd51c13a2a4b151994">get_local_var_idx</a>(<a class="code" href="../../d6/de3/structrb__iseq__struct.html">rb_iseq_t</a> *iseq, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#afa5b9137f051ac26d7ccc8824f178233">ID</a> <span class="keywordtype">id</span>)
<a name="l01049"></a>01049 {
<a name="l01050"></a>01050     <span class="keywordtype">int</span> idx = <a class="code" href="../../d2/d47/compile_8c.html#a1f5dac08c42b9c9f9deb62a59fcbeb90">get_dyna_var_idx_at_raw</a>(iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a0f5705507c4c80bc69c3f031dd0daae9">local_iseq</a>, <span class="keywordtype">id</span>);
<a name="l01051"></a>01051 
<a name="l01052"></a>01052     <span class="keywordflow">if</span> (idx &lt; 0) {
<a name="l01053"></a>01053         <a class="code" href="../../db/dcc/error_8c.html#a2d5fb28e54f792e7341b2c45f52f3860">rb_bug</a>(<span class="stringliteral">&quot;get_local_var_idx: %d&quot;</span>, idx);
<a name="l01054"></a>01054     }
<a name="l01055"></a>01055 
<a name="l01056"></a>01056     <span class="keywordflow">return</span> idx;
<a name="l01057"></a>01057 }
<a name="l01058"></a>01058 
<a name="l01059"></a>01059 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l01060"></a><a class="code" href="../../d2/d47/compile_8c.html#a0bdb81b7c6cece8636831256b2f5acef">01060</a> <a class="code" href="../../d2/d47/compile_8c.html#a0bdb81b7c6cece8636831256b2f5acef">get_dyna_var_idx</a>(<a class="code" href="../../d6/de3/structrb__iseq__struct.html">rb_iseq_t</a> *iseq, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#afa5b9137f051ac26d7ccc8824f178233">ID</a> <span class="keywordtype">id</span>, <span class="keywordtype">int</span> *level, <span class="keywordtype">int</span> *ls)
<a name="l01061"></a>01061 {
<a name="l01062"></a>01062     <span class="keywordtype">int</span> lv = 0, idx = -1;
<a name="l01063"></a>01063 
<a name="l01064"></a>01064     <span class="keywordflow">while</span> (iseq) {
<a name="l01065"></a>01065         idx = <a class="code" href="../../d2/d47/compile_8c.html#a1f5dac08c42b9c9f9deb62a59fcbeb90">get_dyna_var_idx_at_raw</a>(iseq, <span class="keywordtype">id</span>);
<a name="l01066"></a>01066         <span class="keywordflow">if</span> (idx &gt;= 0) {
<a name="l01067"></a>01067             <span class="keywordflow">break</span>;
<a name="l01068"></a>01068         }
<a name="l01069"></a>01069         iseq = iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#afce02da209c0bf9a09ef4ea0af68e623">parent_iseq</a>;
<a name="l01070"></a>01070         lv++;
<a name="l01071"></a>01071     }
<a name="l01072"></a>01072 
<a name="l01073"></a>01073     <span class="keywordflow">if</span> (idx &lt; 0) {
<a name="l01074"></a>01074         <a class="code" href="../../db/dcc/error_8c.html#a2d5fb28e54f792e7341b2c45f52f3860">rb_bug</a>(<span class="stringliteral">&quot;get_dyna_var_idx: -1&quot;</span>);
<a name="l01075"></a>01075     }
<a name="l01076"></a>01076 
<a name="l01077"></a>01077     *level = lv;
<a name="l01078"></a>01078     *ls = iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#afbae994355f91f3ea547570debb757c0">local_size</a>;
<a name="l01079"></a>01079     <span class="keywordflow">return</span> idx;
<a name="l01080"></a>01080 }
<a name="l01081"></a>01081 
<a name="l01082"></a>01082 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l01083"></a><a class="code" href="../../d2/d47/compile_8c.html#a36a5c0b358003b37dd79f06d4fd1c272">01083</a> <a class="code" href="../../d2/d47/compile_8c.html#a36a5c0b358003b37dd79f06d4fd1c272">iseq_set_arguments</a>(<a class="code" href="../../d6/de3/structrb__iseq__struct.html">rb_iseq_t</a> *iseq, <a class="code" href="../../d4/dcd/structiseq__link__anchor.html">LINK_ANCHOR</a> *optargs, NODE *node_args)
<a name="l01084"></a>01084 {
<a name="l01085"></a>01085     <a class="code" href="../../d2/d47/compile_8c.html#a72ae3dfc8896ca7c87ed2aed1810db43">debugs</a>(<span class="stringliteral">&quot;iseq_set_arguments: %s\n&quot;</span>, node_args ? <span class="stringliteral">&quot;&quot;</span> : <span class="stringliteral">&quot;0&quot;</span>);
<a name="l01086"></a>01086 
<a name="l01087"></a>01087     <span class="keywordflow">if</span> (node_args) {
<a name="l01088"></a>01088         NODE *node_aux = node_args-&gt;nd_next;
<a name="l01089"></a>01089         NODE *node_opt = node_args-&gt;nd_opt;
<a name="l01090"></a>01090         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#afa5b9137f051ac26d7ccc8824f178233">ID</a> rest_id = 0;
<a name="l01091"></a>01091         <span class="keywordtype">int</span> last_comma = 0;
<a name="l01092"></a>01092         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#afa5b9137f051ac26d7ccc8824f178233">ID</a> block_id = 0;
<a name="l01093"></a>01093         NODE *node_init = 0;
<a name="l01094"></a>01094 
<a name="l01095"></a>01095         <span class="keywordflow">if</span> (<a class="code" href="../../d3/d09/ripper_8y.html#ade12c589b26f55f089dc25d689249c11">nd_type</a>(node_args) != <a class="code" href="../../d3/d09/ripper_8y.html#a18b66c00780c5dbaa65fd104893c1027">NODE_ARGS</a>) {
<a name="l01096"></a>01096             <a class="code" href="../../db/dcc/error_8c.html#a2d5fb28e54f792e7341b2c45f52f3860">rb_bug</a>(<span class="stringliteral">&quot;iseq_set_arguments: NODE_ARGS is expected, but %s&quot;</span>,
<a name="l01097"></a>01097                    <a class="code" href="../../dd/d74/iseq_8c.html#a818834c71f4a58f5bd7f0aa142d1b069">ruby_node_name</a>(<a class="code" href="../../d3/d09/ripper_8y.html#ade12c589b26f55f089dc25d689249c11">nd_type</a>(node_args)));
<a name="l01098"></a>01098         }
<a name="l01099"></a>01099 
<a name="l01100"></a>01100         <span class="comment">/*</span>
<a name="l01101"></a>01101 <span class="comment">         * new argument information:</span>
<a name="l01102"></a>01102 <span class="comment">         *   NODE_ARGS     [m: int,  o: NODE_OPT_ARG, -&gt;]</span>
<a name="l01103"></a>01103 <span class="comment">         *   NODE_ARGS_AUX [r: ID,   b: ID,           -&gt;]</span>
<a name="l01104"></a>01104 <span class="comment">         *   NODE_ARGS_AUX [Pst: id, Plen: int,       init: NODE*]</span>
<a name="l01105"></a>01105 <span class="comment">         *  optarg information:</span>
<a name="l01106"></a>01106 <span class="comment">         *   NODE_OPT_ARGS [idx,     expr,            next -&gt;]</span>
<a name="l01107"></a>01107 <span class="comment">         *  init arg:</span>
<a name="l01108"></a>01108 <span class="comment">         *   NODE_AND(m_init, p_init)</span>
<a name="l01109"></a>01109 <span class="comment">         *  if &quot;r&quot; is 1, it&apos;s means &quot;{|x,|}&quot; type block parameter.</span>
<a name="l01110"></a>01110 <span class="comment">         */</span>
<a name="l01111"></a>01111 
<a name="l01112"></a>01112         iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a5fd0acd110681eeb0f95c3b283451a0a" title="argument information">argc</a> = (int)node_args-&gt;nd_frml;
<a name="l01113"></a>01113         <a class="code" href="../../d2/d47/compile_8c.html#a72ae3dfc8896ca7c87ed2aed1810db43">debugs</a>(<span class="stringliteral">&quot;  - argc: %d\n&quot;</span>, iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a5fd0acd110681eeb0f95c3b283451a0a" title="argument information">argc</a>);
<a name="l01114"></a>01114 
<a name="l01115"></a>01115         <span class="keywordflow">if</span> (node_aux) {
<a name="l01116"></a>01116             rest_id = node_aux-&gt;nd_rest;
<a name="l01117"></a>01117             <span class="keywordflow">if</span> (rest_id == 1) {
<a name="l01118"></a>01118                 last_comma = 1;
<a name="l01119"></a>01119                 rest_id = 0;
<a name="l01120"></a>01120             }
<a name="l01121"></a>01121             block_id = (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#afa5b9137f051ac26d7ccc8824f178233">ID</a>)node_aux-&gt;nd_body;
<a name="l01122"></a>01122             node_aux = node_aux-&gt;nd_next;
<a name="l01123"></a>01123 
<a name="l01124"></a>01124             <a class="code" href="../../d7/dc0/parse_8y.html#a2ac1143ac343c79cbfa448e30d74fa1c">if</a> (node_aux) {
<a name="l01125"></a>01125                 <a class="code" href="../../de/de6/ruby_2ruby_8h.html#afa5b9137f051ac26d7ccc8824f178233">ID</a> post_start_id = node_aux-&gt;nd_pid;
<a name="l01126"></a>01126                 iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a6250a263c2402b28f97ae50ef9b4e458">arg_post_start</a> = <a class="code" href="../../d2/d47/compile_8c.html#a1f5dac08c42b9c9f9deb62a59fcbeb90">get_dyna_var_idx_at_raw</a>(iseq, post_start_id);
<a name="l01127"></a>01127                 iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a4915a4238c8e8e7106337e5e1c609576">arg_post_len</a> = (int)node_aux-&gt;nd_plen;
<a name="l01128"></a>01128                 node_init = node_aux-&gt;nd_next;
<a name="l01129"></a>01129             }
<a name="l01130"></a>01130         }
<a name="l01131"></a>01131 
<a name="l01132"></a>01132         <span class="keywordflow">if</span> (node_opt) {
<a name="l01133"></a>01133             NODE *<a class="code" href="../../d7/dc0/parse_8y.html#a0d7af8a92c4b0a07f71585584ef9634f">node</a> = node_opt;
<a name="l01134"></a>01134             <a class="code" href="../../d8/dc5/structiseq__label__data.html">LABEL</a> *label;
<a name="l01135"></a>01135             <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> labels = <a class="code" href="../../dc/dcc/array_8c.html#aaf7e3ca42191580b60f398d5ec466766">rb_ary_tmp_new</a>(1);
<a name="l01136"></a>01136             <span class="keywordtype">int</span> i = 0, j;
<a name="l01137"></a>01137 
<a name="l01138"></a>01138             <span class="keywordflow">while</span> (node) {
<a name="l01139"></a>01139                 label = <a class="code" href="../../d2/d47/compile_8c.html#a1d6d5d8dac7aff9ac863255a0905c0f9">NEW_LABEL</a>(<a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node));
<a name="l01140"></a>01140                 <a class="code" href="../../dc/dcc/array_8c.html#a59d553a8cd781364b8bcb0deae25cca2">rb_ary_push</a>(labels, (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>)label | 1);
<a name="l01141"></a>01141                 <a class="code" href="../../d2/d47/compile_8c.html#a5a380bb449656575d6b77ccb8eb7e5ae">ADD_LABEL</a>(optargs, label);
<a name="l01142"></a>01142                 <a class="code" href="../../d2/d47/compile_8c.html#a4e7115fce9f91ee84931798cc3474229">COMPILE_POPED</a>(optargs, <span class="stringliteral">&quot;optarg&quot;</span>, node-&gt;nd_body);
<a name="l01143"></a>01143                 node = node-&gt;nd_next;
<a name="l01144"></a>01144                 i += 1;
<a name="l01145"></a>01145             }
<a name="l01146"></a>01146 
<a name="l01147"></a>01147             <span class="comment">/* last label */</span>
<a name="l01148"></a>01148             label = <a class="code" href="../../d2/d47/compile_8c.html#a1d6d5d8dac7aff9ac863255a0905c0f9">NEW_LABEL</a>(<a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node_args));
<a name="l01149"></a>01149             <a class="code" href="../../dc/dcc/array_8c.html#a59d553a8cd781364b8bcb0deae25cca2">rb_ary_push</a>(labels, (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>)label | 1);
<a name="l01150"></a>01150             <a class="code" href="../../d2/d47/compile_8c.html#a5a380bb449656575d6b77ccb8eb7e5ae">ADD_LABEL</a>(optargs, label);
<a name="l01151"></a>01151             i += 1;
<a name="l01152"></a>01152 
<a name="l01153"></a>01153             iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#ad71990c5fa4c678e369e18bddbaf1639">arg_opts</a> = i;
<a name="l01154"></a>01154             iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a5fa1e846aadb503610b7b2ce0ad643d9">arg_opt_table</a> = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a79041aa2bc7439c11906a86f82a52eb6">ALLOC_N</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>, i);
<a name="l01155"></a>01155             <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a04ab67335215e8362c63ed27ae2d1c40">MEMCPY</a>(iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a5fa1e846aadb503610b7b2ce0ad643d9">arg_opt_table</a>, <a class="code" href="../../d8/df4/generator_8h.html#abb794fe2d7c73eea87e7ba2273939a8e">RARRAY_PTR</a>(labels), <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>, i);
<a name="l01156"></a>01156             <span class="keywordflow">for</span> (j = 0; j &lt; i; j++) {
<a name="l01157"></a>01157                 iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a5fa1e846aadb503610b7b2ce0ad643d9">arg_opt_table</a>[j] &amp;= ~1;
<a name="l01158"></a>01158             }
<a name="l01159"></a>01159             <a class="code" href="../../dc/dcc/array_8c.html#aaf8c74d0eef61073fadf2c631fa9540f">rb_ary_clear</a>(labels);
<a name="l01160"></a>01160         }
<a name="l01161"></a>01161         <span class="keywordflow">else</span> {
<a name="l01162"></a>01162             iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#ad71990c5fa4c678e369e18bddbaf1639">arg_opts</a> = 0;
<a name="l01163"></a>01163         }
<a name="l01164"></a>01164 
<a name="l01165"></a>01165         <span class="keywordflow">if</span> (node_init) {
<a name="l01166"></a>01166             <span class="keywordflow">if</span> (node_init-&gt;nd_1st) { <span class="comment">/* m_init */</span>
<a name="l01167"></a>01167                 <a class="code" href="../../d2/d47/compile_8c.html#a4e7115fce9f91ee84931798cc3474229">COMPILE_POPED</a>(optargs, <span class="stringliteral">&quot;init arguments (m)&quot;</span>, node_init-&gt;nd_1st);
<a name="l01168"></a>01168             }
<a name="l01169"></a>01169             <span class="keywordflow">if</span> (node_init-&gt;nd_2nd) { <span class="comment">/* p_init */</span>
<a name="l01170"></a>01170                 <a class="code" href="../../d2/d47/compile_8c.html#a4e7115fce9f91ee84931798cc3474229">COMPILE_POPED</a>(optargs, <span class="stringliteral">&quot;init arguments (p)&quot;</span>, node_init-&gt;nd_2nd);
<a name="l01171"></a>01171             }
<a name="l01172"></a>01172         }
<a name="l01173"></a>01173 
<a name="l01174"></a>01174         <span class="keywordflow">if</span> (rest_id) {
<a name="l01175"></a>01175             iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a21bd6b9b1c875df9484cc16f8dd9c73e">arg_rest</a> = <a class="code" href="../../d2/d47/compile_8c.html#a1f5dac08c42b9c9f9deb62a59fcbeb90">get_dyna_var_idx_at_raw</a>(iseq, rest_id);
<a name="l01176"></a>01176 
<a name="l01177"></a>01177             <span class="keywordflow">if</span> (iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a21bd6b9b1c875df9484cc16f8dd9c73e">arg_rest</a> == -1) {
<a name="l01178"></a>01178                 <a class="code" href="../../db/dcc/error_8c.html#a2d5fb28e54f792e7341b2c45f52f3860">rb_bug</a>(<span class="stringliteral">&quot;arg_rest: -1&quot;</span>);
<a name="l01179"></a>01179             }
<a name="l01180"></a>01180 
<a name="l01181"></a>01181             <span class="keywordflow">if</span> (iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a6250a263c2402b28f97ae50ef9b4e458">arg_post_start</a> == 0) {
<a name="l01182"></a>01182                 iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a6250a263c2402b28f97ae50ef9b4e458">arg_post_start</a> = iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a21bd6b9b1c875df9484cc16f8dd9c73e">arg_rest</a> + 1;
<a name="l01183"></a>01183             }
<a name="l01184"></a>01184         }
<a name="l01185"></a>01185 
<a name="l01186"></a>01186         <span class="keywordflow">if</span> (block_id) {
<a name="l01187"></a>01187             iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a18ca49729d098ee7f25c9d3c3f0d9547">arg_block</a> = <a class="code" href="../../d2/d47/compile_8c.html#a1f5dac08c42b9c9f9deb62a59fcbeb90">get_dyna_var_idx_at_raw</a>(iseq, block_id);
<a name="l01188"></a>01188         }
<a name="l01189"></a>01189 
<a name="l01190"></a>01190         <span class="keywordflow">if</span> (iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#ad71990c5fa4c678e369e18bddbaf1639">arg_opts</a> != 0 || iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a4915a4238c8e8e7106337e5e1c609576">arg_post_len</a> != 0 ||
<a name="l01191"></a>01191             iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a21bd6b9b1c875df9484cc16f8dd9c73e">arg_rest</a> != -1 || iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a18ca49729d098ee7f25c9d3c3f0d9547">arg_block</a> != -1) {
<a name="l01192"></a>01192             iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#ae7f7a6daa388dc65f83c27600cb39b00">arg_simple</a> = 0;
<a name="l01193"></a>01193 
<a name="l01194"></a>01194             <span class="comment">/* set arg_size: size of arguments */</span>
<a name="l01195"></a>01195             <span class="keywordflow">if</span> (iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a18ca49729d098ee7f25c9d3c3f0d9547">arg_block</a> != -1) {
<a name="l01196"></a>01196                 iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#abd2b67e0dffb2262ab272a67bbe747d6">arg_size</a> = iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a18ca49729d098ee7f25c9d3c3f0d9547">arg_block</a> + 1;
<a name="l01197"></a>01197             }
<a name="l01198"></a>01198             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a4915a4238c8e8e7106337e5e1c609576">arg_post_len</a>) {
<a name="l01199"></a>01199                 iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#abd2b67e0dffb2262ab272a67bbe747d6">arg_size</a> = iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a6250a263c2402b28f97ae50ef9b4e458">arg_post_start</a> + iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a4915a4238c8e8e7106337e5e1c609576">arg_post_len</a>;
<a name="l01200"></a>01200             }
<a name="l01201"></a>01201             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a21bd6b9b1c875df9484cc16f8dd9c73e">arg_rest</a> != -1) {
<a name="l01202"></a>01202                 iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#abd2b67e0dffb2262ab272a67bbe747d6">arg_size</a> = iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a21bd6b9b1c875df9484cc16f8dd9c73e">arg_rest</a> + 1;
<a name="l01203"></a>01203             }
<a name="l01204"></a>01204             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#ad71990c5fa4c678e369e18bddbaf1639">arg_opts</a>) {
<a name="l01205"></a>01205                 iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#abd2b67e0dffb2262ab272a67bbe747d6">arg_size</a> = iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a5fd0acd110681eeb0f95c3b283451a0a" title="argument information">argc</a> + iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#ad71990c5fa4c678e369e18bddbaf1639">arg_opts</a> - 1;
<a name="l01206"></a>01206             }
<a name="l01207"></a>01207             <span class="keywordflow">else</span> {
<a name="l01208"></a>01208                 iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#abd2b67e0dffb2262ab272a67bbe747d6">arg_size</a> = iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a5fd0acd110681eeb0f95c3b283451a0a" title="argument information">argc</a>;
<a name="l01209"></a>01209             }
<a name="l01210"></a>01210         }
<a name="l01211"></a>01211         <span class="keywordflow">else</span> {
<a name="l01212"></a>01212             iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#ae7f7a6daa388dc65f83c27600cb39b00">arg_simple</a> = 1;
<a name="l01213"></a>01213             iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#abd2b67e0dffb2262ab272a67bbe747d6">arg_size</a> = iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a5fd0acd110681eeb0f95c3b283451a0a" title="argument information">argc</a>;
<a name="l01214"></a>01214         }
<a name="l01215"></a>01215 
<a name="l01216"></a>01216         <span class="keywordflow">if</span> (iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#af8bc7dbae6f61d836b5bb9fb50b6cfb8">type</a> == ISEQ_TYPE_BLOCK) {
<a name="l01217"></a>01217             <span class="keywordflow">if</span> (iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#ad71990c5fa4c678e369e18bddbaf1639">arg_opts</a> == 0 &amp;&amp; iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a4915a4238c8e8e7106337e5e1c609576">arg_post_len</a> == 0 &amp;&amp; iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a21bd6b9b1c875df9484cc16f8dd9c73e">arg_rest</a> == -1) {
<a name="l01218"></a>01218                 <span class="keywordflow">if</span> (iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a5fd0acd110681eeb0f95c3b283451a0a" title="argument information">argc</a> == 1 &amp;&amp; last_comma == 0) {
<a name="l01219"></a>01219                     <span class="comment">/* {|a|} */</span>
<a name="l01220"></a>01220                     iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#ae7f7a6daa388dc65f83c27600cb39b00">arg_simple</a> |= 0x02;
<a name="l01221"></a>01221                 }
<a name="l01222"></a>01222             }
<a name="l01223"></a>01223         }
<a name="l01224"></a>01224     }
<a name="l01225"></a>01225     <span class="keywordflow">else</span> {
<a name="l01226"></a>01226         iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#ae7f7a6daa388dc65f83c27600cb39b00">arg_simple</a> = 1;
<a name="l01227"></a>01227     }
<a name="l01228"></a>01228 
<a name="l01229"></a>01229     <span class="keywordflow">return</span> <a class="code" href="../../d2/d47/compile_8c.html#a652dda0d529b866959c19fe27293968e">COMPILE_OK</a>;
<a name="l01230"></a>01230 }
<a name="l01231"></a>01231 
<a name="l01232"></a>01232 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l01233"></a><a class="code" href="../../d2/d47/compile_8c.html#ab1764a6e5bad41b6e9223b512c674cf4">01233</a> <a class="code" href="../../d2/d47/compile_8c.html#ab1764a6e5bad41b6e9223b512c674cf4">iseq_set_local_table</a>(<a class="code" href="../../d6/de3/structrb__iseq__struct.html">rb_iseq_t</a> *iseq, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#afa5b9137f051ac26d7ccc8824f178233">ID</a> *tbl)
<a name="l01234"></a>01234 {
<a name="l01235"></a>01235     <span class="keywordtype">int</span> size;
<a name="l01236"></a>01236 
<a name="l01237"></a>01237     <span class="keywordflow">if</span> (tbl) {
<a name="l01238"></a>01238         size = (int)*tbl;
<a name="l01239"></a>01239         tbl++;
<a name="l01240"></a>01240     }
<a name="l01241"></a>01241     <span class="keywordflow">else</span> {
<a name="l01242"></a>01242         size = 0;
<a name="l01243"></a>01243     }
<a name="l01244"></a>01244 
<a name="l01245"></a>01245     <span class="keywordflow">if</span> (size &gt; 0) {
<a name="l01246"></a>01246         iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a667787a2e393a8e2a203bf1c2442276d">local_table</a> = (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#afa5b9137f051ac26d7ccc8824f178233">ID</a> *)<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a79041aa2bc7439c11906a86f82a52eb6">ALLOC_N</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#afa5b9137f051ac26d7ccc8824f178233">ID</a>, size);
<a name="l01247"></a>01247         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a04ab67335215e8362c63ed27ae2d1c40">MEMCPY</a>(iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a667787a2e393a8e2a203bf1c2442276d">local_table</a>, tbl, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#afa5b9137f051ac26d7ccc8824f178233">ID</a>, size);
<a name="l01248"></a>01248     }
<a name="l01249"></a>01249 
<a name="l01250"></a>01250     iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#afbae994355f91f3ea547570debb757c0">local_size</a> = iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a22ff1695f19e63e6540bc574949c55b0">local_table_size</a> = size;
<a name="l01251"></a>01251     iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#afbae994355f91f3ea547570debb757c0">local_size</a> += 1;
<a name="l01252"></a>01252     <span class="comment">/*</span>
<a name="l01253"></a>01253 <span class="comment">      if (lfp == dfp ) { // top, class, method</span>
<a name="l01254"></a>01254 <span class="comment">          dfp[-1]: svar</span>
<a name="l01255"></a>01255 <span class="comment">      else {             // block</span>
<a name="l01256"></a>01256 <span class="comment">          dfp[-1]: cref</span>
<a name="l01257"></a>01257 <span class="comment">      }</span>
<a name="l01258"></a>01258 <span class="comment">     */</span>
<a name="l01259"></a>01259 
<a name="l01260"></a>01260     <a class="code" href="../../d2/d47/compile_8c.html#a72ae3dfc8896ca7c87ed2aed1810db43">debugs</a>(<span class="stringliteral">&quot;iseq_set_local_table: %d, %d\n&quot;</span>, iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#afbae994355f91f3ea547570debb757c0">local_size</a>, iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a22ff1695f19e63e6540bc574949c55b0">local_table_size</a>);
<a name="l01261"></a>01261     <span class="keywordflow">return</span> <a class="code" href="../../d2/d47/compile_8c.html#a652dda0d529b866959c19fe27293968e">COMPILE_OK</a>;
<a name="l01262"></a>01262 }
<a name="l01263"></a>01263 
<a name="l01264"></a>01264 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l01265"></a><a class="code" href="../../d2/d47/compile_8c.html#af883422fa9761dca4a421816775014fe">01265</a> <a class="code" href="../../d2/d47/compile_8c.html#af883422fa9761dca4a421816775014fe">cdhash_cmp</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> val, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> lit)
<a name="l01266"></a>01266 {
<a name="l01267"></a>01267     <span class="keywordflow">if</span> (val == lit) <span class="keywordflow">return</span> 0;
<a name="l01268"></a>01268     <span class="keywordflow">if</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac59489a7ed093e29019047d13e79c009">SPECIAL_CONST_P</a>(lit)) {
<a name="l01269"></a>01269         <span class="keywordflow">return</span> val != lit;
<a name="l01270"></a>01270     }
<a name="l01271"></a>01271     <span class="keywordflow">if</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac59489a7ed093e29019047d13e79c009">SPECIAL_CONST_P</a>(val) || <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aee74f540353cd2d77d1cb37a3714bd7d">BUILTIN_TYPE</a>(val) != <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aee74f540353cd2d77d1cb37a3714bd7d">BUILTIN_TYPE</a>(lit)) {
<a name="l01272"></a>01272         <span class="keywordflow">return</span> -1;
<a name="l01273"></a>01273     }
<a name="l01274"></a>01274     <span class="keywordflow">if</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#aee74f540353cd2d77d1cb37a3714bd7d">BUILTIN_TYPE</a>(lit) == <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a22a8c2a4bbaae9b68f65c9bb92fd4e39">T_STRING</a>) {
<a name="l01275"></a>01275         <span class="keywordflow">return</span> <a class="code" href="../../db/d2e/intern_8h.html#abff17b0baeb7275f49e3bd417aec866f">rb_str_hash_cmp</a>(lit, val);
<a name="l01276"></a>01276     }
<a name="l01277"></a>01277     <span class="keywordflow">return</span> !<a class="code" href="../../db/d2e/intern_8h.html#a180c7fb8680438a968a03f26cfb7b542">rb_eql</a>(lit, val);
<a name="l01278"></a>01278 }
<a name="l01279"></a>01279 
<a name="l01280"></a>01280 <span class="keyword">static</span> <a class="code" href="../../dd/d24/st_8h.html#ac214e5cdcf0de6a2108b9643e7fc12e0">st_index_t</a>
<a name="l01281"></a><a class="code" href="../../d2/d47/compile_8c.html#a550f18e1fa19ff1de47cd4fe3053bfe4">01281</a> <a class="code" href="../../d2/d47/compile_8c.html#a550f18e1fa19ff1de47cd4fe3053bfe4">cdhash_hash</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> a)
<a name="l01282"></a>01282 {
<a name="l01283"></a>01283     <span class="keywordflow">if</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac59489a7ed093e29019047d13e79c009">SPECIAL_CONST_P</a>(a)) <span class="keywordflow">return</span> (<a class="code" href="../../dd/d24/st_8h.html#ac214e5cdcf0de6a2108b9643e7fc12e0">st_index_t</a>)a;
<a name="l01284"></a>01284     <span class="keywordflow">if</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a394faf7191f18552a20cb17ce14226f0">TYPE</a>(a) == <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a22a8c2a4bbaae9b68f65c9bb92fd4e39">T_STRING</a>) <span class="keywordflow">return</span> <a class="code" href="../../db/d2e/intern_8h.html#ae3a4b38656e45011a94975206acf7650">rb_str_hash</a>(a);
<a name="l01285"></a>01285     {
<a name="l01286"></a>01286         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> hval = <a class="code" href="../../d1/d04/hash_8c.html#ae0edcf722e6da27d2a2c9085a95f669d">rb_hash</a>(a);
<a name="l01287"></a>01287         <span class="keywordflow">return</span> (<a class="code" href="../../dd/d24/st_8h.html#ac214e5cdcf0de6a2108b9643e7fc12e0">st_index_t</a>)<a class="code" href="../../de/de6/ruby_2ruby_8h.html#ae9390780cd6d04a2e0ac3d6282cdefea">FIX2LONG</a>(hval);
<a name="l01288"></a>01288     }
<a name="l01289"></a>01289 }
<a name="l01290"></a>01290 
<a name="l01291"></a><a class="code" href="../../d2/d47/compile_8c.html#a1644328556fde38b443dd94effb5f0ab">01291</a> <span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="../../d6/d34/structst__hash__type.html">st_hash_type</a> <a class="code" href="../../d2/d47/compile_8c.html#a1644328556fde38b443dd94effb5f0ab">cdhash_type</a> = {
<a name="l01292"></a>01292     <a class="code" href="../../d2/d47/compile_8c.html#af883422fa9761dca4a421816775014fe">cdhash_cmp</a>,
<a name="l01293"></a>01293     <a class="code" href="../../d2/d47/compile_8c.html#a550f18e1fa19ff1de47cd4fe3053bfe4">cdhash_hash</a>,
<a name="l01294"></a>01294 };
<a name="l01295"></a>01295 
<a name="l01299"></a>01299 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l01300"></a><a class="code" href="../../d2/d47/compile_8c.html#a6b63516ddd96e730781652cc59445164">01300</a> <a class="code" href="../../d2/d47/compile_8c.html#a6b63516ddd96e730781652cc59445164" title="ruby insn object list -&amp;gt; raw instruction sequence">iseq_set_sequence</a>(<a class="code" href="../../d6/de3/structrb__iseq__struct.html">rb_iseq_t</a> *iseq, <a class="code" href="../../d4/dcd/structiseq__link__anchor.html">LINK_ANCHOR</a> *anchor)
<a name="l01301"></a>01301 {
<a name="l01302"></a>01302     <a class="code" href="../../d8/dc5/structiseq__label__data.html">LABEL</a> *lobj;
<a name="l01303"></a>01303     <a class="code" href="../../db/d57/structiseq__insn__data.html">INSN</a> *iobj;
<a name="l01304"></a>01304     <span class="keyword">struct </span><a class="code" href="../../db/ded/structiseq__insn__info__entry.html">iseq_insn_info_entry</a> *insn_info_table;
<a name="l01305"></a>01305     <a class="code" href="../../dc/dd8/structiseq__link__element.html">LINK_ELEMENT</a> *list;
<a name="l01306"></a>01306     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> *generated_iseq;
<a name="l01307"></a>01307 
<a name="l01308"></a>01308     <span class="keywordtype">int</span> k, pos, <a class="code" href="../../db/ded/structiseq__insn__info__entry.html#ad5c851f0753cdda0b19dc5e4a7213bf3">sp</a>, stack_max = 0, line = 0;
<a name="l01309"></a>01309 
<a name="l01310"></a>01310     <span class="comment">/* set label position */</span>
<a name="l01311"></a>01311     list = <a class="code" href="../../d2/d47/compile_8c.html#a7dd2b3352ea85a0b8f87dc549b9c4f1e">FIRST_ELEMENT</a>(anchor);
<a name="l01312"></a>01312     k = pos = 0;
<a name="l01313"></a>01313     <span class="keywordflow">while</span> (list) {
<a name="l01314"></a>01314         <span class="keywordflow">switch</span> (list-&gt;<a class="code" href="../../dc/dd8/structiseq__link__element.html#a36dbc4d260432e7b26802451326ac92f">type</a>) {
<a name="l01315"></a>01315           <span class="keywordflow">case</span> ISEQ_ELEMENT_INSN:
<a name="l01316"></a>01316             {
<a name="l01317"></a>01317                 iobj = (<a class="code" href="../../db/d57/structiseq__insn__data.html">INSN</a> *)list;
<a name="l01318"></a>01318                 line = iobj-&gt;<a class="code" href="../../db/d57/structiseq__insn__data.html#a7da955a957d6555a0c0454dee8508669">line_no</a>;
<a name="l01319"></a>01319                 pos += <a class="code" href="../../d2/d47/compile_8c.html#a7023a7b2b11a4a2e586982cd2433a287">insn_data_length</a>(iobj);
<a name="l01320"></a>01320                 k++;
<a name="l01321"></a>01321                 <span class="keywordflow">break</span>;
<a name="l01322"></a>01322             }
<a name="l01323"></a>01323           <span class="keywordflow">case</span> ISEQ_ELEMENT_LABEL:
<a name="l01324"></a>01324             {
<a name="l01325"></a>01325                 lobj = (<a class="code" href="../../d8/dc5/structiseq__label__data.html">LABEL</a> *)list;
<a name="l01326"></a>01326                 lobj-&gt;<a class="code" href="../../d8/dc5/structiseq__label__data.html#abc4000df6eb58ca5faf57f9ee446b116">position</a> = pos;
<a name="l01327"></a>01327                 lobj-&gt;<a class="code" href="../../d8/dc5/structiseq__label__data.html#aac5ed967044526293b00efef682e8a66">set</a> = <a class="code" href="../../d1/d5c/nkf_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l01328"></a>01328                 <span class="keywordflow">break</span>;
<a name="l01329"></a>01329             }
<a name="l01330"></a>01330           <span class="keywordflow">case</span> ISEQ_ELEMENT_NONE:
<a name="l01331"></a>01331             {
<a name="l01332"></a>01332                 <span class="comment">/* ignore */</span>
<a name="l01333"></a>01333                 <span class="keywordflow">break</span>;
<a name="l01334"></a>01334             }
<a name="l01335"></a>01335           <span class="keywordflow">case</span> ISEQ_ELEMENT_ADJUST:
<a name="l01336"></a>01336             {
<a name="l01337"></a>01337                 <a class="code" href="../../d1/d19/structiseq__adjust__data.html">ADJUST</a> *adjust = (<a class="code" href="../../d1/d19/structiseq__adjust__data.html">ADJUST</a> *)list;
<a name="l01338"></a>01338                 <span class="keywordflow">if</span> (adjust-&gt;<a class="code" href="../../d1/d19/structiseq__adjust__data.html#acd27d315d7852871c7fb9dcb15acb438">line_no</a> != -1) {
<a name="l01339"></a>01339                     pos += 2 <span class="comment">/* insn + 1 operand */</span>;
<a name="l01340"></a>01340                     k++;
<a name="l01341"></a>01341                 }
<a name="l01342"></a>01342                 <span class="keywordflow">break</span>;
<a name="l01343"></a>01343             }
<a name="l01344"></a>01344           <span class="keywordflow">default</span>:
<a name="l01345"></a>01345             <a class="code" href="../../d2/d47/compile_8c.html#aee9a7dcbd2c223a7790c416972f221c7">dump_disasm_list</a>(<a class="code" href="../../d2/d47/compile_8c.html#a7dd2b3352ea85a0b8f87dc549b9c4f1e">FIRST_ELEMENT</a>(anchor));
<a name="l01346"></a>01346             <a class="code" href="../../d2/d47/compile_8c.html#aee9a7dcbd2c223a7790c416972f221c7">dump_disasm_list</a>(list);
<a name="l01347"></a>01347             <a class="code" href="../../d5/d11/ripper_8c.html#ac8a9e12698ddd356976669c6116abef1">rb_compile_error</a>(<a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a06859fa5de56f2ede3cb692f1d9215e2">filename</a>), line,
<a name="l01348"></a>01348                              <span class="stringliteral">&quot;error: set_sequence&quot;</span>);
<a name="l01349"></a>01349             <span class="keywordflow">break</span>;
<a name="l01350"></a>01350         }
<a name="l01351"></a>01351         list = list-&gt;<a class="code" href="../../dc/dd8/structiseq__link__element.html#aaae92b0ba47e61c8c36eba5dac082957">next</a>;
<a name="l01352"></a>01352     }
<a name="l01353"></a>01353 
<a name="l01354"></a>01354     <span class="comment">/* make instruction sequence */</span>
<a name="l01355"></a>01355     generated_iseq = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a79041aa2bc7439c11906a86f82a52eb6">ALLOC_N</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>, pos);
<a name="l01356"></a>01356     insn_info_table = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a79041aa2bc7439c11906a86f82a52eb6">ALLOC_N</a>(<span class="keyword">struct</span> <a class="code" href="../../db/ded/structiseq__insn__info__entry.html">iseq_insn_info_entry</a>, k);
<a name="l01357"></a>01357     iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#aac26bdad140f107cbf301deb3b935e2c">ic_entries</a> = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a79041aa2bc7439c11906a86f82a52eb6">ALLOC_N</a>(<span class="keyword">struct</span> <a class="code" href="../../d7/d2a/structiseq__inline__cache__entry.html">iseq_inline_cache_entry</a>, iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a72aee3eed9e9842166e381972a35e9fb">ic_size</a>);
<a name="l01358"></a>01358     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a56d620b94b668ed7665d1616b2c54e48">MEMZERO</a>(iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#aac26bdad140f107cbf301deb3b935e2c">ic_entries</a>, <span class="keyword">struct</span> <a class="code" href="../../d7/d2a/structiseq__inline__cache__entry.html">iseq_inline_cache_entry</a>, iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a72aee3eed9e9842166e381972a35e9fb">ic_size</a>);
<a name="l01359"></a>01359 
<a name="l01360"></a>01360     list = <a class="code" href="../../d2/d47/compile_8c.html#a7dd2b3352ea85a0b8f87dc549b9c4f1e">FIRST_ELEMENT</a>(anchor);
<a name="l01361"></a>01361     k = pos = sp = 0;
<a name="l01362"></a>01362 
<a name="l01363"></a>01363     <span class="keywordflow">while</span> (list) {
<a name="l01364"></a>01364         <span class="keywordflow">switch</span> (list-&gt;<a class="code" href="../../dc/dd8/structiseq__link__element.html#a36dbc4d260432e7b26802451326ac92f">type</a>) {
<a name="l01365"></a>01365           <span class="keywordflow">case</span> ISEQ_ELEMENT_INSN:
<a name="l01366"></a>01366             {
<a name="l01367"></a>01367                 <span class="keywordtype">int</span> j, <a class="code" href="../../d3/d15/name2ctype_8h.html#aed1cc4dca5d94cb452f79691f54f7423">len</a>, insn;
<a name="l01368"></a>01368                 <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d5/de2/structtypes.html">types</a>;
<a name="l01369"></a>01369                 <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> *operands;
<a name="l01370"></a>01370 
<a name="l01371"></a>01371                 iobj = (<a class="code" href="../../db/d57/structiseq__insn__data.html">INSN</a> *)list;
<a name="l01372"></a>01372 
<a name="l01373"></a>01373                 <span class="comment">/* update sp */</span>
<a name="l01374"></a>01374                 sp = <a class="code" href="../../d2/d47/compile_8c.html#a75f827592179e7c7f0ce0dcff815ee15">calc_sp_depth</a>(sp, iobj);
<a name="l01375"></a>01375                 <span class="keywordflow">if</span> (sp &gt; stack_max) {
<a name="l01376"></a>01376                     stack_max = sp;
<a name="l01377"></a>01377                 }
<a name="l01378"></a>01378 
<a name="l01379"></a>01379                 <span class="comment">/* fprintf(stderr, &quot;insn: %-16s, sp: %d\n&quot;, insn_name(iobj-&gt;insn_id), sp); */</span>
<a name="l01380"></a>01380                 operands = iobj-&gt;<a class="code" href="../../db/d57/structiseq__insn__data.html#ae83a50dd669328f4915717f99d8805c5">operands</a>;
<a name="l01381"></a>01381                 insn = iobj-&gt;<a class="code" href="../../db/d57/structiseq__insn__data.html#ab1f1e3095532dd0ece9bb256047a027e">insn_id</a>;
<a name="l01382"></a>01382                 generated_iseq[pos] = insn;
<a name="l01383"></a>01383                 types = insn_op_types(insn);
<a name="l01384"></a>01384                 len = insn_len(insn);
<a name="l01385"></a>01385 
<a name="l01386"></a>01386                 <span class="comment">/* operand check */</span>
<a name="l01387"></a>01387                 <span class="keywordflow">if</span> (iobj-&gt;<a class="code" href="../../db/d57/structiseq__insn__data.html#aec0e69fa21d100503fd6b901003b3c27">operand_size</a> != len - 1) {
<a name="l01388"></a>01388                     <span class="comment">/* printf(&quot;operand size miss! (%d, %d)\n&quot;, iobj-&gt;operand_size, len); */</span>
<a name="l01389"></a>01389                     <a class="code" href="../../d2/d47/compile_8c.html#aee9a7dcbd2c223a7790c416972f221c7">dump_disasm_list</a>(list);
<a name="l01390"></a>01390                     <a class="code" href="../../d5/d11/ripper_8c.html#ac8a9e12698ddd356976669c6116abef1">rb_compile_error</a>(<a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a06859fa5de56f2ede3cb692f1d9215e2">filename</a>), iobj-&gt;<a class="code" href="../../db/d57/structiseq__insn__data.html#a7da955a957d6555a0c0454dee8508669">line_no</a>,
<a name="l01391"></a>01391                                      <span class="stringliteral">&quot;operand size miss! (%d for %d)&quot;</span>,
<a name="l01392"></a>01392                                      iobj-&gt;<a class="code" href="../../db/d57/structiseq__insn__data.html#aec0e69fa21d100503fd6b901003b3c27">operand_size</a>, len - 1);
<a name="l01393"></a>01393                     <a class="code" href="../../d8/db0/defines_8h.html#a2c3897f7c46ca54a2e0dd7b24a40c7cb">xfree</a>(generated_iseq);
<a name="l01394"></a>01394                     <a class="code" href="../../d8/db0/defines_8h.html#a2c3897f7c46ca54a2e0dd7b24a40c7cb">xfree</a>(insn_info_table);
<a name="l01395"></a>01395                     <span class="keywordflow">return</span> 0;
<a name="l01396"></a>01396                 }
<a name="l01397"></a>01397 
<a name="l01398"></a>01398                 <span class="keywordflow">for</span> (j = 0; types[j]; j++) {
<a name="l01399"></a>01399                     <span class="keywordtype">char</span> <a class="code" href="../../d5/d9d/tcltklib_8c.html#ac765329451135abec74c45e1897abf26">type</a> = types[j];
<a name="l01400"></a>01400                     <span class="comment">/* printf(&quot;--&gt; [%c - (%d-%d)]\n&quot;, type, k, j); */</span>
<a name="l01401"></a>01401                     <span class="keywordflow">switch</span> (type) {
<a name="l01402"></a>01402                       <span class="keywordflow">case</span> TS_OFFSET:
<a name="l01403"></a>01403                         {
<a name="l01404"></a>01404                             <span class="comment">/* label(destination position) */</span>
<a name="l01405"></a>01405                             lobj = (<a class="code" href="../../d8/dc5/structiseq__label__data.html">LABEL</a> *)operands[j];
<a name="l01406"></a>01406                             <span class="keywordflow">if</span> (!lobj-&gt;<a class="code" href="../../d8/dc5/structiseq__label__data.html#aac5ed967044526293b00efef682e8a66">set</a>) {
<a name="l01407"></a>01407                                 <a class="code" href="../../d5/d11/ripper_8c.html#ac8a9e12698ddd356976669c6116abef1">rb_compile_error</a>(<a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a06859fa5de56f2ede3cb692f1d9215e2">filename</a>), iobj-&gt;<a class="code" href="../../db/d57/structiseq__insn__data.html#a7da955a957d6555a0c0454dee8508669">line_no</a>,
<a name="l01408"></a>01408                                                  <span class="stringliteral">&quot;unknown label&quot;</span>);
<a name="l01409"></a>01409                             }
<a name="l01410"></a>01410                             <span class="keywordflow">if</span> (lobj-&gt;<a class="code" href="../../d8/dc5/structiseq__label__data.html#ae4b50f2e5fc116dfc1d17ac227840e2e">sp</a> == -1) {
<a name="l01411"></a>01411                                 lobj-&gt;<a class="code" href="../../d8/dc5/structiseq__label__data.html#ae4b50f2e5fc116dfc1d17ac227840e2e">sp</a> = sp;
<a name="l01412"></a>01412                             }
<a name="l01413"></a>01413                             generated_iseq[pos + 1 + j] =
<a name="l01414"></a>01414                                 lobj-&gt;<a class="code" href="../../d8/dc5/structiseq__label__data.html#abc4000df6eb58ca5faf57f9ee446b116">position</a> - (pos + len);
<a name="l01415"></a>01415                             <span class="keywordflow">break</span>;
<a name="l01416"></a>01416                         }
<a name="l01417"></a>01417                       <span class="keywordflow">case</span> TS_CDHASH:
<a name="l01418"></a>01418                         {
<a name="l01419"></a>01419                             <span class="comment">/*</span>
<a name="l01420"></a>01420 <span class="comment">                             * [obj, label, ...]</span>
<a name="l01421"></a>01421 <span class="comment">                             */</span>
<a name="l01422"></a>01422                             <span class="keywordtype">int</span> i;
<a name="l01423"></a>01423                             <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> lits = operands[j];
<a name="l01424"></a>01424                             <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> map = <a class="code" href="../../d1/d04/hash_8c.html#af1da586524a3a1739fd5b91272037815">rb_hash_new</a>();
<a name="l01425"></a>01425                             <a class="code" href="../../d9/dee/tkutil_8c.html#ad8dd7fb0cbee1955c393251e8bb97233">RHASH_TBL</a>(map)-&gt;type = &amp;cdhash_type;
<a name="l01426"></a>01426 
<a name="l01427"></a>01427                             <span class="keywordflow">for</span> (i=0; i &lt; <a class="code" href="../../d8/df4/generator_8h.html#ae988773ed219452578f881fc7189c486">RARRAY_LEN</a>(lits); i+=2) {
<a name="l01428"></a>01428                                 <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> obj = <a class="code" href="../../dc/dcc/array_8c.html#ae3c2ac6c88e666d5418855114eb8bcf8">rb_ary_entry</a>(lits, i);
<a name="l01429"></a>01429                                 <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> lv  = <a class="code" href="../../dc/dcc/array_8c.html#ae3c2ac6c88e666d5418855114eb8bcf8">rb_ary_entry</a>(lits, i+1);
<a name="l01430"></a>01430                                 lobj = (<a class="code" href="../../d8/dc5/structiseq__label__data.html">LABEL</a> *)(lv &amp; ~1);
<a name="l01431"></a>01431 
<a name="l01432"></a>01432                                 <span class="keywordflow">if</span> (!lobj-&gt;<a class="code" href="../../d8/dc5/structiseq__label__data.html#aac5ed967044526293b00efef682e8a66">set</a>) {
<a name="l01433"></a>01433                                     <a class="code" href="../../d5/d11/ripper_8c.html#ac8a9e12698ddd356976669c6116abef1">rb_compile_error</a>(<a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a06859fa5de56f2ede3cb692f1d9215e2">filename</a>), iobj-&gt;<a class="code" href="../../db/d57/structiseq__insn__data.html#a7da955a957d6555a0c0454dee8508669">line_no</a>,
<a name="l01434"></a>01434                                                      <span class="stringliteral">&quot;unknown label&quot;</span>);
<a name="l01435"></a>01435                                 }
<a name="l01436"></a>01436                                 <span class="keywordflow">if</span> (!<a class="code" href="../../dd/d24/st_8h.html#a2d85287fbdaf7dcbc22d45e925c29fea">st_lookup</a>(<a class="code" href="../../d1/d04/hash_8c.html#a99cb756686a3ec26b1f93536ec0c8aed">rb_hash_tbl</a>(map), obj, 0)) {
<a name="l01437"></a>01437                                     <a class="code" href="../../d1/d04/hash_8c.html#ac477edf136d86a33bc06d1fbea67bb9a">rb_hash_aset</a>(map, obj, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(lobj-&gt;<a class="code" href="../../d8/dc5/structiseq__label__data.html#abc4000df6eb58ca5faf57f9ee446b116">position</a> - (pos+len)));
<a name="l01438"></a>01438                                 }
<a name="l01439"></a>01439                                 <span class="keywordflow">else</span> {
<a name="l01440"></a>01440                                     <a class="code" href="../../db/dcc/error_8c.html#ab89177d61c1d80c8e75fa0ff73addd85">rb_compile_warning</a>(<a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a06859fa5de56f2ede3cb692f1d9215e2">filename</a>), iobj-&gt;<a class="code" href="../../db/d57/structiseq__insn__data.html#a7da955a957d6555a0c0454dee8508669">line_no</a>,
<a name="l01441"></a>01441                                                        <span class="stringliteral">&quot;duplicated when clause is ignored&quot;</span>);
<a name="l01442"></a>01442                                 }
<a name="l01443"></a>01443                             }
<a name="l01444"></a>01444                             <a class="code" href="../../d2/d47/compile_8c.html#ade60ac907df6825c414be22c432ba82a">hide_obj</a>(map);
<a name="l01445"></a>01445                             generated_iseq[pos + 1 + j] = map;
<a name="l01446"></a>01446                             <a class="code" href="../../d2/d47/compile_8c.html#aad5c64f89a1b6d0b28c93478609a1734">iseq_add_mark_object</a>(iseq, map);
<a name="l01447"></a>01447                             <span class="keywordflow">break</span>;
<a name="l01448"></a>01448                         }
<a name="l01449"></a>01449                       <span class="keywordflow">case</span> TS_LINDEX:
<a name="l01450"></a>01450                       <span class="keywordflow">case</span> TS_DINDEX:
<a name="l01451"></a>01451                       <span class="keywordflow">case</span> TS_NUM:      <span class="comment">/* ulong */</span>
<a name="l01452"></a>01452                         generated_iseq[pos + 1 + j] = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a9444c431b3cb1184e7523fc572f2c758">FIX2INT</a>(operands[j]);
<a name="l01453"></a>01453                         <span class="keywordflow">break</span>;
<a name="l01454"></a>01454                       <span class="keywordflow">case</span> TS_ISEQ:     <span class="comment">/* iseq */</span>
<a name="l01455"></a>01455                         {
<a name="l01456"></a>01456                             <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> v = operands[j];
<a name="l01457"></a>01457                             <a class="code" href="../../d6/de3/structrb__iseq__struct.html">rb_iseq_t</a> *block = 0;
<a name="l01458"></a>01458                             <span class="keywordflow">if</span> (v) {
<a name="l01459"></a>01459                                 <a class="code" href="../../d8/d32/vm__core_8h.html#a5e6a3515e0ad9b9d6a4c0ab577dc50b6">GetISeqPtr</a>(v, block);
<a name="l01460"></a>01460                             }
<a name="l01461"></a>01461                             generated_iseq[pos + 1 + j] = (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>)block;
<a name="l01462"></a>01462                             <span class="keywordflow">break</span>;
<a name="l01463"></a>01463                         }
<a name="l01464"></a>01464                       <span class="keywordflow">case</span> TS_VALUE:    <span class="comment">/* VALUE */</span>
<a name="l01465"></a>01465                         {
<a name="l01466"></a>01466                             <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> v = operands[j];
<a name="l01467"></a>01467                             generated_iseq[pos + 1 + j] = v;
<a name="l01468"></a>01468                             <span class="comment">/* to mark ruby object */</span>
<a name="l01469"></a>01469                             <a class="code" href="../../d2/d47/compile_8c.html#aad5c64f89a1b6d0b28c93478609a1734">iseq_add_mark_object</a>(iseq, v);
<a name="l01470"></a>01470                             <span class="keywordflow">break</span>;
<a name="l01471"></a>01471                         }
<a name="l01472"></a>01472                       <span class="keywordflow">case</span> TS_IC: <span class="comment">/* inline cache */</span>
<a name="l01473"></a>01473                         {
<a name="l01474"></a>01474                             <span class="keywordtype">int</span> ic_index = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a9444c431b3cb1184e7523fc572f2c758">FIX2INT</a>(operands[j]);
<a name="l01475"></a>01475                             <a class="code" href="../../d7/d2a/structiseq__inline__cache__entry.html">IC</a> ic = &amp;iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#aac26bdad140f107cbf301deb3b935e2c">ic_entries</a>[ic_index];
<a name="l01476"></a>01476                             <span class="keywordflow">if</span> (<a class="code" href="../../d8/d32/vm__core_8h.html#ab10d0a221f4d7a706701b806c8135fd7">UNLIKELY</a>(ic_index &gt;= iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a72aee3eed9e9842166e381972a35e9fb">ic_size</a>)) {
<a name="l01477"></a>01477                                 <a class="code" href="../../db/dcc/error_8c.html#a2d5fb28e54f792e7341b2c45f52f3860">rb_bug</a>(<span class="stringliteral">&quot;iseq_set_sequence: ic_index overflow: index: %d, size: %d&quot;</span>,
<a name="l01478"></a>01478                                        ic_index, iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a72aee3eed9e9842166e381972a35e9fb">ic_size</a>);
<a name="l01479"></a>01479                             }
<a name="l01480"></a>01480                             generated_iseq[pos + 1 + j] = (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>)ic;
<a name="l01481"></a>01481                             <span class="keywordflow">break</span>;
<a name="l01482"></a>01482                         }
<a name="l01483"></a>01483                       <span class="keywordflow">case</span> TS_ID: <span class="comment">/* ID */</span>
<a name="l01484"></a>01484                         generated_iseq[pos + 1 + j] = <a class="code" href="../../dc/d0c/cparse_8c.html#a73ce5202e6172d3ad0bab7d1e0df9dae">SYM2ID</a>(operands[j]);
<a name="l01485"></a>01485                         <span class="keywordflow">break</span>;
<a name="l01486"></a>01486                       <span class="keywordflow">case</span> TS_GENTRY:
<a name="l01487"></a>01487                         {
<a name="l01488"></a>01488                             <span class="keyword">struct </span><a class="code" href="../../d0/d2a/variable_8c.html#a26a48bec8ff714d9e7f76d881a7d248f">rb_global_entry</a> *entry =
<a name="l01489"></a>01489                                 (<span class="keyword">struct </span><a class="code" href="../../d0/d2a/variable_8c.html#a26a48bec8ff714d9e7f76d881a7d248f">rb_global_entry</a> *)(operands[j] &amp; (~1));
<a name="l01490"></a>01490                             generated_iseq[pos + 1 + j] = (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>)entry;
<a name="l01491"></a>01491                         }
<a name="l01492"></a>01492                         <span class="keywordflow">break</span>;
<a name="l01493"></a>01493                       <span class="keywordflow">default</span>:
<a name="l01494"></a>01494                         <a class="code" href="../../d5/d11/ripper_8c.html#ac8a9e12698ddd356976669c6116abef1">rb_compile_error</a>(<a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a06859fa5de56f2ede3cb692f1d9215e2">filename</a>), iobj-&gt;<a class="code" href="../../db/d57/structiseq__insn__data.html#a7da955a957d6555a0c0454dee8508669">line_no</a>,
<a name="l01495"></a>01495                                          <span class="stringliteral">&quot;unknown operand type: %c&quot;</span>, type);
<a name="l01496"></a>01496                         <a class="code" href="../../d8/db0/defines_8h.html#a2c3897f7c46ca54a2e0dd7b24a40c7cb">xfree</a>(generated_iseq);
<a name="l01497"></a>01497                         <a class="code" href="../../d8/db0/defines_8h.html#a2c3897f7c46ca54a2e0dd7b24a40c7cb">xfree</a>(insn_info_table);
<a name="l01498"></a>01498                         <span class="keywordflow">return</span> 0;
<a name="l01499"></a>01499                     }
<a name="l01500"></a>01500                 }
<a name="l01501"></a>01501                 insn_info_table[k].<a class="code" href="../../db/ded/structiseq__insn__info__entry.html#a6d449a8f403d3452777aca050b5c97fb">line_no</a> = iobj-&gt;<a class="code" href="../../db/d57/structiseq__insn__data.html#a7da955a957d6555a0c0454dee8508669">line_no</a>;
<a name="l01502"></a>01502                 insn_info_table[k].<a class="code" href="../../db/ded/structiseq__insn__info__entry.html#ad42ccac526cf4800ca5262006d35ee26">position</a> = pos;
<a name="l01503"></a>01503                 insn_info_table[k].<a class="code" href="../../db/ded/structiseq__insn__info__entry.html#ad5c851f0753cdda0b19dc5e4a7213bf3">sp</a> = sp;
<a name="l01504"></a>01504                 pos += len;
<a name="l01505"></a>01505                 k++;
<a name="l01506"></a>01506                 <span class="keywordflow">break</span>;
<a name="l01507"></a>01507             }
<a name="l01508"></a>01508           <span class="keywordflow">case</span> ISEQ_ELEMENT_LABEL:
<a name="l01509"></a>01509             {
<a name="l01510"></a>01510                 lobj = (<a class="code" href="../../d8/dc5/structiseq__label__data.html">LABEL</a> *)list;
<a name="l01511"></a>01511                 <span class="keywordflow">if</span> (lobj-&gt;<a class="code" href="../../d8/dc5/structiseq__label__data.html#ae4b50f2e5fc116dfc1d17ac227840e2e">sp</a> == -1) {
<a name="l01512"></a>01512                     lobj-&gt;<a class="code" href="../../d8/dc5/structiseq__label__data.html#ae4b50f2e5fc116dfc1d17ac227840e2e">sp</a> = sp;
<a name="l01513"></a>01513                 }
<a name="l01514"></a>01514                 <span class="keywordflow">else</span> {
<a name="l01515"></a>01515                     sp = lobj-&gt;<a class="code" href="../../d8/dc5/structiseq__label__data.html#ae4b50f2e5fc116dfc1d17ac227840e2e">sp</a>;
<a name="l01516"></a>01516                 }
<a name="l01517"></a>01517                 <span class="keywordflow">break</span>;
<a name="l01518"></a>01518             }
<a name="l01519"></a>01519           <span class="keywordflow">case</span> ISEQ_ELEMENT_ADJUST:
<a name="l01520"></a>01520             {
<a name="l01521"></a>01521                 <a class="code" href="../../d1/d19/structiseq__adjust__data.html">ADJUST</a> *adjust = (<a class="code" href="../../d1/d19/structiseq__adjust__data.html">ADJUST</a> *)list;
<a name="l01522"></a>01522                 <span class="keywordtype">int</span> orig_sp = sp;
<a name="l01523"></a>01523 
<a name="l01524"></a>01524                 <span class="keywordflow">if</span> (adjust-&gt;<a class="code" href="../../d1/d19/structiseq__adjust__data.html#a0d755f7879e8378b46a8c3c2431fb65e">label</a>) {
<a name="l01525"></a>01525                     sp = adjust-&gt;<a class="code" href="../../d1/d19/structiseq__adjust__data.html#a0d755f7879e8378b46a8c3c2431fb65e">label</a>-&gt;<a class="code" href="../../d8/dc5/structiseq__label__data.html#ae4b50f2e5fc116dfc1d17ac227840e2e">sp</a>;
<a name="l01526"></a>01526                 }
<a name="l01527"></a>01527                 <span class="keywordflow">else</span> {
<a name="l01528"></a>01528                     sp = 0;
<a name="l01529"></a>01529                 }
<a name="l01530"></a>01530 
<a name="l01531"></a>01531                 <span class="keywordflow">if</span> (adjust-&gt;<a class="code" href="../../d1/d19/structiseq__adjust__data.html#acd27d315d7852871c7fb9dcb15acb438">line_no</a> != -1) {
<a name="l01532"></a>01532                     <span class="keywordflow">if</span> (orig_sp - sp &gt; 0) {
<a name="l01533"></a>01533                         insn_info_table[k].<a class="code" href="../../db/ded/structiseq__insn__info__entry.html#a6d449a8f403d3452777aca050b5c97fb">line_no</a> = adjust-&gt;<a class="code" href="../../d1/d19/structiseq__adjust__data.html#acd27d315d7852871c7fb9dcb15acb438">line_no</a>;
<a name="l01534"></a>01534                         insn_info_table[k].<a class="code" href="../../db/ded/structiseq__insn__info__entry.html#ad42ccac526cf4800ca5262006d35ee26">position</a> = pos;
<a name="l01535"></a>01535                         insn_info_table[k].<a class="code" href="../../db/ded/structiseq__insn__info__entry.html#ad5c851f0753cdda0b19dc5e4a7213bf3">sp</a> = sp;
<a name="l01536"></a>01536                         k++;
<a name="l01537"></a>01537                         generated_iseq[pos++] = BIN(adjuststack);
<a name="l01538"></a>01538                         generated_iseq[pos++] = orig_sp - sp;
<a name="l01539"></a>01539                     }
<a name="l01540"></a>01540                     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (orig_sp - sp == 0) {
<a name="l01541"></a>01541                         <span class="comment">/* jump to next insn */</span>
<a name="l01542"></a>01542                         insn_info_table[k].<a class="code" href="../../db/ded/structiseq__insn__info__entry.html#a6d449a8f403d3452777aca050b5c97fb">line_no</a> = adjust-&gt;<a class="code" href="../../d1/d19/structiseq__adjust__data.html#acd27d315d7852871c7fb9dcb15acb438">line_no</a>;
<a name="l01543"></a>01543                         insn_info_table[k].<a class="code" href="../../db/ded/structiseq__insn__info__entry.html#ad42ccac526cf4800ca5262006d35ee26">position</a> = pos;
<a name="l01544"></a>01544                         insn_info_table[k].<a class="code" href="../../db/ded/structiseq__insn__info__entry.html#ad5c851f0753cdda0b19dc5e4a7213bf3">sp</a> = sp;
<a name="l01545"></a>01545                         k++;
<a name="l01546"></a>01546                         generated_iseq[pos++] = BIN(jump);
<a name="l01547"></a>01547                         generated_iseq[pos++] = 0;
<a name="l01548"></a>01548                     }
<a name="l01549"></a>01549                     <span class="keywordflow">else</span> {
<a name="l01550"></a>01550                         <a class="code" href="../../db/dcc/error_8c.html#a2d5fb28e54f792e7341b2c45f52f3860">rb_bug</a>(<span class="stringliteral">&quot;iseq_set_sequence: adjust bug&quot;</span>);
<a name="l01551"></a>01551                     }
<a name="l01552"></a>01552                 }
<a name="l01553"></a>01553                 <span class="keywordflow">break</span>;
<a name="l01554"></a>01554             }
<a name="l01555"></a>01555           <span class="keywordflow">default</span>:
<a name="l01556"></a>01556             <span class="comment">/* ignore */</span>
<a name="l01557"></a>01557             <span class="keywordflow">break</span>;
<a name="l01558"></a>01558         }
<a name="l01559"></a>01559         list = list-&gt;<a class="code" href="../../dc/dd8/structiseq__link__element.html#aaae92b0ba47e61c8c36eba5dac082957">next</a>;
<a name="l01560"></a>01560     }
<a name="l01561"></a>01561 
<a name="l01562"></a>01562 <span class="preprocessor">#if 0 </span><span class="comment">/* XXX */</span>
<a name="l01563"></a>01563     <span class="comment">/* this check need dead code elimination */</span>
<a name="l01564"></a>01564     <span class="keywordflow">if</span> (sp != 1) {
<a name="l01565"></a>01565         <a class="code" href="../../db/dcc/error_8c.html#a2d5fb28e54f792e7341b2c45f52f3860">rb_bug</a>(<span class="stringliteral">&quot;SP is not 0 on %s (%d)\n&quot;</span>, <a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a35596da255ce28a5d1da94c2cc508c7d">name</a>), sp);
<a name="l01566"></a>01566     }
<a name="l01567"></a>01567 <span class="preprocessor">#endif</span>
<a name="l01568"></a>01568 <span class="preprocessor"></span>
<a name="l01569"></a>01569     iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a8699ab44e2c44e7f8df87e26a9c7bee8">iseq</a> = (<span class="keywordtype">void</span> *)generated_iseq;
<a name="l01570"></a>01570     iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a6fd527787fc64d5e9d11478af447a85f">iseq_size</a> = pos;
<a name="l01571"></a>01571     iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a7d6b0dd003b6703454061024b11481ad">insn_info_table</a> = insn_info_table;
<a name="l01572"></a>01572     iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a4f2f75b5dd56c2069139710fc684bb67">insn_info_size</a> = k;
<a name="l01573"></a>01573     iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a00494b6f5b1aa350819cad777e19eee8">stack_max</a> = stack_max;
<a name="l01574"></a>01574 
<a name="l01575"></a>01575     <span class="keywordflow">return</span> <a class="code" href="../../d2/d47/compile_8c.html#a652dda0d529b866959c19fe27293968e">COMPILE_OK</a>;
<a name="l01576"></a>01576 }
<a name="l01577"></a>01577 
<a name="l01578"></a>01578 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l01579"></a><a class="code" href="../../d2/d47/compile_8c.html#abbbe6b9d0c6d7cc8317dfef5230e21c0">01579</a> <a class="code" href="../../d2/d47/compile_8c.html#abbbe6b9d0c6d7cc8317dfef5230e21c0">label_get_position</a>(<a class="code" href="../../d8/dc5/structiseq__label__data.html">LABEL</a> *lobj)
<a name="l01580"></a>01580 {
<a name="l01581"></a>01581     <span class="keywordflow">return</span> lobj-&gt;<a class="code" href="../../d8/dc5/structiseq__label__data.html#abc4000df6eb58ca5faf57f9ee446b116">position</a>;
<a name="l01582"></a>01582 }
<a name="l01583"></a>01583 
<a name="l01584"></a>01584 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l01585"></a><a class="code" href="../../d2/d47/compile_8c.html#a64b90160a4f59b02c3dca93ce144c4af">01585</a> <a class="code" href="../../d2/d47/compile_8c.html#a64b90160a4f59b02c3dca93ce144c4af">label_get_sp</a>(<a class="code" href="../../d8/dc5/structiseq__label__data.html">LABEL</a> *lobj)
<a name="l01586"></a>01586 {
<a name="l01587"></a>01587     <span class="keywordflow">return</span> lobj-&gt;<a class="code" href="../../d8/dc5/structiseq__label__data.html#ae4b50f2e5fc116dfc1d17ac227840e2e">sp</a>;
<a name="l01588"></a>01588 }
<a name="l01589"></a>01589 
<a name="l01590"></a>01590 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l01591"></a><a class="code" href="../../d2/d47/compile_8c.html#ac421ba50c875947db78307a6d6db97ef">01591</a> <a class="code" href="../../d2/d47/compile_8c.html#ac421ba50c875947db78307a6d6db97ef">iseq_set_exception_table</a>(<a class="code" href="../../d6/de3/structrb__iseq__struct.html">rb_iseq_t</a> *iseq)
<a name="l01592"></a>01592 {
<a name="l01593"></a>01593     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> *tptr, *ptr;
<a name="l01594"></a>01594     <span class="keywordtype">int</span> tlen, i;
<a name="l01595"></a>01595     <span class="keyword">struct </span><a class="code" href="../../dc/d07/structiseq__catch__table__entry.html">iseq_catch_table_entry</a> *entry;
<a name="l01596"></a>01596 
<a name="l01597"></a>01597     tlen = (int)<a class="code" href="../../d8/df4/generator_8h.html#ae988773ed219452578f881fc7189c486">RARRAY_LEN</a>(iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a947d34698fb5a71f4938532fff27a0f7">compile_data</a>-&gt;<a class="code" href="../../d4/dd8/structiseq__compile__data.html#a58be1b1bf19723556718ac4dbbacb0ed">catch_table_ary</a>);
<a name="l01598"></a>01598     tptr = <a class="code" href="../../d8/df4/generator_8h.html#abb794fe2d7c73eea87e7ba2273939a8e">RARRAY_PTR</a>(iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a947d34698fb5a71f4938532fff27a0f7">compile_data</a>-&gt;<a class="code" href="../../d4/dd8/structiseq__compile__data.html#a58be1b1bf19723556718ac4dbbacb0ed">catch_table_ary</a>);
<a name="l01599"></a>01599 
<a name="l01600"></a>01600     iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#aaf3c6629a41865ab662884b7481fb394">catch_table</a> = tlen ? <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a79041aa2bc7439c11906a86f82a52eb6">ALLOC_N</a>(<span class="keyword">struct</span> <a class="code" href="../../dc/d07/structiseq__catch__table__entry.html">iseq_catch_table_entry</a>, tlen) : 0;
<a name="l01601"></a>01601     iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#ae1d2b9b5e2ae668e100d814f2da38ac0">catch_table_size</a> = tlen;
<a name="l01602"></a>01602 
<a name="l01603"></a>01603     <span class="keywordflow">for</span> (i = 0; i &lt; tlen; i++) {
<a name="l01604"></a>01604         ptr = <a class="code" href="../../d8/df4/generator_8h.html#abb794fe2d7c73eea87e7ba2273939a8e">RARRAY_PTR</a>(tptr[i]);
<a name="l01605"></a>01605         entry = &amp;iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#aaf3c6629a41865ab662884b7481fb394">catch_table</a>[i];
<a name="l01606"></a>01606         entry-&gt;<a class="code" href="../../dc/d07/structiseq__catch__table__entry.html#ac2b2471bbfb0ada41e777d8e1919ba00">type</a> = (<span class="keyword">enum</span> <a class="code" href="../../dd/d74/iseq_8c.html#a4e38fcb334932f17c848344875276c5d">catch_type</a>)(ptr[0] &amp; 0xffff);
<a name="l01607"></a>01607         entry-&gt;<a class="code" href="../../dc/d07/structiseq__catch__table__entry.html#a9427499a8613b4046de7b20d3153c5ab">start</a> = <a class="code" href="../../d2/d47/compile_8c.html#abbbe6b9d0c6d7cc8317dfef5230e21c0">label_get_position</a>((<a class="code" href="../../d8/dc5/structiseq__label__data.html">LABEL</a> *)(ptr[1] &amp; ~1));
<a name="l01608"></a>01608         entry-&gt;<a class="code" href="../../dc/d07/structiseq__catch__table__entry.html#af2d9fb3c5142c7e037d1405e0b7c59ae">end</a> = <a class="code" href="../../d2/d47/compile_8c.html#abbbe6b9d0c6d7cc8317dfef5230e21c0">label_get_position</a>((<a class="code" href="../../d8/dc5/structiseq__label__data.html">LABEL</a> *)(ptr[2] &amp; ~1));
<a name="l01609"></a>01609         entry-&gt;<a class="code" href="../../dc/d07/structiseq__catch__table__entry.html#a919aa1dbe534777ff38a07a17b956524">iseq</a> = ptr[3];
<a name="l01610"></a>01610 
<a name="l01611"></a>01611         <span class="comment">/* register iseq as mark object */</span>
<a name="l01612"></a>01612         <span class="keywordflow">if</span> (entry-&gt;<a class="code" href="../../dc/d07/structiseq__catch__table__entry.html#a919aa1dbe534777ff38a07a17b956524">iseq</a> != 0) {
<a name="l01613"></a>01613             <a class="code" href="../../d2/d47/compile_8c.html#aad5c64f89a1b6d0b28c93478609a1734">iseq_add_mark_object</a>(iseq, entry-&gt;<a class="code" href="../../dc/d07/structiseq__catch__table__entry.html#a919aa1dbe534777ff38a07a17b956524">iseq</a>);
<a name="l01614"></a>01614         }
<a name="l01615"></a>01615 
<a name="l01616"></a>01616         <span class="comment">/* stack depth */</span>
<a name="l01617"></a>01617         <span class="keywordflow">if</span> (ptr[4]) {
<a name="l01618"></a>01618             <a class="code" href="../../d8/dc5/structiseq__label__data.html">LABEL</a> *lobj = (<a class="code" href="../../d8/dc5/structiseq__label__data.html">LABEL</a> *)(ptr[4] &amp; ~1);
<a name="l01619"></a>01619             entry-&gt;<a class="code" href="../../dc/d07/structiseq__catch__table__entry.html#a948846a98f14e75301964e17a95afcea">cont</a> = <a class="code" href="../../d2/d47/compile_8c.html#abbbe6b9d0c6d7cc8317dfef5230e21c0">label_get_position</a>(lobj);
<a name="l01620"></a>01620             entry-&gt;<a class="code" href="../../dc/d07/structiseq__catch__table__entry.html#a0b7ff23536c8be69a62188be1a84c1d5">sp</a> = <a class="code" href="../../d2/d47/compile_8c.html#a64b90160a4f59b02c3dca93ce144c4af">label_get_sp</a>(lobj);
<a name="l01621"></a>01621 
<a name="l01622"></a>01622             <span class="comment">/* TODO: Dirty Hack!  Fix me */</span>
<a name="l01623"></a>01623             <span class="keywordflow">if</span> (entry-&gt;<a class="code" href="../../dc/d07/structiseq__catch__table__entry.html#ac2b2471bbfb0ada41e777d8e1919ba00">type</a> == <a class="code" href="../../dc/d07/structiseq__catch__table__entry.html#a1c2635a230708dfba8857a6d6509b6a1ab0479ba418aae875e074a9d1d32f77e4">CATCH_TYPE_RESCUE</a> ||
<a name="l01624"></a>01624                 entry-&gt;<a class="code" href="../../dc/d07/structiseq__catch__table__entry.html#ac2b2471bbfb0ada41e777d8e1919ba00">type</a> == <a class="code" href="../../dc/d07/structiseq__catch__table__entry.html#a1c2635a230708dfba8857a6d6509b6a1ae556eed8cf5ae82c6e44b2ee9f5bc3d7">CATCH_TYPE_BREAK</a> ||
<a name="l01625"></a>01625                 entry-&gt;<a class="code" href="../../dc/d07/structiseq__catch__table__entry.html#ac2b2471bbfb0ada41e777d8e1919ba00">type</a> == <a class="code" href="../../dc/d07/structiseq__catch__table__entry.html#a1c2635a230708dfba8857a6d6509b6a1a98ba159a92bfd8eabf0edb7381b8dcac">CATCH_TYPE_NEXT</a>) {
<a name="l01626"></a>01626                 entry-&gt;<a class="code" href="../../dc/d07/structiseq__catch__table__entry.html#a0b7ff23536c8be69a62188be1a84c1d5">sp</a>--;
<a name="l01627"></a>01627             }
<a name="l01628"></a>01628         }
<a name="l01629"></a>01629         <span class="keywordflow">else</span> {
<a name="l01630"></a>01630             entry-&gt;<a class="code" href="../../dc/d07/structiseq__catch__table__entry.html#a948846a98f14e75301964e17a95afcea">cont</a> = 0;
<a name="l01631"></a>01631         }
<a name="l01632"></a>01632     }
<a name="l01633"></a>01633 
<a name="l01634"></a>01634     iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a947d34698fb5a71f4938532fff27a0f7">compile_data</a>-&gt;<a class="code" href="../../d4/dd8/structiseq__compile__data.html#a58be1b1bf19723556718ac4dbbacb0ed">catch_table_ary</a> = 0;    <span class="comment">/* free */</span>
<a name="l01635"></a>01635     <span class="keywordflow">return</span> <a class="code" href="../../d2/d47/compile_8c.html#a652dda0d529b866959c19fe27293968e">COMPILE_OK</a>;
<a name="l01636"></a>01636 }
<a name="l01637"></a>01637 
<a name="l01638"></a>01638 <span class="comment">/*</span>
<a name="l01639"></a>01639 <span class="comment"> * set optional argument table</span>
<a name="l01640"></a>01640 <span class="comment"> *   def foo(a, b=expr1, c=expr2)</span>
<a name="l01641"></a>01641 <span class="comment"> *   =&gt;</span>
<a name="l01642"></a>01642 <span class="comment"> *    b:</span>
<a name="l01643"></a>01643 <span class="comment"> *      expr1</span>
<a name="l01644"></a>01644 <span class="comment"> *    c:</span>
<a name="l01645"></a>01645 <span class="comment"> *      expr2</span>
<a name="l01646"></a>01646 <span class="comment"> */</span>
<a name="l01647"></a>01647 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l01648"></a><a class="code" href="../../d2/d47/compile_8c.html#a84cb808345c07d2803eb38e348193df5">01648</a> <a class="code" href="../../d2/d47/compile_8c.html#a84cb808345c07d2803eb38e348193df5">iseq_set_optargs_table</a>(<a class="code" href="../../d6/de3/structrb__iseq__struct.html">rb_iseq_t</a> *<a class="code" href="../../dc/d07/structiseq__catch__table__entry.html#a919aa1dbe534777ff38a07a17b956524">iseq</a>)
<a name="l01649"></a>01649 {
<a name="l01650"></a>01650     <span class="keywordtype">int</span> i;
<a name="l01651"></a>01651 
<a name="l01652"></a>01652     <span class="keywordflow">if</span> (iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#ad71990c5fa4c678e369e18bddbaf1639">arg_opts</a> != 0) {
<a name="l01653"></a>01653         <span class="keywordflow">for</span> (i = 0; i &lt; iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#ad71990c5fa4c678e369e18bddbaf1639">arg_opts</a>; i++) {
<a name="l01654"></a>01654             iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a5fa1e846aadb503610b7b2ce0ad643d9">arg_opt_table</a>[i] =
<a name="l01655"></a>01655                 <a class="code" href="../../d2/d47/compile_8c.html#abbbe6b9d0c6d7cc8317dfef5230e21c0">label_get_position</a>((<a class="code" href="../../d8/dc5/structiseq__label__data.html">LABEL</a> *)iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a5fa1e846aadb503610b7b2ce0ad643d9">arg_opt_table</a>[i]);
<a name="l01656"></a>01656         }
<a name="l01657"></a>01657     }
<a name="l01658"></a>01658     <span class="keywordflow">return</span> <a class="code" href="../../d2/d47/compile_8c.html#a652dda0d529b866959c19fe27293968e">COMPILE_OK</a>;
<a name="l01659"></a>01659 }
<a name="l01660"></a>01660 
<a name="l01661"></a>01661 <span class="keyword">static</span> <a class="code" href="../../dc/dd8/structiseq__link__element.html">LINK_ELEMENT</a> *
<a name="l01662"></a><a class="code" href="../../d2/d47/compile_8c.html#a01ef630a2a0139a316627d6df2edef35">01662</a> <a class="code" href="../../d2/d47/compile_8c.html#a01ef630a2a0139a316627d6df2edef35">get_destination_insn</a>(<a class="code" href="../../db/d57/structiseq__insn__data.html">INSN</a> *iobj)
<a name="l01663"></a>01663 {
<a name="l01664"></a>01664     <a class="code" href="../../d8/dc5/structiseq__label__data.html">LABEL</a> *lobj = (<a class="code" href="../../d8/dc5/structiseq__label__data.html">LABEL</a> *)<a class="code" href="../../d2/d47/compile_8c.html#accd7d8e5aae40bb4eecd61fb8d6c65cc">OPERAND_AT</a>(iobj, 0);
<a name="l01665"></a>01665     <a class="code" href="../../dc/dd8/structiseq__link__element.html">LINK_ELEMENT</a> *list;
<a name="l01666"></a>01666 
<a name="l01667"></a>01667     list = lobj-&gt;<a class="code" href="../../d8/dc5/structiseq__label__data.html#abf04ba28589819eff2e67e3884a040f0">link</a>.<a class="code" href="../../dc/dd8/structiseq__link__element.html#aaae92b0ba47e61c8c36eba5dac082957">next</a>;
<a name="l01668"></a>01668     <span class="keywordflow">while</span> (list) {
<a name="l01669"></a>01669         <span class="keywordflow">if</span> (list-&gt;<a class="code" href="../../dc/dd8/structiseq__link__element.html#a36dbc4d260432e7b26802451326ac92f">type</a> == ISEQ_ELEMENT_INSN || list-&gt;<a class="code" href="../../dc/dd8/structiseq__link__element.html#a36dbc4d260432e7b26802451326ac92f">type</a> == ISEQ_ELEMENT_ADJUST) {
<a name="l01670"></a>01670             <span class="keywordflow">break</span>;
<a name="l01671"></a>01671         }
<a name="l01672"></a>01672         list = list-&gt;<a class="code" href="../../dc/dd8/structiseq__link__element.html#aaae92b0ba47e61c8c36eba5dac082957">next</a>;
<a name="l01673"></a>01673     }
<a name="l01674"></a>01674     <span class="keywordflow">return</span> list;
<a name="l01675"></a>01675 }
<a name="l01676"></a>01676 
<a name="l01677"></a>01677 <span class="keyword">static</span> <a class="code" href="../../dc/dd8/structiseq__link__element.html">LINK_ELEMENT</a> *
<a name="l01678"></a><a class="code" href="../../d2/d47/compile_8c.html#a67db739651f041c6817f67c8b51a555e">01678</a> <a class="code" href="../../d2/d47/compile_8c.html#a67db739651f041c6817f67c8b51a555e">get_next_insn</a>(<a class="code" href="../../db/d57/structiseq__insn__data.html">INSN</a> *iobj)
<a name="l01679"></a>01679 {
<a name="l01680"></a>01680     <a class="code" href="../../dc/dd8/structiseq__link__element.html">LINK_ELEMENT</a> *list = iobj-&gt;<a class="code" href="../../db/d57/structiseq__insn__data.html#aa7e061b84452f211dffd6accf084fa31">link</a>.<a class="code" href="../../dc/dd8/structiseq__link__element.html#aaae92b0ba47e61c8c36eba5dac082957">next</a>;
<a name="l01681"></a>01681 
<a name="l01682"></a>01682     <span class="keywordflow">while</span> (list) {
<a name="l01683"></a>01683         <span class="keywordflow">if</span> (list-&gt;<a class="code" href="../../dc/dd8/structiseq__link__element.html#a36dbc4d260432e7b26802451326ac92f">type</a> == ISEQ_ELEMENT_INSN || list-&gt;<a class="code" href="../../dc/dd8/structiseq__link__element.html#a36dbc4d260432e7b26802451326ac92f">type</a> == ISEQ_ELEMENT_ADJUST) {
<a name="l01684"></a>01684             <span class="keywordflow">return</span> list;
<a name="l01685"></a>01685         }
<a name="l01686"></a>01686         list = list-&gt;<a class="code" href="../../dc/dd8/structiseq__link__element.html#aaae92b0ba47e61c8c36eba5dac082957">next</a>;
<a name="l01687"></a>01687     }
<a name="l01688"></a>01688     <span class="keywordflow">return</span> 0;
<a name="l01689"></a>01689 }
<a name="l01690"></a>01690 
<a name="l01691"></a>01691 <span class="keyword">static</span> <a class="code" href="../../dc/dd8/structiseq__link__element.html">LINK_ELEMENT</a> *
<a name="l01692"></a><a class="code" href="../../d2/d47/compile_8c.html#a142de80e44ad4419dd80368456216707">01692</a> <a class="code" href="../../d2/d47/compile_8c.html#a142de80e44ad4419dd80368456216707">get_prev_insn</a>(<a class="code" href="../../db/d57/structiseq__insn__data.html">INSN</a> *iobj)
<a name="l01693"></a>01693 {
<a name="l01694"></a>01694     <a class="code" href="../../dc/dd8/structiseq__link__element.html">LINK_ELEMENT</a> *list = iobj-&gt;<a class="code" href="../../db/d57/structiseq__insn__data.html#aa7e061b84452f211dffd6accf084fa31">link</a>.<a class="code" href="../../dc/dd8/structiseq__link__element.html#a9b8195e4fd0634def4fb75be28bef536">prev</a>;
<a name="l01695"></a>01695 
<a name="l01696"></a>01696     <span class="keywordflow">while</span> (list) {
<a name="l01697"></a>01697         <span class="keywordflow">if</span> (list-&gt;<a class="code" href="../../dc/dd8/structiseq__link__element.html#a36dbc4d260432e7b26802451326ac92f">type</a> == ISEQ_ELEMENT_INSN || list-&gt;<a class="code" href="../../dc/dd8/structiseq__link__element.html#a36dbc4d260432e7b26802451326ac92f">type</a> == ISEQ_ELEMENT_ADJUST) {
<a name="l01698"></a>01698             <span class="keywordflow">return</span> list;
<a name="l01699"></a>01699         }
<a name="l01700"></a>01700         list = list-&gt;<a class="code" href="../../dc/dd8/structiseq__link__element.html#a9b8195e4fd0634def4fb75be28bef536">prev</a>;
<a name="l01701"></a>01701     }
<a name="l01702"></a>01702     <span class="keywordflow">return</span> 0;
<a name="l01703"></a>01703 }
<a name="l01704"></a>01704 
<a name="l01705"></a>01705 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l01706"></a><a class="code" href="../../d2/d47/compile_8c.html#aee047381fda74e925f077a9fdcc13474">01706</a> <a class="code" href="../../d2/d47/compile_8c.html#aee047381fda74e925f077a9fdcc13474">iseq_peephole_optimize</a>(<a class="code" href="../../d6/de3/structrb__iseq__struct.html">rb_iseq_t</a> *<a class="code" href="../../dc/d07/structiseq__catch__table__entry.html#a919aa1dbe534777ff38a07a17b956524">iseq</a>, <a class="code" href="../../dc/dd8/structiseq__link__element.html">LINK_ELEMENT</a> *list, <span class="keyword">const</span> <span class="keywordtype">int</span> do_tailcallopt)
<a name="l01707"></a>01707 {
<a name="l01708"></a>01708     <a class="code" href="../../db/d57/structiseq__insn__data.html">INSN</a> *iobj = (<a class="code" href="../../db/d57/structiseq__insn__data.html">INSN</a> *)list;
<a name="l01709"></a>01709   again:
<a name="l01710"></a>01710     <span class="keywordflow">if</span> (iobj-&gt;<a class="code" href="../../db/d57/structiseq__insn__data.html#ab1f1e3095532dd0ece9bb256047a027e">insn_id</a> == BIN(jump)) {
<a name="l01711"></a>01711         <a class="code" href="../../db/d57/structiseq__insn__data.html">INSN</a> *niobj, *diobj, *piobj;
<a name="l01712"></a>01712         <span class="comment">/*</span>
<a name="l01713"></a>01713 <span class="comment">         *  useless jump elimination:</span>
<a name="l01714"></a>01714 <span class="comment">         *     jump LABEL1</span>
<a name="l01715"></a>01715 <span class="comment">         *     ...</span>
<a name="l01716"></a>01716 <span class="comment">         *   LABEL1:</span>
<a name="l01717"></a>01717 <span class="comment">         *     jump LABEL2</span>
<a name="l01718"></a>01718 <span class="comment">         *</span>
<a name="l01719"></a>01719 <span class="comment">         *   =&gt; in this case, first jump instruction should jump to</span>
<a name="l01720"></a>01720 <span class="comment">         *      LABEL2 directly</span>
<a name="l01721"></a>01721 <span class="comment">         */</span>
<a name="l01722"></a>01722         diobj = (<a class="code" href="../../db/d57/structiseq__insn__data.html">INSN</a> *)<a class="code" href="../../d2/d47/compile_8c.html#a01ef630a2a0139a316627d6df2edef35">get_destination_insn</a>(iobj);
<a name="l01723"></a>01723         niobj = (<a class="code" href="../../db/d57/structiseq__insn__data.html">INSN</a> *)<a class="code" href="../../d2/d47/compile_8c.html#a67db739651f041c6817f67c8b51a555e">get_next_insn</a>(iobj);
<a name="l01724"></a>01724 
<a name="l01725"></a>01725         <span class="keywordflow">if</span> (diobj == niobj) {
<a name="l01726"></a>01726             <span class="comment">/*</span>
<a name="l01727"></a>01727 <span class="comment">             *   jump LABEL</span>
<a name="l01728"></a>01728 <span class="comment">             *  LABEL:</span>
<a name="l01729"></a>01729 <span class="comment">             * =&gt;</span>
<a name="l01730"></a>01730 <span class="comment">             *   LABEL:</span>
<a name="l01731"></a>01731 <span class="comment">             */</span>
<a name="l01732"></a>01732             <a class="code" href="../../d2/d47/compile_8c.html#aeb2ab21cdb1acd4dd79c5605c7db4cf5">REMOVE_ELEM</a>(&amp;iobj-&gt;<a class="code" href="../../db/d57/structiseq__insn__data.html#aa7e061b84452f211dffd6accf084fa31">link</a>);
<a name="l01733"></a>01733         }
<a name="l01734"></a>01734         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (iobj != diobj &amp;&amp; diobj-&gt;<a class="code" href="../../db/d57/structiseq__insn__data.html#ab1f1e3095532dd0ece9bb256047a027e">insn_id</a> == BIN(jump)) {
<a name="l01735"></a>01735             <span class="keywordflow">if</span> (<a class="code" href="../../d2/d47/compile_8c.html#accd7d8e5aae40bb4eecd61fb8d6c65cc">OPERAND_AT</a>(iobj, 0) != <a class="code" href="../../d2/d47/compile_8c.html#accd7d8e5aae40bb4eecd61fb8d6c65cc">OPERAND_AT</a>(diobj, 0)) {
<a name="l01736"></a>01736                 <a class="code" href="../../d2/d47/compile_8c.html#accd7d8e5aae40bb4eecd61fb8d6c65cc">OPERAND_AT</a>(iobj, 0) = <a class="code" href="../../d2/d47/compile_8c.html#accd7d8e5aae40bb4eecd61fb8d6c65cc">OPERAND_AT</a>(diobj, 0);
<a name="l01737"></a>01737                 <span class="keywordflow">goto</span> again;
<a name="l01738"></a>01738             }
<a name="l01739"></a>01739         }
<a name="l01740"></a>01740         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (diobj-&gt;<a class="code" href="../../db/d57/structiseq__insn__data.html#ab1f1e3095532dd0ece9bb256047a027e">insn_id</a> == BIN(leave)) {
<a name="l01741"></a>01741             <span class="comment">/*</span>
<a name="l01742"></a>01742 <span class="comment">             *  jump LABEL</span>
<a name="l01743"></a>01743 <span class="comment">             *  ...</span>
<a name="l01744"></a>01744 <span class="comment">             * LABEL:</span>
<a name="l01745"></a>01745 <span class="comment">             *  leave</span>
<a name="l01746"></a>01746 <span class="comment">             * =&gt;</span>
<a name="l01747"></a>01747 <span class="comment">             *  leave</span>
<a name="l01748"></a>01748 <span class="comment">             *  ...</span>
<a name="l01749"></a>01749 <span class="comment">             * LABEL:</span>
<a name="l01750"></a>01750 <span class="comment">             *  leave</span>
<a name="l01751"></a>01751 <span class="comment">             */</span>
<a name="l01752"></a>01752             <a class="code" href="../../db/d57/structiseq__insn__data.html">INSN</a> *eiobj = <a class="code" href="../../d2/d47/compile_8c.html#a43e3134981c54d24f0e03651e0f909b6">new_insn_core</a>(iseq, iobj-&gt;<a class="code" href="../../db/d57/structiseq__insn__data.html#a7da955a957d6555a0c0454dee8508669">line_no</a>, BIN(leave),
<a name="l01753"></a>01753                                         diobj-&gt;<a class="code" href="../../db/d57/structiseq__insn__data.html#aec0e69fa21d100503fd6b901003b3c27">operand_size</a>, diobj-&gt;<a class="code" href="../../db/d57/structiseq__insn__data.html#ae83a50dd669328f4915717f99d8805c5">operands</a>);
<a name="l01754"></a>01754             <a class="code" href="../../db/d57/structiseq__insn__data.html">INSN</a> *popiobj = <a class="code" href="../../d2/d47/compile_8c.html#a43e3134981c54d24f0e03651e0f909b6">new_insn_core</a>(iseq, iobj-&gt;<a class="code" href="../../db/d57/structiseq__insn__data.html#a7da955a957d6555a0c0454dee8508669">line_no</a>,
<a name="l01755"></a>01755                                           BIN(pop), 0, 0);
<a name="l01756"></a>01756             <span class="comment">/* replace */</span>
<a name="l01757"></a>01757             <a class="code" href="../../d2/d47/compile_8c.html#aeab5cc0a8fd45fad5346477d64bb70da">REPLACE_ELEM</a>((<a class="code" href="../../dc/dd8/structiseq__link__element.html">LINK_ELEMENT</a> *)iobj, (<a class="code" href="../../dc/dd8/structiseq__link__element.html">LINK_ELEMENT</a> *)eiobj);
<a name="l01758"></a>01758             <a class="code" href="../../d2/d47/compile_8c.html#a241e32e667b36f1289908561729a93e5">INSERT_ELEM_NEXT</a>((<a class="code" href="../../dc/dd8/structiseq__link__element.html">LINK_ELEMENT</a> *)eiobj, (<a class="code" href="../../dc/dd8/structiseq__link__element.html">LINK_ELEMENT</a> *)popiobj);
<a name="l01759"></a>01759             iobj = popiobj;
<a name="l01760"></a>01760         }
<a name="l01761"></a>01761         <span class="comment">/*</span>
<a name="l01762"></a>01762 <span class="comment">         * useless jump elimination (if/unless destination):</span>
<a name="l01763"></a>01763 <span class="comment">         *   if   L1</span>
<a name="l01764"></a>01764 <span class="comment">         *   jump L2</span>
<a name="l01765"></a>01765 <span class="comment">         * L1:</span>
<a name="l01766"></a>01766 <span class="comment">         *   ...</span>
<a name="l01767"></a>01767 <span class="comment">         * L2:</span>
<a name="l01768"></a>01768 <span class="comment">         *</span>
<a name="l01769"></a>01769 <span class="comment">         * ==&gt;</span>
<a name="l01770"></a>01770 <span class="comment">         *   unless L2</span>
<a name="l01771"></a>01771 <span class="comment">         * L1:</span>
<a name="l01772"></a>01772 <span class="comment">         *   ...</span>
<a name="l01773"></a>01773 <span class="comment">         * L2:</span>
<a name="l01774"></a>01774 <span class="comment">         */</span>
<a name="l01775"></a>01775         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((piobj = (<a class="code" href="../../db/d57/structiseq__insn__data.html">INSN</a> *)<a class="code" href="../../d2/d47/compile_8c.html#a142de80e44ad4419dd80368456216707">get_prev_insn</a>(iobj)) != 0 &amp;&amp;
<a name="l01776"></a>01776                  (piobj-&gt;<a class="code" href="../../db/d57/structiseq__insn__data.html#ab1f1e3095532dd0ece9bb256047a027e">insn_id</a> == BIN(branchif) ||
<a name="l01777"></a>01777                   piobj-&gt;<a class="code" href="../../db/d57/structiseq__insn__data.html#ab1f1e3095532dd0ece9bb256047a027e">insn_id</a> == BIN(branchunless))) {
<a name="l01778"></a>01778             <span class="keywordflow">if</span> (niobj == (<a class="code" href="../../db/d57/structiseq__insn__data.html">INSN</a> *)<a class="code" href="../../d2/d47/compile_8c.html#a01ef630a2a0139a316627d6df2edef35">get_destination_insn</a>(piobj)) {
<a name="l01779"></a>01779                 piobj-&gt;<a class="code" href="../../db/d57/structiseq__insn__data.html#ab1f1e3095532dd0ece9bb256047a027e">insn_id</a> = (piobj-&gt;<a class="code" href="../../db/d57/structiseq__insn__data.html#ab1f1e3095532dd0ece9bb256047a027e">insn_id</a> == BIN(branchif))
<a name="l01780"></a>01780                   ? BIN(branchunless) : BIN(branchif);
<a name="l01781"></a>01781                 <a class="code" href="../../d2/d47/compile_8c.html#accd7d8e5aae40bb4eecd61fb8d6c65cc">OPERAND_AT</a>(piobj, 0) = <a class="code" href="../../d2/d47/compile_8c.html#accd7d8e5aae40bb4eecd61fb8d6c65cc">OPERAND_AT</a>(iobj, 0);
<a name="l01782"></a>01782                 <a class="code" href="../../d2/d47/compile_8c.html#aeb2ab21cdb1acd4dd79c5605c7db4cf5">REMOVE_ELEM</a>(&amp;iobj-&gt;<a class="code" href="../../db/d57/structiseq__insn__data.html#aa7e061b84452f211dffd6accf084fa31">link</a>);
<a name="l01783"></a>01783             }
<a name="l01784"></a>01784         }
<a name="l01785"></a>01785     }
<a name="l01786"></a>01786 
<a name="l01787"></a>01787     <span class="keywordflow">if</span> (iobj-&gt;<a class="code" href="../../db/d57/structiseq__insn__data.html#ab1f1e3095532dd0ece9bb256047a027e">insn_id</a> == BIN(branchif) ||
<a name="l01788"></a>01788         iobj-&gt;<a class="code" href="../../db/d57/structiseq__insn__data.html#ab1f1e3095532dd0ece9bb256047a027e">insn_id</a> == BIN(branchunless)) {
<a name="l01789"></a>01789         <span class="comment">/*</span>
<a name="l01790"></a>01790 <span class="comment">         *   if L1</span>
<a name="l01791"></a>01791 <span class="comment">         *   ...</span>
<a name="l01792"></a>01792 <span class="comment">         * L1:</span>
<a name="l01793"></a>01793 <span class="comment">         *   jump L2</span>
<a name="l01794"></a>01794 <span class="comment">         * =&gt;</span>
<a name="l01795"></a>01795 <span class="comment">         *   if L2</span>
<a name="l01796"></a>01796 <span class="comment">         */</span>
<a name="l01797"></a>01797         <a class="code" href="../../db/d57/structiseq__insn__data.html">INSN</a> *nobj = (<a class="code" href="../../db/d57/structiseq__insn__data.html">INSN</a> *)<a class="code" href="../../d2/d47/compile_8c.html#a01ef630a2a0139a316627d6df2edef35">get_destination_insn</a>(iobj);
<a name="l01798"></a>01798         <span class="keywordflow">if</span> (nobj-&gt;<a class="code" href="../../db/d57/structiseq__insn__data.html#ab1f1e3095532dd0ece9bb256047a027e">insn_id</a> == BIN(jump)) {
<a name="l01799"></a>01799             <a class="code" href="../../d2/d47/compile_8c.html#accd7d8e5aae40bb4eecd61fb8d6c65cc">OPERAND_AT</a>(iobj, 0) = <a class="code" href="../../d2/d47/compile_8c.html#accd7d8e5aae40bb4eecd61fb8d6c65cc">OPERAND_AT</a>(nobj, 0);
<a name="l01800"></a>01800         }
<a name="l01801"></a>01801     }
<a name="l01802"></a>01802 
<a name="l01803"></a>01803     <span class="keywordflow">if</span> (do_tailcallopt &amp;&amp; iobj-&gt;<a class="code" href="../../db/d57/structiseq__insn__data.html#ab1f1e3095532dd0ece9bb256047a027e">insn_id</a> == BIN(leave)) {
<a name="l01804"></a>01804         <span class="comment">/*</span>
<a name="l01805"></a>01805 <span class="comment">         *  send ...</span>
<a name="l01806"></a>01806 <span class="comment">         *  leave</span>
<a name="l01807"></a>01807 <span class="comment">         * =&gt;</span>
<a name="l01808"></a>01808 <span class="comment">         *  send ..., ... | VM_CALL_TAILCALL_BIT, ...</span>
<a name="l01809"></a>01809 <span class="comment">         *  leave # unreachable</span>
<a name="l01810"></a>01810 <span class="comment">         */</span>
<a name="l01811"></a>01811         <a class="code" href="../../db/d57/structiseq__insn__data.html">INSN</a> *piobj = (<a class="code" href="../../db/d57/structiseq__insn__data.html">INSN</a> *)<a class="code" href="../../d2/d47/compile_8c.html#a142de80e44ad4419dd80368456216707">get_prev_insn</a>((<a class="code" href="../../db/d57/structiseq__insn__data.html">INSN</a> *)list);
<a name="l01812"></a>01812 
<a name="l01813"></a>01813         <span class="keywordflow">if</span> (piobj-&gt;<a class="code" href="../../db/d57/structiseq__insn__data.html#ab1f1e3095532dd0ece9bb256047a027e">insn_id</a> == BIN(send) &amp;&amp;
<a name="l01814"></a>01814             piobj-&gt;<a class="code" href="../../db/d57/structiseq__insn__data.html#ae83a50dd669328f4915717f99d8805c5">operands</a>[2] == 0 <span class="comment">/* block */</span>
<a name="l01815"></a>01815             ) {
<a name="l01816"></a>01816             piobj-&gt;<a class="code" href="../../db/d57/structiseq__insn__data.html#ae83a50dd669328f4915717f99d8805c5">operands</a>[3] = <a class="code" href="../../d2/d47/compile_8c.html#aeef39742c5d024aaafaab1499c58fbf1">FIXNUM_OR</a>(piobj-&gt;<a class="code" href="../../db/d57/structiseq__insn__data.html#ae83a50dd669328f4915717f99d8805c5">operands</a>[3], <a class="code" href="../../d8/d32/vm__core_8h.html#a953e325401d5eecc6c827cf5f0e66497">VM_CALL_TAILCALL_BIT</a>);
<a name="l01817"></a>01817         }
<a name="l01818"></a>01818     }
<a name="l01819"></a>01819     <span class="keywordflow">return</span> <a class="code" href="../../d2/d47/compile_8c.html#a652dda0d529b866959c19fe27293968e">COMPILE_OK</a>;
<a name="l01820"></a>01820 }
<a name="l01821"></a>01821 
<a name="l01822"></a>01822 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l01823"></a><a class="code" href="../../d2/d47/compile_8c.html#a58ef1015c4f6b685f9f7c1a11ca26945">01823</a> <a class="code" href="../../d2/d47/compile_8c.html#a58ef1015c4f6b685f9f7c1a11ca26945">insn_set_specialized_instruction</a>(<a class="code" href="../../d6/de3/structrb__iseq__struct.html">rb_iseq_t</a> *<a class="code" href="../../dc/d07/structiseq__catch__table__entry.html#a919aa1dbe534777ff38a07a17b956524">iseq</a>, <a class="code" href="../../db/d57/structiseq__insn__data.html">INSN</a> *iobj, <span class="keywordtype">int</span> insn_id)
<a name="l01824"></a>01824 {
<a name="l01825"></a>01825     <span class="keywordtype">int</span> i, old_opsize = iobj-&gt;<a class="code" href="../../db/d57/structiseq__insn__data.html#aec0e69fa21d100503fd6b901003b3c27">operand_size</a>;
<a name="l01826"></a>01826 
<a name="l01827"></a>01827     iobj-&gt;<a class="code" href="../../db/d57/structiseq__insn__data.html#ab1f1e3095532dd0ece9bb256047a027e">insn_id</a> = insn_id;
<a name="l01828"></a>01828     iobj-&gt;<a class="code" href="../../db/d57/structiseq__insn__data.html#aec0e69fa21d100503fd6b901003b3c27">operand_size</a> = insn_len(insn_id) - 1;
<a name="l01829"></a>01829     <span class="comment">/* printf(&quot;iobj-&gt;operand_size: %d\n&quot;, iobj-&gt;operand_size); */</span>
<a name="l01830"></a>01830 
<a name="l01831"></a>01831     <span class="keywordflow">if</span> (iobj-&gt;<a class="code" href="../../db/d57/structiseq__insn__data.html#aec0e69fa21d100503fd6b901003b3c27">operand_size</a> &gt; old_opsize) {
<a name="l01832"></a>01832         iobj-&gt;<a class="code" href="../../db/d57/structiseq__insn__data.html#ae83a50dd669328f4915717f99d8805c5">operands</a> = (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> *)<a class="code" href="../../d2/d47/compile_8c.html#aa24f135ae12437da748202a5329eba3e">compile_data_alloc</a>(iseq, iobj-&gt;<a class="code" href="../../db/d57/structiseq__insn__data.html#aec0e69fa21d100503fd6b901003b3c27">operand_size</a>);
<a name="l01833"></a>01833     }
<a name="l01834"></a>01834 
<a name="l01835"></a>01835     <span class="keywordflow">for</span> (i=0; i&lt;iobj-&gt;<a class="code" href="../../db/d57/structiseq__insn__data.html#aec0e69fa21d100503fd6b901003b3c27">operand_size</a>; i++) {
<a name="l01836"></a>01836         iobj-&gt;<a class="code" href="../../db/d57/structiseq__insn__data.html#ae83a50dd669328f4915717f99d8805c5">operands</a>[i] = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a72aee3eed9e9842166e381972a35e9fb">ic_size</a>++);
<a name="l01837"></a>01837     }
<a name="l01838"></a>01838 
<a name="l01839"></a>01839     <span class="keywordflow">return</span> <a class="code" href="../../d2/d47/compile_8c.html#a652dda0d529b866959c19fe27293968e">COMPILE_OK</a>;
<a name="l01840"></a>01840 }
<a name="l01841"></a>01841 
<a name="l01842"></a>01842 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l01843"></a><a class="code" href="../../d2/d47/compile_8c.html#ad3c097449b2bcae8a313e3258e9f9376">01843</a> <a class="code" href="../../d2/d47/compile_8c.html#ad3c097449b2bcae8a313e3258e9f9376">iseq_specialized_instruction</a>(<a class="code" href="../../d6/de3/structrb__iseq__struct.html">rb_iseq_t</a> *<a class="code" href="../../dc/d07/structiseq__catch__table__entry.html#a919aa1dbe534777ff38a07a17b956524">iseq</a>, <a class="code" href="../../db/d57/structiseq__insn__data.html">INSN</a> *iobj)
<a name="l01844"></a>01844 {
<a name="l01845"></a>01845     <span class="keywordflow">if</span> (iobj-&gt;<a class="code" href="../../db/d57/structiseq__insn__data.html#ab1f1e3095532dd0ece9bb256047a027e">insn_id</a> == BIN(send)) {
<a name="l01846"></a>01846         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#afa5b9137f051ac26d7ccc8824f178233">ID</a> mid = <a class="code" href="../../dc/d0c/cparse_8c.html#a73ce5202e6172d3ad0bab7d1e0df9dae">SYM2ID</a>(<a class="code" href="../../d2/d47/compile_8c.html#accd7d8e5aae40bb4eecd61fb8d6c65cc">OPERAND_AT</a>(iobj, 0));
<a name="l01847"></a>01847         <span class="keywordtype">int</span> <a class="code" href="../../df/d77/ruby_8c.html#ad1447518f4372828b8435ae82e48499e">argc</a> = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a9444c431b3cb1184e7523fc572f2c758">FIX2INT</a>(<a class="code" href="../../d2/d47/compile_8c.html#accd7d8e5aae40bb4eecd61fb8d6c65cc">OPERAND_AT</a>(iobj, 1));
<a name="l01848"></a>01848         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> block = <a class="code" href="../../d2/d47/compile_8c.html#accd7d8e5aae40bb4eecd61fb8d6c65cc">OPERAND_AT</a>(iobj, 2);
<a name="l01849"></a>01849         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> flag = <a class="code" href="../../d2/d47/compile_8c.html#accd7d8e5aae40bb4eecd61fb8d6c65cc">OPERAND_AT</a>(iobj, 3);
<a name="l01850"></a>01850 
<a name="l01851"></a>01851         <span class="comment">/* TODO: should be more sophisticated search */</span>
<a name="l01852"></a>01852         <span class="keywordflow">if</span> (block == 0 &amp;&amp; flag == <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(0)) {
<a name="l01853"></a>01853             <span class="keywordflow">if</span> (argc == 0) {
<a name="l01854"></a>01854                 <span class="keywordflow">if</span> (mid == idLength) {
<a name="l01855"></a>01855                     <a class="code" href="../../d2/d47/compile_8c.html#a58ef1015c4f6b685f9f7c1a11ca26945">insn_set_specialized_instruction</a>(iseq, iobj, BIN(opt_length));
<a name="l01856"></a>01856                 }
<a name="l01857"></a>01857                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (mid == idSize) {
<a name="l01858"></a>01858                     <a class="code" href="../../d2/d47/compile_8c.html#a58ef1015c4f6b685f9f7c1a11ca26945">insn_set_specialized_instruction</a>(iseq, iobj, BIN(opt_size));
<a name="l01859"></a>01859                 }
<a name="l01860"></a>01860                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (mid == idSucc) {
<a name="l01861"></a>01861                     <a class="code" href="../../d2/d47/compile_8c.html#a58ef1015c4f6b685f9f7c1a11ca26945">insn_set_specialized_instruction</a>(iseq, iobj, BIN(opt_succ));
<a name="l01862"></a>01862                 }
<a name="l01863"></a>01863                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (mid == <a class="code" href="../../df/db9/id_8h.html#a08dd4fbd61c5fde369edd59783f753b3a4810f05917937eb4527b87ff49c4bd53">idNot</a>) {
<a name="l01864"></a>01864                     <a class="code" href="../../d2/d47/compile_8c.html#a58ef1015c4f6b685f9f7c1a11ca26945">insn_set_specialized_instruction</a>(iseq, iobj, BIN(opt_not));
<a name="l01865"></a>01865                 }
<a name="l01866"></a>01866             }
<a name="l01867"></a>01867             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (argc == 1) {
<a name="l01868"></a>01868                 <span class="keywordflow">if</span> (0) {
<a name="l01869"></a>01869                 }
<a name="l01870"></a>01870                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (mid == <a class="code" href="../../df/db9/id_8h.html#a08dd4fbd61c5fde369edd59783f753b3a3a70189283322faaf43fe3bc9df9b990">idPLUS</a>) {
<a name="l01871"></a>01871                     <a class="code" href="../../d2/d47/compile_8c.html#a58ef1015c4f6b685f9f7c1a11ca26945">insn_set_specialized_instruction</a>(iseq, iobj, BIN(opt_plus));
<a name="l01872"></a>01872                 }
<a name="l01873"></a>01873                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (mid == <a class="code" href="../../df/db9/id_8h.html#a08dd4fbd61c5fde369edd59783f753b3a6637962b2c4eb87251df83fcbea3522b">idMINUS</a>) {
<a name="l01874"></a>01874                     <a class="code" href="../../d2/d47/compile_8c.html#a58ef1015c4f6b685f9f7c1a11ca26945">insn_set_specialized_instruction</a>(iseq, iobj, BIN(opt_minus));
<a name="l01875"></a>01875                 }
<a name="l01876"></a>01876                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (mid == <a class="code" href="../../df/db9/id_8h.html#a08dd4fbd61c5fde369edd59783f753b3ab89776b313e4e606eeb250ffad702c26">idMULT</a>) {
<a name="l01877"></a>01877                     <a class="code" href="../../d2/d47/compile_8c.html#a58ef1015c4f6b685f9f7c1a11ca26945">insn_set_specialized_instruction</a>(iseq, iobj, BIN(opt_mult));
<a name="l01878"></a>01878                 }
<a name="l01879"></a>01879                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (mid == <a class="code" href="../../df/db9/id_8h.html#a08dd4fbd61c5fde369edd59783f753b3aec9980bd030a60781ec48a327c04388a">idDIV</a>) {
<a name="l01880"></a>01880                     <a class="code" href="../../d2/d47/compile_8c.html#a58ef1015c4f6b685f9f7c1a11ca26945">insn_set_specialized_instruction</a>(iseq, iobj, BIN(opt_div));
<a name="l01881"></a>01881                 }
<a name="l01882"></a>01882                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (mid == <a class="code" href="../../df/db9/id_8h.html#a08dd4fbd61c5fde369edd59783f753b3a629b1e6b86463efcab54ac3aa1de3006">idMOD</a>) {
<a name="l01883"></a>01883                     <a class="code" href="../../d2/d47/compile_8c.html#a58ef1015c4f6b685f9f7c1a11ca26945">insn_set_specialized_instruction</a>(iseq, iobj, BIN(opt_mod));
<a name="l01884"></a>01884                 }
<a name="l01885"></a>01885                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (mid == <a class="code" href="../../df/db9/id_8h.html#a08dd4fbd61c5fde369edd59783f753b3a06b94f1faf190ec7c976ac903d0b3ac4">idEq</a>) {
<a name="l01886"></a>01886                     <a class="code" href="../../d2/d47/compile_8c.html#a58ef1015c4f6b685f9f7c1a11ca26945">insn_set_specialized_instruction</a>(iseq, iobj, BIN(opt_eq));
<a name="l01887"></a>01887                 }
<a name="l01888"></a>01888                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (mid == <a class="code" href="../../df/db9/id_8h.html#a08dd4fbd61c5fde369edd59783f753b3af618d44f33067f4a6188ab00ce2ee924">idNeq</a>) {
<a name="l01889"></a>01889                     <a class="code" href="../../d2/d47/compile_8c.html#a58ef1015c4f6b685f9f7c1a11ca26945">insn_set_specialized_instruction</a>(iseq, iobj, BIN(opt_neq));
<a name="l01890"></a>01890                 }
<a name="l01891"></a>01891                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (mid == <a class="code" href="../../df/db9/id_8h.html#a08dd4fbd61c5fde369edd59783f753b3ad60a7abbb91c20eaee6c45e279e9eeb5">idLT</a>) {
<a name="l01892"></a>01892                     <a class="code" href="../../d2/d47/compile_8c.html#a58ef1015c4f6b685f9f7c1a11ca26945">insn_set_specialized_instruction</a>(iseq, iobj, BIN(opt_lt));
<a name="l01893"></a>01893                 }
<a name="l01894"></a>01894                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (mid == <a class="code" href="../../df/db9/id_8h.html#a08dd4fbd61c5fde369edd59783f753b3ac5401419c5251b6ff5292cc9f4fa3f48">idLE</a>) {
<a name="l01895"></a>01895                     <a class="code" href="../../d2/d47/compile_8c.html#a58ef1015c4f6b685f9f7c1a11ca26945">insn_set_specialized_instruction</a>(iseq, iobj, BIN(opt_le));
<a name="l01896"></a>01896                 }
<a name="l01897"></a>01897                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (mid == <a class="code" href="../../df/db9/id_8h.html#a08dd4fbd61c5fde369edd59783f753b3a1103fc760d23adab3a172085f0f09cad">idGT</a>) {
<a name="l01898"></a>01898                     <a class="code" href="../../d2/d47/compile_8c.html#a58ef1015c4f6b685f9f7c1a11ca26945">insn_set_specialized_instruction</a>(iseq, iobj, BIN(opt_gt));
<a name="l01899"></a>01899                 }
<a name="l01900"></a>01900                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (mid == <a class="code" href="../../df/db9/id_8h.html#a08dd4fbd61c5fde369edd59783f753b3a334f4c6cf788647720c2dae42d22f2dc">idGE</a>) {
<a name="l01901"></a>01901                     <a class="code" href="../../d2/d47/compile_8c.html#a58ef1015c4f6b685f9f7c1a11ca26945">insn_set_specialized_instruction</a>(iseq, iobj, BIN(opt_ge));
<a name="l01902"></a>01902                 }
<a name="l01903"></a>01903                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (mid == <a class="code" href="../../df/db9/id_8h.html#a08dd4fbd61c5fde369edd59783f753b3ac4d87d10e3573f81b4f25928a5f0fba4">idLTLT</a>) {
<a name="l01904"></a>01904                     <a class="code" href="../../d2/d47/compile_8c.html#a58ef1015c4f6b685f9f7c1a11ca26945">insn_set_specialized_instruction</a>(iseq, iobj, BIN(opt_ltlt));
<a name="l01905"></a>01905                 }
<a name="l01906"></a>01906                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (mid == <a class="code" href="../../df/db9/id_8h.html#a08dd4fbd61c5fde369edd59783f753b3a700fe924530f27c93c81ba548682f680">idAREF</a>) {
<a name="l01907"></a>01907                     <a class="code" href="../../d2/d47/compile_8c.html#a58ef1015c4f6b685f9f7c1a11ca26945">insn_set_specialized_instruction</a>(iseq, iobj, BIN(opt_aref));
<a name="l01908"></a>01908                 }
<a name="l01909"></a>01909             }
<a name="l01910"></a>01910         }
<a name="l01911"></a>01911     }
<a name="l01912"></a>01912     <span class="keywordflow">return</span> <a class="code" href="../../d2/d47/compile_8c.html#a652dda0d529b866959c19fe27293968e">COMPILE_OK</a>;
<a name="l01913"></a>01913 }
<a name="l01914"></a>01914 
<a name="l01915"></a>01915 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l01916"></a><a class="code" href="../../d2/d47/compile_8c.html#a9ef59376c53c601bd4c014b3ce55183e">01916</a> <a class="code" href="../../d2/d47/compile_8c.html#a9ef59376c53c601bd4c014b3ce55183e">iseq_optimize</a>(<a class="code" href="../../d6/de3/structrb__iseq__struct.html">rb_iseq_t</a> *<a class="code" href="../../dc/d07/structiseq__catch__table__entry.html#a919aa1dbe534777ff38a07a17b956524">iseq</a>, <a class="code" href="../../d4/dcd/structiseq__link__anchor.html">LINK_ANCHOR</a> *anchor)
<a name="l01917"></a>01917 {
<a name="l01918"></a>01918     <a class="code" href="../../dc/dd8/structiseq__link__element.html">LINK_ELEMENT</a> *list;
<a name="l01919"></a>01919     <span class="keyword">const</span> <span class="keywordtype">int</span> do_peepholeopt = iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a947d34698fb5a71f4938532fff27a0f7">compile_data</a>-&gt;<a class="code" href="../../d4/dd8/structiseq__compile__data.html#a3cde0c1bfeea6f8a80027a9e21a9759a">option</a>-&gt;<a class="code" href="../../db/dc1/structrb__compile__option__struct.html#a55be2ab9e3d73db5bc33d9a0cb42077a">peephole_optimization</a>;
<a name="l01920"></a>01920     <span class="keyword">const</span> <span class="keywordtype">int</span> do_tailcallopt = iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a947d34698fb5a71f4938532fff27a0f7">compile_data</a>-&gt;<a class="code" href="../../d4/dd8/structiseq__compile__data.html#a3cde0c1bfeea6f8a80027a9e21a9759a">option</a>-&gt;<a class="code" href="../../db/dc1/structrb__compile__option__struct.html#a3014c6bc77f9bfeb2b684d8ba6801d95">tailcall_optimization</a>;
<a name="l01921"></a>01921     <span class="keyword">const</span> <span class="keywordtype">int</span> do_si = iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a947d34698fb5a71f4938532fff27a0f7">compile_data</a>-&gt;<a class="code" href="../../d4/dd8/structiseq__compile__data.html#a3cde0c1bfeea6f8a80027a9e21a9759a">option</a>-&gt;<a class="code" href="../../db/dc1/structrb__compile__option__struct.html#a3b19a485a844d38253d438596e145089">specialized_instruction</a>;
<a name="l01922"></a>01922     <span class="keyword">const</span> <span class="keywordtype">int</span> do_ou = iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a947d34698fb5a71f4938532fff27a0f7">compile_data</a>-&gt;<a class="code" href="../../d4/dd8/structiseq__compile__data.html#a3cde0c1bfeea6f8a80027a9e21a9759a">option</a>-&gt;<a class="code" href="../../db/dc1/structrb__compile__option__struct.html#acfbbdb3d91a396184b4656da1d2fbe91">operands_unification</a>;
<a name="l01923"></a>01923     list = <a class="code" href="../../d2/d47/compile_8c.html#a7dd2b3352ea85a0b8f87dc549b9c4f1e">FIRST_ELEMENT</a>(anchor);
<a name="l01924"></a>01924 
<a name="l01925"></a>01925     <span class="keywordflow">while</span> (list) {
<a name="l01926"></a>01926         <span class="keywordflow">if</span> (list-&gt;<a class="code" href="../../dc/dd8/structiseq__link__element.html#a36dbc4d260432e7b26802451326ac92f">type</a> == ISEQ_ELEMENT_INSN) {
<a name="l01927"></a>01927             <span class="keywordflow">if</span> (do_peepholeopt) {
<a name="l01928"></a>01928                 <a class="code" href="../../d2/d47/compile_8c.html#aee047381fda74e925f077a9fdcc13474">iseq_peephole_optimize</a>(iseq, list, do_tailcallopt);
<a name="l01929"></a>01929             }
<a name="l01930"></a>01930             <span class="keywordflow">if</span> (do_si) {
<a name="l01931"></a>01931                 <a class="code" href="../../d2/d47/compile_8c.html#ad3c097449b2bcae8a313e3258e9f9376">iseq_specialized_instruction</a>(iseq, (<a class="code" href="../../db/d57/structiseq__insn__data.html">INSN</a> *)list);
<a name="l01932"></a>01932             }
<a name="l01933"></a>01933             <span class="keywordflow">if</span> (do_ou) {
<a name="l01934"></a>01934                 insn_operands_unification((<a class="code" href="../../db/d57/structiseq__insn__data.html">INSN</a> *)list);
<a name="l01935"></a>01935             }
<a name="l01936"></a>01936         }
<a name="l01937"></a>01937         list = list-&gt;<a class="code" href="../../dc/dd8/structiseq__link__element.html#aaae92b0ba47e61c8c36eba5dac082957">next</a>;
<a name="l01938"></a>01938     }
<a name="l01939"></a>01939     <span class="keywordflow">return</span> <a class="code" href="../../d2/d47/compile_8c.html#a652dda0d529b866959c19fe27293968e">COMPILE_OK</a>;
<a name="l01940"></a>01940 }
<a name="l01941"></a>01941 
<a name="l01942"></a>01942 <span class="preprocessor">#if OPT_INSTRUCTIONS_UNIFICATION</span>
<a name="l01943"></a>01943 <span class="preprocessor"></span><span class="keyword">static</span> <a class="code" href="../../db/d57/structiseq__insn__data.html">INSN</a> *
<a name="l01944"></a>01944 new_unified_insn(<a class="code" href="../../d6/de3/structrb__iseq__struct.html">rb_iseq_t</a> *<a class="code" href="../../dc/d07/structiseq__catch__table__entry.html#a919aa1dbe534777ff38a07a17b956524">iseq</a>,
<a name="l01945"></a>01945                  <span class="keywordtype">int</span> insn_id, <span class="keywordtype">int</span> size, <a class="code" href="../../dc/dd8/structiseq__link__element.html">LINK_ELEMENT</a> *seq_list)
<a name="l01946"></a>01946 {
<a name="l01947"></a>01947     <a class="code" href="../../db/d57/structiseq__insn__data.html">INSN</a> *iobj = 0;
<a name="l01948"></a>01948     <a class="code" href="../../dc/dd8/structiseq__link__element.html">LINK_ELEMENT</a> *list = seq_list;
<a name="l01949"></a>01949     <span class="keywordtype">int</span> i, <a class="code" href="../../df/d77/ruby_8c.html#ad1447518f4372828b8435ae82e48499e">argc</a> = 0;
<a name="l01950"></a>01950     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> *operands = 0, *ptr = 0;
<a name="l01951"></a>01951 
<a name="l01952"></a>01952 
<a name="l01953"></a>01953     <span class="comment">/* count argc */</span>
<a name="l01954"></a>01954     <span class="keywordflow">for</span> (i = 0; i &lt; size; i++) {
<a name="l01955"></a>01955         iobj = (<a class="code" href="../../db/d57/structiseq__insn__data.html">INSN</a> *)list;
<a name="l01956"></a>01956         argc += iobj-&gt;<a class="code" href="../../db/d57/structiseq__insn__data.html#aec0e69fa21d100503fd6b901003b3c27">operand_size</a>;
<a name="l01957"></a>01957         list = list-&gt;<a class="code" href="../../dc/dd8/structiseq__link__element.html#aaae92b0ba47e61c8c36eba5dac082957">next</a>;
<a name="l01958"></a>01958     }
<a name="l01959"></a>01959 
<a name="l01960"></a>01960     <span class="keywordflow">if</span> (argc &gt; 0) {
<a name="l01961"></a>01961         ptr = operands =
<a name="l01962"></a>01962             (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> *)<a class="code" href="../../d2/d47/compile_8c.html#aa24f135ae12437da748202a5329eba3e">compile_data_alloc</a>(iseq, <span class="keyword">sizeof</span>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>) * argc);
<a name="l01963"></a>01963     }
<a name="l01964"></a>01964 
<a name="l01965"></a>01965     <span class="comment">/* copy operands */</span>
<a name="l01966"></a>01966     list = seq_list;
<a name="l01967"></a>01967     <span class="keywordflow">for</span> (i = 0; i &lt; size; i++) {
<a name="l01968"></a>01968         iobj = (<a class="code" href="../../db/d57/structiseq__insn__data.html">INSN</a> *)list;
<a name="l01969"></a>01969         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a04ab67335215e8362c63ed27ae2d1c40">MEMCPY</a>(ptr, iobj-&gt;<a class="code" href="../../db/d57/structiseq__insn__data.html#ae83a50dd669328f4915717f99d8805c5">operands</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>, iobj-&gt;<a class="code" href="../../db/d57/structiseq__insn__data.html#aec0e69fa21d100503fd6b901003b3c27">operand_size</a>);
<a name="l01970"></a>01970         ptr += iobj-&gt;<a class="code" href="../../db/d57/structiseq__insn__data.html#aec0e69fa21d100503fd6b901003b3c27">operand_size</a>;
<a name="l01971"></a>01971         list = list-&gt;<a class="code" href="../../dc/dd8/structiseq__link__element.html#aaae92b0ba47e61c8c36eba5dac082957">next</a>;
<a name="l01972"></a>01972     }
<a name="l01973"></a>01973 
<a name="l01974"></a>01974     <span class="keywordflow">return</span> <a class="code" href="../../d2/d47/compile_8c.html#a43e3134981c54d24f0e03651e0f909b6">new_insn_core</a>(iseq, iobj-&gt;<a class="code" href="../../db/d57/structiseq__insn__data.html#a7da955a957d6555a0c0454dee8508669">line_no</a>, insn_id, argc, operands);
<a name="l01975"></a>01975 }
<a name="l01976"></a>01976 <span class="preprocessor">#endif</span>
<a name="l01977"></a>01977 <span class="preprocessor"></span>
<a name="l01978"></a>01978 <span class="comment">/*</span>
<a name="l01979"></a>01979 <span class="comment"> * This scheme can get more performance if do this optimize with</span>
<a name="l01980"></a>01980 <span class="comment"> * label address resolving.</span>
<a name="l01981"></a>01981 <span class="comment"> * It&apos;s future work (if compile time was bottle neck).</span>
<a name="l01982"></a>01982 <span class="comment"> */</span>
<a name="l01983"></a>01983 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l01984"></a><a class="code" href="../../d2/d47/compile_8c.html#aa9102caf54c32a18243dbaef6b86eb03">01984</a> <a class="code" href="../../d2/d47/compile_8c.html#aa9102caf54c32a18243dbaef6b86eb03">iseq_insns_unification</a>(<a class="code" href="../../d6/de3/structrb__iseq__struct.html">rb_iseq_t</a> *iseq, <a class="code" href="../../d4/dcd/structiseq__link__anchor.html">LINK_ANCHOR</a> *anchor)
<a name="l01985"></a>01985 {
<a name="l01986"></a>01986 <span class="preprocessor">#if OPT_INSTRUCTIONS_UNIFICATION</span>
<a name="l01987"></a>01987 <span class="preprocessor"></span>    <a class="code" href="../../dc/dd8/structiseq__link__element.html">LINK_ELEMENT</a> *list;
<a name="l01988"></a>01988     <a class="code" href="../../db/d57/structiseq__insn__data.html">INSN</a> *iobj, *niobj;
<a name="l01989"></a>01989     <span class="keywordtype">int</span> <a class="code" href="../../d6/da0/nkf-utf8_2nkf_8c.html#a64ae40793ade89d800a8c5646d2980fc">id</a>, k;
<a name="l01990"></a>01990     <a class="code" href="../../dc/db1/win32_8h.html#a0fbe4a4f8dd857ee04923a901f27465f">intptr_t</a> j;
<a name="l01991"></a>01991 
<a name="l01992"></a>01992     list = <a class="code" href="../../d2/d47/compile_8c.html#a7dd2b3352ea85a0b8f87dc549b9c4f1e">FIRST_ELEMENT</a>(anchor);
<a name="l01993"></a>01993     <span class="keywordflow">while</span> (list) {
<a name="l01994"></a>01994         <span class="keywordflow">if</span> (list-&gt;<a class="code" href="../../dc/dd8/structiseq__link__element.html#a36dbc4d260432e7b26802451326ac92f">type</a> == ISEQ_ELEMENT_INSN) {
<a name="l01995"></a>01995             iobj = (<a class="code" href="../../db/d57/structiseq__insn__data.html">INSN</a> *)list;
<a name="l01996"></a>01996             <span class="keywordtype">id</span> = iobj-&gt;<a class="code" href="../../db/d57/structiseq__insn__data.html#ab1f1e3095532dd0ece9bb256047a027e">insn_id</a>;
<a name="l01997"></a>01997             <span class="keywordflow">if</span> (unified_insns_data[<span class="keywordtype">id</span>] != 0) {
<a name="l01998"></a>01998                 <span class="keyword">const</span> <span class="keywordtype">int</span> *<span class="keyword">const</span> *entry = unified_insns_data[id];
<a name="l01999"></a>01999                 <span class="keywordflow">for</span> (j = 1; j &lt; (<a class="code" href="../../dc/db1/win32_8h.html#a0fbe4a4f8dd857ee04923a901f27465f">intptr_t</a>)entry[0]; j++) {
<a name="l02000"></a>02000                     <span class="keyword">const</span> <span class="keywordtype">int</span> *unified = entry[j];
<a name="l02001"></a>02001                     <a class="code" href="../../dc/dd8/structiseq__link__element.html">LINK_ELEMENT</a> *li = list-&gt;<a class="code" href="../../dc/dd8/structiseq__link__element.html#aaae92b0ba47e61c8c36eba5dac082957">next</a>;
<a name="l02002"></a>02002                     <span class="keywordflow">for</span> (k = 2; k &lt; unified[1]; k++) {
<a name="l02003"></a>02003                         <span class="keywordflow">if</span> (li-&gt;<a class="code" href="../../dc/dd8/structiseq__link__element.html#a36dbc4d260432e7b26802451326ac92f">type</a> != ISEQ_ELEMENT_INSN ||
<a name="l02004"></a>02004                             ((<a class="code" href="../../db/d57/structiseq__insn__data.html">INSN</a> *)li)-&gt;insn_id != unified[k]) {
<a name="l02005"></a>02005                             <span class="keywordflow">goto</span> miss;
<a name="l02006"></a>02006                         }
<a name="l02007"></a>02007                         li = li-&gt;<a class="code" href="../../dc/dd8/structiseq__link__element.html#aaae92b0ba47e61c8c36eba5dac082957">next</a>;
<a name="l02008"></a>02008                     }
<a name="l02009"></a>02009                     <span class="comment">/* matched */</span>
<a name="l02010"></a>02010                     niobj =
<a name="l02011"></a>02011                         new_unified_insn(iseq, unified[0], unified[1] - 1,
<a name="l02012"></a>02012                                          list);
<a name="l02013"></a>02013 
<a name="l02014"></a>02014                     <span class="comment">/* insert to list */</span>
<a name="l02015"></a>02015                     niobj-&gt;<a class="code" href="../../db/d57/structiseq__insn__data.html#aa7e061b84452f211dffd6accf084fa31">link</a>.<a class="code" href="../../dc/dd8/structiseq__link__element.html#a9b8195e4fd0634def4fb75be28bef536">prev</a> = (<a class="code" href="../../dc/dd8/structiseq__link__element.html">LINK_ELEMENT</a> *)iobj-&gt;<a class="code" href="../../db/d57/structiseq__insn__data.html#aa7e061b84452f211dffd6accf084fa31">link</a>.<a class="code" href="../../dc/dd8/structiseq__link__element.html#a9b8195e4fd0634def4fb75be28bef536">prev</a>;
<a name="l02016"></a>02016                     niobj-&gt;<a class="code" href="../../db/d57/structiseq__insn__data.html#aa7e061b84452f211dffd6accf084fa31">link</a>.<a class="code" href="../../dc/dd8/structiseq__link__element.html#aaae92b0ba47e61c8c36eba5dac082957">next</a> = li;
<a name="l02017"></a>02017                     <a class="code" href="../../d7/dc0/parse_8y.html#a2ac1143ac343c79cbfa448e30d74fa1c">if</a> (li) {
<a name="l02018"></a>02018                         li-&gt;<a class="code" href="../../dc/dd8/structiseq__link__element.html#a9b8195e4fd0634def4fb75be28bef536">prev</a> = (<a class="code" href="../../dc/dd8/structiseq__link__element.html">LINK_ELEMENT</a> *)niobj;
<a name="l02019"></a>02019                     }
<a name="l02020"></a>02020 
<a name="l02021"></a>02021                     list-&gt;<a class="code" href="../../dc/dd8/structiseq__link__element.html#a9b8195e4fd0634def4fb75be28bef536">prev</a>-&gt;<a class="code" href="../../dc/dd8/structiseq__link__element.html#aaae92b0ba47e61c8c36eba5dac082957">next</a> = (<a class="code" href="../../dc/dd8/structiseq__link__element.html">LINK_ELEMENT</a> *)niobj;
<a name="l02022"></a>02022                     list = (<a class="code" href="../../dc/dd8/structiseq__link__element.html">LINK_ELEMENT</a> *)niobj;
<a name="l02023"></a>02023                     <span class="keywordflow">break</span>;
<a name="l02024"></a>02024                   miss:;
<a name="l02025"></a>02025                 }
<a name="l02026"></a>02026             }
<a name="l02027"></a>02027         }
<a name="l02028"></a>02028         list = list-&gt;<a class="code" href="../../dc/dd8/structiseq__link__element.html#aaae92b0ba47e61c8c36eba5dac082957">next</a>;
<a name="l02029"></a>02029     }
<a name="l02030"></a>02030 <span class="preprocessor">#endif</span>
<a name="l02031"></a>02031 <span class="preprocessor"></span>    <span class="keywordflow">return</span> <a class="code" href="../../d2/d47/compile_8c.html#a652dda0d529b866959c19fe27293968e">COMPILE_OK</a>;
<a name="l02032"></a>02032 }
<a name="l02033"></a>02033 
<a name="l02034"></a>02034 <span class="preprocessor">#if OPT_STACK_CACHING</span>
<a name="l02035"></a>02035 <span class="preprocessor"></span>
<a name="l02036"></a>02036 <span class="preprocessor">#define SC_INSN(insn, stat) sc_insn_info[(insn)][(stat)]</span>
<a name="l02037"></a>02037 <span class="preprocessor"></span><span class="preprocessor">#define SC_NEXT(insn)       sc_insn_next[(insn)]</span>
<a name="l02038"></a>02038 <span class="preprocessor"></span>
<a name="l02039"></a>02039 <span class="preprocessor">#include &quot;<a class="code" href="../../d5/d93/opt__sc_8inc.html">opt_sc.inc</a>&quot;</span>
<a name="l02040"></a>02040 
<a name="l02041"></a>02041 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l02042"></a>02042 insn_set_sc_state(<a class="code" href="../../d6/de3/structrb__iseq__struct.html">rb_iseq_t</a> *iseq, <a class="code" href="../../db/d57/structiseq__insn__data.html">INSN</a> *iobj, <span class="keywordtype">int</span> <a class="code" href="../../d5/d1d/gb18030_8c.html#adc6e5733fc3c22f0a7b2914188c49c90">state</a>)
<a name="l02043"></a>02043 {
<a name="l02044"></a>02044     <span class="keywordtype">int</span> nstate;
<a name="l02045"></a>02045     <span class="keywordtype">int</span> insn_id;
<a name="l02046"></a>02046 
<a name="l02047"></a>02047     insn_id = iobj-&gt;<a class="code" href="../../db/d57/structiseq__insn__data.html#ab1f1e3095532dd0ece9bb256047a027e">insn_id</a>;
<a name="l02048"></a>02048     iobj-&gt;<a class="code" href="../../db/d57/structiseq__insn__data.html#ab1f1e3095532dd0ece9bb256047a027e">insn_id</a> = SC_INSN(insn_id, state);
<a name="l02049"></a>02049     nstate = SC_NEXT(iobj-&gt;<a class="code" href="../../db/d57/structiseq__insn__data.html#ab1f1e3095532dd0ece9bb256047a027e">insn_id</a>);
<a name="l02050"></a>02050 
<a name="l02051"></a>02051     <span class="keywordflow">if</span> (insn_id == BIN(jump) ||
<a name="l02052"></a>02052         insn_id == BIN(branchif) || insn_id == BIN(branchunless)) {
<a name="l02053"></a>02053         <a class="code" href="../../d8/dc5/structiseq__label__data.html">LABEL</a> *lobj = (<a class="code" href="../../d8/dc5/structiseq__label__data.html">LABEL</a> *)<a class="code" href="../../d2/d47/compile_8c.html#accd7d8e5aae40bb4eecd61fb8d6c65cc">OPERAND_AT</a>(iobj, 0);
<a name="l02054"></a>02054 
<a name="l02055"></a>02055         <span class="keywordflow">if</span> (lobj-&gt;<a class="code" href="../../d8/dc5/structiseq__label__data.html#ac15f213f0f9e22b989778d50ef8b8328">sc_state</a> != 0) {
<a name="l02056"></a>02056             <span class="keywordflow">if</span> (lobj-&gt;<a class="code" href="../../d8/dc5/structiseq__label__data.html#ac15f213f0f9e22b989778d50ef8b8328">sc_state</a> != nstate) {
<a name="l02057"></a>02057                 <a class="code" href="../../d2/d47/compile_8c.html#aee9a7dcbd2c223a7790c416972f221c7">dump_disasm_list</a>((<a class="code" href="../../dc/dd8/structiseq__link__element.html">LINK_ELEMENT</a> *)iobj);
<a name="l02058"></a>02058                 <a class="code" href="../../d2/d47/compile_8c.html#aee9a7dcbd2c223a7790c416972f221c7">dump_disasm_list</a>((<a class="code" href="../../dc/dd8/structiseq__link__element.html">LINK_ELEMENT</a> *)lobj);
<a name="l02059"></a>02059                 printf(<span class="stringliteral">&quot;\n-- %d, %d\n&quot;</span>, lobj-&gt;<a class="code" href="../../d8/dc5/structiseq__label__data.html#ac15f213f0f9e22b989778d50ef8b8328">sc_state</a>, nstate);
<a name="l02060"></a>02060                 <a class="code" href="../../d5/d11/ripper_8c.html#ac8a9e12698ddd356976669c6116abef1">rb_compile_error</a>(<a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a06859fa5de56f2ede3cb692f1d9215e2">filename</a>), iobj-&gt;<a class="code" href="../../db/d57/structiseq__insn__data.html#a7da955a957d6555a0c0454dee8508669">line_no</a>,
<a name="l02061"></a>02061                                  <span class="stringliteral">&quot;insn_set_sc_state error\n&quot;</span>);
<a name="l02062"></a>02062                 <span class="keywordflow">return</span> 0;
<a name="l02063"></a>02063             }
<a name="l02064"></a>02064         }
<a name="l02065"></a>02065         <span class="keywordflow">else</span> {
<a name="l02066"></a>02066             lobj-&gt;<a class="code" href="../../d8/dc5/structiseq__label__data.html#ac15f213f0f9e22b989778d50ef8b8328">sc_state</a> = nstate;
<a name="l02067"></a>02067         }
<a name="l02068"></a>02068         <span class="keywordflow">if</span> (insn_id == BIN(jump)) {
<a name="l02069"></a>02069             nstate = SCS_XX;
<a name="l02070"></a>02070         }
<a name="l02071"></a>02071     }
<a name="l02072"></a>02072     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (insn_id == BIN(leave)) {
<a name="l02073"></a>02073         nstate = SCS_XX;
<a name="l02074"></a>02074     }
<a name="l02075"></a>02075 
<a name="l02076"></a>02076     <span class="keywordflow">return</span> nstate;
<a name="l02077"></a>02077 }
<a name="l02078"></a>02078 
<a name="l02079"></a>02079 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l02080"></a>02080 label_set_sc_state(<a class="code" href="../../d8/dc5/structiseq__label__data.html">LABEL</a> *lobj, <span class="keywordtype">int</span> state)
<a name="l02081"></a>02081 {
<a name="l02082"></a>02082     <span class="keywordflow">if</span> (lobj-&gt;<a class="code" href="../../d8/dc5/structiseq__label__data.html#ac15f213f0f9e22b989778d50ef8b8328">sc_state</a> != 0) {
<a name="l02083"></a>02083         <span class="keywordflow">if</span> (lobj-&gt;<a class="code" href="../../d8/dc5/structiseq__label__data.html#ac15f213f0f9e22b989778d50ef8b8328">sc_state</a> != state) {
<a name="l02084"></a>02084             state = lobj-&gt;<a class="code" href="../../d8/dc5/structiseq__label__data.html#ac15f213f0f9e22b989778d50ef8b8328">sc_state</a>;
<a name="l02085"></a>02085         }
<a name="l02086"></a>02086     }
<a name="l02087"></a>02087     <span class="keywordflow">else</span> {
<a name="l02088"></a>02088         lobj-&gt;<a class="code" href="../../d8/dc5/structiseq__label__data.html#ac15f213f0f9e22b989778d50ef8b8328">sc_state</a> = state;
<a name="l02089"></a>02089     }
<a name="l02090"></a>02090 
<a name="l02091"></a>02091     <span class="keywordflow">return</span> state;
<a name="l02092"></a>02092 }
<a name="l02093"></a>02093 
<a name="l02094"></a>02094 
<a name="l02095"></a>02095 <span class="preprocessor">#endif</span>
<a name="l02096"></a>02096 <span class="preprocessor"></span>
<a name="l02097"></a>02097 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l02098"></a><a class="code" href="../../d2/d47/compile_8c.html#a71895fceca840260c60c4c41a44ea530">02098</a> <a class="code" href="../../d2/d47/compile_8c.html#a71895fceca840260c60c4c41a44ea530">iseq_set_sequence_stackcaching</a>(<a class="code" href="../../d6/de3/structrb__iseq__struct.html">rb_iseq_t</a> *iseq, <a class="code" href="../../d4/dcd/structiseq__link__anchor.html">LINK_ANCHOR</a> *anchor)
<a name="l02099"></a>02099 {
<a name="l02100"></a>02100 <span class="preprocessor">#if OPT_STACK_CACHING</span>
<a name="l02101"></a>02101 <span class="preprocessor"></span>    <a class="code" href="../../dc/dd8/structiseq__link__element.html">LINK_ELEMENT</a> *list;
<a name="l02102"></a>02102     <span class="keywordtype">int</span> state, insn_id;
<a name="l02103"></a>02103 
<a name="l02104"></a>02104     <span class="comment">/* initialize */</span>
<a name="l02105"></a>02105     state = SCS_XX;
<a name="l02106"></a>02106     list = <a class="code" href="../../d2/d47/compile_8c.html#a7dd2b3352ea85a0b8f87dc549b9c4f1e">FIRST_ELEMENT</a>(anchor);
<a name="l02107"></a>02107     <span class="comment">/* dump_disasm_list(list); */</span>
<a name="l02108"></a>02108 
<a name="l02109"></a>02109     <span class="comment">/* for each list element */</span>
<a name="l02110"></a>02110     <span class="keywordflow">while</span> (list) {
<a name="l02111"></a>02111       redo_point:
<a name="l02112"></a>02112         <span class="keywordflow">switch</span> (list-&gt;<a class="code" href="../../dc/dd8/structiseq__link__element.html#a36dbc4d260432e7b26802451326ac92f">type</a>) {
<a name="l02113"></a>02113           <span class="keywordflow">case</span> ISEQ_ELEMENT_INSN:
<a name="l02114"></a>02114             {
<a name="l02115"></a>02115                 <a class="code" href="../../db/d57/structiseq__insn__data.html">INSN</a> *iobj = (<a class="code" href="../../db/d57/structiseq__insn__data.html">INSN</a> *)list;
<a name="l02116"></a>02116                 insn_id = iobj-&gt;<a class="code" href="../../db/d57/structiseq__insn__data.html#ab1f1e3095532dd0ece9bb256047a027e">insn_id</a>;
<a name="l02117"></a>02117 
<a name="l02118"></a>02118                 <span class="comment">/* dump_disasm_list(list); */</span>
<a name="l02119"></a>02119 
<a name="l02120"></a>02120                 <span class="keywordflow">switch</span> (insn_id) {
<a name="l02121"></a>02121                   <span class="keywordflow">case</span> BIN(nop):
<a name="l02122"></a>02122                     {
<a name="l02123"></a>02123                         <span class="comment">/* exception merge point */</span>
<a name="l02124"></a>02124                         <span class="keywordflow">if</span> (state != SCS_AX) {
<a name="l02125"></a>02125                             <a class="code" href="../../db/d57/structiseq__insn__data.html">INSN</a> *rpobj =
<a name="l02126"></a>02126                                 <a class="code" href="../../d2/d47/compile_8c.html#af32e6981fd21b9b2cb65ed85904c4d5a">new_insn_body</a>(iseq, 0, BIN(reput), 0);
<a name="l02127"></a>02127 
<a name="l02128"></a>02128                             <span class="comment">/* replace this insn */</span>
<a name="l02129"></a>02129                             <a class="code" href="../../d2/d47/compile_8c.html#aeab5cc0a8fd45fad5346477d64bb70da">REPLACE_ELEM</a>(list, (<a class="code" href="../../dc/dd8/structiseq__link__element.html">LINK_ELEMENT</a> *)rpobj);
<a name="l02130"></a>02130                             list = (<a class="code" href="../../dc/dd8/structiseq__link__element.html">LINK_ELEMENT</a> *)rpobj;
<a name="l02131"></a>02131                             <span class="keywordflow">goto</span> redo_point;
<a name="l02132"></a>02132                         }
<a name="l02133"></a>02133                         <span class="keywordflow">break</span>;
<a name="l02134"></a>02134                     }
<a name="l02135"></a>02135                   <span class="keywordflow">case</span> BIN(swap):
<a name="l02136"></a>02136                     {
<a name="l02137"></a>02137                         <span class="keywordflow">if</span> (state == SCS_AB || state == SCS_BA) {
<a name="l02138"></a>02138                             state = (state == SCS_AB ? SCS_BA : SCS_AB);
<a name="l02139"></a>02139 
<a name="l02140"></a>02140                             <a class="code" href="../../d2/d47/compile_8c.html#aeb2ab21cdb1acd4dd79c5605c7db4cf5">REMOVE_ELEM</a>(list);
<a name="l02141"></a>02141                             list = list-&gt;<a class="code" href="../../dc/dd8/structiseq__link__element.html#aaae92b0ba47e61c8c36eba5dac082957">next</a>;
<a name="l02142"></a>02142                             <span class="keywordflow">goto</span> redo_point;
<a name="l02143"></a>02143                         }
<a name="l02144"></a>02144                         <span class="keywordflow">break</span>;
<a name="l02145"></a>02145                     }
<a name="l02146"></a>02146                   <span class="keywordflow">case</span> BIN(pop):
<a name="l02147"></a>02147                     {
<a name="l02148"></a>02148                         <span class="keywordflow">switch</span> (state) {
<a name="l02149"></a>02149                           <span class="keywordflow">case</span> SCS_AX:
<a name="l02150"></a>02150                           <span class="keywordflow">case</span> SCS_BX:
<a name="l02151"></a>02151                             state = SCS_XX;
<a name="l02152"></a>02152                             <span class="keywordflow">break</span>;
<a name="l02153"></a>02153                           <span class="keywordflow">case</span> SCS_AB:
<a name="l02154"></a>02154                             state = SCS_AX;
<a name="l02155"></a>02155                             <span class="keywordflow">break</span>;
<a name="l02156"></a>02156                           <span class="keywordflow">case</span> SCS_BA:
<a name="l02157"></a>02157                             state = SCS_BX;
<a name="l02158"></a>02158                             <span class="keywordflow">break</span>;
<a name="l02159"></a>02159                           <span class="keywordflow">case</span> SCS_XX:
<a name="l02160"></a>02160                             <span class="keywordflow">goto</span> normal_insn;
<a name="l02161"></a>02161                           <span class="keywordflow">default</span>:
<a name="l02162"></a>02162                             <a class="code" href="../../d5/d11/ripper_8c.html#ac8a9e12698ddd356976669c6116abef1">rb_compile_error</a>(<a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a06859fa5de56f2ede3cb692f1d9215e2">filename</a>), iobj-&gt;<a class="code" href="../../db/d57/structiseq__insn__data.html#a7da955a957d6555a0c0454dee8508669">line_no</a>,
<a name="l02163"></a>02163                                              <span class="stringliteral">&quot;unreachable&quot;</span>);
<a name="l02164"></a>02164                         }
<a name="l02165"></a>02165                         <span class="comment">/* remove useless pop */</span>
<a name="l02166"></a>02166                         <a class="code" href="../../d2/d47/compile_8c.html#aeb2ab21cdb1acd4dd79c5605c7db4cf5">REMOVE_ELEM</a>(list);
<a name="l02167"></a>02167                         list = list-&gt;<a class="code" href="../../dc/dd8/structiseq__link__element.html#aaae92b0ba47e61c8c36eba5dac082957">next</a>;
<a name="l02168"></a>02168                         <span class="keywordflow">goto</span> redo_point;
<a name="l02169"></a>02169                     }
<a name="l02170"></a>02170                   <span class="keywordflow">default</span>:;
<a name="l02171"></a>02171                     <span class="comment">/* none */</span>
<a name="l02172"></a>02172                 }               <span class="comment">/* end of switch */</span>
<a name="l02173"></a>02173               normal_insn:
<a name="l02174"></a>02174                 state = insn_set_sc_state(iseq, iobj, state);
<a name="l02175"></a>02175                 <span class="keywordflow">break</span>;
<a name="l02176"></a>02176             }
<a name="l02177"></a>02177           <span class="keywordflow">case</span> ISEQ_ELEMENT_LABEL:
<a name="l02178"></a>02178             {
<a name="l02179"></a>02179                 <a class="code" href="../../d8/dc5/structiseq__label__data.html">LABEL</a> *lobj;
<a name="l02180"></a>02180                 lobj = (<a class="code" href="../../d8/dc5/structiseq__label__data.html">LABEL</a> *)list;
<a name="l02181"></a>02181 
<a name="l02182"></a>02182                 state = label_set_sc_state(lobj, state);
<a name="l02183"></a>02183             }
<a name="l02184"></a>02184           <span class="keywordflow">default</span>:
<a name="l02185"></a>02185             <span class="keywordflow">break</span>;
<a name="l02186"></a>02186         }
<a name="l02187"></a>02187         list = list-&gt;<a class="code" href="../../dc/dd8/structiseq__link__element.html#aaae92b0ba47e61c8c36eba5dac082957">next</a>;
<a name="l02188"></a>02188     }
<a name="l02189"></a>02189 <span class="preprocessor">#endif</span>
<a name="l02190"></a>02190 <span class="preprocessor"></span>    <span class="keywordflow">return</span> <a class="code" href="../../d2/d47/compile_8c.html#a652dda0d529b866959c19fe27293968e">COMPILE_OK</a>;
<a name="l02191"></a>02191 }
<a name="l02192"></a>02192 
<a name="l02193"></a>02193 
<a name="l02194"></a>02194 
<a name="l02195"></a>02195 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l02196"></a><a class="code" href="../../d2/d47/compile_8c.html#aa5c9fa8a566747bdd0beb385acc2c135">02196</a> <a class="code" href="../../d2/d47/compile_8c.html#aa5c9fa8a566747bdd0beb385acc2c135">compile_dstr_fragments</a>(<a class="code" href="../../d6/de3/structrb__iseq__struct.html">rb_iseq_t</a> *iseq, <a class="code" href="../../d4/dcd/structiseq__link__anchor.html">LINK_ANCHOR</a> *ret, NODE * <a class="code" href="../../d7/dc0/parse_8y.html#a0d7af8a92c4b0a07f71585584ef9634f">node</a>, <span class="keywordtype">int</span> *cntp)
<a name="l02197"></a>02197 {
<a name="l02198"></a>02198     NODE *list = node-&gt;nd_next;
<a name="l02199"></a>02199     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> lit = node-&gt;nd_lit;
<a name="l02200"></a>02200     <span class="keywordtype">int</span> <a class="code" href="../../d8/d36/signal_8c.html#a6f2334d7e90694f211f708b860dfa486">cnt</a> = 0;
<a name="l02201"></a>02201 
<a name="l02202"></a>02202     <a class="code" href="../../d2/d47/compile_8c.html#ad983bdc29f9c5bde5ab33d14c3d143e6">debugp_param</a>(<span class="stringliteral">&quot;nd_lit&quot;</span>, lit);
<a name="l02203"></a>02203     <span class="keywordflow">if</span> (!<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a4832bad8845a35fc50f7a160901854a1">NIL_P</a>(lit)) {
<a name="l02204"></a>02204         <a class="code" href="../../d2/d47/compile_8c.html#ade60ac907df6825c414be22c432ba82a">hide_obj</a>(lit);
<a name="l02205"></a>02205         cnt++;
<a name="l02206"></a>02206         <a class="code" href="../../d2/d47/compile_8c.html#a3cfeb7549a1249a8b78f9d6ff1e74c5a">ADD_INSN1</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), putobject, lit);
<a name="l02207"></a>02207     }
<a name="l02208"></a>02208 
<a name="l02209"></a>02209     <span class="keywordflow">while</span> (list) {
<a name="l02210"></a>02210         <a class="code" href="../../d2/d47/compile_8c.html#a0cacd6cfca69df35e1535d2f21532c47">COMPILE</a>(ret, <span class="stringliteral">&quot;each string&quot;</span>, list-&gt;nd_head);
<a name="l02211"></a>02211         cnt++;
<a name="l02212"></a>02212         list = list-&gt;nd_next;
<a name="l02213"></a>02213     }
<a name="l02214"></a>02214     *cntp = cnt;
<a name="l02215"></a>02215 
<a name="l02216"></a>02216     <span class="keywordflow">return</span> <a class="code" href="../../d2/d47/compile_8c.html#a652dda0d529b866959c19fe27293968e">COMPILE_OK</a>;
<a name="l02217"></a>02217 }
<a name="l02218"></a>02218 
<a name="l02219"></a>02219 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l02220"></a><a class="code" href="../../d2/d47/compile_8c.html#a5beb4b71176a85495ad1fbeaaee7bd86">02220</a> <a class="code" href="../../d2/d47/compile_8c.html#a5beb4b71176a85495ad1fbeaaee7bd86">compile_dstr</a>(<a class="code" href="../../d6/de3/structrb__iseq__struct.html">rb_iseq_t</a> *iseq, <a class="code" href="../../d4/dcd/structiseq__link__anchor.html">LINK_ANCHOR</a> *ret, NODE * <a class="code" href="../../d7/dc0/parse_8y.html#a0d7af8a92c4b0a07f71585584ef9634f">node</a>)
<a name="l02221"></a>02221 {
<a name="l02222"></a>02222     <span class="keywordtype">int</span> <a class="code" href="../../d8/d36/signal_8c.html#a6f2334d7e90694f211f708b860dfa486">cnt</a>;
<a name="l02223"></a>02223     <a class="code" href="../../d2/d47/compile_8c.html#aa5c9fa8a566747bdd0beb385acc2c135">compile_dstr_fragments</a>(iseq, ret, node, &amp;cnt);
<a name="l02224"></a>02224     <a class="code" href="../../d2/d47/compile_8c.html#a3cfeb7549a1249a8b78f9d6ff1e74c5a">ADD_INSN1</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), concatstrings, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(cnt));
<a name="l02225"></a>02225     <span class="keywordflow">return</span> <a class="code" href="../../d2/d47/compile_8c.html#a652dda0d529b866959c19fe27293968e">COMPILE_OK</a>;
<a name="l02226"></a>02226 }
<a name="l02227"></a>02227 
<a name="l02228"></a>02228 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l02229"></a><a class="code" href="../../d2/d47/compile_8c.html#a52819fd8bf6050a1195b96fd6d1219f8">02229</a> <a class="code" href="../../d2/d47/compile_8c.html#a52819fd8bf6050a1195b96fd6d1219f8">compile_dregx</a>(<a class="code" href="../../d6/de3/structrb__iseq__struct.html">rb_iseq_t</a> *iseq, <a class="code" href="../../d4/dcd/structiseq__link__anchor.html">LINK_ANCHOR</a> *ret, NODE * <a class="code" href="../../d7/dc0/parse_8y.html#a0d7af8a92c4b0a07f71585584ef9634f">node</a>)
<a name="l02230"></a>02230 {
<a name="l02231"></a>02231     <span class="keywordtype">int</span> <a class="code" href="../../d8/d36/signal_8c.html#a6f2334d7e90694f211f708b860dfa486">cnt</a>;
<a name="l02232"></a>02232     <a class="code" href="../../d2/d47/compile_8c.html#aa5c9fa8a566747bdd0beb385acc2c135">compile_dstr_fragments</a>(iseq, ret, node, &amp;cnt);
<a name="l02233"></a>02233     <a class="code" href="../../d2/d47/compile_8c.html#a9e17ccfd8b31ec3afcb91be39a6d453f">ADD_INSN2</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), toregexp, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(node-&gt;nd_cflag), <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(cnt));
<a name="l02234"></a>02234     <span class="keywordflow">return</span> <a class="code" href="../../d2/d47/compile_8c.html#a652dda0d529b866959c19fe27293968e">COMPILE_OK</a>;
<a name="l02235"></a>02235 }
<a name="l02236"></a>02236 
<a name="l02237"></a>02237 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l02238"></a><a class="code" href="../../d2/d47/compile_8c.html#a24de6ed2392e233f64384ec0c4c96642">02238</a> <a class="code" href="../../d2/d47/compile_8c.html#a24de6ed2392e233f64384ec0c4c96642">compile_branch_condition</a>(<a class="code" href="../../d6/de3/structrb__iseq__struct.html">rb_iseq_t</a> *iseq, <a class="code" href="../../d4/dcd/structiseq__link__anchor.html">LINK_ANCHOR</a> *ret, NODE * <a class="code" href="../../d5/d11/ripper_8c.html#a9c9363cead2d8e8616cb63b4eea79655">cond</a>,
<a name="l02239"></a>02239                          <a class="code" href="../../d8/dc5/structiseq__label__data.html">LABEL</a> *then_label, <a class="code" href="../../d8/dc5/structiseq__label__data.html">LABEL</a> *else_label)
<a name="l02240"></a>02240 {
<a name="l02241"></a>02241     <span class="keywordflow">switch</span> (<a class="code" href="../../d3/d09/ripper_8y.html#ade12c589b26f55f089dc25d689249c11">nd_type</a>(cond)) {
<a name="l02242"></a>02242       <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#afce3dc60f5eb8de336e40138600ef910">NODE_AND</a>:
<a name="l02243"></a>02243         {
<a name="l02244"></a>02244             <a class="code" href="../../d8/dc5/structiseq__label__data.html">LABEL</a> *label = <a class="code" href="../../d2/d47/compile_8c.html#a1d6d5d8dac7aff9ac863255a0905c0f9">NEW_LABEL</a>(<a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(cond));
<a name="l02245"></a>02245             <a class="code" href="../../d2/d47/compile_8c.html#a24de6ed2392e233f64384ec0c4c96642">compile_branch_condition</a>(iseq, ret, cond-&gt;nd_1st, label,
<a name="l02246"></a>02246                                      else_label);
<a name="l02247"></a>02247             <a class="code" href="../../d2/d47/compile_8c.html#a5a380bb449656575d6b77ccb8eb7e5ae">ADD_LABEL</a>(ret, label);
<a name="l02248"></a>02248             <a class="code" href="../../d2/d47/compile_8c.html#a24de6ed2392e233f64384ec0c4c96642">compile_branch_condition</a>(iseq, ret, cond-&gt;nd_2nd, then_label,
<a name="l02249"></a>02249                                      else_label);
<a name="l02250"></a>02250             <span class="keywordflow">break</span>;
<a name="l02251"></a>02251         }
<a name="l02252"></a>02252       <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#addcdfeefb5907f74a7b172a710c8d45e">NODE_OR</a>:
<a name="l02253"></a>02253         {
<a name="l02254"></a>02254             <a class="code" href="../../d8/dc5/structiseq__label__data.html">LABEL</a> *label = <a class="code" href="../../d2/d47/compile_8c.html#a1d6d5d8dac7aff9ac863255a0905c0f9">NEW_LABEL</a>(<a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(cond));
<a name="l02255"></a>02255             <a class="code" href="../../d2/d47/compile_8c.html#a24de6ed2392e233f64384ec0c4c96642">compile_branch_condition</a>(iseq, ret, cond-&gt;nd_1st, then_label,
<a name="l02256"></a>02256                                      label);
<a name="l02257"></a>02257             <a class="code" href="../../d2/d47/compile_8c.html#a5a380bb449656575d6b77ccb8eb7e5ae">ADD_LABEL</a>(ret, label);
<a name="l02258"></a>02258             <a class="code" href="../../d2/d47/compile_8c.html#a24de6ed2392e233f64384ec0c4c96642">compile_branch_condition</a>(iseq, ret, cond-&gt;nd_2nd, then_label,
<a name="l02259"></a>02259                                      else_label);
<a name="l02260"></a>02260             <span class="keywordflow">break</span>;
<a name="l02261"></a>02261         }
<a name="l02262"></a>02262       <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#af19d1c1d9f26c7b19546967449e887f6">NODE_LIT</a>:            <span class="comment">/* NODE_LIT is always not true */</span>
<a name="l02263"></a>02263       <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#a00911cb328ad9df305f886837c76923c">NODE_TRUE</a>:
<a name="l02264"></a>02264       <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#aac55f53b58d8cbef84a61f2d744e7643">NODE_STR</a>:
<a name="l02265"></a>02265         <span class="comment">/* printf(&quot;useless condition eliminate (%s)\n&quot;,  ruby_node_name(nd_type(cond))); */</span>
<a name="l02266"></a>02266         <a class="code" href="../../d2/d47/compile_8c.html#ace57e2f70722586d3764284364cfb5ad">ADD_INSNL</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(cond), jump, then_label);
<a name="l02267"></a>02267         <span class="keywordflow">break</span>;
<a name="l02268"></a>02268       <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#aa66ba820f9577731ad767ba777d2e633">NODE_FALSE</a>:
<a name="l02269"></a>02269       <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#a52160547548851ab924923b8ca1dcb42">NODE_NIL</a>:
<a name="l02270"></a>02270         <span class="comment">/* printf(&quot;useless condition eliminate (%s)\n&quot;, ruby_node_name(nd_type(cond))); */</span>
<a name="l02271"></a>02271         <a class="code" href="../../d2/d47/compile_8c.html#ace57e2f70722586d3764284364cfb5ad">ADD_INSNL</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(cond), jump, else_label);
<a name="l02272"></a>02272         <span class="keywordflow">break</span>;
<a name="l02273"></a>02273       <span class="keywordflow">default</span>:
<a name="l02274"></a>02274         <a class="code" href="../../d2/d47/compile_8c.html#a0cacd6cfca69df35e1535d2f21532c47">COMPILE</a>(ret, <span class="stringliteral">&quot;branch condition&quot;</span>, cond);
<a name="l02275"></a>02275         <a class="code" href="../../d2/d47/compile_8c.html#ace57e2f70722586d3764284364cfb5ad">ADD_INSNL</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(cond), branchunless, else_label);
<a name="l02276"></a>02276         <a class="code" href="../../d2/d47/compile_8c.html#ace57e2f70722586d3764284364cfb5ad">ADD_INSNL</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(cond), jump, then_label);
<a name="l02277"></a>02277         <span class="keywordflow">break</span>;
<a name="l02278"></a>02278     }
<a name="l02279"></a>02279     <span class="keywordflow">return</span> <a class="code" href="../../d2/d47/compile_8c.html#a652dda0d529b866959c19fe27293968e">COMPILE_OK</a>;
<a name="l02280"></a>02280 }
<a name="l02281"></a>02281 
<a name="l02282"></a>02282 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l02283"></a><a class="code" href="../../d2/d47/compile_8c.html#ab151d20b137ab6de8217e03665a5d1da">02283</a> <a class="code" href="../../d2/d47/compile_8c.html#ab151d20b137ab6de8217e03665a5d1da">compile_array_</a>(<a class="code" href="../../d6/de3/structrb__iseq__struct.html">rb_iseq_t</a> *iseq, <a class="code" href="../../d4/dcd/structiseq__link__anchor.html">LINK_ANCHOR</a> *ret, NODE* node_root,
<a name="l02284"></a>02284                <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> opt_p, <span class="keywordtype">int</span> poped)
<a name="l02285"></a>02285 {
<a name="l02286"></a>02286     NODE *<a class="code" href="../../d7/dc0/parse_8y.html#a0d7af8a92c4b0a07f71585584ef9634f">node</a> = node_root;
<a name="l02287"></a>02287     <span class="keywordtype">int</span> <a class="code" href="../../d3/d15/name2ctype_8h.html#aed1cc4dca5d94cb452f79691f54f7423">len</a> = (int)node-&gt;nd_alen, line = (<span class="keywordtype">int</span>)<a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), i=0;
<a name="l02288"></a>02288     <a class="code" href="../../d2/d47/compile_8c.html#aa9d6014cec8d3adcb228b81620eac795">DECL_ANCHOR</a>(anchor);
<a name="l02289"></a>02289 
<a name="l02290"></a>02290     <a class="code" href="../../d2/d47/compile_8c.html#ac32b1f7d8de8f10f33a147030d8b7544">INIT_ANCHOR</a>(anchor);
<a name="l02291"></a>02291     <span class="keywordflow">if</span> (<a class="code" href="../../d3/d09/ripper_8y.html#ade12c589b26f55f089dc25d689249c11">nd_type</a>(node) != <a class="code" href="../../d3/d09/ripper_8y.html#acb7153a88fb24c846bd6751ca2fa9316">NODE_ZARRAY</a>) {
<a name="l02292"></a>02292         <span class="keywordflow">while</span> (node) {
<a name="l02293"></a>02293             <span class="keywordflow">if</span> (<a class="code" href="../../d3/d09/ripper_8y.html#ade12c589b26f55f089dc25d689249c11">nd_type</a>(node) != <a class="code" href="../../d3/d09/ripper_8y.html#a490d1fc6f7f9e81a1815e9b1c3080d94">NODE_ARRAY</a>) {
<a name="l02294"></a>02294                 <a class="code" href="../../db/dcc/error_8c.html#a2d5fb28e54f792e7341b2c45f52f3860">rb_bug</a>(<span class="stringliteral">&quot;compile_array: This node is not NODE_ARRAY, but %s&quot;</span>,
<a name="l02295"></a>02295                        <a class="code" href="../../dd/d74/iseq_8c.html#a818834c71f4a58f5bd7f0aa142d1b069">ruby_node_name</a>(<a class="code" href="../../d3/d09/ripper_8y.html#ade12c589b26f55f089dc25d689249c11">nd_type</a>(node)));
<a name="l02296"></a>02296             }
<a name="l02297"></a>02297 
<a name="l02298"></a>02298             i++;
<a name="l02299"></a>02299             <span class="keywordflow">if</span> (opt_p &amp;&amp; <a class="code" href="../../d3/d09/ripper_8y.html#ade12c589b26f55f089dc25d689249c11">nd_type</a>(node-&gt;nd_head) != <a class="code" href="../../d3/d09/ripper_8y.html#af19d1c1d9f26c7b19546967449e887f6">NODE_LIT</a>) {
<a name="l02300"></a>02300                 opt_p = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aba0717d2689eb68797421a02ab9295c6">Qfalse</a>;
<a name="l02301"></a>02301             }
<a name="l02302"></a>02302             <a class="code" href="../../d2/d47/compile_8c.html#a04d4dbcbb97179b5908eb025e13c7752">COMPILE_</a>(anchor, <span class="stringliteral">&quot;array element&quot;</span>, node-&gt;nd_head, poped);
<a name="l02303"></a>02303             node = node-&gt;nd_next;
<a name="l02304"></a>02304         }
<a name="l02305"></a>02305     }
<a name="l02306"></a>02306 
<a name="l02307"></a>02307     <span class="keywordflow">if</span> (len != i) {
<a name="l02308"></a>02308         <span class="keywordflow">if</span> (0) {
<a name="l02309"></a>02309             <a class="code" href="../../db/dcc/error_8c.html#a2d5fb28e54f792e7341b2c45f52f3860">rb_bug</a>(<span class="stringliteral">&quot;node error: compile_array (%d: %d-%d)&quot;</span>,
<a name="l02310"></a>02310                    (<span class="keywordtype">int</span>)<a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node_root), len, i);
<a name="l02311"></a>02311         }
<a name="l02312"></a>02312         len = i;
<a name="l02313"></a>02313     }
<a name="l02314"></a>02314 
<a name="l02315"></a>02315     <span class="keywordflow">if</span> (opt_p == <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aacea3516b33941ce8149098e223a7466">Qtrue</a>) {
<a name="l02316"></a>02316         <span class="keywordflow">if</span> (!poped) {
<a name="l02317"></a>02317             <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> ary = <a class="code" href="../../dc/dcc/array_8c.html#aaf7e3ca42191580b60f398d5ec466766">rb_ary_tmp_new</a>(len);
<a name="l02318"></a>02318             node = node_root;
<a name="l02319"></a>02319             <span class="keywordflow">while</span> (node) {
<a name="l02320"></a>02320                 <a class="code" href="../../dc/dcc/array_8c.html#a59d553a8cd781364b8bcb0deae25cca2">rb_ary_push</a>(ary, node-&gt;nd_head-&gt;nd_lit);
<a name="l02321"></a>02321                 node = node-&gt;nd_next;
<a name="l02322"></a>02322             }
<a name="l02323"></a>02323             <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a7ae8fa209abf837905d53c1c4be7c75d">OBJ_FREEZE</a>(ary);
<a name="l02324"></a>02324             <a class="code" href="../../d2/d47/compile_8c.html#ad09bab1521a935e4affe9c1faf9a27c5">iseq_add_mark_object_compile_time</a>(iseq, ary);
<a name="l02325"></a>02325             <a class="code" href="../../d2/d47/compile_8c.html#a3cfeb7549a1249a8b78f9d6ff1e74c5a">ADD_INSN1</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node_root), duparray, ary);
<a name="l02326"></a>02326         }
<a name="l02327"></a>02327     }
<a name="l02328"></a>02328     <span class="keywordflow">else</span> {
<a name="l02329"></a>02329         <span class="keywordflow">if</span> (!poped) {
<a name="l02330"></a>02330             <a class="code" href="../../d2/d47/compile_8c.html#a3cfeb7549a1249a8b78f9d6ff1e74c5a">ADD_INSN1</a>(anchor, line, newarray, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(len));
<a name="l02331"></a>02331         }
<a name="l02332"></a>02332         <a class="code" href="../../d2/d47/compile_8c.html#a5a7f256f8f8db0e88898549ee18cdf36">APPEND_LIST</a>(ret, anchor);
<a name="l02333"></a>02333     }
<a name="l02334"></a>02334     <span class="keywordflow">return</span> len;
<a name="l02335"></a>02335 }
<a name="l02336"></a>02336 
<a name="l02337"></a>02337 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l02338"></a><a class="code" href="../../d2/d47/compile_8c.html#a8972c4295ae6e3b0a8eb9fa97586b425">02338</a> <a class="code" href="../../d2/d47/compile_8c.html#a8972c4295ae6e3b0a8eb9fa97586b425">compile_array</a>(<a class="code" href="../../d6/de3/structrb__iseq__struct.html">rb_iseq_t</a> *iseq, <a class="code" href="../../d4/dcd/structiseq__link__anchor.html">LINK_ANCHOR</a> *ret, NODE* node_root, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> opt_p)
<a name="l02339"></a>02339 {
<a name="l02340"></a>02340     <span class="keywordflow">return</span> <a class="code" href="../../d2/d47/compile_8c.html#ab151d20b137ab6de8217e03665a5d1da">compile_array_</a>(iseq, ret, node_root, opt_p, 0);
<a name="l02341"></a>02341 }
<a name="l02342"></a>02342 
<a name="l02343"></a>02343 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l02344"></a><a class="code" href="../../d2/d47/compile_8c.html#aae96ae83a5e93e8f03db9108fcd7838d">02344</a> <a class="code" href="../../d2/d47/compile_8c.html#aae96ae83a5e93e8f03db9108fcd7838d">case_when_optimizable_literal</a>(NODE * <a class="code" href="../../d7/dc0/parse_8y.html#a0d7af8a92c4b0a07f71585584ef9634f">node</a>)
<a name="l02345"></a>02345 {
<a name="l02346"></a>02346     <span class="keywordflow">switch</span> (<a class="code" href="../../d3/d09/ripper_8y.html#ade12c589b26f55f089dc25d689249c11">nd_type</a>(node)) {
<a name="l02347"></a>02347       <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#af19d1c1d9f26c7b19546967449e887f6">NODE_LIT</a>: {
<a name="l02348"></a>02348         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> v = node-&gt;nd_lit;
<a name="l02349"></a>02349         <span class="keywordtype">double</span> ival;
<a name="l02350"></a>02350         <span class="keywordflow">if</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a394faf7191f18552a20cb17ce14226f0">TYPE</a>(v) == <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3d072e0c25cf678e9b8601b957b92eae">T_FLOAT</a> &amp;&amp;
<a name="l02351"></a>02351             modf(<a class="code" href="../../d8/df4/generator_8h.html#a74258e532cd500e1cdfd6dcda7e97873">RFLOAT_VALUE</a>(v), &amp;ival) == 0.0) {
<a name="l02352"></a>02352             <span class="keywordflow">return</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac493d4e1ca36d6a84215aad4e6ea1b4d">FIXABLE</a>(ival) ? <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a2ead2f64c81efed352e79e89f29b8fc8">LONG2FIX</a>((<span class="keywordtype">long</span>)ival) : <a class="code" href="../../d1/dcc/bignum_8c.html#a7cf59f449a9f516aa7d781db3357dd94">rb_dbl2big</a>(ival);
<a name="l02353"></a>02353         }
<a name="l02354"></a>02354         <span class="keywordflow">if</span> (<a class="code" href="../../dc/d0c/cparse_8c.html#a637bc5a232034ee3fd411f8bef091566">SYMBOL_P</a>(v) || <a class="code" href="../../db/d2e/intern_8h.html#a6e65fc310dd65ebd60d68ada991da6f6">rb_obj_is_kind_of</a>(v, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a6e2fb52974af4f37fee056d8b734e913">rb_cNumeric</a>)) {
<a name="l02355"></a>02355             <span class="keywordflow">return</span> v;
<a name="l02356"></a>02356         }
<a name="l02357"></a>02357         <span class="keywordflow">break</span>;
<a name="l02358"></a>02358       }
<a name="l02359"></a>02359       <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#aac55f53b58d8cbef84a61f2d744e7643">NODE_STR</a>:
<a name="l02360"></a>02360         <span class="keywordflow">return</span> node-&gt;nd_lit;
<a name="l02361"></a>02361     }
<a name="l02362"></a>02362     <span class="keywordflow">return</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aba0717d2689eb68797421a02ab9295c6">Qfalse</a>;
<a name="l02363"></a>02363 }
<a name="l02364"></a>02364 
<a name="l02365"></a>02365 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l02366"></a><a class="code" href="../../d2/d47/compile_8c.html#a21972232fac29e2ab889b2e059dc7d1f">02366</a> <a class="code" href="../../d2/d47/compile_8c.html#a21972232fac29e2ab889b2e059dc7d1f">when_vals</a>(<a class="code" href="../../d6/de3/structrb__iseq__struct.html">rb_iseq_t</a> *iseq, <a class="code" href="../../d4/dcd/structiseq__link__anchor.html">LINK_ANCHOR</a> *cond_seq, NODE *vals, <a class="code" href="../../d8/dc5/structiseq__label__data.html">LABEL</a> *l1, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> special_literals)
<a name="l02367"></a>02367 {
<a name="l02368"></a>02368     <span class="keywordflow">while</span> (vals) {
<a name="l02369"></a>02369         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> lit;
<a name="l02370"></a>02370         NODE* val;
<a name="l02371"></a>02371 
<a name="l02372"></a>02372         val = vals-&gt;nd_head;
<a name="l02373"></a>02373 
<a name="l02374"></a>02374         <span class="keywordflow">if</span> (special_literals &amp;&amp;
<a name="l02375"></a>02375             (lit = <a class="code" href="../../d2/d47/compile_8c.html#aae96ae83a5e93e8f03db9108fcd7838d">case_when_optimizable_literal</a>(val)) != <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aba0717d2689eb68797421a02ab9295c6">Qfalse</a>) {
<a name="l02376"></a>02376             <a class="code" href="../../dc/dcc/array_8c.html#a59d553a8cd781364b8bcb0deae25cca2">rb_ary_push</a>(special_literals, lit);
<a name="l02377"></a>02377             <a class="code" href="../../dc/dcc/array_8c.html#a59d553a8cd781364b8bcb0deae25cca2">rb_ary_push</a>(special_literals, (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>)(l1) | 1);
<a name="l02378"></a>02378         }
<a name="l02379"></a>02379         <span class="keywordflow">else</span> {
<a name="l02380"></a>02380             special_literals = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aba0717d2689eb68797421a02ab9295c6">Qfalse</a>;
<a name="l02381"></a>02381         }
<a name="l02382"></a>02382 
<a name="l02383"></a>02383         <span class="keywordflow">if</span> (<a class="code" href="../../d3/d09/ripper_8y.html#ade12c589b26f55f089dc25d689249c11">nd_type</a>(val) == <a class="code" href="../../d3/d09/ripper_8y.html#aac55f53b58d8cbef84a61f2d744e7643">NODE_STR</a>) {
<a name="l02384"></a>02384             <a class="code" href="../../d2/d47/compile_8c.html#ad983bdc29f9c5bde5ab33d14c3d143e6">debugp_param</a>(<span class="stringliteral">&quot;nd_lit&quot;</span>, val-&gt;nd_lit);
<a name="l02385"></a>02385             <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a7ae8fa209abf837905d53c1c4be7c75d">OBJ_FREEZE</a>(val-&gt;nd_lit);
<a name="l02386"></a>02386             <a class="code" href="../../d2/d47/compile_8c.html#a3cfeb7549a1249a8b78f9d6ff1e74c5a">ADD_INSN1</a>(cond_seq, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(val), putobject, val-&gt;nd_lit);
<a name="l02387"></a>02387         }
<a name="l02388"></a>02388         <span class="keywordflow">else</span> {
<a name="l02389"></a>02389             <a class="code" href="../../d2/d47/compile_8c.html#a0cacd6cfca69df35e1535d2f21532c47">COMPILE</a>(cond_seq, <span class="stringliteral">&quot;when cond&quot;</span>, val);
<a name="l02390"></a>02390         }
<a name="l02391"></a>02391         <a class="code" href="../../d2/d47/compile_8c.html#a3cfeb7549a1249a8b78f9d6ff1e74c5a">ADD_INSN1</a>(cond_seq, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(val), topn, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(1));
<a name="l02392"></a>02392         <a class="code" href="../../d2/d47/compile_8c.html#ab1941f9308f4508ab33b8828fec890fd">ADD_SEND</a>(cond_seq, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(val), <a class="code" href="../../dc/d0c/cparse_8c.html#a48bfb6519a45249fb2ec0193ea3b6e1c">ID2SYM</a>(<a class="code" href="../../df/db9/id_8h.html#a08dd4fbd61c5fde369edd59783f753b3a6a442640966dae6e53624fd67cdd960a">idEqq</a>), <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(1));
<a name="l02393"></a>02393         <a class="code" href="../../d2/d47/compile_8c.html#ace57e2f70722586d3764284364cfb5ad">ADD_INSNL</a>(cond_seq, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(val), branchif, l1);
<a name="l02394"></a>02394         vals = vals-&gt;nd_next;
<a name="l02395"></a>02395     }
<a name="l02396"></a>02396     <span class="keywordflow">return</span> special_literals;
<a name="l02397"></a>02397 }
<a name="l02398"></a>02398 
<a name="l02399"></a>02399 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l02400"></a><a class="code" href="../../d2/d47/compile_8c.html#a726ab95c42bd714d1fa949c17d83b1ad">02400</a> <a class="code" href="../../d2/d47/compile_8c.html#a726ab95c42bd714d1fa949c17d83b1ad">compile_massign_lhs</a>(<a class="code" href="../../d6/de3/structrb__iseq__struct.html">rb_iseq_t</a> *iseq, <a class="code" href="../../d4/dcd/structiseq__link__anchor.html">LINK_ANCHOR</a> *ret, NODE *<a class="code" href="../../d7/dc0/parse_8y.html#a0d7af8a92c4b0a07f71585584ef9634f">node</a>)
<a name="l02401"></a>02401 {
<a name="l02402"></a>02402     <span class="keywordflow">switch</span> (<a class="code" href="../../d3/d09/ripper_8y.html#ade12c589b26f55f089dc25d689249c11">nd_type</a>(node)) {
<a name="l02403"></a>02403       <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#a1423dff9c55fd36cca257ffb758ca4a6">NODE_ATTRASGN</a>: {
<a name="l02404"></a>02404         <a class="code" href="../../db/d57/structiseq__insn__data.html">INSN</a> *iobj;
<a name="l02405"></a>02405         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> dupidx;
<a name="l02406"></a>02406 
<a name="l02407"></a>02407         <a class="code" href="../../d2/d47/compile_8c.html#a4e7115fce9f91ee84931798cc3474229">COMPILE_POPED</a>(ret, <span class="stringliteral">&quot;masgn lhs (NODE_ATTRASGN)&quot;</span>, node);
<a name="l02408"></a>02408         <a class="code" href="../../d2/d47/compile_8c.html#a56c34aaed1ac9f929e9f73c680fb32c3">POP_ELEMENT</a>(ret);        <span class="comment">/* pop pop insn */</span>
<a name="l02409"></a>02409         iobj = (<a class="code" href="../../db/d57/structiseq__insn__data.html">INSN</a> *)<a class="code" href="../../d2/d47/compile_8c.html#a56c34aaed1ac9f929e9f73c680fb32c3">POP_ELEMENT</a>(ret); <span class="comment">/* pop send insn */</span>
<a name="l02410"></a>02410 
<a name="l02411"></a>02411         dupidx = iobj-&gt;<a class="code" href="../../db/d57/structiseq__insn__data.html#ae83a50dd669328f4915717f99d8805c5">operands</a>[1];
<a name="l02412"></a>02412         dupidx = <a class="code" href="../../d2/d47/compile_8c.html#acd55fe1710206f036b5e80795eae3284">FIXNUM_INC</a>(dupidx, 1);
<a name="l02413"></a>02413         iobj-&gt;<a class="code" href="../../db/d57/structiseq__insn__data.html#ae83a50dd669328f4915717f99d8805c5">operands</a>[1] = dupidx;
<a name="l02414"></a>02414 
<a name="l02415"></a>02415         <a class="code" href="../../d2/d47/compile_8c.html#a3cfeb7549a1249a8b78f9d6ff1e74c5a">ADD_INSN1</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), topn, dupidx);
<a name="l02416"></a>02416         <a class="code" href="../../d2/d47/compile_8c.html#a46920e7a34d0b9584a59215104163d11">ADD_ELEM</a>(ret, (<a class="code" href="../../dc/dd8/structiseq__link__element.html">LINK_ELEMENT</a> *)iobj);
<a name="l02417"></a>02417         <a class="code" href="../../d2/d47/compile_8c.html#aa5b45ae61de3350f0830a32589bbb7ee">ADD_INSN</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), pop);      <span class="comment">/* result */</span>
<a name="l02418"></a>02418         <a class="code" href="../../d2/d47/compile_8c.html#aa5b45ae61de3350f0830a32589bbb7ee">ADD_INSN</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), pop);      <span class="comment">/* rhs    */</span>
<a name="l02419"></a>02419         <span class="keywordflow">break</span>;
<a name="l02420"></a>02420       }
<a name="l02421"></a>02421       <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#ad03c15faf9f8ca478889f491431b406b">NODE_MASGN</a>: {
<a name="l02422"></a>02422         <a class="code" href="../../d2/d47/compile_8c.html#aa9d6014cec8d3adcb228b81620eac795">DECL_ANCHOR</a>(anchor);
<a name="l02423"></a>02423         <a class="code" href="../../d2/d47/compile_8c.html#ac32b1f7d8de8f10f33a147030d8b7544">INIT_ANCHOR</a>(anchor);
<a name="l02424"></a>02424         <a class="code" href="../../d2/d47/compile_8c.html#a4e7115fce9f91ee84931798cc3474229">COMPILE_POPED</a>(anchor, <span class="stringliteral">&quot;nest masgn lhs&quot;</span>, node);
<a name="l02425"></a>02425         <a class="code" href="../../d2/d47/compile_8c.html#aeb2ab21cdb1acd4dd79c5605c7db4cf5">REMOVE_ELEM</a>(<a class="code" href="../../d2/d47/compile_8c.html#a7dd2b3352ea85a0b8f87dc549b9c4f1e">FIRST_ELEMENT</a>(anchor));
<a name="l02426"></a>02426         <a class="code" href="../../d2/d47/compile_8c.html#afd9d72d069724385c83bcc32d6746b1e">ADD_SEQ</a>(ret, anchor);
<a name="l02427"></a>02427         <span class="keywordflow">break</span>;
<a name="l02428"></a>02428       }
<a name="l02429"></a>02429       <span class="keywordflow">default</span>: {
<a name="l02430"></a>02430         <a class="code" href="../../d2/d47/compile_8c.html#aa9d6014cec8d3adcb228b81620eac795">DECL_ANCHOR</a>(anchor);
<a name="l02431"></a>02431         <a class="code" href="../../d2/d47/compile_8c.html#ac32b1f7d8de8f10f33a147030d8b7544">INIT_ANCHOR</a>(anchor);
<a name="l02432"></a>02432         <a class="code" href="../../d2/d47/compile_8c.html#a4e7115fce9f91ee84931798cc3474229">COMPILE_POPED</a>(anchor, <span class="stringliteral">&quot;masgn lhs&quot;</span>, node);
<a name="l02433"></a>02433         <a class="code" href="../../d2/d47/compile_8c.html#aeb2ab21cdb1acd4dd79c5605c7db4cf5">REMOVE_ELEM</a>(<a class="code" href="../../d2/d47/compile_8c.html#a7dd2b3352ea85a0b8f87dc549b9c4f1e">FIRST_ELEMENT</a>(anchor));
<a name="l02434"></a>02434         <a class="code" href="../../d2/d47/compile_8c.html#afd9d72d069724385c83bcc32d6746b1e">ADD_SEQ</a>(ret, anchor);
<a name="l02435"></a>02435       }
<a name="l02436"></a>02436     }
<a name="l02437"></a>02437 
<a name="l02438"></a>02438     <span class="keywordflow">return</span> <a class="code" href="../../d2/d47/compile_8c.html#a652dda0d529b866959c19fe27293968e">COMPILE_OK</a>;
<a name="l02439"></a>02439 }
<a name="l02440"></a>02440 
<a name="l02441"></a>02441 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l02442"></a><a class="code" href="../../d2/d47/compile_8c.html#a104e0a026797ae3d059b0f6657004cf9">02442</a> <a class="code" href="../../d2/d47/compile_8c.html#a104e0a026797ae3d059b0f6657004cf9">compile_massign_opt_lhs</a>(<a class="code" href="../../d6/de3/structrb__iseq__struct.html">rb_iseq_t</a> *iseq, <a class="code" href="../../d4/dcd/structiseq__link__anchor.html">LINK_ANCHOR</a> *ret, NODE *lhsn)
<a name="l02443"></a>02443 {
<a name="l02444"></a>02444     <span class="keywordflow">if</span> (lhsn) {
<a name="l02445"></a>02445         <a class="code" href="../../d2/d47/compile_8c.html#a104e0a026797ae3d059b0f6657004cf9">compile_massign_opt_lhs</a>(iseq, ret, lhsn-&gt;nd_next);
<a name="l02446"></a>02446         <a class="code" href="../../d2/d47/compile_8c.html#a726ab95c42bd714d1fa949c17d83b1ad">compile_massign_lhs</a>(iseq, ret, lhsn-&gt;nd_head);
<a name="l02447"></a>02447     }
<a name="l02448"></a>02448 }
<a name="l02449"></a>02449 
<a name="l02450"></a>02450 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l02451"></a><a class="code" href="../../d2/d47/compile_8c.html#a31142c0dbf1c979f729cd72f54658475">02451</a> <a class="code" href="../../d2/d47/compile_8c.html#a31142c0dbf1c979f729cd72f54658475">compile_massign_opt</a>(<a class="code" href="../../d6/de3/structrb__iseq__struct.html">rb_iseq_t</a> *iseq, <a class="code" href="../../d4/dcd/structiseq__link__anchor.html">LINK_ANCHOR</a> *ret,
<a name="l02452"></a>02452                     NODE *rhsn, NODE *orig_lhsn)
<a name="l02453"></a>02453 {
<a name="l02454"></a>02454     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> mem[64];
<a name="l02455"></a>02455     <span class="keyword">const</span> <span class="keywordtype">int</span> memsize = <a class="code" href="../../dc/dcc/array_8c.html#a4ac8fee05a285361c33a2b0d9c2d555c">numberof</a>(mem);
<a name="l02456"></a>02456     <span class="keywordtype">int</span> memindex = 0;
<a name="l02457"></a>02457     <span class="keywordtype">int</span> llen = 0, rlen = 0;
<a name="l02458"></a>02458     <span class="keywordtype">int</span> i;
<a name="l02459"></a>02459     NODE *lhsn = orig_lhsn;
<a name="l02460"></a>02460 
<a name="l02461"></a>02461 <span class="preprocessor">#define MEMORY(v) { \</span>
<a name="l02462"></a>02462 <span class="preprocessor">    int i; \</span>
<a name="l02463"></a>02463 <span class="preprocessor">    if (memindex == memsize) return 0; \</span>
<a name="l02464"></a>02464 <span class="preprocessor">    for (i=0; i&lt;memindex; i++) { \</span>
<a name="l02465"></a>02465 <span class="preprocessor">        if (mem[i] == (v)) return 0; \</span>
<a name="l02466"></a>02466 <span class="preprocessor">    } \</span>
<a name="l02467"></a>02467 <span class="preprocessor">    mem[memindex++] = (v); \</span>
<a name="l02468"></a>02468 <span class="preprocessor">}</span>
<a name="l02469"></a>02469 <span class="preprocessor"></span>
<a name="l02470"></a>02470     <span class="keywordflow">if</span> (rhsn == 0 || <a class="code" href="../../d3/d09/ripper_8y.html#ade12c589b26f55f089dc25d689249c11">nd_type</a>(rhsn) != <a class="code" href="../../d3/d09/ripper_8y.html#a490d1fc6f7f9e81a1815e9b1c3080d94">NODE_ARRAY</a>) {
<a name="l02471"></a>02471         <span class="keywordflow">return</span> 0;
<a name="l02472"></a>02472     }
<a name="l02473"></a>02473 
<a name="l02474"></a>02474     <span class="keywordflow">while</span> (lhsn) {
<a name="l02475"></a>02475         NODE *ln = lhsn-&gt;nd_head;
<a name="l02476"></a>02476         <span class="keywordflow">switch</span> (<a class="code" href="../../d3/d09/ripper_8y.html#ade12c589b26f55f089dc25d689249c11">nd_type</a>(ln)) {
<a name="l02477"></a>02477           <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#aa9d208a2eb1e5266beea027e10f3d472">NODE_LASGN</a>:
<a name="l02478"></a>02478             <a class="code" href="../../d2/d47/compile_8c.html#a695befb3e72d35677a7f91d90eb66f6a">MEMORY</a>(ln-&gt;nd_vid);
<a name="l02479"></a>02479             <span class="keywordflow">break</span>;
<a name="l02480"></a>02480           <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#af92abe71c6571a24b59b4eb4ebb5908f">NODE_DASGN</a>:
<a name="l02481"></a>02481           <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#aa69a9128d7cd7376dc4d76e65d90e994">NODE_DASGN_CURR</a>:
<a name="l02482"></a>02482           <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#a4e3d1029dca72147900e9b1a840bf968">NODE_IASGN</a>:
<a name="l02483"></a>02483           <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#a015923f7f402969debebc4d989678ea4">NODE_IASGN2</a>:
<a name="l02484"></a>02484           <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#ae0d7af3d0cea1ce334874826929507bf">NODE_CVASGN</a>:
<a name="l02485"></a>02485             <a class="code" href="../../d2/d47/compile_8c.html#a695befb3e72d35677a7f91d90eb66f6a">MEMORY</a>(ln-&gt;nd_vid);
<a name="l02486"></a>02486             <span class="keywordflow">break</span>;
<a name="l02487"></a>02487           <span class="keywordflow">default</span>:
<a name="l02488"></a>02488             <span class="keywordflow">return</span> 0;
<a name="l02489"></a>02489         }
<a name="l02490"></a>02490         lhsn = lhsn-&gt;nd_next;
<a name="l02491"></a>02491         llen++;
<a name="l02492"></a>02492     }
<a name="l02493"></a>02493 
<a name="l02494"></a>02494     <span class="keywordflow">while</span> (rhsn) {
<a name="l02495"></a>02495         <span class="keywordflow">if</span> (llen &lt;= rlen) {
<a name="l02496"></a>02496             <a class="code" href="../../d2/d47/compile_8c.html#a4e7115fce9f91ee84931798cc3474229">COMPILE_POPED</a>(ret, <span class="stringliteral">&quot;masgn val (popped)&quot;</span>, rhsn-&gt;nd_head);
<a name="l02497"></a>02497         }
<a name="l02498"></a>02498         <span class="keywordflow">else</span> {
<a name="l02499"></a>02499             <a class="code" href="../../d2/d47/compile_8c.html#a0cacd6cfca69df35e1535d2f21532c47">COMPILE</a>(ret, <span class="stringliteral">&quot;masgn val&quot;</span>, rhsn-&gt;nd_head);
<a name="l02500"></a>02500         }
<a name="l02501"></a>02501         rhsn = rhsn-&gt;nd_next;
<a name="l02502"></a>02502         rlen++;
<a name="l02503"></a>02503     }
<a name="l02504"></a>02504 
<a name="l02505"></a>02505     <span class="keywordflow">if</span> (llen &gt; rlen) {
<a name="l02506"></a>02506         <span class="keywordflow">for</span> (i=0; i&lt;llen-rlen; i++) {
<a name="l02507"></a>02507             <a class="code" href="../../d2/d47/compile_8c.html#aa5b45ae61de3350f0830a32589bbb7ee">ADD_INSN</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(orig_lhsn), putnil);
<a name="l02508"></a>02508         }
<a name="l02509"></a>02509     }
<a name="l02510"></a>02510 
<a name="l02511"></a>02511     <a class="code" href="../../d2/d47/compile_8c.html#a104e0a026797ae3d059b0f6657004cf9">compile_massign_opt_lhs</a>(iseq, ret, orig_lhsn);
<a name="l02512"></a>02512     <span class="keywordflow">return</span> 1;
<a name="l02513"></a>02513 }
<a name="l02514"></a>02514 
<a name="l02515"></a>02515 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l02516"></a><a class="code" href="../../d2/d47/compile_8c.html#adc82350e5a894e2307b8c17344aad326">02516</a> <a class="code" href="../../d2/d47/compile_8c.html#adc82350e5a894e2307b8c17344aad326">compile_massign</a>(<a class="code" href="../../d6/de3/structrb__iseq__struct.html">rb_iseq_t</a> *iseq, <a class="code" href="../../d4/dcd/structiseq__link__anchor.html">LINK_ANCHOR</a> *ret, NODE *<a class="code" href="../../d7/dc0/parse_8y.html#a0d7af8a92c4b0a07f71585584ef9634f">node</a>, <span class="keywordtype">int</span> poped)
<a name="l02517"></a>02517 {
<a name="l02518"></a>02518     NODE *rhsn = node-&gt;nd_value;
<a name="l02519"></a>02519     NODE *splatn = node-&gt;nd_args;
<a name="l02520"></a>02520     NODE *lhsn = node-&gt;nd_head;
<a name="l02521"></a>02521     <span class="keywordtype">int</span> lhs_splat = (splatn &amp;&amp; (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>)splatn != (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>)-1) ? 1 : 0;
<a name="l02522"></a>02522 
<a name="l02523"></a>02523     <span class="keywordflow">if</span> (!poped || splatn || !<a class="code" href="../../d2/d47/compile_8c.html#a31142c0dbf1c979f729cd72f54658475">compile_massign_opt</a>(iseq, ret, rhsn, lhsn)) {
<a name="l02524"></a>02524         <span class="keywordtype">int</span> llen = 0;
<a name="l02525"></a>02525         <a class="code" href="../../d2/d47/compile_8c.html#aa9d6014cec8d3adcb228b81620eac795">DECL_ANCHOR</a>(lhsseq);
<a name="l02526"></a>02526 
<a name="l02527"></a>02527         <a class="code" href="../../d2/d47/compile_8c.html#ac32b1f7d8de8f10f33a147030d8b7544">INIT_ANCHOR</a>(lhsseq);
<a name="l02528"></a>02528 
<a name="l02529"></a>02529         <span class="keywordflow">while</span> (lhsn) {
<a name="l02530"></a>02530             <a class="code" href="../../d2/d47/compile_8c.html#a726ab95c42bd714d1fa949c17d83b1ad">compile_massign_lhs</a>(iseq, lhsseq, lhsn-&gt;nd_head);
<a name="l02531"></a>02531             llen += 1;
<a name="l02532"></a>02532             lhsn = lhsn-&gt;nd_next;
<a name="l02533"></a>02533         }
<a name="l02534"></a>02534 
<a name="l02535"></a>02535         <a class="code" href="../../d2/d47/compile_8c.html#a0cacd6cfca69df35e1535d2f21532c47">COMPILE</a>(ret, <span class="stringliteral">&quot;normal masgn rhs&quot;</span>, rhsn);
<a name="l02536"></a>02536 
<a name="l02537"></a>02537         <span class="keywordflow">if</span> (!poped) {
<a name="l02538"></a>02538             <a class="code" href="../../d2/d47/compile_8c.html#aa5b45ae61de3350f0830a32589bbb7ee">ADD_INSN</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), dup);
<a name="l02539"></a>02539         }
<a name="l02540"></a>02540 
<a name="l02541"></a>02541         <a class="code" href="../../d2/d47/compile_8c.html#a9e17ccfd8b31ec3afcb91be39a6d453f">ADD_INSN2</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), expandarray,
<a name="l02542"></a>02542                   <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(llen), <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(lhs_splat));
<a name="l02543"></a>02543         <a class="code" href="../../d2/d47/compile_8c.html#afd9d72d069724385c83bcc32d6746b1e">ADD_SEQ</a>(ret, lhsseq);
<a name="l02544"></a>02544 
<a name="l02545"></a>02545         <span class="keywordflow">if</span> (lhs_splat) {
<a name="l02546"></a>02546             <span class="keywordflow">if</span> (<a class="code" href="../../d3/d09/ripper_8y.html#ade12c589b26f55f089dc25d689249c11">nd_type</a>(splatn) == <a class="code" href="../../d3/d09/ripper_8y.html#abe6cc100457a63dd4d47006cfd6a0a66">NODE_POSTARG</a>) {
<a name="l02547"></a>02547                 <span class="comment">/*a, b, *r, p1, p2 */</span>
<a name="l02548"></a>02548                 NODE *postn = splatn-&gt;nd_2nd;
<a name="l02549"></a>02549                 NODE *restn = splatn-&gt;nd_1st;
<a name="l02550"></a>02550                 <span class="keywordtype">int</span> num = (int)postn-&gt;nd_alen;
<a name="l02551"></a>02551                 <span class="keywordtype">int</span> flag = 0x02 | (((<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>)restn == (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>)-1) ? 0x00 : 0x01);
<a name="l02552"></a>02552 
<a name="l02553"></a>02553                 <a class="code" href="../../d2/d47/compile_8c.html#a9e17ccfd8b31ec3afcb91be39a6d453f">ADD_INSN2</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(splatn), expandarray,
<a name="l02554"></a>02554                           <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(num), <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(flag));
<a name="l02555"></a>02555 
<a name="l02556"></a>02556                 <span class="keywordflow">if</span> ((<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>)restn != (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>)-1) {
<a name="l02557"></a>02557                     <a class="code" href="../../d2/d47/compile_8c.html#a726ab95c42bd714d1fa949c17d83b1ad">compile_massign_lhs</a>(iseq, ret, restn);
<a name="l02558"></a>02558                 }
<a name="l02559"></a>02559                 <span class="keywordflow">while</span> (postn) {
<a name="l02560"></a>02560                     <a class="code" href="../../d2/d47/compile_8c.html#a726ab95c42bd714d1fa949c17d83b1ad">compile_massign_lhs</a>(iseq, ret, postn-&gt;nd_head);
<a name="l02561"></a>02561                     postn = postn-&gt;nd_next;
<a name="l02562"></a>02562                 }
<a name="l02563"></a>02563             }
<a name="l02564"></a>02564             <span class="keywordflow">else</span> {
<a name="l02565"></a>02565                 <span class="comment">/* a, b, *r */</span>
<a name="l02566"></a>02566                 <a class="code" href="../../d2/d47/compile_8c.html#a726ab95c42bd714d1fa949c17d83b1ad">compile_massign_lhs</a>(iseq, ret, splatn);
<a name="l02567"></a>02567             }
<a name="l02568"></a>02568         }
<a name="l02569"></a>02569     }
<a name="l02570"></a>02570     <span class="keywordflow">return</span> <a class="code" href="../../d2/d47/compile_8c.html#a652dda0d529b866959c19fe27293968e">COMPILE_OK</a>;
<a name="l02571"></a>02571 }
<a name="l02572"></a>02572 
<a name="l02573"></a>02573 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l02574"></a><a class="code" href="../../d2/d47/compile_8c.html#ad175301f7101076cc58a47ba7c741a0a">02574</a> <a class="code" href="../../d2/d47/compile_8c.html#ad175301f7101076cc58a47ba7c741a0a">compile_colon2</a>(<a class="code" href="../../d6/de3/structrb__iseq__struct.html">rb_iseq_t</a> *iseq, NODE * <a class="code" href="../../d7/dc0/parse_8y.html#a0d7af8a92c4b0a07f71585584ef9634f">node</a>,
<a name="l02575"></a>02575                <a class="code" href="../../d4/dcd/structiseq__link__anchor.html">LINK_ANCHOR</a> *pref, <a class="code" href="../../d4/dcd/structiseq__link__anchor.html">LINK_ANCHOR</a> *body)
<a name="l02576"></a>02576 {
<a name="l02577"></a>02577     <span class="keywordflow">switch</span> (<a class="code" href="../../d3/d09/ripper_8y.html#ade12c589b26f55f089dc25d689249c11">nd_type</a>(node)) {
<a name="l02578"></a>02578       <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#a4162517fa8cb8e9bc4b9d9f6e8c32692">NODE_CONST</a>:
<a name="l02579"></a>02579         <a class="code" href="../../d2/d47/compile_8c.html#a9156fef334af9c349bedf159ff008bb4">debugi</a>(<span class="stringliteral">&quot;compile_colon2 - colon&quot;</span>, node-&gt;nd_vid);
<a name="l02580"></a>02580         <a class="code" href="../../d2/d47/compile_8c.html#a3cfeb7549a1249a8b78f9d6ff1e74c5a">ADD_INSN1</a>(body, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), getconstant, <a class="code" href="../../dc/d0c/cparse_8c.html#a48bfb6519a45249fb2ec0193ea3b6e1c">ID2SYM</a>(node-&gt;nd_vid));
<a name="l02581"></a>02581         <span class="keywordflow">break</span>;
<a name="l02582"></a>02582       <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#a614c6f2b1367102fbde526a5eb2871af">NODE_COLON3</a>:
<a name="l02583"></a>02583         <a class="code" href="../../d2/d47/compile_8c.html#a9156fef334af9c349bedf159ff008bb4">debugi</a>(<span class="stringliteral">&quot;compile_colon2 - colon3&quot;</span>, node-&gt;nd_mid);
<a name="l02584"></a>02584         <a class="code" href="../../d2/d47/compile_8c.html#aa5b45ae61de3350f0830a32589bbb7ee">ADD_INSN</a>(body, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), pop);
<a name="l02585"></a>02585         <a class="code" href="../../d2/d47/compile_8c.html#a3cfeb7549a1249a8b78f9d6ff1e74c5a">ADD_INSN1</a>(body, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), putobject, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a57c96ead3ef230b4838e65fe037c346e">rb_cObject</a>);
<a name="l02586"></a>02586         <a class="code" href="../../d2/d47/compile_8c.html#a3cfeb7549a1249a8b78f9d6ff1e74c5a">ADD_INSN1</a>(body, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), getconstant, <a class="code" href="../../dc/d0c/cparse_8c.html#a48bfb6519a45249fb2ec0193ea3b6e1c">ID2SYM</a>(node-&gt;nd_mid));
<a name="l02587"></a>02587         <span class="keywordflow">break</span>;
<a name="l02588"></a>02588       <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#aff107642c64833eb6f64e7043c4d2b5c">NODE_COLON2</a>:
<a name="l02589"></a>02589         <a class="code" href="../../d2/d47/compile_8c.html#ad175301f7101076cc58a47ba7c741a0a">compile_colon2</a>(iseq, node-&gt;nd_head, pref, body);
<a name="l02590"></a>02590         <a class="code" href="../../d2/d47/compile_8c.html#a9156fef334af9c349bedf159ff008bb4">debugi</a>(<span class="stringliteral">&quot;compile_colon2 - colon2&quot;</span>, node-&gt;nd_mid);
<a name="l02591"></a>02591         <a class="code" href="../../d2/d47/compile_8c.html#a3cfeb7549a1249a8b78f9d6ff1e74c5a">ADD_INSN1</a>(body, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), getconstant, <a class="code" href="../../dc/d0c/cparse_8c.html#a48bfb6519a45249fb2ec0193ea3b6e1c">ID2SYM</a>(node-&gt;nd_mid));
<a name="l02592"></a>02592         <span class="keywordflow">break</span>;
<a name="l02593"></a>02593       <span class="keywordflow">default</span>:
<a name="l02594"></a>02594         <a class="code" href="../../d2/d47/compile_8c.html#a0cacd6cfca69df35e1535d2f21532c47">COMPILE</a>(pref, <span class="stringliteral">&quot;const colon2 prefix&quot;</span>, node);
<a name="l02595"></a>02595         <span class="keywordflow">break</span>;
<a name="l02596"></a>02596     }
<a name="l02597"></a>02597     <span class="keywordflow">return</span> <a class="code" href="../../d2/d47/compile_8c.html#a652dda0d529b866959c19fe27293968e">COMPILE_OK</a>;
<a name="l02598"></a>02598 }
<a name="l02599"></a>02599 
<a name="l02600"></a>02600 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l02601"></a><a class="code" href="../../d2/d47/compile_8c.html#afbd4358e854311242b62772d0b1660bc">02601</a> <a class="code" href="../../d2/d47/compile_8c.html#afbd4358e854311242b62772d0b1660bc">compile_cpath</a>(<a class="code" href="../../d4/dcd/structiseq__link__anchor.html">LINK_ANCHOR</a> *ret, <a class="code" href="../../d6/de3/structrb__iseq__struct.html">rb_iseq_t</a> *iseq, NODE *cpath)
<a name="l02602"></a>02602 {
<a name="l02603"></a>02603     <span class="keywordflow">if</span> (<a class="code" href="../../d3/d09/ripper_8y.html#ade12c589b26f55f089dc25d689249c11">nd_type</a>(cpath) == <a class="code" href="../../d3/d09/ripper_8y.html#a614c6f2b1367102fbde526a5eb2871af">NODE_COLON3</a>) {
<a name="l02604"></a>02604         <span class="comment">/* toplevel class ::Foo */</span>
<a name="l02605"></a>02605         <a class="code" href="../../d2/d47/compile_8c.html#a3cfeb7549a1249a8b78f9d6ff1e74c5a">ADD_INSN1</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(cpath), putobject, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a57c96ead3ef230b4838e65fe037c346e">rb_cObject</a>);
<a name="l02606"></a>02606         <span class="keywordflow">return</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aba0717d2689eb68797421a02ab9295c6">Qfalse</a>;
<a name="l02607"></a>02607     }
<a name="l02608"></a>02608     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (cpath-&gt;nd_head) {
<a name="l02609"></a>02609         <span class="comment">/* Bar::Foo */</span>
<a name="l02610"></a>02610         <a class="code" href="../../d2/d47/compile_8c.html#a0cacd6cfca69df35e1535d2f21532c47">COMPILE</a>(ret, <span class="stringliteral">&quot;nd_else-&gt;nd_head&quot;</span>, cpath-&gt;nd_head);
<a name="l02611"></a>02611         <span class="keywordflow">return</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aba0717d2689eb68797421a02ab9295c6">Qfalse</a>;
<a name="l02612"></a>02612     }
<a name="l02613"></a>02613     <span class="keywordflow">else</span> {
<a name="l02614"></a>02614         <span class="comment">/* class at cbase Foo */</span>
<a name="l02615"></a>02615         <a class="code" href="../../d2/d47/compile_8c.html#a3cfeb7549a1249a8b78f9d6ff1e74c5a">ADD_INSN1</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(cpath), putspecialobject,
<a name="l02616"></a>02616                   <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(<a class="code" href="../../d8/d32/vm__core_8h.html#a3aec522068d95925054562a7c650b99bae7870b1ddaa6ed7a92c75cd05b39e807">VM_SPECIAL_OBJECT_CONST_BASE</a>));
<a name="l02617"></a>02617         <span class="keywordflow">return</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aacea3516b33941ce8149098e223a7466">Qtrue</a>;
<a name="l02618"></a>02618     }
<a name="l02619"></a>02619 }
<a name="l02620"></a>02620 
<a name="l02621"></a><a class="code" href="../../d2/d47/compile_8c.html#af63fe831dd3325e6beeba0a4c6127159">02621</a> <span class="preprocessor">#define defined_expr defined_expr0</span>
<a name="l02622"></a>02622 <span class="preprocessor"></span><span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l02623"></a>02623 <a class="code" href="../../d2/d47/compile_8c.html#af63fe831dd3325e6beeba0a4c6127159">defined_expr</a>(<a class="code" href="../../d6/de3/structrb__iseq__struct.html">rb_iseq_t</a> *iseq, <a class="code" href="../../d4/dcd/structiseq__link__anchor.html">LINK_ANCHOR</a> *ret,
<a name="l02624"></a>02624              NODE *<a class="code" href="../../d7/dc0/parse_8y.html#a0d7af8a92c4b0a07f71585584ef9634f">node</a>, <a class="code" href="../../d8/dc5/structiseq__label__data.html">LABEL</a> **lfinish, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> needstr)
<a name="l02625"></a>02625 {
<a name="l02626"></a>02626     <span class="keyword">const</span> <span class="keywordtype">char</span> *estr = 0;
<a name="l02627"></a>02627     <span class="keyword">enum</span> <a class="code" href="../../d1/d72/debug_8c.html#a3dae8bc7c708705be3a6e1688378868e">node_type</a> <a class="code" href="../../d5/d9d/tcltklib_8c.html#ac765329451135abec74c45e1897abf26">type</a>;
<a name="l02628"></a>02628 
<a name="l02629"></a>02629     <span class="keywordflow">switch</span> (type = <a class="code" href="../../d3/d09/ripper_8y.html#ade12c589b26f55f089dc25d689249c11">nd_type</a>(node)) {
<a name="l02630"></a>02630 
<a name="l02631"></a>02631         <span class="comment">/* easy literals */</span>
<a name="l02632"></a>02632       <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#a52160547548851ab924923b8ca1dcb42">NODE_NIL</a>:
<a name="l02633"></a>02633         estr = <span class="stringliteral">&quot;nil&quot;</span>;
<a name="l02634"></a>02634         <span class="keywordflow">break</span>;
<a name="l02635"></a>02635       <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#a4beb90d7425a19420390f5f402c7cd7b">NODE_SELF</a>:
<a name="l02636"></a>02636         estr = <span class="stringliteral">&quot;self&quot;</span>;
<a name="l02637"></a>02637         <span class="keywordflow">break</span>;
<a name="l02638"></a>02638       <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#a00911cb328ad9df305f886837c76923c">NODE_TRUE</a>:
<a name="l02639"></a>02639         estr = <span class="stringliteral">&quot;true&quot;</span>;
<a name="l02640"></a>02640         <span class="keywordflow">break</span>;
<a name="l02641"></a>02641       <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#aa66ba820f9577731ad767ba777d2e633">NODE_FALSE</a>:
<a name="l02642"></a>02642         estr = <span class="stringliteral">&quot;false&quot;</span>;
<a name="l02643"></a>02643         <span class="keywordflow">break</span>;
<a name="l02644"></a>02644 
<a name="l02645"></a>02645       <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#a490d1fc6f7f9e81a1815e9b1c3080d94">NODE_ARRAY</a>:{
<a name="l02646"></a>02646         NODE *vals = node;
<a name="l02647"></a>02647 
<a name="l02648"></a>02648         <span class="keywordflow">do</span> {
<a name="l02649"></a>02649             <a class="code" href="../../d2/d47/compile_8c.html#af63fe831dd3325e6beeba0a4c6127159">defined_expr</a>(iseq, ret, vals-&gt;nd_head, lfinish, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aba0717d2689eb68797421a02ab9295c6">Qfalse</a>);
<a name="l02650"></a>02650 
<a name="l02651"></a>02651             <span class="keywordflow">if</span> (!lfinish[1]) {
<a name="l02652"></a>02652                 lfinish[1] = <a class="code" href="../../d2/d47/compile_8c.html#a1d6d5d8dac7aff9ac863255a0905c0f9">NEW_LABEL</a>(<a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node));
<a name="l02653"></a>02653             }
<a name="l02654"></a>02654             <a class="code" href="../../d2/d47/compile_8c.html#ace57e2f70722586d3764284364cfb5ad">ADD_INSNL</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), branchunless, lfinish[1]);
<a name="l02655"></a>02655         } <span class="keywordflow">while</span> ((vals = vals-&gt;nd_next) != <a class="code" href="../../d3/d09/ripper_8y.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l02656"></a>02656       }
<a name="l02657"></a>02657       <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#aac55f53b58d8cbef84a61f2d744e7643">NODE_STR</a>:
<a name="l02658"></a>02658       <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#af19d1c1d9f26c7b19546967449e887f6">NODE_LIT</a>:
<a name="l02659"></a>02659       <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#acb7153a88fb24c846bd6751ca2fa9316">NODE_ZARRAY</a>:
<a name="l02660"></a>02660       <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#afce3dc60f5eb8de336e40138600ef910">NODE_AND</a>:
<a name="l02661"></a>02661       <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#addcdfeefb5907f74a7b172a710c8d45e">NODE_OR</a>:
<a name="l02662"></a>02662       <span class="keywordflow">default</span>:
<a name="l02663"></a>02663         estr = <span class="stringliteral">&quot;expression&quot;</span>;
<a name="l02664"></a>02664         <span class="keywordflow">break</span>;
<a name="l02665"></a>02665 
<a name="l02666"></a>02666         <span class="comment">/* variables */</span>
<a name="l02667"></a>02667       <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#aeb55bab156cfba6fcec9991e963bce3c">NODE_LVAR</a>:
<a name="l02668"></a>02668       <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#af01a3b936fc2a83332b8314ef6b00697">NODE_DVAR</a>:
<a name="l02669"></a>02669         estr = <span class="stringliteral">&quot;local-variable&quot;</span>;
<a name="l02670"></a>02670         <span class="keywordflow">break</span>;
<a name="l02671"></a>02671 
<a name="l02672"></a>02672       <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#a64cab035c0744c9f375bdf575e0cac2f">NODE_IVAR</a>:
<a name="l02673"></a>02673         <a class="code" href="../../d2/d47/compile_8c.html#aa5b45ae61de3350f0830a32589bbb7ee">ADD_INSN</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), putnil);
<a name="l02674"></a>02674         <a class="code" href="../../d2/d47/compile_8c.html#af8e927ae02d27d3a3934dcc65a2d21c9">ADD_INSN3</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), defined, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(<a class="code" href="../../d7/dc8/iseq_8h.html#a92be74fce09c828c57a7007d1b4a406ea5a1b539637a83cbfc7e2efcd14d57afb">DEFINED_IVAR</a>),
<a name="l02675"></a>02675                   <a class="code" href="../../dc/d0c/cparse_8c.html#a48bfb6519a45249fb2ec0193ea3b6e1c">ID2SYM</a>(node-&gt;nd_vid), needstr);
<a name="l02676"></a>02676         <span class="keywordflow">return</span> 1;
<a name="l02677"></a>02677 
<a name="l02678"></a>02678       <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#a19a08624c33d66f2ef3cfb66af6d9d9f">NODE_GVAR</a>:
<a name="l02679"></a>02679         <a class="code" href="../../d2/d47/compile_8c.html#aa5b45ae61de3350f0830a32589bbb7ee">ADD_INSN</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), putnil);
<a name="l02680"></a>02680         <a class="code" href="../../d2/d47/compile_8c.html#af8e927ae02d27d3a3934dcc65a2d21c9">ADD_INSN3</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), defined, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(<a class="code" href="../../d7/dc8/iseq_8h.html#a92be74fce09c828c57a7007d1b4a406ea394766cdf6a7ac7613ef7f195f312648">DEFINED_GVAR</a>),
<a name="l02681"></a>02681                   <a class="code" href="../../dc/d0c/cparse_8c.html#a48bfb6519a45249fb2ec0193ea3b6e1c">ID2SYM</a>(node-&gt;nd_entry-&gt;id), needstr);
<a name="l02682"></a>02682         <span class="keywordflow">return</span> 1;
<a name="l02683"></a>02683 
<a name="l02684"></a>02684       <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#accf6c145831fd42cf9d6c816498ec82b">NODE_CVAR</a>:
<a name="l02685"></a>02685         <a class="code" href="../../d2/d47/compile_8c.html#aa5b45ae61de3350f0830a32589bbb7ee">ADD_INSN</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), putnil);
<a name="l02686"></a>02686         <a class="code" href="../../d2/d47/compile_8c.html#af8e927ae02d27d3a3934dcc65a2d21c9">ADD_INSN3</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), defined, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(<a class="code" href="../../d7/dc8/iseq_8h.html#a92be74fce09c828c57a7007d1b4a406eaf18ae2b53145b17e1822de15e9d1564e">DEFINED_CVAR</a>),
<a name="l02687"></a>02687                   <a class="code" href="../../dc/d0c/cparse_8c.html#a48bfb6519a45249fb2ec0193ea3b6e1c">ID2SYM</a>(node-&gt;nd_vid), needstr);
<a name="l02688"></a>02688         <span class="keywordflow">return</span> 1;
<a name="l02689"></a>02689 
<a name="l02690"></a>02690       <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#a4162517fa8cb8e9bc4b9d9f6e8c32692">NODE_CONST</a>:
<a name="l02691"></a>02691         <a class="code" href="../../d2/d47/compile_8c.html#aa5b45ae61de3350f0830a32589bbb7ee">ADD_INSN</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), putnil);
<a name="l02692"></a>02692         <a class="code" href="../../d2/d47/compile_8c.html#af8e927ae02d27d3a3934dcc65a2d21c9">ADD_INSN3</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), defined, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(<a class="code" href="../../d7/dc8/iseq_8h.html#a92be74fce09c828c57a7007d1b4a406ea3253b64b67b618aa26c7bca9fceb2c41">DEFINED_CONST</a>),
<a name="l02693"></a>02693                   <a class="code" href="../../dc/d0c/cparse_8c.html#a48bfb6519a45249fb2ec0193ea3b6e1c">ID2SYM</a>(node-&gt;nd_vid), needstr);
<a name="l02694"></a>02694         <span class="keywordflow">return</span> 1;
<a name="l02695"></a>02695       <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#aff107642c64833eb6f64e7043c4d2b5c">NODE_COLON2</a>:
<a name="l02696"></a>02696         <span class="keywordflow">if</span> (!lfinish[1]) {
<a name="l02697"></a>02697             lfinish[1] = <a class="code" href="../../d2/d47/compile_8c.html#a1d6d5d8dac7aff9ac863255a0905c0f9">NEW_LABEL</a>(<a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node));
<a name="l02698"></a>02698         }
<a name="l02699"></a>02699         <a class="code" href="../../d2/d47/compile_8c.html#af63fe831dd3325e6beeba0a4c6127159">defined_expr</a>(iseq, ret, node-&gt;nd_head, lfinish, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aba0717d2689eb68797421a02ab9295c6">Qfalse</a>);
<a name="l02700"></a>02700         <a class="code" href="../../d2/d47/compile_8c.html#ace57e2f70722586d3764284364cfb5ad">ADD_INSNL</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), branchunless, lfinish[1]);
<a name="l02701"></a>02701 
<a name="l02702"></a>02702         <span class="keywordflow">if</span> (<a class="code" href="../../d5/d11/ripper_8c.html#a962e14dc81f0fa2107c555dd10129c27">rb_is_const_id</a>(node-&gt;nd_mid)) {
<a name="l02703"></a>02703             <a class="code" href="../../d2/d47/compile_8c.html#a0cacd6cfca69df35e1535d2f21532c47">COMPILE</a>(ret, <span class="stringliteral">&quot;defined/colon2#nd_head&quot;</span>, node-&gt;nd_head);
<a name="l02704"></a>02704             <a class="code" href="../../d2/d47/compile_8c.html#af8e927ae02d27d3a3934dcc65a2d21c9">ADD_INSN3</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), defined, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(<a class="code" href="../../d7/dc8/iseq_8h.html#a92be74fce09c828c57a7007d1b4a406ea3253b64b67b618aa26c7bca9fceb2c41">DEFINED_CONST</a>),
<a name="l02705"></a>02705                       <a class="code" href="../../dc/d0c/cparse_8c.html#a48bfb6519a45249fb2ec0193ea3b6e1c">ID2SYM</a>(node-&gt;nd_mid), needstr);
<a name="l02706"></a>02706         }
<a name="l02707"></a>02707         <span class="keywordflow">else</span> {
<a name="l02708"></a>02708             <a class="code" href="../../d2/d47/compile_8c.html#a0cacd6cfca69df35e1535d2f21532c47">COMPILE</a>(ret, <span class="stringliteral">&quot;defined/colon2#nd_head&quot;</span>, node-&gt;nd_head);
<a name="l02709"></a>02709             <a class="code" href="../../d2/d47/compile_8c.html#af8e927ae02d27d3a3934dcc65a2d21c9">ADD_INSN3</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), defined, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(<a class="code" href="../../d7/dc8/iseq_8h.html#a92be74fce09c828c57a7007d1b4a406ea142fce7e2efcbdd37e02ec844b428c73">DEFINED_METHOD</a>),
<a name="l02710"></a>02710                       <a class="code" href="../../dc/d0c/cparse_8c.html#a48bfb6519a45249fb2ec0193ea3b6e1c">ID2SYM</a>(node-&gt;nd_mid), needstr);
<a name="l02711"></a>02711         }
<a name="l02712"></a>02712         <span class="keywordflow">return</span> 1;
<a name="l02713"></a>02713       <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#a614c6f2b1367102fbde526a5eb2871af">NODE_COLON3</a>:
<a name="l02714"></a>02714         <a class="code" href="../../d2/d47/compile_8c.html#a3cfeb7549a1249a8b78f9d6ff1e74c5a">ADD_INSN1</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), putobject, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a57c96ead3ef230b4838e65fe037c346e">rb_cObject</a>);
<a name="l02715"></a>02715         <a class="code" href="../../d2/d47/compile_8c.html#af8e927ae02d27d3a3934dcc65a2d21c9">ADD_INSN3</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), defined,
<a name="l02716"></a>02716                   <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(<a class="code" href="../../d7/dc8/iseq_8h.html#a92be74fce09c828c57a7007d1b4a406ea3253b64b67b618aa26c7bca9fceb2c41">DEFINED_CONST</a>), <a class="code" href="../../dc/d0c/cparse_8c.html#a48bfb6519a45249fb2ec0193ea3b6e1c">ID2SYM</a>(node-&gt;nd_mid), needstr);
<a name="l02717"></a>02717         <span class="keywordflow">return</span> 1;
<a name="l02718"></a>02718 
<a name="l02719"></a>02719         <span class="comment">/* method dispatch */</span>
<a name="l02720"></a>02720       <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#ae72a414c065eefb25d29b0376ee93e3d">NODE_CALL</a>:
<a name="l02721"></a>02721       <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#ae2efc36a65904690f165fda092b0a8b1">NODE_VCALL</a>:
<a name="l02722"></a>02722       <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#a611c4facbf6699e4b795320442ace55f">NODE_FCALL</a>:
<a name="l02723"></a>02723       <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#a1423dff9c55fd36cca257ffb758ca4a6">NODE_ATTRASGN</a>:{
<a name="l02724"></a>02724         <span class="keywordtype">int</span> <span class="keyword">self</span> = <a class="code" href="../../d1/d5c/nkf_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l02725"></a>02725 
<a name="l02726"></a>02726         <span class="keywordflow">switch</span> (type) {
<a name="l02727"></a>02727           <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#a1423dff9c55fd36cca257ffb758ca4a6">NODE_ATTRASGN</a>:
<a name="l02728"></a>02728             <span class="keywordflow">if</span> (node-&gt;nd_recv == (NODE *)1) <span class="keywordflow">break</span>;
<a name="l02729"></a>02729           <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#ae72a414c065eefb25d29b0376ee93e3d">NODE_CALL</a>:
<a name="l02730"></a>02730             <span class="keyword">self</span> = <a class="code" href="../../d1/d5c/nkf_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l02731"></a>02731             <span class="keywordflow">break</span>;
<a name="l02732"></a>02732           <span class="keywordflow">default</span>:
<a name="l02733"></a>02733             <span class="comment">/* through */</span>;
<a name="l02734"></a>02734         }
<a name="l02735"></a>02735         <span class="keywordflow">if</span> (!lfinish[1]) {
<a name="l02736"></a>02736             lfinish[1] = <a class="code" href="../../d2/d47/compile_8c.html#a1d6d5d8dac7aff9ac863255a0905c0f9">NEW_LABEL</a>(<a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node));
<a name="l02737"></a>02737         }
<a name="l02738"></a>02738         <span class="keywordflow">if</span> (node-&gt;nd_args) {
<a name="l02739"></a>02739             <a class="code" href="../../d2/d47/compile_8c.html#af63fe831dd3325e6beeba0a4c6127159">defined_expr</a>(iseq, ret, node-&gt;nd_args, lfinish, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aba0717d2689eb68797421a02ab9295c6">Qfalse</a>);
<a name="l02740"></a>02740             <a class="code" href="../../d2/d47/compile_8c.html#ace57e2f70722586d3764284364cfb5ad">ADD_INSNL</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), branchunless, lfinish[1]);
<a name="l02741"></a>02741         }
<a name="l02742"></a>02742         <span class="keywordflow">if</span> (!<span class="keyword">self</span>) {
<a name="l02743"></a>02743             <a class="code" href="../../d2/d47/compile_8c.html#af63fe831dd3325e6beeba0a4c6127159">defined_expr</a>(iseq, ret, node-&gt;nd_recv, lfinish, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aba0717d2689eb68797421a02ab9295c6">Qfalse</a>);
<a name="l02744"></a>02744             <a class="code" href="../../d2/d47/compile_8c.html#ace57e2f70722586d3764284364cfb5ad">ADD_INSNL</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), branchunless, lfinish[1]);
<a name="l02745"></a>02745             <a class="code" href="../../d2/d47/compile_8c.html#a0cacd6cfca69df35e1535d2f21532c47">COMPILE</a>(ret, <span class="stringliteral">&quot;defined/recv&quot;</span>, node-&gt;nd_recv);
<a name="l02746"></a>02746             <a class="code" href="../../d2/d47/compile_8c.html#af8e927ae02d27d3a3934dcc65a2d21c9">ADD_INSN3</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), defined, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(<a class="code" href="../../d7/dc8/iseq_8h.html#a92be74fce09c828c57a7007d1b4a406ea142fce7e2efcbdd37e02ec844b428c73">DEFINED_METHOD</a>),
<a name="l02747"></a>02747                       <a class="code" href="../../dc/d0c/cparse_8c.html#a48bfb6519a45249fb2ec0193ea3b6e1c">ID2SYM</a>(node-&gt;nd_mid), needstr);
<a name="l02748"></a>02748         }
<a name="l02749"></a>02749         <span class="keywordflow">else</span> {
<a name="l02750"></a>02750             <a class="code" href="../../d2/d47/compile_8c.html#aa5b45ae61de3350f0830a32589bbb7ee">ADD_INSN</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), putself);
<a name="l02751"></a>02751             <a class="code" href="../../d2/d47/compile_8c.html#af8e927ae02d27d3a3934dcc65a2d21c9">ADD_INSN3</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), defined, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(<a class="code" href="../../d7/dc8/iseq_8h.html#a92be74fce09c828c57a7007d1b4a406eacb93f6d466d084b3bfc3df236a68b1a6">DEFINED_FUNC</a>),
<a name="l02752"></a>02752                       <a class="code" href="../../dc/d0c/cparse_8c.html#a48bfb6519a45249fb2ec0193ea3b6e1c">ID2SYM</a>(node-&gt;nd_mid), needstr);
<a name="l02753"></a>02753         }
<a name="l02754"></a>02754         <span class="keywordflow">return</span> 1;
<a name="l02755"></a>02755       }
<a name="l02756"></a>02756 
<a name="l02757"></a>02757       <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#a210571fb93e1d6ca4c50d6e897cd1d60">NODE_YIELD</a>:
<a name="l02758"></a>02758         <a class="code" href="../../d2/d47/compile_8c.html#aa5b45ae61de3350f0830a32589bbb7ee">ADD_INSN</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), putnil);
<a name="l02759"></a>02759         <a class="code" href="../../d2/d47/compile_8c.html#af8e927ae02d27d3a3934dcc65a2d21c9">ADD_INSN3</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), defined, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(<a class="code" href="../../d7/dc8/iseq_8h.html#a92be74fce09c828c57a7007d1b4a406eadd946809497dc50c4cb951d33db6a5db">DEFINED_YIELD</a>), 0,
<a name="l02760"></a>02760                   needstr);
<a name="l02761"></a>02761         <span class="keywordflow">return</span> 1;
<a name="l02762"></a>02762 
<a name="l02763"></a>02763       <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#a276fc132dec9ae10a63bf430e66a1064">NODE_BACK_REF</a>:
<a name="l02764"></a>02764       <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#a3ea55c01c2adc06cf9da2a42925ccf03">NODE_NTH_REF</a>:
<a name="l02765"></a>02765         <a class="code" href="../../d2/d47/compile_8c.html#aa5b45ae61de3350f0830a32589bbb7ee">ADD_INSN</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), putnil);
<a name="l02766"></a>02766         <a class="code" href="../../d2/d47/compile_8c.html#af8e927ae02d27d3a3934dcc65a2d21c9">ADD_INSN3</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), defined, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(<a class="code" href="../../d7/dc8/iseq_8h.html#a92be74fce09c828c57a7007d1b4a406ea7344d009adb71d96984237e4ae7fff69">DEFINED_REF</a>),
<a name="l02767"></a>02767                   <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>((node-&gt;nd_nth &lt;&lt; 1) | (type == <a class="code" href="../../d3/d09/ripper_8y.html#a276fc132dec9ae10a63bf430e66a1064">NODE_BACK_REF</a>)),
<a name="l02768"></a>02768                   needstr);
<a name="l02769"></a>02769         <span class="keywordflow">return</span> 1;
<a name="l02770"></a>02770 
<a name="l02771"></a>02771       <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#ab986d79d4c826e86db4b17dd331e7b80">NODE_SUPER</a>:
<a name="l02772"></a>02772       <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#a5966d8a24f1a0b7ab182a430c3f92ccd">NODE_ZSUPER</a>:
<a name="l02773"></a>02773         <a class="code" href="../../d2/d47/compile_8c.html#aa5b45ae61de3350f0830a32589bbb7ee">ADD_INSN</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), putnil);
<a name="l02774"></a>02774         <a class="code" href="../../d2/d47/compile_8c.html#af8e927ae02d27d3a3934dcc65a2d21c9">ADD_INSN3</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), defined, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(<a class="code" href="../../d7/dc8/iseq_8h.html#a92be74fce09c828c57a7007d1b4a406eaef87cf131052b981524bd1ac7d62e2d1">DEFINED_ZSUPER</a>), 0,
<a name="l02775"></a>02775                   needstr);
<a name="l02776"></a>02776         <span class="keywordflow">return</span> 1;
<a name="l02777"></a>02777 
<a name="l02778"></a>02778       <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#a7ed32e1efe76c3f34ccf1ac4c9def39c">NODE_OP_ASGN1</a>:
<a name="l02779"></a>02779       <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#a6a3094139c05b14867151b55cffdbad0">NODE_OP_ASGN2</a>:
<a name="l02780"></a>02780       <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#a19f6bacf83d13be68f94e4d54a02bc5d">NODE_OP_ASGN_OR</a>:
<a name="l02781"></a>02781       <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#a844d8faea88bfbb66bc0b43a20019df1">NODE_OP_ASGN_AND</a>:
<a name="l02782"></a>02782       <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#ad03c15faf9f8ca478889f491431b406b">NODE_MASGN</a>:
<a name="l02783"></a>02783       <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#aa9d208a2eb1e5266beea027e10f3d472">NODE_LASGN</a>:
<a name="l02784"></a>02784       <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#af92abe71c6571a24b59b4eb4ebb5908f">NODE_DASGN</a>:
<a name="l02785"></a>02785       <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#aa69a9128d7cd7376dc4d76e65d90e994">NODE_DASGN_CURR</a>:
<a name="l02786"></a>02786       <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#acc59e8bf53d75d27835d03ee9bbac630">NODE_GASGN</a>:
<a name="l02787"></a>02787       <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#a4e3d1029dca72147900e9b1a840bf968">NODE_IASGN</a>:
<a name="l02788"></a>02788       <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#a62bbab89538c1de14389202f9797ab3d">NODE_CDECL</a>:
<a name="l02789"></a>02789       <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#a45ce5181ec29d7d5e45ff5931918dafc">NODE_CVDECL</a>:
<a name="l02790"></a>02790       <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#ae0d7af3d0cea1ce334874826929507bf">NODE_CVASGN</a>:
<a name="l02791"></a>02791         estr = <span class="stringliteral">&quot;assignment&quot;</span>;
<a name="l02792"></a>02792         <span class="keywordflow">break</span>;
<a name="l02793"></a>02793     }
<a name="l02794"></a>02794 
<a name="l02795"></a>02795     <span class="keywordflow">if</span> (estr != 0) {
<a name="l02796"></a>02796         <span class="keywordflow">if</span> (needstr != <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aba0717d2689eb68797421a02ab9295c6">Qfalse</a>) {
<a name="l02797"></a>02797             <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str = <a class="code" href="../../db/d2e/intern_8h.html#a03acd62c0b1edebbe1d61f957c19b7ac">rb_str_new2</a>(estr);
<a name="l02798"></a>02798             <a class="code" href="../../d2/d47/compile_8c.html#ade60ac907df6825c414be22c432ba82a">hide_obj</a>(str);
<a name="l02799"></a>02799             <a class="code" href="../../d2/d47/compile_8c.html#a3cfeb7549a1249a8b78f9d6ff1e74c5a">ADD_INSN1</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), putstring, str);
<a name="l02800"></a>02800             <a class="code" href="../../d2/d47/compile_8c.html#ad09bab1521a935e4affe9c1faf9a27c5">iseq_add_mark_object_compile_time</a>(iseq, str);
<a name="l02801"></a>02801         }
<a name="l02802"></a>02802         <span class="keywordflow">else</span> {
<a name="l02803"></a>02803             <a class="code" href="../../d2/d47/compile_8c.html#a3cfeb7549a1249a8b78f9d6ff1e74c5a">ADD_INSN1</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), putobject, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aacea3516b33941ce8149098e223a7466">Qtrue</a>);
<a name="l02804"></a>02804         }
<a name="l02805"></a>02805         <span class="keywordflow">return</span> 1;
<a name="l02806"></a>02806     }
<a name="l02807"></a>02807     <span class="keywordflow">return</span> 0;
<a name="l02808"></a>02808 }
<a name="l02809"></a>02809 <span class="preprocessor">#undef defined_expr</span>
<a name="l02810"></a>02810 <span class="preprocessor"></span>
<a name="l02811"></a>02811 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l02812"></a><a class="code" href="../../d2/d47/compile_8c.html#aec9742396562ff6ba8b7c9cd94b6d868">02812</a> <a class="code" href="../../d2/d47/compile_8c.html#af63fe831dd3325e6beeba0a4c6127159">defined_expr</a>(<a class="code" href="../../d6/de3/structrb__iseq__struct.html">rb_iseq_t</a> *iseq, <a class="code" href="../../d4/dcd/structiseq__link__anchor.html">LINK_ANCHOR</a> *ret,
<a name="l02813"></a>02813              NODE *<a class="code" href="../../d7/dc0/parse_8y.html#a0d7af8a92c4b0a07f71585584ef9634f">node</a>, <a class="code" href="../../d8/dc5/structiseq__label__data.html">LABEL</a> **lfinish, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> needstr)
<a name="l02814"></a>02814 {
<a name="l02815"></a>02815     <a class="code" href="../../dc/dd8/structiseq__link__element.html">LINK_ELEMENT</a> *lcur = ret-&gt;<a class="code" href="../../d4/dcd/structiseq__link__anchor.html#a51b3384a1d06e26fdf1214c219f19927">last</a>;
<a name="l02816"></a>02816     <span class="keywordtype">int</span> done = defined_expr0(iseq, ret, node, lfinish, needstr);
<a name="l02817"></a>02817     <span class="keywordflow">if</span> (lfinish[1]) {
<a name="l02818"></a>02818         <span class="keywordtype">int</span> line = <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node);
<a name="l02819"></a>02819         <a class="code" href="../../d8/dc5/structiseq__label__data.html">LABEL</a> *lstart = <a class="code" href="../../d2/d47/compile_8c.html#a1d6d5d8dac7aff9ac863255a0905c0f9">NEW_LABEL</a>(line);
<a name="l02820"></a>02820         <a class="code" href="../../d8/dc5/structiseq__label__data.html">LABEL</a> *lend = <a class="code" href="../../d2/d47/compile_8c.html#a1d6d5d8dac7aff9ac863255a0905c0f9">NEW_LABEL</a>(line);
<a name="l02821"></a>02821         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> rescue = <a class="code" href="../../d2/d47/compile_8c.html#a8b46ed4917f951327df16ff64ed8f67c">NEW_CHILD_ISEQVAL</a>(<a class="code" href="../../d3/d09/ripper_8y.html#a969f4dd65ae53a2ec90dbbb0420af61e">NEW_NIL</a>(),
<a name="l02822"></a>02822                                          <a class="code" href="../../db/d2e/intern_8h.html#a2f12f7ad949fa2e6abb64f2311c6e2c5">rb_str_concat</a>(<a class="code" href="../../db/d2e/intern_8h.html#a03acd62c0b1edebbe1d61f957c19b7ac">rb_str_new2</a>
<a name="l02823"></a>02823                                                        (<span class="stringliteral">&quot;defined guard in &quot;</span>),
<a name="l02824"></a>02824                                                        iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a35596da255ce28a5d1da94c2cc508c7d">name</a>),
<a name="l02825"></a>02825                                          ISEQ_TYPE_DEFINED_GUARD, 0);
<a name="l02826"></a>02826         <a class="code" href="../../d2/d47/compile_8c.html#a3300101eaba3d9747c940283c66849fa">APPEND_LABEL</a>(ret, lcur, lstart);
<a name="l02827"></a>02827         <a class="code" href="../../d2/d47/compile_8c.html#a5a380bb449656575d6b77ccb8eb7e5ae">ADD_LABEL</a>(ret, lend);
<a name="l02828"></a>02828         <a class="code" href="../../d2/d47/compile_8c.html#a668f1779f1e5158e6ad8d4b6d92638db">ADD_CATCH_ENTRY</a>(<a class="code" href="../../dc/d07/structiseq__catch__table__entry.html#a1c2635a230708dfba8857a6d6509b6a1ab0479ba418aae875e074a9d1d32f77e4">CATCH_TYPE_RESCUE</a>, lstart, lend, rescue, lfinish[1]);
<a name="l02829"></a>02829     }
<a name="l02830"></a>02830     <span class="keywordflow">return</span> done;
<a name="l02831"></a>02831 }
<a name="l02832"></a>02832 
<a name="l02833"></a><a class="code" href="../../d2/d47/compile_8c.html#aeca034f67218340ecb2261a22c2f3dcd">02833</a> <span class="preprocessor">#define BUFSIZE 0x100</span>
<a name="l02834"></a>02834 <span class="preprocessor"></span>
<a name="l02835"></a>02835 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l02836"></a><a class="code" href="../../d2/d47/compile_8c.html#a046ec40ada559492235ee811126bafda">02836</a> <a class="code" href="../../d2/d47/compile_8c.html#a046ec40ada559492235ee811126bafda">make_name_for_block</a>(<a class="code" href="../../d6/de3/structrb__iseq__struct.html">rb_iseq_t</a> *iseq)
<a name="l02837"></a>02837 {
<a name="l02838"></a>02838     <span class="keywordtype">int</span> level = 1;
<a name="l02839"></a>02839     <a class="code" href="../../d6/de3/structrb__iseq__struct.html">rb_iseq_t</a> *ip = iseq;
<a name="l02840"></a>02840 
<a name="l02841"></a>02841     <span class="keywordflow">if</span> (iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#afce02da209c0bf9a09ef4ea0af68e623">parent_iseq</a> != 0) {
<a name="l02842"></a>02842         <span class="keywordflow">while</span> (ip-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a0f5705507c4c80bc69c3f031dd0daae9">local_iseq</a> != ip) {
<a name="l02843"></a>02843             <span class="keywordflow">if</span> (ip-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#af8bc7dbae6f61d836b5bb9fb50b6cfb8">type</a> == ISEQ_TYPE_BLOCK) {
<a name="l02844"></a>02844                 level++;
<a name="l02845"></a>02845             }
<a name="l02846"></a>02846             ip = ip-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#afce02da209c0bf9a09ef4ea0af68e623">parent_iseq</a>;
<a name="l02847"></a>02847         }
<a name="l02848"></a>02848     }
<a name="l02849"></a>02849 
<a name="l02850"></a>02850     <span class="keywordflow">if</span> (level == 1) {
<a name="l02851"></a>02851         <span class="keywordflow">return</span> <a class="code" href="../../d9/d2d/sprintf_8c.html#a05c34a91ab36c6a463c861df47808fae">rb_sprintf</a>(<span class="stringliteral">&quot;block in %s&quot;</span>, <a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(ip-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a35596da255ce28a5d1da94c2cc508c7d">name</a>));
<a name="l02852"></a>02852     }
<a name="l02853"></a>02853     <span class="keywordflow">else</span> {
<a name="l02854"></a>02854         <span class="keywordflow">return</span> <a class="code" href="../../d9/d2d/sprintf_8c.html#a05c34a91ab36c6a463c861df47808fae">rb_sprintf</a>(<span class="stringliteral">&quot;block (%d levels) in %s&quot;</span>, level, <a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(ip-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a35596da255ce28a5d1da94c2cc508c7d">name</a>));
<a name="l02855"></a>02855     }
<a name="l02856"></a>02856 }
<a name="l02857"></a>02857 
<a name="l02858"></a>02858 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l02859"></a><a class="code" href="../../d2/d47/compile_8c.html#a58ce1f4f951df593103360ac94cb0e6c">02859</a> <a class="code" href="../../d2/d47/compile_8c.html#a58ce1f4f951df593103360ac94cb0e6c">push_ensure_entry</a>(<a class="code" href="../../d6/de3/structrb__iseq__struct.html">rb_iseq_t</a> *iseq,
<a name="l02860"></a>02860                   <span class="keyword">struct</span> <a class="code" href="../../d6/dca/structiseq__compile__data__ensure__node__stack.html">iseq_compile_data_ensure_node_stack</a> *enl,
<a name="l02861"></a>02861                   <span class="keyword">struct</span> <a class="code" href="../../da/d32/structensure__range.html">ensure_range</a> *er, NODE *<a class="code" href="../../d7/dc0/parse_8y.html#a0d7af8a92c4b0a07f71585584ef9634f">node</a>)
<a name="l02862"></a>02862 {
<a name="l02863"></a>02863     enl-&gt;<a class="code" href="../../d6/dca/structiseq__compile__data__ensure__node__stack.html#a9aa4970b49eac1b043120fa7be4efad4">ensure_node</a> = node;
<a name="l02864"></a>02864     enl-&gt;<a class="code" href="../../d6/dca/structiseq__compile__data__ensure__node__stack.html#a4da021e50680d45890063a5f7f8160ae">prev</a> = iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a947d34698fb5a71f4938532fff27a0f7">compile_data</a>-&gt;<a class="code" href="../../d4/dd8/structiseq__compile__data.html#a3f5b0db80047c5fef40ea0783646ddb0">ensure_node_stack</a>;  <span class="comment">/* prev */</span>
<a name="l02865"></a>02865     enl-&gt;<a class="code" href="../../d6/dca/structiseq__compile__data__ensure__node__stack.html#ac7ba7bd330d22b7ff0bfc0deb1217947">erange</a> = er;
<a name="l02866"></a>02866     iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a947d34698fb5a71f4938532fff27a0f7">compile_data</a>-&gt;<a class="code" href="../../d4/dd8/structiseq__compile__data.html#a3f5b0db80047c5fef40ea0783646ddb0">ensure_node_stack</a> = enl;
<a name="l02867"></a>02867 }
<a name="l02868"></a>02868 
<a name="l02869"></a>02869 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l02870"></a><a class="code" href="../../d2/d47/compile_8c.html#a25ce4ed97b8b25d9ebd9078a33b21f74">02870</a> <a class="code" href="../../d2/d47/compile_8c.html#a25ce4ed97b8b25d9ebd9078a33b21f74">add_ensure_range</a>(<a class="code" href="../../d6/de3/structrb__iseq__struct.html">rb_iseq_t</a> *iseq, <span class="keyword">struct</span> <a class="code" href="../../da/d32/structensure__range.html">ensure_range</a> *erange,
<a name="l02871"></a>02871                  <a class="code" href="../../d8/dc5/structiseq__label__data.html">LABEL</a> *lstart, <a class="code" href="../../d8/dc5/structiseq__label__data.html">LABEL</a> *lend)
<a name="l02872"></a>02872 {
<a name="l02873"></a>02873     <span class="keyword">struct </span><a class="code" href="../../da/d32/structensure__range.html">ensure_range</a> *<a class="code" href="../../df/d73/time_8c.html#a54e8d54faf71d1f7a0cf8dcfc21a26db">ne</a> =
<a name="l02874"></a>02874         <a class="code" href="../../d2/d47/compile_8c.html#aa24f135ae12437da748202a5329eba3e">compile_data_alloc</a>(iseq, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="../../da/d32/structensure__range.html">ensure_range</a>));
<a name="l02875"></a>02875 
<a name="l02876"></a>02876     <span class="keywordflow">while</span> (erange-&gt;<a class="code" href="../../da/d32/structensure__range.html#a2db4411cce7aefb5b8c9a9ce4dadd2e7">next</a> != 0) {
<a name="l02877"></a>02877         erange = erange-&gt;<a class="code" href="../../da/d32/structensure__range.html#a2db4411cce7aefb5b8c9a9ce4dadd2e7">next</a>;
<a name="l02878"></a>02878     }
<a name="l02879"></a>02879     ne-&gt;<a class="code" href="../../da/d32/structensure__range.html#a2db4411cce7aefb5b8c9a9ce4dadd2e7">next</a> = 0;
<a name="l02880"></a>02880     ne-&gt;<a class="code" href="../../da/d32/structensure__range.html#a8ad1f4748dfe9dcf6667452d0d3e8ed0">begin</a> = lend;
<a name="l02881"></a>02881     ne-&gt;<a class="code" href="../../da/d32/structensure__range.html#aa15081d5666a57e4df5a74bbad8cda12">end</a> = erange-&gt;<a class="code" href="../../da/d32/structensure__range.html#aa15081d5666a57e4df5a74bbad8cda12">end</a>;
<a name="l02882"></a>02882     erange-&gt;<a class="code" href="../../da/d32/structensure__range.html#aa15081d5666a57e4df5a74bbad8cda12">end</a> = lstart;
<a name="l02883"></a>02883 
<a name="l02884"></a>02884     erange-&gt;<a class="code" href="../../da/d32/structensure__range.html#a2db4411cce7aefb5b8c9a9ce4dadd2e7">next</a> = ne;
<a name="l02885"></a>02885 }
<a name="l02886"></a>02886 
<a name="l02887"></a>02887 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l02888"></a><a class="code" href="../../d2/d47/compile_8c.html#ae12d5b1df0097ff6f114e576543985c7">02888</a> <a class="code" href="../../d2/d47/compile_8c.html#ae12d5b1df0097ff6f114e576543985c7">add_ensure_iseq</a>(<a class="code" href="../../d4/dcd/structiseq__link__anchor.html">LINK_ANCHOR</a> *ret, <a class="code" href="../../d6/de3/structrb__iseq__struct.html">rb_iseq_t</a> *iseq, <span class="keywordtype">int</span> is_return)
<a name="l02889"></a>02889 {
<a name="l02890"></a>02890     <span class="keyword">struct </span><a class="code" href="../../d6/dca/structiseq__compile__data__ensure__node__stack.html">iseq_compile_data_ensure_node_stack</a> *enlp =
<a name="l02891"></a>02891         iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a947d34698fb5a71f4938532fff27a0f7">compile_data</a>-&gt;<a class="code" href="../../d4/dd8/structiseq__compile__data.html#a3f5b0db80047c5fef40ea0783646ddb0">ensure_node_stack</a>;
<a name="l02892"></a>02892     <span class="keyword">struct </span><a class="code" href="../../d6/dca/structiseq__compile__data__ensure__node__stack.html">iseq_compile_data_ensure_node_stack</a> *prev_enlp = enlp;
<a name="l02893"></a>02893     <a class="code" href="../../d2/d47/compile_8c.html#aa9d6014cec8d3adcb228b81620eac795">DECL_ANCHOR</a>(ensure);
<a name="l02894"></a>02894 
<a name="l02895"></a>02895     <a class="code" href="../../d2/d47/compile_8c.html#ac32b1f7d8de8f10f33a147030d8b7544">INIT_ANCHOR</a>(ensure);
<a name="l02896"></a>02896     <span class="keywordflow">while</span> (enlp) {
<a name="l02897"></a>02897         <span class="keywordflow">if</span> (enlp-&gt;<a class="code" href="../../d6/dca/structiseq__compile__data__ensure__node__stack.html#ac7ba7bd330d22b7ff0bfc0deb1217947">erange</a> != 0) {
<a name="l02898"></a>02898             <a class="code" href="../../d2/d47/compile_8c.html#aa9d6014cec8d3adcb228b81620eac795">DECL_ANCHOR</a>(ensure_part);
<a name="l02899"></a>02899             <a class="code" href="../../d8/dc5/structiseq__label__data.html">LABEL</a> *lstart = <a class="code" href="../../d2/d47/compile_8c.html#a1d6d5d8dac7aff9ac863255a0905c0f9">NEW_LABEL</a>(0);
<a name="l02900"></a>02900             <a class="code" href="../../d8/dc5/structiseq__label__data.html">LABEL</a> *lend = <a class="code" href="../../d2/d47/compile_8c.html#a1d6d5d8dac7aff9ac863255a0905c0f9">NEW_LABEL</a>(0);
<a name="l02901"></a>02901             <a class="code" href="../../d2/d47/compile_8c.html#ac32b1f7d8de8f10f33a147030d8b7544">INIT_ANCHOR</a>(ensure_part);
<a name="l02902"></a>02902 
<a name="l02903"></a>02903             <a class="code" href="../../d2/d47/compile_8c.html#a25ce4ed97b8b25d9ebd9078a33b21f74">add_ensure_range</a>(iseq, enlp-&gt;<a class="code" href="../../d6/dca/structiseq__compile__data__ensure__node__stack.html#ac7ba7bd330d22b7ff0bfc0deb1217947">erange</a>, lstart, lend);
<a name="l02904"></a>02904 
<a name="l02905"></a>02905             iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a947d34698fb5a71f4938532fff27a0f7">compile_data</a>-&gt;<a class="code" href="../../d4/dd8/structiseq__compile__data.html#a3f5b0db80047c5fef40ea0783646ddb0">ensure_node_stack</a> = enlp-&gt;<a class="code" href="../../d6/dca/structiseq__compile__data__ensure__node__stack.html#a4da021e50680d45890063a5f7f8160ae">prev</a>;
<a name="l02906"></a>02906             <a class="code" href="../../d2/d47/compile_8c.html#a5a380bb449656575d6b77ccb8eb7e5ae">ADD_LABEL</a>(ensure_part, lstart);
<a name="l02907"></a>02907             <a class="code" href="../../d2/d47/compile_8c.html#a4e7115fce9f91ee84931798cc3474229">COMPILE_POPED</a>(ensure_part, <span class="stringliteral">&quot;ensure part&quot;</span>, enlp-&gt;<a class="code" href="../../d6/dca/structiseq__compile__data__ensure__node__stack.html#a9aa4970b49eac1b043120fa7be4efad4">ensure_node</a>);
<a name="l02908"></a>02908             <a class="code" href="../../d2/d47/compile_8c.html#a5a380bb449656575d6b77ccb8eb7e5ae">ADD_LABEL</a>(ensure_part, lend);
<a name="l02909"></a>02909             <a class="code" href="../../d2/d47/compile_8c.html#afd9d72d069724385c83bcc32d6746b1e">ADD_SEQ</a>(ensure, ensure_part);
<a name="l02910"></a>02910         }
<a name="l02911"></a>02911         <span class="keywordflow">else</span> {
<a name="l02912"></a>02912             <span class="keywordflow">if</span> (!is_return) {
<a name="l02913"></a>02913                 <span class="keywordflow">break</span>;
<a name="l02914"></a>02914             }
<a name="l02915"></a>02915         }
<a name="l02916"></a>02916         enlp = enlp-&gt;<a class="code" href="../../d6/dca/structiseq__compile__data__ensure__node__stack.html#a4da021e50680d45890063a5f7f8160ae">prev</a>;
<a name="l02917"></a>02917     }
<a name="l02918"></a>02918     iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a947d34698fb5a71f4938532fff27a0f7">compile_data</a>-&gt;<a class="code" href="../../d4/dd8/structiseq__compile__data.html#a3f5b0db80047c5fef40ea0783646ddb0">ensure_node_stack</a> = prev_enlp;
<a name="l02919"></a>02919     <a class="code" href="../../d2/d47/compile_8c.html#afd9d72d069724385c83bcc32d6746b1e">ADD_SEQ</a>(ret, ensure);
<a name="l02920"></a>02920 }
<a name="l02921"></a>02921 
<a name="l02922"></a>02922 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l02923"></a><a class="code" href="../../d2/d47/compile_8c.html#ab6ce5708d11d498cf4924186b39820c2">02923</a> <a class="code" href="../../d2/d47/compile_8c.html#ab6ce5708d11d498cf4924186b39820c2">setup_args</a>(<a class="code" href="../../d6/de3/structrb__iseq__struct.html">rb_iseq_t</a> *iseq, <a class="code" href="../../d4/dcd/structiseq__link__anchor.html">LINK_ANCHOR</a> *<a class="code" href="../../d3/d09/ripper_8y.html#a8187411843a6284ffb964ef3fb9fcab3">args</a>, NODE *argn, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> *flag)
<a name="l02924"></a>02924 {
<a name="l02925"></a>02925     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> argc = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(0);
<a name="l02926"></a>02926     <span class="keywordtype">int</span> nsplat = 0;
<a name="l02927"></a>02927     <a class="code" href="../../d2/d47/compile_8c.html#aa9d6014cec8d3adcb228b81620eac795">DECL_ANCHOR</a>(arg_block);
<a name="l02928"></a>02928     <a class="code" href="../../d2/d47/compile_8c.html#aa9d6014cec8d3adcb228b81620eac795">DECL_ANCHOR</a>(args_splat);
<a name="l02929"></a>02929 
<a name="l02930"></a>02930     <a class="code" href="../../d2/d47/compile_8c.html#ac32b1f7d8de8f10f33a147030d8b7544">INIT_ANCHOR</a>(arg_block);
<a name="l02931"></a>02931     <a class="code" href="../../d2/d47/compile_8c.html#ac32b1f7d8de8f10f33a147030d8b7544">INIT_ANCHOR</a>(args_splat);
<a name="l02932"></a>02932     <span class="keywordflow">if</span> (argn &amp;&amp; <a class="code" href="../../d3/d09/ripper_8y.html#ade12c589b26f55f089dc25d689249c11">nd_type</a>(argn) == <a class="code" href="../../d3/d09/ripper_8y.html#aac25fa5ac2c9b236539991db75bbe3b7">NODE_BLOCK_PASS</a>) {
<a name="l02933"></a>02933         <a class="code" href="../../d2/d47/compile_8c.html#a0cacd6cfca69df35e1535d2f21532c47">COMPILE</a>(arg_block, <span class="stringliteral">&quot;block&quot;</span>, argn-&gt;nd_body);
<a name="l02934"></a>02934         *flag |= <a class="code" href="../../d8/d32/vm__core_8h.html#aee4df54d62a5eb107fdd8757de767ee6">VM_CALL_ARGS_BLOCKARG_BIT</a>;
<a name="l02935"></a>02935         argn = argn-&gt;nd_head;
<a name="l02936"></a>02936     }
<a name="l02937"></a>02937 
<a name="l02938"></a>02938   setup_argn:
<a name="l02939"></a>02939     <span class="keywordflow">if</span> (argn) {
<a name="l02940"></a>02940         <span class="keywordflow">switch</span> (<a class="code" href="../../d3/d09/ripper_8y.html#ade12c589b26f55f089dc25d689249c11">nd_type</a>(argn)) {
<a name="l02941"></a>02941           <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#a985f27752acfb29eca912c28522329c3">NODE_SPLAT</a>: {
<a name="l02942"></a>02942             <a class="code" href="../../d2/d47/compile_8c.html#a0cacd6cfca69df35e1535d2f21532c47">COMPILE</a>(args, <span class="stringliteral">&quot;args (splat)&quot;</span>, argn-&gt;nd_head);
<a name="l02943"></a>02943             argc = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(1);
<a name="l02944"></a>02944             nsplat++;
<a name="l02945"></a>02945             *flag |= <a class="code" href="../../d8/d32/vm__core_8h.html#a56aad9fa74696d2a86028361323a75a6">VM_CALL_ARGS_SPLAT_BIT</a>;
<a name="l02946"></a>02946             <span class="keywordflow">break</span>;
<a name="l02947"></a>02947           }
<a name="l02948"></a>02948           <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#a796ba7c9f501e5f81b4f6f06972250fd">NODE_ARGSCAT</a>:
<a name="l02949"></a>02949           <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#a15dc4d72c7b3a577d28e6131a63926d9">NODE_ARGSPUSH</a>: {
<a name="l02950"></a>02950             <span class="keywordtype">int</span> next_is_array = (<a class="code" href="../../d3/d09/ripper_8y.html#ade12c589b26f55f089dc25d689249c11">nd_type</a>(argn-&gt;nd_head) == <a class="code" href="../../d3/d09/ripper_8y.html#a490d1fc6f7f9e81a1815e9b1c3080d94">NODE_ARRAY</a>);
<a name="l02951"></a>02951             <a class="code" href="../../d2/d47/compile_8c.html#aa9d6014cec8d3adcb228b81620eac795">DECL_ANCHOR</a>(tmp);
<a name="l02952"></a>02952 
<a name="l02953"></a>02953             <a class="code" href="../../d2/d47/compile_8c.html#ac32b1f7d8de8f10f33a147030d8b7544">INIT_ANCHOR</a>(tmp);
<a name="l02954"></a>02954             <a class="code" href="../../d2/d47/compile_8c.html#a0cacd6cfca69df35e1535d2f21532c47">COMPILE</a>(tmp, <span class="stringliteral">&quot;args (cat: splat)&quot;</span>, argn-&gt;nd_body);
<a name="l02955"></a>02955             <span class="keywordflow">if</span> (next_is_array &amp;&amp; nsplat == 0) {
<a name="l02956"></a>02956                 <span class="comment">/* none */</span>
<a name="l02957"></a>02957             }
<a name="l02958"></a>02958             <span class="keywordflow">else</span> {
<a name="l02959"></a>02959                 <span class="keywordflow">if</span> (<a class="code" href="../../d3/d09/ripper_8y.html#ade12c589b26f55f089dc25d689249c11">nd_type</a>(argn) == <a class="code" href="../../d3/d09/ripper_8y.html#a796ba7c9f501e5f81b4f6f06972250fd">NODE_ARGSCAT</a>) {
<a name="l02960"></a>02960                     <a class="code" href="../../d2/d47/compile_8c.html#a3cfeb7549a1249a8b78f9d6ff1e74c5a">ADD_INSN1</a>(tmp, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(argn), splatarray, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aba0717d2689eb68797421a02ab9295c6">Qfalse</a>);
<a name="l02961"></a>02961                 }
<a name="l02962"></a>02962                 <span class="keywordflow">else</span> {
<a name="l02963"></a>02963                     <a class="code" href="../../d2/d47/compile_8c.html#a3cfeb7549a1249a8b78f9d6ff1e74c5a">ADD_INSN1</a>(tmp, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(argn), newarray, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(1));
<a name="l02964"></a>02964                 }
<a name="l02965"></a>02965             }
<a name="l02966"></a>02966             <a class="code" href="../../d2/d47/compile_8c.html#ad41b7be766569804251497cf2d6103e5">INSERT_LIST</a>(args_splat, tmp);
<a name="l02967"></a>02967             nsplat++;
<a name="l02968"></a>02968             *flag |= <a class="code" href="../../d8/d32/vm__core_8h.html#a56aad9fa74696d2a86028361323a75a6">VM_CALL_ARGS_SPLAT_BIT</a>;
<a name="l02969"></a>02969 
<a name="l02970"></a>02970             <span class="keywordflow">if</span> (next_is_array) {
<a name="l02971"></a>02971                 argc = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(<a class="code" href="../../d2/d47/compile_8c.html#a8972c4295ae6e3b0a8eb9fa97586b425">compile_array</a>(iseq, args, argn-&gt;nd_head, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aba0717d2689eb68797421a02ab9295c6">Qfalse</a>) + 1);
<a name="l02972"></a>02972                 <a class="code" href="../../d2/d47/compile_8c.html#a56c34aaed1ac9f929e9f73c680fb32c3">POP_ELEMENT</a>(args);
<a name="l02973"></a>02973             }
<a name="l02974"></a>02974             <span class="keywordflow">else</span> {
<a name="l02975"></a>02975                 argn = argn-&gt;nd_head;
<a name="l02976"></a>02976                 <span class="keywordflow">goto</span> setup_argn;
<a name="l02977"></a>02977             }
<a name="l02978"></a>02978             <span class="keywordflow">break</span>;
<a name="l02979"></a>02979           }
<a name="l02980"></a>02980           <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#a490d1fc6f7f9e81a1815e9b1c3080d94">NODE_ARRAY</a>: {
<a name="l02981"></a>02981             argc = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(<a class="code" href="../../d2/d47/compile_8c.html#a8972c4295ae6e3b0a8eb9fa97586b425">compile_array</a>(iseq, args, argn, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aba0717d2689eb68797421a02ab9295c6">Qfalse</a>));
<a name="l02982"></a>02982             <a class="code" href="../../d2/d47/compile_8c.html#a56c34aaed1ac9f929e9f73c680fb32c3">POP_ELEMENT</a>(args);
<a name="l02983"></a>02983             <span class="keywordflow">break</span>;
<a name="l02984"></a>02984           }
<a name="l02985"></a>02985           <span class="keywordflow">default</span>: {
<a name="l02986"></a>02986             <a class="code" href="../../db/dcc/error_8c.html#a2d5fb28e54f792e7341b2c45f52f3860">rb_bug</a>(<span class="stringliteral">&quot;setup_arg: unknown node: %s\n&quot;</span>, <a class="code" href="../../dd/d74/iseq_8c.html#a818834c71f4a58f5bd7f0aa142d1b069">ruby_node_name</a>(<a class="code" href="../../d3/d09/ripper_8y.html#ade12c589b26f55f089dc25d689249c11">nd_type</a>(argn)));
<a name="l02987"></a>02987           }
<a name="l02988"></a>02988         }
<a name="l02989"></a>02989     }
<a name="l02990"></a>02990 
<a name="l02991"></a>02991     <span class="keywordflow">if</span> (nsplat &gt; 1) {
<a name="l02992"></a>02992         <span class="keywordtype">int</span> i;
<a name="l02993"></a>02993         <span class="keywordflow">for</span> (i=1; i&lt;nsplat; i++) {
<a name="l02994"></a>02994             <a class="code" href="../../d2/d47/compile_8c.html#aa5b45ae61de3350f0830a32589bbb7ee">ADD_INSN</a>(args_splat, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(args), concatarray);
<a name="l02995"></a>02995         }
<a name="l02996"></a>02996     }
<a name="l02997"></a>02997 
<a name="l02998"></a>02998     <span class="keywordflow">if</span> (!<a class="code" href="../../d2/d47/compile_8c.html#aa32aff332271737c2a3edbb440ad4ca1">LIST_SIZE_ZERO</a>(args_splat)) {
<a name="l02999"></a>02999         <a class="code" href="../../d2/d47/compile_8c.html#afd9d72d069724385c83bcc32d6746b1e">ADD_SEQ</a>(args, args_splat);
<a name="l03000"></a>03000     }
<a name="l03001"></a>03001 
<a name="l03002"></a>03002     <span class="keywordflow">if</span> (*flag &amp; <a class="code" href="../../d8/d32/vm__core_8h.html#aee4df54d62a5eb107fdd8757de767ee6">VM_CALL_ARGS_BLOCKARG_BIT</a>) {
<a name="l03003"></a>03003         <a class="code" href="../../d2/d47/compile_8c.html#afd9d72d069724385c83bcc32d6746b1e">ADD_SEQ</a>(args, arg_block);
<a name="l03004"></a>03004     }
<a name="l03005"></a>03005     <span class="keywordflow">return</span> argc;
<a name="l03006"></a>03006 }
<a name="l03007"></a>03007 
<a name="l03008"></a>03008 
<a name="l03016"></a>03016 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l03017"></a><a class="code" href="../../d2/d47/compile_8c.html#a12770fd96fd1210ca094e06da53a7e9d">03017</a> <a class="code" href="../../d2/d47/compile_8c.html#a12770fd96fd1210ca094e06da53a7e9d" title="compile each node">iseq_compile_each</a>(<a class="code" href="../../d6/de3/structrb__iseq__struct.html">rb_iseq_t</a> *iseq, <a class="code" href="../../d4/dcd/structiseq__link__anchor.html">LINK_ANCHOR</a> *ret, NODE * <a class="code" href="../../d7/dc0/parse_8y.html#a0d7af8a92c4b0a07f71585584ef9634f">node</a>, <span class="keywordtype">int</span> poped)
<a name="l03018"></a>03018 {
<a name="l03019"></a>03019     <span class="keyword">enum</span> <a class="code" href="../../d1/d72/debug_8c.html#a3dae8bc7c708705be3a6e1688378868e">node_type</a> <a class="code" href="../../d5/d9d/tcltklib_8c.html#ac765329451135abec74c45e1897abf26">type</a>;
<a name="l03020"></a>03020 
<a name="l03021"></a>03021     <span class="keywordflow">if</span> (node == 0) {
<a name="l03022"></a>03022         <span class="keywordflow">if</span> (!poped) {
<a name="l03023"></a>03023             <a class="code" href="../../d2/d47/compile_8c.html#a72ae3dfc8896ca7c87ed2aed1810db43">debugs</a>(<span class="stringliteral">&quot;node: NODE_NIL(implicit)\n&quot;</span>);
<a name="l03024"></a>03024             <a class="code" href="../../d2/d47/compile_8c.html#aa5b45ae61de3350f0830a32589bbb7ee">ADD_INSN</a>(ret, iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a947d34698fb5a71f4938532fff27a0f7">compile_data</a>-&gt;<a class="code" href="../../d4/dd8/structiseq__compile__data.html#a4047d9fbac6d3e6c2afa279f6bb83d5a">last_line</a>, putnil);
<a name="l03025"></a>03025         }
<a name="l03026"></a>03026         <span class="keywordflow">return</span> <a class="code" href="../../d2/d47/compile_8c.html#a652dda0d529b866959c19fe27293968e">COMPILE_OK</a>;
<a name="l03027"></a>03027     }
<a name="l03028"></a>03028 
<a name="l03029"></a>03029     iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a947d34698fb5a71f4938532fff27a0f7">compile_data</a>-&gt;<a class="code" href="../../d4/dd8/structiseq__compile__data.html#a4047d9fbac6d3e6c2afa279f6bb83d5a">last_line</a> = (int)<a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node);
<a name="l03030"></a>03030     <a class="code" href="../../d2/d47/compile_8c.html#ad6f547f3bb2685a3a6732463b3dd1d34">debug_node_start</a>(node);
<a name="l03031"></a>03031 
<a name="l03032"></a>03032     type = <a class="code" href="../../d3/d09/ripper_8y.html#ade12c589b26f55f089dc25d689249c11">nd_type</a>(node);
<a name="l03033"></a>03033 
<a name="l03034"></a>03034     <span class="keywordflow">if</span> (node-&gt;flags &amp; <a class="code" href="../../d3/d09/ripper_8y.html#aca499ed79c89ddea66b38e191e5aa2e3">NODE_FL_NEWLINE</a>) {
<a name="l03035"></a>03035         <a class="code" href="../../d2/d47/compile_8c.html#a1da9ded6df71178c67dd7252e3c64ea1">ADD_TRACE</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a9dc5a999141f348fa4b1b265802343a0">RUBY_EVENT_LINE</a>);
<a name="l03036"></a>03036     }
<a name="l03037"></a>03037 
<a name="l03038"></a>03038     <span class="keywordflow">switch</span> (type) {
<a name="l03039"></a>03039       <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#ae26c9ff309f6c5d0fd5c3edd0232ee0d">NODE_BLOCK</a>:{
<a name="l03040"></a>03040         <span class="keywordflow">while</span> (node &amp;&amp; <a class="code" href="../../d3/d09/ripper_8y.html#ade12c589b26f55f089dc25d689249c11">nd_type</a>(node) == <a class="code" href="../../d3/d09/ripper_8y.html#ae26c9ff309f6c5d0fd5c3edd0232ee0d">NODE_BLOCK</a>) {
<a name="l03041"></a>03041             <a class="code" href="../../d2/d47/compile_8c.html#a04d4dbcbb97179b5908eb025e13c7752">COMPILE_</a>(ret, <span class="stringliteral">&quot;BLOCK body&quot;</span>, node-&gt;nd_head,
<a name="l03042"></a>03042                      (node-&gt;nd_next == 0 &amp;&amp; poped == 0) ? 0 : 1);
<a name="l03043"></a>03043             node = node-&gt;nd_next;
<a name="l03044"></a>03044         }
<a name="l03045"></a>03045         <span class="keywordflow">if</span> (node) {
<a name="l03046"></a>03046             <a class="code" href="../../d2/d47/compile_8c.html#a04d4dbcbb97179b5908eb025e13c7752">COMPILE_</a>(ret, <span class="stringliteral">&quot;BLOCK next&quot;</span>, node-&gt;nd_next, poped);
<a name="l03047"></a>03047         }
<a name="l03048"></a>03048         <span class="keywordflow">break</span>;
<a name="l03049"></a>03049       }
<a name="l03050"></a>03050       <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#ab964a29f7a8cdb1e4b518b4cb7420ea5">NODE_IF</a>:{
<a name="l03051"></a>03051         <a class="code" href="../../d2/d47/compile_8c.html#aa9d6014cec8d3adcb228b81620eac795">DECL_ANCHOR</a>(cond_seq);
<a name="l03052"></a>03052         <a class="code" href="../../d2/d47/compile_8c.html#aa9d6014cec8d3adcb228b81620eac795">DECL_ANCHOR</a>(then_seq);
<a name="l03053"></a>03053         <a class="code" href="../../d2/d47/compile_8c.html#aa9d6014cec8d3adcb228b81620eac795">DECL_ANCHOR</a>(else_seq);
<a name="l03054"></a>03054         <a class="code" href="../../d8/dc5/structiseq__label__data.html">LABEL</a> *then_label, *else_label, *end_label;
<a name="l03055"></a>03055 
<a name="l03056"></a>03056         <a class="code" href="../../d2/d47/compile_8c.html#ac32b1f7d8de8f10f33a147030d8b7544">INIT_ANCHOR</a>(cond_seq);
<a name="l03057"></a>03057         <a class="code" href="../../d2/d47/compile_8c.html#ac32b1f7d8de8f10f33a147030d8b7544">INIT_ANCHOR</a>(then_seq);
<a name="l03058"></a>03058         <a class="code" href="../../d2/d47/compile_8c.html#ac32b1f7d8de8f10f33a147030d8b7544">INIT_ANCHOR</a>(else_seq);
<a name="l03059"></a>03059         then_label = <a class="code" href="../../d2/d47/compile_8c.html#a1d6d5d8dac7aff9ac863255a0905c0f9">NEW_LABEL</a>(<a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node));
<a name="l03060"></a>03060         else_label = <a class="code" href="../../d2/d47/compile_8c.html#a1d6d5d8dac7aff9ac863255a0905c0f9">NEW_LABEL</a>(<a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node));
<a name="l03061"></a>03061         end_label = <a class="code" href="../../d2/d47/compile_8c.html#a1d6d5d8dac7aff9ac863255a0905c0f9">NEW_LABEL</a>(<a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node));
<a name="l03062"></a>03062 
<a name="l03063"></a>03063         <a class="code" href="../../d2/d47/compile_8c.html#a24de6ed2392e233f64384ec0c4c96642">compile_branch_condition</a>(iseq, cond_seq, node-&gt;nd_cond,
<a name="l03064"></a>03064                                  then_label, else_label);
<a name="l03065"></a>03065         <a class="code" href="../../d2/d47/compile_8c.html#a04d4dbcbb97179b5908eb025e13c7752">COMPILE_</a>(then_seq, <span class="stringliteral">&quot;then&quot;</span>, node-&gt;nd_body, poped);
<a name="l03066"></a>03066         <a class="code" href="../../d2/d47/compile_8c.html#a04d4dbcbb97179b5908eb025e13c7752">COMPILE_</a>(else_seq, <span class="stringliteral">&quot;else&quot;</span>, node-&gt;nd_else, poped);
<a name="l03067"></a>03067 
<a name="l03068"></a>03068         <a class="code" href="../../d2/d47/compile_8c.html#afd9d72d069724385c83bcc32d6746b1e">ADD_SEQ</a>(ret, cond_seq);
<a name="l03069"></a>03069 
<a name="l03070"></a>03070         <a class="code" href="../../d2/d47/compile_8c.html#a5a380bb449656575d6b77ccb8eb7e5ae">ADD_LABEL</a>(ret, then_label);
<a name="l03071"></a>03071         <a class="code" href="../../d2/d47/compile_8c.html#afd9d72d069724385c83bcc32d6746b1e">ADD_SEQ</a>(ret, then_seq);
<a name="l03072"></a>03072         <a class="code" href="../../d2/d47/compile_8c.html#ace57e2f70722586d3764284364cfb5ad">ADD_INSNL</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), jump, end_label);
<a name="l03073"></a>03073 
<a name="l03074"></a>03074         <a class="code" href="../../d2/d47/compile_8c.html#a5a380bb449656575d6b77ccb8eb7e5ae">ADD_LABEL</a>(ret, else_label);
<a name="l03075"></a>03075         <a class="code" href="../../d2/d47/compile_8c.html#afd9d72d069724385c83bcc32d6746b1e">ADD_SEQ</a>(ret, else_seq);
<a name="l03076"></a>03076 
<a name="l03077"></a>03077         <a class="code" href="../../d2/d47/compile_8c.html#a5a380bb449656575d6b77ccb8eb7e5ae">ADD_LABEL</a>(ret, end_label);
<a name="l03078"></a>03078 
<a name="l03079"></a>03079         <span class="keywordflow">break</span>;
<a name="l03080"></a>03080       }
<a name="l03081"></a>03081       <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#a73d8430547c57f3a7c0734b1a598ff8e">NODE_CASE</a>:{
<a name="l03082"></a>03082         NODE *vals;
<a name="l03083"></a>03083         NODE *tempnode = node;
<a name="l03084"></a>03084         <a class="code" href="../../d8/dc5/structiseq__label__data.html">LABEL</a> *endlabel, *elselabel;
<a name="l03085"></a>03085         <a class="code" href="../../d2/d47/compile_8c.html#aa9d6014cec8d3adcb228b81620eac795">DECL_ANCHOR</a>(head);
<a name="l03086"></a>03086         <a class="code" href="../../d2/d47/compile_8c.html#aa9d6014cec8d3adcb228b81620eac795">DECL_ANCHOR</a>(body_seq);
<a name="l03087"></a>03087         <a class="code" href="../../d2/d47/compile_8c.html#aa9d6014cec8d3adcb228b81620eac795">DECL_ANCHOR</a>(cond_seq);
<a name="l03088"></a>03088         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> special_literals = <a class="code" href="../../dc/dcc/array_8c.html#aaf7e3ca42191580b60f398d5ec466766">rb_ary_tmp_new</a>(1);
<a name="l03089"></a>03089 
<a name="l03090"></a>03090         <a class="code" href="../../d2/d47/compile_8c.html#ac32b1f7d8de8f10f33a147030d8b7544">INIT_ANCHOR</a>(head);
<a name="l03091"></a>03091         <a class="code" href="../../d2/d47/compile_8c.html#ac32b1f7d8de8f10f33a147030d8b7544">INIT_ANCHOR</a>(body_seq);
<a name="l03092"></a>03092         <a class="code" href="../../d2/d47/compile_8c.html#ac32b1f7d8de8f10f33a147030d8b7544">INIT_ANCHOR</a>(cond_seq);
<a name="l03093"></a>03093         <span class="keywordflow">if</span> (node-&gt;nd_head == 0) {
<a name="l03094"></a>03094             <a class="code" href="../../d2/d47/compile_8c.html#a04d4dbcbb97179b5908eb025e13c7752">COMPILE_</a>(ret, <span class="stringliteral">&quot;when&quot;</span>, node-&gt;nd_body, poped);
<a name="l03095"></a>03095             <span class="keywordflow">break</span>;
<a name="l03096"></a>03096         }
<a name="l03097"></a>03097         <a class="code" href="../../d2/d47/compile_8c.html#a0cacd6cfca69df35e1535d2f21532c47">COMPILE</a>(head, <span class="stringliteral">&quot;case base&quot;</span>, node-&gt;nd_head);
<a name="l03098"></a>03098 
<a name="l03099"></a>03099         node = node-&gt;nd_body;
<a name="l03100"></a>03100         type = <a class="code" href="../../d3/d09/ripper_8y.html#ade12c589b26f55f089dc25d689249c11">nd_type</a>(node);
<a name="l03101"></a>03101 
<a name="l03102"></a>03102         <span class="keywordflow">if</span> (type != <a class="code" href="../../d3/d09/ripper_8y.html#abe133b4015b1ff19345d5d25781fc25e">NODE_WHEN</a>) {
<a name="l03103"></a>03103             <a class="code" href="../../d2/d47/compile_8c.html#ae84f2851369429ff178e5d2c6eaae309">COMPILE_ERROR</a>((<a class="code" href="../../d2/d47/compile_8c.html#af94c9e3c1e8a00be6cb2ab8851055473">ERROR_ARGS</a> <span class="stringliteral">&quot;NODE_CASE: unexpected node. must be NODE_WHEN, but %s&quot;</span>, <a class="code" href="../../dd/d74/iseq_8c.html#a818834c71f4a58f5bd7f0aa142d1b069">ruby_node_name</a>(type)));
<a name="l03104"></a>03104         }
<a name="l03105"></a>03105 
<a name="l03106"></a>03106         endlabel = <a class="code" href="../../d2/d47/compile_8c.html#a1d6d5d8dac7aff9ac863255a0905c0f9">NEW_LABEL</a>(<a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node));
<a name="l03107"></a>03107         elselabel = <a class="code" href="../../d2/d47/compile_8c.html#a1d6d5d8dac7aff9ac863255a0905c0f9">NEW_LABEL</a>(<a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node));
<a name="l03108"></a>03108 
<a name="l03109"></a>03109         <a class="code" href="../../d2/d47/compile_8c.html#afd9d72d069724385c83bcc32d6746b1e">ADD_SEQ</a>(ret, head);     <span class="comment">/* case VAL */</span>
<a name="l03110"></a>03110 
<a name="l03111"></a>03111         <span class="keywordflow">while</span> (type == <a class="code" href="../../d3/d09/ripper_8y.html#abe133b4015b1ff19345d5d25781fc25e">NODE_WHEN</a>) {
<a name="l03112"></a>03112             <a class="code" href="../../d8/dc5/structiseq__label__data.html">LABEL</a> *l1;
<a name="l03113"></a>03113 
<a name="l03114"></a>03114             l1 = <a class="code" href="../../d2/d47/compile_8c.html#a1d6d5d8dac7aff9ac863255a0905c0f9">NEW_LABEL</a>(<a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node));
<a name="l03115"></a>03115             <a class="code" href="../../d2/d47/compile_8c.html#a5a380bb449656575d6b77ccb8eb7e5ae">ADD_LABEL</a>(body_seq, l1);
<a name="l03116"></a>03116             <a class="code" href="../../d2/d47/compile_8c.html#aa5b45ae61de3350f0830a32589bbb7ee">ADD_INSN</a>(body_seq, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), pop);
<a name="l03117"></a>03117             <a class="code" href="../../d2/d47/compile_8c.html#a04d4dbcbb97179b5908eb025e13c7752">COMPILE_</a>(body_seq, <span class="stringliteral">&quot;when body&quot;</span>, node-&gt;nd_body, poped);
<a name="l03118"></a>03118             <a class="code" href="../../d2/d47/compile_8c.html#ace57e2f70722586d3764284364cfb5ad">ADD_INSNL</a>(body_seq, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), jump, endlabel);
<a name="l03119"></a>03119 
<a name="l03120"></a>03120             vals = node-&gt;nd_head;
<a name="l03121"></a>03121             <span class="keywordflow">if</span> (vals) {
<a name="l03122"></a>03122                 <span class="keywordflow">switch</span> (<a class="code" href="../../d3/d09/ripper_8y.html#ade12c589b26f55f089dc25d689249c11">nd_type</a>(vals)) {
<a name="l03123"></a>03123                   <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#a490d1fc6f7f9e81a1815e9b1c3080d94">NODE_ARRAY</a>:
<a name="l03124"></a>03124                     special_literals = <a class="code" href="../../d2/d47/compile_8c.html#a21972232fac29e2ab889b2e059dc7d1f">when_vals</a>(iseq, cond_seq, vals, l1, special_literals);
<a name="l03125"></a>03125                     <span class="keywordflow">break</span>;
<a name="l03126"></a>03126                   <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#a985f27752acfb29eca912c28522329c3">NODE_SPLAT</a>:
<a name="l03127"></a>03127                   <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#a796ba7c9f501e5f81b4f6f06972250fd">NODE_ARGSCAT</a>:
<a name="l03128"></a>03128                   <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#a15dc4d72c7b3a577d28e6131a63926d9">NODE_ARGSPUSH</a>:
<a name="l03129"></a>03129                     special_literals = 0;
<a name="l03130"></a>03130                     <a class="code" href="../../d2/d47/compile_8c.html#a0cacd6cfca69df35e1535d2f21532c47">COMPILE</a>(cond_seq, <span class="stringliteral">&quot;when/cond splat&quot;</span>, vals);
<a name="l03131"></a>03131                     <a class="code" href="../../d2/d47/compile_8c.html#a3cfeb7549a1249a8b78f9d6ff1e74c5a">ADD_INSN1</a>(cond_seq, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(vals), checkincludearray, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aacea3516b33941ce8149098e223a7466">Qtrue</a>);
<a name="l03132"></a>03132                     <a class="code" href="../../d2/d47/compile_8c.html#ace57e2f70722586d3764284364cfb5ad">ADD_INSNL</a>(cond_seq, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(vals), branchif, l1);
<a name="l03133"></a>03133                     <span class="keywordflow">break</span>;
<a name="l03134"></a>03134                   <span class="keywordflow">default</span>:
<a name="l03135"></a>03135                     <a class="code" href="../../db/dcc/error_8c.html#a2d5fb28e54f792e7341b2c45f52f3860">rb_bug</a>(<span class="stringliteral">&quot;NODE_CASE: unknown node (%s)&quot;</span>,
<a name="l03136"></a>03136                            <a class="code" href="../../dd/d74/iseq_8c.html#a818834c71f4a58f5bd7f0aa142d1b069">ruby_node_name</a>(<a class="code" href="../../d3/d09/ripper_8y.html#ade12c589b26f55f089dc25d689249c11">nd_type</a>(vals)));
<a name="l03137"></a>03137                 }
<a name="l03138"></a>03138             }
<a name="l03139"></a>03139             <span class="keywordflow">else</span> {
<a name="l03140"></a>03140                 <a class="code" href="../../db/dcc/error_8c.html#a2d5fb28e54f792e7341b2c45f52f3860">rb_bug</a>(<span class="stringliteral">&quot;NODE_CASE: must be NODE_ARRAY, but 0&quot;</span>);
<a name="l03141"></a>03141             }
<a name="l03142"></a>03142 
<a name="l03143"></a>03143             node = node-&gt;nd_next;
<a name="l03144"></a>03144             <span class="keywordflow">if</span> (!node) {
<a name="l03145"></a>03145                 <span class="keywordflow">break</span>;
<a name="l03146"></a>03146             }
<a name="l03147"></a>03147             type = <a class="code" href="../../d3/d09/ripper_8y.html#ade12c589b26f55f089dc25d689249c11">nd_type</a>(node);
<a name="l03148"></a>03148         }
<a name="l03149"></a>03149         <span class="comment">/* else */</span>
<a name="l03150"></a>03150         <span class="keywordflow">if</span> (node) {
<a name="l03151"></a>03151             <a class="code" href="../../d2/d47/compile_8c.html#a5a380bb449656575d6b77ccb8eb7e5ae">ADD_LABEL</a>(cond_seq, elselabel);
<a name="l03152"></a>03152             <a class="code" href="../../d2/d47/compile_8c.html#aa5b45ae61de3350f0830a32589bbb7ee">ADD_INSN</a>(cond_seq, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), pop);
<a name="l03153"></a>03153             <a class="code" href="../../d2/d47/compile_8c.html#a04d4dbcbb97179b5908eb025e13c7752">COMPILE_</a>(cond_seq, <span class="stringliteral">&quot;else&quot;</span>, node, poped);
<a name="l03154"></a>03154             <a class="code" href="../../d2/d47/compile_8c.html#ace57e2f70722586d3764284364cfb5ad">ADD_INSNL</a>(cond_seq, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), jump, endlabel);
<a name="l03155"></a>03155         }
<a name="l03156"></a>03156         <span class="keywordflow">else</span> {
<a name="l03157"></a>03157             <a class="code" href="../../d2/d47/compile_8c.html#a72ae3dfc8896ca7c87ed2aed1810db43">debugs</a>(<span class="stringliteral">&quot;== else (implicit)\n&quot;</span>);
<a name="l03158"></a>03158             <a class="code" href="../../d2/d47/compile_8c.html#a5a380bb449656575d6b77ccb8eb7e5ae">ADD_LABEL</a>(cond_seq, elselabel);
<a name="l03159"></a>03159             <a class="code" href="../../d2/d47/compile_8c.html#aa5b45ae61de3350f0830a32589bbb7ee">ADD_INSN</a>(cond_seq, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(tempnode), pop);
<a name="l03160"></a>03160             <span class="keywordflow">if</span> (!poped) {
<a name="l03161"></a>03161                 <a class="code" href="../../d2/d47/compile_8c.html#aa5b45ae61de3350f0830a32589bbb7ee">ADD_INSN</a>(cond_seq, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(tempnode), putnil);
<a name="l03162"></a>03162             }
<a name="l03163"></a>03163             <a class="code" href="../../d2/d47/compile_8c.html#ace57e2f70722586d3764284364cfb5ad">ADD_INSNL</a>(cond_seq, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(tempnode), jump, endlabel);
<a name="l03164"></a>03164         }
<a name="l03165"></a>03165 
<a name="l03166"></a>03166         <span class="keywordflow">if</span> (special_literals) {
<a name="l03167"></a>03167             <a class="code" href="../../d2/d47/compile_8c.html#aa5b45ae61de3350f0830a32589bbb7ee">ADD_INSN</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(tempnode), dup);
<a name="l03168"></a>03168             <a class="code" href="../../d2/d47/compile_8c.html#a9e17ccfd8b31ec3afcb91be39a6d453f">ADD_INSN2</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(tempnode), opt_case_dispatch,
<a name="l03169"></a>03169                       special_literals, elselabel);
<a name="l03170"></a>03170             <a class="code" href="../../d2/d47/compile_8c.html#ad09bab1521a935e4affe9c1faf9a27c5">iseq_add_mark_object_compile_time</a>(iseq, special_literals);
<a name="l03171"></a>03171         }
<a name="l03172"></a>03172 
<a name="l03173"></a>03173         <a class="code" href="../../d2/d47/compile_8c.html#afd9d72d069724385c83bcc32d6746b1e">ADD_SEQ</a>(ret, cond_seq);
<a name="l03174"></a>03174         <a class="code" href="../../d2/d47/compile_8c.html#afd9d72d069724385c83bcc32d6746b1e">ADD_SEQ</a>(ret, body_seq);
<a name="l03175"></a>03175         <a class="code" href="../../d2/d47/compile_8c.html#a5a380bb449656575d6b77ccb8eb7e5ae">ADD_LABEL</a>(ret, endlabel);
<a name="l03176"></a>03176         <span class="keywordflow">break</span>;
<a name="l03177"></a>03177       }
<a name="l03178"></a>03178       <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#abe133b4015b1ff19345d5d25781fc25e">NODE_WHEN</a>:{
<a name="l03179"></a>03179         NODE *vals;
<a name="l03180"></a>03180         NODE *val;
<a name="l03181"></a>03181         NODE *orig_node = node;
<a name="l03182"></a>03182         <a class="code" href="../../d8/dc5/structiseq__label__data.html">LABEL</a> *endlabel;
<a name="l03183"></a>03183         <a class="code" href="../../d2/d47/compile_8c.html#aa9d6014cec8d3adcb228b81620eac795">DECL_ANCHOR</a>(body_seq);
<a name="l03184"></a>03184 
<a name="l03185"></a>03185         <a class="code" href="../../d2/d47/compile_8c.html#ac32b1f7d8de8f10f33a147030d8b7544">INIT_ANCHOR</a>(body_seq);
<a name="l03186"></a>03186         endlabel = <a class="code" href="../../d2/d47/compile_8c.html#a1d6d5d8dac7aff9ac863255a0905c0f9">NEW_LABEL</a>(<a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node));
<a name="l03187"></a>03187 
<a name="l03188"></a>03188         <span class="keywordflow">while</span> (node &amp;&amp; <a class="code" href="../../d3/d09/ripper_8y.html#ade12c589b26f55f089dc25d689249c11">nd_type</a>(node) == <a class="code" href="../../d3/d09/ripper_8y.html#abe133b4015b1ff19345d5d25781fc25e">NODE_WHEN</a>) {
<a name="l03189"></a>03189             <a class="code" href="../../d8/dc5/structiseq__label__data.html">LABEL</a> *l1 = <a class="code" href="../../d2/d47/compile_8c.html#a1d6d5d8dac7aff9ac863255a0905c0f9">NEW_LABEL</a>(<a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node));
<a name="l03190"></a>03190             <a class="code" href="../../d2/d47/compile_8c.html#a5a380bb449656575d6b77ccb8eb7e5ae">ADD_LABEL</a>(body_seq, l1);
<a name="l03191"></a>03191             <a class="code" href="../../d2/d47/compile_8c.html#a04d4dbcbb97179b5908eb025e13c7752">COMPILE_</a>(body_seq, <span class="stringliteral">&quot;when&quot;</span>, node-&gt;nd_body, poped);
<a name="l03192"></a>03192             <a class="code" href="../../d2/d47/compile_8c.html#ace57e2f70722586d3764284364cfb5ad">ADD_INSNL</a>(body_seq, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), jump, endlabel);
<a name="l03193"></a>03193 
<a name="l03194"></a>03194             vals = node-&gt;nd_head;
<a name="l03195"></a>03195             <span class="keywordflow">if</span> (!vals) {
<a name="l03196"></a>03196                 <a class="code" href="../../db/dcc/error_8c.html#a2d5fb28e54f792e7341b2c45f52f3860">rb_bug</a>(<span class="stringliteral">&quot;NODE_WHEN: must be NODE_ARRAY, but 0&quot;</span>);
<a name="l03197"></a>03197             }
<a name="l03198"></a>03198             <span class="keywordflow">switch</span> (<a class="code" href="../../d3/d09/ripper_8y.html#ade12c589b26f55f089dc25d689249c11">nd_type</a>(vals)) {
<a name="l03199"></a>03199               <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#a490d1fc6f7f9e81a1815e9b1c3080d94">NODE_ARRAY</a>:
<a name="l03200"></a>03200                 <span class="keywordflow">while</span> (vals) {
<a name="l03201"></a>03201                     val = vals-&gt;nd_head;
<a name="l03202"></a>03202                     <a class="code" href="../../d2/d47/compile_8c.html#a0cacd6cfca69df35e1535d2f21532c47">COMPILE</a>(ret, <span class="stringliteral">&quot;when2&quot;</span>, val);
<a name="l03203"></a>03203                     <a class="code" href="../../d2/d47/compile_8c.html#ace57e2f70722586d3764284364cfb5ad">ADD_INSNL</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(val), branchif, l1);
<a name="l03204"></a>03204                     vals = vals-&gt;nd_next;
<a name="l03205"></a>03205                 }
<a name="l03206"></a>03206                 <span class="keywordflow">break</span>;
<a name="l03207"></a>03207               <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#a985f27752acfb29eca912c28522329c3">NODE_SPLAT</a>:
<a name="l03208"></a>03208               <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#a796ba7c9f501e5f81b4f6f06972250fd">NODE_ARGSCAT</a>:
<a name="l03209"></a>03209               <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#a15dc4d72c7b3a577d28e6131a63926d9">NODE_ARGSPUSH</a>:
<a name="l03210"></a>03210                 <a class="code" href="../../d2/d47/compile_8c.html#aa5b45ae61de3350f0830a32589bbb7ee">ADD_INSN</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(vals), putnil);
<a name="l03211"></a>03211                 <a class="code" href="../../d2/d47/compile_8c.html#a0cacd6cfca69df35e1535d2f21532c47">COMPILE</a>(ret, <span class="stringliteral">&quot;when2/cond splat&quot;</span>, vals);
<a name="l03212"></a>03212                 <a class="code" href="../../d2/d47/compile_8c.html#a3cfeb7549a1249a8b78f9d6ff1e74c5a">ADD_INSN1</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(vals), checkincludearray, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aba0717d2689eb68797421a02ab9295c6">Qfalse</a>);
<a name="l03213"></a>03213                 <a class="code" href="../../d2/d47/compile_8c.html#aa5b45ae61de3350f0830a32589bbb7ee">ADD_INSN</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(vals), pop);
<a name="l03214"></a>03214                 <a class="code" href="../../d2/d47/compile_8c.html#ace57e2f70722586d3764284364cfb5ad">ADD_INSNL</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(vals), branchif, l1);
<a name="l03215"></a>03215                 <span class="keywordflow">break</span>;
<a name="l03216"></a>03216               <span class="keywordflow">default</span>:
<a name="l03217"></a>03217                 <a class="code" href="../../db/dcc/error_8c.html#a2d5fb28e54f792e7341b2c45f52f3860">rb_bug</a>(<span class="stringliteral">&quot;NODE_WHEN: unknown node (%s)&quot;</span>,
<a name="l03218"></a>03218                        <a class="code" href="../../dd/d74/iseq_8c.html#a818834c71f4a58f5bd7f0aa142d1b069">ruby_node_name</a>(<a class="code" href="../../d3/d09/ripper_8y.html#ade12c589b26f55f089dc25d689249c11">nd_type</a>(vals)));
<a name="l03219"></a>03219             }
<a name="l03220"></a>03220             node = node-&gt;nd_next;
<a name="l03221"></a>03221         }
<a name="l03222"></a>03222         <span class="comment">/* else */</span>
<a name="l03223"></a>03223         <a class="code" href="../../d2/d47/compile_8c.html#a04d4dbcbb97179b5908eb025e13c7752">COMPILE_</a>(ret, <span class="stringliteral">&quot;else&quot;</span>, node, poped);
<a name="l03224"></a>03224         <a class="code" href="../../d2/d47/compile_8c.html#ace57e2f70722586d3764284364cfb5ad">ADD_INSNL</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(orig_node), jump, endlabel);
<a name="l03225"></a>03225 
<a name="l03226"></a>03226         <a class="code" href="../../d2/d47/compile_8c.html#afd9d72d069724385c83bcc32d6746b1e">ADD_SEQ</a>(ret, body_seq);
<a name="l03227"></a>03227         <a class="code" href="../../d2/d47/compile_8c.html#a5a380bb449656575d6b77ccb8eb7e5ae">ADD_LABEL</a>(ret, endlabel);
<a name="l03228"></a>03228 
<a name="l03229"></a>03229         <span class="keywordflow">break</span>;
<a name="l03230"></a>03230       }
<a name="l03231"></a>03231       <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#a25c86d19e5399c64a4d3b1278e158272">NODE_OPT_N</a>:
<a name="l03232"></a>03232       <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#a271e594a40ed0575457ea8d9def940ac">NODE_WHILE</a>:
<a name="l03233"></a>03233       <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#af25da300c34f1bca6c6e4df28947cb72">NODE_UNTIL</a>:{
<a name="l03234"></a>03234         <a class="code" href="../../d8/dc5/structiseq__label__data.html">LABEL</a> *prev_start_label = iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a947d34698fb5a71f4938532fff27a0f7">compile_data</a>-&gt;<a class="code" href="../../d4/dd8/structiseq__compile__data.html#a055ae44f47869f10dda6b21a2433fa1e">start_label</a>;
<a name="l03235"></a>03235         <a class="code" href="../../d8/dc5/structiseq__label__data.html">LABEL</a> *prev_end_label = iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a947d34698fb5a71f4938532fff27a0f7">compile_data</a>-&gt;<a class="code" href="../../d4/dd8/structiseq__compile__data.html#ab37fd8ba916a4fd8c59e9eec084107ad">end_label</a>;
<a name="l03236"></a>03236         <a class="code" href="../../d8/dc5/structiseq__label__data.html">LABEL</a> *prev_redo_label = iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a947d34698fb5a71f4938532fff27a0f7">compile_data</a>-&gt;<a class="code" href="../../d4/dd8/structiseq__compile__data.html#a31238638ba93181cc34093e9199b4dc8">redo_label</a>;
<a name="l03237"></a>03237         <span class="keywordtype">int</span> prev_loopval_popped = iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a947d34698fb5a71f4938532fff27a0f7">compile_data</a>-&gt;<a class="code" href="../../d4/dd8/structiseq__compile__data.html#a811f3927c9cb6310081b983832355811">loopval_popped</a>;
<a name="l03238"></a>03238 
<a name="l03239"></a>03239         <span class="keyword">struct </span><a class="code" href="../../d6/dca/structiseq__compile__data__ensure__node__stack.html">iseq_compile_data_ensure_node_stack</a> enl;
<a name="l03240"></a>03240 
<a name="l03241"></a>03241         <a class="code" href="../../d8/dc5/structiseq__label__data.html">LABEL</a> *next_label = iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a947d34698fb5a71f4938532fff27a0f7">compile_data</a>-&gt;<a class="code" href="../../d4/dd8/structiseq__compile__data.html#a055ae44f47869f10dda6b21a2433fa1e">start_label</a> = <a class="code" href="../../d2/d47/compile_8c.html#a1d6d5d8dac7aff9ac863255a0905c0f9">NEW_LABEL</a>(<a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node)); <span class="comment">/* next  */</span>
<a name="l03242"></a>03242         <a class="code" href="../../d8/dc5/structiseq__label__data.html">LABEL</a> *redo_label = iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a947d34698fb5a71f4938532fff27a0f7">compile_data</a>-&gt;<a class="code" href="../../d4/dd8/structiseq__compile__data.html#a31238638ba93181cc34093e9199b4dc8">redo_label</a> = <a class="code" href="../../d2/d47/compile_8c.html#a1d6d5d8dac7aff9ac863255a0905c0f9">NEW_LABEL</a>(<a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node));  <span class="comment">/* redo  */</span>
<a name="l03243"></a>03243         <a class="code" href="../../d8/dc5/structiseq__label__data.html">LABEL</a> *break_label = iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a947d34698fb5a71f4938532fff27a0f7">compile_data</a>-&gt;<a class="code" href="../../d4/dd8/structiseq__compile__data.html#ab37fd8ba916a4fd8c59e9eec084107ad">end_label</a> = <a class="code" href="../../d2/d47/compile_8c.html#a1d6d5d8dac7aff9ac863255a0905c0f9">NEW_LABEL</a>(<a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node));  <span class="comment">/* break */</span>
<a name="l03244"></a>03244         <a class="code" href="../../d8/dc5/structiseq__label__data.html">LABEL</a> *end_label = <a class="code" href="../../d2/d47/compile_8c.html#a1d6d5d8dac7aff9ac863255a0905c0f9">NEW_LABEL</a>(<a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node));
<a name="l03245"></a>03245 
<a name="l03246"></a>03246         <a class="code" href="../../d8/dc5/structiseq__label__data.html">LABEL</a> *next_catch_label = <a class="code" href="../../d2/d47/compile_8c.html#a1d6d5d8dac7aff9ac863255a0905c0f9">NEW_LABEL</a>(<a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node));
<a name="l03247"></a>03247         <a class="code" href="../../d8/dc5/structiseq__label__data.html">LABEL</a> *tmp_label = <a class="code" href="../../d3/d09/ripper_8y.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l03248"></a>03248 
<a name="l03249"></a>03249         iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a947d34698fb5a71f4938532fff27a0f7">compile_data</a>-&gt;<a class="code" href="../../d4/dd8/structiseq__compile__data.html#a811f3927c9cb6310081b983832355811">loopval_popped</a> = 0;
<a name="l03250"></a>03250         <a class="code" href="../../d2/d47/compile_8c.html#a58ce1f4f951df593103360ac94cb0e6c">push_ensure_entry</a>(iseq, &amp;enl, 0, 0);
<a name="l03251"></a>03251 
<a name="l03252"></a>03252         <span class="keywordflow">if</span> (type == <a class="code" href="../../d3/d09/ripper_8y.html#a25c86d19e5399c64a4d3b1278e158272">NODE_OPT_N</a> || node-&gt;nd_state == 1) {
<a name="l03253"></a>03253             <a class="code" href="../../d2/d47/compile_8c.html#ace57e2f70722586d3764284364cfb5ad">ADD_INSNL</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), jump, next_label);
<a name="l03254"></a>03254         }
<a name="l03255"></a>03255         <span class="keywordflow">else</span> {
<a name="l03256"></a>03256             tmp_label = <a class="code" href="../../d2/d47/compile_8c.html#a1d6d5d8dac7aff9ac863255a0905c0f9">NEW_LABEL</a>(<a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node));
<a name="l03257"></a>03257             <a class="code" href="../../d2/d47/compile_8c.html#ace57e2f70722586d3764284364cfb5ad">ADD_INSNL</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), jump, tmp_label);
<a name="l03258"></a>03258         }
<a name="l03259"></a>03259         <a class="code" href="../../d2/d47/compile_8c.html#aa5b45ae61de3350f0830a32589bbb7ee">ADD_INSN</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), putnil);
<a name="l03260"></a>03260         <a class="code" href="../../d2/d47/compile_8c.html#a5a380bb449656575d6b77ccb8eb7e5ae">ADD_LABEL</a>(ret, next_catch_label);
<a name="l03261"></a>03261         <a class="code" href="../../d2/d47/compile_8c.html#aa5b45ae61de3350f0830a32589bbb7ee">ADD_INSN</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), pop);
<a name="l03262"></a>03262         <a class="code" href="../../d2/d47/compile_8c.html#ace57e2f70722586d3764284364cfb5ad">ADD_INSNL</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), jump, next_label);
<a name="l03263"></a>03263         <span class="keywordflow">if</span> (tmp_label) <a class="code" href="../../d2/d47/compile_8c.html#a5a380bb449656575d6b77ccb8eb7e5ae">ADD_LABEL</a>(ret, tmp_label);
<a name="l03264"></a>03264 
<a name="l03265"></a>03265         <a class="code" href="../../d2/d47/compile_8c.html#a5a380bb449656575d6b77ccb8eb7e5ae">ADD_LABEL</a>(ret, redo_label);
<a name="l03266"></a>03266         <a class="code" href="../../d2/d47/compile_8c.html#a4e7115fce9f91ee84931798cc3474229">COMPILE_POPED</a>(ret, <span class="stringliteral">&quot;while body&quot;</span>, node-&gt;nd_body);
<a name="l03267"></a>03267         <a class="code" href="../../d2/d47/compile_8c.html#a5a380bb449656575d6b77ccb8eb7e5ae">ADD_LABEL</a>(ret, next_label);     <span class="comment">/* next */</span>
<a name="l03268"></a>03268 
<a name="l03269"></a>03269         <span class="keywordflow">if</span> (type == <a class="code" href="../../d3/d09/ripper_8y.html#a271e594a40ed0575457ea8d9def940ac">NODE_WHILE</a>) {
<a name="l03270"></a>03270             <a class="code" href="../../d2/d47/compile_8c.html#a24de6ed2392e233f64384ec0c4c96642">compile_branch_condition</a>(iseq, ret, node-&gt;nd_cond,
<a name="l03271"></a>03271                                      redo_label, end_label);
<a name="l03272"></a>03272         }
<a name="l03273"></a>03273         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (type == <a class="code" href="../../d3/d09/ripper_8y.html#af25da300c34f1bca6c6e4df28947cb72">NODE_UNTIL</a>) {
<a name="l03274"></a>03274             <span class="comment">/* untile */</span>
<a name="l03275"></a>03275             <a class="code" href="../../d2/d47/compile_8c.html#a24de6ed2392e233f64384ec0c4c96642">compile_branch_condition</a>(iseq, ret, node-&gt;nd_cond,
<a name="l03276"></a>03276                                      end_label, redo_label);
<a name="l03277"></a>03277         }
<a name="l03278"></a>03278         <span class="keywordflow">else</span> {
<a name="l03279"></a>03279             <a class="code" href="../../d2/d47/compile_8c.html#a50d9af29f829b84d8d09dbd8a6ccde89">ADD_CALL_RECEIVER</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node));
<a name="l03280"></a>03280             <a class="code" href="../../d2/d47/compile_8c.html#ab48821feeaaab5e4b16d951222546ef4">ADD_CALL</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), <a class="code" href="../../dc/d0c/cparse_8c.html#a48bfb6519a45249fb2ec0193ea3b6e1c">ID2SYM</a>(idGets), <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(0));
<a name="l03281"></a>03281             <a class="code" href="../../d2/d47/compile_8c.html#ace57e2f70722586d3764284364cfb5ad">ADD_INSNL</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), branchif, redo_label);
<a name="l03282"></a>03282             <span class="comment">/* opt_n */</span>
<a name="l03283"></a>03283         }
<a name="l03284"></a>03284 
<a name="l03285"></a>03285         <a class="code" href="../../d2/d47/compile_8c.html#a5a380bb449656575d6b77ccb8eb7e5ae">ADD_LABEL</a>(ret, end_label);
<a name="l03286"></a>03286 
<a name="l03287"></a>03287         <span class="keywordflow">if</span> (node-&gt;nd_state == <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a2edf6990280eb2637623ccd421dee4f0">Qundef</a>) {
<a name="l03288"></a>03288             <span class="comment">/* ADD_INSN(ret, nd_line(node), putundef); */</span>
<a name="l03289"></a>03289             <a class="code" href="../../db/dcc/error_8c.html#a2d5fb28e54f792e7341b2c45f52f3860">rb_bug</a>(<span class="stringliteral">&quot;unsupported: putundef&quot;</span>);
<a name="l03290"></a>03290         }
<a name="l03291"></a>03291         <span class="keywordflow">else</span> {
<a name="l03292"></a>03292             <a class="code" href="../../d2/d47/compile_8c.html#aa5b45ae61de3350f0830a32589bbb7ee">ADD_INSN</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), putnil);
<a name="l03293"></a>03293         }
<a name="l03294"></a>03294 
<a name="l03295"></a>03295         <a class="code" href="../../d2/d47/compile_8c.html#a5a380bb449656575d6b77ccb8eb7e5ae">ADD_LABEL</a>(ret, break_label);    <span class="comment">/* break */</span>
<a name="l03296"></a>03296 
<a name="l03297"></a>03297         <span class="keywordflow">if</span> (poped) {
<a name="l03298"></a>03298             <a class="code" href="../../d2/d47/compile_8c.html#aa5b45ae61de3350f0830a32589bbb7ee">ADD_INSN</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), pop);
<a name="l03299"></a>03299         }
<a name="l03300"></a>03300 
<a name="l03301"></a>03301         <a class="code" href="../../d2/d47/compile_8c.html#a668f1779f1e5158e6ad8d4b6d92638db">ADD_CATCH_ENTRY</a>(CATCH_TYPE_BREAK, redo_label, break_label,
<a name="l03302"></a>03302                         0, break_label);
<a name="l03303"></a>03303         <a class="code" href="../../d2/d47/compile_8c.html#a668f1779f1e5158e6ad8d4b6d92638db">ADD_CATCH_ENTRY</a>(CATCH_TYPE_NEXT, redo_label, break_label, 0,
<a name="l03304"></a>03304                         next_catch_label);
<a name="l03305"></a>03305         <a class="code" href="../../d2/d47/compile_8c.html#a668f1779f1e5158e6ad8d4b6d92638db">ADD_CATCH_ENTRY</a>(CATCH_TYPE_REDO, redo_label, break_label, 0,
<a name="l03306"></a>03306                         iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a947d34698fb5a71f4938532fff27a0f7">compile_data</a>-&gt;<a class="code" href="../../d4/dd8/structiseq__compile__data.html#a31238638ba93181cc34093e9199b4dc8">redo_label</a>);
<a name="l03307"></a>03307 
<a name="l03308"></a>03308         iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a947d34698fb5a71f4938532fff27a0f7">compile_data</a>-&gt;<a class="code" href="../../d4/dd8/structiseq__compile__data.html#a055ae44f47869f10dda6b21a2433fa1e">start_label</a> = prev_start_label;
<a name="l03309"></a>03309         iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a947d34698fb5a71f4938532fff27a0f7">compile_data</a>-&gt;<a class="code" href="../../d4/dd8/structiseq__compile__data.html#ab37fd8ba916a4fd8c59e9eec084107ad">end_label</a> = prev_end_label;
<a name="l03310"></a>03310         iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a947d34698fb5a71f4938532fff27a0f7">compile_data</a>-&gt;<a class="code" href="../../d4/dd8/structiseq__compile__data.html#a31238638ba93181cc34093e9199b4dc8">redo_label</a> = prev_redo_label;
<a name="l03311"></a>03311         iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a947d34698fb5a71f4938532fff27a0f7">compile_data</a>-&gt;<a class="code" href="../../d4/dd8/structiseq__compile__data.html#a811f3927c9cb6310081b983832355811">loopval_popped</a> = prev_loopval_popped;
<a name="l03312"></a>03312         iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a947d34698fb5a71f4938532fff27a0f7">compile_data</a>-&gt;<a class="code" href="../../d4/dd8/structiseq__compile__data.html#a3f5b0db80047c5fef40ea0783646ddb0">ensure_node_stack</a> = iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a947d34698fb5a71f4938532fff27a0f7">compile_data</a>-&gt;<a class="code" href="../../d4/dd8/structiseq__compile__data.html#a3f5b0db80047c5fef40ea0783646ddb0">ensure_node_stack</a>-&gt;<a class="code" href="../../d6/dca/structiseq__compile__data__ensure__node__stack.html#a4da021e50680d45890063a5f7f8160ae">prev</a>;
<a name="l03313"></a>03313         <span class="keywordflow">break</span>;
<a name="l03314"></a>03314       }
<a name="l03315"></a>03315       <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#a729d82aaada1fbeac7bf4592aa467b76">NODE_ITER</a>:
<a name="l03316"></a>03316       <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#a89c760fc0f7a2209bcac44c5c7907950">NODE_FOR</a>:{
<a name="l03317"></a>03317         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> prevblock = iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a947d34698fb5a71f4938532fff27a0f7">compile_data</a>-&gt;<a class="code" href="../../d4/dd8/structiseq__compile__data.html#a17663fef55ddb6f51b011bb750ec396e">current_block</a>;
<a name="l03318"></a>03318         <a class="code" href="../../d8/dc5/structiseq__label__data.html">LABEL</a> *retry_label = <a class="code" href="../../d2/d47/compile_8c.html#a1d6d5d8dac7aff9ac863255a0905c0f9">NEW_LABEL</a>(<a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node));
<a name="l03319"></a>03319         <a class="code" href="../../d8/dc5/structiseq__label__data.html">LABEL</a> *retry_end_l = <a class="code" href="../../d2/d47/compile_8c.html#a1d6d5d8dac7aff9ac863255a0905c0f9">NEW_LABEL</a>(<a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node));
<a name="l03320"></a>03320         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#afa5b9137f051ac26d7ccc8824f178233">ID</a> mid = 0;
<a name="l03321"></a>03321 
<a name="l03322"></a>03322         <a class="code" href="../../d2/d47/compile_8c.html#a5a380bb449656575d6b77ccb8eb7e5ae">ADD_LABEL</a>(ret, retry_label);
<a name="l03323"></a>03323         <span class="keywordflow">if</span> (<a class="code" href="../../d3/d09/ripper_8y.html#ade12c589b26f55f089dc25d689249c11">nd_type</a>(node) == <a class="code" href="../../d3/d09/ripper_8y.html#a89c760fc0f7a2209bcac44c5c7907950">NODE_FOR</a>) {
<a name="l03324"></a>03324             <a class="code" href="../../d2/d47/compile_8c.html#a0cacd6cfca69df35e1535d2f21532c47">COMPILE</a>(ret, <span class="stringliteral">&quot;iter caller (for)&quot;</span>, node-&gt;nd_iter);
<a name="l03325"></a>03325 
<a name="l03326"></a>03326             iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a947d34698fb5a71f4938532fff27a0f7">compile_data</a>-&gt;<a class="code" href="../../d4/dd8/structiseq__compile__data.html#a17663fef55ddb6f51b011bb750ec396e">current_block</a> =
<a name="l03327"></a>03327                 <a class="code" href="../../d2/d47/compile_8c.html#a8b46ed4917f951327df16ff64ed8f67c">NEW_CHILD_ISEQVAL</a>(node-&gt;nd_body, <a class="code" href="../../d2/d47/compile_8c.html#a046ec40ada559492235ee811126bafda">make_name_for_block</a>(iseq),
<a name="l03328"></a>03328                                   ISEQ_TYPE_BLOCK, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node));
<a name="l03329"></a>03329 
<a name="l03330"></a>03330             mid = idEach;
<a name="l03331"></a>03331             <a class="code" href="../../d2/d47/compile_8c.html#a8e30721d838a4a66104bbecb561ef0c9">ADD_SEND_R</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), <a class="code" href="../../dc/d0c/cparse_8c.html#a48bfb6519a45249fb2ec0193ea3b6e1c">ID2SYM</a>(idEach), <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(0),
<a name="l03332"></a>03332                        iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a947d34698fb5a71f4938532fff27a0f7">compile_data</a>-&gt;<a class="code" href="../../d4/dd8/structiseq__compile__data.html#a17663fef55ddb6f51b011bb750ec396e">current_block</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(0));
<a name="l03333"></a>03333         }
<a name="l03334"></a>03334         <span class="keywordflow">else</span> {
<a name="l03335"></a>03335             iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a947d34698fb5a71f4938532fff27a0f7">compile_data</a>-&gt;<a class="code" href="../../d4/dd8/structiseq__compile__data.html#a17663fef55ddb6f51b011bb750ec396e">current_block</a> =
<a name="l03336"></a>03336                 <a class="code" href="../../d2/d47/compile_8c.html#a8b46ed4917f951327df16ff64ed8f67c">NEW_CHILD_ISEQVAL</a>(node-&gt;nd_body, <a class="code" href="../../d2/d47/compile_8c.html#a046ec40ada559492235ee811126bafda">make_name_for_block</a>(iseq),
<a name="l03337"></a>03337                                   ISEQ_TYPE_BLOCK, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node));
<a name="l03338"></a>03338             <a class="code" href="../../d2/d47/compile_8c.html#a0cacd6cfca69df35e1535d2f21532c47">COMPILE</a>(ret, <span class="stringliteral">&quot;iter caller&quot;</span>, node-&gt;nd_iter);
<a name="l03339"></a>03339         }
<a name="l03340"></a>03340         <a class="code" href="../../d2/d47/compile_8c.html#a5a380bb449656575d6b77ccb8eb7e5ae">ADD_LABEL</a>(ret, retry_end_l);
<a name="l03341"></a>03341 
<a name="l03342"></a>03342         <span class="keywordflow">if</span> (poped) {
<a name="l03343"></a>03343             <a class="code" href="../../d2/d47/compile_8c.html#aa5b45ae61de3350f0830a32589bbb7ee">ADD_INSN</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), pop);
<a name="l03344"></a>03344         }
<a name="l03345"></a>03345 
<a name="l03346"></a>03346         iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a947d34698fb5a71f4938532fff27a0f7">compile_data</a>-&gt;<a class="code" href="../../d4/dd8/structiseq__compile__data.html#a17663fef55ddb6f51b011bb750ec396e">current_block</a> = prevblock;
<a name="l03347"></a>03347 
<a name="l03348"></a>03348         <a class="code" href="../../d2/d47/compile_8c.html#a668f1779f1e5158e6ad8d4b6d92638db">ADD_CATCH_ENTRY</a>(CATCH_TYPE_BREAK, retry_label, retry_end_l, 0, retry_end_l);
<a name="l03349"></a>03349 
<a name="l03350"></a>03350         <span class="keywordflow">break</span>;
<a name="l03351"></a>03351       }
<a name="l03352"></a>03352       <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#ac20bfa82bfa40e0dbcb4c41c2d5ee603">NODE_BREAK</a>:{
<a name="l03353"></a>03353         <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> level = 0;
<a name="l03354"></a>03354 
<a name="l03355"></a>03355         <span class="keywordflow">if</span> (iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a947d34698fb5a71f4938532fff27a0f7">compile_data</a>-&gt;<a class="code" href="../../d4/dd8/structiseq__compile__data.html#a31238638ba93181cc34093e9199b4dc8">redo_label</a> != 0) {
<a name="l03356"></a>03356             <span class="comment">/* while/until */</span>
<a name="l03357"></a>03357             <a class="code" href="../../d8/dc5/structiseq__label__data.html">LABEL</a> *splabel = <a class="code" href="../../d2/d47/compile_8c.html#a1d6d5d8dac7aff9ac863255a0905c0f9">NEW_LABEL</a>(0);
<a name="l03358"></a>03358             <a class="code" href="../../d2/d47/compile_8c.html#a5a380bb449656575d6b77ccb8eb7e5ae">ADD_LABEL</a>(ret, splabel);
<a name="l03359"></a>03359             <a class="code" href="../../d2/d47/compile_8c.html#a8b64a8adfda023035ad3a2cf77040fb6">ADD_ADJUST</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a947d34698fb5a71f4938532fff27a0f7">compile_data</a>-&gt;<a class="code" href="../../d4/dd8/structiseq__compile__data.html#a31238638ba93181cc34093e9199b4dc8">redo_label</a>);
<a name="l03360"></a>03360             <a class="code" href="../../d2/d47/compile_8c.html#a04d4dbcbb97179b5908eb025e13c7752">COMPILE_</a>(ret, <span class="stringliteral">&quot;break val (while/until)&quot;</span>, node-&gt;nd_stts, iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a947d34698fb5a71f4938532fff27a0f7">compile_data</a>-&gt;<a class="code" href="../../d4/dd8/structiseq__compile__data.html#a811f3927c9cb6310081b983832355811">loopval_popped</a>);
<a name="l03361"></a>03361             <a class="code" href="../../d2/d47/compile_8c.html#ae12d5b1df0097ff6f114e576543985c7">add_ensure_iseq</a>(ret, iseq, 0);
<a name="l03362"></a>03362             <a class="code" href="../../d2/d47/compile_8c.html#ace57e2f70722586d3764284364cfb5ad">ADD_INSNL</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), jump, iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a947d34698fb5a71f4938532fff27a0f7">compile_data</a>-&gt;<a class="code" href="../../d4/dd8/structiseq__compile__data.html#ab37fd8ba916a4fd8c59e9eec084107ad">end_label</a>);
<a name="l03363"></a>03363             <a class="code" href="../../d2/d47/compile_8c.html#ad4c05d22ae467c4287c7aa617c4a66d6">ADD_ADJUST_RESTORE</a>(ret, splabel);
<a name="l03364"></a>03364 
<a name="l03365"></a>03365             <span class="keywordflow">if</span> (!poped) {
<a name="l03366"></a>03366                 <a class="code" href="../../d2/d47/compile_8c.html#aa5b45ae61de3350f0830a32589bbb7ee">ADD_INSN</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), putnil);
<a name="l03367"></a>03367             }
<a name="l03368"></a>03368         }
<a name="l03369"></a>03369         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#af8bc7dbae6f61d836b5bb9fb50b6cfb8">type</a> == ISEQ_TYPE_BLOCK) {
<a name="l03370"></a>03370           break_by_insn:
<a name="l03371"></a>03371             <span class="comment">/* escape from block */</span>
<a name="l03372"></a>03372             <a class="code" href="../../d2/d47/compile_8c.html#a0cacd6cfca69df35e1535d2f21532c47">COMPILE</a>(ret, <span class="stringliteral">&quot;break val (block)&quot;</span>, node-&gt;nd_stts);
<a name="l03373"></a>03373             <a class="code" href="../../d2/d47/compile_8c.html#a3cfeb7549a1249a8b78f9d6ff1e74c5a">ADD_INSN1</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), <span class="keywordflow">throw</span>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(level | 0x02) <span class="comment">/* TAG_BREAK */</span> );
<a name="l03374"></a>03374             <span class="keywordflow">if</span> (poped) {
<a name="l03375"></a>03375                 <a class="code" href="../../d2/d47/compile_8c.html#aa5b45ae61de3350f0830a32589bbb7ee">ADD_INSN</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), pop);
<a name="l03376"></a>03376             }
<a name="l03377"></a>03377         }
<a name="l03378"></a>03378         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#af8bc7dbae6f61d836b5bb9fb50b6cfb8">type</a> == ISEQ_TYPE_EVAL) {
<a name="l03379"></a>03379           break_in_eval:
<a name="l03380"></a>03380             <a class="code" href="../../d2/d47/compile_8c.html#ae84f2851369429ff178e5d2c6eaae309">COMPILE_ERROR</a>((<a class="code" href="../../d2/d47/compile_8c.html#af94c9e3c1e8a00be6cb2ab8851055473">ERROR_ARGS</a> <span class="stringliteral">&quot;Can&apos;t escape from eval with break&quot;</span>));
<a name="l03381"></a>03381         }
<a name="l03382"></a>03382         <span class="keywordflow">else</span> {
<a name="l03383"></a>03383             <a class="code" href="../../d6/de3/structrb__iseq__struct.html">rb_iseq_t</a> *ip = iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#afce02da209c0bf9a09ef4ea0af68e623">parent_iseq</a>;
<a name="l03384"></a>03384             <span class="keywordflow">while</span> (ip) {
<a name="l03385"></a>03385                 <span class="keywordflow">if</span> (!ip-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a947d34698fb5a71f4938532fff27a0f7">compile_data</a>) {
<a name="l03386"></a>03386                     ip = 0;
<a name="l03387"></a>03387                     <span class="keywordflow">break</span>;
<a name="l03388"></a>03388                 }
<a name="l03389"></a>03389 
<a name="l03390"></a>03390                 level++;
<a name="l03391"></a>03391                 <span class="keywordflow">if</span> (ip-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a947d34698fb5a71f4938532fff27a0f7">compile_data</a>-&gt;<a class="code" href="../../d4/dd8/structiseq__compile__data.html#a31238638ba93181cc34093e9199b4dc8">redo_label</a> != 0) {
<a name="l03392"></a>03392                     level = 0x8000;
<a name="l03393"></a>03393                     <span class="keywordflow">if</span> (ip-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a947d34698fb5a71f4938532fff27a0f7">compile_data</a>-&gt;<a class="code" href="../../d4/dd8/structiseq__compile__data.html#a811f3927c9cb6310081b983832355811">loopval_popped</a> == 0) {
<a name="l03394"></a>03394                         <span class="comment">/* need value */</span>
<a name="l03395"></a>03395                         level |= 0x4000;
<a name="l03396"></a>03396                     }
<a name="l03397"></a>03397                     <span class="keywordflow">goto</span> break_by_insn;
<a name="l03398"></a>03398                 }
<a name="l03399"></a>03399                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ip-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#af8bc7dbae6f61d836b5bb9fb50b6cfb8">type</a> == ISEQ_TYPE_BLOCK) {
<a name="l03400"></a>03400                     level &lt;&lt;= 16;
<a name="l03401"></a>03401                     <span class="keywordflow">goto</span> break_by_insn;
<a name="l03402"></a>03402                 }
<a name="l03403"></a>03403                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ip-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#af8bc7dbae6f61d836b5bb9fb50b6cfb8">type</a> == ISEQ_TYPE_EVAL) {
<a name="l03404"></a>03404                     <span class="keywordflow">goto</span> break_in_eval;
<a name="l03405"></a>03405                 }
<a name="l03406"></a>03406 
<a name="l03407"></a>03407                 ip = ip-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#afce02da209c0bf9a09ef4ea0af68e623">parent_iseq</a>;
<a name="l03408"></a>03408             }
<a name="l03409"></a>03409             <a class="code" href="../../d2/d47/compile_8c.html#ae84f2851369429ff178e5d2c6eaae309">COMPILE_ERROR</a>((<a class="code" href="../../d2/d47/compile_8c.html#af94c9e3c1e8a00be6cb2ab8851055473">ERROR_ARGS</a> <span class="stringliteral">&quot;Invalid break&quot;</span>));
<a name="l03410"></a>03410         }
<a name="l03411"></a>03411         <span class="keywordflow">break</span>;
<a name="l03412"></a>03412       }
<a name="l03413"></a>03413       <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#a419512cc7a70c27779dfb2fb3ca71a5a">NODE_NEXT</a>:{
<a name="l03414"></a>03414         <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> level = 0;
<a name="l03415"></a>03415 
<a name="l03416"></a>03416         <span class="keywordflow">if</span> (iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a947d34698fb5a71f4938532fff27a0f7">compile_data</a>-&gt;<a class="code" href="../../d4/dd8/structiseq__compile__data.html#a31238638ba93181cc34093e9199b4dc8">redo_label</a> != 0) {
<a name="l03417"></a>03417             <a class="code" href="../../d8/dc5/structiseq__label__data.html">LABEL</a> *splabel = <a class="code" href="../../d2/d47/compile_8c.html#a1d6d5d8dac7aff9ac863255a0905c0f9">NEW_LABEL</a>(0);
<a name="l03418"></a>03418             <a class="code" href="../../d2/d47/compile_8c.html#a72ae3dfc8896ca7c87ed2aed1810db43">debugs</a>(<span class="stringliteral">&quot;next in while loop\n&quot;</span>);
<a name="l03419"></a>03419             <a class="code" href="../../d2/d47/compile_8c.html#a5a380bb449656575d6b77ccb8eb7e5ae">ADD_LABEL</a>(ret, splabel);
<a name="l03420"></a>03420             <a class="code" href="../../d2/d47/compile_8c.html#a0cacd6cfca69df35e1535d2f21532c47">COMPILE</a>(ret, <span class="stringliteral">&quot;next val/valid syntax?&quot;</span>, node-&gt;nd_stts);
<a name="l03421"></a>03421             <a class="code" href="../../d2/d47/compile_8c.html#ae12d5b1df0097ff6f114e576543985c7">add_ensure_iseq</a>(ret, iseq, 0);
<a name="l03422"></a>03422             <a class="code" href="../../d2/d47/compile_8c.html#a8b64a8adfda023035ad3a2cf77040fb6">ADD_ADJUST</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a947d34698fb5a71f4938532fff27a0f7">compile_data</a>-&gt;<a class="code" href="../../d4/dd8/structiseq__compile__data.html#a31238638ba93181cc34093e9199b4dc8">redo_label</a>);
<a name="l03423"></a>03423             <a class="code" href="../../d2/d47/compile_8c.html#ace57e2f70722586d3764284364cfb5ad">ADD_INSNL</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), jump, iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a947d34698fb5a71f4938532fff27a0f7">compile_data</a>-&gt;<a class="code" href="../../d4/dd8/structiseq__compile__data.html#a055ae44f47869f10dda6b21a2433fa1e">start_label</a>);
<a name="l03424"></a>03424             <a class="code" href="../../d2/d47/compile_8c.html#ad4c05d22ae467c4287c7aa617c4a66d6">ADD_ADJUST_RESTORE</a>(ret, splabel);
<a name="l03425"></a>03425             <span class="keywordflow">if</span> (!poped) {
<a name="l03426"></a>03426                 <a class="code" href="../../d2/d47/compile_8c.html#aa5b45ae61de3350f0830a32589bbb7ee">ADD_INSN</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), putnil);
<a name="l03427"></a>03427             }
<a name="l03428"></a>03428         }
<a name="l03429"></a>03429         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a947d34698fb5a71f4938532fff27a0f7">compile_data</a>-&gt;<a class="code" href="../../d4/dd8/structiseq__compile__data.html#ab37fd8ba916a4fd8c59e9eec084107ad">end_label</a>) {
<a name="l03430"></a>03430             <a class="code" href="../../d8/dc5/structiseq__label__data.html">LABEL</a> *splabel = <a class="code" href="../../d2/d47/compile_8c.html#a1d6d5d8dac7aff9ac863255a0905c0f9">NEW_LABEL</a>(0);
<a name="l03431"></a>03431             <a class="code" href="../../d2/d47/compile_8c.html#a72ae3dfc8896ca7c87ed2aed1810db43">debugs</a>(<span class="stringliteral">&quot;next in block\n&quot;</span>);
<a name="l03432"></a>03432             <a class="code" href="../../d2/d47/compile_8c.html#a5a380bb449656575d6b77ccb8eb7e5ae">ADD_LABEL</a>(ret, splabel);
<a name="l03433"></a>03433             <a class="code" href="../../d2/d47/compile_8c.html#a8b64a8adfda023035ad3a2cf77040fb6">ADD_ADJUST</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a947d34698fb5a71f4938532fff27a0f7">compile_data</a>-&gt;<a class="code" href="../../d4/dd8/structiseq__compile__data.html#a055ae44f47869f10dda6b21a2433fa1e">start_label</a>);
<a name="l03434"></a>03434             <a class="code" href="../../d2/d47/compile_8c.html#a0cacd6cfca69df35e1535d2f21532c47">COMPILE</a>(ret, <span class="stringliteral">&quot;next val&quot;</span>, node-&gt;nd_stts);
<a name="l03435"></a>03435             <a class="code" href="../../d2/d47/compile_8c.html#ae12d5b1df0097ff6f114e576543985c7">add_ensure_iseq</a>(ret, iseq, 0);
<a name="l03436"></a>03436             <a class="code" href="../../d2/d47/compile_8c.html#ace57e2f70722586d3764284364cfb5ad">ADD_INSNL</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), jump, iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a947d34698fb5a71f4938532fff27a0f7">compile_data</a>-&gt;<a class="code" href="../../d4/dd8/structiseq__compile__data.html#ab37fd8ba916a4fd8c59e9eec084107ad">end_label</a>);
<a name="l03437"></a>03437             <a class="code" href="../../d2/d47/compile_8c.html#ad4c05d22ae467c4287c7aa617c4a66d6">ADD_ADJUST_RESTORE</a>(ret, splabel);
<a name="l03438"></a>03438 
<a name="l03439"></a>03439             <span class="keywordflow">if</span> (!poped) {
<a name="l03440"></a>03440                 <a class="code" href="../../d2/d47/compile_8c.html#aa5b45ae61de3350f0830a32589bbb7ee">ADD_INSN</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), putnil);
<a name="l03441"></a>03441             }
<a name="l03442"></a>03442         }
<a name="l03443"></a>03443         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#af8bc7dbae6f61d836b5bb9fb50b6cfb8">type</a> == ISEQ_TYPE_EVAL) {
<a name="l03444"></a>03444           next_in_eval:
<a name="l03445"></a>03445             <a class="code" href="../../d2/d47/compile_8c.html#ae84f2851369429ff178e5d2c6eaae309">COMPILE_ERROR</a>((<a class="code" href="../../d2/d47/compile_8c.html#af94c9e3c1e8a00be6cb2ab8851055473">ERROR_ARGS</a> <span class="stringliteral">&quot;Can&apos;t escape from eval with next&quot;</span>));
<a name="l03446"></a>03446         }
<a name="l03447"></a>03447         <span class="keywordflow">else</span> {
<a name="l03448"></a>03448             <a class="code" href="../../d6/de3/structrb__iseq__struct.html">rb_iseq_t</a> *ip;
<a name="l03449"></a>03449             ip = iseq;
<a name="l03450"></a>03450             <span class="keywordflow">while</span> (ip) {
<a name="l03451"></a>03451                 <span class="keywordflow">if</span> (!ip-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a947d34698fb5a71f4938532fff27a0f7">compile_data</a>) {
<a name="l03452"></a>03452                     ip = 0;
<a name="l03453"></a>03453                     <span class="keywordflow">break</span>;
<a name="l03454"></a>03454                 }
<a name="l03455"></a>03455 
<a name="l03456"></a>03456                 level = 0x8000 | 0x4000;
<a name="l03457"></a>03457                 <span class="keywordflow">if</span> (ip-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a947d34698fb5a71f4938532fff27a0f7">compile_data</a>-&gt;<a class="code" href="../../d4/dd8/structiseq__compile__data.html#a31238638ba93181cc34093e9199b4dc8">redo_label</a> != 0) {
<a name="l03458"></a>03458                     <span class="comment">/* while loop */</span>
<a name="l03459"></a>03459                     <span class="keywordflow">break</span>;
<a name="l03460"></a>03460                 }
<a name="l03461"></a>03461                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ip-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#af8bc7dbae6f61d836b5bb9fb50b6cfb8">type</a> == ISEQ_TYPE_BLOCK) {
<a name="l03462"></a>03462                     <span class="keywordflow">break</span>;
<a name="l03463"></a>03463                 }
<a name="l03464"></a>03464                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ip-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#af8bc7dbae6f61d836b5bb9fb50b6cfb8">type</a> == ISEQ_TYPE_EVAL) {
<a name="l03465"></a>03465                     <span class="keywordflow">goto</span> next_in_eval;
<a name="l03466"></a>03466                 }
<a name="l03467"></a>03467 
<a name="l03468"></a>03468                 ip = ip-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#afce02da209c0bf9a09ef4ea0af68e623">parent_iseq</a>;
<a name="l03469"></a>03469             }
<a name="l03470"></a>03470             <span class="keywordflow">if</span> (ip != 0) {
<a name="l03471"></a>03471                 <a class="code" href="../../d2/d47/compile_8c.html#a0cacd6cfca69df35e1535d2f21532c47">COMPILE</a>(ret, <span class="stringliteral">&quot;next val&quot;</span>, node-&gt;nd_stts);
<a name="l03472"></a>03472                 <a class="code" href="../../d2/d47/compile_8c.html#a3cfeb7549a1249a8b78f9d6ff1e74c5a">ADD_INSN1</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), <span class="keywordflow">throw</span>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(level | 0x03) <span class="comment">/* TAG_NEXT */</span> );
<a name="l03473"></a>03473 
<a name="l03474"></a>03474                 <span class="keywordflow">if</span> (poped) {
<a name="l03475"></a>03475                     <a class="code" href="../../d2/d47/compile_8c.html#aa5b45ae61de3350f0830a32589bbb7ee">ADD_INSN</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), pop);
<a name="l03476"></a>03476                 }
<a name="l03477"></a>03477             }
<a name="l03478"></a>03478             <span class="keywordflow">else</span> {
<a name="l03479"></a>03479                 <a class="code" href="../../d2/d47/compile_8c.html#ae84f2851369429ff178e5d2c6eaae309">COMPILE_ERROR</a>((<a class="code" href="../../d2/d47/compile_8c.html#af94c9e3c1e8a00be6cb2ab8851055473">ERROR_ARGS</a> <span class="stringliteral">&quot;Invalid next&quot;</span>));
<a name="l03480"></a>03480             }
<a name="l03481"></a>03481         }
<a name="l03482"></a>03482         <span class="keywordflow">break</span>;
<a name="l03483"></a>03483       }
<a name="l03484"></a>03484       <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#a18d2e6f19f54d07ba73aa95f4eab97d3">NODE_REDO</a>:{
<a name="l03485"></a>03485         <span class="keywordflow">if</span> (iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a947d34698fb5a71f4938532fff27a0f7">compile_data</a>-&gt;<a class="code" href="../../d4/dd8/structiseq__compile__data.html#a31238638ba93181cc34093e9199b4dc8">redo_label</a>) {
<a name="l03486"></a>03486             <a class="code" href="../../d8/dc5/structiseq__label__data.html">LABEL</a> *splabel = <a class="code" href="../../d2/d47/compile_8c.html#a1d6d5d8dac7aff9ac863255a0905c0f9">NEW_LABEL</a>(0);
<a name="l03487"></a>03487             <a class="code" href="../../d2/d47/compile_8c.html#a72ae3dfc8896ca7c87ed2aed1810db43">debugs</a>(<span class="stringliteral">&quot;redo in while&quot;</span>);
<a name="l03488"></a>03488             <a class="code" href="../../d2/d47/compile_8c.html#a5a380bb449656575d6b77ccb8eb7e5ae">ADD_LABEL</a>(ret, splabel);
<a name="l03489"></a>03489             <a class="code" href="../../d2/d47/compile_8c.html#a8b64a8adfda023035ad3a2cf77040fb6">ADD_ADJUST</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a947d34698fb5a71f4938532fff27a0f7">compile_data</a>-&gt;<a class="code" href="../../d4/dd8/structiseq__compile__data.html#a31238638ba93181cc34093e9199b4dc8">redo_label</a>);
<a name="l03490"></a>03490             <a class="code" href="../../d2/d47/compile_8c.html#ae12d5b1df0097ff6f114e576543985c7">add_ensure_iseq</a>(ret, iseq, 0);
<a name="l03491"></a>03491             <a class="code" href="../../d2/d47/compile_8c.html#ace57e2f70722586d3764284364cfb5ad">ADD_INSNL</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), jump, iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a947d34698fb5a71f4938532fff27a0f7">compile_data</a>-&gt;<a class="code" href="../../d4/dd8/structiseq__compile__data.html#a31238638ba93181cc34093e9199b4dc8">redo_label</a>);
<a name="l03492"></a>03492             <a class="code" href="../../d2/d47/compile_8c.html#ad4c05d22ae467c4287c7aa617c4a66d6">ADD_ADJUST_RESTORE</a>(ret, splabel);
<a name="l03493"></a>03493             <span class="keywordflow">if</span> (!poped) {
<a name="l03494"></a>03494                 <a class="code" href="../../d2/d47/compile_8c.html#aa5b45ae61de3350f0830a32589bbb7ee">ADD_INSN</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), putnil);
<a name="l03495"></a>03495             }
<a name="l03496"></a>03496         }
<a name="l03497"></a>03497         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#af8bc7dbae6f61d836b5bb9fb50b6cfb8">type</a> == ISEQ_TYPE_EVAL) {
<a name="l03498"></a>03498           redo_in_eval:
<a name="l03499"></a>03499             <a class="code" href="../../d2/d47/compile_8c.html#ae84f2851369429ff178e5d2c6eaae309">COMPILE_ERROR</a>((<a class="code" href="../../d2/d47/compile_8c.html#af94c9e3c1e8a00be6cb2ab8851055473">ERROR_ARGS</a> <span class="stringliteral">&quot;Can&apos;t escape from eval with redo&quot;</span>));
<a name="l03500"></a>03500         }
<a name="l03501"></a>03501         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a947d34698fb5a71f4938532fff27a0f7">compile_data</a>-&gt;<a class="code" href="../../d4/dd8/structiseq__compile__data.html#a055ae44f47869f10dda6b21a2433fa1e">start_label</a>) {
<a name="l03502"></a>03502             <a class="code" href="../../d8/dc5/structiseq__label__data.html">LABEL</a> *splabel = <a class="code" href="../../d2/d47/compile_8c.html#a1d6d5d8dac7aff9ac863255a0905c0f9">NEW_LABEL</a>(0);
<a name="l03503"></a>03503 
<a name="l03504"></a>03504             <a class="code" href="../../d2/d47/compile_8c.html#a72ae3dfc8896ca7c87ed2aed1810db43">debugs</a>(<span class="stringliteral">&quot;redo in block&quot;</span>);
<a name="l03505"></a>03505             <a class="code" href="../../d2/d47/compile_8c.html#a5a380bb449656575d6b77ccb8eb7e5ae">ADD_LABEL</a>(ret, splabel);
<a name="l03506"></a>03506             <a class="code" href="../../d2/d47/compile_8c.html#ae12d5b1df0097ff6f114e576543985c7">add_ensure_iseq</a>(ret, iseq, 0);
<a name="l03507"></a>03507             <a class="code" href="../../d2/d47/compile_8c.html#a8b64a8adfda023035ad3a2cf77040fb6">ADD_ADJUST</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a947d34698fb5a71f4938532fff27a0f7">compile_data</a>-&gt;<a class="code" href="../../d4/dd8/structiseq__compile__data.html#a055ae44f47869f10dda6b21a2433fa1e">start_label</a>);
<a name="l03508"></a>03508             <a class="code" href="../../d2/d47/compile_8c.html#ace57e2f70722586d3764284364cfb5ad">ADD_INSNL</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), jump, iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a947d34698fb5a71f4938532fff27a0f7">compile_data</a>-&gt;<a class="code" href="../../d4/dd8/structiseq__compile__data.html#a055ae44f47869f10dda6b21a2433fa1e">start_label</a>);
<a name="l03509"></a>03509             <a class="code" href="../../d2/d47/compile_8c.html#ad4c05d22ae467c4287c7aa617c4a66d6">ADD_ADJUST_RESTORE</a>(ret, splabel);
<a name="l03510"></a>03510 
<a name="l03511"></a>03511             <span class="keywordflow">if</span> (!poped) {
<a name="l03512"></a>03512                 <a class="code" href="../../d2/d47/compile_8c.html#aa5b45ae61de3350f0830a32589bbb7ee">ADD_INSN</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), putnil);
<a name="l03513"></a>03513             }
<a name="l03514"></a>03514         }
<a name="l03515"></a>03515         <span class="keywordflow">else</span> {
<a name="l03516"></a>03516             <a class="code" href="../../d6/de3/structrb__iseq__struct.html">rb_iseq_t</a> *ip;
<a name="l03517"></a>03517             <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> level;
<a name="l03518"></a>03518             level = 0x8000 | 0x4000;
<a name="l03519"></a>03519             ip = iseq;
<a name="l03520"></a>03520             <span class="keywordflow">while</span> (ip) {
<a name="l03521"></a>03521                 <span class="keywordflow">if</span> (!ip-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a947d34698fb5a71f4938532fff27a0f7">compile_data</a>) {
<a name="l03522"></a>03522                     ip = 0;
<a name="l03523"></a>03523                     <span class="keywordflow">break</span>;
<a name="l03524"></a>03524                 }
<a name="l03525"></a>03525 
<a name="l03526"></a>03526                 <span class="keywordflow">if</span> (ip-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a947d34698fb5a71f4938532fff27a0f7">compile_data</a>-&gt;<a class="code" href="../../d4/dd8/structiseq__compile__data.html#a31238638ba93181cc34093e9199b4dc8">redo_label</a> != 0) {
<a name="l03527"></a>03527                     <span class="keywordflow">break</span>;
<a name="l03528"></a>03528                 }
<a name="l03529"></a>03529                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ip-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#af8bc7dbae6f61d836b5bb9fb50b6cfb8">type</a> == ISEQ_TYPE_BLOCK) {
<a name="l03530"></a>03530                     <span class="keywordflow">break</span>;
<a name="l03531"></a>03531                 }
<a name="l03532"></a>03532                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ip-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#af8bc7dbae6f61d836b5bb9fb50b6cfb8">type</a> == ISEQ_TYPE_EVAL) {
<a name="l03533"></a>03533                     <span class="keywordflow">goto</span> redo_in_eval;
<a name="l03534"></a>03534                 }
<a name="l03535"></a>03535 
<a name="l03536"></a>03536                 ip = ip-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#afce02da209c0bf9a09ef4ea0af68e623">parent_iseq</a>;
<a name="l03537"></a>03537             }
<a name="l03538"></a>03538             <span class="keywordflow">if</span> (ip != 0) {
<a name="l03539"></a>03539                 <a class="code" href="../../d2/d47/compile_8c.html#aa5b45ae61de3350f0830a32589bbb7ee">ADD_INSN</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), putnil);
<a name="l03540"></a>03540                 <a class="code" href="../../d2/d47/compile_8c.html#a3cfeb7549a1249a8b78f9d6ff1e74c5a">ADD_INSN1</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), <span class="keywordflow">throw</span>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(level | 0x05) <span class="comment">/* TAG_REDO */</span> );
<a name="l03541"></a>03541 
<a name="l03542"></a>03542                 <span class="keywordflow">if</span> (poped) {
<a name="l03543"></a>03543                     <a class="code" href="../../d2/d47/compile_8c.html#aa5b45ae61de3350f0830a32589bbb7ee">ADD_INSN</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), pop);
<a name="l03544"></a>03544                 }
<a name="l03545"></a>03545             }
<a name="l03546"></a>03546             <span class="keywordflow">else</span> {
<a name="l03547"></a>03547                 <a class="code" href="../../d2/d47/compile_8c.html#ae84f2851369429ff178e5d2c6eaae309">COMPILE_ERROR</a>((<a class="code" href="../../d2/d47/compile_8c.html#af94c9e3c1e8a00be6cb2ab8851055473">ERROR_ARGS</a> <span class="stringliteral">&quot;Invalid redo&quot;</span>));
<a name="l03548"></a>03548             }
<a name="l03549"></a>03549         }
<a name="l03550"></a>03550         <span class="keywordflow">break</span>;
<a name="l03551"></a>03551       }
<a name="l03552"></a>03552       <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#ab34acb27dadef25e21806f3c6e8e0b2e">NODE_RETRY</a>:{
<a name="l03553"></a>03553         <span class="keywordflow">if</span> (iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#af8bc7dbae6f61d836b5bb9fb50b6cfb8">type</a> == ISEQ_TYPE_RESCUE) {
<a name="l03554"></a>03554             <a class="code" href="../../d2/d47/compile_8c.html#aa5b45ae61de3350f0830a32589bbb7ee">ADD_INSN</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), putnil);
<a name="l03555"></a>03555             <a class="code" href="../../d2/d47/compile_8c.html#a3cfeb7549a1249a8b78f9d6ff1e74c5a">ADD_INSN1</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), <span class="keywordflow">throw</span>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(0x04) <span class="comment">/* TAG_RETRY */</span> );
<a name="l03556"></a>03556 
<a name="l03557"></a>03557             <span class="keywordflow">if</span> (poped) {
<a name="l03558"></a>03558                 <a class="code" href="../../d2/d47/compile_8c.html#aa5b45ae61de3350f0830a32589bbb7ee">ADD_INSN</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), pop);
<a name="l03559"></a>03559             }
<a name="l03560"></a>03560         }
<a name="l03561"></a>03561         <span class="keywordflow">else</span> {
<a name="l03562"></a>03562             <a class="code" href="../../d2/d47/compile_8c.html#ae84f2851369429ff178e5d2c6eaae309">COMPILE_ERROR</a>((<a class="code" href="../../d2/d47/compile_8c.html#af94c9e3c1e8a00be6cb2ab8851055473">ERROR_ARGS</a> <span class="stringliteral">&quot;Invalid retry&quot;</span>));
<a name="l03563"></a>03563         }
<a name="l03564"></a>03564         <span class="keywordflow">break</span>;
<a name="l03565"></a>03565       }
<a name="l03566"></a>03566       <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#a5108b748a0833a5e734a91e4f3719510">NODE_BEGIN</a>:{
<a name="l03567"></a>03567         <a class="code" href="../../d2/d47/compile_8c.html#a04d4dbcbb97179b5908eb025e13c7752">COMPILE_</a>(ret, <span class="stringliteral">&quot;NODE_BEGIN&quot;</span>, node-&gt;nd_body, poped);
<a name="l03568"></a>03568         <span class="keywordflow">break</span>;
<a name="l03569"></a>03569       }
<a name="l03570"></a>03570       <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#a2e2ee74ca4f1fe85350a59ae648d6310">NODE_RESCUE</a>:{
<a name="l03571"></a>03571         <a class="code" href="../../d8/dc5/structiseq__label__data.html">LABEL</a> *lstart = <a class="code" href="../../d2/d47/compile_8c.html#a1d6d5d8dac7aff9ac863255a0905c0f9">NEW_LABEL</a>(<a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node));
<a name="l03572"></a>03572         <a class="code" href="../../d8/dc5/structiseq__label__data.html">LABEL</a> *lend = <a class="code" href="../../d2/d47/compile_8c.html#a1d6d5d8dac7aff9ac863255a0905c0f9">NEW_LABEL</a>(<a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node));
<a name="l03573"></a>03573         <a class="code" href="../../d8/dc5/structiseq__label__data.html">LABEL</a> *lcont = <a class="code" href="../../d2/d47/compile_8c.html#a1d6d5d8dac7aff9ac863255a0905c0f9">NEW_LABEL</a>(<a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node));
<a name="l03574"></a>03574         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> rescue = <a class="code" href="../../d2/d47/compile_8c.html#a8b46ed4917f951327df16ff64ed8f67c">NEW_CHILD_ISEQVAL</a>(
<a name="l03575"></a>03575             node-&gt;nd_resq,
<a name="l03576"></a>03576             <a class="code" href="../../db/d2e/intern_8h.html#a2f12f7ad949fa2e6abb64f2311c6e2c5">rb_str_concat</a>(<a class="code" href="../../db/d2e/intern_8h.html#a03acd62c0b1edebbe1d61f957c19b7ac">rb_str_new2</a>(<span class="stringliteral">&quot;rescue in &quot;</span>), iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a35596da255ce28a5d1da94c2cc508c7d">name</a>),
<a name="l03577"></a>03577             ISEQ_TYPE_RESCUE, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node));
<a name="l03578"></a>03578 
<a name="l03579"></a>03579         <a class="code" href="../../d2/d47/compile_8c.html#a5a380bb449656575d6b77ccb8eb7e5ae">ADD_LABEL</a>(ret, lstart);
<a name="l03580"></a>03580         <a class="code" href="../../d2/d47/compile_8c.html#a0cacd6cfca69df35e1535d2f21532c47">COMPILE</a>(ret, <span class="stringliteral">&quot;rescue head&quot;</span>, node-&gt;nd_head);
<a name="l03581"></a>03581         <a class="code" href="../../d2/d47/compile_8c.html#a5a380bb449656575d6b77ccb8eb7e5ae">ADD_LABEL</a>(ret, lend);
<a name="l03582"></a>03582         <span class="keywordflow">if</span> (node-&gt;nd_else) {
<a name="l03583"></a>03583             <a class="code" href="../../d2/d47/compile_8c.html#aa5b45ae61de3350f0830a32589bbb7ee">ADD_INSN</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), pop);
<a name="l03584"></a>03584             <a class="code" href="../../d2/d47/compile_8c.html#a0cacd6cfca69df35e1535d2f21532c47">COMPILE</a>(ret, <span class="stringliteral">&quot;rescue else&quot;</span>, node-&gt;nd_else);
<a name="l03585"></a>03585         }
<a name="l03586"></a>03586         <a class="code" href="../../d2/d47/compile_8c.html#aa5b45ae61de3350f0830a32589bbb7ee">ADD_INSN</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), nop);
<a name="l03587"></a>03587         <a class="code" href="../../d2/d47/compile_8c.html#a5a380bb449656575d6b77ccb8eb7e5ae">ADD_LABEL</a>(ret, lcont);
<a name="l03588"></a>03588 
<a name="l03589"></a>03589         <span class="keywordflow">if</span> (poped) {
<a name="l03590"></a>03590             <a class="code" href="../../d2/d47/compile_8c.html#aa5b45ae61de3350f0830a32589bbb7ee">ADD_INSN</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), pop);
<a name="l03591"></a>03591         }
<a name="l03592"></a>03592 
<a name="l03593"></a>03593         <span class="comment">/* register catch entry */</span>
<a name="l03594"></a>03594         <a class="code" href="../../d2/d47/compile_8c.html#a668f1779f1e5158e6ad8d4b6d92638db">ADD_CATCH_ENTRY</a>(CATCH_TYPE_RESCUE, lstart, lend, rescue, lcont);
<a name="l03595"></a>03595         <a class="code" href="../../d2/d47/compile_8c.html#a668f1779f1e5158e6ad8d4b6d92638db">ADD_CATCH_ENTRY</a>(CATCH_TYPE_RETRY, lend, lcont, 0, lstart);
<a name="l03596"></a>03596         <span class="keywordflow">break</span>;
<a name="l03597"></a>03597       }
<a name="l03598"></a>03598       <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#a1fa11202ec4f8e4011503e785d2a019b">NODE_RESBODY</a>:{
<a name="l03599"></a>03599         NODE *resq = node;
<a name="l03600"></a>03600         NODE *narg;
<a name="l03601"></a>03601         <a class="code" href="../../d8/dc5/structiseq__label__data.html">LABEL</a> *label_miss, *label_hit;
<a name="l03602"></a>03602 
<a name="l03603"></a>03603         <span class="keywordflow">while</span> (resq) {
<a name="l03604"></a>03604             label_miss = <a class="code" href="../../d2/d47/compile_8c.html#a1d6d5d8dac7aff9ac863255a0905c0f9">NEW_LABEL</a>(<a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node));
<a name="l03605"></a>03605             label_hit = <a class="code" href="../../d2/d47/compile_8c.html#a1d6d5d8dac7aff9ac863255a0905c0f9">NEW_LABEL</a>(<a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node));
<a name="l03606"></a>03606 
<a name="l03607"></a>03607             narg = resq-&gt;nd_args;
<a name="l03608"></a>03608             <span class="keywordflow">if</span> (narg) {
<a name="l03609"></a>03609                 <span class="keywordflow">switch</span> (<a class="code" href="../../d3/d09/ripper_8y.html#ade12c589b26f55f089dc25d689249c11">nd_type</a>(narg)) {
<a name="l03610"></a>03610                   <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#a490d1fc6f7f9e81a1815e9b1c3080d94">NODE_ARRAY</a>:
<a name="l03611"></a>03611                     <span class="keywordflow">while</span> (narg) {
<a name="l03612"></a>03612                         <a class="code" href="../../d2/d47/compile_8c.html#a0cacd6cfca69df35e1535d2f21532c47">COMPILE</a>(ret, <span class="stringliteral">&quot;rescue arg&quot;</span>, narg-&gt;nd_head);
<a name="l03613"></a>03613                         <a class="code" href="../../d2/d47/compile_8c.html#a9e17ccfd8b31ec3afcb91be39a6d453f">ADD_INSN2</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), getdynamic, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(2), <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(0));
<a name="l03614"></a>03614                         <a class="code" href="../../d2/d47/compile_8c.html#ab1941f9308f4508ab33b8828fec890fd">ADD_SEND</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), <a class="code" href="../../dc/d0c/cparse_8c.html#a48bfb6519a45249fb2ec0193ea3b6e1c">ID2SYM</a>(<a class="code" href="../../df/db9/id_8h.html#a08dd4fbd61c5fde369edd59783f753b3a6a442640966dae6e53624fd67cdd960a">idEqq</a>), <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(1));
<a name="l03615"></a>03615                         <a class="code" href="../../d2/d47/compile_8c.html#ace57e2f70722586d3764284364cfb5ad">ADD_INSNL</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), branchif, label_hit);
<a name="l03616"></a>03616                         narg = narg-&gt;nd_next;
<a name="l03617"></a>03617                     }
<a name="l03618"></a>03618                     <span class="keywordflow">break</span>;
<a name="l03619"></a>03619                   <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#a985f27752acfb29eca912c28522329c3">NODE_SPLAT</a>:
<a name="l03620"></a>03620                   <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#a796ba7c9f501e5f81b4f6f06972250fd">NODE_ARGSCAT</a>:
<a name="l03621"></a>03621                   <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#a15dc4d72c7b3a577d28e6131a63926d9">NODE_ARGSPUSH</a>:
<a name="l03622"></a>03622                     <a class="code" href="../../d2/d47/compile_8c.html#a9e17ccfd8b31ec3afcb91be39a6d453f">ADD_INSN2</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), getdynamic, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(2), <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(0));
<a name="l03623"></a>03623                     <a class="code" href="../../d2/d47/compile_8c.html#a0cacd6cfca69df35e1535d2f21532c47">COMPILE</a>(ret, <span class="stringliteral">&quot;rescue/cond splat&quot;</span>, narg);
<a name="l03624"></a>03624                     <a class="code" href="../../d2/d47/compile_8c.html#a3cfeb7549a1249a8b78f9d6ff1e74c5a">ADD_INSN1</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), checkincludearray, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aacea3516b33941ce8149098e223a7466">Qtrue</a>);
<a name="l03625"></a>03625                     <a class="code" href="../../d2/d47/compile_8c.html#aa5b45ae61de3350f0830a32589bbb7ee">ADD_INSN</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), swap);
<a name="l03626"></a>03626                     <a class="code" href="../../d2/d47/compile_8c.html#aa5b45ae61de3350f0830a32589bbb7ee">ADD_INSN</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), pop);
<a name="l03627"></a>03627                     <a class="code" href="../../d2/d47/compile_8c.html#ace57e2f70722586d3764284364cfb5ad">ADD_INSNL</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), branchif, label_hit);
<a name="l03628"></a>03628                     <span class="keywordflow">break</span>;
<a name="l03629"></a>03629                   <span class="keywordflow">default</span>:
<a name="l03630"></a>03630                     <a class="code" href="../../db/dcc/error_8c.html#a2d5fb28e54f792e7341b2c45f52f3860">rb_bug</a>(<span class="stringliteral">&quot;NODE_RESBODY: unknown node (%s)&quot;</span>,
<a name="l03631"></a>03631                            <a class="code" href="../../dd/d74/iseq_8c.html#a818834c71f4a58f5bd7f0aa142d1b069">ruby_node_name</a>(<a class="code" href="../../d3/d09/ripper_8y.html#ade12c589b26f55f089dc25d689249c11">nd_type</a>(narg)));
<a name="l03632"></a>03632                 }
<a name="l03633"></a>03633             }
<a name="l03634"></a>03634             <span class="keywordflow">else</span> {
<a name="l03635"></a>03635                 <a class="code" href="../../d2/d47/compile_8c.html#a3cfeb7549a1249a8b78f9d6ff1e74c5a">ADD_INSN1</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), putobject,
<a name="l03636"></a>03636                           <a class="code" href="../../db/dcc/error_8c.html#a3fc1bd0a9e1211aef38f81d600345ed9">rb_eStandardError</a>);
<a name="l03637"></a>03637                 <a class="code" href="../../d2/d47/compile_8c.html#a9e17ccfd8b31ec3afcb91be39a6d453f">ADD_INSN2</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), getdynamic, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(2), <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(0));
<a name="l03638"></a>03638                 <a class="code" href="../../d2/d47/compile_8c.html#ab1941f9308f4508ab33b8828fec890fd">ADD_SEND</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), <a class="code" href="../../dc/d0c/cparse_8c.html#a48bfb6519a45249fb2ec0193ea3b6e1c">ID2SYM</a>(<a class="code" href="../../df/db9/id_8h.html#a08dd4fbd61c5fde369edd59783f753b3a6a442640966dae6e53624fd67cdd960a">idEqq</a>), <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(1));
<a name="l03639"></a>03639                 <a class="code" href="../../d2/d47/compile_8c.html#ace57e2f70722586d3764284364cfb5ad">ADD_INSNL</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), branchif, label_hit);
<a name="l03640"></a>03640             }
<a name="l03641"></a>03641             <a class="code" href="../../d2/d47/compile_8c.html#ace57e2f70722586d3764284364cfb5ad">ADD_INSNL</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), jump, label_miss);
<a name="l03642"></a>03642             <a class="code" href="../../d2/d47/compile_8c.html#a5a380bb449656575d6b77ccb8eb7e5ae">ADD_LABEL</a>(ret, label_hit);
<a name="l03643"></a>03643             <a class="code" href="../../d2/d47/compile_8c.html#a0cacd6cfca69df35e1535d2f21532c47">COMPILE</a>(ret, <span class="stringliteral">&quot;resbody body&quot;</span>, resq-&gt;nd_body);
<a name="l03644"></a>03644             <span class="keywordflow">if</span> (iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a947d34698fb5a71f4938532fff27a0f7">compile_data</a>-&gt;<a class="code" href="../../d4/dd8/structiseq__compile__data.html#a3cde0c1bfeea6f8a80027a9e21a9759a">option</a>-&gt;<a class="code" href="../../db/dc1/structrb__compile__option__struct.html#a3014c6bc77f9bfeb2b684d8ba6801d95">tailcall_optimization</a>) {
<a name="l03645"></a>03645                 <a class="code" href="../../d2/d47/compile_8c.html#aa5b45ae61de3350f0830a32589bbb7ee">ADD_INSN</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), nop);
<a name="l03646"></a>03646             }
<a name="l03647"></a>03647             <a class="code" href="../../d2/d47/compile_8c.html#aa5b45ae61de3350f0830a32589bbb7ee">ADD_INSN</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), leave);
<a name="l03648"></a>03648             <a class="code" href="../../d2/d47/compile_8c.html#a5a380bb449656575d6b77ccb8eb7e5ae">ADD_LABEL</a>(ret, label_miss);
<a name="l03649"></a>03649             resq = resq-&gt;nd_head;
<a name="l03650"></a>03650         }
<a name="l03651"></a>03651         <span class="keywordflow">break</span>;
<a name="l03652"></a>03652       }
<a name="l03653"></a>03653       <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#abd2d897cf3ea6a0b59b4cafb72d99b4c">NODE_ENSURE</a>:{
<a name="l03654"></a>03654         <a class="code" href="../../d2/d47/compile_8c.html#aa9d6014cec8d3adcb228b81620eac795">DECL_ANCHOR</a>(ensr);
<a name="l03655"></a>03655         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> ensure = <a class="code" href="../../d2/d47/compile_8c.html#a8b46ed4917f951327df16ff64ed8f67c">NEW_CHILD_ISEQVAL</a>(node-&gt;nd_ensr,
<a name="l03656"></a>03656                                          <a class="code" href="../../db/d2e/intern_8h.html#a2f12f7ad949fa2e6abb64f2311c6e2c5">rb_str_concat</a>(<a class="code" href="../../db/d2e/intern_8h.html#a03acd62c0b1edebbe1d61f957c19b7ac">rb_str_new2</a>
<a name="l03657"></a>03657                                                        (<span class="stringliteral">&quot;ensure in &quot;</span>),
<a name="l03658"></a>03658                                                        iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a35596da255ce28a5d1da94c2cc508c7d">name</a>),
<a name="l03659"></a>03659                                          ISEQ_TYPE_ENSURE, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node));
<a name="l03660"></a>03660         <a class="code" href="../../d8/dc5/structiseq__label__data.html">LABEL</a> *lstart = <a class="code" href="../../d2/d47/compile_8c.html#a1d6d5d8dac7aff9ac863255a0905c0f9">NEW_LABEL</a>(<a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node));
<a name="l03661"></a>03661         <a class="code" href="../../d8/dc5/structiseq__label__data.html">LABEL</a> *lend = <a class="code" href="../../d2/d47/compile_8c.html#a1d6d5d8dac7aff9ac863255a0905c0f9">NEW_LABEL</a>(<a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node));
<a name="l03662"></a>03662         <a class="code" href="../../d8/dc5/structiseq__label__data.html">LABEL</a> *lcont = <a class="code" href="../../d2/d47/compile_8c.html#a1d6d5d8dac7aff9ac863255a0905c0f9">NEW_LABEL</a>(<a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node));
<a name="l03663"></a>03663         <span class="keyword">struct </span><a class="code" href="../../da/d32/structensure__range.html">ensure_range</a> er;
<a name="l03664"></a>03664         <span class="keyword">struct </span><a class="code" href="../../d6/dca/structiseq__compile__data__ensure__node__stack.html">iseq_compile_data_ensure_node_stack</a> enl;
<a name="l03665"></a>03665         <span class="keyword">struct </span><a class="code" href="../../da/d32/structensure__range.html">ensure_range</a> *erange;
<a name="l03666"></a>03666 
<a name="l03667"></a>03667         <a class="code" href="../../d2/d47/compile_8c.html#ac32b1f7d8de8f10f33a147030d8b7544">INIT_ANCHOR</a>(ensr);
<a name="l03668"></a>03668         <a class="code" href="../../d2/d47/compile_8c.html#a4e7115fce9f91ee84931798cc3474229">COMPILE_POPED</a>(ensr, <span class="stringliteral">&quot;ensure ensr&quot;</span>, node-&gt;nd_ensr);
<a name="l03669"></a>03669 
<a name="l03670"></a>03670         er.<a class="code" href="../../da/d32/structensure__range.html#a8ad1f4748dfe9dcf6667452d0d3e8ed0">begin</a> = lstart;
<a name="l03671"></a>03671         er.<a class="code" href="../../da/d32/structensure__range.html#aa15081d5666a57e4df5a74bbad8cda12">end</a> = lend;
<a name="l03672"></a>03672         er.<a class="code" href="../../da/d32/structensure__range.html#a2db4411cce7aefb5b8c9a9ce4dadd2e7">next</a> = 0;
<a name="l03673"></a>03673         <a class="code" href="../../d2/d47/compile_8c.html#a58ce1f4f951df593103360ac94cb0e6c">push_ensure_entry</a>(iseq, &amp;enl, &amp;er, node-&gt;nd_ensr);
<a name="l03674"></a>03674 
<a name="l03675"></a>03675         <a class="code" href="../../d2/d47/compile_8c.html#a5a380bb449656575d6b77ccb8eb7e5ae">ADD_LABEL</a>(ret, lstart);
<a name="l03676"></a>03676         <a class="code" href="../../d2/d47/compile_8c.html#a04d4dbcbb97179b5908eb025e13c7752">COMPILE_</a>(ret, <span class="stringliteral">&quot;ensure head&quot;</span>, node-&gt;nd_head, poped);
<a name="l03677"></a>03677         <a class="code" href="../../d2/d47/compile_8c.html#a5a380bb449656575d6b77ccb8eb7e5ae">ADD_LABEL</a>(ret, lend);
<a name="l03678"></a>03678         <span class="keywordflow">if</span> (ensr-&gt;anchor.next == 0) {
<a name="l03679"></a>03679             <a class="code" href="../../d2/d47/compile_8c.html#aa5b45ae61de3350f0830a32589bbb7ee">ADD_INSN</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), nop);
<a name="l03680"></a>03680         }
<a name="l03681"></a>03681         <span class="keywordflow">else</span> {
<a name="l03682"></a>03682             <a class="code" href="../../d2/d47/compile_8c.html#afd9d72d069724385c83bcc32d6746b1e">ADD_SEQ</a>(ret, ensr);
<a name="l03683"></a>03683         }
<a name="l03684"></a>03684         <a class="code" href="../../d2/d47/compile_8c.html#a5a380bb449656575d6b77ccb8eb7e5ae">ADD_LABEL</a>(ret, lcont);
<a name="l03685"></a>03685 
<a name="l03686"></a>03686         erange = iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a947d34698fb5a71f4938532fff27a0f7">compile_data</a>-&gt;<a class="code" href="../../d4/dd8/structiseq__compile__data.html#a3f5b0db80047c5fef40ea0783646ddb0">ensure_node_stack</a>-&gt;<a class="code" href="../../d6/dca/structiseq__compile__data__ensure__node__stack.html#ac7ba7bd330d22b7ff0bfc0deb1217947">erange</a>;
<a name="l03687"></a>03687         <span class="keywordflow">while</span> (erange) {
<a name="l03688"></a>03688             <a class="code" href="../../d2/d47/compile_8c.html#a668f1779f1e5158e6ad8d4b6d92638db">ADD_CATCH_ENTRY</a>(CATCH_TYPE_ENSURE, erange-&gt;<a class="code" href="../../da/d32/structensure__range.html#a8ad1f4748dfe9dcf6667452d0d3e8ed0">begin</a>, erange-&gt;<a class="code" href="../../da/d32/structensure__range.html#aa15081d5666a57e4df5a74bbad8cda12">end</a>,
<a name="l03689"></a>03689                             ensure, lcont);
<a name="l03690"></a>03690             erange = erange-&gt;<a class="code" href="../../da/d32/structensure__range.html#a2db4411cce7aefb5b8c9a9ce4dadd2e7">next</a>;
<a name="l03691"></a>03691         }
<a name="l03692"></a>03692 
<a name="l03693"></a>03693         iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a947d34698fb5a71f4938532fff27a0f7">compile_data</a>-&gt;<a class="code" href="../../d4/dd8/structiseq__compile__data.html#a3f5b0db80047c5fef40ea0783646ddb0">ensure_node_stack</a> = enl.<a class="code" href="../../d6/dca/structiseq__compile__data__ensure__node__stack.html#a4da021e50680d45890063a5f7f8160ae">prev</a>;
<a name="l03694"></a>03694         <span class="keywordflow">break</span>;
<a name="l03695"></a>03695       }
<a name="l03696"></a>03696 
<a name="l03697"></a>03697       <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#afce3dc60f5eb8de336e40138600ef910">NODE_AND</a>:
<a name="l03698"></a>03698       <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#addcdfeefb5907f74a7b172a710c8d45e">NODE_OR</a>:{
<a name="l03699"></a>03699         <a class="code" href="../../d8/dc5/structiseq__label__data.html">LABEL</a> *end_label = <a class="code" href="../../d2/d47/compile_8c.html#a1d6d5d8dac7aff9ac863255a0905c0f9">NEW_LABEL</a>(<a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node));
<a name="l03700"></a>03700         <a class="code" href="../../d2/d47/compile_8c.html#a0cacd6cfca69df35e1535d2f21532c47">COMPILE</a>(ret, <span class="stringliteral">&quot;nd_1st&quot;</span>, node-&gt;nd_1st);
<a name="l03701"></a>03701         <span class="keywordflow">if</span> (!poped) {
<a name="l03702"></a>03702             <a class="code" href="../../d2/d47/compile_8c.html#aa5b45ae61de3350f0830a32589bbb7ee">ADD_INSN</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), dup);
<a name="l03703"></a>03703         }
<a name="l03704"></a>03704         <span class="keywordflow">if</span> (type == <a class="code" href="../../d3/d09/ripper_8y.html#afce3dc60f5eb8de336e40138600ef910">NODE_AND</a>) {
<a name="l03705"></a>03705             <a class="code" href="../../d2/d47/compile_8c.html#ace57e2f70722586d3764284364cfb5ad">ADD_INSNL</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), branchunless, end_label);
<a name="l03706"></a>03706         }
<a name="l03707"></a>03707         <span class="keywordflow">else</span> {
<a name="l03708"></a>03708             <a class="code" href="../../d2/d47/compile_8c.html#ace57e2f70722586d3764284364cfb5ad">ADD_INSNL</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), branchif, end_label);
<a name="l03709"></a>03709         }
<a name="l03710"></a>03710         <span class="keywordflow">if</span> (!poped) {
<a name="l03711"></a>03711             <a class="code" href="../../d2/d47/compile_8c.html#aa5b45ae61de3350f0830a32589bbb7ee">ADD_INSN</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), pop);
<a name="l03712"></a>03712         }
<a name="l03713"></a>03713         <a class="code" href="../../d2/d47/compile_8c.html#a04d4dbcbb97179b5908eb025e13c7752">COMPILE_</a>(ret, <span class="stringliteral">&quot;nd_2nd&quot;</span>, node-&gt;nd_2nd, poped);
<a name="l03714"></a>03714         <a class="code" href="../../d2/d47/compile_8c.html#a5a380bb449656575d6b77ccb8eb7e5ae">ADD_LABEL</a>(ret, end_label);
<a name="l03715"></a>03715         <span class="keywordflow">break</span>;
<a name="l03716"></a>03716       }
<a name="l03717"></a>03717 
<a name="l03718"></a>03718       <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#ad03c15faf9f8ca478889f491431b406b">NODE_MASGN</a>:{
<a name="l03719"></a>03719         <a class="code" href="../../d2/d47/compile_8c.html#adc82350e5a894e2307b8c17344aad326">compile_massign</a>(iseq, ret, node, poped);
<a name="l03720"></a>03720         <span class="keywordflow">break</span>;
<a name="l03721"></a>03721       }
<a name="l03722"></a>03722 
<a name="l03723"></a>03723       <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#aa9d208a2eb1e5266beea027e10f3d472">NODE_LASGN</a>:{
<a name="l03724"></a>03724         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#afa5b9137f051ac26d7ccc8824f178233">ID</a> <span class="keywordtype">id</span> = node-&gt;nd_vid;
<a name="l03725"></a>03725         <span class="keywordtype">int</span> idx = iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a0f5705507c4c80bc69c3f031dd0daae9">local_iseq</a>-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#afbae994355f91f3ea547570debb757c0">local_size</a> - <a class="code" href="../../d2/d47/compile_8c.html#a96a61ad19fe487bd51c13a2a4b151994">get_local_var_idx</a>(iseq, <span class="keywordtype">id</span>);
<a name="l03726"></a>03726 
<a name="l03727"></a>03727         <a class="code" href="../../d2/d47/compile_8c.html#a72ae3dfc8896ca7c87ed2aed1810db43">debugs</a>(<span class="stringliteral">&quot;lvar: %s idx: %d\n&quot;</span>, <a class="code" href="../../d5/d11/ripper_8c.html#a877bc58c495643fcf49dc64c44631e72">rb_id2name</a>(<span class="keywordtype">id</span>), idx);
<a name="l03728"></a>03728         <a class="code" href="../../d2/d47/compile_8c.html#a0cacd6cfca69df35e1535d2f21532c47">COMPILE</a>(ret, <span class="stringliteral">&quot;rvalue&quot;</span>, node-&gt;nd_value);
<a name="l03729"></a>03729 
<a name="l03730"></a>03730         <span class="keywordflow">if</span> (!poped) {
<a name="l03731"></a>03731             <a class="code" href="../../d2/d47/compile_8c.html#aa5b45ae61de3350f0830a32589bbb7ee">ADD_INSN</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), dup);
<a name="l03732"></a>03732         }
<a name="l03733"></a>03733         <a class="code" href="../../d2/d47/compile_8c.html#a3cfeb7549a1249a8b78f9d6ff1e74c5a">ADD_INSN1</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), setlocal, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(idx));
<a name="l03734"></a>03734 
<a name="l03735"></a>03735         <span class="keywordflow">break</span>;
<a name="l03736"></a>03736       }
<a name="l03737"></a>03737       <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#af92abe71c6571a24b59b4eb4ebb5908f">NODE_DASGN</a>:
<a name="l03738"></a>03738       <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#aa69a9128d7cd7376dc4d76e65d90e994">NODE_DASGN_CURR</a>:{
<a name="l03739"></a>03739         <span class="keywordtype">int</span> idx, lv, ls;
<a name="l03740"></a>03740         <a class="code" href="../../d2/d47/compile_8c.html#a0cacd6cfca69df35e1535d2f21532c47">COMPILE</a>(ret, <span class="stringliteral">&quot;dvalue&quot;</span>, node-&gt;nd_value);
<a name="l03741"></a>03741         <a class="code" href="../../d2/d47/compile_8c.html#ad983bdc29f9c5bde5ab33d14c3d143e6">debugp_param</a>(<span class="stringliteral">&quot;dassn id&quot;</span>, <a class="code" href="../../db/d2e/intern_8h.html#a03acd62c0b1edebbe1d61f957c19b7ac">rb_str_new2</a>(<a class="code" href="../../d5/d11/ripper_8c.html#a877bc58c495643fcf49dc64c44631e72">rb_id2name</a>(node-&gt;nd_vid) ? <a class="code" href="../../d5/d11/ripper_8c.html#a877bc58c495643fcf49dc64c44631e72">rb_id2name</a>(node-&gt;nd_vid) : <span class="stringliteral">&quot;*&quot;</span>));
<a name="l03742"></a>03742 
<a name="l03743"></a>03743         <span class="keywordflow">if</span> (!poped) {
<a name="l03744"></a>03744             <a class="code" href="../../d2/d47/compile_8c.html#aa5b45ae61de3350f0830a32589bbb7ee">ADD_INSN</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), dup);
<a name="l03745"></a>03745         }
<a name="l03746"></a>03746 
<a name="l03747"></a>03747         idx = <a class="code" href="../../d2/d47/compile_8c.html#a0bdb81b7c6cece8636831256b2f5acef">get_dyna_var_idx</a>(iseq, node-&gt;nd_vid, &amp;lv, &amp;ls);
<a name="l03748"></a>03748 
<a name="l03749"></a>03749         <span class="keywordflow">if</span> (idx &lt; 0) {
<a name="l03750"></a>03750             <a class="code" href="../../db/dcc/error_8c.html#a2d5fb28e54f792e7341b2c45f52f3860">rb_bug</a>(<span class="stringliteral">&quot;NODE_DASGN(_CURR): unknown id (%s)&quot;</span>, <a class="code" href="../../d5/d11/ripper_8c.html#a877bc58c495643fcf49dc64c44631e72">rb_id2name</a>(node-&gt;nd_vid));
<a name="l03751"></a>03751         }
<a name="l03752"></a>03752 
<a name="l03753"></a>03753         <a class="code" href="../../d2/d47/compile_8c.html#a9e17ccfd8b31ec3afcb91be39a6d453f">ADD_INSN2</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), setdynamic,
<a name="l03754"></a>03754                   <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(ls - idx), <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(lv));
<a name="l03755"></a>03755         <span class="keywordflow">break</span>;
<a name="l03756"></a>03756       }
<a name="l03757"></a>03757       <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#acc59e8bf53d75d27835d03ee9bbac630">NODE_GASGN</a>:{
<a name="l03758"></a>03758         <a class="code" href="../../d2/d47/compile_8c.html#a0cacd6cfca69df35e1535d2f21532c47">COMPILE</a>(ret, <span class="stringliteral">&quot;lvalue&quot;</span>, node-&gt;nd_value);
<a name="l03759"></a>03759 
<a name="l03760"></a>03760         <span class="keywordflow">if</span> (!poped) {
<a name="l03761"></a>03761             <a class="code" href="../../d2/d47/compile_8c.html#aa5b45ae61de3350f0830a32589bbb7ee">ADD_INSN</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), dup);
<a name="l03762"></a>03762         }
<a name="l03763"></a>03763         <a class="code" href="../../d2/d47/compile_8c.html#a3cfeb7549a1249a8b78f9d6ff1e74c5a">ADD_INSN1</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), setglobal,
<a name="l03764"></a>03764                   ((<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>)node-&gt;nd_entry | 1));
<a name="l03765"></a>03765         <span class="keywordflow">break</span>;
<a name="l03766"></a>03766       }
<a name="l03767"></a>03767       <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#a4e3d1029dca72147900e9b1a840bf968">NODE_IASGN</a>:
<a name="l03768"></a>03768       <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#a015923f7f402969debebc4d989678ea4">NODE_IASGN2</a>:{
<a name="l03769"></a>03769         <a class="code" href="../../d2/d47/compile_8c.html#a0cacd6cfca69df35e1535d2f21532c47">COMPILE</a>(ret, <span class="stringliteral">&quot;lvalue&quot;</span>, node-&gt;nd_value);
<a name="l03770"></a>03770         <span class="keywordflow">if</span> (!poped) {
<a name="l03771"></a>03771             <a class="code" href="../../d2/d47/compile_8c.html#aa5b45ae61de3350f0830a32589bbb7ee">ADD_INSN</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), dup);
<a name="l03772"></a>03772         }
<a name="l03773"></a>03773         <a class="code" href="../../d2/d47/compile_8c.html#a9e17ccfd8b31ec3afcb91be39a6d453f">ADD_INSN2</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), setinstancevariable,
<a name="l03774"></a>03774                   <a class="code" href="../../dc/d0c/cparse_8c.html#a48bfb6519a45249fb2ec0193ea3b6e1c">ID2SYM</a>(node-&gt;nd_vid), <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a72aee3eed9e9842166e381972a35e9fb">ic_size</a>++));
<a name="l03775"></a>03775         <span class="keywordflow">break</span>;
<a name="l03776"></a>03776       }
<a name="l03777"></a>03777       <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#a62bbab89538c1de14389202f9797ab3d">NODE_CDECL</a>:{
<a name="l03778"></a>03778         <a class="code" href="../../d2/d47/compile_8c.html#a0cacd6cfca69df35e1535d2f21532c47">COMPILE</a>(ret, <span class="stringliteral">&quot;lvalue&quot;</span>, node-&gt;nd_value);
<a name="l03779"></a>03779 
<a name="l03780"></a>03780         <span class="keywordflow">if</span> (!poped) {
<a name="l03781"></a>03781             <a class="code" href="../../d2/d47/compile_8c.html#aa5b45ae61de3350f0830a32589bbb7ee">ADD_INSN</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), dup);
<a name="l03782"></a>03782         }
<a name="l03783"></a>03783 
<a name="l03784"></a>03784         <span class="keywordflow">if</span> (node-&gt;nd_vid) {
<a name="l03785"></a>03785             <a class="code" href="../../d2/d47/compile_8c.html#a3cfeb7549a1249a8b78f9d6ff1e74c5a">ADD_INSN1</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), putspecialobject,
<a name="l03786"></a>03786                       <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(<a class="code" href="../../d8/d32/vm__core_8h.html#a3aec522068d95925054562a7c650b99bae7870b1ddaa6ed7a92c75cd05b39e807">VM_SPECIAL_OBJECT_CONST_BASE</a>));
<a name="l03787"></a>03787             <a class="code" href="../../d2/d47/compile_8c.html#a3cfeb7549a1249a8b78f9d6ff1e74c5a">ADD_INSN1</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), setconstant, <a class="code" href="../../dc/d0c/cparse_8c.html#a48bfb6519a45249fb2ec0193ea3b6e1c">ID2SYM</a>(node-&gt;nd_vid));
<a name="l03788"></a>03788         }
<a name="l03789"></a>03789         <span class="keywordflow">else</span> {
<a name="l03790"></a>03790             <a class="code" href="../../d2/d47/compile_8c.html#afbd4358e854311242b62772d0b1660bc">compile_cpath</a>(ret, iseq, node-&gt;nd_else);
<a name="l03791"></a>03791             <a class="code" href="../../d2/d47/compile_8c.html#a3cfeb7549a1249a8b78f9d6ff1e74c5a">ADD_INSN1</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), setconstant, <a class="code" href="../../dc/d0c/cparse_8c.html#a48bfb6519a45249fb2ec0193ea3b6e1c">ID2SYM</a>(node-&gt;nd_else-&gt;nd_mid));
<a name="l03792"></a>03792         }
<a name="l03793"></a>03793         <span class="keywordflow">break</span>;
<a name="l03794"></a>03794       }
<a name="l03795"></a>03795       <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#ae0d7af3d0cea1ce334874826929507bf">NODE_CVASGN</a>:{
<a name="l03796"></a>03796         <a class="code" href="../../d2/d47/compile_8c.html#a0cacd6cfca69df35e1535d2f21532c47">COMPILE</a>(ret, <span class="stringliteral">&quot;cvasgn val&quot;</span>, node-&gt;nd_value);
<a name="l03797"></a>03797         <span class="keywordflow">if</span> (!poped) {
<a name="l03798"></a>03798             <a class="code" href="../../d2/d47/compile_8c.html#aa5b45ae61de3350f0830a32589bbb7ee">ADD_INSN</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), dup);
<a name="l03799"></a>03799         }
<a name="l03800"></a>03800         <a class="code" href="../../d2/d47/compile_8c.html#a3cfeb7549a1249a8b78f9d6ff1e74c5a">ADD_INSN1</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), setclassvariable,
<a name="l03801"></a>03801                   <a class="code" href="../../dc/d0c/cparse_8c.html#a48bfb6519a45249fb2ec0193ea3b6e1c">ID2SYM</a>(node-&gt;nd_vid));
<a name="l03802"></a>03802         <span class="keywordflow">break</span>;
<a name="l03803"></a>03803       }
<a name="l03804"></a>03804       <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#a7ed32e1efe76c3f34ccf1ac4c9def39c">NODE_OP_ASGN1</a>: {
<a name="l03805"></a>03805         <a class="code" href="../../d2/d47/compile_8c.html#aa9d6014cec8d3adcb228b81620eac795">DECL_ANCHOR</a>(<a class="code" href="../../d3/d09/ripper_8y.html#a8187411843a6284ffb964ef3fb9fcab3">args</a>);
<a name="l03806"></a>03806         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> argc;
<a name="l03807"></a>03807         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> flag = 0;
<a name="l03808"></a>03808         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#afa5b9137f051ac26d7ccc8824f178233">ID</a> <span class="keywordtype">id</span> = node-&gt;nd_mid;
<a name="l03809"></a>03809         <span class="keywordtype">int</span> boff = 0;
<a name="l03810"></a>03810 
<a name="l03811"></a>03811         <span class="comment">/*</span>
<a name="l03812"></a>03812 <span class="comment">         * a[x] (op)= y</span>
<a name="l03813"></a>03813 <span class="comment">         *</span>
<a name="l03814"></a>03814 <span class="comment">         * nil       # nil</span>
<a name="l03815"></a>03815 <span class="comment">         * eval a    # nil a</span>
<a name="l03816"></a>03816 <span class="comment">         * eval x    # nil a x</span>
<a name="l03817"></a>03817 <span class="comment">         * dupn 2    # nil a x a x</span>
<a name="l03818"></a>03818 <span class="comment">         * send :[]  # nil a x a[x]</span>
<a name="l03819"></a>03819 <span class="comment">         * eval y    # nil a x a[x] y</span>
<a name="l03820"></a>03820 <span class="comment">         * send op   # nil a x ret</span>
<a name="l03821"></a>03821 <span class="comment">         * setn 3    # ret a x ret</span>
<a name="l03822"></a>03822 <span class="comment">         * send []=  # ret ?</span>
<a name="l03823"></a>03823 <span class="comment">         * pop       # ret</span>
<a name="l03824"></a>03824 <span class="comment">         */</span>
<a name="l03825"></a>03825 
<a name="l03826"></a>03826         <span class="comment">/*</span>
<a name="l03827"></a>03827 <span class="comment">         * nd_recv[nd_args-&gt;nd_body] (nd_mid)= nd_args-&gt;nd_head;</span>
<a name="l03828"></a>03828 <span class="comment">         * NODE_OP_ASGN nd_recv</span>
<a name="l03829"></a>03829 <span class="comment">         *              nd_args-&gt;nd_head</span>
<a name="l03830"></a>03830 <span class="comment">         *              nd_args-&gt;nd_body</span>
<a name="l03831"></a>03831 <span class="comment">         *              nd_mid</span>
<a name="l03832"></a>03832 <span class="comment">         */</span>
<a name="l03833"></a>03833 
<a name="l03834"></a>03834         <span class="keywordflow">if</span> (!poped) {
<a name="l03835"></a>03835             <a class="code" href="../../d2/d47/compile_8c.html#aa5b45ae61de3350f0830a32589bbb7ee">ADD_INSN</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), putnil);
<a name="l03836"></a>03836         }
<a name="l03837"></a>03837         <a class="code" href="../../d2/d47/compile_8c.html#a0cacd6cfca69df35e1535d2f21532c47">COMPILE</a>(ret, <span class="stringliteral">&quot;NODE_OP_ASGN1 recv&quot;</span>, node-&gt;nd_recv);
<a name="l03838"></a>03838         <span class="keywordflow">switch</span> (<a class="code" href="../../d3/d09/ripper_8y.html#ade12c589b26f55f089dc25d689249c11">nd_type</a>(node-&gt;nd_args-&gt;nd_head)) {
<a name="l03839"></a>03839           <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#acb7153a88fb24c846bd6751ca2fa9316">NODE_ZARRAY</a>:
<a name="l03840"></a>03840             argc = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(0);
<a name="l03841"></a>03841             <span class="keywordflow">break</span>;
<a name="l03842"></a>03842           <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#aac25fa5ac2c9b236539991db75bbe3b7">NODE_BLOCK_PASS</a>:
<a name="l03843"></a>03843             boff = 1;
<a name="l03844"></a>03844           <span class="keywordflow">default</span>:
<a name="l03845"></a>03845             <a class="code" href="../../d2/d47/compile_8c.html#ac32b1f7d8de8f10f33a147030d8b7544">INIT_ANCHOR</a>(<a class="code" href="../../d3/d09/ripper_8y.html#a8187411843a6284ffb964ef3fb9fcab3">args</a>);
<a name="l03846"></a>03846             argc = <a class="code" href="../../d2/d47/compile_8c.html#ab6ce5708d11d498cf4924186b39820c2">setup_args</a>(iseq, <a class="code" href="../../d3/d09/ripper_8y.html#a8187411843a6284ffb964ef3fb9fcab3">args</a>, node-&gt;nd_args-&gt;nd_head, &amp;flag);
<a name="l03847"></a>03847             <a class="code" href="../../d2/d47/compile_8c.html#afd9d72d069724385c83bcc32d6746b1e">ADD_SEQ</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a8187411843a6284ffb964ef3fb9fcab3">args</a>);
<a name="l03848"></a>03848         }
<a name="l03849"></a>03849         <a class="code" href="../../d2/d47/compile_8c.html#a3cfeb7549a1249a8b78f9d6ff1e74c5a">ADD_INSN1</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), dupn, <a class="code" href="../../d2/d47/compile_8c.html#acd55fe1710206f036b5e80795eae3284">FIXNUM_INC</a>(argc, 1 + boff));
<a name="l03850"></a>03850         <a class="code" href="../../d2/d47/compile_8c.html#a8e30721d838a4a66104bbecb561ef0c9">ADD_SEND_R</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), <a class="code" href="../../dc/d0c/cparse_8c.html#a48bfb6519a45249fb2ec0193ea3b6e1c">ID2SYM</a>(<a class="code" href="../../df/db9/id_8h.html#a08dd4fbd61c5fde369edd59783f753b3a700fe924530f27c93c81ba548682f680">idAREF</a>), argc, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aba0717d2689eb68797421a02ab9295c6">Qfalse</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a2ead2f64c81efed352e79e89f29b8fc8">LONG2FIX</a>(flag));
<a name="l03851"></a>03851 
<a name="l03852"></a>03852         <span class="keywordflow">if</span> (<span class="keywordtype">id</span> == 0 || <span class="keywordtype">id</span> == 1) {
<a name="l03853"></a>03853             <span class="comment">/* 0: or, 1: and</span>
<a name="l03854"></a>03854 <span class="comment">               a[x] ||= y</span>
<a name="l03855"></a>03855 <span class="comment"></span>
<a name="l03856"></a>03856 <span class="comment">               unless/if a[x]</span>
<a name="l03857"></a>03857 <span class="comment">               a[x]= y</span>
<a name="l03858"></a>03858 <span class="comment">               else</span>
<a name="l03859"></a>03859 <span class="comment">               nil</span>
<a name="l03860"></a>03860 <span class="comment">               end</span>
<a name="l03861"></a>03861 <span class="comment">            */</span>
<a name="l03862"></a>03862             <a class="code" href="../../d8/dc5/structiseq__label__data.html">LABEL</a> *label = <a class="code" href="../../d2/d47/compile_8c.html#a1d6d5d8dac7aff9ac863255a0905c0f9">NEW_LABEL</a>(<a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node));
<a name="l03863"></a>03863             <a class="code" href="../../d8/dc5/structiseq__label__data.html">LABEL</a> *lfin = <a class="code" href="../../d2/d47/compile_8c.html#a1d6d5d8dac7aff9ac863255a0905c0f9">NEW_LABEL</a>(<a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node));
<a name="l03864"></a>03864 
<a name="l03865"></a>03865             <a class="code" href="../../d2/d47/compile_8c.html#aa5b45ae61de3350f0830a32589bbb7ee">ADD_INSN</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), dup);
<a name="l03866"></a>03866             <span class="keywordflow">if</span> (<span class="keywordtype">id</span> == 0) {
<a name="l03867"></a>03867                 <span class="comment">/* or */</span>
<a name="l03868"></a>03868                 <a class="code" href="../../d2/d47/compile_8c.html#ace57e2f70722586d3764284364cfb5ad">ADD_INSNL</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), branchif, label);
<a name="l03869"></a>03869             }
<a name="l03870"></a>03870             <span class="keywordflow">else</span> {
<a name="l03871"></a>03871                 <span class="comment">/* and */</span>
<a name="l03872"></a>03872                 <a class="code" href="../../d2/d47/compile_8c.html#ace57e2f70722586d3764284364cfb5ad">ADD_INSNL</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), branchunless, label);
<a name="l03873"></a>03873             }
<a name="l03874"></a>03874             <a class="code" href="../../d2/d47/compile_8c.html#aa5b45ae61de3350f0830a32589bbb7ee">ADD_INSN</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), pop);
<a name="l03875"></a>03875 
<a name="l03876"></a>03876             <a class="code" href="../../d2/d47/compile_8c.html#a0cacd6cfca69df35e1535d2f21532c47">COMPILE</a>(ret, <span class="stringliteral">&quot;NODE_OP_ASGN1 args-&gt;body: &quot;</span>, node-&gt;nd_args-&gt;nd_body);
<a name="l03877"></a>03877             <span class="keywordflow">if</span> (!poped) {
<a name="l03878"></a>03878                 <a class="code" href="../../d2/d47/compile_8c.html#a3cfeb7549a1249a8b78f9d6ff1e74c5a">ADD_INSN1</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), setn, <a class="code" href="../../d2/d47/compile_8c.html#acd55fe1710206f036b5e80795eae3284">FIXNUM_INC</a>(argc, 2+boff));
<a name="l03879"></a>03879             }
<a name="l03880"></a>03880             <span class="keywordflow">if</span> (flag &amp; <a class="code" href="../../d8/d32/vm__core_8h.html#a56aad9fa74696d2a86028361323a75a6">VM_CALL_ARGS_SPLAT_BIT</a>) {
<a name="l03881"></a>03881                 <a class="code" href="../../d2/d47/compile_8c.html#a3cfeb7549a1249a8b78f9d6ff1e74c5a">ADD_INSN1</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), newarray, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(1));
<a name="l03882"></a>03882                 <span class="keywordflow">if</span> (boff &gt; 0) {
<a name="l03883"></a>03883                     <a class="code" href="../../d2/d47/compile_8c.html#a3cfeb7549a1249a8b78f9d6ff1e74c5a">ADD_INSN1</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), dupn, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(3));
<a name="l03884"></a>03884                     <a class="code" href="../../d2/d47/compile_8c.html#aa5b45ae61de3350f0830a32589bbb7ee">ADD_INSN</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), swap);
<a name="l03885"></a>03885                     <a class="code" href="../../d2/d47/compile_8c.html#aa5b45ae61de3350f0830a32589bbb7ee">ADD_INSN</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), pop);
<a name="l03886"></a>03886                 }
<a name="l03887"></a>03887                 <a class="code" href="../../d2/d47/compile_8c.html#aa5b45ae61de3350f0830a32589bbb7ee">ADD_INSN</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), concatarray);
<a name="l03888"></a>03888                 <span class="keywordflow">if</span> (boff &gt; 0) {
<a name="l03889"></a>03889                     <a class="code" href="../../d2/d47/compile_8c.html#a3cfeb7549a1249a8b78f9d6ff1e74c5a">ADD_INSN1</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), setn, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(3));
<a name="l03890"></a>03890                     <a class="code" href="../../d2/d47/compile_8c.html#aa5b45ae61de3350f0830a32589bbb7ee">ADD_INSN</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), pop);
<a name="l03891"></a>03891                     <a class="code" href="../../d2/d47/compile_8c.html#aa5b45ae61de3350f0830a32589bbb7ee">ADD_INSN</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), pop);
<a name="l03892"></a>03892                 }
<a name="l03893"></a>03893                 <a class="code" href="../../d2/d47/compile_8c.html#a8e30721d838a4a66104bbecb561ef0c9">ADD_SEND_R</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), <a class="code" href="../../dc/d0c/cparse_8c.html#a48bfb6519a45249fb2ec0193ea3b6e1c">ID2SYM</a>(<a class="code" href="../../df/db9/id_8h.html#a08dd4fbd61c5fde369edd59783f753b3a6e86304dcb88607047172f924701e79d">idASET</a>),
<a name="l03894"></a>03894                            argc, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aba0717d2689eb68797421a02ab9295c6">Qfalse</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a2ead2f64c81efed352e79e89f29b8fc8">LONG2FIX</a>(flag));
<a name="l03895"></a>03895             }
<a name="l03896"></a>03896             <span class="keywordflow">else</span> {
<a name="l03897"></a>03897                 <span class="keywordflow">if</span> (boff &gt; 0)
<a name="l03898"></a>03898                     <a class="code" href="../../d2/d47/compile_8c.html#aa5b45ae61de3350f0830a32589bbb7ee">ADD_INSN</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), swap);
<a name="l03899"></a>03899                 <a class="code" href="../../d2/d47/compile_8c.html#a8e30721d838a4a66104bbecb561ef0c9">ADD_SEND_R</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), <a class="code" href="../../dc/d0c/cparse_8c.html#a48bfb6519a45249fb2ec0193ea3b6e1c">ID2SYM</a>(<a class="code" href="../../df/db9/id_8h.html#a08dd4fbd61c5fde369edd59783f753b3a6e86304dcb88607047172f924701e79d">idASET</a>),
<a name="l03900"></a>03900                            <a class="code" href="../../d2/d47/compile_8c.html#acd55fe1710206f036b5e80795eae3284">FIXNUM_INC</a>(argc, 1), <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aba0717d2689eb68797421a02ab9295c6">Qfalse</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a2ead2f64c81efed352e79e89f29b8fc8">LONG2FIX</a>(flag));
<a name="l03901"></a>03901             }
<a name="l03902"></a>03902             <a class="code" href="../../d2/d47/compile_8c.html#aa5b45ae61de3350f0830a32589bbb7ee">ADD_INSN</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), pop);
<a name="l03903"></a>03903             <a class="code" href="../../d2/d47/compile_8c.html#ace57e2f70722586d3764284364cfb5ad">ADD_INSNL</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), jump, lfin);
<a name="l03904"></a>03904             <a class="code" href="../../d2/d47/compile_8c.html#a5a380bb449656575d6b77ccb8eb7e5ae">ADD_LABEL</a>(ret, label);
<a name="l03905"></a>03905             <span class="keywordflow">if</span> (!poped) {
<a name="l03906"></a>03906                 <a class="code" href="../../d2/d47/compile_8c.html#a3cfeb7549a1249a8b78f9d6ff1e74c5a">ADD_INSN1</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), setn, <a class="code" href="../../d2/d47/compile_8c.html#acd55fe1710206f036b5e80795eae3284">FIXNUM_INC</a>(argc, 2+boff));
<a name="l03907"></a>03907             }
<a name="l03908"></a>03908             <a class="code" href="../../d2/d47/compile_8c.html#a3cfeb7549a1249a8b78f9d6ff1e74c5a">ADD_INSN1</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), adjuststack, <a class="code" href="../../d2/d47/compile_8c.html#acd55fe1710206f036b5e80795eae3284">FIXNUM_INC</a>(argc, 2+boff));
<a name="l03909"></a>03909             <a class="code" href="../../d2/d47/compile_8c.html#a5a380bb449656575d6b77ccb8eb7e5ae">ADD_LABEL</a>(ret, lfin);
<a name="l03910"></a>03910         }
<a name="l03911"></a>03911         <span class="keywordflow">else</span> {
<a name="l03912"></a>03912             <a class="code" href="../../d2/d47/compile_8c.html#a0cacd6cfca69df35e1535d2f21532c47">COMPILE</a>(ret, <span class="stringliteral">&quot;NODE_OP_ASGN1 args-&gt;body: &quot;</span>, node-&gt;nd_args-&gt;nd_body);
<a name="l03913"></a>03913             <a class="code" href="../../d2/d47/compile_8c.html#ab1941f9308f4508ab33b8828fec890fd">ADD_SEND</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), <a class="code" href="../../dc/d0c/cparse_8c.html#a48bfb6519a45249fb2ec0193ea3b6e1c">ID2SYM</a>(<span class="keywordtype">id</span>), <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(1));
<a name="l03914"></a>03914             <span class="keywordflow">if</span> (!poped) {
<a name="l03915"></a>03915                 <a class="code" href="../../d2/d47/compile_8c.html#a3cfeb7549a1249a8b78f9d6ff1e74c5a">ADD_INSN1</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), setn, <a class="code" href="../../d2/d47/compile_8c.html#acd55fe1710206f036b5e80795eae3284">FIXNUM_INC</a>(argc, 2+boff));
<a name="l03916"></a>03916             }
<a name="l03917"></a>03917             <span class="keywordflow">if</span> (flag &amp; <a class="code" href="../../d8/d32/vm__core_8h.html#a56aad9fa74696d2a86028361323a75a6">VM_CALL_ARGS_SPLAT_BIT</a>) {
<a name="l03918"></a>03918                 <a class="code" href="../../d2/d47/compile_8c.html#a3cfeb7549a1249a8b78f9d6ff1e74c5a">ADD_INSN1</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), newarray, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(1));
<a name="l03919"></a>03919                 <span class="keywordflow">if</span> (boff &gt; 0) {
<a name="l03920"></a>03920                     <a class="code" href="../../d2/d47/compile_8c.html#a3cfeb7549a1249a8b78f9d6ff1e74c5a">ADD_INSN1</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), dupn, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(3));
<a name="l03921"></a>03921                     <a class="code" href="../../d2/d47/compile_8c.html#aa5b45ae61de3350f0830a32589bbb7ee">ADD_INSN</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), swap);
<a name="l03922"></a>03922                     <a class="code" href="../../d2/d47/compile_8c.html#aa5b45ae61de3350f0830a32589bbb7ee">ADD_INSN</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), pop);
<a name="l03923"></a>03923                 }
<a name="l03924"></a>03924                 <a class="code" href="../../d2/d47/compile_8c.html#aa5b45ae61de3350f0830a32589bbb7ee">ADD_INSN</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), concatarray);
<a name="l03925"></a>03925                 <span class="keywordflow">if</span> (boff &gt; 0) {
<a name="l03926"></a>03926                     <a class="code" href="../../d2/d47/compile_8c.html#a3cfeb7549a1249a8b78f9d6ff1e74c5a">ADD_INSN1</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), setn, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(3));
<a name="l03927"></a>03927                     <a class="code" href="../../d2/d47/compile_8c.html#aa5b45ae61de3350f0830a32589bbb7ee">ADD_INSN</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), pop);
<a name="l03928"></a>03928                     <a class="code" href="../../d2/d47/compile_8c.html#aa5b45ae61de3350f0830a32589bbb7ee">ADD_INSN</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), pop);
<a name="l03929"></a>03929                 }
<a name="l03930"></a>03930                 <a class="code" href="../../d2/d47/compile_8c.html#a8e30721d838a4a66104bbecb561ef0c9">ADD_SEND_R</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), <a class="code" href="../../dc/d0c/cparse_8c.html#a48bfb6519a45249fb2ec0193ea3b6e1c">ID2SYM</a>(<a class="code" href="../../df/db9/id_8h.html#a08dd4fbd61c5fde369edd59783f753b3a6e86304dcb88607047172f924701e79d">idASET</a>),
<a name="l03931"></a>03931                            argc, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aba0717d2689eb68797421a02ab9295c6">Qfalse</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a2ead2f64c81efed352e79e89f29b8fc8">LONG2FIX</a>(flag));
<a name="l03932"></a>03932             }
<a name="l03933"></a>03933             <span class="keywordflow">else</span> {
<a name="l03934"></a>03934                 <span class="keywordflow">if</span> (boff &gt; 0)
<a name="l03935"></a>03935                     <a class="code" href="../../d2/d47/compile_8c.html#aa5b45ae61de3350f0830a32589bbb7ee">ADD_INSN</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), swap);
<a name="l03936"></a>03936                 <a class="code" href="../../d2/d47/compile_8c.html#a8e30721d838a4a66104bbecb561ef0c9">ADD_SEND_R</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), <a class="code" href="../../dc/d0c/cparse_8c.html#a48bfb6519a45249fb2ec0193ea3b6e1c">ID2SYM</a>(<a class="code" href="../../df/db9/id_8h.html#a08dd4fbd61c5fde369edd59783f753b3a6e86304dcb88607047172f924701e79d">idASET</a>),
<a name="l03937"></a>03937                            <a class="code" href="../../d2/d47/compile_8c.html#acd55fe1710206f036b5e80795eae3284">FIXNUM_INC</a>(argc, 1), <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aba0717d2689eb68797421a02ab9295c6">Qfalse</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a2ead2f64c81efed352e79e89f29b8fc8">LONG2FIX</a>(flag));
<a name="l03938"></a>03938             }
<a name="l03939"></a>03939             <a class="code" href="../../d2/d47/compile_8c.html#aa5b45ae61de3350f0830a32589bbb7ee">ADD_INSN</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), pop);
<a name="l03940"></a>03940         }
<a name="l03941"></a>03941 
<a name="l03942"></a>03942         <span class="keywordflow">break</span>;
<a name="l03943"></a>03943       }
<a name="l03944"></a>03944       <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#a6a3094139c05b14867151b55cffdbad0">NODE_OP_ASGN2</a>:{
<a name="l03945"></a>03945         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#afa5b9137f051ac26d7ccc8824f178233">ID</a> atype = node-&gt;nd_next-&gt;nd_mid;
<a name="l03946"></a>03946         <a class="code" href="../../d8/dc5/structiseq__label__data.html">LABEL</a> *lfin = <a class="code" href="../../d2/d47/compile_8c.html#a1d6d5d8dac7aff9ac863255a0905c0f9">NEW_LABEL</a>(<a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node));
<a name="l03947"></a>03947         <a class="code" href="../../d8/dc5/structiseq__label__data.html">LABEL</a> *lcfin = <a class="code" href="../../d2/d47/compile_8c.html#a1d6d5d8dac7aff9ac863255a0905c0f9">NEW_LABEL</a>(<a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node));
<a name="l03948"></a>03948         <span class="comment">/*</span>
<a name="l03949"></a>03949 <span class="comment">          class C; attr_accessor :c; end</span>
<a name="l03950"></a>03950 <span class="comment">          r = C.new</span>
<a name="l03951"></a>03951 <span class="comment">          r.a &amp;&amp;= v # asgn2</span>
<a name="l03952"></a>03952 <span class="comment"></span>
<a name="l03953"></a>03953 <span class="comment">          eval r    # r</span>
<a name="l03954"></a>03954 <span class="comment">          dup       # r r</span>
<a name="l03955"></a>03955 <span class="comment">          eval r.a  # r o</span>
<a name="l03956"></a>03956 <span class="comment"></span>
<a name="l03957"></a>03957 <span class="comment">          # or</span>
<a name="l03958"></a>03958 <span class="comment">          dup       # r o o</span>
<a name="l03959"></a>03959 <span class="comment">          if lcfin  # r o</span>
<a name="l03960"></a>03960 <span class="comment">          pop       # r</span>
<a name="l03961"></a>03961 <span class="comment">          eval v    # r v</span>
<a name="l03962"></a>03962 <span class="comment">          swap      # v r</span>
<a name="l03963"></a>03963 <span class="comment">          topn 1    # v r v</span>
<a name="l03964"></a>03964 <span class="comment">          send a=   # v ?</span>
<a name="l03965"></a>03965 <span class="comment">          jump lfin # v ?</span>
<a name="l03966"></a>03966 <span class="comment"></span>
<a name="l03967"></a>03967 <span class="comment">          lcfin:      # r o</span>
<a name="l03968"></a>03968 <span class="comment">          swap      # o r</span>
<a name="l03969"></a>03969 <span class="comment"></span>
<a name="l03970"></a>03970 <span class="comment">          lfin:       # o ?</span>
<a name="l03971"></a>03971 <span class="comment">          pop       # o</span>
<a name="l03972"></a>03972 <span class="comment"></span>
<a name="l03973"></a>03973 <span class="comment">          # and</span>
<a name="l03974"></a>03974 <span class="comment">          dup       # r o o</span>
<a name="l03975"></a>03975 <span class="comment">          unless lcfin</span>
<a name="l03976"></a>03976 <span class="comment">          pop       # r</span>
<a name="l03977"></a>03977 <span class="comment">          eval v    # r v</span>
<a name="l03978"></a>03978 <span class="comment">          swap      # v r</span>
<a name="l03979"></a>03979 <span class="comment">          topn 1    # v r v</span>
<a name="l03980"></a>03980 <span class="comment">          send a=   # v ?</span>
<a name="l03981"></a>03981 <span class="comment">          jump lfin # v ?</span>
<a name="l03982"></a>03982 <span class="comment"></span>
<a name="l03983"></a>03983 <span class="comment">          # others</span>
<a name="l03984"></a>03984 <span class="comment">          eval v    # r o v</span>
<a name="l03985"></a>03985 <span class="comment">          send ??   # r w</span>
<a name="l03986"></a>03986 <span class="comment">          send a=   # w</span>
<a name="l03987"></a>03987 <span class="comment"></span>
<a name="l03988"></a>03988 <span class="comment">        */</span>
<a name="l03989"></a>03989 
<a name="l03990"></a>03990         <a class="code" href="../../d2/d47/compile_8c.html#a0cacd6cfca69df35e1535d2f21532c47">COMPILE</a>(ret, <span class="stringliteral">&quot;NODE_OP_ASGN2#recv&quot;</span>, node-&gt;nd_recv);
<a name="l03991"></a>03991         <a class="code" href="../../d2/d47/compile_8c.html#aa5b45ae61de3350f0830a32589bbb7ee">ADD_INSN</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), dup);
<a name="l03992"></a>03992         <a class="code" href="../../d2/d47/compile_8c.html#ab1941f9308f4508ab33b8828fec890fd">ADD_SEND</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), <a class="code" href="../../dc/d0c/cparse_8c.html#a48bfb6519a45249fb2ec0193ea3b6e1c">ID2SYM</a>(node-&gt;nd_next-&gt;nd_vid),
<a name="l03993"></a>03993                  <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(0));
<a name="l03994"></a>03994 
<a name="l03995"></a>03995         <span class="keywordflow">if</span> (atype == 0 || atype == 1) { <span class="comment">/* 0: OR or 1: AND */</span>
<a name="l03996"></a>03996             <a class="code" href="../../d2/d47/compile_8c.html#aa5b45ae61de3350f0830a32589bbb7ee">ADD_INSN</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), dup);
<a name="l03997"></a>03997             <span class="keywordflow">if</span> (atype == 0) {
<a name="l03998"></a>03998                 <a class="code" href="../../d2/d47/compile_8c.html#ace57e2f70722586d3764284364cfb5ad">ADD_INSNL</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), branchif, lcfin);
<a name="l03999"></a>03999             }
<a name="l04000"></a>04000             <span class="keywordflow">else</span> {
<a name="l04001"></a>04001                 <a class="code" href="../../d2/d47/compile_8c.html#ace57e2f70722586d3764284364cfb5ad">ADD_INSNL</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), branchunless, lcfin);
<a name="l04002"></a>04002             }
<a name="l04003"></a>04003             <a class="code" href="../../d2/d47/compile_8c.html#aa5b45ae61de3350f0830a32589bbb7ee">ADD_INSN</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), pop);
<a name="l04004"></a>04004             <a class="code" href="../../d2/d47/compile_8c.html#a0cacd6cfca69df35e1535d2f21532c47">COMPILE</a>(ret, <span class="stringliteral">&quot;NODE_OP_ASGN2 val&quot;</span>, node-&gt;nd_value);
<a name="l04005"></a>04005             <a class="code" href="../../d2/d47/compile_8c.html#aa5b45ae61de3350f0830a32589bbb7ee">ADD_INSN</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), swap);
<a name="l04006"></a>04006             <a class="code" href="../../d2/d47/compile_8c.html#a3cfeb7549a1249a8b78f9d6ff1e74c5a">ADD_INSN1</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), topn, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(1));
<a name="l04007"></a>04007             <a class="code" href="../../d2/d47/compile_8c.html#ab1941f9308f4508ab33b8828fec890fd">ADD_SEND</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), <a class="code" href="../../dc/d0c/cparse_8c.html#a48bfb6519a45249fb2ec0193ea3b6e1c">ID2SYM</a>(node-&gt;nd_next-&gt;nd_aid),
<a name="l04008"></a>04008                      <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(1));
<a name="l04009"></a>04009             <a class="code" href="../../d2/d47/compile_8c.html#ace57e2f70722586d3764284364cfb5ad">ADD_INSNL</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), jump, lfin);
<a name="l04010"></a>04010 
<a name="l04011"></a>04011             <a class="code" href="../../d2/d47/compile_8c.html#a5a380bb449656575d6b77ccb8eb7e5ae">ADD_LABEL</a>(ret, lcfin);
<a name="l04012"></a>04012             <a class="code" href="../../d2/d47/compile_8c.html#aa5b45ae61de3350f0830a32589bbb7ee">ADD_INSN</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), swap);
<a name="l04013"></a>04013 
<a name="l04014"></a>04014             <a class="code" href="../../d2/d47/compile_8c.html#a5a380bb449656575d6b77ccb8eb7e5ae">ADD_LABEL</a>(ret, lfin);
<a name="l04015"></a>04015             <a class="code" href="../../d2/d47/compile_8c.html#aa5b45ae61de3350f0830a32589bbb7ee">ADD_INSN</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), pop);
<a name="l04016"></a>04016             <span class="keywordflow">if</span> (poped) {
<a name="l04017"></a>04017                 <span class="comment">/* we can apply more optimize */</span>
<a name="l04018"></a>04018                 <a class="code" href="../../d2/d47/compile_8c.html#aa5b45ae61de3350f0830a32589bbb7ee">ADD_INSN</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), pop);
<a name="l04019"></a>04019             }
<a name="l04020"></a>04020         }
<a name="l04021"></a>04021         <span class="keywordflow">else</span> {
<a name="l04022"></a>04022             <a class="code" href="../../d2/d47/compile_8c.html#a0cacd6cfca69df35e1535d2f21532c47">COMPILE</a>(ret, <span class="stringliteral">&quot;NODE_OP_ASGN2 val&quot;</span>, node-&gt;nd_value);
<a name="l04023"></a>04023             <a class="code" href="../../d2/d47/compile_8c.html#ab1941f9308f4508ab33b8828fec890fd">ADD_SEND</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), <a class="code" href="../../dc/d0c/cparse_8c.html#a48bfb6519a45249fb2ec0193ea3b6e1c">ID2SYM</a>(node-&gt;nd_next-&gt;nd_mid),
<a name="l04024"></a>04024                      <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(1));
<a name="l04025"></a>04025             <span class="keywordflow">if</span> (!poped) {
<a name="l04026"></a>04026                 <a class="code" href="../../d2/d47/compile_8c.html#aa5b45ae61de3350f0830a32589bbb7ee">ADD_INSN</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), swap);
<a name="l04027"></a>04027                 <a class="code" href="../../d2/d47/compile_8c.html#a3cfeb7549a1249a8b78f9d6ff1e74c5a">ADD_INSN1</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), topn, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(1));
<a name="l04028"></a>04028             }
<a name="l04029"></a>04029             <a class="code" href="../../d2/d47/compile_8c.html#ab1941f9308f4508ab33b8828fec890fd">ADD_SEND</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), <a class="code" href="../../dc/d0c/cparse_8c.html#a48bfb6519a45249fb2ec0193ea3b6e1c">ID2SYM</a>(node-&gt;nd_next-&gt;nd_aid),
<a name="l04030"></a>04030                      <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(1));
<a name="l04031"></a>04031             <a class="code" href="../../d2/d47/compile_8c.html#aa5b45ae61de3350f0830a32589bbb7ee">ADD_INSN</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), pop);
<a name="l04032"></a>04032         }
<a name="l04033"></a>04033         <span class="keywordflow">break</span>;
<a name="l04034"></a>04034       }
<a name="l04035"></a>04035       <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#a844d8faea88bfbb66bc0b43a20019df1">NODE_OP_ASGN_AND</a>:
<a name="l04036"></a>04036       <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#a19f6bacf83d13be68f94e4d54a02bc5d">NODE_OP_ASGN_OR</a>:{
<a name="l04037"></a>04037         <a class="code" href="../../d8/dc5/structiseq__label__data.html">LABEL</a> *lfin = <a class="code" href="../../d2/d47/compile_8c.html#a1d6d5d8dac7aff9ac863255a0905c0f9">NEW_LABEL</a>(<a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node));
<a name="l04038"></a>04038         <a class="code" href="../../d8/dc5/structiseq__label__data.html">LABEL</a> *lassign;
<a name="l04039"></a>04039 
<a name="l04040"></a>04040         <span class="keywordflow">if</span> (<a class="code" href="../../d3/d09/ripper_8y.html#ade12c589b26f55f089dc25d689249c11">nd_type</a>(node) == <a class="code" href="../../d3/d09/ripper_8y.html#a19f6bacf83d13be68f94e4d54a02bc5d">NODE_OP_ASGN_OR</a>) {
<a name="l04041"></a>04041             <a class="code" href="../../d8/dc5/structiseq__label__data.html">LABEL</a> *lfinish[2];
<a name="l04042"></a>04042             lfinish[0] = lfin;
<a name="l04043"></a>04043             lfinish[1] = 0;
<a name="l04044"></a>04044             <a class="code" href="../../d2/d47/compile_8c.html#af63fe831dd3325e6beeba0a4c6127159">defined_expr</a>(iseq, ret, node-&gt;nd_head, lfinish, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aba0717d2689eb68797421a02ab9295c6">Qfalse</a>);
<a name="l04045"></a>04045             lassign = lfinish[1];
<a name="l04046"></a>04046             <span class="keywordflow">if</span> (!lassign) {
<a name="l04047"></a>04047                 lassign = <a class="code" href="../../d2/d47/compile_8c.html#a1d6d5d8dac7aff9ac863255a0905c0f9">NEW_LABEL</a>(<a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node));
<a name="l04048"></a>04048             }
<a name="l04049"></a>04049             <a class="code" href="../../d2/d47/compile_8c.html#ace57e2f70722586d3764284364cfb5ad">ADD_INSNL</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), branchunless, lassign);
<a name="l04050"></a>04050         }
<a name="l04051"></a>04051         <span class="keywordflow">else</span> {
<a name="l04052"></a>04052             lassign = <a class="code" href="../../d2/d47/compile_8c.html#a1d6d5d8dac7aff9ac863255a0905c0f9">NEW_LABEL</a>(<a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node));
<a name="l04053"></a>04053         }
<a name="l04054"></a>04054 
<a name="l04055"></a>04055         <a class="code" href="../../d2/d47/compile_8c.html#a0cacd6cfca69df35e1535d2f21532c47">COMPILE</a>(ret, <span class="stringliteral">&quot;NODE_OP_ASGN_AND/OR#nd_head&quot;</span>, node-&gt;nd_head);
<a name="l04056"></a>04056         <a class="code" href="../../d2/d47/compile_8c.html#aa5b45ae61de3350f0830a32589bbb7ee">ADD_INSN</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), dup);
<a name="l04057"></a>04057 
<a name="l04058"></a>04058         <span class="keywordflow">if</span> (<a class="code" href="../../d3/d09/ripper_8y.html#ade12c589b26f55f089dc25d689249c11">nd_type</a>(node) == <a class="code" href="../../d3/d09/ripper_8y.html#a844d8faea88bfbb66bc0b43a20019df1">NODE_OP_ASGN_AND</a>) {
<a name="l04059"></a>04059             <a class="code" href="../../d2/d47/compile_8c.html#ace57e2f70722586d3764284364cfb5ad">ADD_INSNL</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), branchunless, lfin);
<a name="l04060"></a>04060         }
<a name="l04061"></a>04061         <span class="keywordflow">else</span> {
<a name="l04062"></a>04062             <a class="code" href="../../d2/d47/compile_8c.html#ace57e2f70722586d3764284364cfb5ad">ADD_INSNL</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), branchif, lfin);
<a name="l04063"></a>04063         }
<a name="l04064"></a>04064 
<a name="l04065"></a>04065         <a class="code" href="../../d2/d47/compile_8c.html#aa5b45ae61de3350f0830a32589bbb7ee">ADD_INSN</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), pop);
<a name="l04066"></a>04066         <a class="code" href="../../d2/d47/compile_8c.html#a5a380bb449656575d6b77ccb8eb7e5ae">ADD_LABEL</a>(ret, lassign);
<a name="l04067"></a>04067         <a class="code" href="../../d2/d47/compile_8c.html#a0cacd6cfca69df35e1535d2f21532c47">COMPILE</a>(ret, <span class="stringliteral">&quot;NODE_OP_ASGN_AND/OR#nd_value&quot;</span>, node-&gt;nd_value);
<a name="l04068"></a>04068         <a class="code" href="../../d2/d47/compile_8c.html#a5a380bb449656575d6b77ccb8eb7e5ae">ADD_LABEL</a>(ret, lfin);
<a name="l04069"></a>04069 
<a name="l04070"></a>04070         <span class="keywordflow">if</span> (poped) {
<a name="l04071"></a>04071             <span class="comment">/* we can apply more optimize */</span>
<a name="l04072"></a>04072             <a class="code" href="../../d2/d47/compile_8c.html#aa5b45ae61de3350f0830a32589bbb7ee">ADD_INSN</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), pop);
<a name="l04073"></a>04073         }
<a name="l04074"></a>04074         <span class="keywordflow">break</span>;
<a name="l04075"></a>04075       }
<a name="l04076"></a>04076       <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#ae72a414c065eefb25d29b0376ee93e3d">NODE_CALL</a>:
<a name="l04077"></a>04077       <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#a611c4facbf6699e4b795320442ace55f">NODE_FCALL</a>:
<a name="l04078"></a>04078       <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#ae2efc36a65904690f165fda092b0a8b1">NODE_VCALL</a>:{         <span class="comment">/* VCALL: variable or call */</span>
<a name="l04079"></a>04079         <span class="comment">/*</span>
<a name="l04080"></a>04080 <span class="comment">          call:  obj.method(...)</span>
<a name="l04081"></a>04081 <span class="comment">          fcall: func(...)</span>
<a name="l04082"></a>04082 <span class="comment">          vcall: func</span>
<a name="l04083"></a>04083 <span class="comment">        */</span>
<a name="l04084"></a>04084         <a class="code" href="../../d2/d47/compile_8c.html#aa9d6014cec8d3adcb228b81620eac795">DECL_ANCHOR</a>(recv);
<a name="l04085"></a>04085         <a class="code" href="../../d2/d47/compile_8c.html#aa9d6014cec8d3adcb228b81620eac795">DECL_ANCHOR</a>(<a class="code" href="../../d3/d09/ripper_8y.html#a8187411843a6284ffb964ef3fb9fcab3">args</a>);
<a name="l04086"></a>04086         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#afa5b9137f051ac26d7ccc8824f178233">ID</a> mid = node-&gt;nd_mid;
<a name="l04087"></a>04087         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> argc;
<a name="l04088"></a>04088         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> flag = 0;
<a name="l04089"></a>04089         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> parent_block = iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a947d34698fb5a71f4938532fff27a0f7">compile_data</a>-&gt;<a class="code" href="../../d4/dd8/structiseq__compile__data.html#a17663fef55ddb6f51b011bb750ec396e">current_block</a>;
<a name="l04090"></a>04090         iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a947d34698fb5a71f4938532fff27a0f7">compile_data</a>-&gt;<a class="code" href="../../d4/dd8/structiseq__compile__data.html#a17663fef55ddb6f51b011bb750ec396e">current_block</a> = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aba0717d2689eb68797421a02ab9295c6">Qfalse</a>;
<a name="l04091"></a>04091 
<a name="l04092"></a>04092         <a class="code" href="../../d2/d47/compile_8c.html#ac32b1f7d8de8f10f33a147030d8b7544">INIT_ANCHOR</a>(recv);
<a name="l04093"></a>04093         <a class="code" href="../../d2/d47/compile_8c.html#ac32b1f7d8de8f10f33a147030d8b7544">INIT_ANCHOR</a>(<a class="code" href="../../d3/d09/ripper_8y.html#a8187411843a6284ffb964ef3fb9fcab3">args</a>);
<a name="l04094"></a>04094 <span class="preprocessor">#if SUPPORT_JOKE</span>
<a name="l04095"></a>04095 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (<a class="code" href="../../d3/d09/ripper_8y.html#ade12c589b26f55f089dc25d689249c11">nd_type</a>(node) == <a class="code" href="../../d3/d09/ripper_8y.html#ae2efc36a65904690f165fda092b0a8b1">NODE_VCALL</a>) {
<a name="l04096"></a>04096             <span class="keywordflow">if</span> (mid == idBitblt) {
<a name="l04097"></a>04097                 <a class="code" href="../../d2/d47/compile_8c.html#aa5b45ae61de3350f0830a32589bbb7ee">ADD_INSN</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), bitblt);
<a name="l04098"></a>04098                 <span class="keywordflow">break</span>;
<a name="l04099"></a>04099             }
<a name="l04100"></a>04100             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (mid == idAnswer) {
<a name="l04101"></a>04101                 <a class="code" href="../../d2/d47/compile_8c.html#aa5b45ae61de3350f0830a32589bbb7ee">ADD_INSN</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), <a class="code" href="../../de/d32/dir_8c.html#a8c4d9ee8d4f82d724070b97e70b9c4e5">answer</a>);
<a name="l04102"></a>04102                 <span class="keywordflow">break</span>;
<a name="l04103"></a>04103             }
<a name="l04104"></a>04104         }
<a name="l04105"></a>04105         <span class="comment">/* only joke */</span>
<a name="l04106"></a>04106         {
<a name="l04107"></a>04107             <a class="code" href="../../de/de6/ruby_2ruby_8h.html#afa5b9137f051ac26d7ccc8824f178233">ID</a> goto_id;
<a name="l04108"></a>04108             <a class="code" href="../../de/de6/ruby_2ruby_8h.html#afa5b9137f051ac26d7ccc8824f178233">ID</a> label_id;
<a name="l04109"></a>04109 
<a name="l04110"></a>04110             <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aa50b9d5bc665eb5545f6857c89232161">CONST_ID</a>(goto_id, <span class="stringliteral">&quot;__goto__&quot;</span>);
<a name="l04111"></a>04111             <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aa50b9d5bc665eb5545f6857c89232161">CONST_ID</a>(label_id, <span class="stringliteral">&quot;__label__&quot;</span>);
<a name="l04112"></a>04112 
<a name="l04113"></a>04113             <span class="keywordflow">if</span> (<a class="code" href="../../d3/d09/ripper_8y.html#ade12c589b26f55f089dc25d689249c11">nd_type</a>(node) == <a class="code" href="../../d3/d09/ripper_8y.html#a611c4facbf6699e4b795320442ace55f">NODE_FCALL</a> &amp;&amp;
<a name="l04114"></a>04114                 (mid == goto_id || mid == label_id)) {
<a name="l04115"></a>04115                 <a class="code" href="../../d8/dc5/structiseq__label__data.html">LABEL</a> *label;
<a name="l04116"></a>04116                 <a class="code" href="../../de/dce/syck_8h.html#a8a45dfe133c1fd041e1b902bda9e43e8">st_data_t</a> data;
<a name="l04117"></a>04117                 <a class="code" href="../../d0/ddd/structst__table.html">st_table</a> *labels_table = iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a947d34698fb5a71f4938532fff27a0f7">compile_data</a>-&gt;labels_table;
<a name="l04118"></a>04118                 <a class="code" href="../../de/de6/ruby_2ruby_8h.html#afa5b9137f051ac26d7ccc8824f178233">ID</a> label_name;
<a name="l04119"></a>04119 
<a name="l04120"></a>04120                 <span class="keywordflow">if</span> (!labels_table) {
<a name="l04121"></a>04121                     labels_table = <a class="code" href="../../dd/d24/st_8h.html#a955c6e936b9681649ab9ffa4aa741949">st_init_numtable</a>();
<a name="l04122"></a>04122                     iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a947d34698fb5a71f4938532fff27a0f7">compile_data</a>-&gt;labels_table = labels_table;
<a name="l04123"></a>04123                 }
<a name="l04124"></a>04124                 <span class="keywordflow">if</span> (<a class="code" href="../../d3/d09/ripper_8y.html#ade12c589b26f55f089dc25d689249c11">nd_type</a>(node-&gt;nd_args-&gt;nd_head) == <a class="code" href="../../d3/d09/ripper_8y.html#af19d1c1d9f26c7b19546967449e887f6">NODE_LIT</a> &amp;&amp;
<a name="l04125"></a>04125                     <a class="code" href="../../dc/d0c/cparse_8c.html#a637bc5a232034ee3fd411f8bef091566">SYMBOL_P</a>(node-&gt;nd_args-&gt;nd_head-&gt;nd_lit)) {
<a name="l04126"></a>04126 
<a name="l04127"></a>04127                     label_name = <a class="code" href="../../dc/d0c/cparse_8c.html#a73ce5202e6172d3ad0bab7d1e0df9dae">SYM2ID</a>(node-&gt;nd_args-&gt;nd_head-&gt;nd_lit);
<a name="l04128"></a>04128                     <span class="keywordflow">if</span> (!<a class="code" href="../../dd/d24/st_8h.html#a2d85287fbdaf7dcbc22d45e925c29fea">st_lookup</a>(labels_table, (<a class="code" href="../../de/dce/syck_8h.html#a8a45dfe133c1fd041e1b902bda9e43e8">st_data_t</a>)label_name, &amp;data)) {
<a name="l04129"></a>04129                         label = <a class="code" href="../../d2/d47/compile_8c.html#a1d6d5d8dac7aff9ac863255a0905c0f9">NEW_LABEL</a>(<a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node));
<a name="l04130"></a>04130                         label-&gt;<a class="code" href="../../d8/dc5/structiseq__label__data.html#abc4000df6eb58ca5faf57f9ee446b116">position</a> = <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node);
<a name="l04131"></a>04131                         <a class="code" href="../../dd/d24/st_8h.html#acdc42c01229b7537ea5a4c6965c7e47a">st_insert</a>(labels_table, (<a class="code" href="../../de/dce/syck_8h.html#a8a45dfe133c1fd041e1b902bda9e43e8">st_data_t</a>)label_name, (<a class="code" href="../../de/dce/syck_8h.html#a8a45dfe133c1fd041e1b902bda9e43e8">st_data_t</a>)label);
<a name="l04132"></a>04132                     }
<a name="l04133"></a>04133                     <span class="keywordflow">else</span> {
<a name="l04134"></a>04134                         label = (<a class="code" href="../../d8/dc5/structiseq__label__data.html">LABEL</a> *)data;
<a name="l04135"></a>04135                     }
<a name="l04136"></a>04136                 }
<a name="l04137"></a>04137                 <span class="keywordflow">else</span> {
<a name="l04138"></a>04138                     <a class="code" href="../../d2/d47/compile_8c.html#ae84f2851369429ff178e5d2c6eaae309">COMPILE_ERROR</a>((<a class="code" href="../../d2/d47/compile_8c.html#af94c9e3c1e8a00be6cb2ab8851055473">ERROR_ARGS</a> <span class="stringliteral">&quot;invalid goto/label format&quot;</span>));
<a name="l04139"></a>04139                 }
<a name="l04140"></a>04140 
<a name="l04141"></a>04141 
<a name="l04142"></a>04142                 <span class="keywordflow">if</span> (mid == goto_id) {
<a name="l04143"></a>04143                     <a class="code" href="../../d2/d47/compile_8c.html#ace57e2f70722586d3764284364cfb5ad">ADD_INSNL</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), jump, label);
<a name="l04144"></a>04144                 }
<a name="l04145"></a>04145                 <span class="keywordflow">else</span> {
<a name="l04146"></a>04146                     <a class="code" href="../../d2/d47/compile_8c.html#a5a380bb449656575d6b77ccb8eb7e5ae">ADD_LABEL</a>(ret, label);
<a name="l04147"></a>04147                 }
<a name="l04148"></a>04148                 <span class="keywordflow">break</span>;
<a name="l04149"></a>04149             }
<a name="l04150"></a>04150         }
<a name="l04151"></a>04151 <span class="preprocessor">#endif</span>
<a name="l04152"></a>04152 <span class="preprocessor"></span>        <span class="comment">/* receiver */</span>
<a name="l04153"></a>04153         <span class="keywordflow">if</span> (type == <a class="code" href="../../d3/d09/ripper_8y.html#ae72a414c065eefb25d29b0376ee93e3d">NODE_CALL</a>) {
<a name="l04154"></a>04154             <a class="code" href="../../d2/d47/compile_8c.html#a0cacd6cfca69df35e1535d2f21532c47">COMPILE</a>(recv, <span class="stringliteral">&quot;recv&quot;</span>, node-&gt;nd_recv);
<a name="l04155"></a>04155         }
<a name="l04156"></a>04156         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (type == <a class="code" href="../../d3/d09/ripper_8y.html#a611c4facbf6699e4b795320442ace55f">NODE_FCALL</a> || type == <a class="code" href="../../d3/d09/ripper_8y.html#ae2efc36a65904690f165fda092b0a8b1">NODE_VCALL</a>) {
<a name="l04157"></a>04157             <a class="code" href="../../d2/d47/compile_8c.html#a50d9af29f829b84d8d09dbd8a6ccde89">ADD_CALL_RECEIVER</a>(recv, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node));
<a name="l04158"></a>04158         }
<a name="l04159"></a>04159 
<a name="l04160"></a>04160         <span class="comment">/* args */</span>
<a name="l04161"></a>04161         <span class="keywordflow">if</span> (<a class="code" href="../../d3/d09/ripper_8y.html#ade12c589b26f55f089dc25d689249c11">nd_type</a>(node) != <a class="code" href="../../d3/d09/ripper_8y.html#ae2efc36a65904690f165fda092b0a8b1">NODE_VCALL</a>) {
<a name="l04162"></a>04162             argc = <a class="code" href="../../d2/d47/compile_8c.html#ab6ce5708d11d498cf4924186b39820c2">setup_args</a>(iseq, <a class="code" href="../../d3/d09/ripper_8y.html#a8187411843a6284ffb964ef3fb9fcab3">args</a>, node-&gt;nd_args, &amp;flag);
<a name="l04163"></a>04163         }
<a name="l04164"></a>04164         <span class="keywordflow">else</span> {
<a name="l04165"></a>04165             argc = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(0);
<a name="l04166"></a>04166         }
<a name="l04167"></a>04167 
<a name="l04168"></a>04168         <a class="code" href="../../d2/d47/compile_8c.html#afd9d72d069724385c83bcc32d6746b1e">ADD_SEQ</a>(ret, recv);
<a name="l04169"></a>04169         <a class="code" href="../../d2/d47/compile_8c.html#afd9d72d069724385c83bcc32d6746b1e">ADD_SEQ</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a8187411843a6284ffb964ef3fb9fcab3">args</a>);
<a name="l04170"></a>04170 
<a name="l04171"></a>04171         <a class="code" href="../../d2/d47/compile_8c.html#ad983bdc29f9c5bde5ab33d14c3d143e6">debugp_param</a>(<span class="stringliteral">&quot;call args argc&quot;</span>, argc);
<a name="l04172"></a>04172         <a class="code" href="../../d2/d47/compile_8c.html#ad983bdc29f9c5bde5ab33d14c3d143e6">debugp_param</a>(<span class="stringliteral">&quot;call method&quot;</span>, <a class="code" href="../../dc/d0c/cparse_8c.html#a48bfb6519a45249fb2ec0193ea3b6e1c">ID2SYM</a>(mid));
<a name="l04173"></a>04173 
<a name="l04174"></a>04174         <span class="keywordflow">switch</span> (<a class="code" href="../../d3/d09/ripper_8y.html#ade12c589b26f55f089dc25d689249c11">nd_type</a>(node)) {
<a name="l04175"></a>04175           <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#ae2efc36a65904690f165fda092b0a8b1">NODE_VCALL</a>:
<a name="l04176"></a>04176             flag |= <a class="code" href="../../d8/d32/vm__core_8h.html#a969a5cf4465983b4c59e7b3dd01ac817">VM_CALL_VCALL_BIT</a>;
<a name="l04177"></a>04177             <span class="comment">/* VCALL is funcall, so fall through */</span>
<a name="l04178"></a>04178           <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#a611c4facbf6699e4b795320442ace55f">NODE_FCALL</a>:
<a name="l04179"></a>04179             flag |= <a class="code" href="../../d8/d32/vm__core_8h.html#a607d3c76b00f3a7c33fa4b9ba3635e8b">VM_CALL_FCALL_BIT</a>;
<a name="l04180"></a>04180         }
<a name="l04181"></a>04181 
<a name="l04182"></a>04182         <a class="code" href="../../d2/d47/compile_8c.html#a8e30721d838a4a66104bbecb561ef0c9">ADD_SEND_R</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), <a class="code" href="../../dc/d0c/cparse_8c.html#a48bfb6519a45249fb2ec0193ea3b6e1c">ID2SYM</a>(mid),
<a name="l04183"></a>04183                    argc, parent_block, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a2ead2f64c81efed352e79e89f29b8fc8">LONG2FIX</a>(flag));
<a name="l04184"></a>04184 
<a name="l04185"></a>04185         <span class="keywordflow">if</span> (poped) {
<a name="l04186"></a>04186             <a class="code" href="../../d2/d47/compile_8c.html#aa5b45ae61de3350f0830a32589bbb7ee">ADD_INSN</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), pop);
<a name="l04187"></a>04187         }
<a name="l04188"></a>04188         <span class="keywordflow">break</span>;
<a name="l04189"></a>04189       }
<a name="l04190"></a>04190       <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#ab986d79d4c826e86db4b17dd331e7b80">NODE_SUPER</a>:
<a name="l04191"></a>04191       <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#a5966d8a24f1a0b7ab182a430c3f92ccd">NODE_ZSUPER</a>:{
<a name="l04192"></a>04192         <a class="code" href="../../d2/d47/compile_8c.html#aa9d6014cec8d3adcb228b81620eac795">DECL_ANCHOR</a>(<a class="code" href="../../d3/d09/ripper_8y.html#a8187411843a6284ffb964ef3fb9fcab3">args</a>);
<a name="l04193"></a>04193         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> argc;
<a name="l04194"></a>04194         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> flag = 0;
<a name="l04195"></a>04195         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> parent_block = iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a947d34698fb5a71f4938532fff27a0f7">compile_data</a>-&gt;<a class="code" href="../../d4/dd8/structiseq__compile__data.html#a17663fef55ddb6f51b011bb750ec396e">current_block</a>;
<a name="l04196"></a>04196 
<a name="l04197"></a>04197         <a class="code" href="../../d2/d47/compile_8c.html#ac32b1f7d8de8f10f33a147030d8b7544">INIT_ANCHOR</a>(<a class="code" href="../../d3/d09/ripper_8y.html#a8187411843a6284ffb964ef3fb9fcab3">args</a>);
<a name="l04198"></a>04198         iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a947d34698fb5a71f4938532fff27a0f7">compile_data</a>-&gt;<a class="code" href="../../d4/dd8/structiseq__compile__data.html#a17663fef55ddb6f51b011bb750ec396e">current_block</a> = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aba0717d2689eb68797421a02ab9295c6">Qfalse</a>;
<a name="l04199"></a>04199         <span class="keywordflow">if</span> (<a class="code" href="../../d3/d09/ripper_8y.html#ade12c589b26f55f089dc25d689249c11">nd_type</a>(node) == <a class="code" href="../../d3/d09/ripper_8y.html#ab986d79d4c826e86db4b17dd331e7b80">NODE_SUPER</a>) {
<a name="l04200"></a>04200             argc = <a class="code" href="../../d2/d47/compile_8c.html#ab6ce5708d11d498cf4924186b39820c2">setup_args</a>(iseq, <a class="code" href="../../d3/d09/ripper_8y.html#a8187411843a6284ffb964ef3fb9fcab3">args</a>, node-&gt;nd_args, &amp;flag);
<a name="l04201"></a>04201         }
<a name="l04202"></a>04202         <span class="keywordflow">else</span> {
<a name="l04203"></a>04203             <span class="comment">/* NODE_ZSUPER */</span>
<a name="l04204"></a>04204             <span class="keywordtype">int</span> i;
<a name="l04205"></a>04205             <a class="code" href="../../d6/de3/structrb__iseq__struct.html">rb_iseq_t</a> *liseq = iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a0f5705507c4c80bc69c3f031dd0daae9">local_iseq</a>;
<a name="l04206"></a>04206 
<a name="l04207"></a>04207             argc = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(liseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a5fd0acd110681eeb0f95c3b283451a0a" title="argument information">argc</a>);
<a name="l04208"></a>04208 
<a name="l04209"></a>04209             <span class="comment">/* normal arguments */</span>
<a name="l04210"></a>04210             <span class="keywordflow">for</span> (i = 0; i &lt; liseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a5fd0acd110681eeb0f95c3b283451a0a" title="argument information">argc</a>; i++) {
<a name="l04211"></a>04211                 <span class="keywordtype">int</span> idx = liseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#afbae994355f91f3ea547570debb757c0">local_size</a> - i;
<a name="l04212"></a>04212                 <a class="code" href="../../d2/d47/compile_8c.html#a3cfeb7549a1249a8b78f9d6ff1e74c5a">ADD_INSN1</a>(<a class="code" href="../../d3/d09/ripper_8y.html#a8187411843a6284ffb964ef3fb9fcab3">args</a>, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), getlocal, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(idx));
<a name="l04213"></a>04213             }
<a name="l04214"></a>04214 
<a name="l04215"></a>04215             <span class="keywordflow">if</span> (!liseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#ae7f7a6daa388dc65f83c27600cb39b00">arg_simple</a>) {
<a name="l04216"></a>04216                 <span class="keywordflow">if</span> (liseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#ad71990c5fa4c678e369e18bddbaf1639">arg_opts</a>) {
<a name="l04217"></a>04217                     <span class="comment">/* optional arguments */</span>
<a name="l04218"></a>04218                     <span class="keywordtype">int</span> j;
<a name="l04219"></a>04219                     <span class="keywordflow">for</span> (j = 0; j &lt; liseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#ad71990c5fa4c678e369e18bddbaf1639">arg_opts</a> - 1; j++) {
<a name="l04220"></a>04220                         <span class="keywordtype">int</span> idx = liseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#afbae994355f91f3ea547570debb757c0">local_size</a> - (i + j);
<a name="l04221"></a>04221                         <a class="code" href="../../d2/d47/compile_8c.html#a3cfeb7549a1249a8b78f9d6ff1e74c5a">ADD_INSN1</a>(<a class="code" href="../../d3/d09/ripper_8y.html#a8187411843a6284ffb964ef3fb9fcab3">args</a>, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), getlocal, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(idx));
<a name="l04222"></a>04222                     }
<a name="l04223"></a>04223                     i += j;
<a name="l04224"></a>04224                     argc = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(i);
<a name="l04225"></a>04225                 }
<a name="l04226"></a>04226 
<a name="l04227"></a>04227                 <span class="keywordflow">if</span> (liseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a21bd6b9b1c875df9484cc16f8dd9c73e">arg_rest</a> != -1) {
<a name="l04228"></a>04228                     <span class="comment">/* rest argument */</span>
<a name="l04229"></a>04229                     <span class="keywordtype">int</span> idx = liseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#afbae994355f91f3ea547570debb757c0">local_size</a> - liseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a21bd6b9b1c875df9484cc16f8dd9c73e">arg_rest</a>;
<a name="l04230"></a>04230                     <a class="code" href="../../d2/d47/compile_8c.html#a3cfeb7549a1249a8b78f9d6ff1e74c5a">ADD_INSN1</a>(<a class="code" href="../../d3/d09/ripper_8y.html#a8187411843a6284ffb964ef3fb9fcab3">args</a>, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), getlocal, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(idx));
<a name="l04231"></a>04231                     argc = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(liseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a21bd6b9b1c875df9484cc16f8dd9c73e">arg_rest</a> + 1);
<a name="l04232"></a>04232                     flag |= <a class="code" href="../../d8/d32/vm__core_8h.html#a56aad9fa74696d2a86028361323a75a6">VM_CALL_ARGS_SPLAT_BIT</a>;
<a name="l04233"></a>04233                 }
<a name="l04234"></a>04234 
<a name="l04235"></a>04235                 <span class="keywordflow">if</span> (liseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a4915a4238c8e8e7106337e5e1c609576">arg_post_len</a>) {
<a name="l04236"></a>04236                     <span class="comment">/* post arguments */</span>
<a name="l04237"></a>04237                     <span class="keywordtype">int</span> post_len = liseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a4915a4238c8e8e7106337e5e1c609576">arg_post_len</a>;
<a name="l04238"></a>04238                     <span class="keywordtype">int</span> post_start = liseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a6250a263c2402b28f97ae50ef9b4e458">arg_post_start</a>;
<a name="l04239"></a>04239 
<a name="l04240"></a>04240                     <span class="keywordflow">if</span> (liseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a21bd6b9b1c875df9484cc16f8dd9c73e">arg_rest</a> != -1) {
<a name="l04241"></a>04241                         <span class="keywordtype">int</span> j;
<a name="l04242"></a>04242                         <span class="keywordflow">for</span> (j=0; j&lt;post_len; j++) {
<a name="l04243"></a>04243                             <span class="keywordtype">int</span> idx = liseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#afbae994355f91f3ea547570debb757c0">local_size</a> - (post_start + j);
<a name="l04244"></a>04244                             <a class="code" href="../../d2/d47/compile_8c.html#a3cfeb7549a1249a8b78f9d6ff1e74c5a">ADD_INSN1</a>(<a class="code" href="../../d3/d09/ripper_8y.html#a8187411843a6284ffb964ef3fb9fcab3">args</a>, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), getlocal, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(idx));
<a name="l04245"></a>04245                         }
<a name="l04246"></a>04246                         <a class="code" href="../../d2/d47/compile_8c.html#a3cfeb7549a1249a8b78f9d6ff1e74c5a">ADD_INSN1</a>(<a class="code" href="../../d3/d09/ripper_8y.html#a8187411843a6284ffb964ef3fb9fcab3">args</a>, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), newarray, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(j));
<a name="l04247"></a>04247                         <a class="code" href="../../d2/d47/compile_8c.html#aa5b45ae61de3350f0830a32589bbb7ee">ADD_INSN</a> (<a class="code" href="../../d3/d09/ripper_8y.html#a8187411843a6284ffb964ef3fb9fcab3">args</a>, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), concatarray);
<a name="l04248"></a>04248                         <span class="comment">/* argc is setteled at above */</span>
<a name="l04249"></a>04249                     }
<a name="l04250"></a>04250                     <span class="keywordflow">else</span> {
<a name="l04251"></a>04251                         <span class="keywordtype">int</span> j;
<a name="l04252"></a>04252                         <span class="keywordflow">for</span> (j=0; j&lt;post_len; j++) {
<a name="l04253"></a>04253                             <span class="keywordtype">int</span> idx = liseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#afbae994355f91f3ea547570debb757c0">local_size</a> - (post_start + j);
<a name="l04254"></a>04254                             <a class="code" href="../../d2/d47/compile_8c.html#a3cfeb7549a1249a8b78f9d6ff1e74c5a">ADD_INSN1</a>(<a class="code" href="../../d3/d09/ripper_8y.html#a8187411843a6284ffb964ef3fb9fcab3">args</a>, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), getlocal, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(idx));
<a name="l04255"></a>04255                         }
<a name="l04256"></a>04256                         argc = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(post_len + post_start);
<a name="l04257"></a>04257                     }
<a name="l04258"></a>04258                 }
<a name="l04259"></a>04259             }
<a name="l04260"></a>04260         }
<a name="l04261"></a>04261 
<a name="l04262"></a>04262         <span class="comment">/* dummy receiver */</span>
<a name="l04263"></a>04263         <a class="code" href="../../d2/d47/compile_8c.html#a3cfeb7549a1249a8b78f9d6ff1e74c5a">ADD_INSN1</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), putobject,
<a name="l04264"></a>04264                   <a class="code" href="../../d3/d09/ripper_8y.html#ade12c589b26f55f089dc25d689249c11">nd_type</a>(node) == <a class="code" href="../../d3/d09/ripper_8y.html#a5966d8a24f1a0b7ab182a430c3f92ccd">NODE_ZSUPER</a> ? <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aba0717d2689eb68797421a02ab9295c6">Qfalse</a> : <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aacea3516b33941ce8149098e223a7466">Qtrue</a>);
<a name="l04265"></a>04265         <a class="code" href="../../d2/d47/compile_8c.html#afd9d72d069724385c83bcc32d6746b1e">ADD_SEQ</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a8187411843a6284ffb964ef3fb9fcab3">args</a>);
<a name="l04266"></a>04266         <a class="code" href="../../d2/d47/compile_8c.html#af8e927ae02d27d3a3934dcc65a2d21c9">ADD_INSN3</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), invokesuper,
<a name="l04267"></a>04267                   argc, parent_block, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a2ead2f64c81efed352e79e89f29b8fc8">LONG2FIX</a>(flag));
<a name="l04268"></a>04268 
<a name="l04269"></a>04269         <span class="keywordflow">if</span> (poped) {
<a name="l04270"></a>04270             <a class="code" href="../../d2/d47/compile_8c.html#aa5b45ae61de3350f0830a32589bbb7ee">ADD_INSN</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), pop);
<a name="l04271"></a>04271         }
<a name="l04272"></a>04272         <span class="keywordflow">break</span>;
<a name="l04273"></a>04273       }
<a name="l04274"></a>04274       <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#a490d1fc6f7f9e81a1815e9b1c3080d94">NODE_ARRAY</a>:{
<a name="l04275"></a>04275         <a class="code" href="../../d2/d47/compile_8c.html#ab151d20b137ab6de8217e03665a5d1da">compile_array_</a>(iseq, ret, node, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aacea3516b33941ce8149098e223a7466">Qtrue</a>, poped);
<a name="l04276"></a>04276         <span class="keywordflow">break</span>;
<a name="l04277"></a>04277       }
<a name="l04278"></a>04278       <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#acb7153a88fb24c846bd6751ca2fa9316">NODE_ZARRAY</a>:{
<a name="l04279"></a>04279         <span class="keywordflow">if</span> (!poped) {
<a name="l04280"></a>04280             <a class="code" href="../../d2/d47/compile_8c.html#a3cfeb7549a1249a8b78f9d6ff1e74c5a">ADD_INSN1</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), newarray, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(0));
<a name="l04281"></a>04281         }
<a name="l04282"></a>04282         <span class="keywordflow">break</span>;
<a name="l04283"></a>04283       }
<a name="l04284"></a>04284       <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#a5d6b8dc54e03236c06b5092e4c5d5b07">NODE_VALUES</a>:{
<a name="l04285"></a>04285         NODE *n = node;
<a name="l04286"></a>04286         <span class="keywordflow">while</span> (n) {
<a name="l04287"></a>04287             <a class="code" href="../../d2/d47/compile_8c.html#a0cacd6cfca69df35e1535d2f21532c47">COMPILE</a>(ret, <span class="stringliteral">&quot;values item&quot;</span>, n-&gt;nd_head);
<a name="l04288"></a>04288             n = n-&gt;nd_next;
<a name="l04289"></a>04289         }
<a name="l04290"></a>04290         <a class="code" href="../../d2/d47/compile_8c.html#a3cfeb7549a1249a8b78f9d6ff1e74c5a">ADD_INSN1</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), newarray, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(node-&gt;nd_alen));
<a name="l04291"></a>04291         <span class="keywordflow">if</span> (poped) {
<a name="l04292"></a>04292             <a class="code" href="../../d2/d47/compile_8c.html#aa5b45ae61de3350f0830a32589bbb7ee">ADD_INSN</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), pop);
<a name="l04293"></a>04293         }
<a name="l04294"></a>04294         <span class="keywordflow">break</span>;
<a name="l04295"></a>04295       }
<a name="l04296"></a>04296       <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#a9e0e908fdac1fc1cfcfba007f8ab1f6b">NODE_HASH</a>:{
<a name="l04297"></a>04297         <a class="code" href="../../d2/d47/compile_8c.html#aa9d6014cec8d3adcb228b81620eac795">DECL_ANCHOR</a>(list);
<a name="l04298"></a>04298         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> size = 0;
<a name="l04299"></a>04299         <span class="keywordtype">int</span> type = node-&gt;nd_head ? <a class="code" href="../../d3/d09/ripper_8y.html#ade12c589b26f55f089dc25d689249c11">nd_type</a>(node-&gt;nd_head) : <a class="code" href="../../d3/d09/ripper_8y.html#acb7153a88fb24c846bd6751ca2fa9316">NODE_ZARRAY</a>;
<a name="l04300"></a>04300 
<a name="l04301"></a>04301         <a class="code" href="../../d2/d47/compile_8c.html#ac32b1f7d8de8f10f33a147030d8b7544">INIT_ANCHOR</a>(list);
<a name="l04302"></a>04302         <span class="keywordflow">switch</span> (type) {
<a name="l04303"></a>04303           <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#a490d1fc6f7f9e81a1815e9b1c3080d94">NODE_ARRAY</a>:{
<a name="l04304"></a>04304             <a class="code" href="../../d2/d47/compile_8c.html#a8972c4295ae6e3b0a8eb9fa97586b425">compile_array</a>(iseq, list, node-&gt;nd_head, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aba0717d2689eb68797421a02ab9295c6">Qfalse</a>);
<a name="l04305"></a>04305             size = <a class="code" href="../../d2/d47/compile_8c.html#accd7d8e5aae40bb4eecd61fb8d6c65cc">OPERAND_AT</a>(<a class="code" href="../../d2/d47/compile_8c.html#a56c34aaed1ac9f929e9f73c680fb32c3">POP_ELEMENT</a>(list), 0);
<a name="l04306"></a>04306             <a class="code" href="../../d2/d47/compile_8c.html#afd9d72d069724385c83bcc32d6746b1e">ADD_SEQ</a>(ret, list);
<a name="l04307"></a>04307             <span class="keywordflow">break</span>;
<a name="l04308"></a>04308           }
<a name="l04309"></a>04309           <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#acb7153a88fb24c846bd6751ca2fa9316">NODE_ZARRAY</a>:
<a name="l04310"></a>04310             size = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(0);
<a name="l04311"></a>04311             <span class="keywordflow">break</span>;
<a name="l04312"></a>04312 
<a name="l04313"></a>04313           <span class="keywordflow">default</span>:
<a name="l04314"></a>04314             <a class="code" href="../../db/dcc/error_8c.html#a2d5fb28e54f792e7341b2c45f52f3860">rb_bug</a>(<span class="stringliteral">&quot;can&apos;t make hash with this node: %s&quot;</span>, <a class="code" href="../../dd/d74/iseq_8c.html#a818834c71f4a58f5bd7f0aa142d1b069">ruby_node_name</a>(type));
<a name="l04315"></a>04315         }
<a name="l04316"></a>04316 
<a name="l04317"></a>04317         <a class="code" href="../../d2/d47/compile_8c.html#a3cfeb7549a1249a8b78f9d6ff1e74c5a">ADD_INSN1</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), newhash, size);
<a name="l04318"></a>04318 
<a name="l04319"></a>04319         <span class="keywordflow">if</span> (poped) {
<a name="l04320"></a>04320             <a class="code" href="../../d2/d47/compile_8c.html#aa5b45ae61de3350f0830a32589bbb7ee">ADD_INSN</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), pop);
<a name="l04321"></a>04321         }
<a name="l04322"></a>04322         <span class="keywordflow">break</span>;
<a name="l04323"></a>04323       }
<a name="l04324"></a>04324       <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#a0740a4cb8cfb60e24ac741779344739b">NODE_RETURN</a>:{
<a name="l04325"></a>04325         <a class="code" href="../../d6/de3/structrb__iseq__struct.html">rb_iseq_t</a> *is = iseq;
<a name="l04326"></a>04326 
<a name="l04327"></a>04327         <span class="keywordflow">if</span> (is) {
<a name="l04328"></a>04328             <span class="keywordflow">if</span> (is-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#af8bc7dbae6f61d836b5bb9fb50b6cfb8">type</a> == ISEQ_TYPE_TOP) {
<a name="l04329"></a>04329                 <a class="code" href="../../d2/d47/compile_8c.html#ae84f2851369429ff178e5d2c6eaae309">COMPILE_ERROR</a>((<a class="code" href="../../d2/d47/compile_8c.html#af94c9e3c1e8a00be6cb2ab8851055473">ERROR_ARGS</a> <span class="stringliteral">&quot;Invalid return&quot;</span>));
<a name="l04330"></a>04330             }
<a name="l04331"></a>04331             <span class="keywordflow">else</span> {
<a name="l04332"></a>04332                 <a class="code" href="../../d8/dc5/structiseq__label__data.html">LABEL</a> *splabel = 0;
<a name="l04333"></a>04333 
<a name="l04334"></a>04334                 <span class="keywordflow">if</span> (is-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#af8bc7dbae6f61d836b5bb9fb50b6cfb8">type</a> == ISEQ_TYPE_METHOD) {
<a name="l04335"></a>04335                     splabel = <a class="code" href="../../d2/d47/compile_8c.html#a1d6d5d8dac7aff9ac863255a0905c0f9">NEW_LABEL</a>(0);
<a name="l04336"></a>04336                     <a class="code" href="../../d2/d47/compile_8c.html#a5a380bb449656575d6b77ccb8eb7e5ae">ADD_LABEL</a>(ret, splabel);
<a name="l04337"></a>04337                     <a class="code" href="../../d2/d47/compile_8c.html#a8b64a8adfda023035ad3a2cf77040fb6">ADD_ADJUST</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), 0);
<a name="l04338"></a>04338                 }
<a name="l04339"></a>04339 
<a name="l04340"></a>04340                 <a class="code" href="../../d2/d47/compile_8c.html#a0cacd6cfca69df35e1535d2f21532c47">COMPILE</a>(ret, <span class="stringliteral">&quot;return nd_stts (return val)&quot;</span>, node-&gt;nd_stts);
<a name="l04341"></a>04341 
<a name="l04342"></a>04342                 <span class="keywordflow">if</span> (is-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#af8bc7dbae6f61d836b5bb9fb50b6cfb8">type</a> == ISEQ_TYPE_METHOD) {
<a name="l04343"></a>04343                     <a class="code" href="../../d2/d47/compile_8c.html#ae12d5b1df0097ff6f114e576543985c7">add_ensure_iseq</a>(ret, iseq, 1);
<a name="l04344"></a>04344                     <a class="code" href="../../d2/d47/compile_8c.html#a1da9ded6df71178c67dd7252e3c64ea1">ADD_TRACE</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aa6ebd81993faad84c09b5080e1fde73d">RUBY_EVENT_RETURN</a>);
<a name="l04345"></a>04345                     <a class="code" href="../../d2/d47/compile_8c.html#aa5b45ae61de3350f0830a32589bbb7ee">ADD_INSN</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), leave);
<a name="l04346"></a>04346                     <a class="code" href="../../d2/d47/compile_8c.html#ad4c05d22ae467c4287c7aa617c4a66d6">ADD_ADJUST_RESTORE</a>(ret, splabel);
<a name="l04347"></a>04347 
<a name="l04348"></a>04348                     <span class="keywordflow">if</span> (!poped) {
<a name="l04349"></a>04349                         <a class="code" href="../../d2/d47/compile_8c.html#aa5b45ae61de3350f0830a32589bbb7ee">ADD_INSN</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), putnil);
<a name="l04350"></a>04350                     }
<a name="l04351"></a>04351                 }
<a name="l04352"></a>04352                 <span class="keywordflow">else</span> {
<a name="l04353"></a>04353                     <a class="code" href="../../d2/d47/compile_8c.html#a3cfeb7549a1249a8b78f9d6ff1e74c5a">ADD_INSN1</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), <span class="keywordflow">throw</span>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(0x01) <span class="comment">/* TAG_RETURN */</span> );
<a name="l04354"></a>04354                     <span class="keywordflow">if</span> (poped) {
<a name="l04355"></a>04355                         <a class="code" href="../../d2/d47/compile_8c.html#aa5b45ae61de3350f0830a32589bbb7ee">ADD_INSN</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), pop);
<a name="l04356"></a>04356                     }
<a name="l04357"></a>04357                 }
<a name="l04358"></a>04358             }
<a name="l04359"></a>04359         }
<a name="l04360"></a>04360         <span class="keywordflow">break</span>;
<a name="l04361"></a>04361       }
<a name="l04362"></a>04362       <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#a210571fb93e1d6ca4c50d6e897cd1d60">NODE_YIELD</a>:{
<a name="l04363"></a>04363         <a class="code" href="../../d2/d47/compile_8c.html#aa9d6014cec8d3adcb228b81620eac795">DECL_ANCHOR</a>(<a class="code" href="../../d3/d09/ripper_8y.html#a8187411843a6284ffb964ef3fb9fcab3">args</a>);
<a name="l04364"></a>04364         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> argc;
<a name="l04365"></a>04365         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> flag = 0;
<a name="l04366"></a>04366 
<a name="l04367"></a>04367         <a class="code" href="../../d2/d47/compile_8c.html#ac32b1f7d8de8f10f33a147030d8b7544">INIT_ANCHOR</a>(<a class="code" href="../../d3/d09/ripper_8y.html#a8187411843a6284ffb964ef3fb9fcab3">args</a>);
<a name="l04368"></a>04368         <span class="keywordflow">if</span> (iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#af8bc7dbae6f61d836b5bb9fb50b6cfb8">type</a> == ISEQ_TYPE_TOP) {
<a name="l04369"></a>04369             <a class="code" href="../../d2/d47/compile_8c.html#ae84f2851369429ff178e5d2c6eaae309">COMPILE_ERROR</a>((<a class="code" href="../../d2/d47/compile_8c.html#af94c9e3c1e8a00be6cb2ab8851055473">ERROR_ARGS</a> <span class="stringliteral">&quot;Invalid yield&quot;</span>));
<a name="l04370"></a>04370         }
<a name="l04371"></a>04371 
<a name="l04372"></a>04372         <span class="keywordflow">if</span> (node-&gt;nd_head) {
<a name="l04373"></a>04373             argc = <a class="code" href="../../d2/d47/compile_8c.html#ab6ce5708d11d498cf4924186b39820c2">setup_args</a>(iseq, <a class="code" href="../../d3/d09/ripper_8y.html#a8187411843a6284ffb964ef3fb9fcab3">args</a>, node-&gt;nd_head, &amp;flag);
<a name="l04374"></a>04374         }
<a name="l04375"></a>04375         <span class="keywordflow">else</span> {
<a name="l04376"></a>04376             argc = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(0);
<a name="l04377"></a>04377         }
<a name="l04378"></a>04378 
<a name="l04379"></a>04379         <a class="code" href="../../d2/d47/compile_8c.html#afd9d72d069724385c83bcc32d6746b1e">ADD_SEQ</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a8187411843a6284ffb964ef3fb9fcab3">args</a>);
<a name="l04380"></a>04380         <a class="code" href="../../d2/d47/compile_8c.html#a9e17ccfd8b31ec3afcb91be39a6d453f">ADD_INSN2</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), invokeblock, argc, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a2ead2f64c81efed352e79e89f29b8fc8">LONG2FIX</a>(flag));
<a name="l04381"></a>04381 
<a name="l04382"></a>04382         <span class="keywordflow">if</span> (poped) {
<a name="l04383"></a>04383             <a class="code" href="../../d2/d47/compile_8c.html#aa5b45ae61de3350f0830a32589bbb7ee">ADD_INSN</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), pop);
<a name="l04384"></a>04384         }
<a name="l04385"></a>04385         <span class="keywordflow">break</span>;
<a name="l04386"></a>04386       }
<a name="l04387"></a>04387       <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#aeb55bab156cfba6fcec9991e963bce3c">NODE_LVAR</a>:{
<a name="l04388"></a>04388         <span class="keywordflow">if</span> (!poped) {
<a name="l04389"></a>04389             <a class="code" href="../../de/de6/ruby_2ruby_8h.html#afa5b9137f051ac26d7ccc8824f178233">ID</a> <span class="keywordtype">id</span> = node-&gt;nd_vid;
<a name="l04390"></a>04390             <span class="keywordtype">int</span> idx = iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a0f5705507c4c80bc69c3f031dd0daae9">local_iseq</a>-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#afbae994355f91f3ea547570debb757c0">local_size</a> - <a class="code" href="../../d2/d47/compile_8c.html#a96a61ad19fe487bd51c13a2a4b151994">get_local_var_idx</a>(iseq, <span class="keywordtype">id</span>);
<a name="l04391"></a>04391 
<a name="l04392"></a>04392             <a class="code" href="../../d2/d47/compile_8c.html#a72ae3dfc8896ca7c87ed2aed1810db43">debugs</a>(<span class="stringliteral">&quot;id: %s idx: %d\n&quot;</span>, <a class="code" href="../../d5/d11/ripper_8c.html#a877bc58c495643fcf49dc64c44631e72">rb_id2name</a>(<span class="keywordtype">id</span>), idx);
<a name="l04393"></a>04393             <a class="code" href="../../d2/d47/compile_8c.html#a3cfeb7549a1249a8b78f9d6ff1e74c5a">ADD_INSN1</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), getlocal, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(idx));
<a name="l04394"></a>04394         }
<a name="l04395"></a>04395         <span class="keywordflow">break</span>;
<a name="l04396"></a>04396       }
<a name="l04397"></a>04397       <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#af01a3b936fc2a83332b8314ef6b00697">NODE_DVAR</a>:{
<a name="l04398"></a>04398         <span class="keywordtype">int</span> lv, idx, ls;
<a name="l04399"></a>04399         <a class="code" href="../../d2/d47/compile_8c.html#a9156fef334af9c349bedf159ff008bb4">debugi</a>(<span class="stringliteral">&quot;nd_vid&quot;</span>, node-&gt;nd_vid);
<a name="l04400"></a>04400         <span class="keywordflow">if</span> (!poped) {
<a name="l04401"></a>04401             idx = <a class="code" href="../../d2/d47/compile_8c.html#a0bdb81b7c6cece8636831256b2f5acef">get_dyna_var_idx</a>(iseq, node-&gt;nd_vid, &amp;lv, &amp;ls);
<a name="l04402"></a>04402             <span class="keywordflow">if</span> (idx &lt; 0) {
<a name="l04403"></a>04403                 <a class="code" href="../../db/dcc/error_8c.html#a2d5fb28e54f792e7341b2c45f52f3860">rb_bug</a>(<span class="stringliteral">&quot;unknown dvar (%s)&quot;</span>, <a class="code" href="../../d5/d11/ripper_8c.html#a877bc58c495643fcf49dc64c44631e72">rb_id2name</a>(node-&gt;nd_vid));
<a name="l04404"></a>04404             }
<a name="l04405"></a>04405             <a class="code" href="../../d2/d47/compile_8c.html#a9e17ccfd8b31ec3afcb91be39a6d453f">ADD_INSN2</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), getdynamic, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(ls - idx), <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(lv));
<a name="l04406"></a>04406         }
<a name="l04407"></a>04407         <span class="keywordflow">break</span>;
<a name="l04408"></a>04408       }
<a name="l04409"></a>04409       <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#a19a08624c33d66f2ef3cfb66af6d9d9f">NODE_GVAR</a>:{
<a name="l04410"></a>04410         <a class="code" href="../../d2/d47/compile_8c.html#a3cfeb7549a1249a8b78f9d6ff1e74c5a">ADD_INSN1</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), getglobal,
<a name="l04411"></a>04411                   ((<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>)node-&gt;nd_entry | 1));
<a name="l04412"></a>04412         <span class="keywordflow">if</span> (poped) {
<a name="l04413"></a>04413             <a class="code" href="../../d2/d47/compile_8c.html#aa5b45ae61de3350f0830a32589bbb7ee">ADD_INSN</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), pop);
<a name="l04414"></a>04414         }
<a name="l04415"></a>04415         <span class="keywordflow">break</span>;
<a name="l04416"></a>04416       }
<a name="l04417"></a>04417       <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#a64cab035c0744c9f375bdf575e0cac2f">NODE_IVAR</a>:{
<a name="l04418"></a>04418         <a class="code" href="../../d2/d47/compile_8c.html#a9156fef334af9c349bedf159ff008bb4">debugi</a>(<span class="stringliteral">&quot;nd_vid&quot;</span>, node-&gt;nd_vid);
<a name="l04419"></a>04419         <span class="keywordflow">if</span> (!poped) {
<a name="l04420"></a>04420             <a class="code" href="../../d2/d47/compile_8c.html#a9e17ccfd8b31ec3afcb91be39a6d453f">ADD_INSN2</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), getinstancevariable,
<a name="l04421"></a>04421                       <a class="code" href="../../dc/d0c/cparse_8c.html#a48bfb6519a45249fb2ec0193ea3b6e1c">ID2SYM</a>(node-&gt;nd_vid), <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a72aee3eed9e9842166e381972a35e9fb">ic_size</a>++));
<a name="l04422"></a>04422         }
<a name="l04423"></a>04423         <span class="keywordflow">break</span>;
<a name="l04424"></a>04424       }
<a name="l04425"></a>04425       <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#a4162517fa8cb8e9bc4b9d9f6e8c32692">NODE_CONST</a>:{
<a name="l04426"></a>04426         <a class="code" href="../../d2/d47/compile_8c.html#a9156fef334af9c349bedf159ff008bb4">debugi</a>(<span class="stringliteral">&quot;nd_vid&quot;</span>, node-&gt;nd_vid);
<a name="l04427"></a>04427 
<a name="l04428"></a>04428         <span class="keywordflow">if</span> (iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a947d34698fb5a71f4938532fff27a0f7">compile_data</a>-&gt;<a class="code" href="../../d4/dd8/structiseq__compile__data.html#a3cde0c1bfeea6f8a80027a9e21a9759a">option</a>-&gt;<a class="code" href="../../db/dc1/structrb__compile__option__struct.html#a22c6ceaf348e1323e7c11afc0ac1201b">inline_const_cache</a>) {
<a name="l04429"></a>04429             <a class="code" href="../../d8/dc5/structiseq__label__data.html">LABEL</a> *lend = <a class="code" href="../../d2/d47/compile_8c.html#a1d6d5d8dac7aff9ac863255a0905c0f9">NEW_LABEL</a>(<a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node));
<a name="l04430"></a>04430             <span class="keywordtype">int</span> ic_index = iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a72aee3eed9e9842166e381972a35e9fb">ic_size</a>++;
<a name="l04431"></a>04431 
<a name="l04432"></a>04432             <a class="code" href="../../d2/d47/compile_8c.html#a9e17ccfd8b31ec3afcb91be39a6d453f">ADD_INSN2</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), getinlinecache, lend, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(ic_index));
<a name="l04433"></a>04433             <a class="code" href="../../d2/d47/compile_8c.html#a3cfeb7549a1249a8b78f9d6ff1e74c5a">ADD_INSN1</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), getconstant, <a class="code" href="../../dc/d0c/cparse_8c.html#a48bfb6519a45249fb2ec0193ea3b6e1c">ID2SYM</a>(node-&gt;nd_vid));
<a name="l04434"></a>04434             <a class="code" href="../../d2/d47/compile_8c.html#a3cfeb7549a1249a8b78f9d6ff1e74c5a">ADD_INSN1</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), setinlinecache, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(ic_index));
<a name="l04435"></a>04435             <a class="code" href="../../d2/d47/compile_8c.html#a5a380bb449656575d6b77ccb8eb7e5ae">ADD_LABEL</a>(ret, lend);
<a name="l04436"></a>04436         }
<a name="l04437"></a>04437         <span class="keywordflow">else</span> {
<a name="l04438"></a>04438             <a class="code" href="../../d2/d47/compile_8c.html#aa5b45ae61de3350f0830a32589bbb7ee">ADD_INSN</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), putnil);
<a name="l04439"></a>04439             <a class="code" href="../../d2/d47/compile_8c.html#a3cfeb7549a1249a8b78f9d6ff1e74c5a">ADD_INSN1</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), getconstant, <a class="code" href="../../dc/d0c/cparse_8c.html#a48bfb6519a45249fb2ec0193ea3b6e1c">ID2SYM</a>(node-&gt;nd_vid));
<a name="l04440"></a>04440         }
<a name="l04441"></a>04441 
<a name="l04442"></a>04442         <span class="keywordflow">if</span> (poped) {
<a name="l04443"></a>04443             <a class="code" href="../../d2/d47/compile_8c.html#aa5b45ae61de3350f0830a32589bbb7ee">ADD_INSN</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), pop);
<a name="l04444"></a>04444         }
<a name="l04445"></a>04445         <span class="keywordflow">break</span>;
<a name="l04446"></a>04446       }
<a name="l04447"></a>04447       <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#accf6c145831fd42cf9d6c816498ec82b">NODE_CVAR</a>:{
<a name="l04448"></a>04448         <span class="keywordflow">if</span> (!poped) {
<a name="l04449"></a>04449             <a class="code" href="../../d2/d47/compile_8c.html#a3cfeb7549a1249a8b78f9d6ff1e74c5a">ADD_INSN1</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), getclassvariable,
<a name="l04450"></a>04450                       <a class="code" href="../../dc/d0c/cparse_8c.html#a48bfb6519a45249fb2ec0193ea3b6e1c">ID2SYM</a>(node-&gt;nd_vid));
<a name="l04451"></a>04451         }
<a name="l04452"></a>04452         <span class="keywordflow">break</span>;
<a name="l04453"></a>04453       }
<a name="l04454"></a>04454       <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#a3ea55c01c2adc06cf9da2a42925ccf03">NODE_NTH_REF</a>:{
<a name="l04455"></a>04455         <span class="keywordflow">if</span> (!poped) {
<a name="l04456"></a>04456             <a class="code" href="../../d2/d47/compile_8c.html#a9e17ccfd8b31ec3afcb91be39a6d453f">ADD_INSN2</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), getspecial, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(1) <span class="comment">/* &apos;~&apos;  */</span>,
<a name="l04457"></a>04457                       <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(node-&gt;nd_nth &lt;&lt; 1));
<a name="l04458"></a>04458         }
<a name="l04459"></a>04459         <span class="keywordflow">break</span>;
<a name="l04460"></a>04460       }
<a name="l04461"></a>04461       <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#a276fc132dec9ae10a63bf430e66a1064">NODE_BACK_REF</a>:{
<a name="l04462"></a>04462         <span class="keywordflow">if</span> (!poped) {
<a name="l04463"></a>04463             <a class="code" href="../../d2/d47/compile_8c.html#a9e17ccfd8b31ec3afcb91be39a6d453f">ADD_INSN2</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), getspecial, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(1) <span class="comment">/* &apos;~&apos; */</span>,
<a name="l04464"></a>04464                       <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(0x01 | (node-&gt;nd_nth &lt;&lt; 1)));
<a name="l04465"></a>04465         }
<a name="l04466"></a>04466         <span class="keywordflow">break</span>;
<a name="l04467"></a>04467       }
<a name="l04468"></a>04468       <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#a4621f705bd2dfef90360d8d333d52015">NODE_MATCH</a>:
<a name="l04469"></a>04469       <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#ada6ce553369f37deef93f9019262450a">NODE_MATCH2</a>:
<a name="l04470"></a>04470       <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#af18fb86fc2079d7f21c0e918001865cd">NODE_MATCH3</a>:{
<a name="l04471"></a>04471         <a class="code" href="../../d2/d47/compile_8c.html#aa9d6014cec8d3adcb228b81620eac795">DECL_ANCHOR</a>(recv);
<a name="l04472"></a>04472         <a class="code" href="../../d2/d47/compile_8c.html#aa9d6014cec8d3adcb228b81620eac795">DECL_ANCHOR</a>(val);
<a name="l04473"></a>04473 
<a name="l04474"></a>04474         <a class="code" href="../../d2/d47/compile_8c.html#ac32b1f7d8de8f10f33a147030d8b7544">INIT_ANCHOR</a>(recv);
<a name="l04475"></a>04475         <a class="code" href="../../d2/d47/compile_8c.html#ac32b1f7d8de8f10f33a147030d8b7544">INIT_ANCHOR</a>(val);
<a name="l04476"></a>04476         <span class="keywordflow">switch</span>(<a class="code" href="../../d3/d09/ripper_8y.html#ade12c589b26f55f089dc25d689249c11">nd_type</a>(node)) {
<a name="l04477"></a>04477           <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#a4621f705bd2dfef90360d8d333d52015">NODE_MATCH</a>:
<a name="l04478"></a>04478             <a class="code" href="../../d2/d47/compile_8c.html#a3cfeb7549a1249a8b78f9d6ff1e74c5a">ADD_INSN1</a>(recv, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), putobject, node-&gt;nd_lit);
<a name="l04479"></a>04479             <a class="code" href="../../d2/d47/compile_8c.html#a9e17ccfd8b31ec3afcb91be39a6d453f">ADD_INSN2</a>(val, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), getspecial, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(0),
<a name="l04480"></a>04480                       <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(0));
<a name="l04481"></a>04481             <span class="keywordflow">break</span>;
<a name="l04482"></a>04482           <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#ada6ce553369f37deef93f9019262450a">NODE_MATCH2</a>:
<a name="l04483"></a>04483             <a class="code" href="../../d2/d47/compile_8c.html#a0cacd6cfca69df35e1535d2f21532c47">COMPILE</a>(recv, <span class="stringliteral">&quot;receiver&quot;</span>, node-&gt;nd_recv);
<a name="l04484"></a>04484             <a class="code" href="../../d2/d47/compile_8c.html#a0cacd6cfca69df35e1535d2f21532c47">COMPILE</a>(val, <span class="stringliteral">&quot;value&quot;</span>, node-&gt;nd_value);
<a name="l04485"></a>04485             <span class="keywordflow">break</span>;
<a name="l04486"></a>04486           <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#af18fb86fc2079d7f21c0e918001865cd">NODE_MATCH3</a>:
<a name="l04487"></a>04487             <a class="code" href="../../d2/d47/compile_8c.html#a0cacd6cfca69df35e1535d2f21532c47">COMPILE</a>(recv, <span class="stringliteral">&quot;receiver&quot;</span>, node-&gt;nd_value);
<a name="l04488"></a>04488             <a class="code" href="../../d2/d47/compile_8c.html#a0cacd6cfca69df35e1535d2f21532c47">COMPILE</a>(val, <span class="stringliteral">&quot;value&quot;</span>, node-&gt;nd_recv);
<a name="l04489"></a>04489             <span class="keywordflow">break</span>;
<a name="l04490"></a>04490         }
<a name="l04491"></a>04491 
<a name="l04492"></a>04492         <span class="keywordflow">if</span> (iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a947d34698fb5a71f4938532fff27a0f7">compile_data</a>-&gt;<a class="code" href="../../d4/dd8/structiseq__compile__data.html#a3cde0c1bfeea6f8a80027a9e21a9759a">option</a>-&gt;<a class="code" href="../../db/dc1/structrb__compile__option__struct.html#a3b19a485a844d38253d438596e145089">specialized_instruction</a>) {
<a name="l04493"></a>04493             <span class="comment">/* TODO: detect by node */</span>
<a name="l04494"></a>04494             <span class="keywordflow">if</span> (recv-&gt;last == recv-&gt;anchor.next &amp;&amp;
<a name="l04495"></a>04495                 <a class="code" href="../../d2/d47/compile_8c.html#ac515317ffa886c9ac546e8f8f86e23cf">INSN_OF</a>(recv-&gt;last) == BIN(putobject) &amp;&amp;
<a name="l04496"></a>04496                 <a class="code" href="../../d3/d09/ripper_8y.html#ade12c589b26f55f089dc25d689249c11">nd_type</a>(node) == <a class="code" href="../../d3/d09/ripper_8y.html#ada6ce553369f37deef93f9019262450a">NODE_MATCH2</a>) {
<a name="l04497"></a>04497                 <a class="code" href="../../d2/d47/compile_8c.html#afd9d72d069724385c83bcc32d6746b1e">ADD_SEQ</a>(ret, val);
<a name="l04498"></a>04498                 <a class="code" href="../../d2/d47/compile_8c.html#a3cfeb7549a1249a8b78f9d6ff1e74c5a">ADD_INSN1</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), opt_regexpmatch1,
<a name="l04499"></a>04499                           <a class="code" href="../../d2/d47/compile_8c.html#accd7d8e5aae40bb4eecd61fb8d6c65cc">OPERAND_AT</a>(recv-&gt;last, 0));
<a name="l04500"></a>04500             }
<a name="l04501"></a>04501             <span class="keywordflow">else</span> {
<a name="l04502"></a>04502                 <a class="code" href="../../d2/d47/compile_8c.html#afd9d72d069724385c83bcc32d6746b1e">ADD_SEQ</a>(ret, recv);
<a name="l04503"></a>04503                 <a class="code" href="../../d2/d47/compile_8c.html#afd9d72d069724385c83bcc32d6746b1e">ADD_SEQ</a>(ret, val);
<a name="l04504"></a>04504                 <a class="code" href="../../d2/d47/compile_8c.html#aa5b45ae61de3350f0830a32589bbb7ee">ADD_INSN</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), opt_regexpmatch2);
<a name="l04505"></a>04505             }
<a name="l04506"></a>04506         }
<a name="l04507"></a>04507         <span class="keywordflow">else</span> {
<a name="l04508"></a>04508             <a class="code" href="../../d2/d47/compile_8c.html#afd9d72d069724385c83bcc32d6746b1e">ADD_SEQ</a>(ret, recv);
<a name="l04509"></a>04509             <a class="code" href="../../d2/d47/compile_8c.html#afd9d72d069724385c83bcc32d6746b1e">ADD_SEQ</a>(ret, val);
<a name="l04510"></a>04510             <a class="code" href="../../d2/d47/compile_8c.html#ab1941f9308f4508ab33b8828fec890fd">ADD_SEND</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), <a class="code" href="../../dc/d0c/cparse_8c.html#a48bfb6519a45249fb2ec0193ea3b6e1c">ID2SYM</a>(<a class="code" href="../../df/db9/id_8h.html#a08dd4fbd61c5fde369edd59783f753b3af4889e940c86374ac6d6caa3b6ad7ba4">idEqTilde</a>), <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(1));
<a name="l04511"></a>04511         }
<a name="l04512"></a>04512 
<a name="l04513"></a>04513         <span class="keywordflow">if</span> (poped) {
<a name="l04514"></a>04514             <a class="code" href="../../d2/d47/compile_8c.html#aa5b45ae61de3350f0830a32589bbb7ee">ADD_INSN</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), pop);
<a name="l04515"></a>04515         }
<a name="l04516"></a>04516         <span class="keywordflow">break</span>;
<a name="l04517"></a>04517       }
<a name="l04518"></a>04518       <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#af19d1c1d9f26c7b19546967449e887f6">NODE_LIT</a>:{
<a name="l04519"></a>04519         <a class="code" href="../../d2/d47/compile_8c.html#ad983bdc29f9c5bde5ab33d14c3d143e6">debugp_param</a>(<span class="stringliteral">&quot;lit&quot;</span>, node-&gt;nd_lit);
<a name="l04520"></a>04520         <span class="keywordflow">if</span> (!poped) {
<a name="l04521"></a>04521             <a class="code" href="../../d2/d47/compile_8c.html#a3cfeb7549a1249a8b78f9d6ff1e74c5a">ADD_INSN1</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), putobject, node-&gt;nd_lit);
<a name="l04522"></a>04522         }
<a name="l04523"></a>04523         <span class="keywordflow">break</span>;
<a name="l04524"></a>04524       }
<a name="l04525"></a>04525       <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#aac55f53b58d8cbef84a61f2d744e7643">NODE_STR</a>:{
<a name="l04526"></a>04526         <a class="code" href="../../d2/d47/compile_8c.html#ad983bdc29f9c5bde5ab33d14c3d143e6">debugp_param</a>(<span class="stringliteral">&quot;nd_lit&quot;</span>, node-&gt;nd_lit);
<a name="l04527"></a>04527         <span class="keywordflow">if</span> (!poped) {
<a name="l04528"></a>04528             <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a7ae8fa209abf837905d53c1c4be7c75d">OBJ_FREEZE</a>(node-&gt;nd_lit);
<a name="l04529"></a>04529             <a class="code" href="../../d2/d47/compile_8c.html#a3cfeb7549a1249a8b78f9d6ff1e74c5a">ADD_INSN1</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), putstring, node-&gt;nd_lit);
<a name="l04530"></a>04530         }
<a name="l04531"></a>04531         <span class="keywordflow">break</span>;
<a name="l04532"></a>04532       }
<a name="l04533"></a>04533       <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#a6487236f9718bcfe094a657cb0efd498">NODE_DSTR</a>:{
<a name="l04534"></a>04534         <a class="code" href="../../d2/d47/compile_8c.html#a5beb4b71176a85495ad1fbeaaee7bd86">compile_dstr</a>(iseq, ret, node);
<a name="l04535"></a>04535 
<a name="l04536"></a>04536         <span class="keywordflow">if</span> (poped) {
<a name="l04537"></a>04537             <a class="code" href="../../d2/d47/compile_8c.html#aa5b45ae61de3350f0830a32589bbb7ee">ADD_INSN</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), pop);
<a name="l04538"></a>04538         }
<a name="l04539"></a>04539         <span class="keywordflow">break</span>;
<a name="l04540"></a>04540       }
<a name="l04541"></a>04541       <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#a4850c3a60b6471d48bbb7b574cc3c3ca">NODE_XSTR</a>:{
<a name="l04542"></a>04542         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a7ae8fa209abf837905d53c1c4be7c75d">OBJ_FREEZE</a>(node-&gt;nd_lit);
<a name="l04543"></a>04543         <a class="code" href="../../d2/d47/compile_8c.html#a50d9af29f829b84d8d09dbd8a6ccde89">ADD_CALL_RECEIVER</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node));
<a name="l04544"></a>04544         <a class="code" href="../../d2/d47/compile_8c.html#a3cfeb7549a1249a8b78f9d6ff1e74c5a">ADD_INSN1</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), putobject, node-&gt;nd_lit);
<a name="l04545"></a>04545         <a class="code" href="../../d2/d47/compile_8c.html#ab48821feeaaab5e4b16d951222546ef4">ADD_CALL</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), <a class="code" href="../../dc/d0c/cparse_8c.html#a48bfb6519a45249fb2ec0193ea3b6e1c">ID2SYM</a>(<a class="code" href="../../df/db9/id_8h.html#a08dd4fbd61c5fde369edd59783f753b3a93595051d87597907f8d773ac63911a5">idBackquote</a>), <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(1));
<a name="l04546"></a>04546 
<a name="l04547"></a>04547         <span class="keywordflow">if</span> (poped) {
<a name="l04548"></a>04548             <a class="code" href="../../d2/d47/compile_8c.html#aa5b45ae61de3350f0830a32589bbb7ee">ADD_INSN</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), pop);
<a name="l04549"></a>04549         }
<a name="l04550"></a>04550         <span class="keywordflow">break</span>;
<a name="l04551"></a>04551       }
<a name="l04552"></a>04552       <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#ac175ada0354ab81202c744d1db266a85">NODE_DXSTR</a>:{
<a name="l04553"></a>04553         <a class="code" href="../../d2/d47/compile_8c.html#a50d9af29f829b84d8d09dbd8a6ccde89">ADD_CALL_RECEIVER</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node));
<a name="l04554"></a>04554         <a class="code" href="../../d2/d47/compile_8c.html#a5beb4b71176a85495ad1fbeaaee7bd86">compile_dstr</a>(iseq, ret, node);
<a name="l04555"></a>04555         <a class="code" href="../../d2/d47/compile_8c.html#ab48821feeaaab5e4b16d951222546ef4">ADD_CALL</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), <a class="code" href="../../dc/d0c/cparse_8c.html#a48bfb6519a45249fb2ec0193ea3b6e1c">ID2SYM</a>(<a class="code" href="../../df/db9/id_8h.html#a08dd4fbd61c5fde369edd59783f753b3a93595051d87597907f8d773ac63911a5">idBackquote</a>), <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(1));
<a name="l04556"></a>04556 
<a name="l04557"></a>04557         <span class="keywordflow">if</span> (poped) {
<a name="l04558"></a>04558             <a class="code" href="../../d2/d47/compile_8c.html#aa5b45ae61de3350f0830a32589bbb7ee">ADD_INSN</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), pop);
<a name="l04559"></a>04559         }
<a name="l04560"></a>04560         <span class="keywordflow">break</span>;
<a name="l04561"></a>04561       }
<a name="l04562"></a>04562       <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#ad557cd9d6e3e99782e148e0ed5712826">NODE_EVSTR</a>:{
<a name="l04563"></a>04563         <a class="code" href="../../d2/d47/compile_8c.html#a0cacd6cfca69df35e1535d2f21532c47">COMPILE</a>(ret, <span class="stringliteral">&quot;nd_body&quot;</span>, node-&gt;nd_body);
<a name="l04564"></a>04564 
<a name="l04565"></a>04565         <span class="keywordflow">if</span> (poped) {
<a name="l04566"></a>04566             <a class="code" href="../../d2/d47/compile_8c.html#aa5b45ae61de3350f0830a32589bbb7ee">ADD_INSN</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), pop);
<a name="l04567"></a>04567         }
<a name="l04568"></a>04568         <span class="keywordflow">else</span> {
<a name="l04569"></a>04569             <a class="code" href="../../d2/d47/compile_8c.html#aa5b45ae61de3350f0830a32589bbb7ee">ADD_INSN</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), tostring);
<a name="l04570"></a>04570         }
<a name="l04571"></a>04571         <span class="keywordflow">break</span>;
<a name="l04572"></a>04572       }
<a name="l04573"></a>04573       <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#a12aabedfc8eee47d21349ce818f3e60c">NODE_DREGX</a>:{
<a name="l04574"></a>04574         <a class="code" href="../../d2/d47/compile_8c.html#a52819fd8bf6050a1195b96fd6d1219f8">compile_dregx</a>(iseq, ret, node);
<a name="l04575"></a>04575 
<a name="l04576"></a>04576         <span class="keywordflow">if</span> (poped) {
<a name="l04577"></a>04577             <a class="code" href="../../d2/d47/compile_8c.html#aa5b45ae61de3350f0830a32589bbb7ee">ADD_INSN</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), pop);
<a name="l04578"></a>04578         }
<a name="l04579"></a>04579         <span class="keywordflow">break</span>;
<a name="l04580"></a>04580       }
<a name="l04581"></a>04581       <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#a43e52cd8b79e69a358e2ff4082094d2b">NODE_DREGX_ONCE</a>:{
<a name="l04582"></a>04582         <span class="comment">/* TODO: once? */</span>
<a name="l04583"></a>04583         <a class="code" href="../../d8/dc5/structiseq__label__data.html">LABEL</a> *lend = <a class="code" href="../../d2/d47/compile_8c.html#a1d6d5d8dac7aff9ac863255a0905c0f9">NEW_LABEL</a>(<a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node));
<a name="l04584"></a>04584         <span class="keywordtype">int</span> ic_index = iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a72aee3eed9e9842166e381972a35e9fb">ic_size</a>++;
<a name="l04585"></a>04585 
<a name="l04586"></a>04586         <a class="code" href="../../d2/d47/compile_8c.html#a9e17ccfd8b31ec3afcb91be39a6d453f">ADD_INSN2</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), onceinlinecache, lend, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(ic_index));
<a name="l04587"></a>04587         <a class="code" href="../../d2/d47/compile_8c.html#aa5b45ae61de3350f0830a32589bbb7ee">ADD_INSN</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), pop);
<a name="l04588"></a>04588 
<a name="l04589"></a>04589         <a class="code" href="../../d2/d47/compile_8c.html#a52819fd8bf6050a1195b96fd6d1219f8">compile_dregx</a>(iseq, ret, node);
<a name="l04590"></a>04590 
<a name="l04591"></a>04591         <a class="code" href="../../d2/d47/compile_8c.html#a3cfeb7549a1249a8b78f9d6ff1e74c5a">ADD_INSN1</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), setinlinecache, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(ic_index));
<a name="l04592"></a>04592         <a class="code" href="../../d2/d47/compile_8c.html#a5a380bb449656575d6b77ccb8eb7e5ae">ADD_LABEL</a>(ret, lend);
<a name="l04593"></a>04593 
<a name="l04594"></a>04594         <span class="keywordflow">if</span> (poped) {
<a name="l04595"></a>04595             <a class="code" href="../../d2/d47/compile_8c.html#aa5b45ae61de3350f0830a32589bbb7ee">ADD_INSN</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), pop);
<a name="l04596"></a>04596         }
<a name="l04597"></a>04597         <span class="keywordflow">break</span>;
<a name="l04598"></a>04598       }
<a name="l04599"></a>04599       <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#a796ba7c9f501e5f81b4f6f06972250fd">NODE_ARGSCAT</a>:{
<a name="l04600"></a>04600         <span class="keywordflow">if</span> (poped) {
<a name="l04601"></a>04601             <a class="code" href="../../d2/d47/compile_8c.html#a0cacd6cfca69df35e1535d2f21532c47">COMPILE</a>(ret, <span class="stringliteral">&quot;argscat head&quot;</span>, node-&gt;nd_head);
<a name="l04602"></a>04602             <a class="code" href="../../d2/d47/compile_8c.html#a3cfeb7549a1249a8b78f9d6ff1e74c5a">ADD_INSN1</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), splatarray, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aba0717d2689eb68797421a02ab9295c6">Qfalse</a>);
<a name="l04603"></a>04603             <a class="code" href="../../d2/d47/compile_8c.html#aa5b45ae61de3350f0830a32589bbb7ee">ADD_INSN</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), pop);
<a name="l04604"></a>04604             <a class="code" href="../../d2/d47/compile_8c.html#a0cacd6cfca69df35e1535d2f21532c47">COMPILE</a>(ret, <span class="stringliteral">&quot;argscat body&quot;</span>, node-&gt;nd_body);
<a name="l04605"></a>04605             <a class="code" href="../../d2/d47/compile_8c.html#a3cfeb7549a1249a8b78f9d6ff1e74c5a">ADD_INSN1</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), splatarray, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aba0717d2689eb68797421a02ab9295c6">Qfalse</a>);
<a name="l04606"></a>04606             <a class="code" href="../../d2/d47/compile_8c.html#aa5b45ae61de3350f0830a32589bbb7ee">ADD_INSN</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), pop);
<a name="l04607"></a>04607         }
<a name="l04608"></a>04608         <span class="keywordflow">else</span> {
<a name="l04609"></a>04609             <a class="code" href="../../d2/d47/compile_8c.html#a0cacd6cfca69df35e1535d2f21532c47">COMPILE</a>(ret, <span class="stringliteral">&quot;argscat head&quot;</span>, node-&gt;nd_head);
<a name="l04610"></a>04610             <a class="code" href="../../d2/d47/compile_8c.html#a0cacd6cfca69df35e1535d2f21532c47">COMPILE</a>(ret, <span class="stringliteral">&quot;argscat body&quot;</span>, node-&gt;nd_body);
<a name="l04611"></a>04611             <a class="code" href="../../d2/d47/compile_8c.html#aa5b45ae61de3350f0830a32589bbb7ee">ADD_INSN</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), concatarray);
<a name="l04612"></a>04612         }
<a name="l04613"></a>04613         <span class="keywordflow">break</span>;
<a name="l04614"></a>04614       }
<a name="l04615"></a>04615       <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#a15dc4d72c7b3a577d28e6131a63926d9">NODE_ARGSPUSH</a>:{
<a name="l04616"></a>04616         <span class="keywordflow">if</span> (poped) {
<a name="l04617"></a>04617             <a class="code" href="../../d2/d47/compile_8c.html#a0cacd6cfca69df35e1535d2f21532c47">COMPILE</a>(ret, <span class="stringliteral">&quot;arsgpush head&quot;</span>, node-&gt;nd_head);
<a name="l04618"></a>04618             <a class="code" href="../../d2/d47/compile_8c.html#a3cfeb7549a1249a8b78f9d6ff1e74c5a">ADD_INSN1</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), splatarray, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aba0717d2689eb68797421a02ab9295c6">Qfalse</a>);
<a name="l04619"></a>04619             <a class="code" href="../../d2/d47/compile_8c.html#aa5b45ae61de3350f0830a32589bbb7ee">ADD_INSN</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), pop);
<a name="l04620"></a>04620             <a class="code" href="../../d2/d47/compile_8c.html#a04d4dbcbb97179b5908eb025e13c7752">COMPILE_</a>(ret, <span class="stringliteral">&quot;argspush body&quot;</span>, node-&gt;nd_body, poped);
<a name="l04621"></a>04621         }
<a name="l04622"></a>04622         <span class="keywordflow">else</span> {
<a name="l04623"></a>04623             <a class="code" href="../../d2/d47/compile_8c.html#a0cacd6cfca69df35e1535d2f21532c47">COMPILE</a>(ret, <span class="stringliteral">&quot;arsgpush head&quot;</span>, node-&gt;nd_head);
<a name="l04624"></a>04624             <a class="code" href="../../d2/d47/compile_8c.html#a04d4dbcbb97179b5908eb025e13c7752">COMPILE_</a>(ret, <span class="stringliteral">&quot;argspush body&quot;</span>, node-&gt;nd_body, poped);
<a name="l04625"></a>04625             <a class="code" href="../../d2/d47/compile_8c.html#a3cfeb7549a1249a8b78f9d6ff1e74c5a">ADD_INSN1</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), newarray, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(1));
<a name="l04626"></a>04626             <a class="code" href="../../d2/d47/compile_8c.html#aa5b45ae61de3350f0830a32589bbb7ee">ADD_INSN</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), concatarray);
<a name="l04627"></a>04627         }
<a name="l04628"></a>04628         <span class="keywordflow">break</span>;
<a name="l04629"></a>04629       }
<a name="l04630"></a>04630       <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#a985f27752acfb29eca912c28522329c3">NODE_SPLAT</a>:{
<a name="l04631"></a>04631         <a class="code" href="../../d2/d47/compile_8c.html#a0cacd6cfca69df35e1535d2f21532c47">COMPILE</a>(ret, <span class="stringliteral">&quot;splat&quot;</span>, node-&gt;nd_head);
<a name="l04632"></a>04632         <a class="code" href="../../d2/d47/compile_8c.html#a3cfeb7549a1249a8b78f9d6ff1e74c5a">ADD_INSN1</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), splatarray, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aacea3516b33941ce8149098e223a7466">Qtrue</a>);
<a name="l04633"></a>04633 
<a name="l04634"></a>04634         <span class="keywordflow">if</span> (poped) {
<a name="l04635"></a>04635             <a class="code" href="../../d2/d47/compile_8c.html#aa5b45ae61de3350f0830a32589bbb7ee">ADD_INSN</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), pop);
<a name="l04636"></a>04636         }
<a name="l04637"></a>04637         <span class="keywordflow">break</span>;
<a name="l04638"></a>04638       }
<a name="l04639"></a>04639       <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#a0ce7b90eaf281deb02709b014b182134">NODE_DEFN</a>:{
<a name="l04640"></a>04640         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> iseqval = <a class="code" href="../../d2/d47/compile_8c.html#a988d32e5fce03fdcc541a7418d7b01f9">NEW_ISEQVAL</a>(node-&gt;nd_defn,
<a name="l04641"></a>04641                                     <a class="code" href="../../db/d2e/intern_8h.html#ae2843c766c24b80116bb127ebf22d5bf">rb_str_dup</a>(<a class="code" href="../../d5/d11/ripper_8c.html#aec42ef320e57234e789bdda6d655716f">rb_id2str</a>(node-&gt;nd_mid)),
<a name="l04642"></a>04642                                     ISEQ_TYPE_METHOD, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node));
<a name="l04643"></a>04643 
<a name="l04644"></a>04644         <a class="code" href="../../d2/d47/compile_8c.html#ad983bdc29f9c5bde5ab33d14c3d143e6">debugp_param</a>(<span class="stringliteral">&quot;defn/iseq&quot;</span>, iseqval);
<a name="l04645"></a>04645 
<a name="l04646"></a>04646         <a class="code" href="../../d2/d47/compile_8c.html#a3cfeb7549a1249a8b78f9d6ff1e74c5a">ADD_INSN1</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), putspecialobject, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(<a class="code" href="../../d8/d32/vm__core_8h.html#a3aec522068d95925054562a7c650b99ba932f2eddae25cf0eab7b034b17ad1935">VM_SPECIAL_OBJECT_VMCORE</a>));
<a name="l04647"></a>04647         <a class="code" href="../../d2/d47/compile_8c.html#a3cfeb7549a1249a8b78f9d6ff1e74c5a">ADD_INSN1</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), putspecialobject, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(<a class="code" href="../../d8/d32/vm__core_8h.html#a3aec522068d95925054562a7c650b99ba758770af26f120743dcecdf2579234fb">VM_SPECIAL_OBJECT_CBASE</a>));
<a name="l04648"></a>04648         <a class="code" href="../../d2/d47/compile_8c.html#a3cfeb7549a1249a8b78f9d6ff1e74c5a">ADD_INSN1</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), putobject, <a class="code" href="../../dc/d0c/cparse_8c.html#a48bfb6519a45249fb2ec0193ea3b6e1c">ID2SYM</a>(node-&gt;nd_mid));
<a name="l04649"></a>04649         <a class="code" href="../../d2/d47/compile_8c.html#a3cfeb7549a1249a8b78f9d6ff1e74c5a">ADD_INSN1</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), putiseq, iseqval);
<a name="l04650"></a>04650         <a class="code" href="../../d2/d47/compile_8c.html#ab1941f9308f4508ab33b8828fec890fd">ADD_SEND</a> (ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), <a class="code" href="../../dc/d0c/cparse_8c.html#a48bfb6519a45249fb2ec0193ea3b6e1c">ID2SYM</a>(<a class="code" href="../../d5/d11/ripper_8c.html#ac8053973c51f98505f40d32af7b95f5a">id_core_define_method</a>), <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(3));
<a name="l04651"></a>04651 
<a name="l04652"></a>04652         <span class="keywordflow">if</span> (poped) {
<a name="l04653"></a>04653             <a class="code" href="../../d2/d47/compile_8c.html#aa5b45ae61de3350f0830a32589bbb7ee">ADD_INSN</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), pop);
<a name="l04654"></a>04654         }
<a name="l04655"></a>04655 
<a name="l04656"></a>04656         <a class="code" href="../../d2/d47/compile_8c.html#ad983bdc29f9c5bde5ab33d14c3d143e6">debugp_param</a>(<span class="stringliteral">&quot;defn&quot;</span>, iseqval);
<a name="l04657"></a>04657         <span class="keywordflow">break</span>;
<a name="l04658"></a>04658       }
<a name="l04659"></a>04659       <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#a1aa42b99b85e6641856c375c18999ebc">NODE_DEFS</a>:{
<a name="l04660"></a>04660         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> iseqval = <a class="code" href="../../d2/d47/compile_8c.html#a988d32e5fce03fdcc541a7418d7b01f9">NEW_ISEQVAL</a>(node-&gt;nd_defn,
<a name="l04661"></a>04661                                     <a class="code" href="../../db/d2e/intern_8h.html#ae2843c766c24b80116bb127ebf22d5bf">rb_str_dup</a>(<a class="code" href="../../d5/d11/ripper_8c.html#aec42ef320e57234e789bdda6d655716f">rb_id2str</a>(node-&gt;nd_mid)),
<a name="l04662"></a>04662                                     ISEQ_TYPE_METHOD, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node));
<a name="l04663"></a>04663 
<a name="l04664"></a>04664         <a class="code" href="../../d2/d47/compile_8c.html#ad983bdc29f9c5bde5ab33d14c3d143e6">debugp_param</a>(<span class="stringliteral">&quot;defs/iseq&quot;</span>, iseqval);
<a name="l04665"></a>04665 
<a name="l04666"></a>04666         <a class="code" href="../../d2/d47/compile_8c.html#a3cfeb7549a1249a8b78f9d6ff1e74c5a">ADD_INSN1</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), putspecialobject, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(<a class="code" href="../../d8/d32/vm__core_8h.html#a3aec522068d95925054562a7c650b99ba932f2eddae25cf0eab7b034b17ad1935">VM_SPECIAL_OBJECT_VMCORE</a>));
<a name="l04667"></a>04667         <a class="code" href="../../d2/d47/compile_8c.html#a0cacd6cfca69df35e1535d2f21532c47">COMPILE</a>(ret, <span class="stringliteral">&quot;defs: recv&quot;</span>, node-&gt;nd_recv);
<a name="l04668"></a>04668         <a class="code" href="../../d2/d47/compile_8c.html#a3cfeb7549a1249a8b78f9d6ff1e74c5a">ADD_INSN1</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), putobject, <a class="code" href="../../dc/d0c/cparse_8c.html#a48bfb6519a45249fb2ec0193ea3b6e1c">ID2SYM</a>(node-&gt;nd_mid));
<a name="l04669"></a>04669         <a class="code" href="../../d2/d47/compile_8c.html#a3cfeb7549a1249a8b78f9d6ff1e74c5a">ADD_INSN1</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), putiseq, iseqval);
<a name="l04670"></a>04670         <a class="code" href="../../d2/d47/compile_8c.html#ab1941f9308f4508ab33b8828fec890fd">ADD_SEND</a> (ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), <a class="code" href="../../dc/d0c/cparse_8c.html#a48bfb6519a45249fb2ec0193ea3b6e1c">ID2SYM</a>(<a class="code" href="../../d5/d11/ripper_8c.html#ab948c9eee8902650fc1c9e93e45ce936">id_core_define_singleton_method</a>), <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(3));
<a name="l04671"></a>04671 
<a name="l04672"></a>04672         <span class="keywordflow">if</span> (poped) {
<a name="l04673"></a>04673             <a class="code" href="../../d2/d47/compile_8c.html#aa5b45ae61de3350f0830a32589bbb7ee">ADD_INSN</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), pop);
<a name="l04674"></a>04674         }
<a name="l04675"></a>04675         <span class="keywordflow">break</span>;
<a name="l04676"></a>04676       }
<a name="l04677"></a>04677       <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#a0b706295869ed8e7a099d11f8ef9a584">NODE_ALIAS</a>:{
<a name="l04678"></a>04678         <a class="code" href="../../d2/d47/compile_8c.html#a3cfeb7549a1249a8b78f9d6ff1e74c5a">ADD_INSN1</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), putspecialobject, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(<a class="code" href="../../d8/d32/vm__core_8h.html#a3aec522068d95925054562a7c650b99ba932f2eddae25cf0eab7b034b17ad1935">VM_SPECIAL_OBJECT_VMCORE</a>));
<a name="l04679"></a>04679         <a class="code" href="../../d2/d47/compile_8c.html#a3cfeb7549a1249a8b78f9d6ff1e74c5a">ADD_INSN1</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), putspecialobject, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(<a class="code" href="../../d8/d32/vm__core_8h.html#a3aec522068d95925054562a7c650b99ba758770af26f120743dcecdf2579234fb">VM_SPECIAL_OBJECT_CBASE</a>));
<a name="l04680"></a>04680         <a class="code" href="../../d2/d47/compile_8c.html#a0cacd6cfca69df35e1535d2f21532c47">COMPILE</a>(ret, <span class="stringliteral">&quot;alias arg1&quot;</span>, node-&gt;u1.node);
<a name="l04681"></a>04681         <a class="code" href="../../d2/d47/compile_8c.html#a0cacd6cfca69df35e1535d2f21532c47">COMPILE</a>(ret, <span class="stringliteral">&quot;alias arg2&quot;</span>, node-&gt;u2.node);
<a name="l04682"></a>04682         <a class="code" href="../../d2/d47/compile_8c.html#ab1941f9308f4508ab33b8828fec890fd">ADD_SEND</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), <a class="code" href="../../dc/d0c/cparse_8c.html#a48bfb6519a45249fb2ec0193ea3b6e1c">ID2SYM</a>(<a class="code" href="../../d5/d11/ripper_8c.html#a91996e87fe152b3c23ada91901134524">id_core_set_method_alias</a>), <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(3));
<a name="l04683"></a>04683 
<a name="l04684"></a>04684         <span class="keywordflow">if</span> (poped) {
<a name="l04685"></a>04685             <a class="code" href="../../d2/d47/compile_8c.html#aa5b45ae61de3350f0830a32589bbb7ee">ADD_INSN</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), pop);
<a name="l04686"></a>04686         }
<a name="l04687"></a>04687         <span class="keywordflow">break</span>;
<a name="l04688"></a>04688       }
<a name="l04689"></a>04689       <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#a533349938d03fe5c779f78036adf8796">NODE_VALIAS</a>:{
<a name="l04690"></a>04690         <a class="code" href="../../d2/d47/compile_8c.html#a3cfeb7549a1249a8b78f9d6ff1e74c5a">ADD_INSN1</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), putspecialobject, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(<a class="code" href="../../d8/d32/vm__core_8h.html#a3aec522068d95925054562a7c650b99ba932f2eddae25cf0eab7b034b17ad1935">VM_SPECIAL_OBJECT_VMCORE</a>));
<a name="l04691"></a>04691         <a class="code" href="../../d2/d47/compile_8c.html#a3cfeb7549a1249a8b78f9d6ff1e74c5a">ADD_INSN1</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), putobject, <a class="code" href="../../dc/d0c/cparse_8c.html#a48bfb6519a45249fb2ec0193ea3b6e1c">ID2SYM</a>(node-&gt;u1.id));
<a name="l04692"></a>04692         <a class="code" href="../../d2/d47/compile_8c.html#a3cfeb7549a1249a8b78f9d6ff1e74c5a">ADD_INSN1</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), putobject, <a class="code" href="../../dc/d0c/cparse_8c.html#a48bfb6519a45249fb2ec0193ea3b6e1c">ID2SYM</a>(node-&gt;u2.id));
<a name="l04693"></a>04693         <a class="code" href="../../d2/d47/compile_8c.html#ab1941f9308f4508ab33b8828fec890fd">ADD_SEND</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), <a class="code" href="../../dc/d0c/cparse_8c.html#a48bfb6519a45249fb2ec0193ea3b6e1c">ID2SYM</a>(<a class="code" href="../../d5/d11/ripper_8c.html#a6a184f6f82c9e05dd16116cc18d1f8b9">id_core_set_variable_alias</a>), <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(2));
<a name="l04694"></a>04694 
<a name="l04695"></a>04695         <span class="keywordflow">if</span> (poped) {
<a name="l04696"></a>04696             <a class="code" href="../../d2/d47/compile_8c.html#aa5b45ae61de3350f0830a32589bbb7ee">ADD_INSN</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), pop);
<a name="l04697"></a>04697         }
<a name="l04698"></a>04698         <span class="keywordflow">break</span>;
<a name="l04699"></a>04699       }
<a name="l04700"></a>04700       <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#abfeac49b2473bade38a545bedf938fdd">NODE_UNDEF</a>:{
<a name="l04701"></a>04701         <a class="code" href="../../d2/d47/compile_8c.html#a3cfeb7549a1249a8b78f9d6ff1e74c5a">ADD_INSN1</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), putspecialobject, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(<a class="code" href="../../d8/d32/vm__core_8h.html#a3aec522068d95925054562a7c650b99ba932f2eddae25cf0eab7b034b17ad1935">VM_SPECIAL_OBJECT_VMCORE</a>));
<a name="l04702"></a>04702         <a class="code" href="../../d2/d47/compile_8c.html#a3cfeb7549a1249a8b78f9d6ff1e74c5a">ADD_INSN1</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), putspecialobject, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(<a class="code" href="../../d8/d32/vm__core_8h.html#a3aec522068d95925054562a7c650b99ba758770af26f120743dcecdf2579234fb">VM_SPECIAL_OBJECT_CBASE</a>));
<a name="l04703"></a>04703         <a class="code" href="../../d2/d47/compile_8c.html#a0cacd6cfca69df35e1535d2f21532c47">COMPILE</a>(ret, <span class="stringliteral">&quot;undef arg&quot;</span>, node-&gt;u2.node);
<a name="l04704"></a>04704         <a class="code" href="../../d2/d47/compile_8c.html#ab1941f9308f4508ab33b8828fec890fd">ADD_SEND</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), <a class="code" href="../../dc/d0c/cparse_8c.html#a48bfb6519a45249fb2ec0193ea3b6e1c">ID2SYM</a>(<a class="code" href="../../d5/d11/ripper_8c.html#ab9fb1a3c08f08c168d1512a170d0484c">id_core_undef_method</a>), <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(2));
<a name="l04705"></a>04705 
<a name="l04706"></a>04706         <span class="keywordflow">if</span> (poped) {
<a name="l04707"></a>04707             <a class="code" href="../../d2/d47/compile_8c.html#aa5b45ae61de3350f0830a32589bbb7ee">ADD_INSN</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), pop);
<a name="l04708"></a>04708         }
<a name="l04709"></a>04709         <span class="keywordflow">break</span>;
<a name="l04710"></a>04710       }
<a name="l04711"></a>04711       <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#abb6f5b1caf75e58982beec5eb2b616ab">NODE_CLASS</a>:{
<a name="l04712"></a>04712         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> iseqval =
<a name="l04713"></a>04713             <a class="code" href="../../d2/d47/compile_8c.html#a8b46ed4917f951327df16ff64ed8f67c">NEW_CHILD_ISEQVAL</a>(
<a name="l04714"></a>04714                 node-&gt;nd_body,
<a name="l04715"></a>04715                 <a class="code" href="../../d9/d2d/sprintf_8c.html#a05c34a91ab36c6a463c861df47808fae">rb_sprintf</a>(<span class="stringliteral">&quot;&lt;class:%s&gt;&quot;</span>, <a class="code" href="../../d5/d11/ripper_8c.html#a877bc58c495643fcf49dc64c44631e72">rb_id2name</a>(node-&gt;nd_cpath-&gt;nd_mid)),
<a name="l04716"></a>04716                 ISEQ_TYPE_CLASS, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node));
<a name="l04717"></a>04717         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> noscope = <a class="code" href="../../d2/d47/compile_8c.html#afbd4358e854311242b62772d0b1660bc">compile_cpath</a>(ret, iseq, node-&gt;nd_cpath);
<a name="l04718"></a>04718         <a class="code" href="../../d2/d47/compile_8c.html#a0cacd6cfca69df35e1535d2f21532c47">COMPILE</a>(ret, <span class="stringliteral">&quot;super&quot;</span>, node-&gt;nd_super);
<a name="l04719"></a>04719         <a class="code" href="../../d2/d47/compile_8c.html#af8e927ae02d27d3a3934dcc65a2d21c9">ADD_INSN3</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), defineclass,
<a name="l04720"></a>04720                   <a class="code" href="../../dc/d0c/cparse_8c.html#a48bfb6519a45249fb2ec0193ea3b6e1c">ID2SYM</a>(node-&gt;nd_cpath-&gt;nd_mid), iseqval, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(noscope ? 3 : 0));
<a name="l04721"></a>04721 
<a name="l04722"></a>04722         <span class="keywordflow">if</span> (poped) {
<a name="l04723"></a>04723             <a class="code" href="../../d2/d47/compile_8c.html#aa5b45ae61de3350f0830a32589bbb7ee">ADD_INSN</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), pop);
<a name="l04724"></a>04724         }
<a name="l04725"></a>04725         <span class="keywordflow">break</span>;
<a name="l04726"></a>04726       }
<a name="l04727"></a>04727       <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#ac8b0046f8276f3b5175c782f6c2a9380">NODE_MODULE</a>:{
<a name="l04728"></a>04728         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> iseqval = <a class="code" href="../../d2/d47/compile_8c.html#a8b46ed4917f951327df16ff64ed8f67c">NEW_CHILD_ISEQVAL</a>(
<a name="l04729"></a>04729             node-&gt;nd_body,
<a name="l04730"></a>04730             <a class="code" href="../../d9/d2d/sprintf_8c.html#a05c34a91ab36c6a463c861df47808fae">rb_sprintf</a>(<span class="stringliteral">&quot;&lt;module:%s&gt;&quot;</span>, <a class="code" href="../../d5/d11/ripper_8c.html#a877bc58c495643fcf49dc64c44631e72">rb_id2name</a>(node-&gt;nd_cpath-&gt;nd_mid)),
<a name="l04731"></a>04731             ISEQ_TYPE_CLASS, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node));
<a name="l04732"></a>04732 
<a name="l04733"></a>04733         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> noscope = <a class="code" href="../../d2/d47/compile_8c.html#afbd4358e854311242b62772d0b1660bc">compile_cpath</a>(ret, iseq, node-&gt;nd_cpath);
<a name="l04734"></a>04734         <a class="code" href="../../d2/d47/compile_8c.html#aa5b45ae61de3350f0830a32589bbb7ee">ADD_INSN</a> (ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), putnil); <span class="comment">/* dummy */</span>
<a name="l04735"></a>04735         <a class="code" href="../../d2/d47/compile_8c.html#af8e927ae02d27d3a3934dcc65a2d21c9">ADD_INSN3</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), defineclass,
<a name="l04736"></a>04736                   <a class="code" href="../../dc/d0c/cparse_8c.html#a48bfb6519a45249fb2ec0193ea3b6e1c">ID2SYM</a>(node-&gt;nd_cpath-&gt;nd_mid), iseqval, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(noscope ? 5 : 2));
<a name="l04737"></a>04737         <span class="keywordflow">if</span> (poped) {
<a name="l04738"></a>04738             <a class="code" href="../../d2/d47/compile_8c.html#aa5b45ae61de3350f0830a32589bbb7ee">ADD_INSN</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), pop);
<a name="l04739"></a>04739         }
<a name="l04740"></a>04740         <span class="keywordflow">break</span>;
<a name="l04741"></a>04741       }
<a name="l04742"></a>04742       <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#a6b27bbbd70ada5579b4863a16c28d77e">NODE_SCLASS</a>:{
<a name="l04743"></a>04743         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#afa5b9137f051ac26d7ccc8824f178233">ID</a> singletonclass;
<a name="l04744"></a>04744         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> iseqval =
<a name="l04745"></a>04745             <a class="code" href="../../d2/d47/compile_8c.html#a988d32e5fce03fdcc541a7418d7b01f9">NEW_ISEQVAL</a>(node-&gt;nd_body, <a class="code" href="../../db/d2e/intern_8h.html#a03acd62c0b1edebbe1d61f957c19b7ac">rb_str_new2</a>(<span class="stringliteral">&quot;singletonclass&quot;</span>),
<a name="l04746"></a>04746                         ISEQ_TYPE_CLASS, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node));
<a name="l04747"></a>04747 
<a name="l04748"></a>04748         <a class="code" href="../../d2/d47/compile_8c.html#a0cacd6cfca69df35e1535d2f21532c47">COMPILE</a>(ret, <span class="stringliteral">&quot;sclass#recv&quot;</span>, node-&gt;nd_recv);
<a name="l04749"></a>04749         <a class="code" href="../../d2/d47/compile_8c.html#aa5b45ae61de3350f0830a32589bbb7ee">ADD_INSN</a> (ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), putnil);
<a name="l04750"></a>04750         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aa50b9d5bc665eb5545f6857c89232161">CONST_ID</a>(singletonclass, <span class="stringliteral">&quot;singletonclass&quot;</span>);
<a name="l04751"></a>04751         <a class="code" href="../../d2/d47/compile_8c.html#af8e927ae02d27d3a3934dcc65a2d21c9">ADD_INSN3</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), defineclass,
<a name="l04752"></a>04752                   <a class="code" href="../../dc/d0c/cparse_8c.html#a48bfb6519a45249fb2ec0193ea3b6e1c">ID2SYM</a>(singletonclass), iseqval, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(1));
<a name="l04753"></a>04753 
<a name="l04754"></a>04754         <span class="keywordflow">if</span> (poped) {
<a name="l04755"></a>04755             <a class="code" href="../../d2/d47/compile_8c.html#aa5b45ae61de3350f0830a32589bbb7ee">ADD_INSN</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), pop);
<a name="l04756"></a>04756         }
<a name="l04757"></a>04757         <span class="keywordflow">break</span>;
<a name="l04758"></a>04758       }
<a name="l04759"></a>04759       <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#aff107642c64833eb6f64e7043c4d2b5c">NODE_COLON2</a>:{
<a name="l04760"></a>04760         <span class="keywordflow">if</span> (<a class="code" href="../../d5/d11/ripper_8c.html#a962e14dc81f0fa2107c555dd10129c27">rb_is_const_id</a>(node-&gt;nd_mid)) {
<a name="l04761"></a>04761             <span class="comment">/* constant */</span>
<a name="l04762"></a>04762             <a class="code" href="../../d8/dc5/structiseq__label__data.html">LABEL</a> *lend = <a class="code" href="../../d2/d47/compile_8c.html#a1d6d5d8dac7aff9ac863255a0905c0f9">NEW_LABEL</a>(<a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node));
<a name="l04763"></a>04763             <span class="keywordtype">int</span> ic_index = iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a72aee3eed9e9842166e381972a35e9fb">ic_size</a>++;
<a name="l04764"></a>04764 
<a name="l04765"></a>04765             <a class="code" href="../../d2/d47/compile_8c.html#aa9d6014cec8d3adcb228b81620eac795">DECL_ANCHOR</a>(pref);
<a name="l04766"></a>04766             <a class="code" href="../../d2/d47/compile_8c.html#aa9d6014cec8d3adcb228b81620eac795">DECL_ANCHOR</a>(body);
<a name="l04767"></a>04767 
<a name="l04768"></a>04768             <a class="code" href="../../d2/d47/compile_8c.html#ac32b1f7d8de8f10f33a147030d8b7544">INIT_ANCHOR</a>(pref);
<a name="l04769"></a>04769             <a class="code" href="../../d2/d47/compile_8c.html#ac32b1f7d8de8f10f33a147030d8b7544">INIT_ANCHOR</a>(body);
<a name="l04770"></a>04770             <a class="code" href="../../d2/d47/compile_8c.html#ad175301f7101076cc58a47ba7c741a0a">compile_colon2</a>(iseq, node, pref, body);
<a name="l04771"></a>04771             <span class="keywordflow">if</span> (<a class="code" href="../../d2/d47/compile_8c.html#aa32aff332271737c2a3edbb440ad4ca1">LIST_SIZE_ZERO</a>(pref)) {
<a name="l04772"></a>04772                 <span class="keywordflow">if</span> (iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a947d34698fb5a71f4938532fff27a0f7">compile_data</a>-&gt;<a class="code" href="../../d4/dd8/structiseq__compile__data.html#a3cde0c1bfeea6f8a80027a9e21a9759a">option</a>-&gt;<a class="code" href="../../db/dc1/structrb__compile__option__struct.html#a22c6ceaf348e1323e7c11afc0ac1201b">inline_const_cache</a>) {
<a name="l04773"></a>04773                     <a class="code" href="../../d2/d47/compile_8c.html#a9e17ccfd8b31ec3afcb91be39a6d453f">ADD_INSN2</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), getinlinecache, lend, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(ic_index));
<a name="l04774"></a>04774                 }
<a name="l04775"></a>04775                 <span class="keywordflow">else</span> {
<a name="l04776"></a>04776                     <a class="code" href="../../d2/d47/compile_8c.html#aa5b45ae61de3350f0830a32589bbb7ee">ADD_INSN</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), putnil);
<a name="l04777"></a>04777                 }
<a name="l04778"></a>04778 
<a name="l04779"></a>04779                 <a class="code" href="../../d2/d47/compile_8c.html#afd9d72d069724385c83bcc32d6746b1e">ADD_SEQ</a>(ret, body);
<a name="l04780"></a>04780 
<a name="l04781"></a>04781                 <span class="keywordflow">if</span> (iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a947d34698fb5a71f4938532fff27a0f7">compile_data</a>-&gt;<a class="code" href="../../d4/dd8/structiseq__compile__data.html#a3cde0c1bfeea6f8a80027a9e21a9759a">option</a>-&gt;<a class="code" href="../../db/dc1/structrb__compile__option__struct.html#a22c6ceaf348e1323e7c11afc0ac1201b">inline_const_cache</a>) {
<a name="l04782"></a>04782                     <a class="code" href="../../d2/d47/compile_8c.html#a3cfeb7549a1249a8b78f9d6ff1e74c5a">ADD_INSN1</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), setinlinecache, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(ic_index));
<a name="l04783"></a>04783                     <a class="code" href="../../d2/d47/compile_8c.html#a5a380bb449656575d6b77ccb8eb7e5ae">ADD_LABEL</a>(ret, lend);
<a name="l04784"></a>04784                 }
<a name="l04785"></a>04785             }
<a name="l04786"></a>04786             <span class="keywordflow">else</span> {
<a name="l04787"></a>04787                 <a class="code" href="../../d2/d47/compile_8c.html#afd9d72d069724385c83bcc32d6746b1e">ADD_SEQ</a>(ret, pref);
<a name="l04788"></a>04788                 <a class="code" href="../../d2/d47/compile_8c.html#afd9d72d069724385c83bcc32d6746b1e">ADD_SEQ</a>(ret, body);
<a name="l04789"></a>04789             }
<a name="l04790"></a>04790         }
<a name="l04791"></a>04791         <span class="keywordflow">else</span> {
<a name="l04792"></a>04792             <span class="comment">/* function call */</span>
<a name="l04793"></a>04793             <a class="code" href="../../d2/d47/compile_8c.html#a50d9af29f829b84d8d09dbd8a6ccde89">ADD_CALL_RECEIVER</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node));
<a name="l04794"></a>04794             <a class="code" href="../../d2/d47/compile_8c.html#a0cacd6cfca69df35e1535d2f21532c47">COMPILE</a>(ret, <span class="stringliteral">&quot;colon2#nd_head&quot;</span>, node-&gt;nd_head);
<a name="l04795"></a>04795             <a class="code" href="../../d2/d47/compile_8c.html#ab48821feeaaab5e4b16d951222546ef4">ADD_CALL</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), <a class="code" href="../../dc/d0c/cparse_8c.html#a48bfb6519a45249fb2ec0193ea3b6e1c">ID2SYM</a>(node-&gt;nd_mid),
<a name="l04796"></a>04796                      <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(1));
<a name="l04797"></a>04797         }
<a name="l04798"></a>04798         <span class="keywordflow">if</span> (poped) {
<a name="l04799"></a>04799             <a class="code" href="../../d2/d47/compile_8c.html#aa5b45ae61de3350f0830a32589bbb7ee">ADD_INSN</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), pop);
<a name="l04800"></a>04800         }
<a name="l04801"></a>04801         <span class="keywordflow">break</span>;
<a name="l04802"></a>04802       }
<a name="l04803"></a>04803       <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#a614c6f2b1367102fbde526a5eb2871af">NODE_COLON3</a>:{
<a name="l04804"></a>04804         <a class="code" href="../../d8/dc5/structiseq__label__data.html">LABEL</a> *lend = <a class="code" href="../../d2/d47/compile_8c.html#a1d6d5d8dac7aff9ac863255a0905c0f9">NEW_LABEL</a>(<a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node));
<a name="l04805"></a>04805         <span class="keywordtype">int</span> ic_index = iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a72aee3eed9e9842166e381972a35e9fb">ic_size</a>++;
<a name="l04806"></a>04806 
<a name="l04807"></a>04807           <a class="code" href="../../d2/d47/compile_8c.html#a9156fef334af9c349bedf159ff008bb4">debugi</a>(<span class="stringliteral">&quot;colon3#nd_mid&quot;</span>, node-&gt;nd_mid);
<a name="l04808"></a>04808 
<a name="l04809"></a>04809         <span class="comment">/* add cache insn */</span>
<a name="l04810"></a>04810         <span class="keywordflow">if</span> (iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a947d34698fb5a71f4938532fff27a0f7">compile_data</a>-&gt;<a class="code" href="../../d4/dd8/structiseq__compile__data.html#a3cde0c1bfeea6f8a80027a9e21a9759a">option</a>-&gt;<a class="code" href="../../db/dc1/structrb__compile__option__struct.html#a22c6ceaf348e1323e7c11afc0ac1201b">inline_const_cache</a>) {
<a name="l04811"></a>04811             <a class="code" href="../../d2/d47/compile_8c.html#a9e17ccfd8b31ec3afcb91be39a6d453f">ADD_INSN2</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), getinlinecache, lend, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(ic_index));
<a name="l04812"></a>04812             <a class="code" href="../../d2/d47/compile_8c.html#aa5b45ae61de3350f0830a32589bbb7ee">ADD_INSN</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), pop);
<a name="l04813"></a>04813         }
<a name="l04814"></a>04814 
<a name="l04815"></a>04815         <a class="code" href="../../d2/d47/compile_8c.html#a3cfeb7549a1249a8b78f9d6ff1e74c5a">ADD_INSN1</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), putobject, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a57c96ead3ef230b4838e65fe037c346e">rb_cObject</a>);
<a name="l04816"></a>04816         <a class="code" href="../../d2/d47/compile_8c.html#a3cfeb7549a1249a8b78f9d6ff1e74c5a">ADD_INSN1</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), getconstant, <a class="code" href="../../dc/d0c/cparse_8c.html#a48bfb6519a45249fb2ec0193ea3b6e1c">ID2SYM</a>(node-&gt;nd_mid));
<a name="l04817"></a>04817 
<a name="l04818"></a>04818         <span class="keywordflow">if</span> (iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a947d34698fb5a71f4938532fff27a0f7">compile_data</a>-&gt;<a class="code" href="../../d4/dd8/structiseq__compile__data.html#a3cde0c1bfeea6f8a80027a9e21a9759a">option</a>-&gt;<a class="code" href="../../db/dc1/structrb__compile__option__struct.html#a22c6ceaf348e1323e7c11afc0ac1201b">inline_const_cache</a>) {
<a name="l04819"></a>04819             <a class="code" href="../../d2/d47/compile_8c.html#a3cfeb7549a1249a8b78f9d6ff1e74c5a">ADD_INSN1</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), setinlinecache, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(ic_index));
<a name="l04820"></a>04820             <a class="code" href="../../d2/d47/compile_8c.html#a5a380bb449656575d6b77ccb8eb7e5ae">ADD_LABEL</a>(ret, lend);
<a name="l04821"></a>04821         }
<a name="l04822"></a>04822 
<a name="l04823"></a>04823         <span class="keywordflow">if</span> (poped) {
<a name="l04824"></a>04824             <a class="code" href="../../d2/d47/compile_8c.html#aa5b45ae61de3350f0830a32589bbb7ee">ADD_INSN</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), pop);
<a name="l04825"></a>04825         }
<a name="l04826"></a>04826         <span class="keywordflow">break</span>;
<a name="l04827"></a>04827       }
<a name="l04828"></a>04828       <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#af08e3ddc6c11af4918239aef9490687f">NODE_DOT2</a>:
<a name="l04829"></a>04829       <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#a9a66d4437b952e9a6bbcbcad6801fc31">NODE_DOT3</a>:{
<a name="l04830"></a>04830         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> flag = type == <a class="code" href="../../d3/d09/ripper_8y.html#af08e3ddc6c11af4918239aef9490687f">NODE_DOT2</a> ? <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(0) : <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(1);
<a name="l04831"></a>04831         <a class="code" href="../../d2/d47/compile_8c.html#a0cacd6cfca69df35e1535d2f21532c47">COMPILE</a>(ret, <span class="stringliteral">&quot;min&quot;</span>, (NODE *) node-&gt;nd_beg);
<a name="l04832"></a>04832         <a class="code" href="../../d2/d47/compile_8c.html#a0cacd6cfca69df35e1535d2f21532c47">COMPILE</a>(ret, <span class="stringliteral">&quot;max&quot;</span>, (NODE *) node-&gt;nd_end);
<a name="l04833"></a>04833         <span class="keywordflow">if</span> (poped) {
<a name="l04834"></a>04834             <a class="code" href="../../d2/d47/compile_8c.html#aa5b45ae61de3350f0830a32589bbb7ee">ADD_INSN</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), pop);
<a name="l04835"></a>04835             <a class="code" href="../../d2/d47/compile_8c.html#aa5b45ae61de3350f0830a32589bbb7ee">ADD_INSN</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), pop);
<a name="l04836"></a>04836         }
<a name="l04837"></a>04837         <span class="keywordflow">else</span> {
<a name="l04838"></a>04838             <a class="code" href="../../d2/d47/compile_8c.html#a3cfeb7549a1249a8b78f9d6ff1e74c5a">ADD_INSN1</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), newrange, flag);
<a name="l04839"></a>04839         }
<a name="l04840"></a>04840         <span class="keywordflow">break</span>;
<a name="l04841"></a>04841       }
<a name="l04842"></a>04842       <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#a8b309511f0b3dabe54732e6f19739609">NODE_FLIP2</a>:
<a name="l04843"></a>04843       <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#ab356b7f8605576fa62c0b0bdf41d8ff3">NODE_FLIP3</a>:{
<a name="l04844"></a>04844         <a class="code" href="../../d8/dc5/structiseq__label__data.html">LABEL</a> *lend = <a class="code" href="../../d2/d47/compile_8c.html#a1d6d5d8dac7aff9ac863255a0905c0f9">NEW_LABEL</a>(<a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node));
<a name="l04845"></a>04845         <a class="code" href="../../d8/dc5/structiseq__label__data.html">LABEL</a> *lfin = <a class="code" href="../../d2/d47/compile_8c.html#a1d6d5d8dac7aff9ac863255a0905c0f9">NEW_LABEL</a>(<a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node));
<a name="l04846"></a>04846         <a class="code" href="../../d8/dc5/structiseq__label__data.html">LABEL</a> *ltrue = <a class="code" href="../../d2/d47/compile_8c.html#a1d6d5d8dac7aff9ac863255a0905c0f9">NEW_LABEL</a>(<a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node));
<a name="l04847"></a>04847         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <a class="code" href="../../dc/de5/random_8c.html#a742229490b6759a90ece7ba82ba129d5">key</a> = <a class="code" href="../../d9/d2d/sprintf_8c.html#a05c34a91ab36c6a463c861df47808fae">rb_sprintf</a>(<span class="stringliteral">&quot;flipflag/%s-%p-%d&quot;</span>,
<a name="l04848"></a>04848                                <a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a35596da255ce28a5d1da94c2cc508c7d">name</a>), (<span class="keywordtype">void</span> *)iseq,
<a name="l04849"></a>04849                                iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a947d34698fb5a71f4938532fff27a0f7">compile_data</a>-&gt;<a class="code" href="../../d4/dd8/structiseq__compile__data.html#a9fd2f5c1b979ac73dc606797c625b51a">flip_cnt</a>++);
<a name="l04850"></a>04850 
<a name="l04851"></a>04851         <a class="code" href="../../d2/d47/compile_8c.html#ade60ac907df6825c414be22c432ba82a">hide_obj</a>(key);
<a name="l04852"></a>04852         <a class="code" href="../../d2/d47/compile_8c.html#ad09bab1521a935e4affe9c1faf9a27c5">iseq_add_mark_object_compile_time</a>(iseq, key);
<a name="l04853"></a>04853         <a class="code" href="../../d2/d47/compile_8c.html#a9e17ccfd8b31ec3afcb91be39a6d453f">ADD_INSN2</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), getspecial, key, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(0));
<a name="l04854"></a>04854         <a class="code" href="../../d2/d47/compile_8c.html#ace57e2f70722586d3764284364cfb5ad">ADD_INSNL</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), branchif, lend);
<a name="l04855"></a>04855 
<a name="l04856"></a>04856         <span class="comment">/* *flip == 0 */</span>
<a name="l04857"></a>04857         <a class="code" href="../../d2/d47/compile_8c.html#a0cacd6cfca69df35e1535d2f21532c47">COMPILE</a>(ret, <span class="stringliteral">&quot;flip2 beg&quot;</span>, node-&gt;nd_beg);
<a name="l04858"></a>04858         <a class="code" href="../../d2/d47/compile_8c.html#aa5b45ae61de3350f0830a32589bbb7ee">ADD_INSN</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), dup);
<a name="l04859"></a>04859         <a class="code" href="../../d2/d47/compile_8c.html#ace57e2f70722586d3764284364cfb5ad">ADD_INSNL</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), branchunless, lfin);
<a name="l04860"></a>04860         <span class="keywordflow">if</span> (<a class="code" href="../../d3/d09/ripper_8y.html#ade12c589b26f55f089dc25d689249c11">nd_type</a>(node) == <a class="code" href="../../d3/d09/ripper_8y.html#ab356b7f8605576fa62c0b0bdf41d8ff3">NODE_FLIP3</a>) {
<a name="l04861"></a>04861             <a class="code" href="../../d2/d47/compile_8c.html#aa5b45ae61de3350f0830a32589bbb7ee">ADD_INSN</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), dup);
<a name="l04862"></a>04862             <a class="code" href="../../d2/d47/compile_8c.html#a3cfeb7549a1249a8b78f9d6ff1e74c5a">ADD_INSN1</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), setspecial, key);
<a name="l04863"></a>04863             <a class="code" href="../../d2/d47/compile_8c.html#ace57e2f70722586d3764284364cfb5ad">ADD_INSNL</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), jump, lfin);
<a name="l04864"></a>04864         }
<a name="l04865"></a>04865         <span class="keywordflow">else</span> {
<a name="l04866"></a>04866             <a class="code" href="../../d2/d47/compile_8c.html#a3cfeb7549a1249a8b78f9d6ff1e74c5a">ADD_INSN1</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), setspecial, key);
<a name="l04867"></a>04867         }
<a name="l04868"></a>04868 
<a name="l04869"></a>04869         <span class="comment">/* *flip == 1 */</span>
<a name="l04870"></a>04870         <a class="code" href="../../d2/d47/compile_8c.html#a5a380bb449656575d6b77ccb8eb7e5ae">ADD_LABEL</a>(ret, lend);
<a name="l04871"></a>04871         <a class="code" href="../../d2/d47/compile_8c.html#a0cacd6cfca69df35e1535d2f21532c47">COMPILE</a>(ret, <span class="stringliteral">&quot;flip2 end&quot;</span>, node-&gt;nd_end);
<a name="l04872"></a>04872         <a class="code" href="../../d2/d47/compile_8c.html#ace57e2f70722586d3764284364cfb5ad">ADD_INSNL</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), branchunless, ltrue);
<a name="l04873"></a>04873         <a class="code" href="../../d2/d47/compile_8c.html#a3cfeb7549a1249a8b78f9d6ff1e74c5a">ADD_INSN1</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), putobject, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aba0717d2689eb68797421a02ab9295c6">Qfalse</a>);
<a name="l04874"></a>04874         <a class="code" href="../../d2/d47/compile_8c.html#a3cfeb7549a1249a8b78f9d6ff1e74c5a">ADD_INSN1</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), setspecial, key);
<a name="l04875"></a>04875 
<a name="l04876"></a>04876         <a class="code" href="../../d2/d47/compile_8c.html#a5a380bb449656575d6b77ccb8eb7e5ae">ADD_LABEL</a>(ret, ltrue);
<a name="l04877"></a>04877         <a class="code" href="../../d2/d47/compile_8c.html#a3cfeb7549a1249a8b78f9d6ff1e74c5a">ADD_INSN1</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), putobject, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aacea3516b33941ce8149098e223a7466">Qtrue</a>);
<a name="l04878"></a>04878 
<a name="l04879"></a>04879         <a class="code" href="../../d2/d47/compile_8c.html#a5a380bb449656575d6b77ccb8eb7e5ae">ADD_LABEL</a>(ret, lfin);
<a name="l04880"></a>04880         <span class="keywordflow">break</span>;
<a name="l04881"></a>04881       }
<a name="l04882"></a>04882       <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#a4beb90d7425a19420390f5f402c7cd7b">NODE_SELF</a>:{
<a name="l04883"></a>04883         <span class="keywordflow">if</span> (!poped) {
<a name="l04884"></a>04884             <a class="code" href="../../d2/d47/compile_8c.html#aa5b45ae61de3350f0830a32589bbb7ee">ADD_INSN</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), putself);
<a name="l04885"></a>04885         }
<a name="l04886"></a>04886         <span class="keywordflow">break</span>;
<a name="l04887"></a>04887       }
<a name="l04888"></a>04888       <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#a52160547548851ab924923b8ca1dcb42">NODE_NIL</a>:{
<a name="l04889"></a>04889         <span class="keywordflow">if</span> (!poped) {
<a name="l04890"></a>04890             <a class="code" href="../../d2/d47/compile_8c.html#aa5b45ae61de3350f0830a32589bbb7ee">ADD_INSN</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), putnil);
<a name="l04891"></a>04891         }
<a name="l04892"></a>04892         <span class="keywordflow">break</span>;
<a name="l04893"></a>04893       }
<a name="l04894"></a>04894       <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#a00911cb328ad9df305f886837c76923c">NODE_TRUE</a>:{
<a name="l04895"></a>04895         <span class="keywordflow">if</span> (!poped) {
<a name="l04896"></a>04896             <a class="code" href="../../d2/d47/compile_8c.html#a3cfeb7549a1249a8b78f9d6ff1e74c5a">ADD_INSN1</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), putobject, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aacea3516b33941ce8149098e223a7466">Qtrue</a>);
<a name="l04897"></a>04897         }
<a name="l04898"></a>04898         <span class="keywordflow">break</span>;
<a name="l04899"></a>04899       }
<a name="l04900"></a>04900       <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#aa66ba820f9577731ad767ba777d2e633">NODE_FALSE</a>:{
<a name="l04901"></a>04901         <span class="keywordflow">if</span> (!poped) {
<a name="l04902"></a>04902             <a class="code" href="../../d2/d47/compile_8c.html#a3cfeb7549a1249a8b78f9d6ff1e74c5a">ADD_INSN1</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), putobject, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aba0717d2689eb68797421a02ab9295c6">Qfalse</a>);
<a name="l04903"></a>04903         }
<a name="l04904"></a>04904         <span class="keywordflow">break</span>;
<a name="l04905"></a>04905       }
<a name="l04906"></a>04906       <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#a1ef166bb056e61d3375c561896bf24e7">NODE_ERRINFO</a>:{
<a name="l04907"></a>04907         <span class="keywordflow">if</span> (!poped) {
<a name="l04908"></a>04908             <span class="keywordflow">if</span> (iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#af8bc7dbae6f61d836b5bb9fb50b6cfb8">type</a> == ISEQ_TYPE_RESCUE) {
<a name="l04909"></a>04909                 <a class="code" href="../../d2/d47/compile_8c.html#a9e17ccfd8b31ec3afcb91be39a6d453f">ADD_INSN2</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), getdynamic, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(2), <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(0));
<a name="l04910"></a>04910             }
<a name="l04911"></a>04911             <span class="keywordflow">else</span> {
<a name="l04912"></a>04912                 <a class="code" href="../../d6/de3/structrb__iseq__struct.html">rb_iseq_t</a> *ip = iseq;
<a name="l04913"></a>04913                 <span class="keywordtype">int</span> level = 0;
<a name="l04914"></a>04914                 <span class="keywordflow">while</span> (ip) {
<a name="l04915"></a>04915                     <span class="keywordflow">if</span> (ip-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#af8bc7dbae6f61d836b5bb9fb50b6cfb8">type</a> == ISEQ_TYPE_RESCUE) {
<a name="l04916"></a>04916                         <span class="keywordflow">break</span>;
<a name="l04917"></a>04917                     }
<a name="l04918"></a>04918                     ip = ip-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#afce02da209c0bf9a09ef4ea0af68e623">parent_iseq</a>;
<a name="l04919"></a>04919                     level++;
<a name="l04920"></a>04920                 }
<a name="l04921"></a>04921                 <span class="keywordflow">if</span> (ip) {
<a name="l04922"></a>04922                     <a class="code" href="../../d2/d47/compile_8c.html#a9e17ccfd8b31ec3afcb91be39a6d453f">ADD_INSN2</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), getdynamic, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(2), <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(level));
<a name="l04923"></a>04923                 }
<a name="l04924"></a>04924                 <span class="keywordflow">else</span> {
<a name="l04925"></a>04925                     <a class="code" href="../../d2/d47/compile_8c.html#aa5b45ae61de3350f0830a32589bbb7ee">ADD_INSN</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), putnil);
<a name="l04926"></a>04926                 }
<a name="l04927"></a>04927             }
<a name="l04928"></a>04928         }
<a name="l04929"></a>04929         <span class="keywordflow">break</span>;
<a name="l04930"></a>04930       }
<a name="l04931"></a>04931       <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#a9a02a48d7532185f602ab2eee4e7b79a">NODE_DEFINED</a>:{
<a name="l04932"></a>04932         <span class="keywordflow">if</span> (!poped) {
<a name="l04933"></a>04933             <a class="code" href="../../d8/dc5/structiseq__label__data.html">LABEL</a> *lfinish[2];
<a name="l04934"></a>04934             lfinish[0] = <a class="code" href="../../d2/d47/compile_8c.html#a1d6d5d8dac7aff9ac863255a0905c0f9">NEW_LABEL</a>(<a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node));
<a name="l04935"></a>04935             lfinish[1] = 0;
<a name="l04936"></a>04936             <a class="code" href="../../d2/d47/compile_8c.html#aa5b45ae61de3350f0830a32589bbb7ee">ADD_INSN</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), putnil);
<a name="l04937"></a>04937             <a class="code" href="../../d2/d47/compile_8c.html#af63fe831dd3325e6beeba0a4c6127159">defined_expr</a>(iseq, ret, node-&gt;nd_head, lfinish, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aacea3516b33941ce8149098e223a7466">Qtrue</a>);
<a name="l04938"></a>04938             <a class="code" href="../../d2/d47/compile_8c.html#aa5b45ae61de3350f0830a32589bbb7ee">ADD_INSN</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), swap);
<a name="l04939"></a>04939             <a class="code" href="../../d2/d47/compile_8c.html#aa5b45ae61de3350f0830a32589bbb7ee">ADD_INSN</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), pop);
<a name="l04940"></a>04940             <span class="keywordflow">if</span> (lfinish[1]) {
<a name="l04941"></a>04941                 <a class="code" href="../../d2/d47/compile_8c.html#a5a380bb449656575d6b77ccb8eb7e5ae">ADD_LABEL</a>(ret, lfinish[1]);
<a name="l04942"></a>04942             }
<a name="l04943"></a>04943             <a class="code" href="../../d2/d47/compile_8c.html#a5a380bb449656575d6b77ccb8eb7e5ae">ADD_LABEL</a>(ret, lfinish[0]);
<a name="l04944"></a>04944         }
<a name="l04945"></a>04945         <span class="keywordflow">break</span>;
<a name="l04946"></a>04946       }
<a name="l04947"></a>04947       <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#aa672b8251edf71e8aee4a1a542451a92">NODE_POSTEXE</a>:{
<a name="l04948"></a>04948         <a class="code" href="../../d8/dc5/structiseq__label__data.html">LABEL</a> *lend = <a class="code" href="../../d2/d47/compile_8c.html#a1d6d5d8dac7aff9ac863255a0905c0f9">NEW_LABEL</a>(<a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node));
<a name="l04949"></a>04949         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> block = <a class="code" href="../../d2/d47/compile_8c.html#a8b46ed4917f951327df16ff64ed8f67c">NEW_CHILD_ISEQVAL</a>(node-&gt;nd_body, <a class="code" href="../../d2/d47/compile_8c.html#a046ec40ada559492235ee811126bafda">make_name_for_block</a>(iseq), ISEQ_TYPE_BLOCK, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node));
<a name="l04950"></a>04950         <span class="keywordtype">int</span> ic_index = iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a72aee3eed9e9842166e381972a35e9fb">ic_size</a>++;
<a name="l04951"></a>04951 
<a name="l04952"></a>04952         <a class="code" href="../../d2/d47/compile_8c.html#a9e17ccfd8b31ec3afcb91be39a6d453f">ADD_INSN2</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), onceinlinecache, lend, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(ic_index));
<a name="l04953"></a>04953         <a class="code" href="../../d2/d47/compile_8c.html#aa5b45ae61de3350f0830a32589bbb7ee">ADD_INSN</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), pop);
<a name="l04954"></a>04954 
<a name="l04955"></a>04955         <a class="code" href="../../d2/d47/compile_8c.html#a3cfeb7549a1249a8b78f9d6ff1e74c5a">ADD_INSN1</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), putspecialobject, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(<a class="code" href="../../d8/d32/vm__core_8h.html#a3aec522068d95925054562a7c650b99ba932f2eddae25cf0eab7b034b17ad1935">VM_SPECIAL_OBJECT_VMCORE</a>));
<a name="l04956"></a>04956         <a class="code" href="../../d2/d47/compile_8c.html#a3cfeb7549a1249a8b78f9d6ff1e74c5a">ADD_INSN1</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), putiseq, block);
<a name="l04957"></a>04957         <a class="code" href="../../d2/d47/compile_8c.html#ab1941f9308f4508ab33b8828fec890fd">ADD_SEND</a> (ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), <a class="code" href="../../dc/d0c/cparse_8c.html#a48bfb6519a45249fb2ec0193ea3b6e1c">ID2SYM</a>(<a class="code" href="../../d5/d11/ripper_8c.html#abb0693b6ab8e95a8e1280ecbb8b9360b">id_core_set_postexe</a>), <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(1));
<a name="l04958"></a>04958 
<a name="l04959"></a>04959         <a class="code" href="../../d2/d47/compile_8c.html#a3cfeb7549a1249a8b78f9d6ff1e74c5a">ADD_INSN1</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), setinlinecache, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(ic_index));
<a name="l04960"></a>04960         <a class="code" href="../../d2/d47/compile_8c.html#a5a380bb449656575d6b77ccb8eb7e5ae">ADD_LABEL</a>(ret, lend);
<a name="l04961"></a>04961 
<a name="l04962"></a>04962         <span class="keywordflow">if</span> (poped) {
<a name="l04963"></a>04963             <a class="code" href="../../d2/d47/compile_8c.html#aa5b45ae61de3350f0830a32589bbb7ee">ADD_INSN</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), pop);
<a name="l04964"></a>04964         }
<a name="l04965"></a>04965         <span class="keywordflow">break</span>;
<a name="l04966"></a>04966       }
<a name="l04967"></a>04967       <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#ab102222ffbe5118d93d37b103876fc44">NODE_DSYM</a>:{
<a name="l04968"></a>04968         <a class="code" href="../../d2/d47/compile_8c.html#a5beb4b71176a85495ad1fbeaaee7bd86">compile_dstr</a>(iseq, ret, node);
<a name="l04969"></a>04969         <span class="keywordflow">if</span> (!poped) {
<a name="l04970"></a>04970             <a class="code" href="../../d2/d47/compile_8c.html#ab1941f9308f4508ab33b8828fec890fd">ADD_SEND</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), <a class="code" href="../../dc/d0c/cparse_8c.html#a48bfb6519a45249fb2ec0193ea3b6e1c">ID2SYM</a>(idIntern), <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(0));
<a name="l04971"></a>04971         }
<a name="l04972"></a>04972         <span class="keywordflow">else</span> {
<a name="l04973"></a>04973             <a class="code" href="../../d2/d47/compile_8c.html#aa5b45ae61de3350f0830a32589bbb7ee">ADD_INSN</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), pop);
<a name="l04974"></a>04974         }
<a name="l04975"></a>04975         <span class="keywordflow">break</span>;
<a name="l04976"></a>04976       }
<a name="l04977"></a>04977       <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#a1423dff9c55fd36cca257ffb758ca4a6">NODE_ATTRASGN</a>:{
<a name="l04978"></a>04978         <a class="code" href="../../d2/d47/compile_8c.html#aa9d6014cec8d3adcb228b81620eac795">DECL_ANCHOR</a>(recv);
<a name="l04979"></a>04979         <a class="code" href="../../d2/d47/compile_8c.html#aa9d6014cec8d3adcb228b81620eac795">DECL_ANCHOR</a>(<a class="code" href="../../d3/d09/ripper_8y.html#a8187411843a6284ffb964ef3fb9fcab3">args</a>);
<a name="l04980"></a>04980         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> flag = 0;
<a name="l04981"></a>04981         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> argc;
<a name="l04982"></a>04982 
<a name="l04983"></a>04983         <a class="code" href="../../d2/d47/compile_8c.html#ac32b1f7d8de8f10f33a147030d8b7544">INIT_ANCHOR</a>(recv);
<a name="l04984"></a>04984         <a class="code" href="../../d2/d47/compile_8c.html#ac32b1f7d8de8f10f33a147030d8b7544">INIT_ANCHOR</a>(<a class="code" href="../../d3/d09/ripper_8y.html#a8187411843a6284ffb964ef3fb9fcab3">args</a>);
<a name="l04985"></a>04985         argc = <a class="code" href="../../d2/d47/compile_8c.html#ab6ce5708d11d498cf4924186b39820c2">setup_args</a>(iseq, <a class="code" href="../../d3/d09/ripper_8y.html#a8187411843a6284ffb964ef3fb9fcab3">args</a>, node-&gt;nd_args, &amp;flag);
<a name="l04986"></a>04986 
<a name="l04987"></a>04987         <span class="keywordflow">if</span> (node-&gt;nd_recv == (NODE *) 1) {
<a name="l04988"></a>04988             flag |= <a class="code" href="../../d8/d32/vm__core_8h.html#a607d3c76b00f3a7c33fa4b9ba3635e8b">VM_CALL_FCALL_BIT</a>;
<a name="l04989"></a>04989             <a class="code" href="../../d2/d47/compile_8c.html#aa5b45ae61de3350f0830a32589bbb7ee">ADD_INSN</a>(recv, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), putself);
<a name="l04990"></a>04990         }
<a name="l04991"></a>04991         <span class="keywordflow">else</span> {
<a name="l04992"></a>04992             <a class="code" href="../../d2/d47/compile_8c.html#a0cacd6cfca69df35e1535d2f21532c47">COMPILE</a>(recv, <span class="stringliteral">&quot;recv&quot;</span>, node-&gt;nd_recv);
<a name="l04993"></a>04993         }
<a name="l04994"></a>04994 
<a name="l04995"></a>04995         <a class="code" href="../../d2/d47/compile_8c.html#ad983bdc29f9c5bde5ab33d14c3d143e6">debugp_param</a>(<span class="stringliteral">&quot;argc&quot;</span>, argc);
<a name="l04996"></a>04996         <a class="code" href="../../d2/d47/compile_8c.html#ad983bdc29f9c5bde5ab33d14c3d143e6">debugp_param</a>(<span class="stringliteral">&quot;nd_mid&quot;</span>, <a class="code" href="../../dc/d0c/cparse_8c.html#a48bfb6519a45249fb2ec0193ea3b6e1c">ID2SYM</a>(node-&gt;nd_mid));
<a name="l04997"></a>04997 
<a name="l04998"></a>04998         <span class="keywordflow">if</span> (!poped) {
<a name="l04999"></a>04999             <a class="code" href="../../d2/d47/compile_8c.html#aa5b45ae61de3350f0830a32589bbb7ee">ADD_INSN</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), putnil);
<a name="l05000"></a>05000             <a class="code" href="../../d2/d47/compile_8c.html#afd9d72d069724385c83bcc32d6746b1e">ADD_SEQ</a>(ret, recv);
<a name="l05001"></a>05001             <a class="code" href="../../d2/d47/compile_8c.html#afd9d72d069724385c83bcc32d6746b1e">ADD_SEQ</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a8187411843a6284ffb964ef3fb9fcab3">args</a>);
<a name="l05002"></a>05002 
<a name="l05003"></a>05003             <span class="keywordflow">if</span> (flag &amp; <a class="code" href="../../d8/d32/vm__core_8h.html#aee4df54d62a5eb107fdd8757de767ee6">VM_CALL_ARGS_BLOCKARG_BIT</a>) {
<a name="l05004"></a>05004                 <a class="code" href="../../d2/d47/compile_8c.html#a3cfeb7549a1249a8b78f9d6ff1e74c5a">ADD_INSN1</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), topn, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(1));
<a name="l05005"></a>05005                 <span class="keywordflow">if</span> (flag &amp; <a class="code" href="../../d8/d32/vm__core_8h.html#a56aad9fa74696d2a86028361323a75a6">VM_CALL_ARGS_SPLAT_BIT</a>) {
<a name="l05006"></a>05006                     <a class="code" href="../../d2/d47/compile_8c.html#a3cfeb7549a1249a8b78f9d6ff1e74c5a">ADD_INSN1</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), putobject, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(-1));
<a name="l05007"></a>05007                     <a class="code" href="../../d2/d47/compile_8c.html#ab1941f9308f4508ab33b8828fec890fd">ADD_SEND</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), <a class="code" href="../../dc/d0c/cparse_8c.html#a48bfb6519a45249fb2ec0193ea3b6e1c">ID2SYM</a>(<a class="code" href="../../df/db9/id_8h.html#a08dd4fbd61c5fde369edd59783f753b3a700fe924530f27c93c81ba548682f680">idAREF</a>), <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(1));
<a name="l05008"></a>05008                 }
<a name="l05009"></a>05009                 <a class="code" href="../../d2/d47/compile_8c.html#a3cfeb7549a1249a8b78f9d6ff1e74c5a">ADD_INSN1</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), setn, <a class="code" href="../../d2/d47/compile_8c.html#acd55fe1710206f036b5e80795eae3284">FIXNUM_INC</a>(argc, 3));
<a name="l05010"></a>05010                 <a class="code" href="../../d2/d47/compile_8c.html#aa5b45ae61de3350f0830a32589bbb7ee">ADD_INSN</a> (ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), pop);
<a name="l05011"></a>05011             }
<a name="l05012"></a>05012             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (flag &amp; <a class="code" href="../../d8/d32/vm__core_8h.html#a56aad9fa74696d2a86028361323a75a6">VM_CALL_ARGS_SPLAT_BIT</a>) {
<a name="l05013"></a>05013                 <a class="code" href="../../d2/d47/compile_8c.html#aa5b45ae61de3350f0830a32589bbb7ee">ADD_INSN</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), dup);
<a name="l05014"></a>05014                 <a class="code" href="../../d2/d47/compile_8c.html#a3cfeb7549a1249a8b78f9d6ff1e74c5a">ADD_INSN1</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), putobject, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(-1));
<a name="l05015"></a>05015                 <a class="code" href="../../d2/d47/compile_8c.html#ab1941f9308f4508ab33b8828fec890fd">ADD_SEND</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), <a class="code" href="../../dc/d0c/cparse_8c.html#a48bfb6519a45249fb2ec0193ea3b6e1c">ID2SYM</a>(<a class="code" href="../../df/db9/id_8h.html#a08dd4fbd61c5fde369edd59783f753b3a700fe924530f27c93c81ba548682f680">idAREF</a>), <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(1));
<a name="l05016"></a>05016                 <a class="code" href="../../d2/d47/compile_8c.html#a3cfeb7549a1249a8b78f9d6ff1e74c5a">ADD_INSN1</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), setn, <a class="code" href="../../d2/d47/compile_8c.html#acd55fe1710206f036b5e80795eae3284">FIXNUM_INC</a>(argc, 2));
<a name="l05017"></a>05017                 <a class="code" href="../../d2/d47/compile_8c.html#aa5b45ae61de3350f0830a32589bbb7ee">ADD_INSN</a> (ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), pop);
<a name="l05018"></a>05018             }
<a name="l05019"></a>05019             <span class="keywordflow">else</span> {
<a name="l05020"></a>05020                 <a class="code" href="../../d2/d47/compile_8c.html#a3cfeb7549a1249a8b78f9d6ff1e74c5a">ADD_INSN1</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), setn, <a class="code" href="../../d2/d47/compile_8c.html#acd55fe1710206f036b5e80795eae3284">FIXNUM_INC</a>(argc, 1));
<a name="l05021"></a>05021             }
<a name="l05022"></a>05022         }
<a name="l05023"></a>05023         <span class="keywordflow">else</span> {
<a name="l05024"></a>05024             <a class="code" href="../../d2/d47/compile_8c.html#afd9d72d069724385c83bcc32d6746b1e">ADD_SEQ</a>(ret, recv);
<a name="l05025"></a>05025             <a class="code" href="../../d2/d47/compile_8c.html#afd9d72d069724385c83bcc32d6746b1e">ADD_SEQ</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a8187411843a6284ffb964ef3fb9fcab3">args</a>);
<a name="l05026"></a>05026         }
<a name="l05027"></a>05027         <a class="code" href="../../d2/d47/compile_8c.html#a8e30721d838a4a66104bbecb561ef0c9">ADD_SEND_R</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), <a class="code" href="../../dc/d0c/cparse_8c.html#a48bfb6519a45249fb2ec0193ea3b6e1c">ID2SYM</a>(node-&gt;nd_mid), argc, 0, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a2ead2f64c81efed352e79e89f29b8fc8">LONG2FIX</a>(flag));
<a name="l05028"></a>05028         <a class="code" href="../../d2/d47/compile_8c.html#aa5b45ae61de3350f0830a32589bbb7ee">ADD_INSN</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), pop);
<a name="l05029"></a>05029 
<a name="l05030"></a>05030         <span class="keywordflow">break</span>;
<a name="l05031"></a>05031       }
<a name="l05032"></a>05032       <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#ad13c06599208704f1b6ce18e61e08646">NODE_OPTBLOCK</a>:{
<a name="l05033"></a>05033         <span class="comment">/* for optimize */</span>
<a name="l05034"></a>05034         <a class="code" href="../../d8/dc5/structiseq__label__data.html">LABEL</a> *redo_label = <a class="code" href="../../d2/d47/compile_8c.html#a1d6d5d8dac7aff9ac863255a0905c0f9">NEW_LABEL</a>(0);
<a name="l05035"></a>05035         <a class="code" href="../../d8/dc5/structiseq__label__data.html">LABEL</a> *next_label = <a class="code" href="../../d2/d47/compile_8c.html#a1d6d5d8dac7aff9ac863255a0905c0f9">NEW_LABEL</a>(0);
<a name="l05036"></a>05036 
<a name="l05037"></a>05037         iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a947d34698fb5a71f4938532fff27a0f7">compile_data</a>-&gt;<a class="code" href="../../d4/dd8/structiseq__compile__data.html#a055ae44f47869f10dda6b21a2433fa1e">start_label</a> = next_label;
<a name="l05038"></a>05038         iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a947d34698fb5a71f4938532fff27a0f7">compile_data</a>-&gt;<a class="code" href="../../d4/dd8/structiseq__compile__data.html#a31238638ba93181cc34093e9199b4dc8">redo_label</a> = redo_label;
<a name="l05039"></a>05039 
<a name="l05040"></a>05040         <a class="code" href="../../d2/d47/compile_8c.html#a5a380bb449656575d6b77ccb8eb7e5ae">ADD_LABEL</a>(ret, redo_label);
<a name="l05041"></a>05041         <a class="code" href="../../d2/d47/compile_8c.html#a04d4dbcbb97179b5908eb025e13c7752">COMPILE_</a>(ret, <span class="stringliteral">&quot;optblock body&quot;</span>, node-&gt;nd_head, 1 <span class="comment">/* pop */</span> );
<a name="l05042"></a>05042         <a class="code" href="../../d2/d47/compile_8c.html#a5a380bb449656575d6b77ccb8eb7e5ae">ADD_LABEL</a>(ret, next_label);
<a name="l05043"></a>05043         <a class="code" href="../../d2/d47/compile_8c.html#aa5b45ae61de3350f0830a32589bbb7ee">ADD_INSN</a>(ret, 0, opt_checkenv);
<a name="l05044"></a>05044         <span class="keywordflow">break</span>;
<a name="l05045"></a>05045       }
<a name="l05046"></a>05046       <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#a76b74f188d07df52edd15169b49ff1c5">NODE_PRELUDE</a>:{
<a name="l05047"></a>05047         <a class="code" href="../../d2/d47/compile_8c.html#a4e7115fce9f91ee84931798cc3474229">COMPILE_POPED</a>(ret, <span class="stringliteral">&quot;prelude&quot;</span>, node-&gt;nd_head);
<a name="l05048"></a>05048         <a class="code" href="../../d2/d47/compile_8c.html#a04d4dbcbb97179b5908eb025e13c7752">COMPILE_</a>(ret, <span class="stringliteral">&quot;body&quot;</span>, node-&gt;nd_body, poped);
<a name="l05049"></a>05049         <span class="keywordflow">break</span>;
<a name="l05050"></a>05050       }
<a name="l05051"></a>05051       <span class="keywordflow">case</span> <a class="code" href="../../d3/d09/ripper_8y.html#aebc63da450ca40eb13dac5c5cd0ed4e0">NODE_LAMBDA</a>:{
<a name="l05052"></a>05052         <span class="comment">/* compile same as lambda{...} */</span>
<a name="l05053"></a>05053         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> block = <a class="code" href="../../d2/d47/compile_8c.html#a8b46ed4917f951327df16ff64ed8f67c">NEW_CHILD_ISEQVAL</a>(node-&gt;nd_body, <a class="code" href="../../d2/d47/compile_8c.html#a046ec40ada559492235ee811126bafda">make_name_for_block</a>(iseq), ISEQ_TYPE_BLOCK, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node));
<a name="l05054"></a>05054         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> argc = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(0);
<a name="l05055"></a>05055         <a class="code" href="../../d2/d47/compile_8c.html#a3cfeb7549a1249a8b78f9d6ff1e74c5a">ADD_INSN1</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), putspecialobject, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(<a class="code" href="../../d8/d32/vm__core_8h.html#a3aec522068d95925054562a7c650b99ba932f2eddae25cf0eab7b034b17ad1935">VM_SPECIAL_OBJECT_VMCORE</a>));
<a name="l05056"></a>05056         <a class="code" href="../../d2/d47/compile_8c.html#aeddf6949862a74eba2b7f2fa8f6fa1c4">ADD_CALL_WITH_BLOCK</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), <a class="code" href="../../dc/d0c/cparse_8c.html#a48bfb6519a45249fb2ec0193ea3b6e1c">ID2SYM</a>(idLambda), argc, block);
<a name="l05057"></a>05057 
<a name="l05058"></a>05058         <span class="keywordflow">if</span> (poped) {
<a name="l05059"></a>05059             <a class="code" href="../../d2/d47/compile_8c.html#aa5b45ae61de3350f0830a32589bbb7ee">ADD_INSN</a>(ret, <a class="code" href="../../d3/d09/ripper_8y.html#a532b1472e32368b65ce9351c1abc2c02">nd_line</a>(node), pop);
<a name="l05060"></a>05060         }
<a name="l05061"></a>05061         <span class="keywordflow">break</span>;
<a name="l05062"></a>05062       }
<a name="l05063"></a>05063       <span class="keywordflow">default</span>:
<a name="l05064"></a>05064         <a class="code" href="../../db/dcc/error_8c.html#a2d5fb28e54f792e7341b2c45f52f3860">rb_bug</a>(<span class="stringliteral">&quot;iseq_compile_each: unknown node: %s&quot;</span>, <a class="code" href="../../dd/d74/iseq_8c.html#a818834c71f4a58f5bd7f0aa142d1b069">ruby_node_name</a>(type));
<a name="l05065"></a>05065         <span class="keywordflow">return</span> <a class="code" href="../../d2/d47/compile_8c.html#aa724e736e164cb8324479ba5b87e386c">COMPILE_NG</a>;
<a name="l05066"></a>05066     }
<a name="l05067"></a>05067 
<a name="l05068"></a>05068     <a class="code" href="../../d2/d47/compile_8c.html#a4f7ac050d78d7eb204448c261e105474">debug_node_end</a>();
<a name="l05069"></a>05069     <span class="keywordflow">return</span> <a class="code" href="../../d2/d47/compile_8c.html#a652dda0d529b866959c19fe27293968e">COMPILE_OK</a>;
<a name="l05070"></a>05070 }
<a name="l05071"></a>05071 
<a name="l05072"></a>05072 <span class="comment">/***************************/</span>
<a name="l05073"></a>05073 <span class="comment">/* instruction information */</span>
<a name="l05074"></a>05074 <span class="comment">/***************************/</span>
<a name="l05075"></a>05075 
<a name="l05076"></a>05076 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l05077"></a><a class="code" href="../../d2/d47/compile_8c.html#a7023a7b2b11a4a2e586982cd2433a287">05077</a> <a class="code" href="../../d2/d47/compile_8c.html#a7023a7b2b11a4a2e586982cd2433a287">insn_data_length</a>(<a class="code" href="../../db/d57/structiseq__insn__data.html">INSN</a> *iobj)
<a name="l05078"></a>05078 {
<a name="l05079"></a>05079     <span class="keywordflow">return</span> insn_len(iobj-&gt;<a class="code" href="../../db/d57/structiseq__insn__data.html#ab1f1e3095532dd0ece9bb256047a027e">insn_id</a>);
<a name="l05080"></a>05080 }
<a name="l05081"></a>05081 
<a name="l05082"></a>05082 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l05083"></a><a class="code" href="../../d2/d47/compile_8c.html#a75f827592179e7c7f0ce0dcff815ee15">05083</a> <a class="code" href="../../d2/d47/compile_8c.html#a75f827592179e7c7f0ce0dcff815ee15">calc_sp_depth</a>(<span class="keywordtype">int</span> depth, <a class="code" href="../../db/d57/structiseq__insn__data.html">INSN</a> *insn)
<a name="l05084"></a>05084 {
<a name="l05085"></a>05085     <span class="keywordflow">return</span> insn_stack_increase(depth, insn-&gt;<a class="code" href="../../db/d57/structiseq__insn__data.html#ab1f1e3095532dd0ece9bb256047a027e">insn_id</a>, insn-&gt;<a class="code" href="../../db/d57/structiseq__insn__data.html#ae83a50dd669328f4915717f99d8805c5">operands</a>);
<a name="l05086"></a>05086 }
<a name="l05087"></a>05087 
<a name="l05088"></a>05088 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l05089"></a><a class="code" href="../../d2/d47/compile_8c.html#ab4ffd76d837f5780720b66918da794c3">05089</a> <a class="code" href="../../d2/d47/compile_8c.html#ab4ffd76d837f5780720b66918da794c3">insn_data_line_no</a>(<a class="code" href="../../db/d57/structiseq__insn__data.html">INSN</a> *iobj)
<a name="l05090"></a>05090 {
<a name="l05091"></a>05091     <span class="keywordflow">return</span> insn_len(iobj-&gt;<a class="code" href="../../db/d57/structiseq__insn__data.html#a7da955a957d6555a0c0454dee8508669">line_no</a>);
<a name="l05092"></a>05092 }
<a name="l05093"></a>05093 
<a name="l05094"></a>05094 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l05095"></a><a class="code" href="../../d2/d47/compile_8c.html#a70ed76742733ff31aae3ebb7125ea2d5">05095</a> <a class="code" href="../../d2/d47/compile_8c.html#a70ed76742733ff31aae3ebb7125ea2d5">insn_data_to_s_detail</a>(<a class="code" href="../../db/d57/structiseq__insn__data.html">INSN</a> *iobj)
<a name="l05096"></a>05096 {
<a name="l05097"></a>05097     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str = <a class="code" href="../../d9/d2d/sprintf_8c.html#a05c34a91ab36c6a463c861df47808fae">rb_sprintf</a>(<span class="stringliteral">&quot;%-16s&quot;</span>, insn_name(iobj-&gt;<a class="code" href="../../db/d57/structiseq__insn__data.html#ab1f1e3095532dd0ece9bb256047a027e">insn_id</a>));
<a name="l05098"></a>05098 
<a name="l05099"></a>05099     <span class="keywordflow">if</span> (iobj-&gt;<a class="code" href="../../db/d57/structiseq__insn__data.html#ae83a50dd669328f4915717f99d8805c5">operands</a>) {
<a name="l05100"></a>05100         <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d5/de2/structtypes.html">types</a> = insn_op_types(iobj-&gt;<a class="code" href="../../db/d57/structiseq__insn__data.html#ab1f1e3095532dd0ece9bb256047a027e">insn_id</a>);
<a name="l05101"></a>05101         <span class="keywordtype">int</span> j;
<a name="l05102"></a>05102 
<a name="l05103"></a>05103         <span class="keywordflow">for</span> (j = 0; types[j]; j++) {
<a name="l05104"></a>05104             <span class="keywordtype">char</span> <a class="code" href="../../d5/d9d/tcltklib_8c.html#ac765329451135abec74c45e1897abf26">type</a> = types[j];
<a name="l05105"></a>05105             printf(<span class="stringliteral">&quot;str: %&quot;</span><a class="code" href="../../de/de6/ruby_2ruby_8h.html#aa1bf33f94a5de592de48c16fcfe86db2">PRIxVALUE</a><span class="stringliteral">&quot;, type: %c\n&quot;</span>, str, type);
<a name="l05106"></a>05106 
<a name="l05107"></a>05107             <span class="keywordflow">switch</span> (type) {
<a name="l05108"></a>05108               <span class="keywordflow">case</span> TS_OFFSET:   <span class="comment">/* label(destination position) */</span>
<a name="l05109"></a>05109                 {
<a name="l05110"></a>05110                     <a class="code" href="../../d8/dc5/structiseq__label__data.html">LABEL</a> *lobj = (<a class="code" href="../../d8/dc5/structiseq__label__data.html">LABEL</a> *)<a class="code" href="../../d2/d47/compile_8c.html#accd7d8e5aae40bb4eecd61fb8d6c65cc">OPERAND_AT</a>(iobj, j);
<a name="l05111"></a>05111                     <a class="code" href="../../d9/d2d/sprintf_8c.html#a01a3022a41f713613342bbaba9ac9359">rb_str_catf</a>(str, <span class="stringliteral">&quot;&lt;L%03d&gt;&quot;</span>, lobj-&gt;<a class="code" href="../../d8/dc5/structiseq__label__data.html#ae41778d86068bb63216de9834cfbce7e">label_no</a>);
<a name="l05112"></a>05112                     <span class="keywordflow">break</span>;
<a name="l05113"></a>05113                 }
<a name="l05114"></a>05114                 <span class="keywordflow">break</span>;
<a name="l05115"></a>05115               <span class="keywordflow">case</span> TS_ISEQ:     <span class="comment">/* iseq */</span>
<a name="l05116"></a>05116                 {
<a name="l05117"></a>05117                     <a class="code" href="../../d6/de3/structrb__iseq__struct.html">rb_iseq_t</a> *iseq = (<a class="code" href="../../d6/de3/structrb__iseq__struct.html">rb_iseq_t</a> *)<a class="code" href="../../d2/d47/compile_8c.html#accd7d8e5aae40bb4eecd61fb8d6c65cc">OPERAND_AT</a>(iobj, j);
<a name="l05118"></a>05118                     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> val = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a320970f989dc8294c8203154e3db40c1">Qnil</a>;
<a name="l05119"></a>05119                     <span class="keywordflow">if</span> (iseq) {
<a name="l05120"></a>05120                         val = iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a46d5fb5c3de970a9540ab85d4b060957">self</a>;
<a name="l05121"></a>05121                     }
<a name="l05122"></a>05122                     <a class="code" href="../../db/d2e/intern_8h.html#a2f12f7ad949fa2e6abb64f2311c6e2c5">rb_str_concat</a>(str, <a class="code" href="../../db/d2e/intern_8h.html#acbb281bacf6b80f460143348e26142e9">rb_inspect</a>(val));
<a name="l05123"></a>05123                 }
<a name="l05124"></a>05124                 <span class="keywordflow">break</span>;
<a name="l05125"></a>05125               <span class="keywordflow">case</span> TS_LINDEX:
<a name="l05126"></a>05126               <span class="keywordflow">case</span> TS_DINDEX:
<a name="l05127"></a>05127               <span class="keywordflow">case</span> TS_NUM:      <span class="comment">/* ulong */</span>
<a name="l05128"></a>05128               <span class="keywordflow">case</span> TS_VALUE:    <span class="comment">/* VALUE */</span>
<a name="l05129"></a>05129                 <a class="code" href="../../db/d2e/intern_8h.html#a2f12f7ad949fa2e6abb64f2311c6e2c5">rb_str_concat</a>(str, <a class="code" href="../../db/d2e/intern_8h.html#acbb281bacf6b80f460143348e26142e9">rb_inspect</a>(<a class="code" href="../../d2/d47/compile_8c.html#accd7d8e5aae40bb4eecd61fb8d6c65cc">OPERAND_AT</a>(iobj, j)));
<a name="l05130"></a>05130                 <span class="keywordflow">break</span>;
<a name="l05131"></a>05131               <span class="keywordflow">case</span> TS_ID:       <span class="comment">/* ID */</span>
<a name="l05132"></a>05132                 <a class="code" href="../../db/d2e/intern_8h.html#a2f12f7ad949fa2e6abb64f2311c6e2c5">rb_str_concat</a>(str, <a class="code" href="../../db/d2e/intern_8h.html#acbb281bacf6b80f460143348e26142e9">rb_inspect</a>(<a class="code" href="../../d2/d47/compile_8c.html#accd7d8e5aae40bb4eecd61fb8d6c65cc">OPERAND_AT</a>(iobj, j)));
<a name="l05133"></a>05133                 <span class="keywordflow">break</span>;
<a name="l05134"></a>05134               <span class="keywordflow">case</span> TS_GENTRY:
<a name="l05135"></a>05135                 {
<a name="l05136"></a>05136                     <span class="keyword">struct </span><a class="code" href="../../d0/d2a/variable_8c.html#a26a48bec8ff714d9e7f76d881a7d248f">rb_global_entry</a> *entry = (<span class="keyword">struct </span><a class="code" href="../../d0/d2a/variable_8c.html#a26a48bec8ff714d9e7f76d881a7d248f">rb_global_entry</a> *)
<a name="l05137"></a>05137                       (<a class="code" href="../../d2/d47/compile_8c.html#accd7d8e5aae40bb4eecd61fb8d6c65cc">OPERAND_AT</a>(iobj, j) &amp; (~1));
<a name="l05138"></a>05138                     <a class="code" href="../../db/d2e/intern_8h.html#a5bd27db3e38af6131db24321c7cf9ec6">rb_str_cat2</a>(str, <a class="code" href="../../d5/d11/ripper_8c.html#a877bc58c495643fcf49dc64c44631e72">rb_id2name</a>(entry-&gt;id));
<a name="l05139"></a>05139                 }
<a name="l05140"></a>05140               <span class="keywordflow">case</span> TS_IC:       <span class="comment">/* method cache */</span>
<a name="l05141"></a>05141                 <a class="code" href="../../d9/d2d/sprintf_8c.html#a01a3022a41f713613342bbaba9ac9359">rb_str_catf</a>(str, <span class="stringliteral">&quot;&lt;ic:%d&gt;&quot;</span>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a9444c431b3cb1184e7523fc572f2c758">FIX2INT</a>(<a class="code" href="../../d2/d47/compile_8c.html#accd7d8e5aae40bb4eecd61fb8d6c65cc">OPERAND_AT</a>(iobj, j)));
<a name="l05142"></a>05142                 <span class="keywordflow">break</span>;
<a name="l05143"></a>05143               <span class="keywordflow">case</span> TS_CDHASH:   <span class="comment">/* case/when condition cache */</span>
<a name="l05144"></a>05144                 <a class="code" href="../../db/d2e/intern_8h.html#a5bd27db3e38af6131db24321c7cf9ec6">rb_str_cat2</a>(str, <span class="stringliteral">&quot;&lt;ch&gt;&quot;</span>);
<a name="l05145"></a>05145                 <span class="keywordflow">break</span>;
<a name="l05146"></a>05146               <span class="keywordflow">default</span>:{
<a name="l05147"></a>05147                 <a class="code" href="../../db/dcc/error_8c.html#a0f771a2840561f1838169b3d7d4616f3">rb_raise</a>(<a class="code" href="../../db/dcc/error_8c.html#ad772deff2d719e4ccc22068dee5df3c7">rb_eSyntaxError</a>, <span class="stringliteral">&quot;unknown operand type: %c&quot;</span>, type);
<a name="l05148"></a>05148               }
<a name="l05149"></a>05149             }
<a name="l05150"></a>05150             <span class="keywordflow">if</span> (types[j + 1]) {
<a name="l05151"></a>05151                 <a class="code" href="../../db/d2e/intern_8h.html#a5bd27db3e38af6131db24321c7cf9ec6">rb_str_cat2</a>(str, <span class="stringliteral">&quot;, &quot;</span>);
<a name="l05152"></a>05152             }
<a name="l05153"></a>05153         }
<a name="l05154"></a>05154     }
<a name="l05155"></a>05155     <span class="keywordflow">return</span> str;
<a name="l05156"></a>05156 }
<a name="l05157"></a>05157 
<a name="l05158"></a>05158 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l05159"></a><a class="code" href="../../d2/d47/compile_8c.html#aee9a7dcbd2c223a7790c416972f221c7">05159</a> <a class="code" href="../../d2/d47/compile_8c.html#aee9a7dcbd2c223a7790c416972f221c7">dump_disasm_list</a>(<span class="keyword">struct</span> <a class="code" href="../../dc/dd8/structiseq__link__element.html">iseq_link_element</a> *<a class="code" href="../../dc/db1/win32_8h.html#a9f0ffa429d1a466322fb9b5bb084f828">link</a>)
<a name="l05160"></a>05160 {
<a name="l05161"></a>05161     <span class="keywordtype">int</span> pos = 0;
<a name="l05162"></a>05162     <a class="code" href="../../db/d57/structiseq__insn__data.html">INSN</a> *iobj;
<a name="l05163"></a>05163     <a class="code" href="../../d8/dc5/structiseq__label__data.html">LABEL</a> *lobj;
<a name="l05164"></a>05164     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str;
<a name="l05165"></a>05165 
<a name="l05166"></a>05166     printf(<span class="stringliteral">&quot;-- raw disasm--------\n&quot;</span>);
<a name="l05167"></a>05167 
<a name="l05168"></a>05168     <span class="keywordflow">while</span> (link) {
<a name="l05169"></a>05169         <span class="keywordflow">switch</span> (link-&gt;<a class="code" href="../../dc/dd8/structiseq__link__element.html#a36dbc4d260432e7b26802451326ac92f">type</a>) {
<a name="l05170"></a>05170           <span class="keywordflow">case</span> ISEQ_ELEMENT_INSN:
<a name="l05171"></a>05171             {
<a name="l05172"></a>05172                 iobj = (<a class="code" href="../../db/d57/structiseq__insn__data.html">INSN</a> *)link;
<a name="l05173"></a>05173                 str = <a class="code" href="../../d2/d47/compile_8c.html#a70ed76742733ff31aae3ebb7125ea2d5">insn_data_to_s_detail</a>(iobj);
<a name="l05174"></a>05174                 printf(<span class="stringliteral">&quot;%04d %-65s(%4d)\n&quot;</span>, pos, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#afc32c1526ac6cb40ec33cad8782c0bae">StringValueCStr</a>(str),
<a name="l05175"></a>05175                        <a class="code" href="../../d2/d47/compile_8c.html#ab4ffd76d837f5780720b66918da794c3">insn_data_line_no</a>(iobj));
<a name="l05176"></a>05176                 pos += <a class="code" href="../../d2/d47/compile_8c.html#a7023a7b2b11a4a2e586982cd2433a287">insn_data_length</a>(iobj);
<a name="l05177"></a>05177                 <span class="keywordflow">break</span>;
<a name="l05178"></a>05178             }
<a name="l05179"></a>05179           <span class="keywordflow">case</span> ISEQ_ELEMENT_LABEL:
<a name="l05180"></a>05180             {
<a name="l05181"></a>05181                 lobj = (<a class="code" href="../../d8/dc5/structiseq__label__data.html">LABEL</a> *)link;
<a name="l05182"></a>05182                 printf(<span class="stringliteral">&quot;&lt;L%03d&gt;\n&quot;</span>, lobj-&gt;<a class="code" href="../../d8/dc5/structiseq__label__data.html#ae41778d86068bb63216de9834cfbce7e">label_no</a>);
<a name="l05183"></a>05183                 <span class="keywordflow">break</span>;
<a name="l05184"></a>05184             }
<a name="l05185"></a>05185           <span class="keywordflow">case</span> ISEQ_ELEMENT_NONE:
<a name="l05186"></a>05186             {
<a name="l05187"></a>05187                 printf(<span class="stringliteral">&quot;[none]\n&quot;</span>);
<a name="l05188"></a>05188                 <span class="keywordflow">break</span>;
<a name="l05189"></a>05189             }
<a name="l05190"></a>05190           <span class="keywordflow">case</span> ISEQ_ELEMENT_ADJUST:
<a name="l05191"></a>05191             {
<a name="l05192"></a>05192                 <a class="code" href="../../d1/d19/structiseq__adjust__data.html">ADJUST</a> *adjust = (<a class="code" href="../../d1/d19/structiseq__adjust__data.html">ADJUST</a> *)link;
<a name="l05193"></a>05193                 printf(<span class="stringliteral">&quot;adjust: [label: %d]\n&quot;</span>, adjust-&gt;<a class="code" href="../../d1/d19/structiseq__adjust__data.html#a0d755f7879e8378b46a8c3c2431fb65e">label</a>-&gt;<a class="code" href="../../d8/dc5/structiseq__label__data.html#ae41778d86068bb63216de9834cfbce7e">label_no</a>);
<a name="l05194"></a>05194                 <span class="keywordflow">break</span>;
<a name="l05195"></a>05195             }
<a name="l05196"></a>05196           <span class="keywordflow">default</span>:
<a name="l05197"></a>05197             <span class="comment">/* ignore */</span>
<a name="l05198"></a>05198             <a class="code" href="../../db/dcc/error_8c.html#a0f771a2840561f1838169b3d7d4616f3">rb_raise</a>(<a class="code" href="../../db/dcc/error_8c.html#ad772deff2d719e4ccc22068dee5df3c7">rb_eSyntaxError</a>, <span class="stringliteral">&quot;dump_disasm_list error: %ld\n&quot;</span>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ae9390780cd6d04a2e0ac3d6282cdefea">FIX2LONG</a>(link-&gt;<a class="code" href="../../dc/dd8/structiseq__link__element.html#a36dbc4d260432e7b26802451326ac92f">type</a>));
<a name="l05199"></a>05199         }
<a name="l05200"></a>05200         link = link-&gt;<a class="code" href="../../dc/dd8/structiseq__link__element.html#aaae92b0ba47e61c8c36eba5dac082957">next</a>;
<a name="l05201"></a>05201     }
<a name="l05202"></a>05202     printf(<span class="stringliteral">&quot;---------------------\n&quot;</span>);
<a name="l05203"></a>05203 }
<a name="l05204"></a>05204 
<a name="l05205"></a>05205 <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l05206"></a><a class="code" href="../../d2/d47/compile_8c.html#a6fbae85d86b443ae82def50a5d3e7254">05206</a> <a class="code" href="../../d2/d47/compile_8c.html#a6fbae85d86b443ae82def50a5d3e7254">rb_insns_name_array</a>(<span class="keywordtype">void</span>)
<a name="l05207"></a>05207 {
<a name="l05208"></a>05208     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> ary = <a class="code" href="../../dc/dcc/array_8c.html#a9518114fd36cb4ef4656ec1dc63348c9">rb_ary_new</a>();
<a name="l05209"></a>05209     <span class="keywordtype">int</span> i;
<a name="l05210"></a>05210     <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="../../dc/dcc/array_8c.html#a4ac8fee05a285361c33a2b0d9c2d555c">numberof</a>(insn_name_info); i++) {
<a name="l05211"></a>05211         <a class="code" href="../../dc/dcc/array_8c.html#a59d553a8cd781364b8bcb0deae25cca2">rb_ary_push</a>(ary, <a class="code" href="../../db/d2e/intern_8h.html#a8ea3742679211f408cb5769de6cf0d46">rb_obj_freeze</a>(<a class="code" href="../../db/d2e/intern_8h.html#a03acd62c0b1edebbe1d61f957c19b7ac">rb_str_new2</a>(insn_name_info[i])));
<a name="l05212"></a>05212     }
<a name="l05213"></a>05213     <span class="keywordflow">return</span> <a class="code" href="../../db/d2e/intern_8h.html#a8ea3742679211f408cb5769de6cf0d46">rb_obj_freeze</a>(ary);
<a name="l05214"></a>05214 }
<a name="l05215"></a>05215 
<a name="l05216"></a>05216 <span class="keyword">static</span> <a class="code" href="../../d8/dc5/structiseq__label__data.html">LABEL</a> *
<a name="l05217"></a><a class="code" href="../../d2/d47/compile_8c.html#a4b8c1c7c40330a696716891d88680a67">05217</a> <a class="code" href="../../d2/d47/compile_8c.html#a4b8c1c7c40330a696716891d88680a67">register_label</a>(<a class="code" href="../../d6/de3/structrb__iseq__struct.html">rb_iseq_t</a> *iseq, <span class="keyword">struct</span> <a class="code" href="../../d0/ddd/structst__table.html">st_table</a> *labels_table, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> obj)
<a name="l05218"></a>05218 {
<a name="l05219"></a>05219     <a class="code" href="../../d8/dc5/structiseq__label__data.html">LABEL</a> *label = 0;
<a name="l05220"></a>05220     <a class="code" href="../../de/dce/syck_8h.html#a8a45dfe133c1fd041e1b902bda9e43e8">st_data_t</a> tmp;
<a name="l05221"></a>05221     obj = <a class="code" href="../../db/d2e/intern_8h.html#a692c7c3caf5cdcf40d3812136f757fb5">rb_convert_type</a>(obj, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac9aadbc1e9c456506a4d7eef5cdc787e">T_SYMBOL</a>, <span class="stringliteral">&quot;Symbol&quot;</span>, <span class="stringliteral">&quot;to_sym&quot;</span>);
<a name="l05222"></a>05222 
<a name="l05223"></a>05223     <span class="keywordflow">if</span> (<a class="code" href="../../dd/d24/st_8h.html#a2d85287fbdaf7dcbc22d45e925c29fea">st_lookup</a>(labels_table, obj, &amp;tmp) == 0) {
<a name="l05224"></a>05224         label = <a class="code" href="../../d2/d47/compile_8c.html#a1d6d5d8dac7aff9ac863255a0905c0f9">NEW_LABEL</a>(0);
<a name="l05225"></a>05225         <a class="code" href="../../dd/d24/st_8h.html#acdc42c01229b7537ea5a4c6965c7e47a">st_insert</a>(labels_table, obj, (<a class="code" href="../../de/dce/syck_8h.html#a8a45dfe133c1fd041e1b902bda9e43e8">st_data_t</a>)label);
<a name="l05226"></a>05226     }
<a name="l05227"></a>05227     <span class="keywordflow">else</span> {
<a name="l05228"></a>05228         label = (<a class="code" href="../../d8/dc5/structiseq__label__data.html">LABEL</a> *)tmp;
<a name="l05229"></a>05229     }
<a name="l05230"></a>05230     <span class="keywordflow">return</span> label;
<a name="l05231"></a>05231 }
<a name="l05232"></a>05232 
<a name="l05233"></a>05233 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l05234"></a><a class="code" href="../../d2/d47/compile_8c.html#a9c9347a67f82c5ac2d911aed4cb8b757">05234</a> <a class="code" href="../../d2/d47/compile_8c.html#a9c9347a67f82c5ac2d911aed4cb8b757">get_exception_sym2type</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <a class="code" href="../../dd/dc0/date__core_8c.html#a8157485e687f56a6ae2f3ee0a8cb1580">sym</a>)
<a name="l05235"></a>05235 {
<a name="l05236"></a>05236 <span class="preprocessor">#undef rb_intern</span>
<a name="l05237"></a>05237 <span class="preprocessor"></span><span class="preprocessor">#define rb_intern(str) rb_intern_const(str)</span>
<a name="l05238"></a>05238 <span class="preprocessor"></span>    <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <a class="code" href="../../d1/db0/string_8c.html#a3f69a8436d382625437ad9b542b2c53c">sym_inspect</a>;
<a name="l05239"></a>05239     <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> symRescue, symEnsure, symRetry;
<a name="l05240"></a>05240     <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> symBreak, symRedo, symNext;
<a name="l05241"></a>05241 
<a name="l05242"></a>05242     <span class="keywordflow">if</span> (symRescue == 0) {
<a name="l05243"></a>05243         symRescue = <a class="code" href="../../dc/d0c/cparse_8c.html#a48bfb6519a45249fb2ec0193ea3b6e1c">ID2SYM</a>(<a class="code" href="../../dc/dcc/array_8c.html#a9cfa42d4b79c89d68c53be8b2150a503">rb_intern</a>(<span class="stringliteral">&quot;rescue&quot;</span>));
<a name="l05244"></a>05244         symEnsure = <a class="code" href="../../dc/d0c/cparse_8c.html#a48bfb6519a45249fb2ec0193ea3b6e1c">ID2SYM</a>(<a class="code" href="../../dc/dcc/array_8c.html#a9cfa42d4b79c89d68c53be8b2150a503">rb_intern</a>(<span class="stringliteral">&quot;ensure&quot;</span>));
<a name="l05245"></a>05245         symRetry  = <a class="code" href="../../dc/d0c/cparse_8c.html#a48bfb6519a45249fb2ec0193ea3b6e1c">ID2SYM</a>(<a class="code" href="../../dc/dcc/array_8c.html#a9cfa42d4b79c89d68c53be8b2150a503">rb_intern</a>(<span class="stringliteral">&quot;retry&quot;</span>));
<a name="l05246"></a>05246         symBreak  = <a class="code" href="../../dc/d0c/cparse_8c.html#a48bfb6519a45249fb2ec0193ea3b6e1c">ID2SYM</a>(<a class="code" href="../../dc/dcc/array_8c.html#a9cfa42d4b79c89d68c53be8b2150a503">rb_intern</a>(<span class="stringliteral">&quot;break&quot;</span>));
<a name="l05247"></a>05247         symRedo   = <a class="code" href="../../dc/d0c/cparse_8c.html#a48bfb6519a45249fb2ec0193ea3b6e1c">ID2SYM</a>(<a class="code" href="../../dc/dcc/array_8c.html#a9cfa42d4b79c89d68c53be8b2150a503">rb_intern</a>(<span class="stringliteral">&quot;redo&quot;</span>));
<a name="l05248"></a>05248         symNext   = <a class="code" href="../../dc/d0c/cparse_8c.html#a48bfb6519a45249fb2ec0193ea3b6e1c">ID2SYM</a>(<a class="code" href="../../dc/dcc/array_8c.html#a9cfa42d4b79c89d68c53be8b2150a503">rb_intern</a>(<span class="stringliteral">&quot;next&quot;</span>));
<a name="l05249"></a>05249     }
<a name="l05250"></a>05250 
<a name="l05251"></a>05251     <span class="keywordflow">if</span> (sym == symRescue) <span class="keywordflow">return</span> CATCH_TYPE_RESCUE;
<a name="l05252"></a>05252     <span class="keywordflow">if</span> (sym == symEnsure) <span class="keywordflow">return</span> CATCH_TYPE_ENSURE;
<a name="l05253"></a>05253     <span class="keywordflow">if</span> (sym == symRetry)  <span class="keywordflow">return</span> CATCH_TYPE_RETRY;
<a name="l05254"></a>05254     <span class="keywordflow">if</span> (sym == symBreak)  <span class="keywordflow">return</span> CATCH_TYPE_BREAK;
<a name="l05255"></a>05255     <span class="keywordflow">if</span> (sym == symRedo)   <span class="keywordflow">return</span> CATCH_TYPE_REDO;
<a name="l05256"></a>05256     <span class="keywordflow">if</span> (sym == symNext)   <span class="keywordflow">return</span> CATCH_TYPE_NEXT;
<a name="l05257"></a>05257     sym_inspect = <a class="code" href="../../db/d2e/intern_8h.html#acbb281bacf6b80f460143348e26142e9">rb_inspect</a>(sym);
<a name="l05258"></a>05258     <a class="code" href="../../db/dcc/error_8c.html#a0f771a2840561f1838169b3d7d4616f3">rb_raise</a>(<a class="code" href="../../db/dcc/error_8c.html#ad772deff2d719e4ccc22068dee5df3c7">rb_eSyntaxError</a>, <span class="stringliteral">&quot;invalid exception symbol: %s&quot;</span>,
<a name="l05259"></a>05259              <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a2665a51abbd5b49c15abff3df00fa9db">StringValuePtr</a>(sym_inspect));
<a name="l05260"></a>05260     <span class="keywordflow">return</span> 0;
<a name="l05261"></a>05261 }
<a name="l05262"></a>05262 
<a name="l05263"></a>05263 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l05264"></a><a class="code" href="../../d2/d47/compile_8c.html#abffab9c8c7ac7b527e8c593ea14d774b">05264</a> <a class="code" href="../../d2/d47/compile_8c.html#abffab9c8c7ac7b527e8c593ea14d774b">iseq_build_from_ary_exception</a>(<a class="code" href="../../d6/de3/structrb__iseq__struct.html">rb_iseq_t</a> *iseq, <span class="keyword">struct</span> <a class="code" href="../../d0/ddd/structst__table.html">st_table</a> *labels_table,
<a name="l05265"></a>05265                      <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> exception)
<a name="l05266"></a>05266 {
<a name="l05267"></a>05267     <span class="keywordtype">int</span> i;
<a name="l05268"></a>05268 
<a name="l05269"></a>05269     <span class="keywordflow">for</span> (i=0; i&lt;<a class="code" href="../../d8/df4/generator_8h.html#ae988773ed219452578f881fc7189c486">RARRAY_LEN</a>(exception); i++) {
<a name="l05270"></a>05270         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> v, <a class="code" href="../../d5/d9d/tcltklib_8c.html#ac765329451135abec74c45e1897abf26">type</a>, *ptr, eiseqval;
<a name="l05271"></a>05271         <a class="code" href="../../d8/dc5/structiseq__label__data.html">LABEL</a> *lstart, *lend, *lcont;
<a name="l05272"></a>05272         <span class="keywordtype">int</span> sp;
<a name="l05273"></a>05273 
<a name="l05274"></a>05274         <a class="code" href="../../d8/df4/generator_8h.html#ad2bf389f3fddea7bd3befa162c70561a">RB_GC_GUARD</a>(v) = <a class="code" href="../../db/d2e/intern_8h.html#a692c7c3caf5cdcf40d3812136f757fb5">rb_convert_type</a>(<a class="code" href="../../d8/df4/generator_8h.html#abb794fe2d7c73eea87e7ba2273939a8e">RARRAY_PTR</a>(exception)[i], <a class="code" href="../../de/de6/ruby_2ruby_8h.html#abbd332f6f94d77e0a369c7720128639e">T_ARRAY</a>,
<a name="l05275"></a>05275                                          <span class="stringliteral">&quot;Array&quot;</span>, <span class="stringliteral">&quot;to_ary&quot;</span>);
<a name="l05276"></a>05276         <span class="keywordflow">if</span> (<a class="code" href="../../d8/df4/generator_8h.html#ae988773ed219452578f881fc7189c486">RARRAY_LEN</a>(v) != 6) {
<a name="l05277"></a>05277             <a class="code" href="../../db/dcc/error_8c.html#a0f771a2840561f1838169b3d7d4616f3">rb_raise</a>(<a class="code" href="../../db/dcc/error_8c.html#ad772deff2d719e4ccc22068dee5df3c7">rb_eSyntaxError</a>, <span class="stringliteral">&quot;wrong exception entry&quot;</span>);
<a name="l05278"></a>05278         }
<a name="l05279"></a>05279         ptr  = <a class="code" href="../../d8/df4/generator_8h.html#abb794fe2d7c73eea87e7ba2273939a8e">RARRAY_PTR</a>(v);
<a name="l05280"></a>05280         type = <a class="code" href="../../d2/d47/compile_8c.html#a9c9347a67f82c5ac2d911aed4cb8b757">get_exception_sym2type</a>(ptr[0]);
<a name="l05281"></a>05281         <span class="keywordflow">if</span> (ptr[1] == <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a320970f989dc8294c8203154e3db40c1">Qnil</a>) {
<a name="l05282"></a>05282             eiseqval = 0;
<a name="l05283"></a>05283         }
<a name="l05284"></a>05284         <span class="keywordflow">else</span> {
<a name="l05285"></a>05285             eiseqval = <a class="code" href="../../dd/d74/iseq_8c.html#ad122d919afd884f3626ddc2172c82fb4">rb_iseq_load</a>(ptr[1], iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a46d5fb5c3de970a9540ab85d4b060957">self</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a320970f989dc8294c8203154e3db40c1">Qnil</a>);
<a name="l05286"></a>05286         }
<a name="l05287"></a>05287 
<a name="l05288"></a>05288         lstart = <a class="code" href="../../d2/d47/compile_8c.html#a4b8c1c7c40330a696716891d88680a67">register_label</a>(iseq, labels_table, ptr[2]);
<a name="l05289"></a>05289         lend   = <a class="code" href="../../d2/d47/compile_8c.html#a4b8c1c7c40330a696716891d88680a67">register_label</a>(iseq, labels_table, ptr[3]);
<a name="l05290"></a>05290         lcont  = <a class="code" href="../../d2/d47/compile_8c.html#a4b8c1c7c40330a696716891d88680a67">register_label</a>(iseq, labels_table, ptr[4]);
<a name="l05291"></a>05291         sp     = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a877c38180d23c5447d976c70dda89d69">NUM2INT</a>(ptr[5]);
<a name="l05292"></a>05292 
<a name="l05293"></a>05293         <a class="code" href="../../d2/d47/compile_8c.html#a668f1779f1e5158e6ad8d4b6d92638db">ADD_CATCH_ENTRY</a>(type, lstart, lend, eiseqval, lcont);
<a name="l05294"></a>05294     }
<a name="l05295"></a>05295     <span class="keywordflow">return</span> <a class="code" href="../../d2/d47/compile_8c.html#a652dda0d529b866959c19fe27293968e">COMPILE_OK</a>;
<a name="l05296"></a>05296 }
<a name="l05297"></a>05297 
<a name="l05298"></a>05298 <span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="../../d0/ddd/structst__table.html">st_table</a> *
<a name="l05299"></a><a class="code" href="../../d2/d47/compile_8c.html#a82de6151f4f8687346f93cff0a6238cf">05299</a> <a class="code" href="../../d2/d47/compile_8c.html#a82de6151f4f8687346f93cff0a6238cf">insn_make_insn_table</a>(<span class="keywordtype">void</span>)
<a name="l05300"></a>05300 {
<a name="l05301"></a>05301     <span class="keyword">struct </span><a class="code" href="../../d0/ddd/structst__table.html">st_table</a> *table;
<a name="l05302"></a>05302     <span class="keywordtype">int</span> i;
<a name="l05303"></a>05303     table = <a class="code" href="../../dd/d24/st_8h.html#a955c6e936b9681649ab9ffa4aa741949">st_init_numtable</a>();
<a name="l05304"></a>05304 
<a name="l05305"></a>05305     <span class="keywordflow">for</span> (i=0; i&lt;VM_INSTRUCTION_SIZE; i++) {
<a name="l05306"></a>05306         <a class="code" href="../../dd/d24/st_8h.html#acdc42c01229b7537ea5a4c6965c7e47a">st_insert</a>(table, <a class="code" href="../../dc/d0c/cparse_8c.html#a48bfb6519a45249fb2ec0193ea3b6e1c">ID2SYM</a>(<a class="code" href="../../dc/dcc/array_8c.html#a9cfa42d4b79c89d68c53be8b2150a503">rb_intern</a>(insn_name(i))), i);
<a name="l05307"></a>05307     }
<a name="l05308"></a>05308 
<a name="l05309"></a>05309     <span class="keywordflow">return</span> table;
<a name="l05310"></a>05310 }
<a name="l05311"></a>05311 
<a name="l05312"></a>05312 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l05313"></a><a class="code" href="../../d2/d47/compile_8c.html#ab7a6e582abc36e8dfe3d7981d4597c31">05313</a> <a class="code" href="../../d2/d47/compile_8c.html#ab7a6e582abc36e8dfe3d7981d4597c31">iseq_build_from_ary_body</a>(<a class="code" href="../../d6/de3/structrb__iseq__struct.html">rb_iseq_t</a> *iseq, <a class="code" href="../../d4/dcd/structiseq__link__anchor.html">LINK_ANCHOR</a> *anchor,
<a name="l05314"></a>05314                 <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> body, <span class="keyword">struct</span> <a class="code" href="../../d0/ddd/structst__table.html">st_table</a> *labels_table)
<a name="l05315"></a>05315 {
<a name="l05316"></a>05316     <span class="comment">/* TODO: body should be frozen */</span>
<a name="l05317"></a>05317     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> *ptr = <a class="code" href="../../d8/df4/generator_8h.html#abb794fe2d7c73eea87e7ba2273939a8e">RARRAY_PTR</a>(body);
<a name="l05318"></a>05318     <span class="keywordtype">long</span> i, <a class="code" href="../../d3/d15/name2ctype_8h.html#aed1cc4dca5d94cb452f79691f54f7423">len</a> = <a class="code" href="../../d8/df4/generator_8h.html#ae988773ed219452578f881fc7189c486">RARRAY_LEN</a>(body);
<a name="l05319"></a>05319     <span class="keywordtype">int</span> j;
<a name="l05320"></a>05320     <span class="keywordtype">int</span> line_no = 0;
<a name="l05321"></a>05321     <span class="comment">/*</span>
<a name="l05322"></a>05322 <span class="comment">     * index -&gt; LABEL *label</span>
<a name="l05323"></a>05323 <span class="comment">     */</span>
<a name="l05324"></a>05324     <span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="../../d0/ddd/structst__table.html">st_table</a> *insn_table;
<a name="l05325"></a>05325 
<a name="l05326"></a>05326     <span class="keywordflow">if</span> (insn_table == 0) {
<a name="l05327"></a>05327         insn_table = <a class="code" href="../../d2/d47/compile_8c.html#a82de6151f4f8687346f93cff0a6238cf">insn_make_insn_table</a>();
<a name="l05328"></a>05328     }
<a name="l05329"></a>05329 
<a name="l05330"></a>05330     <span class="keywordflow">for</span> (i=0; i&lt;len; i++) {
<a name="l05331"></a>05331         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> obj = ptr[i];
<a name="l05332"></a>05332 
<a name="l05333"></a>05333         <span class="keywordflow">if</span> (<a class="code" href="../../dc/d0c/cparse_8c.html#a637bc5a232034ee3fd411f8bef091566">SYMBOL_P</a>(obj)) {
<a name="l05334"></a>05334             <a class="code" href="../../d8/dc5/structiseq__label__data.html">LABEL</a> *label = <a class="code" href="../../d2/d47/compile_8c.html#a4b8c1c7c40330a696716891d88680a67">register_label</a>(iseq, labels_table, obj);
<a name="l05335"></a>05335             <a class="code" href="../../d2/d47/compile_8c.html#a5a380bb449656575d6b77ccb8eb7e5ae">ADD_LABEL</a>(anchor, label);
<a name="l05336"></a>05336         }
<a name="l05337"></a>05337         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#acf2fcf97dcf9c7c35452730eb3e2aeb2">FIXNUM_P</a>(obj)) {
<a name="l05338"></a>05338             line_no = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a877c38180d23c5447d976c70dda89d69">NUM2INT</a>(obj);
<a name="l05339"></a>05339         }
<a name="l05340"></a>05340         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a394faf7191f18552a20cb17ce14226f0">TYPE</a>(obj) == <a class="code" href="../../de/de6/ruby_2ruby_8h.html#abbd332f6f94d77e0a369c7720128639e">T_ARRAY</a>) {
<a name="l05341"></a>05341             <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> *<a class="code" href="../../df/d77/ruby_8c.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a> = 0;
<a name="l05342"></a>05342             <span class="keywordtype">int</span> argc = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a28084c7ad47ec550165c87e447e8356e">RARRAY_LENINT</a>(obj) - 1;
<a name="l05343"></a>05343             <a class="code" href="../../de/dce/syck_8h.html#a8a45dfe133c1fd041e1b902bda9e43e8">st_data_t</a> insn_id;
<a name="l05344"></a>05344             <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> insn;
<a name="l05345"></a>05345 
<a name="l05346"></a>05346             insn = (argc &lt; 0) ? <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a320970f989dc8294c8203154e3db40c1">Qnil</a> : <a class="code" href="../../d8/df4/generator_8h.html#abb794fe2d7c73eea87e7ba2273939a8e">RARRAY_PTR</a>(obj)[0];
<a name="l05347"></a>05347             <span class="keywordflow">if</span> (<a class="code" href="../../dd/d24/st_8h.html#a2d85287fbdaf7dcbc22d45e925c29fea">st_lookup</a>(insn_table, (<a class="code" href="../../de/dce/syck_8h.html#a8a45dfe133c1fd041e1b902bda9e43e8">st_data_t</a>)insn, &amp;insn_id) == 0) {
<a name="l05348"></a>05348                 <span class="comment">/* TODO: exception */</span>
<a name="l05349"></a>05349                 <a class="code" href="../../d8/df4/generator_8h.html#ad2bf389f3fddea7bd3befa162c70561a">RB_GC_GUARD</a>(insn) = <a class="code" href="../../db/d2e/intern_8h.html#acbb281bacf6b80f460143348e26142e9">rb_inspect</a>(insn);
<a name="l05350"></a>05350                 <a class="code" href="../../d5/d11/ripper_8c.html#ac8a9e12698ddd356976669c6116abef1">rb_compile_error</a>(<a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a06859fa5de56f2ede3cb692f1d9215e2">filename</a>), line_no,
<a name="l05351"></a>05351                                  <span class="stringliteral">&quot;unknown instruction: %s&quot;</span>, <a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(insn));
<a name="l05352"></a>05352             }
<a name="l05353"></a>05353 
<a name="l05354"></a>05354             <span class="keywordflow">if</span> (argc != insn_len((<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>)insn_id)-1) {
<a name="l05355"></a>05355                 <a class="code" href="../../d5/d11/ripper_8c.html#ac8a9e12698ddd356976669c6116abef1">rb_compile_error</a>(<a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a06859fa5de56f2ede3cb692f1d9215e2">filename</a>), line_no,
<a name="l05356"></a>05356                                  <span class="stringliteral">&quot;operand size mismatch&quot;</span>);
<a name="l05357"></a>05357             }
<a name="l05358"></a>05358 
<a name="l05359"></a>05359             <span class="keywordflow">if</span> (argc &gt; 0) {
<a name="l05360"></a>05360                 argv = <a class="code" href="../../d2/d47/compile_8c.html#aa24f135ae12437da748202a5329eba3e">compile_data_alloc</a>(iseq, <span class="keyword">sizeof</span>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>) * argc);
<a name="l05361"></a>05361                 <span class="keywordflow">for</span> (j=0; j&lt;argc; j++) {
<a name="l05362"></a>05362                     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> op = <a class="code" href="../../dc/dcc/array_8c.html#ae3c2ac6c88e666d5418855114eb8bcf8">rb_ary_entry</a>(obj, j+1);
<a name="l05363"></a>05363                     <span class="keywordflow">switch</span> (insn_op_type((<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>)insn_id, j)) {
<a name="l05364"></a>05364                       <span class="keywordflow">case</span> TS_OFFSET: {
<a name="l05365"></a>05365                         <a class="code" href="../../d8/dc5/structiseq__label__data.html">LABEL</a> *label = <a class="code" href="../../d2/d47/compile_8c.html#a4b8c1c7c40330a696716891d88680a67">register_label</a>(iseq, labels_table, op);
<a name="l05366"></a>05366                         argv[j] = (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>)label;
<a name="l05367"></a>05367                         <span class="keywordflow">break</span>;
<a name="l05368"></a>05368                       }
<a name="l05369"></a>05369                       <span class="keywordflow">case</span> TS_LINDEX:
<a name="l05370"></a>05370                       <span class="keywordflow">case</span> TS_DINDEX:
<a name="l05371"></a>05371                       <span class="keywordflow">case</span> TS_NUM:
<a name="l05372"></a>05372                         (void)<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a877c38180d23c5447d976c70dda89d69">NUM2INT</a>(op);
<a name="l05373"></a>05373                         argv[j] = op;
<a name="l05374"></a>05374                         <span class="keywordflow">break</span>;
<a name="l05375"></a>05375                       <span class="keywordflow">case</span> TS_VALUE:
<a name="l05376"></a>05376                         argv[j] = op;
<a name="l05377"></a>05377                         <a class="code" href="../../d2/d47/compile_8c.html#aad5c64f89a1b6d0b28c93478609a1734">iseq_add_mark_object</a>(iseq, op);
<a name="l05378"></a>05378                         <span class="keywordflow">break</span>;
<a name="l05379"></a>05379                       <span class="keywordflow">case</span> TS_ISEQ:
<a name="l05380"></a>05380                         {
<a name="l05381"></a>05381                             <span class="keywordflow">if</span> (op != <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a320970f989dc8294c8203154e3db40c1">Qnil</a>) {
<a name="l05382"></a>05382                                 <span class="keywordflow">if</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a394faf7191f18552a20cb17ce14226f0">TYPE</a>(op) == <a class="code" href="../../de/de6/ruby_2ruby_8h.html#abbd332f6f94d77e0a369c7720128639e">T_ARRAY</a>) {
<a name="l05383"></a>05383                                     argv[j] = <a class="code" href="../../dd/d74/iseq_8c.html#ad122d919afd884f3626ddc2172c82fb4">rb_iseq_load</a>(op, iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a46d5fb5c3de970a9540ab85d4b060957">self</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a320970f989dc8294c8203154e3db40c1">Qnil</a>);
<a name="l05384"></a>05384                                 }
<a name="l05385"></a>05385                                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#ad07df58de9895cbc33c10f02540d2d4d">CLASS_OF</a>(op) == <a class="code" href="../../dd/d74/iseq_8c.html#a33f0eb5b1ef504a842daef683bd62273">rb_cISeq</a>) {
<a name="l05386"></a>05386                                     argv[j] = op;
<a name="l05387"></a>05387                                 }
<a name="l05388"></a>05388                                 <span class="keywordflow">else</span> {
<a name="l05389"></a>05389                                     <a class="code" href="../../db/dcc/error_8c.html#a0f771a2840561f1838169b3d7d4616f3">rb_raise</a>(<a class="code" href="../../db/dcc/error_8c.html#ad772deff2d719e4ccc22068dee5df3c7">rb_eSyntaxError</a>, <span class="stringliteral">&quot;ISEQ is required&quot;</span>);
<a name="l05390"></a>05390                                 }
<a name="l05391"></a>05391                                 <a class="code" href="../../d2/d47/compile_8c.html#aad5c64f89a1b6d0b28c93478609a1734">iseq_add_mark_object</a>(iseq, argv[j]);
<a name="l05392"></a>05392                             }
<a name="l05393"></a>05393                             <span class="keywordflow">else</span> {
<a name="l05394"></a>05394                                 argv[j] = 0;
<a name="l05395"></a>05395                             }
<a name="l05396"></a>05396                         }
<a name="l05397"></a>05397                         <span class="keywordflow">break</span>;
<a name="l05398"></a>05398                       <span class="keywordflow">case</span> TS_GENTRY:
<a name="l05399"></a>05399                         op = <a class="code" href="../../db/d2e/intern_8h.html#a692c7c3caf5cdcf40d3812136f757fb5">rb_convert_type</a>(op, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac9aadbc1e9c456506a4d7eef5cdc787e">T_SYMBOL</a>, <span class="stringliteral">&quot;Symbol&quot;</span>, <span class="stringliteral">&quot;to_sym&quot;</span>);
<a name="l05400"></a>05400                         argv[j] = (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>)<a class="code" href="../../d0/d2a/variable_8c.html#a26a48bec8ff714d9e7f76d881a7d248f">rb_global_entry</a>(<a class="code" href="../../dc/d0c/cparse_8c.html#a73ce5202e6172d3ad0bab7d1e0df9dae">SYM2ID</a>(op));
<a name="l05401"></a>05401                         <span class="keywordflow">break</span>;
<a name="l05402"></a>05402                       <span class="keywordflow">case</span> TS_IC:
<a name="l05403"></a>05403                         argv[j] = op;
<a name="l05404"></a>05404                         <span class="keywordflow">if</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a877c38180d23c5447d976c70dda89d69">NUM2INT</a>(op) &gt;= iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a72aee3eed9e9842166e381972a35e9fb">ic_size</a>)
<a name="l05405"></a>05405                             iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a72aee3eed9e9842166e381972a35e9fb">ic_size</a> = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a877c38180d23c5447d976c70dda89d69">NUM2INT</a>(op) + 1;
<a name="l05406"></a>05406                         <span class="keywordflow">break</span>;
<a name="l05407"></a>05407                       <span class="keywordflow">case</span> TS_ID:
<a name="l05408"></a>05408                         argv[j] = <a class="code" href="../../db/d2e/intern_8h.html#a692c7c3caf5cdcf40d3812136f757fb5">rb_convert_type</a>(op, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac9aadbc1e9c456506a4d7eef5cdc787e">T_SYMBOL</a>,
<a name="l05409"></a>05409                                                   <span class="stringliteral">&quot;Symbol&quot;</span>, <span class="stringliteral">&quot;to_sym&quot;</span>);
<a name="l05410"></a>05410                         <span class="keywordflow">break</span>;
<a name="l05411"></a>05411                       <span class="keywordflow">case</span> TS_CDHASH:
<a name="l05412"></a>05412                         {
<a name="l05413"></a>05413                             <span class="keywordtype">int</span> i;
<a name="l05414"></a>05414                             op = <a class="code" href="../../db/d2e/intern_8h.html#a692c7c3caf5cdcf40d3812136f757fb5">rb_convert_type</a>(op, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#abbd332f6f94d77e0a369c7720128639e">T_ARRAY</a>, <span class="stringliteral">&quot;Array&quot;</span>, <span class="stringliteral">&quot;to_ary&quot;</span>);
<a name="l05415"></a>05415                             op = <a class="code" href="../../dc/dcc/array_8c.html#a4ed6dfd78eb5519d446c519e364ef3ab">rb_ary_dup</a>(op);
<a name="l05416"></a>05416                             <span class="keywordflow">for</span> (i=0; i&lt;<a class="code" href="../../d8/df4/generator_8h.html#ae988773ed219452578f881fc7189c486">RARRAY_LEN</a>(op); i+=2) {
<a name="l05417"></a>05417                                 <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <a class="code" href="../../dd/dc0/date__core_8c.html#a8157485e687f56a6ae2f3ee0a8cb1580">sym</a> = <a class="code" href="../../dc/dcc/array_8c.html#ae3c2ac6c88e666d5418855114eb8bcf8">rb_ary_entry</a>(op, i+1);
<a name="l05418"></a>05418                                 <a class="code" href="../../d8/dc5/structiseq__label__data.html">LABEL</a> *label =
<a name="l05419"></a>05419                                   <a class="code" href="../../d2/d47/compile_8c.html#a4b8c1c7c40330a696716891d88680a67">register_label</a>(iseq, labels_table, sym);
<a name="l05420"></a>05420                                 <a class="code" href="../../dc/dcc/array_8c.html#a1d7683de2cd34217808092d90ffd0869">rb_ary_store</a>(op, i+1, (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>)label | 1);
<a name="l05421"></a>05421                             }
<a name="l05422"></a>05422                             argv[j] = op;
<a name="l05423"></a>05423                             <a class="code" href="../../d2/d47/compile_8c.html#ad09bab1521a935e4affe9c1faf9a27c5">iseq_add_mark_object_compile_time</a>(iseq, op);
<a name="l05424"></a>05424                         }
<a name="l05425"></a>05425                         <span class="keywordflow">break</span>;
<a name="l05426"></a>05426                       <span class="keywordflow">default</span>:
<a name="l05427"></a>05427                         <a class="code" href="../../db/dcc/error_8c.html#a0f771a2840561f1838169b3d7d4616f3">rb_raise</a>(<a class="code" href="../../db/dcc/error_8c.html#ad772deff2d719e4ccc22068dee5df3c7">rb_eSyntaxError</a>, <span class="stringliteral">&quot;unknown operand: %c&quot;</span>, insn_op_type((<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>)insn_id, j));
<a name="l05428"></a>05428                     }
<a name="l05429"></a>05429                 }
<a name="l05430"></a>05430             }
<a name="l05431"></a>05431             <a class="code" href="../../d2/d47/compile_8c.html#a46920e7a34d0b9584a59215104163d11">ADD_ELEM</a>(anchor,
<a name="l05432"></a>05432                      (<a class="code" href="../../dc/dd8/structiseq__link__element.html">LINK_ELEMENT</a>*)<a class="code" href="../../d2/d47/compile_8c.html#a43e3134981c54d24f0e03651e0f909b6">new_insn_core</a>(iseq, line_no,
<a name="l05433"></a>05433                                                   (<span class="keyword">enum</span> ruby_vminsn_type)insn_id, argc, argv));
<a name="l05434"></a>05434         }
<a name="l05435"></a>05435         <span class="keywordflow">else</span> {
<a name="l05436"></a>05436             <a class="code" href="../../db/dcc/error_8c.html#a0f771a2840561f1838169b3d7d4616f3">rb_raise</a>(<a class="code" href="../../db/dcc/error_8c.html#a565ed9d70f4089e1b4a36e9b3381b8c6">rb_eTypeError</a>, <span class="stringliteral">&quot;unexpected object for instruction&quot;</span>);
<a name="l05437"></a>05437         }
<a name="l05438"></a>05438     }
<a name="l05439"></a>05439     <a class="code" href="../../d2/d47/compile_8c.html#ab083c72a68599ad0ab6eb5ab054a8f92">validate_labels</a>(iseq, labels_table);
<a name="l05440"></a>05440     <a class="code" href="../../dd/d24/st_8h.html#acb004847ef312373d65bfb0d1a21c5b3">st_free_table</a>(labels_table);
<a name="l05441"></a>05441     <a class="code" href="../../d2/d47/compile_8c.html#a0c133043da590dbf81f56e44d28936e1">iseq_setup</a>(iseq, anchor);
<a name="l05442"></a>05442     <span class="keywordflow">return</span> <a class="code" href="../../d2/d47/compile_8c.html#a652dda0d529b866959c19fe27293968e">COMPILE_OK</a>;
<a name="l05443"></a>05443 }
<a name="l05444"></a>05444 
<a name="l05445"></a><a class="code" href="../../d2/d47/compile_8c.html#a4eb4c2f878c69f9c6270ea2929eb3751">05445</a> <span class="preprocessor">#define CHECK_ARRAY(v)   rb_convert_type((v), T_ARRAY, &quot;Array&quot;, &quot;to_ary&quot;)</span>
<a name="l05446"></a><a class="code" href="../../d2/d47/compile_8c.html#a4400e8d5834ed2b57be2f8e5f9812ae8">05446</a> <span class="preprocessor"></span><span class="preprocessor">#define CHECK_STRING(v)  rb_convert_type((v), T_STRING, &quot;String&quot;, &quot;to_str&quot;)</span>
<a name="l05447"></a><a class="code" href="../../d2/d47/compile_8c.html#af8023bbefbf7c0d3c961106acf8dec2a">05447</a> <span class="preprocessor"></span><span class="preprocessor">#define CHECK_SYMBOL(v)  rb_convert_type((v), T_SYMBOL, &quot;Symbol&quot;, &quot;to_sym&quot;)</span>
<a name="l05448"></a><a class="code" href="../../d2/d47/compile_8c.html#a73c3ed009df9bde718b7c175b6ad13e4">05448</a> <span class="preprocessor"></span><span class="keyword">static</span> <span class="keyword">inline</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <a class="code" href="../../d2/d47/compile_8c.html#a73c3ed009df9bde718b7c175b6ad13e4">CHECK_INTEGER</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> v) {(void)<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a93f154f3dcc08027f475bf0c3cc287bd">NUM2LONG</a>(v); <span class="keywordflow">return</span> v;}
<a name="l05449"></a>05449 
<a name="l05450"></a>05450 <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l05451"></a><a class="code" href="../../d7/dc8/iseq_8h.html#a2396f887666143fa757f1033c7674000">05451</a> <a class="code" href="../../d2/d47/compile_8c.html#a2396f887666143fa757f1033c7674000">rb_iseq_build_from_ary</a>(<a class="code" href="../../d6/de3/structrb__iseq__struct.html">rb_iseq_t</a> *iseq, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> locals, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <a class="code" href="../../d3/d09/ripper_8y.html#a8187411843a6284ffb964ef3fb9fcab3">args</a>,
<a name="l05452"></a>05452                          <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> exception, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> body)
<a name="l05453"></a>05453 {
<a name="l05454"></a>05454     <span class="keywordtype">int</span> i;
<a name="l05455"></a>05455     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#afa5b9137f051ac26d7ccc8824f178233">ID</a> *tbl;
<a name="l05456"></a>05456     <span class="keyword">struct </span><a class="code" href="../../d0/ddd/structst__table.html">st_table</a> *labels_table = <a class="code" href="../../dd/d24/st_8h.html#a955c6e936b9681649ab9ffa4aa741949">st_init_numtable</a>();
<a name="l05457"></a>05457     <a class="code" href="../../d2/d47/compile_8c.html#aa9d6014cec8d3adcb228b81620eac795">DECL_ANCHOR</a>(anchor);
<a name="l05458"></a>05458     <a class="code" href="../../d2/d47/compile_8c.html#ac32b1f7d8de8f10f33a147030d8b7544">INIT_ANCHOR</a>(anchor);
<a name="l05459"></a>05459 
<a name="l05460"></a>05460     iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a22ff1695f19e63e6540bc574949c55b0">local_table_size</a> = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a28084c7ad47ec550165c87e447e8356e">RARRAY_LENINT</a>(locals);
<a name="l05461"></a>05461     iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a667787a2e393a8e2a203bf1c2442276d">local_table</a> = tbl = (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#afa5b9137f051ac26d7ccc8824f178233">ID</a> *)<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a79041aa2bc7439c11906a86f82a52eb6">ALLOC_N</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#afa5b9137f051ac26d7ccc8824f178233">ID</a>, iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a22ff1695f19e63e6540bc574949c55b0">local_table_size</a>);
<a name="l05462"></a>05462     iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#afbae994355f91f3ea547570debb757c0">local_size</a> = iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a22ff1695f19e63e6540bc574949c55b0">local_table_size</a> + 1;
<a name="l05463"></a>05463 
<a name="l05464"></a>05464     <span class="keywordflow">for</span> (i=0; i&lt;<a class="code" href="../../d8/df4/generator_8h.html#ae988773ed219452578f881fc7189c486">RARRAY_LEN</a>(locals); i++) {
<a name="l05465"></a>05465         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> lv = <a class="code" href="../../d8/df4/generator_8h.html#abb794fe2d7c73eea87e7ba2273939a8e">RARRAY_PTR</a>(locals)[i];
<a name="l05466"></a>05466         tbl[i] = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#acf2fcf97dcf9c7c35452730eb3e2aeb2">FIXNUM_P</a>(lv) ? (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#afa5b9137f051ac26d7ccc8824f178233">ID</a>)<a class="code" href="../../de/de6/ruby_2ruby_8h.html#ae9390780cd6d04a2e0ac3d6282cdefea">FIX2LONG</a>(lv) : <a class="code" href="../../dc/d0c/cparse_8c.html#a73ce5202e6172d3ad0bab7d1e0df9dae">SYM2ID</a>(<a class="code" href="../../d2/d47/compile_8c.html#af8023bbefbf7c0d3c961106acf8dec2a">CHECK_SYMBOL</a>(lv));
<a name="l05467"></a>05467     }
<a name="l05468"></a>05468 
<a name="l05469"></a>05469     <span class="comment">/* args */</span>
<a name="l05470"></a>05470     <span class="keywordflow">if</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#acf2fcf97dcf9c7c35452730eb3e2aeb2">FIXNUM_P</a>(args)) {
<a name="l05471"></a>05471         iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#abd2b67e0dffb2262ab272a67bbe747d6">arg_size</a> = iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a5fd0acd110681eeb0f95c3b283451a0a" title="argument information">argc</a> = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a9444c431b3cb1184e7523fc572f2c758">FIX2INT</a>(args);
<a name="l05472"></a>05472         iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#ae7f7a6daa388dc65f83c27600cb39b00">arg_simple</a> = 1;
<a name="l05473"></a>05473     }
<a name="l05474"></a>05474     <span class="keywordflow">else</span> {
<a name="l05475"></a>05475         <span class="keywordtype">int</span> i = 0;
<a name="l05476"></a>05476         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> argc = <a class="code" href="../../d2/d47/compile_8c.html#a73c3ed009df9bde718b7c175b6ad13e4">CHECK_INTEGER</a>(<a class="code" href="../../dc/dcc/array_8c.html#ae3c2ac6c88e666d5418855114eb8bcf8">rb_ary_entry</a>(args, i++));
<a name="l05477"></a>05477         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> arg_opt_labels = <a class="code" href="../../d2/d47/compile_8c.html#a4eb4c2f878c69f9c6270ea2929eb3751">CHECK_ARRAY</a>(<a class="code" href="../../dc/dcc/array_8c.html#ae3c2ac6c88e666d5418855114eb8bcf8">rb_ary_entry</a>(args, i++));
<a name="l05478"></a>05478         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> arg_post_len = <a class="code" href="../../d2/d47/compile_8c.html#a73c3ed009df9bde718b7c175b6ad13e4">CHECK_INTEGER</a>(<a class="code" href="../../dc/dcc/array_8c.html#ae3c2ac6c88e666d5418855114eb8bcf8">rb_ary_entry</a>(args, i++));
<a name="l05479"></a>05479         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> arg_post_start = <a class="code" href="../../d2/d47/compile_8c.html#a73c3ed009df9bde718b7c175b6ad13e4">CHECK_INTEGER</a>(<a class="code" href="../../dc/dcc/array_8c.html#ae3c2ac6c88e666d5418855114eb8bcf8">rb_ary_entry</a>(args, i++));
<a name="l05480"></a>05480         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> arg_rest = <a class="code" href="../../d2/d47/compile_8c.html#a73c3ed009df9bde718b7c175b6ad13e4">CHECK_INTEGER</a>(<a class="code" href="../../dc/dcc/array_8c.html#ae3c2ac6c88e666d5418855114eb8bcf8">rb_ary_entry</a>(args, i++));
<a name="l05481"></a>05481         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> arg_block = <a class="code" href="../../d2/d47/compile_8c.html#a73c3ed009df9bde718b7c175b6ad13e4">CHECK_INTEGER</a>(<a class="code" href="../../dc/dcc/array_8c.html#ae3c2ac6c88e666d5418855114eb8bcf8">rb_ary_entry</a>(args, i++));
<a name="l05482"></a>05482         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> arg_simple = <a class="code" href="../../d2/d47/compile_8c.html#a73c3ed009df9bde718b7c175b6ad13e4">CHECK_INTEGER</a>(<a class="code" href="../../dc/dcc/array_8c.html#ae3c2ac6c88e666d5418855114eb8bcf8">rb_ary_entry</a>(args, i++));
<a name="l05483"></a>05483 
<a name="l05484"></a>05484         iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a5fd0acd110681eeb0f95c3b283451a0a" title="argument information">argc</a> = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a9444c431b3cb1184e7523fc572f2c758">FIX2INT</a>(argc);
<a name="l05485"></a>05485         iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a21bd6b9b1c875df9484cc16f8dd9c73e">arg_rest</a> = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a9444c431b3cb1184e7523fc572f2c758">FIX2INT</a>(arg_rest);
<a name="l05486"></a>05486         iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a4915a4238c8e8e7106337e5e1c609576">arg_post_len</a> = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a9444c431b3cb1184e7523fc572f2c758">FIX2INT</a>(arg_post_len);
<a name="l05487"></a>05487         iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a6250a263c2402b28f97ae50ef9b4e458">arg_post_start</a> = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a9444c431b3cb1184e7523fc572f2c758">FIX2INT</a>(arg_post_start);
<a name="l05488"></a>05488         iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a18ca49729d098ee7f25c9d3c3f0d9547">arg_block</a> = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a9444c431b3cb1184e7523fc572f2c758">FIX2INT</a>(arg_block);
<a name="l05489"></a>05489         iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#ad71990c5fa4c678e369e18bddbaf1639">arg_opts</a> = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a28084c7ad47ec550165c87e447e8356e">RARRAY_LENINT</a>(arg_opt_labels);
<a name="l05490"></a>05490         iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a5fa1e846aadb503610b7b2ce0ad643d9">arg_opt_table</a> = (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> *)<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a79041aa2bc7439c11906a86f82a52eb6">ALLOC_N</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>, iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#ad71990c5fa4c678e369e18bddbaf1639">arg_opts</a>);
<a name="l05491"></a>05491 
<a name="l05492"></a>05492         <span class="keywordflow">if</span> (iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a18ca49729d098ee7f25c9d3c3f0d9547">arg_block</a> != -1) {
<a name="l05493"></a>05493             iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#abd2b67e0dffb2262ab272a67bbe747d6">arg_size</a> = iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a18ca49729d098ee7f25c9d3c3f0d9547">arg_block</a> + 1;
<a name="l05494"></a>05494         }
<a name="l05495"></a>05495         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a4915a4238c8e8e7106337e5e1c609576">arg_post_len</a>) {
<a name="l05496"></a>05496             iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#abd2b67e0dffb2262ab272a67bbe747d6">arg_size</a> = iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a6250a263c2402b28f97ae50ef9b4e458">arg_post_start</a> + iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a4915a4238c8e8e7106337e5e1c609576">arg_post_len</a>;
<a name="l05497"></a>05497         }
<a name="l05498"></a>05498         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a21bd6b9b1c875df9484cc16f8dd9c73e">arg_rest</a> != -1) {
<a name="l05499"></a>05499             iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#abd2b67e0dffb2262ab272a67bbe747d6">arg_size</a> = iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a21bd6b9b1c875df9484cc16f8dd9c73e">arg_rest</a> + 1;
<a name="l05500"></a>05500         }
<a name="l05501"></a>05501         <span class="keywordflow">else</span> {
<a name="l05502"></a>05502             iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#abd2b67e0dffb2262ab272a67bbe747d6">arg_size</a> = iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a5fd0acd110681eeb0f95c3b283451a0a" title="argument information">argc</a> + (iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#ad71990c5fa4c678e369e18bddbaf1639">arg_opts</a> ? iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#ad71990c5fa4c678e369e18bddbaf1639">arg_opts</a> - 1 : 0);
<a name="l05503"></a>05503         }
<a name="l05504"></a>05504 
<a name="l05505"></a>05505         <span class="keywordflow">for</span> (i=0; i&lt;<a class="code" href="../../d8/df4/generator_8h.html#ae988773ed219452578f881fc7189c486">RARRAY_LEN</a>(arg_opt_labels); i++) {
<a name="l05506"></a>05506             iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a5fa1e846aadb503610b7b2ce0ad643d9">arg_opt_table</a>[i] =
<a name="l05507"></a>05507               (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>)<a class="code" href="../../d2/d47/compile_8c.html#a4b8c1c7c40330a696716891d88680a67">register_label</a>(iseq, labels_table,
<a name="l05508"></a>05508                                     <a class="code" href="../../dc/dcc/array_8c.html#ae3c2ac6c88e666d5418855114eb8bcf8">rb_ary_entry</a>(arg_opt_labels, i));
<a name="l05509"></a>05509         }
<a name="l05510"></a>05510 
<a name="l05511"></a>05511         iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#ae7f7a6daa388dc65f83c27600cb39b00">arg_simple</a> = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a877c38180d23c5447d976c70dda89d69">NUM2INT</a>(arg_simple);
<a name="l05512"></a>05512     }
<a name="l05513"></a>05513 
<a name="l05514"></a>05514     <span class="comment">/* exception */</span>
<a name="l05515"></a>05515     <a class="code" href="../../d2/d47/compile_8c.html#abffab9c8c7ac7b527e8c593ea14d774b">iseq_build_from_ary_exception</a>(iseq, labels_table, exception);
<a name="l05516"></a>05516 
<a name="l05517"></a>05517     <span class="comment">/* body */</span>
<a name="l05518"></a>05518     <a class="code" href="../../d2/d47/compile_8c.html#ab7a6e582abc36e8dfe3d7981d4597c31">iseq_build_from_ary_body</a>(iseq, anchor, body, labels_table);
<a name="l05519"></a>05519     <span class="keywordflow">return</span> iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a46d5fb5c3de970a9540ab85d4b060957">self</a>;
<a name="l05520"></a>05520 }
<a name="l05521"></a>05521 
<a name="l05522"></a>05522 <span class="comment">/* for parser */</span>
<a name="l05523"></a>05523 
<a name="l05524"></a>05524 <span class="keywordtype">int</span>
<a name="l05525"></a><a class="code" href="../../d2/d47/compile_8c.html#a8dae7d00e7ad11c9022ffaa83e7226f5">05525</a> <a class="code" href="../../d2/d47/compile_8c.html#a8dae7d00e7ad11c9022ffaa83e7226f5">rb_dvar_defined</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#afa5b9137f051ac26d7ccc8824f178233">ID</a> <span class="keywordtype">id</span>)
<a name="l05526"></a>05526 {
<a name="l05527"></a>05527     <a class="code" href="../../d2/d66/structrb__thread__struct.html">rb_thread_t</a> *th = <a class="code" href="../../d8/d32/vm__core_8h.html#a8deb84ec6023e3229db88ac2c9da6138">GET_THREAD</a>();
<a name="l05528"></a>05528     <a class="code" href="../../d6/de3/structrb__iseq__struct.html">rb_iseq_t</a> *iseq;
<a name="l05529"></a>05529     <span class="keywordflow">if</span> (th-&gt;<a class="code" href="../../d2/d66/structrb__thread__struct.html#aad6cc8c9d9f511c12cca5af8c8aa6e77">base_block</a> &amp;&amp; (iseq = th-&gt;<a class="code" href="../../d2/d66/structrb__thread__struct.html#aad6cc8c9d9f511c12cca5af8c8aa6e77">base_block</a>-&gt;<a class="code" href="../../da/dc0/structrb__block__struct.html#a8e2b3b9218b4a184f198872404e81605">iseq</a>)) {
<a name="l05530"></a>05530         <span class="keywordflow">while</span> (iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#af8bc7dbae6f61d836b5bb9fb50b6cfb8">type</a> == ISEQ_TYPE_BLOCK ||
<a name="l05531"></a>05531                iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#af8bc7dbae6f61d836b5bb9fb50b6cfb8">type</a> == ISEQ_TYPE_RESCUE ||
<a name="l05532"></a>05532                iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#af8bc7dbae6f61d836b5bb9fb50b6cfb8">type</a> == ISEQ_TYPE_ENSURE ||
<a name="l05533"></a>05533                iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#af8bc7dbae6f61d836b5bb9fb50b6cfb8">type</a> == ISEQ_TYPE_EVAL ||
<a name="l05534"></a>05534                iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#af8bc7dbae6f61d836b5bb9fb50b6cfb8">type</a> == ISEQ_TYPE_MAIN
<a name="l05535"></a>05535                ) {
<a name="l05536"></a>05536             <span class="keywordtype">int</span> i;
<a name="l05537"></a>05537 
<a name="l05538"></a>05538             <span class="keywordflow">for</span> (i = 0; i &lt; iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a22ff1695f19e63e6540bc574949c55b0">local_table_size</a>; i++) {
<a name="l05539"></a>05539                 <span class="keywordflow">if</span> (iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a667787a2e393a8e2a203bf1c2442276d">local_table</a>[i] == <span class="keywordtype">id</span>) {
<a name="l05540"></a>05540                     <span class="keywordflow">return</span> 1;
<a name="l05541"></a>05541                 }
<a name="l05542"></a>05542             }
<a name="l05543"></a>05543             iseq = iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#afce02da209c0bf9a09ef4ea0af68e623">parent_iseq</a>;
<a name="l05544"></a>05544         }
<a name="l05545"></a>05545     }
<a name="l05546"></a>05546     <span class="keywordflow">return</span> 0;
<a name="l05547"></a>05547 }
<a name="l05548"></a>05548 
<a name="l05549"></a>05549 <span class="keywordtype">int</span>
<a name="l05550"></a><a class="code" href="../../d2/d47/compile_8c.html#ae8c5c61bbbedb2b0f0a295aa4465b9e2">05550</a> <a class="code" href="../../d2/d47/compile_8c.html#ae8c5c61bbbedb2b0f0a295aa4465b9e2">rb_local_defined</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#afa5b9137f051ac26d7ccc8824f178233">ID</a> <span class="keywordtype">id</span>)
<a name="l05551"></a>05551 {
<a name="l05552"></a>05552     <a class="code" href="../../d2/d66/structrb__thread__struct.html">rb_thread_t</a> *th = <a class="code" href="../../d8/d32/vm__core_8h.html#a8deb84ec6023e3229db88ac2c9da6138">GET_THREAD</a>();
<a name="l05553"></a>05553     <a class="code" href="../../d6/de3/structrb__iseq__struct.html">rb_iseq_t</a> *iseq;
<a name="l05554"></a>05554 
<a name="l05555"></a>05555     <span class="keywordflow">if</span> (th-&gt;<a class="code" href="../../d2/d66/structrb__thread__struct.html#aad6cc8c9d9f511c12cca5af8c8aa6e77">base_block</a> &amp;&amp; th-&gt;<a class="code" href="../../d2/d66/structrb__thread__struct.html#aad6cc8c9d9f511c12cca5af8c8aa6e77">base_block</a>-&gt;<a class="code" href="../../da/dc0/structrb__block__struct.html#a8e2b3b9218b4a184f198872404e81605">iseq</a>) {
<a name="l05556"></a>05556         <span class="keywordtype">int</span> i;
<a name="l05557"></a>05557         iseq = th-&gt;<a class="code" href="../../d2/d66/structrb__thread__struct.html#aad6cc8c9d9f511c12cca5af8c8aa6e77">base_block</a>-&gt;<a class="code" href="../../da/dc0/structrb__block__struct.html#a8e2b3b9218b4a184f198872404e81605">iseq</a>-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a0f5705507c4c80bc69c3f031dd0daae9">local_iseq</a>;
<a name="l05558"></a>05558 
<a name="l05559"></a>05559         <span class="keywordflow">for</span> (i=0; i&lt;iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a22ff1695f19e63e6540bc574949c55b0">local_table_size</a>; i++) {
<a name="l05560"></a>05560             <span class="keywordflow">if</span> (iseq-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a667787a2e393a8e2a203bf1c2442276d">local_table</a>[i] == <span class="keywordtype">id</span>) {
<a name="l05561"></a>05561                 <span class="keywordflow">return</span> 1;
<a name="l05562"></a>05562             }
<a name="l05563"></a>05563         }
<a name="l05564"></a>05564     }
<a name="l05565"></a>05565     <span class="keywordflow">return</span> 0;
<a name="l05566"></a>05566 }
<a name="l05567"></a>05567 
<a name="l05568"></a>05568 <span class="keywordtype">int</span>
<a name="l05569"></a><a class="code" href="../../d2/d47/compile_8c.html#afd0e8dc10524cd155afbbe700fbfdf19">05569</a> <a class="code" href="../../d2/d47/compile_8c.html#afd0e8dc10524cd155afbbe700fbfdf19">rb_parse_in_eval</a>(<span class="keywordtype">void</span>)
<a name="l05570"></a>05570 {
<a name="l05571"></a>05571     <span class="keywordflow">return</span> <a class="code" href="../../d8/d32/vm__core_8h.html#a8deb84ec6023e3229db88ac2c9da6138">GET_THREAD</a>()-&gt;parse_in_eval &gt; 0;
<a name="l05572"></a>05572 }
<a name="l05573"></a>05573 
<a name="l05574"></a>05574 <span class="keywordtype">int</span>
<a name="l05575"></a><a class="code" href="../../d2/d47/compile_8c.html#a330cb719f3b4c6d45c3e34c6629b3ca4">05575</a> <a class="code" href="../../d2/d47/compile_8c.html#a330cb719f3b4c6d45c3e34c6629b3ca4">rb_parse_in_main</a>(<span class="keywordtype">void</span>)
<a name="l05576"></a>05576 {
<a name="l05577"></a>05577     <span class="keywordflow">return</span> <a class="code" href="../../d8/d32/vm__core_8h.html#a8deb84ec6023e3229db88ac2c9da6138">GET_THREAD</a>()-&gt;parse_in_eval &lt; 0;
<a name="l05578"></a>05578 }
<a name="l05579"></a>05579 
</pre></div></div>
<hr size="1"/><address style="text-align: right;"><small>Generated on 1 Mar 2013 for Ruby by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
