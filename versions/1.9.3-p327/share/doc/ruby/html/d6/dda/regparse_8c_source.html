<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Ruby: regparse.c Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="../../index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="../../files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="../../globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<h1>regparse.c</h1><a href="../../d6/dda/regparse_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/* -*- mode:c; c-file-style:&quot;gnu&quot; -*- */</span>
<a name="l00002"></a>00002 <span class="comment">/**********************************************************************</span>
<a name="l00003"></a>00003 <span class="comment">  regparse.c -  Oniguruma (regular expression library)</span>
<a name="l00004"></a>00004 <span class="comment">**********************************************************************/</span>
<a name="l00005"></a>00005 <span class="comment">/*-</span>
<a name="l00006"></a>00006 <span class="comment"> * Copyright (c) 2002-2008  K.Kosako  &lt;sndgk393 AT ybb DOT ne DOT jp&gt;</span>
<a name="l00007"></a>00007 <span class="comment"> * All rights reserved.</span>
<a name="l00008"></a>00008 <span class="comment"> *</span>
<a name="l00009"></a>00009 <span class="comment"> * Redistribution and use in source and binary forms, with or without</span>
<a name="l00010"></a>00010 <span class="comment"> * modification, are permitted provided that the following conditions</span>
<a name="l00011"></a>00011 <span class="comment"> * are met:</span>
<a name="l00012"></a>00012 <span class="comment"> * 1. Redistributions of source code must retain the above copyright</span>
<a name="l00013"></a>00013 <span class="comment"> *    notice, this list of conditions and the following disclaimer.</span>
<a name="l00014"></a>00014 <span class="comment"> * 2. Redistributions in binary form must reproduce the above copyright</span>
<a name="l00015"></a>00015 <span class="comment"> *    notice, this list of conditions and the following disclaimer in the</span>
<a name="l00016"></a>00016 <span class="comment"> *    documentation and/or other materials provided with the distribution.</span>
<a name="l00017"></a>00017 <span class="comment"> *</span>
<a name="l00018"></a>00018 <span class="comment"> * THIS SOFTWARE IS PROVIDED BY THE AUTHOR AND CONTRIBUTORS ``AS IS&apos;&apos; AND</span>
<a name="l00019"></a>00019 <span class="comment"> * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE</span>
<a name="l00020"></a>00020 <span class="comment"> * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE</span>
<a name="l00021"></a>00021 <span class="comment"> * ARE DISCLAIMED.  IN NO EVENT SHALL THE AUTHOR OR CONTRIBUTORS BE LIABLE</span>
<a name="l00022"></a>00022 <span class="comment"> * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL</span>
<a name="l00023"></a>00023 <span class="comment"> * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS</span>
<a name="l00024"></a>00024 <span class="comment"> * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)</span>
<a name="l00025"></a>00025 <span class="comment"> * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT</span>
<a name="l00026"></a>00026 <span class="comment"> * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY</span>
<a name="l00027"></a>00027 <span class="comment"> * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF</span>
<a name="l00028"></a>00028 <span class="comment"> * SUCH DAMAGE.</span>
<a name="l00029"></a>00029 <span class="comment"> */</span>
<a name="l00030"></a>00030 
<a name="l00031"></a>00031 <span class="preprocessor">#include &quot;<a class="code" href="../../d1/dfc/regparse_8h.html">regparse.h</a>&quot;</span>
<a name="l00032"></a>00032 
<a name="l00033"></a><a class="code" href="../../d6/dda/regparse_8c.html#a672827e035b8ebbeae739f715a4757b7">00033</a> <span class="preprocessor">#define WARN_BUFSIZE    256</span>
<a name="l00034"></a>00034 <span class="preprocessor"></span>
<a name="l00035"></a><a class="code" href="../../d6/dda/regparse_8c.html#ab2c1b06d583864757000b9ef2c0c9324">00035</a> <span class="preprocessor">#define CASE_FOLD_IS_APPLIED_INSIDE_NEGATIVE_CCLASS</span>
<a name="l00036"></a>00036 <span class="preprocessor"></span>
<a name="l00037"></a>00037 
<a name="l00038"></a><a class="code" href="../../d6/dda/regparse_8c.html#aae35fe0ac2a8236bb171bec1e4f21f23">00038</a> <span class="keyword">const</span> <a class="code" href="../../d3/d3f/struct_onig_syntax_type.html">OnigSyntaxType</a> <a class="code" href="../../d8/db3/oniguruma_8h.html#a0662de7da3e41824c1b0aa3c3dbec67b">OnigSyntaxRuby</a> = {
<a name="l00039"></a>00039   (( <a class="code" href="../../d6/d87/regint_8h.html#a5f9b4539b5b63b77593a2ce050d78636">SYN_GNU_REGEX_OP</a> | <a class="code" href="../../d8/db3/oniguruma_8h.html#a15002f2065623821c390b05a3891f235">ONIG_SYN_OP_QMARK_NON_GREEDY</a> |
<a name="l00040"></a>00040      <a class="code" href="../../d8/db3/oniguruma_8h.html#a840371e8111b6e76aeb0a7a872009d37">ONIG_SYN_OP_ESC_OCTAL3</a> | <a class="code" href="../../d8/db3/oniguruma_8h.html#af14ad84f8fe1489439420a17287fd994">ONIG_SYN_OP_ESC_X_HEX2</a> |
<a name="l00041"></a>00041      <a class="code" href="../../d8/db3/oniguruma_8h.html#a5bedbddb8c6796ca25a1dad1154d696c">ONIG_SYN_OP_ESC_X_BRACE_HEX8</a> | <a class="code" href="../../d8/db3/oniguruma_8h.html#a9ecb3a3cdbef8f8e62fcfb1a3227466e">ONIG_SYN_OP_ESC_CONTROL_CHARS</a> |
<a name="l00042"></a>00042      <a class="code" href="../../d8/db3/oniguruma_8h.html#a00c37ae334ac9f7a717515cd6028372c">ONIG_SYN_OP_ESC_C_CONTROL</a> )
<a name="l00043"></a>00043    &amp; ~<a class="code" href="../../d8/db3/oniguruma_8h.html#a2cf4189198916ecf90fe9f51e8d55f64">ONIG_SYN_OP_ESC_LTGT_WORD_BEGIN_END</a> )
<a name="l00044"></a>00044   , ( <a class="code" href="../../d8/db3/oniguruma_8h.html#a13b0e230fa74c42ddd7b50fb6ad9d3b4">ONIG_SYN_OP2_QMARK_GROUP_EFFECT</a> |
<a name="l00045"></a>00045       <a class="code" href="../../d8/db3/oniguruma_8h.html#a7d320b0fe7a9c66212bc05b768dceaf7">ONIG_SYN_OP2_OPTION_RUBY</a> |
<a name="l00046"></a>00046       <a class="code" href="../../d8/db3/oniguruma_8h.html#aa086dbb42e890875bbb8e2aace784490">ONIG_SYN_OP2_QMARK_LT_NAMED_GROUP</a> | <a class="code" href="../../d8/db3/oniguruma_8h.html#ac2661872d7b556c75f5f5c1beab3ddf9">ONIG_SYN_OP2_ESC_K_NAMED_BACKREF</a> |
<a name="l00047"></a>00047       <a class="code" href="../../d8/db3/oniguruma_8h.html#ae6de0d8bc3c3ae511fdb6b2f15221713">ONIG_SYN_OP2_ESC_G_SUBEXP_CALL</a> |
<a name="l00048"></a>00048       <a class="code" href="../../d8/db3/oniguruma_8h.html#a292134a70cda1a681a663e11180fd0c2">ONIG_SYN_OP2_ESC_P_BRACE_CHAR_PROPERTY</a>  |
<a name="l00049"></a>00049       <a class="code" href="../../d8/db3/oniguruma_8h.html#a2dbc25f5f5e66628427c51fb4d100441">ONIG_SYN_OP2_ESC_P_BRACE_CIRCUMFLEX_NOT</a> |
<a name="l00050"></a>00050       <a class="code" href="../../d8/db3/oniguruma_8h.html#a966dc399c5f4a319a9242034b81a60d5">ONIG_SYN_OP2_PLUS_POSSESSIVE_REPEAT</a> |
<a name="l00051"></a>00051       <a class="code" href="../../d8/db3/oniguruma_8h.html#aa16634dc728c68b9b4b46f006c1c7ace">ONIG_SYN_OP2_CCLASS_SET_OP</a> | <a class="code" href="../../d8/db3/oniguruma_8h.html#af255376b1d9217b200bc22f82aa7eae3">ONIG_SYN_OP2_ESC_CAPITAL_C_BAR_CONTROL</a> |
<a name="l00052"></a>00052       <a class="code" href="../../d8/db3/oniguruma_8h.html#af4f3ea1b37fdb1b91c592744edae4be8">ONIG_SYN_OP2_ESC_CAPITAL_M_BAR_META</a> | <a class="code" href="../../d8/db3/oniguruma_8h.html#a7639bc82cae8f0cac8cfa1b600a3ca0b">ONIG_SYN_OP2_ESC_V_VTAB</a> |
<a name="l00053"></a>00053       <a class="code" href="../../d8/db3/oniguruma_8h.html#a9dbad596d7c30d8a2ba5e59d07dc1827">ONIG_SYN_OP2_ESC_H_XDIGIT</a> )
<a name="l00054"></a>00054   , ( <a class="code" href="../../d6/d87/regint_8h.html#ad9f3209c71ed09392888abcb3f5dbddb">SYN_GNU_REGEX_BV</a> |
<a name="l00055"></a>00055       <a class="code" href="../../d8/db3/oniguruma_8h.html#a5fd0eebb7d7d24b95945128a0c007f4f">ONIG_SYN_ALLOW_INTERVAL_LOW_ABBREV</a> |
<a name="l00056"></a>00056       <a class="code" href="../../d8/db3/oniguruma_8h.html#ac71155485c9f6a0467a4e789730ed2c6">ONIG_SYN_DIFFERENT_LEN_ALT_LOOK_BEHIND</a> |
<a name="l00057"></a>00057       <a class="code" href="../../d8/db3/oniguruma_8h.html#aabffac0a9cf8aa6bda2d83997bbccd94">ONIG_SYN_CAPTURE_ONLY_NAMED_GROUP</a> |
<a name="l00058"></a>00058       <a class="code" href="../../d8/db3/oniguruma_8h.html#a4b30e30f68c92db9ed8668e1aab768b9">ONIG_SYN_ALLOW_MULTIPLEX_DEFINITION_NAME</a> |
<a name="l00059"></a>00059       <a class="code" href="../../d8/db3/oniguruma_8h.html#a269f5fa639cd57a23b0333cd062911be">ONIG_SYN_FIXED_INTERVAL_IS_GREEDY_ONLY</a> |
<a name="l00060"></a>00060       <a class="code" href="../../d8/db3/oniguruma_8h.html#a6bbc59312864308b494c106283c5e10f">ONIG_SYN_WARN_CC_OP_NOT_ESCAPED</a> |
<a name="l00061"></a>00061       <a class="code" href="../../d8/db3/oniguruma_8h.html#a3c9685ef00f2d7375294fb0703bcc070">ONIG_SYN_WARN_CC_DUP</a> |
<a name="l00062"></a>00062       <a class="code" href="../../d8/db3/oniguruma_8h.html#a7f435020030f24a088a8aa07b47710ff">ONIG_SYN_WARN_REDUNDANT_NESTED_REPEAT</a> )
<a name="l00063"></a>00063   , <a class="code" href="../../d8/db3/oniguruma_8h.html#afb722f82ff0b6ef0aca8f670474d3fcf">ONIG_OPTION_NONE</a>
<a name="l00064"></a>00064   ,
<a name="l00065"></a>00065   {
<a name="l00066"></a>00066       (<a class="code" href="../../d8/db3/oniguruma_8h.html#a7c8a84bc12127007886efbfcf53b6fb5">OnigCodePoint</a> )<span class="charliteral">&apos;\\&apos;</span>                       <span class="comment">/* esc */</span>
<a name="l00067"></a>00067     , (<a class="code" href="../../d8/db3/oniguruma_8h.html#a7c8a84bc12127007886efbfcf53b6fb5">OnigCodePoint</a> )<a class="code" href="../../d8/db3/oniguruma_8h.html#a3215ed7f35ff11e2c20849fee66ae602">ONIG_INEFFECTIVE_META_CHAR</a> <span class="comment">/* anychar &apos;.&apos;  */</span>
<a name="l00068"></a>00068     , (<a class="code" href="../../d8/db3/oniguruma_8h.html#a7c8a84bc12127007886efbfcf53b6fb5">OnigCodePoint</a> )<a class="code" href="../../d8/db3/oniguruma_8h.html#a3215ed7f35ff11e2c20849fee66ae602">ONIG_INEFFECTIVE_META_CHAR</a> <span class="comment">/* anytime &apos;*&apos;  */</span>
<a name="l00069"></a>00069     , (<a class="code" href="../../d8/db3/oniguruma_8h.html#a7c8a84bc12127007886efbfcf53b6fb5">OnigCodePoint</a> )<a class="code" href="../../d8/db3/oniguruma_8h.html#a3215ed7f35ff11e2c20849fee66ae602">ONIG_INEFFECTIVE_META_CHAR</a> <span class="comment">/* zero or one time &apos;?&apos; */</span>
<a name="l00070"></a>00070     , (<a class="code" href="../../d8/db3/oniguruma_8h.html#a7c8a84bc12127007886efbfcf53b6fb5">OnigCodePoint</a> )<a class="code" href="../../d8/db3/oniguruma_8h.html#a3215ed7f35ff11e2c20849fee66ae602">ONIG_INEFFECTIVE_META_CHAR</a> <span class="comment">/* one or more time &apos;+&apos; */</span>
<a name="l00071"></a>00071     , (<a class="code" href="../../d8/db3/oniguruma_8h.html#a7c8a84bc12127007886efbfcf53b6fb5">OnigCodePoint</a> )<a class="code" href="../../d8/db3/oniguruma_8h.html#a3215ed7f35ff11e2c20849fee66ae602">ONIG_INEFFECTIVE_META_CHAR</a> <span class="comment">/* anychar anytime */</span>
<a name="l00072"></a>00072   }
<a name="l00073"></a>00073 };
<a name="l00074"></a>00074 
<a name="l00075"></a><a class="code" href="../../d6/dda/regparse_8c.html#a8a0117b991c0fe9bfa0e286035ead673">00075</a> <span class="keyword">const</span> <a class="code" href="../../d3/d3f/struct_onig_syntax_type.html">OnigSyntaxType</a>*  <a class="code" href="../../d8/db3/oniguruma_8h.html#a8f27e991eddcae0a56263266ed9deae7">OnigDefaultSyntax</a> = <a class="code" href="../../d8/db3/oniguruma_8h.html#a339ef024fddd49710ec7f416f9fcf865">ONIG_SYNTAX_RUBY</a>;
<a name="l00076"></a>00076 
<a name="l00077"></a><a class="code" href="../../d6/dda/regparse_8c.html#a32f51f068bd8e9c2eb940e259f054e9f">00077</a> <span class="keyword">extern</span> <span class="keywordtype">void</span> <a class="code" href="../../d6/dda/regparse_8c.html#a32f51f068bd8e9c2eb940e259f054e9f">onig_null_warn</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* s ARG_UNUSED) { }
<a name="l00078"></a>00078 
<a name="l00079"></a>00079 <span class="preprocessor">#ifdef DEFAULT_WARN_FUNCTION</span>
<a name="l00080"></a>00080 <span class="preprocessor"></span><span class="keyword">static</span> OnigWarnFunc <a class="code" href="../../d6/dda/regparse_8c.html#a85dc90a01fd054e748019cd1858c39b8">onig_warn</a> = (OnigWarnFunc )DEFAULT_WARN_FUNCTION;
<a name="l00081"></a>00081 <span class="preprocessor">#else</span>
<a name="l00082"></a><a class="code" href="../../d6/dda/regparse_8c.html#a85dc90a01fd054e748019cd1858c39b8">00082</a> <span class="preprocessor"></span><span class="keyword">static</span> OnigWarnFunc <a class="code" href="../../d6/dda/regparse_8c.html#a85dc90a01fd054e748019cd1858c39b8">onig_warn</a> = <a class="code" href="../../d6/dda/regparse_8c.html#a32f51f068bd8e9c2eb940e259f054e9f">onig_null_warn</a>;
<a name="l00083"></a>00083 <span class="preprocessor">#endif</span>
<a name="l00084"></a>00084 <span class="preprocessor"></span>
<a name="l00085"></a>00085 <span class="preprocessor">#ifdef DEFAULT_VERB_WARN_FUNCTION</span>
<a name="l00086"></a>00086 <span class="preprocessor"></span><span class="keyword">static</span> OnigWarnFunc <a class="code" href="../../d6/dda/regparse_8c.html#a6b03912e53a004c0523030d1b31bbe1f">onig_verb_warn</a> = (OnigWarnFunc )DEFAULT_VERB_WARN_FUNCTION;
<a name="l00087"></a>00087 <span class="preprocessor">#else</span>
<a name="l00088"></a><a class="code" href="../../d6/dda/regparse_8c.html#a6b03912e53a004c0523030d1b31bbe1f">00088</a> <span class="preprocessor"></span><span class="keyword">static</span> OnigWarnFunc <a class="code" href="../../d6/dda/regparse_8c.html#a6b03912e53a004c0523030d1b31bbe1f">onig_verb_warn</a> = <a class="code" href="../../d6/dda/regparse_8c.html#a32f51f068bd8e9c2eb940e259f054e9f">onig_null_warn</a>;
<a name="l00089"></a>00089 <span class="preprocessor">#endif</span>
<a name="l00090"></a>00090 <span class="preprocessor"></span>
<a name="l00091"></a><a class="code" href="../../d6/dda/regparse_8c.html#a3562189ce2bff13f776e44ef0b29b8ab">00091</a> <span class="keyword">extern</span> <span class="keywordtype">void</span> <a class="code" href="../../d6/dda/regparse_8c.html#a3562189ce2bff13f776e44ef0b29b8ab">onig_set_warn_func</a>(OnigWarnFunc f)
<a name="l00092"></a>00092 {
<a name="l00093"></a>00093   <a class="code" href="../../d6/dda/regparse_8c.html#a85dc90a01fd054e748019cd1858c39b8">onig_warn</a> = f;
<a name="l00094"></a>00094 }
<a name="l00095"></a>00095 
<a name="l00096"></a><a class="code" href="../../d6/dda/regparse_8c.html#ae560e4fb67a0fa31849c24aa1f466a18">00096</a> <span class="keyword">extern</span> <span class="keywordtype">void</span> <a class="code" href="../../d6/dda/regparse_8c.html#ae560e4fb67a0fa31849c24aa1f466a18">onig_set_verb_warn_func</a>(OnigWarnFunc f)
<a name="l00097"></a>00097 {
<a name="l00098"></a>00098   <a class="code" href="../../d6/dda/regparse_8c.html#a6b03912e53a004c0523030d1b31bbe1f">onig_verb_warn</a> = f;
<a name="l00099"></a>00099 }
<a name="l00100"></a>00100 
<a name="l00101"></a>00101 <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d6/dda/regparse_8c.html#af3eccf7a260f9d9f50a8be9c54502a1f">CC_DUP_WARN</a>(<a class="code" href="../../d6/dbe/struct_scan_env.html">ScanEnv</a> *env);
<a name="l00102"></a>00102 
<a name="l00103"></a>00103 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00104"></a><a class="code" href="../../d6/dda/regparse_8c.html#ac57154f90d1120d13c794cb9ba3cdba2">00104</a> <a class="code" href="../../d6/dda/regparse_8c.html#ac57154f90d1120d13c794cb9ba3cdba2">bbuf_free</a>(<a class="code" href="../../d0/deb/struct___b_buf.html">BBuf</a>* bbuf)
<a name="l00105"></a>00105 {
<a name="l00106"></a>00106   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d87/regint_8h.html#a4bc25fbd4749a2c130d1ae7f15ba140c">IS_NOT_NULL</a>(bbuf)) {
<a name="l00107"></a>00107     <span class="keywordflow">if</span> (<a class="code" href="../../d6/d87/regint_8h.html#a4bc25fbd4749a2c130d1ae7f15ba140c">IS_NOT_NULL</a>(bbuf-&gt;<a class="code" href="../../d0/deb/struct___b_buf.html#a3d79f476af8e7a57dd240e68f11867a1">p</a>)) <a class="code" href="../../d8/db0/defines_8h.html#a2c3897f7c46ca54a2e0dd7b24a40c7cb">xfree</a>(bbuf-&gt;<a class="code" href="../../d0/deb/struct___b_buf.html#a3d79f476af8e7a57dd240e68f11867a1">p</a>);
<a name="l00108"></a>00108     <a class="code" href="../../d8/db0/defines_8h.html#a2c3897f7c46ca54a2e0dd7b24a40c7cb">xfree</a>(bbuf);
<a name="l00109"></a>00109   }
<a name="l00110"></a>00110 }
<a name="l00111"></a>00111 
<a name="l00112"></a>00112 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l00113"></a><a class="code" href="../../d6/dda/regparse_8c.html#a8092183b871bc7c73c6aed93c11cc01e">00113</a> <a class="code" href="../../d6/dda/regparse_8c.html#a8092183b871bc7c73c6aed93c11cc01e">bbuf_clone</a>(<a class="code" href="../../d0/deb/struct___b_buf.html">BBuf</a>** rto, <a class="code" href="../../d0/deb/struct___b_buf.html">BBuf</a>* from)
<a name="l00114"></a>00114 {
<a name="l00115"></a>00115   <span class="keywordtype">int</span> r;
<a name="l00116"></a>00116   <a class="code" href="../../d0/deb/struct___b_buf.html">BBuf</a> *to;
<a name="l00117"></a>00117 
<a name="l00118"></a>00118   *rto = to = (<a class="code" href="../../d0/deb/struct___b_buf.html">BBuf</a>* )<a class="code" href="../../d8/db0/defines_8h.html#a6af5faec3f9662b20ffc9903f923dec0">xmalloc</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../d0/deb/struct___b_buf.html">BBuf</a>));
<a name="l00119"></a>00119   <a class="code" href="../../d6/d87/regint_8h.html#a17ebb2a12300dcf6d79916e357fae45a">CHECK_NULL_RETURN_MEMERR</a>(to);
<a name="l00120"></a>00120   r = <a class="code" href="../../d6/d87/regint_8h.html#a791a20675ed654805f305bd867813a89">BBUF_INIT</a>(to, from-&gt;<a class="code" href="../../d0/deb/struct___b_buf.html#a12b605256309f2254309f69b92c4ab44">alloc</a>);
<a name="l00121"></a>00121   <span class="keywordflow">if</span> (r != 0) <span class="keywordflow">return</span> r;
<a name="l00122"></a>00122   to-&gt;<a class="code" href="../../d0/deb/struct___b_buf.html#acf9f185ff639d57c7e4aaa6e6415888c">used</a> = from-&gt;<a class="code" href="../../d0/deb/struct___b_buf.html#acf9f185ff639d57c7e4aaa6e6415888c">used</a>;
<a name="l00123"></a>00123   <a class="code" href="../../d6/d87/regint_8h.html#ad9f94f6a1ee2c69b34d8034684b31518">xmemcpy</a>(to-&gt;<a class="code" href="../../d0/deb/struct___b_buf.html#a3d79f476af8e7a57dd240e68f11867a1">p</a>, from-&gt;<a class="code" href="../../d0/deb/struct___b_buf.html#a3d79f476af8e7a57dd240e68f11867a1">p</a>, from-&gt;<a class="code" href="../../d0/deb/struct___b_buf.html#acf9f185ff639d57c7e4aaa6e6415888c">used</a>);
<a name="l00124"></a>00124   <span class="keywordflow">return</span> 0;
<a name="l00125"></a>00125 }
<a name="l00126"></a>00126 
<a name="l00127"></a><a class="code" href="../../d6/dda/regparse_8c.html#ab46c3e257763e4d4732f97674ea1689c">00127</a> <span class="preprocessor">#define BACKREF_REL_TO_ABS(rel_no, env) \</span>
<a name="l00128"></a>00128 <span class="preprocessor">  ((env)-&gt;num_mem + 1 + (rel_no))</span>
<a name="l00129"></a>00129 <span class="preprocessor"></span>
<a name="l00130"></a><a class="code" href="../../d6/dda/regparse_8c.html#a4602f81600008fe353870e4d762cb698">00130</a> <span class="preprocessor">#define ONOFF(v,f,negative)    (negative) ? ((v) &amp;= ~(f)) : ((v) |= (f))</span>
<a name="l00131"></a>00131 <span class="preprocessor"></span>
<a name="l00132"></a><a class="code" href="../../d6/dda/regparse_8c.html#a80c61185f8f4a16b70dcc75b41aad485">00132</a> <span class="preprocessor">#define MBCODE_START_POS(enc) \</span>
<a name="l00133"></a>00133 <span class="preprocessor">  (OnigCodePoint )(ONIGENC_MBC_MINLEN(enc) &gt; 1 ? 0 : 0x80)</span>
<a name="l00134"></a>00134 <span class="preprocessor"></span>
<a name="l00135"></a><a class="code" href="../../d6/dda/regparse_8c.html#af72e49d78040e67cd3e66882a8e49b1d">00135</a> <span class="preprocessor">#define SET_ALL_MULTI_BYTE_RANGE(enc, pbuf) \</span>
<a name="l00136"></a>00136 <span class="preprocessor">  add_code_range_to_buf(pbuf, env, MBCODE_START_POS(enc), ~((OnigCodePoint )0))</span>
<a name="l00137"></a>00137 <span class="preprocessor"></span>
<a name="l00138"></a><a class="code" href="../../d6/dda/regparse_8c.html#a6742d030e4c0a6bbfda108f94e1554a9">00138</a> <span class="preprocessor">#define ADD_ALL_MULTI_BYTE_RANGE(enc, mbuf) do {\</span>
<a name="l00139"></a>00139 <span class="preprocessor">  if (! ONIGENC_IS_SINGLEBYTE(enc)) {\</span>
<a name="l00140"></a>00140 <span class="preprocessor">    r = SET_ALL_MULTI_BYTE_RANGE(enc, &amp;(mbuf));\</span>
<a name="l00141"></a>00141 <span class="preprocessor">    if (r) return r;\</span>
<a name="l00142"></a>00142 <span class="preprocessor">  }\</span>
<a name="l00143"></a>00143 <span class="preprocessor">} while (0)</span>
<a name="l00144"></a>00144 <span class="preprocessor"></span>
<a name="l00145"></a>00145 
<a name="l00146"></a><a class="code" href="../../d6/dda/regparse_8c.html#acafa6a8e6b897efa2f65abaf8790a220">00146</a> <span class="preprocessor">#define BITSET_SET_BIT_CHKDUP(bs, pos) do { \</span>
<a name="l00147"></a>00147 <span class="preprocessor">  if (BITSET_AT(bs, pos)) CC_DUP_WARN(env); \</span>
<a name="l00148"></a>00148 <span class="preprocessor">  BS_ROOM(bs, pos) |= BS_BIT(pos); \</span>
<a name="l00149"></a>00149 <span class="preprocessor">} while (0)</span>
<a name="l00150"></a>00150 <span class="preprocessor"></span>
<a name="l00151"></a><a class="code" href="../../d6/dda/regparse_8c.html#ab965222074f64adfc1545ff478724d34">00151</a> <span class="preprocessor">#define BITSET_IS_EMPTY(bs,empty) do {\</span>
<a name="l00152"></a>00152 <span class="preprocessor">  int i;\</span>
<a name="l00153"></a>00153 <span class="preprocessor">  empty = 1;\</span>
<a name="l00154"></a>00154 <span class="preprocessor">  for (i = 0; i &lt; (int )BITSET_SIZE; i++) {\</span>
<a name="l00155"></a>00155 <span class="preprocessor">    if ((bs)[i] != 0) {\</span>
<a name="l00156"></a>00156 <span class="preprocessor">      empty = 0; break;\</span>
<a name="l00157"></a>00157 <span class="preprocessor">    }\</span>
<a name="l00158"></a>00158 <span class="preprocessor">  }\</span>
<a name="l00159"></a>00159 <span class="preprocessor">} while (0)</span>
<a name="l00160"></a>00160 <span class="preprocessor"></span>
<a name="l00161"></a>00161 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00162"></a><a class="code" href="../../d6/dda/regparse_8c.html#a6b3d47c5e12576a16be4342107be06f7">00162</a> <a class="code" href="../../d6/dda/regparse_8c.html#a6b3d47c5e12576a16be4342107be06f7">bitset_set_range</a>(<a class="code" href="../../d6/dbe/struct_scan_env.html">ScanEnv</a> *env, <a class="code" href="../../d6/d87/regint_8h.html#adb2b463784f4cfa2f5504eb0ed9ee70a">BitSetRef</a> bs, <span class="keywordtype">int</span> from, <span class="keywordtype">int</span> to)
<a name="l00163"></a>00163 {
<a name="l00164"></a>00164   <span class="keywordtype">int</span> i;
<a name="l00165"></a>00165   <span class="keywordflow">for</span> (i = from; i &lt;= to &amp;&amp; i &lt; <a class="code" href="../../d6/d87/regint_8h.html#a8bdc62bcdfffb01985810f7aa61d5999">SINGLE_BYTE_SIZE</a>; i++) {
<a name="l00166"></a>00166     <a class="code" href="../../d6/dda/regparse_8c.html#acafa6a8e6b897efa2f65abaf8790a220">BITSET_SET_BIT_CHKDUP</a>(bs, i);
<a name="l00167"></a>00167   }
<a name="l00168"></a>00168 }
<a name="l00169"></a>00169 
<a name="l00170"></a>00170 <span class="preprocessor">#if 0</span>
<a name="l00171"></a>00171 <span class="preprocessor"></span><span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00172"></a>00172 bitset_set_all(<a class="code" href="../../d6/d87/regint_8h.html#adb2b463784f4cfa2f5504eb0ed9ee70a">BitSetRef</a> bs)
<a name="l00173"></a>00173 {
<a name="l00174"></a>00174   <span class="keywordtype">int</span> i;
<a name="l00175"></a>00175   <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="../../d6/d87/regint_8h.html#a89f6695a59a3a2db45421825d3e03ecd">BITSET_SIZE</a>; i++) { bs[i] = ~((<a class="code" href="../../d6/d87/regint_8h.html#a447bc5a76146a21ea07921e49eed7e82">Bits</a> )0); }
<a name="l00176"></a>00176 }
<a name="l00177"></a>00177 <span class="preprocessor">#endif</span>
<a name="l00178"></a>00178 <span class="preprocessor"></span>
<a name="l00179"></a>00179 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00180"></a><a class="code" href="../../d6/dda/regparse_8c.html#a8d37acb2da0c1b9a62bd817b2cc36818">00180</a> <a class="code" href="../../d6/dda/regparse_8c.html#a8d37acb2da0c1b9a62bd817b2cc36818">bitset_invert</a>(<a class="code" href="../../d6/d87/regint_8h.html#adb2b463784f4cfa2f5504eb0ed9ee70a">BitSetRef</a> bs)
<a name="l00181"></a>00181 {
<a name="l00182"></a>00182   <span class="keywordtype">int</span> i;
<a name="l00183"></a>00183   <span class="keywordflow">for</span> (i = 0; i &lt; (int )<a class="code" href="../../d6/d87/regint_8h.html#a89f6695a59a3a2db45421825d3e03ecd">BITSET_SIZE</a>; i++) { bs[i] = ~(bs[i]); }
<a name="l00184"></a>00184 }
<a name="l00185"></a>00185 
<a name="l00186"></a>00186 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00187"></a><a class="code" href="../../d6/dda/regparse_8c.html#a0b41c67edff811e8e24db2f78def34dd">00187</a> <a class="code" href="../../d6/dda/regparse_8c.html#a0b41c67edff811e8e24db2f78def34dd">bitset_invert_to</a>(<a class="code" href="../../d6/d87/regint_8h.html#adb2b463784f4cfa2f5504eb0ed9ee70a">BitSetRef</a> from, <a class="code" href="../../d6/d87/regint_8h.html#adb2b463784f4cfa2f5504eb0ed9ee70a">BitSetRef</a> to)
<a name="l00188"></a>00188 {
<a name="l00189"></a>00189   <span class="keywordtype">int</span> i;
<a name="l00190"></a>00190   <span class="keywordflow">for</span> (i = 0; i &lt; (int )<a class="code" href="../../d6/d87/regint_8h.html#a89f6695a59a3a2db45421825d3e03ecd">BITSET_SIZE</a>; i++) { to[i] = ~(from[i]); }
<a name="l00191"></a>00191 }
<a name="l00192"></a>00192 
<a name="l00193"></a>00193 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00194"></a><a class="code" href="../../d6/dda/regparse_8c.html#ad8273b2084e2d2a864d61a63c1cd0717">00194</a> <a class="code" href="../../d6/dda/regparse_8c.html#ad8273b2084e2d2a864d61a63c1cd0717">bitset_and</a>(<a class="code" href="../../d6/d87/regint_8h.html#adb2b463784f4cfa2f5504eb0ed9ee70a">BitSetRef</a> dest, <a class="code" href="../../d6/d87/regint_8h.html#adb2b463784f4cfa2f5504eb0ed9ee70a">BitSetRef</a> bs)
<a name="l00195"></a>00195 {
<a name="l00196"></a>00196   <span class="keywordtype">int</span> i;
<a name="l00197"></a>00197   <span class="keywordflow">for</span> (i = 0; i &lt; (int )<a class="code" href="../../d6/d87/regint_8h.html#a89f6695a59a3a2db45421825d3e03ecd">BITSET_SIZE</a>; i++) { dest[i] &amp;= bs[i]; }
<a name="l00198"></a>00198 }
<a name="l00199"></a>00199 
<a name="l00200"></a>00200 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00201"></a><a class="code" href="../../d6/dda/regparse_8c.html#a3cf872fa935e0920dcd727bce187e469">00201</a> <a class="code" href="../../d6/dda/regparse_8c.html#a3cf872fa935e0920dcd727bce187e469">bitset_or</a>(<a class="code" href="../../d6/d87/regint_8h.html#adb2b463784f4cfa2f5504eb0ed9ee70a">BitSetRef</a> dest, <a class="code" href="../../d6/d87/regint_8h.html#adb2b463784f4cfa2f5504eb0ed9ee70a">BitSetRef</a> bs)
<a name="l00202"></a>00202 {
<a name="l00203"></a>00203   <span class="keywordtype">int</span> i;
<a name="l00204"></a>00204   <span class="keywordflow">for</span> (i = 0; i &lt; (int )<a class="code" href="../../d6/d87/regint_8h.html#a89f6695a59a3a2db45421825d3e03ecd">BITSET_SIZE</a>; i++) { dest[i] |= bs[i]; }
<a name="l00205"></a>00205 }
<a name="l00206"></a>00206 
<a name="l00207"></a>00207 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00208"></a><a class="code" href="../../d6/dda/regparse_8c.html#a3fd4d479afe1fbd2aac0924f70b87160">00208</a> <a class="code" href="../../d6/dda/regparse_8c.html#a3fd4d479afe1fbd2aac0924f70b87160">bitset_copy</a>(<a class="code" href="../../d6/d87/regint_8h.html#adb2b463784f4cfa2f5504eb0ed9ee70a">BitSetRef</a> dest, <a class="code" href="../../d6/d87/regint_8h.html#adb2b463784f4cfa2f5504eb0ed9ee70a">BitSetRef</a> bs)
<a name="l00209"></a>00209 {
<a name="l00210"></a>00210   <span class="keywordtype">int</span> i;
<a name="l00211"></a>00211   <span class="keywordflow">for</span> (i = 0; i &lt; (int )<a class="code" href="../../d6/d87/regint_8h.html#a89f6695a59a3a2db45421825d3e03ecd">BITSET_SIZE</a>; i++) { dest[i] = bs[i]; }
<a name="l00212"></a>00212 }
<a name="l00213"></a>00213 
<a name="l00214"></a>00214 <span class="keyword">extern</span> <span class="keywordtype">int</span>
<a name="l00215"></a><a class="code" href="../../d6/dda/regparse_8c.html#a138838c9d16547c9dde877effa669a35">00215</a> <a class="code" href="../../d6/dda/regparse_8c.html#a138838c9d16547c9dde877effa669a35">onig_strncmp</a>(<span class="keyword">const</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>* s1, <span class="keyword">const</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>* s2, <span class="keywordtype">int</span> n)
<a name="l00216"></a>00216 {
<a name="l00217"></a>00217   <span class="keywordtype">int</span> x;
<a name="l00218"></a>00218 
<a name="l00219"></a>00219   <span class="keywordflow">while</span> (n-- &gt; 0) {
<a name="l00220"></a>00220     x = *s2++ - *s1++;
<a name="l00221"></a>00221     <span class="keywordflow">if</span> (x) <span class="keywordflow">return</span> x;
<a name="l00222"></a>00222   }
<a name="l00223"></a>00223   <span class="keywordflow">return</span> 0;
<a name="l00224"></a>00224 }
<a name="l00225"></a>00225 
<a name="l00226"></a>00226 <span class="keyword">extern</span> <span class="keywordtype">void</span>
<a name="l00227"></a><a class="code" href="../../d6/dda/regparse_8c.html#ae1ec1f619a502e243e88146945e3e911">00227</a> <a class="code" href="../../d6/dda/regparse_8c.html#ae1ec1f619a502e243e88146945e3e911">onig_strcpy</a>(<a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>* dest, <span class="keyword">const</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>* src, <span class="keyword">const</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>* end)
<a name="l00228"></a>00228 {
<a name="l00229"></a>00229   ptrdiff_t <a class="code" href="../../d3/d15/name2ctype_8h.html#aed1cc4dca5d94cb452f79691f54f7423">len</a> = end - src;
<a name="l00230"></a>00230   <span class="keywordflow">if</span> (len &gt; 0) {
<a name="l00231"></a>00231     <a class="code" href="../../d6/d87/regint_8h.html#ad9f94f6a1ee2c69b34d8034684b31518">xmemcpy</a>(dest, src, len);
<a name="l00232"></a>00232     dest[len] = (<a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a> )0;
<a name="l00233"></a>00233   }
<a name="l00234"></a>00234 }
<a name="l00235"></a>00235 
<a name="l00236"></a>00236 <span class="preprocessor">#ifdef USE_NAMED_GROUP</span>
<a name="l00237"></a>00237 <span class="preprocessor"></span><span class="keyword">static</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>*
<a name="l00238"></a><a class="code" href="../../d6/dda/regparse_8c.html#a96969bed3141a7f705526030ef11d7b1">00238</a> <a class="code" href="../../d6/dda/regparse_8c.html#a96969bed3141a7f705526030ef11d7b1">strdup_with_null</a>(<a class="code" href="../../d1/d7b/struct_onig_encoding_type_s_t.html">OnigEncoding</a> enc, <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>* s, <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>* end)
<a name="l00239"></a>00239 {
<a name="l00240"></a>00240   ptrdiff_t slen;
<a name="l00241"></a>00241   <span class="keywordtype">int</span> term_len, i;
<a name="l00242"></a>00242   <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a> *r;
<a name="l00243"></a>00243 
<a name="l00244"></a>00244   slen = end - s;
<a name="l00245"></a>00245   term_len = <a class="code" href="../../d8/db3/oniguruma_8h.html#a9d0d6012e6b7de2cf851d274bb9b9c9c">ONIGENC_MBC_MINLEN</a>(enc);
<a name="l00246"></a>00246 
<a name="l00247"></a>00247   r = (<a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>* )<a class="code" href="../../d8/db0/defines_8h.html#a6af5faec3f9662b20ffc9903f923dec0">xmalloc</a>(slen + term_len);
<a name="l00248"></a>00248   <a class="code" href="../../d6/d87/regint_8h.html#a44eb2d3a10149e1d94651052bcdcb2bb">CHECK_NULL_RETURN</a>(r);
<a name="l00249"></a>00249   <a class="code" href="../../d6/d87/regint_8h.html#ad9f94f6a1ee2c69b34d8034684b31518">xmemcpy</a>(r, s, slen);
<a name="l00250"></a>00250 
<a name="l00251"></a>00251   <span class="keywordflow">for</span> (i = 0; i &lt; term_len; i++)
<a name="l00252"></a>00252     r[slen + i] = (<a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a> )0;
<a name="l00253"></a>00253 
<a name="l00254"></a>00254   <span class="keywordflow">return</span> r;
<a name="l00255"></a>00255 }
<a name="l00256"></a>00256 <span class="preprocessor">#endif</span>
<a name="l00257"></a>00257 <span class="preprocessor"></span>
<a name="l00258"></a>00258 <span class="comment">/* scan pattern methods */</span>
<a name="l00259"></a><a class="code" href="../../d6/dda/regparse_8c.html#a5fd4f10d51a66525b7577b62a4464dae">00259</a> <span class="preprocessor">#define PEND_VALUE   0</span>
<a name="l00260"></a>00260 <span class="preprocessor"></span>
<a name="l00261"></a><a class="code" href="../../d6/dda/regparse_8c.html#a44975cffe07e4559bf5638cafb4a6b30">00261</a> <span class="preprocessor">#define PFETCH_READY  UChar* pfetch_prev</span>
<a name="l00262"></a><a class="code" href="../../d6/dda/regparse_8c.html#a43ce1d83d1961694adc2dfcbfac7d690">00262</a> <span class="preprocessor"></span><span class="preprocessor">#define PEND         (p &lt; end ?  0 : 1)</span>
<a name="l00263"></a><a class="code" href="../../d6/dda/regparse_8c.html#ad0350add3c44d502c77357f6012b1bf2">00263</a> <span class="preprocessor"></span><span class="preprocessor">#define PUNFETCH     p = pfetch_prev</span>
<a name="l00264"></a><a class="code" href="../../d6/dda/regparse_8c.html#a0545e73dc7ae14b1f62293c1feba3983">00264</a> <span class="preprocessor"></span><span class="preprocessor">#define PINC       do { \</span>
<a name="l00265"></a>00265 <span class="preprocessor">  pfetch_prev = p; \</span>
<a name="l00266"></a>00266 <span class="preprocessor">  p += enclen(enc, p, end); \</span>
<a name="l00267"></a>00267 <span class="preprocessor">} while (0)</span>
<a name="l00268"></a><a class="code" href="../../d6/dda/regparse_8c.html#a8a8898c873b81a88454a968371696cab">00268</a> <span class="preprocessor"></span><span class="preprocessor">#define PFETCH(c)  do { \</span>
<a name="l00269"></a>00269 <span class="preprocessor">  c = ((enc-&gt;max_enc_len == 1) ? *p : ONIGENC_MBC_TO_CODE(enc, p, end)); \</span>
<a name="l00270"></a>00270 <span class="preprocessor">  pfetch_prev = p; \</span>
<a name="l00271"></a>00271 <span class="preprocessor">  p += enclen(enc, p, end); \</span>
<a name="l00272"></a>00272 <span class="preprocessor">} while (0)</span>
<a name="l00273"></a>00273 <span class="preprocessor"></span>
<a name="l00274"></a><a class="code" href="../../d6/dda/regparse_8c.html#a337ed696ab55651d216a34abbafd4cd3">00274</a> <span class="preprocessor">#define PPEEK        (p &lt; end ? ONIGENC_MBC_TO_CODE(enc, p, end) : PEND_VALUE)</span>
<a name="l00275"></a><a class="code" href="../../d6/dda/regparse_8c.html#a4ed53b7baf65c82f4ba37027979ed82d">00275</a> <span class="preprocessor"></span><span class="preprocessor">#define PPEEK_IS(c)  (PPEEK == (OnigCodePoint )c)</span>
<a name="l00276"></a>00276 <span class="preprocessor"></span>
<a name="l00277"></a>00277 <span class="keyword">static</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>*
<a name="l00278"></a><a class="code" href="../../d6/dda/regparse_8c.html#ad4ed5ad9e6d2c1730761241e8ee18a71">00278</a> <a class="code" href="../../d6/dda/regparse_8c.html#ad4ed5ad9e6d2c1730761241e8ee18a71">strcat_capa</a>(<a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>* dest, <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>* dest_end, <span class="keyword">const</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>* src, <span class="keyword">const</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>* src_end,
<a name="l00279"></a>00279               <span class="keywordtype">size_t</span> capa)
<a name="l00280"></a>00280 {
<a name="l00281"></a>00281   <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>* r;
<a name="l00282"></a>00282 
<a name="l00283"></a>00283   <span class="keywordflow">if</span> (dest)
<a name="l00284"></a>00284     r = (<a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>* )<a class="code" href="../../d8/db0/defines_8h.html#a40740062faf2d95d4935112447c464ef">xrealloc</a>(dest, capa + 1);
<a name="l00285"></a>00285   <span class="keywordflow">else</span>
<a name="l00286"></a>00286     r = (<a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>* )<a class="code" href="../../d8/db0/defines_8h.html#a6af5faec3f9662b20ffc9903f923dec0">xmalloc</a>(capa + 1);
<a name="l00287"></a>00287 
<a name="l00288"></a>00288   <a class="code" href="../../d6/d87/regint_8h.html#a44eb2d3a10149e1d94651052bcdcb2bb">CHECK_NULL_RETURN</a>(r);
<a name="l00289"></a>00289   <a class="code" href="../../d6/dda/regparse_8c.html#ae1ec1f619a502e243e88146945e3e911">onig_strcpy</a>(r + (dest_end - dest), src, src_end);
<a name="l00290"></a>00290   <span class="keywordflow">return</span> r;
<a name="l00291"></a>00291 }
<a name="l00292"></a>00292 
<a name="l00293"></a>00293 <span class="comment">/* dest on static area */</span>
<a name="l00294"></a>00294 <span class="keyword">static</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>*
<a name="l00295"></a><a class="code" href="../../d6/dda/regparse_8c.html#a620fa0dc6df49854ab111825fb94cd61">00295</a> <a class="code" href="../../d6/dda/regparse_8c.html#a620fa0dc6df49854ab111825fb94cd61">strcat_capa_from_static</a>(<a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>* dest, <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>* dest_end,
<a name="l00296"></a>00296                         <span class="keyword">const</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>* src, <span class="keyword">const</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>* src_end, <span class="keywordtype">size_t</span> capa)
<a name="l00297"></a>00297 {
<a name="l00298"></a>00298   <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>* r;
<a name="l00299"></a>00299 
<a name="l00300"></a>00300   r = (<a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>* )<a class="code" href="../../d8/db0/defines_8h.html#a6af5faec3f9662b20ffc9903f923dec0">xmalloc</a>(capa + 1);
<a name="l00301"></a>00301   <a class="code" href="../../d6/d87/regint_8h.html#a44eb2d3a10149e1d94651052bcdcb2bb">CHECK_NULL_RETURN</a>(r);
<a name="l00302"></a>00302   <a class="code" href="../../d6/dda/regparse_8c.html#ae1ec1f619a502e243e88146945e3e911">onig_strcpy</a>(r, dest, dest_end);
<a name="l00303"></a>00303   <a class="code" href="../../d6/dda/regparse_8c.html#ae1ec1f619a502e243e88146945e3e911">onig_strcpy</a>(r + (dest_end - dest), src, src_end);
<a name="l00304"></a>00304   <span class="keywordflow">return</span> r;
<a name="l00305"></a>00305 }
<a name="l00306"></a>00306 
<a name="l00307"></a>00307 
<a name="l00308"></a>00308 <span class="preprocessor">#ifdef USE_ST_LIBRARY</span>
<a name="l00309"></a>00309 <span class="preprocessor"></span>
<a name="l00310"></a>00310 <span class="preprocessor">#include &quot;<a class="code" href="../../dd/d24/st_8h.html">ruby/st.h</a>&quot;</span>
<a name="l00311"></a>00311 
<a name="l00312"></a><a class="code" href="../../da/d67/structst__str__end__key.html">00312</a> <span class="keyword">typedef</span> <span class="keyword">struct </span>{
<a name="l00313"></a><a class="code" href="../../da/d67/structst__str__end__key.html#a02edec4f6d24916885ed6275285f24c6">00313</a>   <span class="keyword">const</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>* s;
<a name="l00314"></a><a class="code" href="../../da/d67/structst__str__end__key.html#ab3522719cf23943bb72cc943b0419417">00314</a>   <span class="keyword">const</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>* end;
<a name="l00315"></a>00315 } <a class="code" href="../../da/d67/structst__str__end__key.html">st_str_end_key</a>;
<a name="l00316"></a>00316 
<a name="l00317"></a>00317 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l00318"></a><a class="code" href="../../d6/dda/regparse_8c.html#a317519c5350aba96c78a0b4d70bd94a9">00318</a> <a class="code" href="../../d6/dda/regparse_8c.html#a317519c5350aba96c78a0b4d70bd94a9">str_end_cmp</a>(<a class="code" href="../../de/dce/syck_8h.html#a8a45dfe133c1fd041e1b902bda9e43e8">st_data_t</a> xp, <a class="code" href="../../de/dce/syck_8h.html#a8a45dfe133c1fd041e1b902bda9e43e8">st_data_t</a> yp)
<a name="l00319"></a>00319 {
<a name="l00320"></a>00320   <span class="keyword">const</span> <a class="code" href="../../da/d67/structst__str__end__key.html">st_str_end_key</a> *x, *y;
<a name="l00321"></a>00321   <span class="keyword">const</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a> *p, *q;
<a name="l00322"></a>00322   <span class="keywordtype">int</span> c;
<a name="l00323"></a>00323 
<a name="l00324"></a>00324   x = (<span class="keyword">const</span> <a class="code" href="../../da/d67/structst__str__end__key.html">st_str_end_key</a> *)xp;
<a name="l00325"></a>00325   y = (<span class="keyword">const</span> <a class="code" href="../../da/d67/structst__str__end__key.html">st_str_end_key</a> *)yp;
<a name="l00326"></a>00326   <span class="keywordflow">if</span> ((x-&gt;<a class="code" href="../../da/d67/structst__str__end__key.html#ab3522719cf23943bb72cc943b0419417">end</a> - x-&gt;<a class="code" href="../../da/d67/structst__str__end__key.html#a02edec4f6d24916885ed6275285f24c6">s</a>) != (y-&gt;<a class="code" href="../../da/d67/structst__str__end__key.html#ab3522719cf23943bb72cc943b0419417">end</a> - y-&gt;<a class="code" href="../../da/d67/structst__str__end__key.html#a02edec4f6d24916885ed6275285f24c6">s</a>))
<a name="l00327"></a>00327     <span class="keywordflow">return</span> 1;
<a name="l00328"></a>00328 
<a name="l00329"></a>00329   p = x-&gt;<a class="code" href="../../da/d67/structst__str__end__key.html#a02edec4f6d24916885ed6275285f24c6">s</a>;
<a name="l00330"></a>00330   q = y-&gt;<a class="code" href="../../da/d67/structst__str__end__key.html#a02edec4f6d24916885ed6275285f24c6">s</a>;
<a name="l00331"></a>00331   <span class="keywordflow">while</span> (p &lt; x-&gt;end) {
<a name="l00332"></a>00332     c = (int )*p - (<span class="keywordtype">int</span> )*q;
<a name="l00333"></a>00333     <span class="keywordflow">if</span> (c != 0) <span class="keywordflow">return</span> c;
<a name="l00334"></a>00334 
<a name="l00335"></a>00335     p++; q++;
<a name="l00336"></a>00336   }
<a name="l00337"></a>00337 
<a name="l00338"></a>00338   <span class="keywordflow">return</span> 0;
<a name="l00339"></a>00339 }
<a name="l00340"></a>00340 
<a name="l00341"></a>00341 <span class="keyword">static</span> <a class="code" href="../../dd/d24/st_8h.html#ac214e5cdcf0de6a2108b9643e7fc12e0">st_index_t</a>
<a name="l00342"></a><a class="code" href="../../d6/dda/regparse_8c.html#a194bfb40d4c385f3a3006d59bdf3b234">00342</a> <a class="code" href="../../d6/dda/regparse_8c.html#a194bfb40d4c385f3a3006d59bdf3b234">str_end_hash</a>(<a class="code" href="../../de/dce/syck_8h.html#a8a45dfe133c1fd041e1b902bda9e43e8">st_data_t</a> xp)
<a name="l00343"></a>00343 {
<a name="l00344"></a>00344   <span class="keyword">const</span> <a class="code" href="../../da/d67/structst__str__end__key.html">st_str_end_key</a> *x = (<span class="keyword">const</span> <a class="code" href="../../da/d67/structst__str__end__key.html">st_str_end_key</a> *)xp;
<a name="l00345"></a>00345   <span class="keyword">const</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a> *p;
<a name="l00346"></a>00346   <a class="code" href="../../dd/d24/st_8h.html#ac214e5cdcf0de6a2108b9643e7fc12e0">st_index_t</a> val = 0;
<a name="l00347"></a>00347 
<a name="l00348"></a>00348   p = x-&gt;<a class="code" href="../../da/d67/structst__str__end__key.html#a02edec4f6d24916885ed6275285f24c6">s</a>;
<a name="l00349"></a>00349   <span class="keywordflow">while</span> (p &lt; x-&gt;end) {
<a name="l00350"></a>00350     val = val * 997 + (int )*p++;
<a name="l00351"></a>00351   }
<a name="l00352"></a>00352 
<a name="l00353"></a>00353   <span class="keywordflow">return</span> val + (val &gt;&gt; 5);
<a name="l00354"></a>00354 }
<a name="l00355"></a>00355 
<a name="l00356"></a>00356 <span class="keyword">extern</span> <a class="code" href="../../d6/d87/regint_8h.html#aa662c9c4b708dbcab817a475c7fc7b7c">hash_table_type</a>*
<a name="l00357"></a><a class="code" href="../../d6/dda/regparse_8c.html#a851bd0c708c9617427503055f460e3bd">00357</a> <a class="code" href="../../d6/dda/regparse_8c.html#a851bd0c708c9617427503055f460e3bd">onig_st_init_strend_table_with_size</a>(<a class="code" href="../../dd/d24/st_8h.html#ac214e5cdcf0de6a2108b9643e7fc12e0">st_index_t</a> <a class="code" href="../../d5/db5/encoding_8c.html#a439227feff9d7f55384e8780cfc2eb82">size</a>)
<a name="l00358"></a>00358 {
<a name="l00359"></a>00359   <span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="../../d6/d34/structst__hash__type.html">st_hash_type</a> hashType = {
<a name="l00360"></a>00360     <a class="code" href="../../d6/dda/regparse_8c.html#a317519c5350aba96c78a0b4d70bd94a9">str_end_cmp</a>,
<a name="l00361"></a>00361     <a class="code" href="../../d6/dda/regparse_8c.html#a194bfb40d4c385f3a3006d59bdf3b234">str_end_hash</a>,
<a name="l00362"></a>00362   };
<a name="l00363"></a>00363 
<a name="l00364"></a>00364   <span class="keywordflow">return</span> (<a class="code" href="../../d6/d87/regint_8h.html#aa662c9c4b708dbcab817a475c7fc7b7c">hash_table_type</a>* )
<a name="l00365"></a>00365            <a class="code" href="../../d6/d87/regint_8h.html#a8efc6c47658fce57d397718a64a03ca0">onig_st_init_table_with_size</a>(&amp;hashType, size);
<a name="l00366"></a>00366 }
<a name="l00367"></a>00367 
<a name="l00368"></a>00368 <span class="keyword">extern</span> <span class="keywordtype">int</span>
<a name="l00369"></a><a class="code" href="../../d6/dda/regparse_8c.html#ae09a5cf9f1da50ac386554e3f435a77c">00369</a> <a class="code" href="../../d6/dda/regparse_8c.html#ae09a5cf9f1da50ac386554e3f435a77c">onig_st_lookup_strend</a>(<a class="code" href="../../d6/d87/regint_8h.html#aa662c9c4b708dbcab817a475c7fc7b7c">hash_table_type</a>* table, <span class="keyword">const</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>* str_key,
<a name="l00370"></a>00370                       <span class="keyword">const</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>* end_key, <a class="code" href="../../d6/d87/regint_8h.html#a0703aa286ee819f8a43df4d4f2fc2bad">hash_data_type</a> *value)
<a name="l00371"></a>00371 {
<a name="l00372"></a>00372   <a class="code" href="../../da/d67/structst__str__end__key.html">st_str_end_key</a> <a class="code" href="../../dc/de5/random_8c.html#a742229490b6759a90ece7ba82ba129d5">key</a>;
<a name="l00373"></a>00373 
<a name="l00374"></a>00374   key.<a class="code" href="../../da/d67/structst__str__end__key.html#a02edec4f6d24916885ed6275285f24c6">s</a>   = (<a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>* )str_key;
<a name="l00375"></a>00375   key.<a class="code" href="../../da/d67/structst__str__end__key.html#ab3522719cf23943bb72cc943b0419417">end</a> = (<a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>* )end_key;
<a name="l00376"></a>00376 
<a name="l00377"></a>00377   <span class="keywordflow">return</span> <a class="code" href="../../d6/d87/regint_8h.html#af5c4d169f5e1aa4b80012e1e67a76dc1">onig_st_lookup</a>(table, (<a class="code" href="../../de/dce/syck_8h.html#a8a45dfe133c1fd041e1b902bda9e43e8">st_data_t</a> )(&amp;key), value);
<a name="l00378"></a>00378 }
<a name="l00379"></a>00379 
<a name="l00380"></a>00380 <span class="keyword">extern</span> <span class="keywordtype">int</span>
<a name="l00381"></a><a class="code" href="../../d6/dda/regparse_8c.html#a422ffdbf2a9a4e9b0ed8458f84f6d2f3">00381</a> <a class="code" href="../../d6/dda/regparse_8c.html#a422ffdbf2a9a4e9b0ed8458f84f6d2f3">onig_st_insert_strend</a>(<a class="code" href="../../d6/d87/regint_8h.html#aa662c9c4b708dbcab817a475c7fc7b7c">hash_table_type</a>* table, <span class="keyword">const</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>* str_key,
<a name="l00382"></a>00382                       <span class="keyword">const</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>* end_key, <a class="code" href="../../d6/d87/regint_8h.html#a0703aa286ee819f8a43df4d4f2fc2bad">hash_data_type</a> value)
<a name="l00383"></a>00383 {
<a name="l00384"></a>00384   <a class="code" href="../../da/d67/structst__str__end__key.html">st_str_end_key</a>* <a class="code" href="../../dc/de5/random_8c.html#a742229490b6759a90ece7ba82ba129d5">key</a>;
<a name="l00385"></a>00385   <span class="keywordtype">int</span> <a class="code" href="../../d8/d90/nkf_8c.html#a5ea5ac7abf5cce39283e422add1067d5">result</a>;
<a name="l00386"></a>00386 
<a name="l00387"></a>00387   key = (<a class="code" href="../../da/d67/structst__str__end__key.html">st_str_end_key</a>* )<a class="code" href="../../d8/db0/defines_8h.html#a6af5faec3f9662b20ffc9903f923dec0">xmalloc</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../da/d67/structst__str__end__key.html">st_str_end_key</a>));
<a name="l00388"></a>00388   key-&gt;<a class="code" href="../../da/d67/structst__str__end__key.html#a02edec4f6d24916885ed6275285f24c6">s</a>   = (<a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>* )str_key;
<a name="l00389"></a>00389   key-&gt;<a class="code" href="../../da/d67/structst__str__end__key.html#ab3522719cf23943bb72cc943b0419417">end</a> = (<a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>* )end_key;
<a name="l00390"></a>00390   result = <a class="code" href="../../d6/d87/regint_8h.html#ab1e7c50b600bc4afc39b00d31f3ba14c">onig_st_insert</a>(table, (<a class="code" href="../../de/dce/syck_8h.html#a8a45dfe133c1fd041e1b902bda9e43e8">st_data_t</a> )key, value);
<a name="l00391"></a>00391   <span class="keywordflow">if</span> (result) {
<a name="l00392"></a>00392     <a class="code" href="../../d8/db0/defines_8h.html#a2c3897f7c46ca54a2e0dd7b24a40c7cb">xfree</a>(key);
<a name="l00393"></a>00393   }
<a name="l00394"></a>00394   <span class="keywordflow">return</span> result;
<a name="l00395"></a>00395 }
<a name="l00396"></a>00396 
<a name="l00397"></a>00397 <span class="preprocessor">#endif </span><span class="comment">/* USE_ST_LIBRARY */</span>
<a name="l00398"></a>00398 
<a name="l00399"></a>00399 
<a name="l00400"></a>00400 <span class="preprocessor">#ifdef USE_NAMED_GROUP</span>
<a name="l00401"></a>00401 <span class="preprocessor"></span>
<a name="l00402"></a><a class="code" href="../../d6/dda/regparse_8c.html#a73058c78d5bed2705970b46662c39cf6">00402</a> <span class="preprocessor">#define INIT_NAME_BACKREFS_ALLOC_NUM   8</span>
<a name="l00403"></a>00403 <span class="preprocessor"></span>
<a name="l00404"></a><a class="code" href="../../d2/d4a/struct_name_entry.html">00404</a> <span class="keyword">typedef</span> <span class="keyword">struct </span>{
<a name="l00405"></a><a class="code" href="../../d2/d4a/struct_name_entry.html#abad75d1d35d063d9acad5968b161b666">00405</a>   <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>* <a class="code" href="../../d6/da0/nkf-utf8_2nkf_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>;
<a name="l00406"></a><a class="code" href="../../d2/d4a/struct_name_entry.html#a8b2741cf75163f9364ecaa1314868b5d">00406</a>   <span class="keywordtype">size_t</span> name_len;   <span class="comment">/* byte length */</span>
<a name="l00407"></a><a class="code" href="../../d2/d4a/struct_name_entry.html#a9e00de235c01b34a5244f1c572968da5">00407</a>   <span class="keywordtype">int</span>    back_num;   <span class="comment">/* number of backrefs */</span>
<a name="l00408"></a><a class="code" href="../../d2/d4a/struct_name_entry.html#a051ae235a19375475955c600cf0cb197">00408</a>   <span class="keywordtype">int</span>    back_alloc;
<a name="l00409"></a><a class="code" href="../../d2/d4a/struct_name_entry.html#a8f22012701b3ce478b7b5a0caf644458">00409</a>   <span class="keywordtype">int</span>    back_ref1;
<a name="l00410"></a><a class="code" href="../../d2/d4a/struct_name_entry.html#a5998d91dd61ffe28bbc7a97e83d527a0">00410</a>   <span class="keywordtype">int</span>*   back_refs;
<a name="l00411"></a>00411 } <a class="code" href="../../d2/d4a/struct_name_entry.html">NameEntry</a>;
<a name="l00412"></a>00412 
<a name="l00413"></a>00413 <span class="preprocessor">#ifdef USE_ST_LIBRARY</span>
<a name="l00414"></a>00414 <span class="preprocessor"></span>
<a name="l00415"></a><a class="code" href="../../d6/dda/regparse_8c.html#a04bcf57f4a5930039aaf778ac238dc43">00415</a> <span class="keyword">typedef</span> <a class="code" href="../../d0/ddd/structst__table.html">st_table</a>  <a class="code" href="../../d0/ddd/structst__table.html">NameTable</a>;
<a name="l00416"></a><a class="code" href="../../d6/dda/regparse_8c.html#ad8f4a4a6b7c7042e94ab0adc6eb0661a">00416</a> <span class="keyword">typedef</span> <a class="code" href="../../de/dce/syck_8h.html#a8a45dfe133c1fd041e1b902bda9e43e8">st_data_t</a> <a class="code" href="../../d6/dda/regparse_8c.html#ad8f4a4a6b7c7042e94ab0adc6eb0661a">HashDataType</a>;   <span class="comment">/* 1.6 st.h doesn&apos;t define st_data_t type */</span>
<a name="l00417"></a>00417 
<a name="l00418"></a><a class="code" href="../../d6/dda/regparse_8c.html#a183b319c698b9a52081ad524d8422db2">00418</a> <span class="preprocessor">#define NAMEBUF_SIZE    24</span>
<a name="l00419"></a><a class="code" href="../../d6/dda/regparse_8c.html#aa5544303b4c0fecd42bea986cee96848">00419</a> <span class="preprocessor"></span><span class="preprocessor">#define NAMEBUF_SIZE_1  25</span>
<a name="l00420"></a>00420 <span class="preprocessor"></span>
<a name="l00421"></a>00421 <span class="preprocessor">#ifdef ONIG_DEBUG</span>
<a name="l00422"></a>00422 <span class="preprocessor"></span><span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l00423"></a>00423 i_print_name_entry(<a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>* <a class="code" href="../../dc/de5/random_8c.html#a742229490b6759a90ece7ba82ba129d5">key</a>, <a class="code" href="../../d2/d4a/struct_name_entry.html">NameEntry</a>* e, <span class="keywordtype">void</span>* arg)
<a name="l00424"></a>00424 {
<a name="l00425"></a>00425   <span class="keywordtype">int</span> i;
<a name="l00426"></a>00426   <a class="code" href="../../db/ddf/struct____s_f_i_l_e.html">FILE</a>* fp = (<a class="code" href="../../db/ddf/struct____s_f_i_l_e.html">FILE</a>* )arg;
<a name="l00427"></a>00427 
<a name="l00428"></a>00428   fprintf(fp, <span class="stringliteral">&quot;%s: &quot;</span>, e-&gt;<a class="code" href="../../d2/d4a/struct_name_entry.html#abad75d1d35d063d9acad5968b161b666">name</a>);
<a name="l00429"></a>00429   <span class="keywordflow">if</span> (e-&gt;<a class="code" href="../../d2/d4a/struct_name_entry.html#a9e00de235c01b34a5244f1c572968da5">back_num</a> == 0)
<a name="l00430"></a>00430     fputs(<span class="stringliteral">&quot;-&quot;</span>, fp);
<a name="l00431"></a>00431   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (e-&gt;<a class="code" href="../../d2/d4a/struct_name_entry.html#a9e00de235c01b34a5244f1c572968da5">back_num</a> == 1)
<a name="l00432"></a>00432     fprintf(fp, <span class="stringliteral">&quot;%d&quot;</span>, e-&gt;<a class="code" href="../../d2/d4a/struct_name_entry.html#a8f22012701b3ce478b7b5a0caf644458">back_ref1</a>);
<a name="l00433"></a>00433   <span class="keywordflow">else</span> {
<a name="l00434"></a>00434     <span class="keywordflow">for</span> (i = 0; i &lt; e-&gt;<a class="code" href="../../d2/d4a/struct_name_entry.html#a9e00de235c01b34a5244f1c572968da5">back_num</a>; i++) {
<a name="l00435"></a>00435       <span class="keywordflow">if</span> (i &gt; 0) fprintf(fp, <span class="stringliteral">&quot;, &quot;</span>);
<a name="l00436"></a>00436       fprintf(fp, <span class="stringliteral">&quot;%d&quot;</span>, e-&gt;<a class="code" href="../../d2/d4a/struct_name_entry.html#a5998d91dd61ffe28bbc7a97e83d527a0">back_refs</a>[i]);
<a name="l00437"></a>00437     }
<a name="l00438"></a>00438   }
<a name="l00439"></a>00439   fputs(<span class="stringliteral">&quot;\n&quot;</span>, fp);
<a name="l00440"></a>00440   <span class="keywordflow">return</span> <a class="code" href="../../dd/d24/st_8h.html#a0c6a172fd99de7928916e65034ed8b1fac99fc55c7f355bf9071739a4bc2ea139">ST_CONTINUE</a>;
<a name="l00441"></a>00441 }
<a name="l00442"></a>00442 
<a name="l00443"></a>00443 <span class="keyword">extern</span> <span class="keywordtype">int</span>
<a name="l00444"></a>00444 onig_print_names(<a class="code" href="../../db/ddf/struct____s_f_i_l_e.html">FILE</a>* fp, <a class="code" href="../../db/d0e/structre__pattern__buffer.html">regex_t</a>* reg)
<a name="l00445"></a>00445 {
<a name="l00446"></a>00446   NameTable* t = (NameTable* )reg-&gt;<a class="code" href="../../db/d0e/structre__pattern__buffer.html#a23168e45fcc2c959b7aaed0b6a2e3f7a">name_table</a>;
<a name="l00447"></a>00447 
<a name="l00448"></a>00448   <a class="code" href="../../d7/dc0/parse_8y.html#a2ac1143ac343c79cbfa448e30d74fa1c">if</a> (<a class="code" href="../../d6/d87/regint_8h.html#a4bc25fbd4749a2c130d1ae7f15ba140c">IS_NOT_NULL</a>(t)) {
<a name="l00449"></a>00449     fprintf(fp, <span class="stringliteral">&quot;name table\n&quot;</span>);
<a name="l00450"></a>00450     <a class="code" href="../../d6/d87/regint_8h.html#a19807bc745107ca04c237f9d9d4563ed">onig_st_foreach</a>(t, i_print_name_entry, (HashDataType )fp);
<a name="l00451"></a>00451     fputs(<span class="stringliteral">&quot;\n&quot;</span>, fp);
<a name="l00452"></a>00452   }
<a name="l00453"></a>00453   <span class="keywordflow">return</span> 0;
<a name="l00454"></a>00454 }
<a name="l00455"></a>00455 <span class="preprocessor">#endif </span><span class="comment">/* ONIG_DEBUG */</span>
<a name="l00456"></a>00456 
<a name="l00457"></a>00457 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l00458"></a><a class="code" href="../../d6/dda/regparse_8c.html#a3275ce258eb690cc5d9db7c047925cb7">00458</a> <a class="code" href="../../d6/dda/regparse_8c.html#a3275ce258eb690cc5d9db7c047925cb7">i_free_name_entry</a>(<a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>* <a class="code" href="../../dc/de5/random_8c.html#a742229490b6759a90ece7ba82ba129d5">key</a>, <a class="code" href="../../d2/d4a/struct_name_entry.html">NameEntry</a>* e, <span class="keywordtype">void</span>* arg ARG_UNUSED)
<a name="l00459"></a>00459 {
<a name="l00460"></a>00460   <a class="code" href="../../d8/db0/defines_8h.html#a2c3897f7c46ca54a2e0dd7b24a40c7cb">xfree</a>(e-&gt;<a class="code" href="../../d2/d4a/struct_name_entry.html#abad75d1d35d063d9acad5968b161b666">name</a>);
<a name="l00461"></a>00461   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d87/regint_8h.html#a4bc25fbd4749a2c130d1ae7f15ba140c">IS_NOT_NULL</a>(e-&gt;<a class="code" href="../../d2/d4a/struct_name_entry.html#a5998d91dd61ffe28bbc7a97e83d527a0">back_refs</a>)) <a class="code" href="../../d8/db0/defines_8h.html#a2c3897f7c46ca54a2e0dd7b24a40c7cb">xfree</a>(e-&gt;<a class="code" href="../../d2/d4a/struct_name_entry.html#a5998d91dd61ffe28bbc7a97e83d527a0">back_refs</a>);
<a name="l00462"></a>00462   <a class="code" href="../../d8/db0/defines_8h.html#a2c3897f7c46ca54a2e0dd7b24a40c7cb">xfree</a>(key);
<a name="l00463"></a>00463   <a class="code" href="../../d8/db0/defines_8h.html#a2c3897f7c46ca54a2e0dd7b24a40c7cb">xfree</a>(e);
<a name="l00464"></a>00464   <span class="keywordflow">return</span> <a class="code" href="../../dd/d24/st_8h.html#a0c6a172fd99de7928916e65034ed8b1fa64ab176f8e8b9719bcd9b5297ccda9c7">ST_DELETE</a>;
<a name="l00465"></a>00465 }
<a name="l00466"></a>00466 
<a name="l00467"></a>00467 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l00468"></a><a class="code" href="../../d6/dda/regparse_8c.html#a4fe174e6f8a47f1532a18bb4f93f622e">00468</a> <a class="code" href="../../d6/dda/regparse_8c.html#a4fe174e6f8a47f1532a18bb4f93f622e">names_clear</a>(<a class="code" href="../../db/d0e/structre__pattern__buffer.html">regex_t</a>* reg)
<a name="l00469"></a>00469 {
<a name="l00470"></a>00470   NameTable* t = (NameTable* )reg-&gt;<a class="code" href="../../db/d0e/structre__pattern__buffer.html#a23168e45fcc2c959b7aaed0b6a2e3f7a">name_table</a>;
<a name="l00471"></a>00471 
<a name="l00472"></a>00472   <a class="code" href="../../d7/dc0/parse_8y.html#a2ac1143ac343c79cbfa448e30d74fa1c">if</a> (<a class="code" href="../../d6/d87/regint_8h.html#a4bc25fbd4749a2c130d1ae7f15ba140c">IS_NOT_NULL</a>(t)) {
<a name="l00473"></a>00473     <a class="code" href="../../d6/d87/regint_8h.html#a19807bc745107ca04c237f9d9d4563ed">onig_st_foreach</a>(t, <a class="code" href="../../d6/dda/regparse_8c.html#a3275ce258eb690cc5d9db7c047925cb7">i_free_name_entry</a>, 0);
<a name="l00474"></a>00474   }
<a name="l00475"></a>00475   <span class="keywordflow">return</span> 0;
<a name="l00476"></a>00476 }
<a name="l00477"></a>00477 
<a name="l00478"></a>00478 <span class="keyword">extern</span> <span class="keywordtype">int</span>
<a name="l00479"></a><a class="code" href="../../d6/dda/regparse_8c.html#acb18d5fa84a45870b5a9739deff10659">00479</a> <a class="code" href="../../d6/dda/regparse_8c.html#acb18d5fa84a45870b5a9739deff10659">onig_names_free</a>(<a class="code" href="../../db/d0e/structre__pattern__buffer.html">regex_t</a>* reg)
<a name="l00480"></a>00480 {
<a name="l00481"></a>00481   <span class="keywordtype">int</span> r;
<a name="l00482"></a>00482   NameTable* t;
<a name="l00483"></a>00483 
<a name="l00484"></a>00484   r = <a class="code" href="../../d6/dda/regparse_8c.html#a4fe174e6f8a47f1532a18bb4f93f622e">names_clear</a>(reg);
<a name="l00485"></a>00485   <span class="keywordflow">if</span> (r) <span class="keywordflow">return</span> r;
<a name="l00486"></a>00486 
<a name="l00487"></a>00487   t = (NameTable* )reg-&gt;<a class="code" href="../../db/d0e/structre__pattern__buffer.html#a23168e45fcc2c959b7aaed0b6a2e3f7a">name_table</a>;
<a name="l00488"></a>00488   <a class="code" href="../../d7/dc0/parse_8y.html#a2ac1143ac343c79cbfa448e30d74fa1c">if</a> (<a class="code" href="../../d6/d87/regint_8h.html#a4bc25fbd4749a2c130d1ae7f15ba140c">IS_NOT_NULL</a>(t)) <a class="code" href="../../d6/d87/regint_8h.html#a8f9bdf7a7a9520094f4a60bc9ba2d90d">onig_st_free_table</a>(t);
<a name="l00489"></a>00489   reg-&gt;<a class="code" href="../../db/d0e/structre__pattern__buffer.html#a23168e45fcc2c959b7aaed0b6a2e3f7a">name_table</a> = (<span class="keywordtype">void</span>* )<a class="code" href="../../d3/d09/ripper_8y.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00490"></a>00490   <span class="keywordflow">return</span> 0;
<a name="l00491"></a>00491 }
<a name="l00492"></a>00492 
<a name="l00493"></a>00493 <span class="keyword">static</span> <a class="code" href="../../d2/d4a/struct_name_entry.html">NameEntry</a>*
<a name="l00494"></a><a class="code" href="../../d6/dda/regparse_8c.html#aeea88c6a5bae0d3d0aaee1ecc9368499">00494</a> <a class="code" href="../../d6/dda/regparse_8c.html#aeea88c6a5bae0d3d0aaee1ecc9368499">name_find</a>(<a class="code" href="../../db/d0e/structre__pattern__buffer.html">regex_t</a>* reg, <span class="keyword">const</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>* <a class="code" href="../../d6/da0/nkf-utf8_2nkf_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="keyword">const</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>* name_end)
<a name="l00495"></a>00495 {
<a name="l00496"></a>00496   <a class="code" href="../../d2/d4a/struct_name_entry.html">NameEntry</a>* e;
<a name="l00497"></a>00497   NameTable* t = (NameTable* )reg-&gt;<a class="code" href="../../db/d0e/structre__pattern__buffer.html#a23168e45fcc2c959b7aaed0b6a2e3f7a">name_table</a>;
<a name="l00498"></a>00498 
<a name="l00499"></a>00499   e = (<a class="code" href="../../d2/d4a/struct_name_entry.html">NameEntry</a>* )<a class="code" href="../../d3/d09/ripper_8y.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00500"></a>00500   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d87/regint_8h.html#a4bc25fbd4749a2c130d1ae7f15ba140c">IS_NOT_NULL</a>(t)) {
<a name="l00501"></a>00501     <a class="code" href="../../d6/dda/regparse_8c.html#ae09a5cf9f1da50ac386554e3f435a77c">onig_st_lookup_strend</a>(t, name, name_end, (HashDataType* )((<span class="keywordtype">void</span>* )(&amp;e)));
<a name="l00502"></a>00502   }
<a name="l00503"></a>00503   <span class="keywordflow">return</span> e;
<a name="l00504"></a>00504 }
<a name="l00505"></a>00505 
<a name="l00506"></a><a class="code" href="../../d6/d2a/struct_i_names_arg.html">00506</a> <span class="keyword">typedef</span> <span class="keyword">struct </span>{
<a name="l00507"></a>00507   int (*<a class="code" href="../../dc/dd1/ossl__ssl_8c.html#a131c09b7f9c9a0b52e6f79f651cfd574">func</a>)(<span class="keyword">const</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>*, <span class="keyword">const</span> UChar*,int,<span class="keywordtype">int</span>*,<a class="code" href="../../db/d0e/structre__pattern__buffer.html">regex_t</a>*,<span class="keywordtype">void</span>*);
<a name="l00508"></a><a class="code" href="../../d6/d2a/struct_i_names_arg.html#a634f3511efaa2cbf18e0083a3f4ce4fa">00508</a>   regex_t* reg;
<a name="l00509"></a><a class="code" href="../../d6/d2a/struct_i_names_arg.html#a6d16a5c1d5af9f07dc41fc3ae65d75e2">00509</a>   <span class="keywordtype">void</span>* arg;
<a name="l00510"></a><a class="code" href="../../d6/d2a/struct_i_names_arg.html#a088e4eee203a0ba2906c67368455bb57">00510</a>   <span class="keywordtype">int</span> ret;
<a name="l00511"></a><a class="code" href="../../d6/d2a/struct_i_names_arg.html#aaa9c552719b09a881ac5c720883e4672">00511</a>   <a class="code" href="../../d1/d7b/struct_onig_encoding_type_s_t.html">OnigEncoding</a> enc;
<a name="l00512"></a>00512 } <a class="code" href="../../d6/d2a/struct_i_names_arg.html">INamesArg</a>;
<a name="l00513"></a>00513 
<a name="l00514"></a>00514 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l00515"></a><a class="code" href="../../d6/dda/regparse_8c.html#a8fbb6332fa6183096cd32767db787b12">00515</a> <a class="code" href="../../d6/dda/regparse_8c.html#a8fbb6332fa6183096cd32767db787b12">i_names</a>(<a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>* <a class="code" href="../../dc/de5/random_8c.html#a742229490b6759a90ece7ba82ba129d5">key</a> ARG_UNUSED, <a class="code" href="../../d2/d4a/struct_name_entry.html">NameEntry</a>* e, <a class="code" href="../../d6/d2a/struct_i_names_arg.html">INamesArg</a>* arg)
<a name="l00516"></a>00516 {
<a name="l00517"></a>00517   <span class="keywordtype">int</span> r = (*(arg-&gt;<a class="code" href="../../d6/d2a/struct_i_names_arg.html#aafed11a73cc3c02f3bdb2d2ffc46bce8">func</a>))(e-&gt;<a class="code" href="../../d2/d4a/struct_name_entry.html#abad75d1d35d063d9acad5968b161b666">name</a>,
<a name="l00518"></a>00518                          e-&gt;<a class="code" href="../../d2/d4a/struct_name_entry.html#abad75d1d35d063d9acad5968b161b666">name</a> + e-&gt;<a class="code" href="../../d2/d4a/struct_name_entry.html#a8b2741cf75163f9364ecaa1314868b5d">name_len</a>,
<a name="l00519"></a>00519                          e-&gt;<a class="code" href="../../d2/d4a/struct_name_entry.html#a9e00de235c01b34a5244f1c572968da5">back_num</a>,
<a name="l00520"></a>00520                          (e-&gt;<a class="code" href="../../d2/d4a/struct_name_entry.html#a9e00de235c01b34a5244f1c572968da5">back_num</a> &gt; 1 ? e-&gt;<a class="code" href="../../d2/d4a/struct_name_entry.html#a5998d91dd61ffe28bbc7a97e83d527a0">back_refs</a> : &amp;(e-&gt;<a class="code" href="../../d2/d4a/struct_name_entry.html#a8f22012701b3ce478b7b5a0caf644458">back_ref1</a>)),
<a name="l00521"></a>00521                          arg-&gt;<a class="code" href="../../d6/d2a/struct_i_names_arg.html#a634f3511efaa2cbf18e0083a3f4ce4fa">reg</a>, arg-&gt;<a class="code" href="../../d6/d2a/struct_i_names_arg.html#a6d16a5c1d5af9f07dc41fc3ae65d75e2">arg</a>);
<a name="l00522"></a>00522   <span class="keywordflow">if</span> (r != 0) {
<a name="l00523"></a>00523     arg-&gt;<a class="code" href="../../d6/d2a/struct_i_names_arg.html#a088e4eee203a0ba2906c67368455bb57">ret</a> = r;
<a name="l00524"></a>00524     <span class="keywordflow">return</span> <a class="code" href="../../dd/d24/st_8h.html#a0c6a172fd99de7928916e65034ed8b1fa04b939c166d4baa471909eb224d5fed3">ST_STOP</a>;
<a name="l00525"></a>00525   }
<a name="l00526"></a>00526   <span class="keywordflow">return</span> <a class="code" href="../../dd/d24/st_8h.html#a0c6a172fd99de7928916e65034ed8b1fac99fc55c7f355bf9071739a4bc2ea139">ST_CONTINUE</a>;
<a name="l00527"></a>00527 }
<a name="l00528"></a>00528 
<a name="l00529"></a>00529 <span class="keyword">extern</span> <span class="keywordtype">int</span>
<a name="l00530"></a><a class="code" href="../../d6/dda/regparse_8c.html#a0d72e0c285f5332420495848d355b173">00530</a> <a class="code" href="../../d6/dda/regparse_8c.html#a0d72e0c285f5332420495848d355b173">onig_foreach_name</a>(<a class="code" href="../../db/d0e/structre__pattern__buffer.html">regex_t</a>* reg,
<a name="l00531"></a>00531   <span class="keywordtype">int</span> (*<a class="code" href="../../dc/dd1/ossl__ssl_8c.html#a131c09b7f9c9a0b52e6f79f651cfd574">func</a>)(<span class="keyword">const</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>*, <span class="keyword">const</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>*,<span class="keywordtype">int</span>,<span class="keywordtype">int</span>*,<a class="code" href="../../db/d0e/structre__pattern__buffer.html">regex_t</a>*,<span class="keywordtype">void</span>*), <span class="keywordtype">void</span>* arg)
<a name="l00532"></a>00532 {
<a name="l00533"></a>00533   <a class="code" href="../../d6/d2a/struct_i_names_arg.html">INamesArg</a> narg;
<a name="l00534"></a>00534   NameTable* t = (NameTable* )reg-&gt;<a class="code" href="../../db/d0e/structre__pattern__buffer.html#a23168e45fcc2c959b7aaed0b6a2e3f7a">name_table</a>;
<a name="l00535"></a>00535 
<a name="l00536"></a>00536   narg.<a class="code" href="../../d6/d2a/struct_i_names_arg.html#a088e4eee203a0ba2906c67368455bb57">ret</a> = 0;
<a name="l00537"></a>00537   <a class="code" href="../../d7/dc0/parse_8y.html#a2ac1143ac343c79cbfa448e30d74fa1c">if</a> (<a class="code" href="../../d6/d87/regint_8h.html#a4bc25fbd4749a2c130d1ae7f15ba140c">IS_NOT_NULL</a>(t)) {
<a name="l00538"></a>00538     narg.<a class="code" href="../../d6/d2a/struct_i_names_arg.html#aafed11a73cc3c02f3bdb2d2ffc46bce8">func</a> = <a class="code" href="../../dc/dd1/ossl__ssl_8c.html#a131c09b7f9c9a0b52e6f79f651cfd574">func</a>;
<a name="l00539"></a>00539     narg.<a class="code" href="../../d6/d2a/struct_i_names_arg.html#a634f3511efaa2cbf18e0083a3f4ce4fa">reg</a>  = reg;
<a name="l00540"></a>00540     narg.<a class="code" href="../../d6/d2a/struct_i_names_arg.html#a6d16a5c1d5af9f07dc41fc3ae65d75e2">arg</a>  = arg;
<a name="l00541"></a>00541     narg.<a class="code" href="../../d6/d2a/struct_i_names_arg.html#aaa9c552719b09a881ac5c720883e4672">enc</a>  = reg-&gt;<a class="code" href="../../db/d0e/structre__pattern__buffer.html#a1857fd68f4ca091d03855fa49b449080">enc</a>; <span class="comment">/* should be pattern encoding. */</span>
<a name="l00542"></a>00542     <a class="code" href="../../d6/d87/regint_8h.html#a19807bc745107ca04c237f9d9d4563ed">onig_st_foreach</a>(t, <a class="code" href="../../d6/dda/regparse_8c.html#a8fbb6332fa6183096cd32767db787b12">i_names</a>, (HashDataType )&amp;narg);
<a name="l00543"></a>00543   }
<a name="l00544"></a>00544   <span class="keywordflow">return</span> narg.<a class="code" href="../../d6/d2a/struct_i_names_arg.html#a088e4eee203a0ba2906c67368455bb57">ret</a>;
<a name="l00545"></a>00545 }
<a name="l00546"></a>00546 
<a name="l00547"></a>00547 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l00548"></a><a class="code" href="../../d6/dda/regparse_8c.html#a96926e6b10f23ddd9bd5e4ae342f31fe">00548</a> <a class="code" href="../../d6/dda/regparse_8c.html#a96926e6b10f23ddd9bd5e4ae342f31fe">i_renumber_name</a>(<a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>* <a class="code" href="../../dc/de5/random_8c.html#a742229490b6759a90ece7ba82ba129d5">key</a> ARG_UNUSED, <a class="code" href="../../d2/d4a/struct_name_entry.html">NameEntry</a>* e, <a class="code" href="../../d2/d8b/struct_group_num_remap.html">GroupNumRemap</a>* map)
<a name="l00549"></a>00549 {
<a name="l00550"></a>00550   <span class="keywordtype">int</span> i;
<a name="l00551"></a>00551 
<a name="l00552"></a>00552   <span class="keywordflow">if</span> (e-&gt;<a class="code" href="../../d2/d4a/struct_name_entry.html#a9e00de235c01b34a5244f1c572968da5">back_num</a> &gt; 1) {
<a name="l00553"></a>00553     <span class="keywordflow">for</span> (i = 0; i &lt; e-&gt;<a class="code" href="../../d2/d4a/struct_name_entry.html#a9e00de235c01b34a5244f1c572968da5">back_num</a>; i++) {
<a name="l00554"></a>00554       e-&gt;<a class="code" href="../../d2/d4a/struct_name_entry.html#a5998d91dd61ffe28bbc7a97e83d527a0">back_refs</a>[i] = map[e-&gt;<a class="code" href="../../d2/d4a/struct_name_entry.html#a5998d91dd61ffe28bbc7a97e83d527a0">back_refs</a>[i]].<a class="code" href="../../d2/d8b/struct_group_num_remap.html#ad6c1090a2569428bbbbc029a906bf3a4">new_val</a>;
<a name="l00555"></a>00555     }
<a name="l00556"></a>00556   }
<a name="l00557"></a>00557   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (e-&gt;<a class="code" href="../../d2/d4a/struct_name_entry.html#a9e00de235c01b34a5244f1c572968da5">back_num</a> == 1) {
<a name="l00558"></a>00558     e-&gt;<a class="code" href="../../d2/d4a/struct_name_entry.html#a8f22012701b3ce478b7b5a0caf644458">back_ref1</a> = map[e-&gt;<a class="code" href="../../d2/d4a/struct_name_entry.html#a8f22012701b3ce478b7b5a0caf644458">back_ref1</a>].<a class="code" href="../../d2/d8b/struct_group_num_remap.html#ad6c1090a2569428bbbbc029a906bf3a4">new_val</a>;
<a name="l00559"></a>00559   }
<a name="l00560"></a>00560 
<a name="l00561"></a>00561   <span class="keywordflow">return</span> <a class="code" href="../../dd/d24/st_8h.html#a0c6a172fd99de7928916e65034ed8b1fac99fc55c7f355bf9071739a4bc2ea139">ST_CONTINUE</a>;
<a name="l00562"></a>00562 }
<a name="l00563"></a>00563 
<a name="l00564"></a>00564 <span class="keyword">extern</span> <span class="keywordtype">int</span>
<a name="l00565"></a><a class="code" href="../../d6/dda/regparse_8c.html#af1403b57925202f97bb10bd8c7c2d1ae">00565</a> <a class="code" href="../../d6/dda/regparse_8c.html#af1403b57925202f97bb10bd8c7c2d1ae">onig_renumber_name_table</a>(<a class="code" href="../../db/d0e/structre__pattern__buffer.html">regex_t</a>* reg, <a class="code" href="../../d2/d8b/struct_group_num_remap.html">GroupNumRemap</a>* map)
<a name="l00566"></a>00566 {
<a name="l00567"></a>00567   NameTable* t = (NameTable* )reg-&gt;<a class="code" href="../../db/d0e/structre__pattern__buffer.html#a23168e45fcc2c959b7aaed0b6a2e3f7a">name_table</a>;
<a name="l00568"></a>00568 
<a name="l00569"></a>00569   <a class="code" href="../../d7/dc0/parse_8y.html#a2ac1143ac343c79cbfa448e30d74fa1c">if</a> (<a class="code" href="../../d6/d87/regint_8h.html#a4bc25fbd4749a2c130d1ae7f15ba140c">IS_NOT_NULL</a>(t)) {
<a name="l00570"></a>00570     <a class="code" href="../../d6/d87/regint_8h.html#a19807bc745107ca04c237f9d9d4563ed">onig_st_foreach</a>(t, <a class="code" href="../../d6/dda/regparse_8c.html#a96926e6b10f23ddd9bd5e4ae342f31fe">i_renumber_name</a>, (HashDataType )map);
<a name="l00571"></a>00571   }
<a name="l00572"></a>00572   <span class="keywordflow">return</span> 0;
<a name="l00573"></a>00573 }
<a name="l00574"></a>00574 
<a name="l00575"></a>00575 
<a name="l00576"></a>00576 <span class="keyword">extern</span> <span class="keywordtype">int</span>
<a name="l00577"></a><a class="code" href="../../d6/dda/regparse_8c.html#a7713de57637189f41a2d3de69050174e">00577</a> <a class="code" href="../../d6/dda/regparse_8c.html#a7713de57637189f41a2d3de69050174e">onig_number_of_names</a>(<a class="code" href="../../db/d0e/structre__pattern__buffer.html">regex_t</a>* reg)
<a name="l00578"></a>00578 {
<a name="l00579"></a>00579   NameTable* t = (NameTable* )reg-&gt;<a class="code" href="../../db/d0e/structre__pattern__buffer.html#a23168e45fcc2c959b7aaed0b6a2e3f7a">name_table</a>;
<a name="l00580"></a>00580 
<a name="l00581"></a>00581   <a class="code" href="../../d7/dc0/parse_8y.html#a2ac1143ac343c79cbfa448e30d74fa1c">if</a> (<a class="code" href="../../d6/d87/regint_8h.html#a4bc25fbd4749a2c130d1ae7f15ba140c">IS_NOT_NULL</a>(t))
<a name="l00582"></a>00582     <span class="keywordflow">return</span> t-&gt;<a class="code" href="../../d0/ddd/structst__table.html#aa593a5229fc7d02d628a4518f56f71b6">num_entries</a>;
<a name="l00583"></a>00583   <span class="keywordflow">else</span>
<a name="l00584"></a>00584     <span class="keywordflow">return</span> 0;
<a name="l00585"></a>00585 }
<a name="l00586"></a>00586 
<a name="l00587"></a>00587 <span class="preprocessor">#else  </span><span class="comment">/* USE_ST_LIBRARY */</span>
<a name="l00588"></a>00588 
<a name="l00589"></a>00589 <span class="preprocessor">#define INIT_NAMES_ALLOC_NUM    8</span>
<a name="l00590"></a>00590 <span class="preprocessor"></span>
<a name="l00591"></a>00591 <span class="keyword">typedef</span> <span class="keyword">struct </span>{
<a name="l00592"></a>00592   <a class="code" href="../../d2/d4a/struct_name_entry.html">NameEntry</a>* e;
<a name="l00593"></a>00593   <span class="keywordtype">int</span>        num;
<a name="l00594"></a>00594   <span class="keywordtype">int</span>        <a class="code" href="../../d4/d71/st_8c.html#a385b96996caa48e6349681cf8036322f">alloc</a>;
<a name="l00595"></a>00595 } NameTable;
<a name="l00596"></a>00596 
<a name="l00597"></a>00597 <span class="preprocessor">#ifdef ONIG_DEBUG</span>
<a name="l00598"></a>00598 <span class="preprocessor"></span><span class="keyword">extern</span> <span class="keywordtype">int</span>
<a name="l00599"></a>00599 onig_print_names(<a class="code" href="../../db/ddf/struct____s_f_i_l_e.html">FILE</a>* fp, <a class="code" href="../../db/d0e/structre__pattern__buffer.html">regex_t</a>* reg)
<a name="l00600"></a>00600 {
<a name="l00601"></a>00601   <span class="keywordtype">int</span> i, j;
<a name="l00602"></a>00602   <a class="code" href="../../d2/d4a/struct_name_entry.html">NameEntry</a>* e;
<a name="l00603"></a>00603   NameTable* t = (NameTable* )reg-&gt;<a class="code" href="../../db/d0e/structre__pattern__buffer.html#a23168e45fcc2c959b7aaed0b6a2e3f7a">name_table</a>;
<a name="l00604"></a>00604 
<a name="l00605"></a>00605   <a class="code" href="../../d7/dc0/parse_8y.html#a2ac1143ac343c79cbfa448e30d74fa1c">if</a> (<a class="code" href="../../d6/d87/regint_8h.html#a4bc25fbd4749a2c130d1ae7f15ba140c">IS_NOT_NULL</a>(t) &amp;&amp; t-&gt;num &gt; 0) {
<a name="l00606"></a>00606     fprintf(fp, <span class="stringliteral">&quot;name table\n&quot;</span>);
<a name="l00607"></a>00607     <span class="keywordflow">for</span> (i = 0; i &lt; t-&gt;num; i++) {
<a name="l00608"></a>00608       e = &amp;(t-&gt;e[i]);
<a name="l00609"></a>00609       fprintf(fp, <span class="stringliteral">&quot;%s: &quot;</span>, e-&gt;<a class="code" href="../../d2/d4a/struct_name_entry.html#abad75d1d35d063d9acad5968b161b666">name</a>);
<a name="l00610"></a>00610       <span class="keywordflow">if</span> (e-&gt;<a class="code" href="../../d2/d4a/struct_name_entry.html#a9e00de235c01b34a5244f1c572968da5">back_num</a> == 0) {
<a name="l00611"></a>00611         fputs(<span class="stringliteral">&quot;-&quot;</span>, fp);
<a name="l00612"></a>00612       }
<a name="l00613"></a>00613       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (e-&gt;<a class="code" href="../../d2/d4a/struct_name_entry.html#a9e00de235c01b34a5244f1c572968da5">back_num</a> == 1) {
<a name="l00614"></a>00614         fprintf(fp, <span class="stringliteral">&quot;%d&quot;</span>, e-&gt;<a class="code" href="../../d2/d4a/struct_name_entry.html#a8f22012701b3ce478b7b5a0caf644458">back_ref1</a>);
<a name="l00615"></a>00615       }
<a name="l00616"></a>00616       <span class="keywordflow">else</span> {
<a name="l00617"></a>00617         <span class="keywordflow">for</span> (j = 0; j &lt; e-&gt;<a class="code" href="../../d2/d4a/struct_name_entry.html#a9e00de235c01b34a5244f1c572968da5">back_num</a>; j++) {
<a name="l00618"></a>00618           <span class="keywordflow">if</span> (j &gt; 0) fprintf(fp, <span class="stringliteral">&quot;, &quot;</span>);
<a name="l00619"></a>00619           fprintf(fp, <span class="stringliteral">&quot;%d&quot;</span>, e-&gt;<a class="code" href="../../d2/d4a/struct_name_entry.html#a5998d91dd61ffe28bbc7a97e83d527a0">back_refs</a>[j]);
<a name="l00620"></a>00620         }
<a name="l00621"></a>00621       }
<a name="l00622"></a>00622       fputs(<span class="stringliteral">&quot;\n&quot;</span>, fp);
<a name="l00623"></a>00623     }
<a name="l00624"></a>00624     fputs(<span class="stringliteral">&quot;\n&quot;</span>, fp);
<a name="l00625"></a>00625   }
<a name="l00626"></a>00626   <span class="keywordflow">return</span> 0;
<a name="l00627"></a>00627 }
<a name="l00628"></a>00628 <span class="preprocessor">#endif</span>
<a name="l00629"></a>00629 <span class="preprocessor"></span>
<a name="l00630"></a>00630 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l00631"></a>00631 <a class="code" href="../../d6/dda/regparse_8c.html#a4fe174e6f8a47f1532a18bb4f93f622e">names_clear</a>(<a class="code" href="../../db/d0e/structre__pattern__buffer.html">regex_t</a>* reg)
<a name="l00632"></a>00632 {
<a name="l00633"></a>00633   <span class="keywordtype">int</span> i;
<a name="l00634"></a>00634   <a class="code" href="../../d2/d4a/struct_name_entry.html">NameEntry</a>* e;
<a name="l00635"></a>00635   NameTable* t = (NameTable* )reg-&gt;<a class="code" href="../../db/d0e/structre__pattern__buffer.html#a23168e45fcc2c959b7aaed0b6a2e3f7a">name_table</a>;
<a name="l00636"></a>00636 
<a name="l00637"></a>00637   <a class="code" href="../../d7/dc0/parse_8y.html#a2ac1143ac343c79cbfa448e30d74fa1c">if</a> (<a class="code" href="../../d6/d87/regint_8h.html#a4bc25fbd4749a2c130d1ae7f15ba140c">IS_NOT_NULL</a>(t)) {
<a name="l00638"></a>00638     <span class="keywordflow">for</span> (i = 0; i &lt; t-&gt;num; i++) {
<a name="l00639"></a>00639       e = &amp;(t-&gt;e[i]);
<a name="l00640"></a>00640       <span class="keywordflow">if</span> (<a class="code" href="../../d6/d87/regint_8h.html#a4bc25fbd4749a2c130d1ae7f15ba140c">IS_NOT_NULL</a>(e-&gt;<a class="code" href="../../d2/d4a/struct_name_entry.html#abad75d1d35d063d9acad5968b161b666">name</a>)) {
<a name="l00641"></a>00641         <a class="code" href="../../d8/db0/defines_8h.html#a2c3897f7c46ca54a2e0dd7b24a40c7cb">xfree</a>(e-&gt;<a class="code" href="../../d2/d4a/struct_name_entry.html#abad75d1d35d063d9acad5968b161b666">name</a>);
<a name="l00642"></a>00642         e-&gt;<a class="code" href="../../d2/d4a/struct_name_entry.html#abad75d1d35d063d9acad5968b161b666">name</a>       = <a class="code" href="../../d3/d09/ripper_8y.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00643"></a>00643         e-&gt;<a class="code" href="../../d2/d4a/struct_name_entry.html#a8b2741cf75163f9364ecaa1314868b5d">name_len</a>   = 0;
<a name="l00644"></a>00644         e-&gt;<a class="code" href="../../d2/d4a/struct_name_entry.html#a9e00de235c01b34a5244f1c572968da5">back_num</a>   = 0;
<a name="l00645"></a>00645         e-&gt;<a class="code" href="../../d2/d4a/struct_name_entry.html#a051ae235a19375475955c600cf0cb197">back_alloc</a> = 0;
<a name="l00646"></a>00646         <span class="keywordflow">if</span> (<a class="code" href="../../d6/d87/regint_8h.html#a4bc25fbd4749a2c130d1ae7f15ba140c">IS_NOT_NULL</a>(e-&gt;<a class="code" href="../../d2/d4a/struct_name_entry.html#a5998d91dd61ffe28bbc7a97e83d527a0">back_refs</a>)) <a class="code" href="../../d8/db0/defines_8h.html#a2c3897f7c46ca54a2e0dd7b24a40c7cb">xfree</a>(e-&gt;<a class="code" href="../../d2/d4a/struct_name_entry.html#a5998d91dd61ffe28bbc7a97e83d527a0">back_refs</a>);
<a name="l00647"></a>00647         e-&gt;<a class="code" href="../../d2/d4a/struct_name_entry.html#a5998d91dd61ffe28bbc7a97e83d527a0">back_refs</a> = (<span class="keywordtype">int</span>* )NULL;
<a name="l00648"></a>00648       }
<a name="l00649"></a>00649     }
<a name="l00650"></a>00650     <span class="keywordflow">if</span> (<a class="code" href="../../d6/d87/regint_8h.html#a4bc25fbd4749a2c130d1ae7f15ba140c">IS_NOT_NULL</a>(t-&gt;e)) {
<a name="l00651"></a>00651       <a class="code" href="../../d8/db0/defines_8h.html#a2c3897f7c46ca54a2e0dd7b24a40c7cb">xfree</a>(t-&gt;e);
<a name="l00652"></a>00652       t-&gt;e = <a class="code" href="../../d3/d09/ripper_8y.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00653"></a>00653     }
<a name="l00654"></a>00654     t-&gt;num = 0;
<a name="l00655"></a>00655   }
<a name="l00656"></a>00656   <span class="keywordflow">return</span> 0;
<a name="l00657"></a>00657 }
<a name="l00658"></a>00658 
<a name="l00659"></a>00659 <span class="keyword">extern</span> <span class="keywordtype">int</span>
<a name="l00660"></a>00660 <a class="code" href="../../d6/dda/regparse_8c.html#acb18d5fa84a45870b5a9739deff10659">onig_names_free</a>(<a class="code" href="../../db/d0e/structre__pattern__buffer.html">regex_t</a>* reg)
<a name="l00661"></a>00661 {
<a name="l00662"></a>00662   <span class="keywordtype">int</span> r;
<a name="l00663"></a>00663   NameTable* t;
<a name="l00664"></a>00664 
<a name="l00665"></a>00665   r = <a class="code" href="../../d6/dda/regparse_8c.html#a4fe174e6f8a47f1532a18bb4f93f622e">names_clear</a>(reg);
<a name="l00666"></a>00666   <span class="keywordflow">if</span> (r) <span class="keywordflow">return</span> r;
<a name="l00667"></a>00667 
<a name="l00668"></a>00668   t = (NameTable* )reg-&gt;<a class="code" href="../../db/d0e/structre__pattern__buffer.html#a23168e45fcc2c959b7aaed0b6a2e3f7a">name_table</a>;
<a name="l00669"></a>00669   <a class="code" href="../../d7/dc0/parse_8y.html#a2ac1143ac343c79cbfa448e30d74fa1c">if</a> (<a class="code" href="../../d6/d87/regint_8h.html#a4bc25fbd4749a2c130d1ae7f15ba140c">IS_NOT_NULL</a>(t)) <a class="code" href="../../d8/db0/defines_8h.html#a2c3897f7c46ca54a2e0dd7b24a40c7cb">xfree</a>(t);
<a name="l00670"></a>00670   reg-&gt;<a class="code" href="../../db/d0e/structre__pattern__buffer.html#a23168e45fcc2c959b7aaed0b6a2e3f7a">name_table</a> = <a class="code" href="../../d3/d09/ripper_8y.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00671"></a>00671   <span class="keywordflow">return</span> 0;
<a name="l00672"></a>00672 }
<a name="l00673"></a>00673 
<a name="l00674"></a>00674 <span class="keyword">static</span> <a class="code" href="../../d2/d4a/struct_name_entry.html">NameEntry</a>*
<a name="l00675"></a>00675 <a class="code" href="../../d6/dda/regparse_8c.html#aeea88c6a5bae0d3d0aaee1ecc9368499">name_find</a>(<a class="code" href="../../db/d0e/structre__pattern__buffer.html">regex_t</a>* reg, <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>* <a class="code" href="../../d6/da0/nkf-utf8_2nkf_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>* name_end)
<a name="l00676"></a>00676 {
<a name="l00677"></a>00677   <span class="keywordtype">int</span> i, <a class="code" href="../../d3/d15/name2ctype_8h.html#aed1cc4dca5d94cb452f79691f54f7423">len</a>;
<a name="l00678"></a>00678   <a class="code" href="../../d2/d4a/struct_name_entry.html">NameEntry</a>* e;
<a name="l00679"></a>00679   NameTable* t = (NameTable* )reg-&gt;<a class="code" href="../../db/d0e/structre__pattern__buffer.html#a23168e45fcc2c959b7aaed0b6a2e3f7a">name_table</a>;
<a name="l00680"></a>00680 
<a name="l00681"></a>00681   <a class="code" href="../../d7/dc0/parse_8y.html#a2ac1143ac343c79cbfa448e30d74fa1c">if</a> (<a class="code" href="../../d6/d87/regint_8h.html#a4bc25fbd4749a2c130d1ae7f15ba140c">IS_NOT_NULL</a>(t)) {
<a name="l00682"></a>00682     len = name_end - name;
<a name="l00683"></a>00683     <span class="keywordflow">for</span> (i = 0; i &lt; t-&gt;num; i++) {
<a name="l00684"></a>00684       e = &amp;(t-&gt;e[i]);
<a name="l00685"></a>00685       <span class="keywordflow">if</span> (len == e-&gt;<a class="code" href="../../d2/d4a/struct_name_entry.html#a8b2741cf75163f9364ecaa1314868b5d">name_len</a> &amp;&amp; <a class="code" href="../../d6/dda/regparse_8c.html#a138838c9d16547c9dde877effa669a35">onig_strncmp</a>(name, e-&gt;<a class="code" href="../../d2/d4a/struct_name_entry.html#abad75d1d35d063d9acad5968b161b666">name</a>, len) == 0)
<a name="l00686"></a>00686         <span class="keywordflow">return</span> e;
<a name="l00687"></a>00687     }
<a name="l00688"></a>00688   }
<a name="l00689"></a>00689   <span class="keywordflow">return</span> (<a class="code" href="../../d2/d4a/struct_name_entry.html">NameEntry</a>* )<a class="code" href="../../d3/d09/ripper_8y.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00690"></a>00690 }
<a name="l00691"></a>00691 
<a name="l00692"></a>00692 <span class="keyword">extern</span> <span class="keywordtype">int</span>
<a name="l00693"></a>00693 <a class="code" href="../../d6/dda/regparse_8c.html#a0d72e0c285f5332420495848d355b173">onig_foreach_name</a>(<a class="code" href="../../db/d0e/structre__pattern__buffer.html">regex_t</a>* reg,
<a name="l00694"></a>00694   <span class="keywordtype">int</span> (*<a class="code" href="../../dc/dd1/ossl__ssl_8c.html#a131c09b7f9c9a0b52e6f79f651cfd574">func</a>)(<span class="keyword">const</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>*, <span class="keyword">const</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>*,<span class="keywordtype">int</span>,<span class="keywordtype">int</span>*,<a class="code" href="../../db/d0e/structre__pattern__buffer.html">regex_t</a>*,<span class="keywordtype">void</span>*), <span class="keywordtype">void</span>* arg)
<a name="l00695"></a>00695 {
<a name="l00696"></a>00696   <span class="keywordtype">int</span> i, r;
<a name="l00697"></a>00697   <a class="code" href="../../d2/d4a/struct_name_entry.html">NameEntry</a>* e;
<a name="l00698"></a>00698   NameTable* t = (NameTable* )reg-&gt;<a class="code" href="../../db/d0e/structre__pattern__buffer.html#a23168e45fcc2c959b7aaed0b6a2e3f7a">name_table</a>;
<a name="l00699"></a>00699 
<a name="l00700"></a>00700   <a class="code" href="../../d7/dc0/parse_8y.html#a2ac1143ac343c79cbfa448e30d74fa1c">if</a> (<a class="code" href="../../d6/d87/regint_8h.html#a4bc25fbd4749a2c130d1ae7f15ba140c">IS_NOT_NULL</a>(t)) {
<a name="l00701"></a>00701     <span class="keywordflow">for</span> (i = 0; i &lt; t-&gt;num; i++) {
<a name="l00702"></a>00702       e = &amp;(t-&gt;e[i]);
<a name="l00703"></a>00703       r = (*func)(e-&gt;<a class="code" href="../../d2/d4a/struct_name_entry.html#abad75d1d35d063d9acad5968b161b666">name</a>, e-&gt;<a class="code" href="../../d2/d4a/struct_name_entry.html#abad75d1d35d063d9acad5968b161b666">name</a> + e-&gt;<a class="code" href="../../d2/d4a/struct_name_entry.html#a8b2741cf75163f9364ecaa1314868b5d">name_len</a>, e-&gt;<a class="code" href="../../d2/d4a/struct_name_entry.html#a9e00de235c01b34a5244f1c572968da5">back_num</a>,
<a name="l00704"></a>00704                   (e-&gt;<a class="code" href="../../d2/d4a/struct_name_entry.html#a9e00de235c01b34a5244f1c572968da5">back_num</a> &gt; 1 ? e-&gt;<a class="code" href="../../d2/d4a/struct_name_entry.html#a5998d91dd61ffe28bbc7a97e83d527a0">back_refs</a> : &amp;(e-&gt;<a class="code" href="../../d2/d4a/struct_name_entry.html#a8f22012701b3ce478b7b5a0caf644458">back_ref1</a>)),
<a name="l00705"></a>00705                   reg, arg);
<a name="l00706"></a>00706       <span class="keywordflow">if</span> (r != 0) <span class="keywordflow">return</span> r;
<a name="l00707"></a>00707     }
<a name="l00708"></a>00708   }
<a name="l00709"></a>00709   <span class="keywordflow">return</span> 0;
<a name="l00710"></a>00710 }
<a name="l00711"></a>00711 
<a name="l00712"></a>00712 <span class="keyword">extern</span> <span class="keywordtype">int</span>
<a name="l00713"></a>00713 <a class="code" href="../../d6/dda/regparse_8c.html#a7713de57637189f41a2d3de69050174e">onig_number_of_names</a>(<a class="code" href="../../db/d0e/structre__pattern__buffer.html">regex_t</a>* reg)
<a name="l00714"></a>00714 {
<a name="l00715"></a>00715   NameTable* t = (NameTable* )reg-&gt;<a class="code" href="../../db/d0e/structre__pattern__buffer.html#a23168e45fcc2c959b7aaed0b6a2e3f7a">name_table</a>;
<a name="l00716"></a>00716 
<a name="l00717"></a>00717   <a class="code" href="../../d7/dc0/parse_8y.html#a2ac1143ac343c79cbfa448e30d74fa1c">if</a> (<a class="code" href="../../d6/d87/regint_8h.html#a4bc25fbd4749a2c130d1ae7f15ba140c">IS_NOT_NULL</a>(t))
<a name="l00718"></a>00718     <span class="keywordflow">return</span> t-&gt;num;
<a name="l00719"></a>00719   <span class="keywordflow">else</span>
<a name="l00720"></a>00720     <span class="keywordflow">return</span> 0;
<a name="l00721"></a>00721 }
<a name="l00722"></a>00722 
<a name="l00723"></a>00723 <span class="preprocessor">#endif </span><span class="comment">/* else USE_ST_LIBRARY */</span>
<a name="l00724"></a>00724 
<a name="l00725"></a>00725 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l00726"></a><a class="code" href="../../d6/dda/regparse_8c.html#a18d0ecab53a77bd25604a68115200c6d">00726</a> <a class="code" href="../../d6/dda/regparse_8c.html#a18d0ecab53a77bd25604a68115200c6d">name_add</a>(<a class="code" href="../../db/d0e/structre__pattern__buffer.html">regex_t</a>* reg, <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>* name, <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>* name_end, <span class="keywordtype">int</span> backref, <a class="code" href="../../d6/dbe/struct_scan_env.html">ScanEnv</a>* env)
<a name="l00727"></a>00727 {
<a name="l00728"></a>00728   <span class="keywordtype">int</span> <a class="code" href="../../d4/d71/st_8c.html#a385b96996caa48e6349681cf8036322f">alloc</a>;
<a name="l00729"></a>00729   <a class="code" href="../../d2/d4a/struct_name_entry.html">NameEntry</a>* e;
<a name="l00730"></a>00730   NameTable* t = (NameTable* )reg-&gt;<a class="code" href="../../db/d0e/structre__pattern__buffer.html#a23168e45fcc2c959b7aaed0b6a2e3f7a">name_table</a>;
<a name="l00731"></a>00731 
<a name="l00732"></a>00732   <a class="code" href="../../d7/dc0/parse_8y.html#a2ac1143ac343c79cbfa448e30d74fa1c">if</a> (name_end - name &lt;= 0)
<a name="l00733"></a>00733     <span class="keywordflow">return</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#a9d9a35ebc32ac51053edc7ab0b149ac7">ONIGERR_EMPTY_GROUP_NAME</a>;
<a name="l00734"></a>00734 
<a name="l00735"></a>00735   e = <a class="code" href="../../d6/dda/regparse_8c.html#aeea88c6a5bae0d3d0aaee1ecc9368499">name_find</a>(reg, name, name_end);
<a name="l00736"></a>00736   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d87/regint_8h.html#a91a9c9242dc3810582965d1882d1894d">IS_NULL</a>(e)) {
<a name="l00737"></a>00737 <span class="preprocessor">#ifdef USE_ST_LIBRARY</span>
<a name="l00738"></a>00738 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (<a class="code" href="../../d6/d87/regint_8h.html#a91a9c9242dc3810582965d1882d1894d">IS_NULL</a>(t)) {
<a name="l00739"></a>00739       t = <a class="code" href="../../d6/dda/regparse_8c.html#a851bd0c708c9617427503055f460e3bd">onig_st_init_strend_table_with_size</a>(5);
<a name="l00740"></a>00740       reg-&gt;<a class="code" href="../../db/d0e/structre__pattern__buffer.html#a23168e45fcc2c959b7aaed0b6a2e3f7a">name_table</a> = (<span class="keywordtype">void</span>* )t;
<a name="l00741"></a>00741     }
<a name="l00742"></a>00742     e = (<a class="code" href="../../d2/d4a/struct_name_entry.html">NameEntry</a>* )<a class="code" href="../../d8/db0/defines_8h.html#a6af5faec3f9662b20ffc9903f923dec0">xmalloc</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../d2/d4a/struct_name_entry.html">NameEntry</a>));
<a name="l00743"></a>00743     <a class="code" href="../../d6/d87/regint_8h.html#a17ebb2a12300dcf6d79916e357fae45a">CHECK_NULL_RETURN_MEMERR</a>(e);
<a name="l00744"></a>00744 
<a name="l00745"></a>00745     e-&gt;<a class="code" href="../../d2/d4a/struct_name_entry.html#abad75d1d35d063d9acad5968b161b666">name</a> = <a class="code" href="../../d6/dda/regparse_8c.html#a96969bed3141a7f705526030ef11d7b1">strdup_with_null</a>(reg-&gt;<a class="code" href="../../db/d0e/structre__pattern__buffer.html#a1857fd68f4ca091d03855fa49b449080">enc</a>, name, name_end);
<a name="l00746"></a>00746     <span class="keywordflow">if</span> (<a class="code" href="../../d6/d87/regint_8h.html#a91a9c9242dc3810582965d1882d1894d">IS_NULL</a>(e-&gt;<a class="code" href="../../d2/d4a/struct_name_entry.html#abad75d1d35d063d9acad5968b161b666">name</a>)) {
<a name="l00747"></a>00747       <a class="code" href="../../d8/db0/defines_8h.html#a2c3897f7c46ca54a2e0dd7b24a40c7cb">xfree</a>(e);
<a name="l00748"></a>00748       <span class="keywordflow">return</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#a843ef92c5edce533877d3d65ef94a142">ONIGERR_MEMORY</a>;
<a name="l00749"></a>00749     }
<a name="l00750"></a>00750     <a class="code" href="../../d6/dda/regparse_8c.html#a422ffdbf2a9a4e9b0ed8458f84f6d2f3">onig_st_insert_strend</a>(t, e-&gt;<a class="code" href="../../d2/d4a/struct_name_entry.html#abad75d1d35d063d9acad5968b161b666">name</a>, (e-&gt;<a class="code" href="../../d2/d4a/struct_name_entry.html#abad75d1d35d063d9acad5968b161b666">name</a> + (name_end - name)),
<a name="l00751"></a>00751                           (HashDataType )e);
<a name="l00752"></a>00752 
<a name="l00753"></a>00753     e-&gt;name_len   = name_end - name;
<a name="l00754"></a>00754     e-&gt;back_num   = 0;
<a name="l00755"></a>00755     e-&gt;back_alloc = 0;
<a name="l00756"></a>00756     e-&gt;back_refs  = (<span class="keywordtype">int</span>* )<a class="code" href="../../d3/d09/ripper_8y.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00757"></a>00757 
<a name="l00758"></a>00758 <span class="preprocessor">#else</span>
<a name="l00759"></a>00759 <span class="preprocessor"></span>
<a name="l00760"></a>00760     <span class="keywordflow">if</span> (<a class="code" href="../../d6/d87/regint_8h.html#a91a9c9242dc3810582965d1882d1894d">IS_NULL</a>(t)) {
<a name="l00761"></a>00761       alloc = INIT_NAMES_ALLOC_NUM;
<a name="l00762"></a>00762       t = (NameTable* )<a class="code" href="../../d8/db0/defines_8h.html#a6af5faec3f9662b20ffc9903f923dec0">xmalloc</a>(<span class="keyword">sizeof</span>(NameTable));
<a name="l00763"></a>00763       <a class="code" href="../../d6/d87/regint_8h.html#a17ebb2a12300dcf6d79916e357fae45a">CHECK_NULL_RETURN_MEMERR</a>(t);
<a name="l00764"></a>00764       t-&gt;e     = <a class="code" href="../../d3/d09/ripper_8y.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00765"></a>00765       t-&gt;alloc = 0;
<a name="l00766"></a>00766       t-&gt;num   = 0;
<a name="l00767"></a>00767 
<a name="l00768"></a>00768       t-&gt;e = (<a class="code" href="../../d2/d4a/struct_name_entry.html">NameEntry</a>* )<a class="code" href="../../d8/db0/defines_8h.html#a6af5faec3f9662b20ffc9903f923dec0">xmalloc</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../d2/d4a/struct_name_entry.html">NameEntry</a>) * alloc);
<a name="l00769"></a>00769       <span class="keywordflow">if</span> (<a class="code" href="../../d6/d87/regint_8h.html#a91a9c9242dc3810582965d1882d1894d">IS_NULL</a>(t-&gt;e)) {
<a name="l00770"></a>00770         <a class="code" href="../../d8/db0/defines_8h.html#a2c3897f7c46ca54a2e0dd7b24a40c7cb">xfree</a>(t);
<a name="l00771"></a>00771         <span class="keywordflow">return</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#a843ef92c5edce533877d3d65ef94a142">ONIGERR_MEMORY</a>;
<a name="l00772"></a>00772       }
<a name="l00773"></a>00773       t-&gt;alloc = alloc;
<a name="l00774"></a>00774       reg-&gt;<a class="code" href="../../db/d0e/structre__pattern__buffer.html#a23168e45fcc2c959b7aaed0b6a2e3f7a">name_table</a> = t;
<a name="l00775"></a>00775       <span class="keywordflow">goto</span> clear;
<a name="l00776"></a>00776     }
<a name="l00777"></a>00777     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (t-&gt;num == t-&gt;alloc) {
<a name="l00778"></a>00778       <span class="keywordtype">int</span> i;
<a name="l00779"></a>00779 
<a name="l00780"></a>00780       alloc = t-&gt;alloc * 2;
<a name="l00781"></a>00781       t-&gt;e = (<a class="code" href="../../d2/d4a/struct_name_entry.html">NameEntry</a>* )<a class="code" href="../../d8/db0/defines_8h.html#a40740062faf2d95d4935112447c464ef">xrealloc</a>(t-&gt;e, <span class="keyword">sizeof</span>(<a class="code" href="../../d2/d4a/struct_name_entry.html">NameEntry</a>) * alloc);
<a name="l00782"></a>00782       <a class="code" href="../../d6/d87/regint_8h.html#a17ebb2a12300dcf6d79916e357fae45a">CHECK_NULL_RETURN_MEMERR</a>(t-&gt;e);
<a name="l00783"></a>00783       t-&gt;alloc = alloc;
<a name="l00784"></a>00784 
<a name="l00785"></a>00785     clear:
<a name="l00786"></a>00786       <span class="keywordflow">for</span> (i = t-&gt;num; i &lt; t-&gt;alloc; i++) {
<a name="l00787"></a>00787         t-&gt;e[i].name       = <a class="code" href="../../d3/d09/ripper_8y.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00788"></a>00788         t-&gt;e[i].name_len   = 0;
<a name="l00789"></a>00789         t-&gt;e[i].back_num   = 0;
<a name="l00790"></a>00790         t-&gt;e[i].back_alloc = 0;
<a name="l00791"></a>00791         t-&gt;e[i].back_refs  = (<span class="keywordtype">int</span>* )<a class="code" href="../../d3/d09/ripper_8y.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00792"></a>00792       }
<a name="l00793"></a>00793     }
<a name="l00794"></a>00794     e = &amp;(t-&gt;e[t-&gt;num]);
<a name="l00795"></a>00795     t-&gt;num++;
<a name="l00796"></a>00796     e-&gt;name = <a class="code" href="../../d6/dda/regparse_8c.html#a96969bed3141a7f705526030ef11d7b1">strdup_with_null</a>(reg-&gt;<a class="code" href="../../db/d0e/structre__pattern__buffer.html#a1857fd68f4ca091d03855fa49b449080">enc</a>, name, name_end);
<a name="l00797"></a>00797     <span class="keywordflow">if</span> (<a class="code" href="../../d6/d87/regint_8h.html#a91a9c9242dc3810582965d1882d1894d">IS_NULL</a>(e-&gt;name)) <span class="keywordflow">return</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#a843ef92c5edce533877d3d65ef94a142">ONIGERR_MEMORY</a>;
<a name="l00798"></a>00798     e-&gt;name_len = name_end - name;
<a name="l00799"></a>00799 <span class="preprocessor">#endif</span>
<a name="l00800"></a>00800 <span class="preprocessor"></span>  }
<a name="l00801"></a>00801 
<a name="l00802"></a>00802   <span class="keywordflow">if</span> (e-&gt;<a class="code" href="../../d2/d4a/struct_name_entry.html#a9e00de235c01b34a5244f1c572968da5">back_num</a> &gt;= 1 &amp;&amp;
<a name="l00803"></a>00803       ! <a class="code" href="../../d1/dfc/regparse_8h.html#a18bfc9ee154d6dd516347bd71b4810f6">IS_SYNTAX_BV</a>(env-&gt;<a class="code" href="../../d6/dbe/struct_scan_env.html#ae5c4502ad7b7a4a418eda464919d2bda">syntax</a>, <a class="code" href="../../d8/db3/oniguruma_8h.html#a4b30e30f68c92db9ed8668e1aab768b9">ONIG_SYN_ALLOW_MULTIPLEX_DEFINITION_NAME</a>)) {
<a name="l00804"></a>00804     <a class="code" href="../../d6/dda/regparse_8c.html#a8d6d95d9c113545baa16fe1ff3d96191">onig_scan_env_set_error_string</a>(env, <a class="code" href="../../d8/db3/oniguruma_8h.html#ab01f64e3d7b41809b2ef8407cdb2ae29">ONIGERR_MULTIPLEX_DEFINED_NAME</a>,
<a name="l00805"></a>00805                                     name, name_end);
<a name="l00806"></a>00806     <span class="keywordflow">return</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#ab01f64e3d7b41809b2ef8407cdb2ae29">ONIGERR_MULTIPLEX_DEFINED_NAME</a>;
<a name="l00807"></a>00807   }
<a name="l00808"></a>00808 
<a name="l00809"></a>00809   e-&gt;<a class="code" href="../../d2/d4a/struct_name_entry.html#a9e00de235c01b34a5244f1c572968da5">back_num</a>++;
<a name="l00810"></a>00810   <span class="keywordflow">if</span> (e-&gt;<a class="code" href="../../d2/d4a/struct_name_entry.html#a9e00de235c01b34a5244f1c572968da5">back_num</a> == 1) {
<a name="l00811"></a>00811     e-&gt;<a class="code" href="../../d2/d4a/struct_name_entry.html#a8f22012701b3ce478b7b5a0caf644458">back_ref1</a> = backref;
<a name="l00812"></a>00812   }
<a name="l00813"></a>00813   <span class="keywordflow">else</span> {
<a name="l00814"></a>00814     <span class="keywordflow">if</span> (e-&gt;<a class="code" href="../../d2/d4a/struct_name_entry.html#a9e00de235c01b34a5244f1c572968da5">back_num</a> == 2) {
<a name="l00815"></a>00815       alloc = <a class="code" href="../../d6/dda/regparse_8c.html#a73058c78d5bed2705970b46662c39cf6">INIT_NAME_BACKREFS_ALLOC_NUM</a>;
<a name="l00816"></a>00816       e-&gt;<a class="code" href="../../d2/d4a/struct_name_entry.html#a5998d91dd61ffe28bbc7a97e83d527a0">back_refs</a> = (<span class="keywordtype">int</span>* )<a class="code" href="../../d8/db0/defines_8h.html#a6af5faec3f9662b20ffc9903f923dec0">xmalloc</a>(<span class="keyword">sizeof</span>(<span class="keywordtype">int</span>) * alloc);
<a name="l00817"></a>00817       <a class="code" href="../../d6/d87/regint_8h.html#a17ebb2a12300dcf6d79916e357fae45a">CHECK_NULL_RETURN_MEMERR</a>(e-&gt;<a class="code" href="../../d2/d4a/struct_name_entry.html#a5998d91dd61ffe28bbc7a97e83d527a0">back_refs</a>);
<a name="l00818"></a>00818       e-&gt;<a class="code" href="../../d2/d4a/struct_name_entry.html#a051ae235a19375475955c600cf0cb197">back_alloc</a> = alloc;
<a name="l00819"></a>00819       e-&gt;<a class="code" href="../../d2/d4a/struct_name_entry.html#a5998d91dd61ffe28bbc7a97e83d527a0">back_refs</a>[0] = e-&gt;<a class="code" href="../../d2/d4a/struct_name_entry.html#a8f22012701b3ce478b7b5a0caf644458">back_ref1</a>;
<a name="l00820"></a>00820       e-&gt;<a class="code" href="../../d2/d4a/struct_name_entry.html#a5998d91dd61ffe28bbc7a97e83d527a0">back_refs</a>[1] = backref;
<a name="l00821"></a>00821     }
<a name="l00822"></a>00822     <span class="keywordflow">else</span> {
<a name="l00823"></a>00823       <span class="keywordflow">if</span> (e-&gt;<a class="code" href="../../d2/d4a/struct_name_entry.html#a9e00de235c01b34a5244f1c572968da5">back_num</a> &gt; e-&gt;<a class="code" href="../../d2/d4a/struct_name_entry.html#a051ae235a19375475955c600cf0cb197">back_alloc</a>) {
<a name="l00824"></a>00824         alloc = e-&gt;<a class="code" href="../../d2/d4a/struct_name_entry.html#a051ae235a19375475955c600cf0cb197">back_alloc</a> * 2;
<a name="l00825"></a>00825         e-&gt;<a class="code" href="../../d2/d4a/struct_name_entry.html#a5998d91dd61ffe28bbc7a97e83d527a0">back_refs</a> = (<span class="keywordtype">int</span>* )<a class="code" href="../../d8/db0/defines_8h.html#a40740062faf2d95d4935112447c464ef">xrealloc</a>(e-&gt;<a class="code" href="../../d2/d4a/struct_name_entry.html#a5998d91dd61ffe28bbc7a97e83d527a0">back_refs</a>, <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>) * alloc);
<a name="l00826"></a>00826         <a class="code" href="../../d6/d87/regint_8h.html#a17ebb2a12300dcf6d79916e357fae45a">CHECK_NULL_RETURN_MEMERR</a>(e-&gt;<a class="code" href="../../d2/d4a/struct_name_entry.html#a5998d91dd61ffe28bbc7a97e83d527a0">back_refs</a>);
<a name="l00827"></a>00827         e-&gt;<a class="code" href="../../d2/d4a/struct_name_entry.html#a051ae235a19375475955c600cf0cb197">back_alloc</a> = alloc;
<a name="l00828"></a>00828       }
<a name="l00829"></a>00829       e-&gt;<a class="code" href="../../d2/d4a/struct_name_entry.html#a5998d91dd61ffe28bbc7a97e83d527a0">back_refs</a>[e-&gt;<a class="code" href="../../d2/d4a/struct_name_entry.html#a9e00de235c01b34a5244f1c572968da5">back_num</a> - 1] = backref;
<a name="l00830"></a>00830     }
<a name="l00831"></a>00831   }
<a name="l00832"></a>00832 
<a name="l00833"></a>00833   <span class="keywordflow">return</span> 0;
<a name="l00834"></a>00834 }
<a name="l00835"></a>00835 
<a name="l00836"></a>00836 <span class="keyword">extern</span> <span class="keywordtype">int</span>
<a name="l00837"></a><a class="code" href="../../d6/dda/regparse_8c.html#a083f9c0f9e54ad206e6464554876abe9">00837</a> <a class="code" href="../../d6/dda/regparse_8c.html#a083f9c0f9e54ad206e6464554876abe9">onig_name_to_group_numbers</a>(<a class="code" href="../../db/d0e/structre__pattern__buffer.html">regex_t</a>* reg, <span class="keyword">const</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>* name,
<a name="l00838"></a>00838                            <span class="keyword">const</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>* name_end, <span class="keywordtype">int</span>** nums)
<a name="l00839"></a>00839 {
<a name="l00840"></a>00840   <a class="code" href="../../d2/d4a/struct_name_entry.html">NameEntry</a>* e = <a class="code" href="../../d6/dda/regparse_8c.html#aeea88c6a5bae0d3d0aaee1ecc9368499">name_find</a>(reg, name, name_end);
<a name="l00841"></a>00841 
<a name="l00842"></a>00842   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d87/regint_8h.html#a91a9c9242dc3810582965d1882d1894d">IS_NULL</a>(e)) <span class="keywordflow">return</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#a6f16c9adf6c6e9e769b0ea84f9b32665">ONIGERR_UNDEFINED_NAME_REFERENCE</a>;
<a name="l00843"></a>00843 
<a name="l00844"></a>00844   <span class="keywordflow">switch</span> (e-&gt;<a class="code" href="../../d2/d4a/struct_name_entry.html#a9e00de235c01b34a5244f1c572968da5">back_num</a>) {
<a name="l00845"></a>00845   <span class="keywordflow">case</span> 0:
<a name="l00846"></a>00846     *nums = 0;
<a name="l00847"></a>00847     <span class="keywordflow">break</span>;
<a name="l00848"></a>00848   <span class="keywordflow">case</span> 1:
<a name="l00849"></a>00849     *nums = &amp;(e-&gt;<a class="code" href="../../d2/d4a/struct_name_entry.html#a8f22012701b3ce478b7b5a0caf644458">back_ref1</a>);
<a name="l00850"></a>00850     <span class="keywordflow">break</span>;
<a name="l00851"></a>00851   <span class="keywordflow">default</span>:
<a name="l00852"></a>00852     *nums = e-&gt;<a class="code" href="../../d2/d4a/struct_name_entry.html#a5998d91dd61ffe28bbc7a97e83d527a0">back_refs</a>;
<a name="l00853"></a>00853     <span class="keywordflow">break</span>;
<a name="l00854"></a>00854   }
<a name="l00855"></a>00855   <span class="keywordflow">return</span> e-&gt;<a class="code" href="../../d2/d4a/struct_name_entry.html#a9e00de235c01b34a5244f1c572968da5">back_num</a>;
<a name="l00856"></a>00856 }
<a name="l00857"></a>00857 
<a name="l00858"></a>00858 <span class="keyword">extern</span> <span class="keywordtype">int</span>
<a name="l00859"></a><a class="code" href="../../d6/dda/regparse_8c.html#a968ca31521878be3b5bff8a367eb17d2">00859</a> <a class="code" href="../../d6/dda/regparse_8c.html#a968ca31521878be3b5bff8a367eb17d2">onig_name_to_backref_number</a>(<a class="code" href="../../db/d0e/structre__pattern__buffer.html">regex_t</a>* reg, <span class="keyword">const</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>* name,
<a name="l00860"></a>00860                             <span class="keyword">const</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>* name_end, <a class="code" href="../../d6/d14/structre__registers.html">OnigRegion</a> *region)
<a name="l00861"></a>00861 {
<a name="l00862"></a>00862   <span class="keywordtype">int</span> i, n, *nums;
<a name="l00863"></a>00863 
<a name="l00864"></a>00864   n = <a class="code" href="../../d6/dda/regparse_8c.html#a083f9c0f9e54ad206e6464554876abe9">onig_name_to_group_numbers</a>(reg, name, name_end, &amp;nums);
<a name="l00865"></a>00865   <span class="keywordflow">if</span> (n &lt; 0)
<a name="l00866"></a>00866     <span class="keywordflow">return</span> n;
<a name="l00867"></a>00867   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (n == 0)
<a name="l00868"></a>00868     <span class="keywordflow">return</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#a4067ac325df2d4bb0b4d2e692c257a49">ONIGERR_PARSER_BUG</a>;
<a name="l00869"></a>00869   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (n == 1)
<a name="l00870"></a>00870     <span class="keywordflow">return</span> nums[0];
<a name="l00871"></a>00871   <span class="keywordflow">else</span> {
<a name="l00872"></a>00872     <span class="keywordflow">if</span> (<a class="code" href="../../d6/d87/regint_8h.html#a4bc25fbd4749a2c130d1ae7f15ba140c">IS_NOT_NULL</a>(region)) {
<a name="l00873"></a>00873       <span class="keywordflow">for</span> (i = n - 1; i &gt;= 0; i--) {
<a name="l00874"></a>00874         <span class="keywordflow">if</span> (region-&gt;<a class="code" href="../../d6/d14/structre__registers.html#a4eb5968ed5cce3e60715b734f86e0b70">beg</a>[nums[i]] != <a class="code" href="../../d8/db3/oniguruma_8h.html#a32fb9120f0365f1cc1fc570a10590371">ONIG_REGION_NOTPOS</a>)
<a name="l00875"></a>00875           <span class="keywordflow">return</span> nums[i];
<a name="l00876"></a>00876       }
<a name="l00877"></a>00877     }
<a name="l00878"></a>00878     <span class="keywordflow">return</span> nums[n - 1];
<a name="l00879"></a>00879   }
<a name="l00880"></a>00880 }
<a name="l00881"></a>00881 
<a name="l00882"></a>00882 <span class="preprocessor">#else </span><span class="comment">/* USE_NAMED_GROUP */</span>
<a name="l00883"></a>00883 
<a name="l00884"></a>00884 <span class="keyword">extern</span> <span class="keywordtype">int</span>
<a name="l00885"></a>00885 <a class="code" href="../../d6/dda/regparse_8c.html#a083f9c0f9e54ad206e6464554876abe9">onig_name_to_group_numbers</a>(<a class="code" href="../../db/d0e/structre__pattern__buffer.html">regex_t</a>* reg, <span class="keyword">const</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>* name,
<a name="l00886"></a>00886                            <span class="keyword">const</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>* name_end, <span class="keywordtype">int</span>** nums)
<a name="l00887"></a>00887 {
<a name="l00888"></a>00888   <span class="keywordflow">return</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#a15b7ec1aacde53c3328846512ede4f06">ONIG_NO_SUPPORT_CONFIG</a>;
<a name="l00889"></a>00889 }
<a name="l00890"></a>00890 
<a name="l00891"></a>00891 <span class="keyword">extern</span> <span class="keywordtype">int</span>
<a name="l00892"></a>00892 <a class="code" href="../../d6/dda/regparse_8c.html#a968ca31521878be3b5bff8a367eb17d2">onig_name_to_backref_number</a>(<a class="code" href="../../db/d0e/structre__pattern__buffer.html">regex_t</a>* reg, <span class="keyword">const</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>* name,
<a name="l00893"></a>00893                             <span class="keyword">const</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>* name_end, <a class="code" href="../../d6/d14/structre__registers.html">OnigRegion</a>* region)
<a name="l00894"></a>00894 {
<a name="l00895"></a>00895   <span class="keywordflow">return</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#a15b7ec1aacde53c3328846512ede4f06">ONIG_NO_SUPPORT_CONFIG</a>;
<a name="l00896"></a>00896 }
<a name="l00897"></a>00897 
<a name="l00898"></a>00898 <span class="keyword">extern</span> <span class="keywordtype">int</span>
<a name="l00899"></a>00899 <a class="code" href="../../d6/dda/regparse_8c.html#a0d72e0c285f5332420495848d355b173">onig_foreach_name</a>(<a class="code" href="../../db/d0e/structre__pattern__buffer.html">regex_t</a>* reg,
<a name="l00900"></a>00900   <span class="keywordtype">int</span> (*<a class="code" href="../../dc/dd1/ossl__ssl_8c.html#a131c09b7f9c9a0b52e6f79f651cfd574">func</a>)(<span class="keyword">const</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>*, <span class="keyword">const</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>*,<span class="keywordtype">int</span>,<span class="keywordtype">int</span>*,<a class="code" href="../../db/d0e/structre__pattern__buffer.html">regex_t</a>*,<span class="keywordtype">void</span>*), <span class="keywordtype">void</span>* arg)
<a name="l00901"></a>00901 {
<a name="l00902"></a>00902   <span class="keywordflow">return</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#a15b7ec1aacde53c3328846512ede4f06">ONIG_NO_SUPPORT_CONFIG</a>;
<a name="l00903"></a>00903 }
<a name="l00904"></a>00904 
<a name="l00905"></a>00905 <span class="keyword">extern</span> <span class="keywordtype">int</span>
<a name="l00906"></a>00906 <a class="code" href="../../d6/dda/regparse_8c.html#a7713de57637189f41a2d3de69050174e">onig_number_of_names</a>(<a class="code" href="../../db/d0e/structre__pattern__buffer.html">regex_t</a>* reg)
<a name="l00907"></a>00907 {
<a name="l00908"></a>00908   <span class="keywordflow">return</span> 0;
<a name="l00909"></a>00909 }
<a name="l00910"></a>00910 <span class="preprocessor">#endif </span><span class="comment">/* else USE_NAMED_GROUP */</span>
<a name="l00911"></a>00911 
<a name="l00912"></a>00912 <span class="keyword">extern</span> <span class="keywordtype">int</span>
<a name="l00913"></a><a class="code" href="../../d6/dda/regparse_8c.html#aaf863834e7999ad7c95afc91e0d3b838">00913</a> <a class="code" href="../../d6/dda/regparse_8c.html#aaf863834e7999ad7c95afc91e0d3b838">onig_noname_group_capture_is_active</a>(<a class="code" href="../../db/d0e/structre__pattern__buffer.html">regex_t</a>* reg)
<a name="l00914"></a>00914 {
<a name="l00915"></a>00915   <span class="keywordflow">if</span> (<a class="code" href="../../d8/db3/oniguruma_8h.html#a2ff7c691b88c0b43377bbe3f409b036a">ONIG_IS_OPTION_ON</a>(reg-&gt;<a class="code" href="../../db/d0e/structre__pattern__buffer.html#ae696111fa040a69294344d08baf062b4">options</a>, <a class="code" href="../../d8/db3/oniguruma_8h.html#a11bf0bcd0621c5ceb91d60d7c17103c7">ONIG_OPTION_DONT_CAPTURE_GROUP</a>))
<a name="l00916"></a>00916     <span class="keywordflow">return</span> 0;
<a name="l00917"></a>00917 
<a name="l00918"></a>00918 <span class="preprocessor">#ifdef USE_NAMED_GROUP</span>
<a name="l00919"></a>00919 <span class="preprocessor"></span>  <span class="keywordflow">if</span> (<a class="code" href="../../d6/dda/regparse_8c.html#a7713de57637189f41a2d3de69050174e">onig_number_of_names</a>(reg) &gt; 0 &amp;&amp;
<a name="l00920"></a>00920       <a class="code" href="../../d1/dfc/regparse_8h.html#a18bfc9ee154d6dd516347bd71b4810f6">IS_SYNTAX_BV</a>(reg-&gt;<a class="code" href="../../db/d0e/structre__pattern__buffer.html#a5b52ffc15e914d2414c4c13f94b776d2">syntax</a>, <a class="code" href="../../d8/db3/oniguruma_8h.html#aabffac0a9cf8aa6bda2d83997bbccd94">ONIG_SYN_CAPTURE_ONLY_NAMED_GROUP</a>) &amp;&amp;
<a name="l00921"></a>00921       !<a class="code" href="../../d8/db3/oniguruma_8h.html#a2ff7c691b88c0b43377bbe3f409b036a">ONIG_IS_OPTION_ON</a>(reg-&gt;<a class="code" href="../../db/d0e/structre__pattern__buffer.html#ae696111fa040a69294344d08baf062b4">options</a>, <a class="code" href="../../d8/db3/oniguruma_8h.html#a89a38e785fb1aa007945f4e5fabb6b3e">ONIG_OPTION_CAPTURE_GROUP</a>)) {
<a name="l00922"></a>00922     <span class="keywordflow">return</span> 0;
<a name="l00923"></a>00923   }
<a name="l00924"></a>00924 <span class="preprocessor">#endif</span>
<a name="l00925"></a>00925 <span class="preprocessor"></span>
<a name="l00926"></a>00926   <span class="keywordflow">return</span> 1;
<a name="l00927"></a>00927 }
<a name="l00928"></a>00928 
<a name="l00929"></a>00929 
<a name="l00930"></a><a class="code" href="../../d6/dda/regparse_8c.html#a2bf7f1ccb5841c7b06efe6427ae12175">00930</a> <span class="preprocessor">#define INIT_SCANENV_MEMNODES_ALLOC_SIZE   16</span>
<a name="l00931"></a>00931 <span class="preprocessor"></span>
<a name="l00932"></a>00932 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00933"></a><a class="code" href="../../d6/dda/regparse_8c.html#a178bdeffafbd3fe240bba6c12acfa5f1">00933</a> <a class="code" href="../../d6/dda/regparse_8c.html#a178bdeffafbd3fe240bba6c12acfa5f1">scan_env_clear</a>(<a class="code" href="../../d6/dbe/struct_scan_env.html">ScanEnv</a>* env)
<a name="l00934"></a>00934 {
<a name="l00935"></a>00935   <span class="keywordtype">int</span> i;
<a name="l00936"></a>00936 
<a name="l00937"></a>00937   <a class="code" href="../../d6/d87/regint_8h.html#ad11894263900a119660d7d44b289aab1">BIT_STATUS_CLEAR</a>(env-&gt;<a class="code" href="../../d6/dbe/struct_scan_env.html#aa096c240d283344fe4dd0626ac52e9ba">capture_history</a>);
<a name="l00938"></a>00938   <a class="code" href="../../d6/d87/regint_8h.html#ad11894263900a119660d7d44b289aab1">BIT_STATUS_CLEAR</a>(env-&gt;<a class="code" href="../../d6/dbe/struct_scan_env.html#a5ae5ce2ec7e6fe61e234fa4fd05ee1e4">bt_mem_start</a>);
<a name="l00939"></a>00939   <a class="code" href="../../d6/d87/regint_8h.html#ad11894263900a119660d7d44b289aab1">BIT_STATUS_CLEAR</a>(env-&gt;<a class="code" href="../../d6/dbe/struct_scan_env.html#a11a89b745f9dac826110ee1671ca0edd">bt_mem_end</a>);
<a name="l00940"></a>00940   <a class="code" href="../../d6/d87/regint_8h.html#ad11894263900a119660d7d44b289aab1">BIT_STATUS_CLEAR</a>(env-&gt;<a class="code" href="../../d6/dbe/struct_scan_env.html#a88f3a0da2aa91b57436970ef7aa062f6">backrefed_mem</a>);
<a name="l00941"></a>00941   env-&gt;<a class="code" href="../../d6/dbe/struct_scan_env.html#a0b7bcb0b7b0237b6e29edf1a46a37c7f">error</a>      = (<a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>* )<a class="code" href="../../d3/d09/ripper_8y.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00942"></a>00942   env-&gt;<a class="code" href="../../d6/dbe/struct_scan_env.html#a690ca18c42c8090f932ffa64f38ad1a9">error_end</a>  = (<a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>* )<a class="code" href="../../d3/d09/ripper_8y.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00943"></a>00943   env-&gt;<a class="code" href="../../d6/dbe/struct_scan_env.html#a142c4ecdf5da898c594bc1a4e44c3d56">num_call</a>   = 0;
<a name="l00944"></a>00944   env-&gt;<a class="code" href="../../d6/dbe/struct_scan_env.html#a5f71c0a538e047bc63962df55ff304b0">num_mem</a>    = 0;
<a name="l00945"></a>00945 <span class="preprocessor">#ifdef USE_NAMED_GROUP</span>
<a name="l00946"></a>00946 <span class="preprocessor"></span>  env-&gt;<a class="code" href="../../d6/dbe/struct_scan_env.html#a6631d9427686a047869c75049f0d6c02">num_named</a>  = 0;
<a name="l00947"></a>00947 <span class="preprocessor">#endif</span>
<a name="l00948"></a>00948 <span class="preprocessor"></span>  env-&gt;<a class="code" href="../../d6/dbe/struct_scan_env.html#a1b33d2c6358d1d9340f021de7cabc851">mem_alloc</a>         = 0;
<a name="l00949"></a>00949   env-&gt;<a class="code" href="../../d6/dbe/struct_scan_env.html#a30ed89b85be2facc439996abf09ebb46">mem_nodes_dynamic</a> = (<a class="code" href="../../d0/d6e/struct___node.html">Node</a>** )<a class="code" href="../../d3/d09/ripper_8y.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00950"></a>00950 
<a name="l00951"></a>00951   <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="../../d1/dfc/regparse_8h.html#ae4cc7b2a733830bc255401582bbb6dfc">SCANENV_MEMNODES_SIZE</a>; i++)
<a name="l00952"></a>00952     env-&gt;<a class="code" href="../../d6/dbe/struct_scan_env.html#a500bfa94c8d7bcf92cb8770316d57493">mem_nodes_static</a>[i] = <a class="code" href="../../d3/d7f/gram_8c.html#ac00d2982d51115efbe8a13840d47b7a7">NULL_NODE</a>;
<a name="l00953"></a>00953 
<a name="l00954"></a>00954 #ifdef USE_COMBINATION_EXPLOSION_CHECK
<a name="l00955"></a>00955   env-&gt;num_comb_exp_check  = 0;
<a name="l00956"></a>00956   env-&gt;comb_exp_max_regnum = 0;
<a name="l00957"></a>00957   env-&gt;curr_max_regnum     = 0;
<a name="l00958"></a>00958   env-&gt;has_recursion       = 0;
<a name="l00959"></a>00959 #endif
<a name="l00960"></a>00960   env-&gt;<a class="code" href="../../d6/dbe/struct_scan_env.html#ae843e651e7e50b4f8e82ccd50c311d36">warnings_flag</a>       = 0;
<a name="l00961"></a>00961 }
<a name="l00962"></a>00962 
<a name="l00963"></a>00963 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l00964"></a><a class="code" href="../../d6/dda/regparse_8c.html#a3e5e1df9342133d21ffc0e237a6dbc70">00964</a> <a class="code" href="../../d6/dda/regparse_8c.html#a3e5e1df9342133d21ffc0e237a6dbc70">scan_env_add_mem_entry</a>(<a class="code" href="../../d6/dbe/struct_scan_env.html">ScanEnv</a>* env)
<a name="l00965"></a>00965 {
<a name="l00966"></a>00966   <span class="keywordtype">int</span> i, need, <a class="code" href="../../d4/d71/st_8c.html#a385b96996caa48e6349681cf8036322f">alloc</a>;
<a name="l00967"></a>00967   <a class="code" href="../../d0/d6e/struct___node.html">Node</a>** p;
<a name="l00968"></a>00968 
<a name="l00969"></a>00969   need = env-&gt;<a class="code" href="../../d6/dbe/struct_scan_env.html#a5f71c0a538e047bc63962df55ff304b0">num_mem</a> + 1;
<a name="l00970"></a>00970   <span class="keywordflow">if</span> (need &gt;= <a class="code" href="../../d1/dfc/regparse_8h.html#ae4cc7b2a733830bc255401582bbb6dfc">SCANENV_MEMNODES_SIZE</a>) {
<a name="l00971"></a>00971     <span class="keywordflow">if</span> (env-&gt;<a class="code" href="../../d6/dbe/struct_scan_env.html#a1b33d2c6358d1d9340f021de7cabc851">mem_alloc</a> &lt;= need) {
<a name="l00972"></a>00972       <span class="keywordflow">if</span> (<a class="code" href="../../d6/d87/regint_8h.html#a91a9c9242dc3810582965d1882d1894d">IS_NULL</a>(env-&gt;<a class="code" href="../../d6/dbe/struct_scan_env.html#a30ed89b85be2facc439996abf09ebb46">mem_nodes_dynamic</a>)) {
<a name="l00973"></a>00973         alloc = <a class="code" href="../../d6/dda/regparse_8c.html#a2bf7f1ccb5841c7b06efe6427ae12175">INIT_SCANENV_MEMNODES_ALLOC_SIZE</a>;
<a name="l00974"></a>00974         p = (<a class="code" href="../../d0/d6e/struct___node.html">Node</a>** )<a class="code" href="../../d8/db0/defines_8h.html#a6af5faec3f9662b20ffc9903f923dec0">xmalloc</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../d0/d6e/struct___node.html">Node</a>*) * alloc);
<a name="l00975"></a>00975         <a class="code" href="../../d6/d87/regint_8h.html#ad9f94f6a1ee2c69b34d8034684b31518">xmemcpy</a>(p, env-&gt;<a class="code" href="../../d6/dbe/struct_scan_env.html#a500bfa94c8d7bcf92cb8770316d57493">mem_nodes_static</a>,
<a name="l00976"></a>00976                 <span class="keyword">sizeof</span>(<a class="code" href="../../d0/d6e/struct___node.html">Node</a>*) * <a class="code" href="../../d1/dfc/regparse_8h.html#ae4cc7b2a733830bc255401582bbb6dfc">SCANENV_MEMNODES_SIZE</a>);
<a name="l00977"></a>00977       }
<a name="l00978"></a>00978       <span class="keywordflow">else</span> {
<a name="l00979"></a>00979         alloc = env-&gt;<a class="code" href="../../d6/dbe/struct_scan_env.html#a1b33d2c6358d1d9340f021de7cabc851">mem_alloc</a> * 2;
<a name="l00980"></a>00980         p = (<a class="code" href="../../d0/d6e/struct___node.html">Node</a>** )<a class="code" href="../../d8/db0/defines_8h.html#a40740062faf2d95d4935112447c464ef">xrealloc</a>(env-&gt;<a class="code" href="../../d6/dbe/struct_scan_env.html#a30ed89b85be2facc439996abf09ebb46">mem_nodes_dynamic</a>, <span class="keyword">sizeof</span>(<a class="code" href="../../d0/d6e/struct___node.html">Node</a>*) * alloc);
<a name="l00981"></a>00981       }
<a name="l00982"></a>00982       <a class="code" href="../../d6/d87/regint_8h.html#a17ebb2a12300dcf6d79916e357fae45a">CHECK_NULL_RETURN_MEMERR</a>(p);
<a name="l00983"></a>00983 
<a name="l00984"></a>00984       <span class="keywordflow">for</span> (i = env-&gt;<a class="code" href="../../d6/dbe/struct_scan_env.html#a5f71c0a538e047bc63962df55ff304b0">num_mem</a> + 1; i &lt; alloc; i++)
<a name="l00985"></a>00985         p[i] = <a class="code" href="../../d3/d7f/gram_8c.html#ac00d2982d51115efbe8a13840d47b7a7">NULL_NODE</a>;
<a name="l00986"></a>00986 
<a name="l00987"></a>00987       env-&gt;<a class="code" href="../../d6/dbe/struct_scan_env.html#a30ed89b85be2facc439996abf09ebb46">mem_nodes_dynamic</a> = p;
<a name="l00988"></a>00988       env-&gt;<a class="code" href="../../d6/dbe/struct_scan_env.html#a1b33d2c6358d1d9340f021de7cabc851">mem_alloc</a> = alloc;
<a name="l00989"></a>00989     }
<a name="l00990"></a>00990   }
<a name="l00991"></a>00991 
<a name="l00992"></a>00992   env-&gt;<a class="code" href="../../d6/dbe/struct_scan_env.html#a5f71c0a538e047bc63962df55ff304b0">num_mem</a>++;
<a name="l00993"></a>00993   <span class="keywordflow">return</span> env-&gt;<a class="code" href="../../d6/dbe/struct_scan_env.html#a5f71c0a538e047bc63962df55ff304b0">num_mem</a>;
<a name="l00994"></a>00994 }
<a name="l00995"></a>00995 
<a name="l00996"></a>00996 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l00997"></a><a class="code" href="../../d6/dda/regparse_8c.html#aebbe7e869e902b29a5a9867fd47c9c1f">00997</a> <a class="code" href="../../d6/dda/regparse_8c.html#aebbe7e869e902b29a5a9867fd47c9c1f">scan_env_set_mem_node</a>(<a class="code" href="../../d6/dbe/struct_scan_env.html">ScanEnv</a>* env, <span class="keywordtype">int</span> num, <a class="code" href="../../d0/d6e/struct___node.html">Node</a>* <a class="code" href="../../d7/dc0/parse_8y.html#a0d7af8a92c4b0a07f71585584ef9634f">node</a>)
<a name="l00998"></a>00998 {
<a name="l00999"></a>00999   <span class="keywordflow">if</span> (env-&gt;<a class="code" href="../../d6/dbe/struct_scan_env.html#a5f71c0a538e047bc63962df55ff304b0">num_mem</a> &gt;= num)
<a name="l01000"></a>01000     <a class="code" href="../../d1/dfc/regparse_8h.html#a82066fdd1d2abdcc23ae01f55bfbe321">SCANENV_MEM_NODES</a>(env)[num] = node;
<a name="l01001"></a>01001   <span class="keywordflow">else</span>
<a name="l01002"></a>01002     <span class="keywordflow">return</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#a4067ac325df2d4bb0b4d2e692c257a49">ONIGERR_PARSER_BUG</a>;
<a name="l01003"></a>01003   <span class="keywordflow">return</span> 0;
<a name="l01004"></a>01004 }
<a name="l01005"></a>01005 
<a name="l01006"></a>01006 
<a name="l01007"></a>01007 <span class="preprocessor">#ifdef USE_PARSE_TREE_NODE_RECYCLE</span>
<a name="l01008"></a><a class="code" href="../../d5/def/struct___free_node.html">01008</a> <span class="preprocessor"></span><span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d5/def/struct___free_node.html">_FreeNode</a> {
<a name="l01009"></a><a class="code" href="../../d5/def/struct___free_node.html#accde1e7919729d7d09145b7a05302bf6">01009</a>   <span class="keyword">struct </span><a class="code" href="../../d5/def/struct___free_node.html">_FreeNode</a>* <a class="code" href="../../d5/def/struct___free_node.html#accde1e7919729d7d09145b7a05302bf6">next</a>;
<a name="l01010"></a>01010 } <a class="code" href="../../d5/def/struct___free_node.html">FreeNode</a>;
<a name="l01011"></a>01011 
<a name="l01012"></a><a class="code" href="../../d6/dda/regparse_8c.html#a0966dd5154e67826555af4c1e0b9ff37">01012</a> <span class="keyword">static</span> <a class="code" href="../../d5/def/struct___free_node.html">FreeNode</a>* <a class="code" href="../../d6/dda/regparse_8c.html#a0966dd5154e67826555af4c1e0b9ff37">FreeNodeList</a> = (<a class="code" href="../../d5/def/struct___free_node.html">FreeNode</a>* )NULL;
<a name="l01013"></a>01013 <span class="preprocessor">#endif</span>
<a name="l01014"></a>01014 <span class="preprocessor"></span>
<a name="l01015"></a>01015 <span class="keyword">extern</span> <span class="keywordtype">void</span>
<a name="l01016"></a><a class="code" href="../../d6/dda/regparse_8c.html#aa98ee34de192fd4997906389f70f4808">01016</a> <a class="code" href="../../d6/dda/regparse_8c.html#aa98ee34de192fd4997906389f70f4808">onig_node_free</a>(<a class="code" href="../../d0/d6e/struct___node.html">Node</a>* <a class="code" href="../../d7/dc0/parse_8y.html#a0d7af8a92c4b0a07f71585584ef9634f">node</a>)
<a name="l01017"></a>01017 {
<a name="l01018"></a>01018  start:
<a name="l01019"></a>01019   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d87/regint_8h.html#a91a9c9242dc3810582965d1882d1894d">IS_NULL</a>(node)) return ;
<a name="l01020"></a>01020 
<a name="l01021"></a>01021   <span class="keywordflow">switch</span> (<a class="code" href="../../d1/dfc/regparse_8h.html#ad500a736993c4ddc933ff93b42eeb1e5">NTYPE</a>(node)) {
<a name="l01022"></a>01022   <span class="keywordflow">case</span> <a class="code" href="../../d1/dfc/regparse_8h.html#ad5d1aafda0801d24b9425f6c01515ed9">NT_STR</a>:
<a name="l01023"></a>01023     <span class="keywordflow">if</span> (<a class="code" href="../../d1/dfc/regparse_8h.html#a24a4b2af18dda01ae000ec64129eb50e">NSTR</a>(node)-&gt;capa != 0 &amp;&amp;
<a name="l01024"></a>01024         <a class="code" href="../../d6/d87/regint_8h.html#a4bc25fbd4749a2c130d1ae7f15ba140c">IS_NOT_NULL</a>(<a class="code" href="../../d1/dfc/regparse_8h.html#a24a4b2af18dda01ae000ec64129eb50e">NSTR</a>(node)-&gt;s) &amp;&amp; <a class="code" href="../../d1/dfc/regparse_8h.html#a24a4b2af18dda01ae000ec64129eb50e">NSTR</a>(node)-&gt;s != <a class="code" href="../../d1/dfc/regparse_8h.html#a24a4b2af18dda01ae000ec64129eb50e">NSTR</a>(node)-&gt;<a class="code" href="../../d6/da0/nkf-utf8_2nkf_8c.html#ac37f17a60c8b5533aac4840c681f62b8">buf</a>) {
<a name="l01025"></a>01025       <a class="code" href="../../d8/db0/defines_8h.html#a2c3897f7c46ca54a2e0dd7b24a40c7cb">xfree</a>(<a class="code" href="../../d1/dfc/regparse_8h.html#a24a4b2af18dda01ae000ec64129eb50e">NSTR</a>(node)-&gt;s);
<a name="l01026"></a>01026     }
<a name="l01027"></a>01027     <span class="keywordflow">break</span>;
<a name="l01028"></a>01028 
<a name="l01029"></a>01029   <span class="keywordflow">case</span> <a class="code" href="../../d1/dfc/regparse_8h.html#aba3b5392b65c7a886251ccb7bdf93cf0">NT_LIST</a>:
<a name="l01030"></a>01030   <span class="keywordflow">case</span> <a class="code" href="../../d1/dfc/regparse_8h.html#ae71a11e8c4757331e146c7c055c28294">NT_ALT</a>:
<a name="l01031"></a>01031     <a class="code" href="../../d6/dda/regparse_8c.html#aa98ee34de192fd4997906389f70f4808">onig_node_free</a>(<a class="code" href="../../d1/dfc/regparse_8h.html#ace12d76fd705497f81e4e2cd95cd247e">NCAR</a>(node));
<a name="l01032"></a>01032     {
<a name="l01033"></a>01033       <a class="code" href="../../d0/d6e/struct___node.html">Node</a>* next_node = <a class="code" href="../../d1/dfc/regparse_8h.html#ac3a01065a5b7f17aad984671c730739e">NCDR</a>(node);
<a name="l01034"></a>01034 
<a name="l01035"></a>01035 <span class="preprocessor">#ifdef USE_PARSE_TREE_NODE_RECYCLE</span>
<a name="l01036"></a>01036 <span class="preprocessor"></span>      {
<a name="l01037"></a>01037         <a class="code" href="../../d5/def/struct___free_node.html">FreeNode</a>* n = (<a class="code" href="../../d5/def/struct___free_node.html">FreeNode</a>* )node;
<a name="l01038"></a>01038 
<a name="l01039"></a>01039         <a class="code" href="../../d6/d87/regint_8h.html#a89044129ef788a94169add8be849e66b">THREAD_ATOMIC_START</a>;
<a name="l01040"></a>01040         n-&gt;<a class="code" href="../../d5/def/struct___free_node.html#accde1e7919729d7d09145b7a05302bf6">next</a> = FreeNodeList;
<a name="l01041"></a>01041         FreeNodeList = n;
<a name="l01042"></a>01042         <a class="code" href="../../d6/d87/regint_8h.html#a88a1ea7a04c3da104c4ef1ff6444b3ae">THREAD_ATOMIC_END</a>;
<a name="l01043"></a>01043       }
<a name="l01044"></a>01044 <span class="preprocessor">#else</span>
<a name="l01045"></a>01045 <span class="preprocessor"></span>      <a class="code" href="../../d8/db0/defines_8h.html#a2c3897f7c46ca54a2e0dd7b24a40c7cb">xfree</a>(node);
<a name="l01046"></a>01046 <span class="preprocessor">#endif</span>
<a name="l01047"></a>01047 <span class="preprocessor"></span>      node = next_node;
<a name="l01048"></a>01048       <span class="keywordflow">goto</span> start;
<a name="l01049"></a>01049     }
<a name="l01050"></a>01050     <span class="keywordflow">break</span>;
<a name="l01051"></a>01051 
<a name="l01052"></a>01052   <span class="keywordflow">case</span> <a class="code" href="../../d1/dfc/regparse_8h.html#a98cbe6da0636f892e4de517d350a2938">NT_CCLASS</a>:
<a name="l01053"></a>01053     {
<a name="l01054"></a>01054       <a class="code" href="../../d8/d79/struct_c_class_node.html">CClassNode</a>* cc = <a class="code" href="../../d1/dfc/regparse_8h.html#a816a6d8f921892c2efef73eb7727d589">NCCLASS</a>(node);
<a name="l01055"></a>01055 
<a name="l01056"></a>01056       <span class="keywordflow">if</span> (<a class="code" href="../../d6/d87/regint_8h.html#aae98a751e33d47e8617c92b24403ed96">IS_NCCLASS_SHARE</a>(cc)) return ;
<a name="l01057"></a>01057       <span class="keywordflow">if</span> (cc-&gt;<a class="code" href="../../d8/d79/struct_c_class_node.html#a599db43b8eea536a4e4d08400fa445cb">mbuf</a>)
<a name="l01058"></a>01058         <a class="code" href="../../d6/dda/regparse_8c.html#ac57154f90d1120d13c794cb9ba3cdba2">bbuf_free</a>(cc-&gt;<a class="code" href="../../d8/d79/struct_c_class_node.html#a599db43b8eea536a4e4d08400fa445cb">mbuf</a>);
<a name="l01059"></a>01059     }
<a name="l01060"></a>01060     <span class="keywordflow">break</span>;
<a name="l01061"></a>01061 
<a name="l01062"></a>01062   <span class="keywordflow">case</span> <a class="code" href="../../d1/dfc/regparse_8h.html#a307b2dd57583d60d4d89eae6478b69ab">NT_QTFR</a>:
<a name="l01063"></a>01063     <span class="keywordflow">if</span> (<a class="code" href="../../d1/dfc/regparse_8h.html#addc653094848075876587782124e9504">NQTFR</a>(node)-&gt;target)
<a name="l01064"></a>01064       <a class="code" href="../../d6/dda/regparse_8c.html#aa98ee34de192fd4997906389f70f4808">onig_node_free</a>(<a class="code" href="../../d1/dfc/regparse_8h.html#addc653094848075876587782124e9504">NQTFR</a>(node)-&gt;target);
<a name="l01065"></a>01065     <span class="keywordflow">break</span>;
<a name="l01066"></a>01066 
<a name="l01067"></a>01067   <span class="keywordflow">case</span> <a class="code" href="../../d1/dfc/regparse_8h.html#a28d3349039b07e17b82e258cd8f73897">NT_ENCLOSE</a>:
<a name="l01068"></a>01068     <span class="keywordflow">if</span> (<a class="code" href="../../d1/dfc/regparse_8h.html#a2fea29a34640f28158788eef43a9bfd2">NENCLOSE</a>(node)-&gt;target)
<a name="l01069"></a>01069       <a class="code" href="../../d6/dda/regparse_8c.html#aa98ee34de192fd4997906389f70f4808">onig_node_free</a>(<a class="code" href="../../d1/dfc/regparse_8h.html#a2fea29a34640f28158788eef43a9bfd2">NENCLOSE</a>(node)-&gt;target);
<a name="l01070"></a>01070     <span class="keywordflow">break</span>;
<a name="l01071"></a>01071 
<a name="l01072"></a>01072   <span class="keywordflow">case</span> <a class="code" href="../../d1/dfc/regparse_8h.html#ac1d2a54cfe6dfa9104b4bfb8d06b8aeb">NT_BREF</a>:
<a name="l01073"></a>01073     <span class="keywordflow">if</span> (<a class="code" href="../../d6/d87/regint_8h.html#a4bc25fbd4749a2c130d1ae7f15ba140c">IS_NOT_NULL</a>(<a class="code" href="../../d1/dfc/regparse_8h.html#a38215823f6ab7e63e919eae3bfa79bfa">NBREF</a>(node)-&gt;back_dynamic))
<a name="l01074"></a>01074       <a class="code" href="../../d8/db0/defines_8h.html#a2c3897f7c46ca54a2e0dd7b24a40c7cb">xfree</a>(<a class="code" href="../../d1/dfc/regparse_8h.html#a38215823f6ab7e63e919eae3bfa79bfa">NBREF</a>(node)-&gt;back_dynamic);
<a name="l01075"></a>01075     <span class="keywordflow">break</span>;
<a name="l01076"></a>01076 
<a name="l01077"></a>01077   <span class="keywordflow">case</span> <a class="code" href="../../d1/dfc/regparse_8h.html#a4169804cb78eccf494a7f72ae737be32">NT_ANCHOR</a>:
<a name="l01078"></a>01078     <span class="keywordflow">if</span> (<a class="code" href="../../d1/dfc/regparse_8h.html#aff69a39d6dfe87d4eb079758e46cb226">NANCHOR</a>(node)-&gt;target)
<a name="l01079"></a>01079       <a class="code" href="../../d6/dda/regparse_8c.html#aa98ee34de192fd4997906389f70f4808">onig_node_free</a>(<a class="code" href="../../d1/dfc/regparse_8h.html#aff69a39d6dfe87d4eb079758e46cb226">NANCHOR</a>(node)-&gt;target);
<a name="l01080"></a>01080     <span class="keywordflow">break</span>;
<a name="l01081"></a>01081   }
<a name="l01082"></a>01082 
<a name="l01083"></a>01083 <span class="preprocessor">#ifdef USE_PARSE_TREE_NODE_RECYCLE</span>
<a name="l01084"></a>01084 <span class="preprocessor"></span>  {
<a name="l01085"></a>01085     <a class="code" href="../../d5/def/struct___free_node.html">FreeNode</a>* n = (<a class="code" href="../../d5/def/struct___free_node.html">FreeNode</a>* )node;
<a name="l01086"></a>01086 
<a name="l01087"></a>01087     <a class="code" href="../../d6/d87/regint_8h.html#a89044129ef788a94169add8be849e66b">THREAD_ATOMIC_START</a>;
<a name="l01088"></a>01088     n-&gt;<a class="code" href="../../d5/def/struct___free_node.html#accde1e7919729d7d09145b7a05302bf6">next</a> = FreeNodeList;
<a name="l01089"></a>01089     FreeNodeList = n;
<a name="l01090"></a>01090     <a class="code" href="../../d6/d87/regint_8h.html#a88a1ea7a04c3da104c4ef1ff6444b3ae">THREAD_ATOMIC_END</a>;
<a name="l01091"></a>01091   }
<a name="l01092"></a>01092 <span class="preprocessor">#else</span>
<a name="l01093"></a>01093 <span class="preprocessor"></span>  <a class="code" href="../../d8/db0/defines_8h.html#a2c3897f7c46ca54a2e0dd7b24a40c7cb">xfree</a>(node);
<a name="l01094"></a>01094 <span class="preprocessor">#endif</span>
<a name="l01095"></a>01095 <span class="preprocessor"></span>}
<a name="l01096"></a>01096 
<a name="l01097"></a>01097 <span class="preprocessor">#ifdef USE_PARSE_TREE_NODE_RECYCLE</span>
<a name="l01098"></a>01098 <span class="preprocessor"></span><span class="keyword">extern</span> <span class="keywordtype">int</span>
<a name="l01099"></a><a class="code" href="../../d6/dda/regparse_8c.html#a45a1441ea27d1a056a374542fb962495">01099</a> <a class="code" href="../../d6/dda/regparse_8c.html#a45a1441ea27d1a056a374542fb962495">onig_free_node_list</a>(<span class="keywordtype">void</span>)
<a name="l01100"></a>01100 {
<a name="l01101"></a>01101   <a class="code" href="../../d5/def/struct___free_node.html">FreeNode</a>* n;
<a name="l01102"></a>01102 
<a name="l01103"></a>01103   <span class="comment">/* THREAD_ATOMIC_START; */</span>
<a name="l01104"></a>01104   <span class="keywordflow">while</span> (<a class="code" href="../../d6/d87/regint_8h.html#a4bc25fbd4749a2c130d1ae7f15ba140c">IS_NOT_NULL</a>(FreeNodeList)) {
<a name="l01105"></a>01105     n = FreeNodeList;
<a name="l01106"></a>01106     FreeNodeList = FreeNodeList-&gt;<a class="code" href="../../d5/def/struct___free_node.html#accde1e7919729d7d09145b7a05302bf6">next</a>;
<a name="l01107"></a>01107     <a class="code" href="../../d8/db0/defines_8h.html#a2c3897f7c46ca54a2e0dd7b24a40c7cb">xfree</a>(n);
<a name="l01108"></a>01108   }
<a name="l01109"></a>01109   <span class="comment">/* THREAD_ATOMIC_END; */</span>
<a name="l01110"></a>01110   <span class="keywordflow">return</span> 0;
<a name="l01111"></a>01111 }
<a name="l01112"></a>01112 <span class="preprocessor">#endif</span>
<a name="l01113"></a>01113 <span class="preprocessor"></span>
<a name="l01114"></a>01114 <span class="keyword">static</span> <a class="code" href="../../d0/d6e/struct___node.html">Node</a>*
<a name="l01115"></a><a class="code" href="../../d6/dda/regparse_8c.html#a0dd497b9e45c03476d0a453d1987499c">01115</a> <a class="code" href="../../d6/dda/regparse_8c.html#a0dd497b9e45c03476d0a453d1987499c">node_new</a>(<span class="keywordtype">void</span>)
<a name="l01116"></a>01116 {
<a name="l01117"></a>01117   <a class="code" href="../../d0/d6e/struct___node.html">Node</a>* <a class="code" href="../../d7/dc0/parse_8y.html#a0d7af8a92c4b0a07f71585584ef9634f">node</a>;
<a name="l01118"></a>01118 
<a name="l01119"></a>01119 <span class="preprocessor">#ifdef USE_PARSE_TREE_NODE_RECYCLE</span>
<a name="l01120"></a>01120 <span class="preprocessor"></span>  <a class="code" href="../../d6/d87/regint_8h.html#a89044129ef788a94169add8be849e66b">THREAD_ATOMIC_START</a>;
<a name="l01121"></a>01121   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d87/regint_8h.html#a4bc25fbd4749a2c130d1ae7f15ba140c">IS_NOT_NULL</a>(FreeNodeList)) {
<a name="l01122"></a>01122     node = (<a class="code" href="../../d0/d6e/struct___node.html">Node</a>* )FreeNodeList;
<a name="l01123"></a>01123     FreeNodeList = FreeNodeList-&gt;<a class="code" href="../../d5/def/struct___free_node.html#accde1e7919729d7d09145b7a05302bf6">next</a>;
<a name="l01124"></a>01124     <a class="code" href="../../d6/d87/regint_8h.html#a88a1ea7a04c3da104c4ef1ff6444b3ae">THREAD_ATOMIC_END</a>;
<a name="l01125"></a>01125     <span class="keywordflow">return</span> node;
<a name="l01126"></a>01126   }
<a name="l01127"></a>01127   <a class="code" href="../../d6/d87/regint_8h.html#a88a1ea7a04c3da104c4ef1ff6444b3ae">THREAD_ATOMIC_END</a>;
<a name="l01128"></a>01128 <span class="preprocessor">#endif</span>
<a name="l01129"></a>01129 <span class="preprocessor"></span>
<a name="l01130"></a>01130   node = (<a class="code" href="../../d0/d6e/struct___node.html">Node</a>* )<a class="code" href="../../d8/db0/defines_8h.html#a6af5faec3f9662b20ffc9903f923dec0">xmalloc</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../d0/d6e/struct___node.html">Node</a>));
<a name="l01131"></a>01131   <span class="comment">/* xmemset(node, 0, sizeof(Node)); */</span>
<a name="l01132"></a>01132   <span class="keywordflow">return</span> node;
<a name="l01133"></a>01133 }
<a name="l01134"></a>01134 
<a name="l01135"></a>01135 
<a name="l01136"></a>01136 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l01137"></a><a class="code" href="../../d6/dda/regparse_8c.html#a3d9da551e4e10f925f1fc487fce34896">01137</a> <a class="code" href="../../d6/dda/regparse_8c.html#a3d9da551e4e10f925f1fc487fce34896">initialize_cclass</a>(<a class="code" href="../../d8/d79/struct_c_class_node.html">CClassNode</a>* cc)
<a name="l01138"></a>01138 {
<a name="l01139"></a>01139   <a class="code" href="../../d6/d87/regint_8h.html#ad4f9291fce24228d0ff2c9493788506f">BITSET_CLEAR</a>(cc-&gt;<a class="code" href="../../d8/d79/struct_c_class_node.html#a082458e56c928f78db90f08e242a9f3d">bs</a>);
<a name="l01140"></a>01140   <span class="comment">/* cc-&gt;base.flags = 0; */</span>
<a name="l01141"></a>01141   cc-&gt;<a class="code" href="../../d8/d79/struct_c_class_node.html#a379f0fa5c89a148067f293031d314c39">flags</a> = 0;
<a name="l01142"></a>01142   cc-&gt;<a class="code" href="../../d8/d79/struct_c_class_node.html#a599db43b8eea536a4e4d08400fa445cb">mbuf</a>  = <a class="code" href="../../d3/d09/ripper_8y.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01143"></a>01143 }
<a name="l01144"></a>01144 
<a name="l01145"></a>01145 <span class="keyword">static</span> <a class="code" href="../../d0/d6e/struct___node.html">Node</a>*
<a name="l01146"></a><a class="code" href="../../d6/dda/regparse_8c.html#afd60d28ead746c5b464b5a114d8960f1">01146</a> <a class="code" href="../../d6/dda/regparse_8c.html#afd60d28ead746c5b464b5a114d8960f1">node_new_cclass</a>(<span class="keywordtype">void</span>)
<a name="l01147"></a>01147 {
<a name="l01148"></a>01148   <a class="code" href="../../d0/d6e/struct___node.html">Node</a>* <a class="code" href="../../d7/dc0/parse_8y.html#a0d7af8a92c4b0a07f71585584ef9634f">node</a> = <a class="code" href="../../d6/dda/regparse_8c.html#a0dd497b9e45c03476d0a453d1987499c">node_new</a>();
<a name="l01149"></a>01149   <a class="code" href="../../d6/d87/regint_8h.html#a44eb2d3a10149e1d94651052bcdcb2bb">CHECK_NULL_RETURN</a>(node);
<a name="l01150"></a>01150 
<a name="l01151"></a>01151   <a class="code" href="../../d1/dfc/regparse_8h.html#aa63b31f6718866f81a7efd9263270f82">SET_NTYPE</a>(node, <a class="code" href="../../d1/dfc/regparse_8h.html#a98cbe6da0636f892e4de517d350a2938">NT_CCLASS</a>);
<a name="l01152"></a>01152   <a class="code" href="../../d6/dda/regparse_8c.html#a3d9da551e4e10f925f1fc487fce34896">initialize_cclass</a>(<a class="code" href="../../d1/dfc/regparse_8h.html#a816a6d8f921892c2efef73eb7727d589">NCCLASS</a>(node));
<a name="l01153"></a>01153   <span class="keywordflow">return</span> node;
<a name="l01154"></a>01154 }
<a name="l01155"></a>01155 
<a name="l01156"></a>01156 <span class="keyword">static</span> <a class="code" href="../../d0/d6e/struct___node.html">Node</a>*
<a name="l01157"></a><a class="code" href="../../d6/dda/regparse_8c.html#a51188ccfbbf16afcaf725f0485c4120d">01157</a> <a class="code" href="../../d6/dda/regparse_8c.html#a51188ccfbbf16afcaf725f0485c4120d">node_new_cclass_by_codepoint_range</a>(<span class="keywordtype">int</span> not, <a class="code" href="../../d8/db3/oniguruma_8h.html#a7c8a84bc12127007886efbfcf53b6fb5">OnigCodePoint</a> sb_out,
<a name="l01158"></a>01158                                    <span class="keyword">const</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#a7c8a84bc12127007886efbfcf53b6fb5">OnigCodePoint</a> ranges[])
<a name="l01159"></a>01159 {
<a name="l01160"></a>01160   <span class="keywordtype">int</span> n, i;
<a name="l01161"></a>01161   <a class="code" href="../../d8/d79/struct_c_class_node.html">CClassNode</a>* cc;
<a name="l01162"></a>01162   <a class="code" href="../../d8/db3/oniguruma_8h.html#a7c8a84bc12127007886efbfcf53b6fb5">OnigCodePoint</a> j;
<a name="l01163"></a>01163 
<a name="l01164"></a>01164   <a class="code" href="../../d0/d6e/struct___node.html">Node</a>* <a class="code" href="../../d7/dc0/parse_8y.html#a0d7af8a92c4b0a07f71585584ef9634f">node</a> = <a class="code" href="../../d6/dda/regparse_8c.html#afd60d28ead746c5b464b5a114d8960f1">node_new_cclass</a>();
<a name="l01165"></a>01165   <a class="code" href="../../d6/d87/regint_8h.html#a44eb2d3a10149e1d94651052bcdcb2bb">CHECK_NULL_RETURN</a>(node);
<a name="l01166"></a>01166 
<a name="l01167"></a>01167   cc = <a class="code" href="../../d1/dfc/regparse_8h.html#a816a6d8f921892c2efef73eb7727d589">NCCLASS</a>(node);
<a name="l01168"></a>01168   <span class="keywordflow">if</span> (not != 0) <a class="code" href="../../d6/d87/regint_8h.html#afe2d37ab1bcdc5309dd3d5469f9f5aee">NCCLASS_SET_NOT</a>(cc);
<a name="l01169"></a>01169 
<a name="l01170"></a>01170   <a class="code" href="../../d6/d87/regint_8h.html#ad4f9291fce24228d0ff2c9493788506f">BITSET_CLEAR</a>(cc-&gt;<a class="code" href="../../d8/d79/struct_c_class_node.html#a082458e56c928f78db90f08e242a9f3d">bs</a>);
<a name="l01171"></a>01171   <span class="keywordflow">if</span> (sb_out &gt; 0 &amp;&amp; <a class="code" href="../../d6/d87/regint_8h.html#a4bc25fbd4749a2c130d1ae7f15ba140c">IS_NOT_NULL</a>(ranges)) {
<a name="l01172"></a>01172     n = <a class="code" href="../../d8/db3/oniguruma_8h.html#ab94c91d5d242fb022443401092575f63">ONIGENC_CODE_RANGE_NUM</a>(ranges);
<a name="l01173"></a>01173     <span class="keywordflow">for</span> (i = 0; i &lt; n; i++) {
<a name="l01174"></a>01174       <span class="keywordflow">for</span> (j  = <a class="code" href="../../d8/db3/oniguruma_8h.html#a2e05e13ed865ef08054cc10486015717">ONIGENC_CODE_RANGE_FROM</a>(ranges, i);
<a name="l01175"></a>01175            j &lt;= (<a class="code" href="../../d8/db3/oniguruma_8h.html#a7c8a84bc12127007886efbfcf53b6fb5">OnigCodePoint</a> )<a class="code" href="../../d8/db3/oniguruma_8h.html#ac115987e0dd65b25788f5ccb8e4b7ed1">ONIGENC_CODE_RANGE_TO</a>(ranges, i); j++) {
<a name="l01176"></a>01176         <span class="keywordflow">if</span> (j &gt;= sb_out) <span class="keywordflow">goto</span> sb_end;
<a name="l01177"></a>01177 
<a name="l01178"></a>01178         <a class="code" href="../../d6/d87/regint_8h.html#ab26fef19fa4f7e653f86ba09d2278e32">BITSET_SET_BIT</a>(cc-&gt;<a class="code" href="../../d8/d79/struct_c_class_node.html#a082458e56c928f78db90f08e242a9f3d">bs</a>, j);
<a name="l01179"></a>01179       }
<a name="l01180"></a>01180     }
<a name="l01181"></a>01181   }
<a name="l01182"></a>01182 
<a name="l01183"></a>01183  sb_end:
<a name="l01184"></a>01184   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d87/regint_8h.html#a91a9c9242dc3810582965d1882d1894d">IS_NULL</a>(ranges)) {
<a name="l01185"></a>01185   is_null:
<a name="l01186"></a>01186     cc-&gt;<a class="code" href="../../d8/d79/struct_c_class_node.html#a599db43b8eea536a4e4d08400fa445cb">mbuf</a> = <a class="code" href="../../d3/d09/ripper_8y.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01187"></a>01187   }
<a name="l01188"></a>01188   <span class="keywordflow">else</span> {
<a name="l01189"></a>01189     <a class="code" href="../../d0/deb/struct___b_buf.html">BBuf</a>* bbuf;
<a name="l01190"></a>01190 
<a name="l01191"></a>01191     n = <a class="code" href="../../d8/db3/oniguruma_8h.html#ab94c91d5d242fb022443401092575f63">ONIGENC_CODE_RANGE_NUM</a>(ranges);
<a name="l01192"></a>01192     <span class="keywordflow">if</span> (n == 0) <span class="keywordflow">goto</span> is_null;
<a name="l01193"></a>01193 
<a name="l01194"></a>01194     bbuf = (<a class="code" href="../../d0/deb/struct___b_buf.html">BBuf</a>* )<a class="code" href="../../d8/db0/defines_8h.html#a6af5faec3f9662b20ffc9903f923dec0">xmalloc</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../d0/deb/struct___b_buf.html">BBuf</a>));
<a name="l01195"></a>01195     <a class="code" href="../../d6/d87/regint_8h.html#a44eb2d3a10149e1d94651052bcdcb2bb">CHECK_NULL_RETURN</a>(bbuf);
<a name="l01196"></a>01196     bbuf-&gt;<a class="code" href="../../d0/deb/struct___b_buf.html#a12b605256309f2254309f69b92c4ab44">alloc</a> = n + 1;
<a name="l01197"></a>01197     bbuf-&gt;<a class="code" href="../../d0/deb/struct___b_buf.html#acf9f185ff639d57c7e4aaa6e6415888c">used</a>  = n + 1;
<a name="l01198"></a>01198     bbuf-&gt;<a class="code" href="../../d0/deb/struct___b_buf.html#a3d79f476af8e7a57dd240e68f11867a1">p</a>     = (<a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>* )((<span class="keywordtype">void</span>* )ranges);
<a name="l01199"></a>01199 
<a name="l01200"></a>01200     cc-&gt;<a class="code" href="../../d8/d79/struct_c_class_node.html#a599db43b8eea536a4e4d08400fa445cb">mbuf</a> = bbuf;
<a name="l01201"></a>01201   }
<a name="l01202"></a>01202 
<a name="l01203"></a>01203   <span class="keywordflow">return</span> node;
<a name="l01204"></a>01204 }
<a name="l01205"></a>01205 
<a name="l01206"></a>01206 <span class="keyword">static</span> <a class="code" href="../../d0/d6e/struct___node.html">Node</a>*
<a name="l01207"></a><a class="code" href="../../d6/dda/regparse_8c.html#a091fb26f4d8b1649cfbff7879ce9023e">01207</a> <a class="code" href="../../d6/dda/regparse_8c.html#a091fb26f4d8b1649cfbff7879ce9023e">node_new_ctype</a>(<span class="keywordtype">int</span> <a class="code" href="../../d5/d9d/tcltklib_8c.html#ac765329451135abec74c45e1897abf26">type</a>, <span class="keywordtype">int</span> not)
<a name="l01208"></a>01208 {
<a name="l01209"></a>01209   <a class="code" href="../../d0/d6e/struct___node.html">Node</a>* <a class="code" href="../../d7/dc0/parse_8y.html#a0d7af8a92c4b0a07f71585584ef9634f">node</a> = <a class="code" href="../../d6/dda/regparse_8c.html#a0dd497b9e45c03476d0a453d1987499c">node_new</a>();
<a name="l01210"></a>01210   <a class="code" href="../../d6/d87/regint_8h.html#a44eb2d3a10149e1d94651052bcdcb2bb">CHECK_NULL_RETURN</a>(node);
<a name="l01211"></a>01211 
<a name="l01212"></a>01212   <a class="code" href="../../d1/dfc/regparse_8h.html#aa63b31f6718866f81a7efd9263270f82">SET_NTYPE</a>(node, <a class="code" href="../../d1/dfc/regparse_8h.html#a542a2658d0f164eea8bc384ab01549d4">NT_CTYPE</a>);
<a name="l01213"></a>01213   <a class="code" href="../../d1/dfc/regparse_8h.html#a55cfe9cd258d0bdf14d6e48115f7e70b">NCTYPE</a>(node)-&gt;ctype = type;
<a name="l01214"></a>01214   <a class="code" href="../../d1/dfc/regparse_8h.html#a55cfe9cd258d0bdf14d6e48115f7e70b">NCTYPE</a>(node)-&gt;not   = not;
<a name="l01215"></a>01215   <span class="keywordflow">return</span> node;
<a name="l01216"></a>01216 }
<a name="l01217"></a>01217 
<a name="l01218"></a>01218 <span class="keyword">static</span> <a class="code" href="../../d0/d6e/struct___node.html">Node</a>*
<a name="l01219"></a><a class="code" href="../../d6/dda/regparse_8c.html#a29549d0c76087762275031d66141050b">01219</a> <a class="code" href="../../d6/dda/regparse_8c.html#a29549d0c76087762275031d66141050b">node_new_anychar</a>(<span class="keywordtype">void</span>)
<a name="l01220"></a>01220 {
<a name="l01221"></a>01221   <a class="code" href="../../d0/d6e/struct___node.html">Node</a>* <a class="code" href="../../d7/dc0/parse_8y.html#a0d7af8a92c4b0a07f71585584ef9634f">node</a> = <a class="code" href="../../d6/dda/regparse_8c.html#a0dd497b9e45c03476d0a453d1987499c">node_new</a>();
<a name="l01222"></a>01222   <a class="code" href="../../d6/d87/regint_8h.html#a44eb2d3a10149e1d94651052bcdcb2bb">CHECK_NULL_RETURN</a>(node);
<a name="l01223"></a>01223 
<a name="l01224"></a>01224   <a class="code" href="../../d1/dfc/regparse_8h.html#aa63b31f6718866f81a7efd9263270f82">SET_NTYPE</a>(node, <a class="code" href="../../d1/dfc/regparse_8h.html#a21a7fcbf4a9c872540490d92b9c29813">NT_CANY</a>);
<a name="l01225"></a>01225   <span class="keywordflow">return</span> node;
<a name="l01226"></a>01226 }
<a name="l01227"></a>01227 
<a name="l01228"></a>01228 <span class="keyword">static</span> <a class="code" href="../../d0/d6e/struct___node.html">Node</a>*
<a name="l01229"></a><a class="code" href="../../d6/dda/regparse_8c.html#abc9a73fa7f2721f8bc8e9977d1d0cefa">01229</a> <a class="code" href="../../d6/dda/regparse_8c.html#abc9a73fa7f2721f8bc8e9977d1d0cefa">node_new_list</a>(<a class="code" href="../../d0/d6e/struct___node.html">Node</a>* left, <a class="code" href="../../d0/d6e/struct___node.html">Node</a>* right)
<a name="l01230"></a>01230 {
<a name="l01231"></a>01231   <a class="code" href="../../d0/d6e/struct___node.html">Node</a>* <a class="code" href="../../d7/dc0/parse_8y.html#a0d7af8a92c4b0a07f71585584ef9634f">node</a> = <a class="code" href="../../d6/dda/regparse_8c.html#a0dd497b9e45c03476d0a453d1987499c">node_new</a>();
<a name="l01232"></a>01232   <a class="code" href="../../d6/d87/regint_8h.html#a44eb2d3a10149e1d94651052bcdcb2bb">CHECK_NULL_RETURN</a>(node);
<a name="l01233"></a>01233 
<a name="l01234"></a>01234   <a class="code" href="../../d1/dfc/regparse_8h.html#aa63b31f6718866f81a7efd9263270f82">SET_NTYPE</a>(node, <a class="code" href="../../d1/dfc/regparse_8h.html#aba3b5392b65c7a886251ccb7bdf93cf0">NT_LIST</a>);
<a name="l01235"></a>01235   <a class="code" href="../../d1/dfc/regparse_8h.html#ace12d76fd705497f81e4e2cd95cd247e">NCAR</a>(node)  = left;
<a name="l01236"></a>01236   <a class="code" href="../../d1/dfc/regparse_8h.html#ac3a01065a5b7f17aad984671c730739e">NCDR</a>(node) = right;
<a name="l01237"></a>01237   <span class="keywordflow">return</span> node;
<a name="l01238"></a>01238 }
<a name="l01239"></a>01239 
<a name="l01240"></a>01240 <span class="keyword">extern</span> <a class="code" href="../../d0/d6e/struct___node.html">Node</a>*
<a name="l01241"></a><a class="code" href="../../d6/dda/regparse_8c.html#ab258e6fc3c655e2b50e770b6d1d8b939">01241</a> <a class="code" href="../../d6/dda/regparse_8c.html#ab258e6fc3c655e2b50e770b6d1d8b939">onig_node_new_list</a>(<a class="code" href="../../d0/d6e/struct___node.html">Node</a>* left, <a class="code" href="../../d0/d6e/struct___node.html">Node</a>* right)
<a name="l01242"></a>01242 {
<a name="l01243"></a>01243   <span class="keywordflow">return</span> <a class="code" href="../../d6/dda/regparse_8c.html#abc9a73fa7f2721f8bc8e9977d1d0cefa">node_new_list</a>(left, right);
<a name="l01244"></a>01244 }
<a name="l01245"></a>01245 
<a name="l01246"></a>01246 <span class="keyword">extern</span> <a class="code" href="../../d0/d6e/struct___node.html">Node</a>*
<a name="l01247"></a><a class="code" href="../../d6/dda/regparse_8c.html#ac5dff6c5b4675f20090b2919bb08ad54">01247</a> <a class="code" href="../../d6/dda/regparse_8c.html#ac5dff6c5b4675f20090b2919bb08ad54">onig_node_list_add</a>(<a class="code" href="../../d0/d6e/struct___node.html">Node</a>* <a class="code" href="../../d5/db5/encoding_8c.html#a05f70dacbe595d27364e1e014efb0c8e">list</a>, <a class="code" href="../../d0/d6e/struct___node.html">Node</a>* x)
<a name="l01248"></a>01248 {
<a name="l01249"></a>01249   <a class="code" href="../../d0/d6e/struct___node.html">Node</a> *n;
<a name="l01250"></a>01250 
<a name="l01251"></a>01251   n = <a class="code" href="../../d6/dda/regparse_8c.html#ab258e6fc3c655e2b50e770b6d1d8b939">onig_node_new_list</a>(x, <a class="code" href="../../d3/d09/ripper_8y.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l01252"></a>01252   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d87/regint_8h.html#a91a9c9242dc3810582965d1882d1894d">IS_NULL</a>(n)) <span class="keywordflow">return</span> <a class="code" href="../../d3/d7f/gram_8c.html#ac00d2982d51115efbe8a13840d47b7a7">NULL_NODE</a>;
<a name="l01253"></a>01253 
<a name="l01254"></a>01254   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d87/regint_8h.html#a4bc25fbd4749a2c130d1ae7f15ba140c">IS_NOT_NULL</a>(list)) {
<a name="l01255"></a>01255     <span class="keywordflow">while</span> (<a class="code" href="../../d6/d87/regint_8h.html#a4bc25fbd4749a2c130d1ae7f15ba140c">IS_NOT_NULL</a>(<a class="code" href="../../d1/dfc/regparse_8h.html#ac3a01065a5b7f17aad984671c730739e">NCDR</a>(list)))
<a name="l01256"></a>01256       list = <a class="code" href="../../d1/dfc/regparse_8h.html#ac3a01065a5b7f17aad984671c730739e">NCDR</a>(list);
<a name="l01257"></a>01257 
<a name="l01258"></a>01258     <a class="code" href="../../d1/dfc/regparse_8h.html#ac3a01065a5b7f17aad984671c730739e">NCDR</a>(list) = n;
<a name="l01259"></a>01259   }
<a name="l01260"></a>01260 
<a name="l01261"></a>01261   <span class="keywordflow">return</span> n;
<a name="l01262"></a>01262 }
<a name="l01263"></a>01263 
<a name="l01264"></a>01264 <span class="keyword">extern</span> <a class="code" href="../../d0/d6e/struct___node.html">Node</a>*
<a name="l01265"></a><a class="code" href="../../d6/dda/regparse_8c.html#a9ee0d6fbf2d9ed077e5c5831b93444a6">01265</a> <a class="code" href="../../d6/dda/regparse_8c.html#a9ee0d6fbf2d9ed077e5c5831b93444a6">onig_node_new_alt</a>(<a class="code" href="../../d0/d6e/struct___node.html">Node</a>* left, <a class="code" href="../../d0/d6e/struct___node.html">Node</a>* right)
<a name="l01266"></a>01266 {
<a name="l01267"></a>01267   <a class="code" href="../../d0/d6e/struct___node.html">Node</a>* <a class="code" href="../../d7/dc0/parse_8y.html#a0d7af8a92c4b0a07f71585584ef9634f">node</a> = <a class="code" href="../../d6/dda/regparse_8c.html#a0dd497b9e45c03476d0a453d1987499c">node_new</a>();
<a name="l01268"></a>01268   <a class="code" href="../../d6/d87/regint_8h.html#a44eb2d3a10149e1d94651052bcdcb2bb">CHECK_NULL_RETURN</a>(node);
<a name="l01269"></a>01269 
<a name="l01270"></a>01270   <a class="code" href="../../d1/dfc/regparse_8h.html#aa63b31f6718866f81a7efd9263270f82">SET_NTYPE</a>(node, <a class="code" href="../../d1/dfc/regparse_8h.html#ae71a11e8c4757331e146c7c055c28294">NT_ALT</a>);
<a name="l01271"></a>01271   <a class="code" href="../../d1/dfc/regparse_8h.html#ace12d76fd705497f81e4e2cd95cd247e">NCAR</a>(node)  = left;
<a name="l01272"></a>01272   <a class="code" href="../../d1/dfc/regparse_8h.html#ac3a01065a5b7f17aad984671c730739e">NCDR</a>(node) = right;
<a name="l01273"></a>01273   <span class="keywordflow">return</span> node;
<a name="l01274"></a>01274 }
<a name="l01275"></a>01275 
<a name="l01276"></a>01276 <span class="keyword">extern</span> <a class="code" href="../../d0/d6e/struct___node.html">Node</a>*
<a name="l01277"></a><a class="code" href="../../d6/dda/regparse_8c.html#a153ac14abd8927a6edd4da2f445d1c30">01277</a> <a class="code" href="../../d6/dda/regparse_8c.html#a153ac14abd8927a6edd4da2f445d1c30">onig_node_new_anchor</a>(<span class="keywordtype">int</span> <a class="code" href="../../d5/d9d/tcltklib_8c.html#ac765329451135abec74c45e1897abf26">type</a>)
<a name="l01278"></a>01278 {
<a name="l01279"></a>01279   <a class="code" href="../../d0/d6e/struct___node.html">Node</a>* <a class="code" href="../../d7/dc0/parse_8y.html#a0d7af8a92c4b0a07f71585584ef9634f">node</a> = <a class="code" href="../../d6/dda/regparse_8c.html#a0dd497b9e45c03476d0a453d1987499c">node_new</a>();
<a name="l01280"></a>01280   <a class="code" href="../../d6/d87/regint_8h.html#a44eb2d3a10149e1d94651052bcdcb2bb">CHECK_NULL_RETURN</a>(node);
<a name="l01281"></a>01281 
<a name="l01282"></a>01282   <a class="code" href="../../d1/dfc/regparse_8h.html#aa63b31f6718866f81a7efd9263270f82">SET_NTYPE</a>(node, <a class="code" href="../../d1/dfc/regparse_8h.html#a4169804cb78eccf494a7f72ae737be32">NT_ANCHOR</a>);
<a name="l01283"></a>01283   <a class="code" href="../../d1/dfc/regparse_8h.html#aff69a39d6dfe87d4eb079758e46cb226">NANCHOR</a>(node)-&gt;type     = type;
<a name="l01284"></a>01284   <a class="code" href="../../d1/dfc/regparse_8h.html#aff69a39d6dfe87d4eb079758e46cb226">NANCHOR</a>(node)-&gt;target   = <a class="code" href="../../d3/d09/ripper_8y.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01285"></a>01285   <a class="code" href="../../d1/dfc/regparse_8h.html#aff69a39d6dfe87d4eb079758e46cb226">NANCHOR</a>(node)-&gt;char_len = -1;
<a name="l01286"></a>01286   <span class="keywordflow">return</span> node;
<a name="l01287"></a>01287 }
<a name="l01288"></a>01288 
<a name="l01289"></a>01289 <span class="keyword">static</span> <a class="code" href="../../d0/d6e/struct___node.html">Node</a>*
<a name="l01290"></a><a class="code" href="../../d6/dda/regparse_8c.html#aa10b21fdcb9ddfc3437cfe4fa2a280c4">01290</a> <a class="code" href="../../d6/dda/regparse_8c.html#aa10b21fdcb9ddfc3437cfe4fa2a280c4">node_new_backref</a>(<span class="keywordtype">int</span> back_num, <span class="keywordtype">int</span>* backrefs, <span class="keywordtype">int</span> by_name,
<a name="l01291"></a>01291 #ifdef <a class="code" href="../../d6/d87/regint_8h.html#ad06b56f5a7d10a85e880f076d728f11b">USE_BACKREF_WITH_LEVEL</a>
<a name="l01292"></a>01292                  <span class="keywordtype">int</span> exist_level, <span class="keywordtype">int</span> nest_level,
<a name="l01293"></a>01293 #endif
<a name="l01294"></a>01294                  <a class="code" href="../../d6/dbe/struct_scan_env.html">ScanEnv</a>* env)
<a name="l01295"></a>01295 {
<a name="l01296"></a>01296   <span class="keywordtype">int</span> i;
<a name="l01297"></a>01297   <a class="code" href="../../d0/d6e/struct___node.html">Node</a>* <a class="code" href="../../d7/dc0/parse_8y.html#a0d7af8a92c4b0a07f71585584ef9634f">node</a> = <a class="code" href="../../d6/dda/regparse_8c.html#a0dd497b9e45c03476d0a453d1987499c">node_new</a>();
<a name="l01298"></a>01298 
<a name="l01299"></a>01299   <a class="code" href="../../d6/d87/regint_8h.html#a44eb2d3a10149e1d94651052bcdcb2bb">CHECK_NULL_RETURN</a>(node);
<a name="l01300"></a>01300 
<a name="l01301"></a>01301   <a class="code" href="../../d1/dfc/regparse_8h.html#aa63b31f6718866f81a7efd9263270f82">SET_NTYPE</a>(node, <a class="code" href="../../d1/dfc/regparse_8h.html#ac1d2a54cfe6dfa9104b4bfb8d06b8aeb">NT_BREF</a>);
<a name="l01302"></a>01302   <a class="code" href="../../d1/dfc/regparse_8h.html#a38215823f6ab7e63e919eae3bfa79bfa">NBREF</a>(node)-&gt;state    = 0;
<a name="l01303"></a>01303   <a class="code" href="../../d1/dfc/regparse_8h.html#a38215823f6ab7e63e919eae3bfa79bfa">NBREF</a>(node)-&gt;back_num = back_num;
<a name="l01304"></a>01304   <a class="code" href="../../d1/dfc/regparse_8h.html#a38215823f6ab7e63e919eae3bfa79bfa">NBREF</a>(node)-&gt;back_dynamic = (<span class="keywordtype">int</span>* )<a class="code" href="../../d3/d09/ripper_8y.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01305"></a>01305   <span class="keywordflow">if</span> (by_name != 0)
<a name="l01306"></a>01306     <a class="code" href="../../d1/dfc/regparse_8h.html#a38215823f6ab7e63e919eae3bfa79bfa">NBREF</a>(node)-&gt;state |= <a class="code" href="../../d1/dfc/regparse_8h.html#abddcee3225eea72cc79f2d4569f333ea">NST_NAME_REF</a>;
<a name="l01307"></a>01307 
<a name="l01308"></a>01308 <span class="preprocessor">#ifdef USE_BACKREF_WITH_LEVEL</span>
<a name="l01309"></a>01309 <span class="preprocessor"></span>  <span class="keywordflow">if</span> (exist_level != 0) {
<a name="l01310"></a>01310     <a class="code" href="../../d1/dfc/regparse_8h.html#a38215823f6ab7e63e919eae3bfa79bfa">NBREF</a>(node)-&gt;state |= <a class="code" href="../../d1/dfc/regparse_8h.html#a3b453e92602fb2f4535bc969ae2f0df1">NST_NEST_LEVEL</a>;
<a name="l01311"></a>01311     <a class="code" href="../../d1/dfc/regparse_8h.html#a38215823f6ab7e63e919eae3bfa79bfa">NBREF</a>(node)-&gt;nest_level  = nest_level;
<a name="l01312"></a>01312   }
<a name="l01313"></a>01313 <span class="preprocessor">#endif</span>
<a name="l01314"></a>01314 <span class="preprocessor"></span>
<a name="l01315"></a>01315   <span class="keywordflow">for</span> (i = 0; i &lt; back_num; i++) {
<a name="l01316"></a>01316     <span class="keywordflow">if</span> (backrefs[i] &lt;= env-&gt;num_mem &amp;&amp;
<a name="l01317"></a>01317         <a class="code" href="../../d6/d87/regint_8h.html#a91a9c9242dc3810582965d1882d1894d">IS_NULL</a>(<a class="code" href="../../d1/dfc/regparse_8h.html#a82066fdd1d2abdcc23ae01f55bfbe321">SCANENV_MEM_NODES</a>(env)[backrefs[i]])) {
<a name="l01318"></a>01318       <a class="code" href="../../d1/dfc/regparse_8h.html#a38215823f6ab7e63e919eae3bfa79bfa">NBREF</a>(node)-&gt;state |= <a class="code" href="../../d1/dfc/regparse_8h.html#a04144a8cc6b823fcae3b99f5cd5ab42c">NST_RECURSION</a>;   <span class="comment">/* /...(\1).../ */</span>
<a name="l01319"></a>01319       <span class="keywordflow">break</span>;
<a name="l01320"></a>01320     }
<a name="l01321"></a>01321   }
<a name="l01322"></a>01322 
<a name="l01323"></a>01323   <span class="keywordflow">if</span> (back_num &lt;= <a class="code" href="../../d1/dfc/regparse_8h.html#af644c389326c5842fd7315567e7644b2">NODE_BACKREFS_SIZE</a>) {
<a name="l01324"></a>01324     <span class="keywordflow">for</span> (i = 0; i &lt; back_num; i++)
<a name="l01325"></a>01325       <a class="code" href="../../d1/dfc/regparse_8h.html#a38215823f6ab7e63e919eae3bfa79bfa">NBREF</a>(node)-&gt;back_static[i] = backrefs[i];
<a name="l01326"></a>01326   }
<a name="l01327"></a>01327   <span class="keywordflow">else</span> {
<a name="l01328"></a>01328     <span class="keywordtype">int</span>* p = (<span class="keywordtype">int</span>* )<a class="code" href="../../d8/db0/defines_8h.html#a6af5faec3f9662b20ffc9903f923dec0">xmalloc</a>(<span class="keyword">sizeof</span>(<span class="keywordtype">int</span>) * back_num);
<a name="l01329"></a>01329     <span class="keywordflow">if</span> (<a class="code" href="../../d6/d87/regint_8h.html#a91a9c9242dc3810582965d1882d1894d">IS_NULL</a>(p)) {
<a name="l01330"></a>01330       <a class="code" href="../../d6/dda/regparse_8c.html#aa98ee34de192fd4997906389f70f4808">onig_node_free</a>(node);
<a name="l01331"></a>01331       <span class="keywordflow">return</span> <a class="code" href="../../d3/d09/ripper_8y.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01332"></a>01332     }
<a name="l01333"></a>01333     <a class="code" href="../../d1/dfc/regparse_8h.html#a38215823f6ab7e63e919eae3bfa79bfa">NBREF</a>(node)-&gt;back_dynamic = p;
<a name="l01334"></a>01334     <span class="keywordflow">for</span> (i = 0; i &lt; back_num; i++)
<a name="l01335"></a>01335       p[i] = backrefs[i];
<a name="l01336"></a>01336   }
<a name="l01337"></a>01337   <span class="keywordflow">return</span> node;
<a name="l01338"></a>01338 }
<a name="l01339"></a>01339 
<a name="l01340"></a>01340 <span class="preprocessor">#ifdef USE_SUBEXP_CALL</span>
<a name="l01341"></a>01341 <span class="preprocessor"></span><span class="keyword">static</span> <a class="code" href="../../d0/d6e/struct___node.html">Node</a>*
<a name="l01342"></a><a class="code" href="../../d6/dda/regparse_8c.html#afe414bf273e80530aa328c4cf0e2ba09">01342</a> <a class="code" href="../../d6/dda/regparse_8c.html#afe414bf273e80530aa328c4cf0e2ba09">node_new_call</a>(<a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>* name, <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>* name_end, <span class="keywordtype">int</span> gnum)
<a name="l01343"></a>01343 {
<a name="l01344"></a>01344   <a class="code" href="../../d0/d6e/struct___node.html">Node</a>* <a class="code" href="../../d7/dc0/parse_8y.html#a0d7af8a92c4b0a07f71585584ef9634f">node</a> = <a class="code" href="../../d6/dda/regparse_8c.html#a0dd497b9e45c03476d0a453d1987499c">node_new</a>();
<a name="l01345"></a>01345   <a class="code" href="../../d6/d87/regint_8h.html#a44eb2d3a10149e1d94651052bcdcb2bb">CHECK_NULL_RETURN</a>(node);
<a name="l01346"></a>01346 
<a name="l01347"></a>01347   <a class="code" href="../../d1/dfc/regparse_8h.html#aa63b31f6718866f81a7efd9263270f82">SET_NTYPE</a>(node, <a class="code" href="../../d1/dfc/regparse_8h.html#a35167bbf195155481ee5cbcae152d0f9">NT_CALL</a>);
<a name="l01348"></a>01348   <a class="code" href="../../d1/dfc/regparse_8h.html#aedcbc83fb8b3a89a32a3cd51d700710a">NCALL</a>(node)-&gt;state     = 0;
<a name="l01349"></a>01349   <a class="code" href="../../d1/dfc/regparse_8h.html#aedcbc83fb8b3a89a32a3cd51d700710a">NCALL</a>(node)-&gt;target    = <a class="code" href="../../d3/d7f/gram_8c.html#ac00d2982d51115efbe8a13840d47b7a7">NULL_NODE</a>;
<a name="l01350"></a>01350   <a class="code" href="../../d1/dfc/regparse_8h.html#aedcbc83fb8b3a89a32a3cd51d700710a">NCALL</a>(node)-&gt;name      = name;
<a name="l01351"></a>01351   <a class="code" href="../../d1/dfc/regparse_8h.html#aedcbc83fb8b3a89a32a3cd51d700710a">NCALL</a>(node)-&gt;name_end  = name_end;
<a name="l01352"></a>01352   <a class="code" href="../../d1/dfc/regparse_8h.html#aedcbc83fb8b3a89a32a3cd51d700710a">NCALL</a>(node)-&gt;group_num = gnum;  <span class="comment">/* call by number if gnum != 0 */</span>
<a name="l01353"></a>01353   <span class="keywordflow">return</span> node;
<a name="l01354"></a>01354 }
<a name="l01355"></a>01355 <span class="preprocessor">#endif</span>
<a name="l01356"></a>01356 <span class="preprocessor"></span>
<a name="l01357"></a>01357 <span class="keyword">static</span> <a class="code" href="../../d0/d6e/struct___node.html">Node</a>*
<a name="l01358"></a><a class="code" href="../../d6/dda/regparse_8c.html#ac5adfdb214b7e15f4a0439d28a7a11b9">01358</a> <a class="code" href="../../d6/dda/regparse_8c.html#ac5adfdb214b7e15f4a0439d28a7a11b9">node_new_quantifier</a>(<span class="keywordtype">int</span> lower, <span class="keywordtype">int</span> upper, <span class="keywordtype">int</span> by_number)
<a name="l01359"></a>01359 {
<a name="l01360"></a>01360   <a class="code" href="../../d0/d6e/struct___node.html">Node</a>* <a class="code" href="../../d7/dc0/parse_8y.html#a0d7af8a92c4b0a07f71585584ef9634f">node</a> = <a class="code" href="../../d6/dda/regparse_8c.html#a0dd497b9e45c03476d0a453d1987499c">node_new</a>();
<a name="l01361"></a>01361   <a class="code" href="../../d6/d87/regint_8h.html#a44eb2d3a10149e1d94651052bcdcb2bb">CHECK_NULL_RETURN</a>(node);
<a name="l01362"></a>01362 
<a name="l01363"></a>01363   <a class="code" href="../../d1/dfc/regparse_8h.html#aa63b31f6718866f81a7efd9263270f82">SET_NTYPE</a>(node, <a class="code" href="../../d1/dfc/regparse_8h.html#a307b2dd57583d60d4d89eae6478b69ab">NT_QTFR</a>);
<a name="l01364"></a>01364   <a class="code" href="../../d1/dfc/regparse_8h.html#addc653094848075876587782124e9504">NQTFR</a>(node)-&gt;state  = 0;
<a name="l01365"></a>01365   <a class="code" href="../../d1/dfc/regparse_8h.html#addc653094848075876587782124e9504">NQTFR</a>(node)-&gt;target = <a class="code" href="../../d3/d09/ripper_8y.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01366"></a>01366   <a class="code" href="../../d1/dfc/regparse_8h.html#addc653094848075876587782124e9504">NQTFR</a>(node)-&gt;lower  = lower;
<a name="l01367"></a>01367   <a class="code" href="../../d1/dfc/regparse_8h.html#addc653094848075876587782124e9504">NQTFR</a>(node)-&gt;upper  = upper;
<a name="l01368"></a>01368   <a class="code" href="../../d1/dfc/regparse_8h.html#addc653094848075876587782124e9504">NQTFR</a>(node)-&gt;greedy = 1;
<a name="l01369"></a>01369   <a class="code" href="../../d1/dfc/regparse_8h.html#addc653094848075876587782124e9504">NQTFR</a>(node)-&gt;target_empty_info = <a class="code" href="../../d1/dfc/regparse_8h.html#a9cf0c13b2a42a7154f46c744868fb628">NQ_TARGET_ISNOT_EMPTY</a>;
<a name="l01370"></a>01370   <a class="code" href="../../d1/dfc/regparse_8h.html#addc653094848075876587782124e9504">NQTFR</a>(node)-&gt;head_exact        = <a class="code" href="../../d3/d7f/gram_8c.html#ac00d2982d51115efbe8a13840d47b7a7">NULL_NODE</a>;
<a name="l01371"></a>01371   <a class="code" href="../../d1/dfc/regparse_8h.html#addc653094848075876587782124e9504">NQTFR</a>(node)-&gt;next_head_exact   = <a class="code" href="../../d3/d7f/gram_8c.html#ac00d2982d51115efbe8a13840d47b7a7">NULL_NODE</a>;
<a name="l01372"></a>01372   <a class="code" href="../../d1/dfc/regparse_8h.html#addc653094848075876587782124e9504">NQTFR</a>(node)-&gt;is_refered        = 0;
<a name="l01373"></a>01373   <span class="keywordflow">if</span> (by_number != 0)
<a name="l01374"></a>01374     <a class="code" href="../../d1/dfc/regparse_8h.html#addc653094848075876587782124e9504">NQTFR</a>(node)-&gt;state |= <a class="code" href="../../d1/dfc/regparse_8h.html#ab5b9243b850310f892a1567b4aa1cec1">NST_BY_NUMBER</a>;
<a name="l01375"></a>01375 
<a name="l01376"></a>01376 <span class="preprocessor">#ifdef USE_COMBINATION_EXPLOSION_CHECK</span>
<a name="l01377"></a>01377 <span class="preprocessor"></span>  <a class="code" href="../../d1/dfc/regparse_8h.html#addc653094848075876587782124e9504">NQTFR</a>(node)-&gt;comb_exp_check_num = 0;
<a name="l01378"></a>01378 <span class="preprocessor">#endif</span>
<a name="l01379"></a>01379 <span class="preprocessor"></span>
<a name="l01380"></a>01380   <span class="keywordflow">return</span> node;
<a name="l01381"></a>01381 }
<a name="l01382"></a>01382 
<a name="l01383"></a>01383 <span class="keyword">static</span> <a class="code" href="../../d0/d6e/struct___node.html">Node</a>*
<a name="l01384"></a><a class="code" href="../../d6/dda/regparse_8c.html#a266745047dad368886ed92677abae972">01384</a> <a class="code" href="../../d6/dda/regparse_8c.html#a266745047dad368886ed92677abae972">node_new_enclose</a>(<span class="keywordtype">int</span> <a class="code" href="../../d5/d9d/tcltklib_8c.html#ac765329451135abec74c45e1897abf26">type</a>)
<a name="l01385"></a>01385 {
<a name="l01386"></a>01386   <a class="code" href="../../d0/d6e/struct___node.html">Node</a>* <a class="code" href="../../d7/dc0/parse_8y.html#a0d7af8a92c4b0a07f71585584ef9634f">node</a> = <a class="code" href="../../d6/dda/regparse_8c.html#a0dd497b9e45c03476d0a453d1987499c">node_new</a>();
<a name="l01387"></a>01387   <a class="code" href="../../d6/d87/regint_8h.html#a44eb2d3a10149e1d94651052bcdcb2bb">CHECK_NULL_RETURN</a>(node);
<a name="l01388"></a>01388 
<a name="l01389"></a>01389   <a class="code" href="../../d1/dfc/regparse_8h.html#aa63b31f6718866f81a7efd9263270f82">SET_NTYPE</a>(node, <a class="code" href="../../d1/dfc/regparse_8h.html#a28d3349039b07e17b82e258cd8f73897">NT_ENCLOSE</a>);
<a name="l01390"></a>01390   <a class="code" href="../../d1/dfc/regparse_8h.html#a2fea29a34640f28158788eef43a9bfd2">NENCLOSE</a>(node)-&gt;type      = type;
<a name="l01391"></a>01391   <a class="code" href="../../d1/dfc/regparse_8h.html#a2fea29a34640f28158788eef43a9bfd2">NENCLOSE</a>(node)-&gt;state     =  0;
<a name="l01392"></a>01392   <a class="code" href="../../d1/dfc/regparse_8h.html#a2fea29a34640f28158788eef43a9bfd2">NENCLOSE</a>(node)-&gt;regnum    =  0;
<a name="l01393"></a>01393   <a class="code" href="../../d1/dfc/regparse_8h.html#a2fea29a34640f28158788eef43a9bfd2">NENCLOSE</a>(node)-&gt;option    =  0;
<a name="l01394"></a>01394   <a class="code" href="../../d1/dfc/regparse_8h.html#a2fea29a34640f28158788eef43a9bfd2">NENCLOSE</a>(node)-&gt;target    = <a class="code" href="../../d3/d09/ripper_8y.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01395"></a>01395   <a class="code" href="../../d1/dfc/regparse_8h.html#a2fea29a34640f28158788eef43a9bfd2">NENCLOSE</a>(node)-&gt;call_addr = -1;
<a name="l01396"></a>01396   <a class="code" href="../../d1/dfc/regparse_8h.html#a2fea29a34640f28158788eef43a9bfd2">NENCLOSE</a>(node)-&gt;opt_count =  0;
<a name="l01397"></a>01397   <span class="keywordflow">return</span> node;
<a name="l01398"></a>01398 }
<a name="l01399"></a>01399 
<a name="l01400"></a>01400 <span class="keyword">extern</span> <a class="code" href="../../d0/d6e/struct___node.html">Node</a>*
<a name="l01401"></a><a class="code" href="../../d6/dda/regparse_8c.html#a91c33deefe09343b00b57031f7e8ff53">01401</a> <a class="code" href="../../d6/dda/regparse_8c.html#a91c33deefe09343b00b57031f7e8ff53">onig_node_new_enclose</a>(<span class="keywordtype">int</span> <a class="code" href="../../d5/d9d/tcltklib_8c.html#ac765329451135abec74c45e1897abf26">type</a>)
<a name="l01402"></a>01402 {
<a name="l01403"></a>01403   <span class="keywordflow">return</span> <a class="code" href="../../d6/dda/regparse_8c.html#a266745047dad368886ed92677abae972">node_new_enclose</a>(type);
<a name="l01404"></a>01404 }
<a name="l01405"></a>01405 
<a name="l01406"></a>01406 <span class="keyword">static</span> <a class="code" href="../../d0/d6e/struct___node.html">Node</a>*
<a name="l01407"></a><a class="code" href="../../d6/dda/regparse_8c.html#a0c09ce0753bb659111af8de34d8dd658">01407</a> <a class="code" href="../../d6/dda/regparse_8c.html#a0c09ce0753bb659111af8de34d8dd658">node_new_enclose_memory</a>(<a class="code" href="../../d8/db3/oniguruma_8h.html#ad870c1a94502ad33c083978b17911e72">OnigOptionType</a> option, <span class="keywordtype">int</span> is_named)
<a name="l01408"></a>01408 {
<a name="l01409"></a>01409   <a class="code" href="../../d0/d6e/struct___node.html">Node</a>* <a class="code" href="../../d7/dc0/parse_8y.html#a0d7af8a92c4b0a07f71585584ef9634f">node</a> = <a class="code" href="../../d6/dda/regparse_8c.html#a266745047dad368886ed92677abae972">node_new_enclose</a>(<a class="code" href="../../d1/dfc/regparse_8h.html#a32e44d8ddaca8fd4931a8c13677972ad">ENCLOSE_MEMORY</a>);
<a name="l01410"></a>01410   <a class="code" href="../../d6/d87/regint_8h.html#a44eb2d3a10149e1d94651052bcdcb2bb">CHECK_NULL_RETURN</a>(node);
<a name="l01411"></a>01411   <span class="keywordflow">if</span> (is_named != 0)
<a name="l01412"></a>01412     <a class="code" href="../../d1/dfc/regparse_8h.html#a709b6af5e5f6789e8a1ae2406f12a668">SET_ENCLOSE_STATUS</a>(node, <a class="code" href="../../d1/dfc/regparse_8h.html#a6ed6c6aeae2a7e82568a97d5b09a5852">NST_NAMED_GROUP</a>);
<a name="l01413"></a>01413 
<a name="l01414"></a>01414 <span class="preprocessor">#ifdef USE_SUBEXP_CALL</span>
<a name="l01415"></a>01415 <span class="preprocessor"></span>  <a class="code" href="../../d1/dfc/regparse_8h.html#a2fea29a34640f28158788eef43a9bfd2">NENCLOSE</a>(node)-&gt;option = option;
<a name="l01416"></a>01416 <span class="preprocessor">#endif</span>
<a name="l01417"></a>01417 <span class="preprocessor"></span>  <span class="keywordflow">return</span> node;
<a name="l01418"></a>01418 }
<a name="l01419"></a>01419 
<a name="l01420"></a>01420 <span class="keyword">static</span> <a class="code" href="../../d0/d6e/struct___node.html">Node</a>*
<a name="l01421"></a><a class="code" href="../../d6/dda/regparse_8c.html#a1f5cf25b24e05e8cf525e22e94d82fb4">01421</a> <a class="code" href="../../d6/dda/regparse_8c.html#a1f5cf25b24e05e8cf525e22e94d82fb4">node_new_option</a>(<a class="code" href="../../d8/db3/oniguruma_8h.html#ad870c1a94502ad33c083978b17911e72">OnigOptionType</a> option)
<a name="l01422"></a>01422 {
<a name="l01423"></a>01423   <a class="code" href="../../d0/d6e/struct___node.html">Node</a>* <a class="code" href="../../d7/dc0/parse_8y.html#a0d7af8a92c4b0a07f71585584ef9634f">node</a> = <a class="code" href="../../d6/dda/regparse_8c.html#a266745047dad368886ed92677abae972">node_new_enclose</a>(<a class="code" href="../../d1/dfc/regparse_8h.html#a1f27f4cccd30502c03174673fe25af41">ENCLOSE_OPTION</a>);
<a name="l01424"></a>01424   <a class="code" href="../../d6/d87/regint_8h.html#a44eb2d3a10149e1d94651052bcdcb2bb">CHECK_NULL_RETURN</a>(node);
<a name="l01425"></a>01425   <a class="code" href="../../d1/dfc/regparse_8h.html#a2fea29a34640f28158788eef43a9bfd2">NENCLOSE</a>(node)-&gt;option = option;
<a name="l01426"></a>01426   <span class="keywordflow">return</span> node;
<a name="l01427"></a>01427 }
<a name="l01428"></a>01428 
<a name="l01429"></a>01429 <span class="keyword">extern</span> <span class="keywordtype">int</span>
<a name="l01430"></a><a class="code" href="../../d6/dda/regparse_8c.html#a4c9f32699c8567f97bf22053473ec09e">01430</a> <a class="code" href="../../d6/dda/regparse_8c.html#a4c9f32699c8567f97bf22053473ec09e">onig_node_str_cat</a>(<a class="code" href="../../d0/d6e/struct___node.html">Node</a>* <a class="code" href="../../d7/dc0/parse_8y.html#a0d7af8a92c4b0a07f71585584ef9634f">node</a>, <span class="keyword">const</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>* s, <span class="keyword">const</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>* end)
<a name="l01431"></a>01431 {
<a name="l01432"></a>01432   ptrdiff_t addlen = end - s;
<a name="l01433"></a>01433 
<a name="l01434"></a>01434   <span class="keywordflow">if</span> (addlen &gt; 0) {
<a name="l01435"></a>01435     ptrdiff_t len  = <a class="code" href="../../d1/dfc/regparse_8h.html#a24a4b2af18dda01ae000ec64129eb50e">NSTR</a>(node)-&gt;end - <a class="code" href="../../d1/dfc/regparse_8h.html#a24a4b2af18dda01ae000ec64129eb50e">NSTR</a>(node)-&gt;s;
<a name="l01436"></a>01436 
<a name="l01437"></a>01437     <span class="keywordflow">if</span> (<a class="code" href="../../d1/dfc/regparse_8h.html#a24a4b2af18dda01ae000ec64129eb50e">NSTR</a>(node)-&gt;capa &gt; 0 || (len + addlen &gt; <a class="code" href="../../d1/dfc/regparse_8h.html#a9814d431677483621091229d7500e1d6">NODE_STR_BUF_SIZE</a> - 1)) {
<a name="l01438"></a>01438       <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>* p;
<a name="l01439"></a>01439       ptrdiff_t capa = len + addlen + <a class="code" href="../../d1/dfc/regparse_8h.html#a40ada8f47e345b13e9fdcc4a4d883565">NODE_STR_MARGIN</a>;
<a name="l01440"></a>01440 
<a name="l01441"></a>01441       <span class="keywordflow">if</span> (capa &lt;= <a class="code" href="../../d1/dfc/regparse_8h.html#a24a4b2af18dda01ae000ec64129eb50e">NSTR</a>(node)-&gt;capa) {
<a name="l01442"></a>01442         <a class="code" href="../../d6/dda/regparse_8c.html#ae1ec1f619a502e243e88146945e3e911">onig_strcpy</a>(<a class="code" href="../../d1/dfc/regparse_8h.html#a24a4b2af18dda01ae000ec64129eb50e">NSTR</a>(node)-&gt;s + len, s, end);
<a name="l01443"></a>01443       }
<a name="l01444"></a>01444       <span class="keywordflow">else</span> {
<a name="l01445"></a>01445         <span class="keywordflow">if</span> (<a class="code" href="../../d1/dfc/regparse_8h.html#a24a4b2af18dda01ae000ec64129eb50e">NSTR</a>(node)-&gt;s == <a class="code" href="../../d1/dfc/regparse_8h.html#a24a4b2af18dda01ae000ec64129eb50e">NSTR</a>(node)-&gt;<a class="code" href="../../d6/da0/nkf-utf8_2nkf_8c.html#ac37f17a60c8b5533aac4840c681f62b8">buf</a>)
<a name="l01446"></a>01446           p = <a class="code" href="../../d6/dda/regparse_8c.html#a620fa0dc6df49854ab111825fb94cd61">strcat_capa_from_static</a>(<a class="code" href="../../d1/dfc/regparse_8h.html#a24a4b2af18dda01ae000ec64129eb50e">NSTR</a>(node)-&gt;s, <a class="code" href="../../d1/dfc/regparse_8h.html#a24a4b2af18dda01ae000ec64129eb50e">NSTR</a>(node)-&gt;end,
<a name="l01447"></a>01447                                       s, end, capa);
<a name="l01448"></a>01448         <span class="keywordflow">else</span>
<a name="l01449"></a>01449           p = <a class="code" href="../../d6/dda/regparse_8c.html#ad4ed5ad9e6d2c1730761241e8ee18a71">strcat_capa</a>(<a class="code" href="../../d1/dfc/regparse_8h.html#a24a4b2af18dda01ae000ec64129eb50e">NSTR</a>(node)-&gt;s, <a class="code" href="../../d1/dfc/regparse_8h.html#a24a4b2af18dda01ae000ec64129eb50e">NSTR</a>(node)-&gt;end, s, end, capa);
<a name="l01450"></a>01450 
<a name="l01451"></a>01451         <a class="code" href="../../d6/d87/regint_8h.html#a17ebb2a12300dcf6d79916e357fae45a">CHECK_NULL_RETURN_MEMERR</a>(p);
<a name="l01452"></a>01452         <a class="code" href="../../d1/dfc/regparse_8h.html#a24a4b2af18dda01ae000ec64129eb50e">NSTR</a>(node)-&gt;s    = p;
<a name="l01453"></a>01453         <a class="code" href="../../d1/dfc/regparse_8h.html#a24a4b2af18dda01ae000ec64129eb50e">NSTR</a>(node)-&gt;capa = (int)capa;
<a name="l01454"></a>01454       }
<a name="l01455"></a>01455     }
<a name="l01456"></a>01456     <span class="keywordflow">else</span> {
<a name="l01457"></a>01457       <a class="code" href="../../d6/dda/regparse_8c.html#ae1ec1f619a502e243e88146945e3e911">onig_strcpy</a>(<a class="code" href="../../d1/dfc/regparse_8h.html#a24a4b2af18dda01ae000ec64129eb50e">NSTR</a>(node)-&gt;s + len, s, end);
<a name="l01458"></a>01458     }
<a name="l01459"></a>01459     <a class="code" href="../../d1/dfc/regparse_8h.html#a24a4b2af18dda01ae000ec64129eb50e">NSTR</a>(node)-&gt;end = <a class="code" href="../../d1/dfc/regparse_8h.html#a24a4b2af18dda01ae000ec64129eb50e">NSTR</a>(node)-&gt;s + len + addlen;
<a name="l01460"></a>01460   }
<a name="l01461"></a>01461 
<a name="l01462"></a>01462   <span class="keywordflow">return</span> 0;
<a name="l01463"></a>01463 }
<a name="l01464"></a>01464 
<a name="l01465"></a>01465 <span class="keyword">extern</span> <span class="keywordtype">int</span>
<a name="l01466"></a><a class="code" href="../../d6/dda/regparse_8c.html#abe42195fece2fb89ab00f53fea58b091">01466</a> <a class="code" href="../../d6/dda/regparse_8c.html#abe42195fece2fb89ab00f53fea58b091">onig_node_str_set</a>(<a class="code" href="../../d0/d6e/struct___node.html">Node</a>* <a class="code" href="../../d7/dc0/parse_8y.html#a0d7af8a92c4b0a07f71585584ef9634f">node</a>, <span class="keyword">const</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>* s, <span class="keyword">const</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>* end)
<a name="l01467"></a>01467 {
<a name="l01468"></a>01468   <a class="code" href="../../d6/dda/regparse_8c.html#ac2820ba3ea44a85a3e7e8e5f5806350b">onig_node_str_clear</a>(node);
<a name="l01469"></a>01469   <span class="keywordflow">return</span> <a class="code" href="../../d6/dda/regparse_8c.html#a4c9f32699c8567f97bf22053473ec09e">onig_node_str_cat</a>(node, s, end);
<a name="l01470"></a>01470 }
<a name="l01471"></a>01471 
<a name="l01472"></a>01472 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l01473"></a><a class="code" href="../../d6/dda/regparse_8c.html#a749f25c911a2a10579db549fb0100dc0">01473</a> <a class="code" href="../../d6/dda/regparse_8c.html#a749f25c911a2a10579db549fb0100dc0">node_str_cat_char</a>(<a class="code" href="../../d0/d6e/struct___node.html">Node</a>* <a class="code" href="../../d7/dc0/parse_8y.html#a0d7af8a92c4b0a07f71585584ef9634f">node</a>, <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a> c)
<a name="l01474"></a>01474 {
<a name="l01475"></a>01475   <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a> s[1];
<a name="l01476"></a>01476 
<a name="l01477"></a>01477   s[0] = c;
<a name="l01478"></a>01478   <span class="keywordflow">return</span> <a class="code" href="../../d6/dda/regparse_8c.html#a4c9f32699c8567f97bf22053473ec09e">onig_node_str_cat</a>(node, s, s + 1);
<a name="l01479"></a>01479 }
<a name="l01480"></a>01480 
<a name="l01481"></a>01481 <span class="keyword">extern</span> <span class="keywordtype">void</span>
<a name="l01482"></a><a class="code" href="../../d6/dda/regparse_8c.html#a47ef98c51fc32c0e34bd6d917bf1cb74">01482</a> <a class="code" href="../../d6/dda/regparse_8c.html#a47ef98c51fc32c0e34bd6d917bf1cb74">onig_node_conv_to_str_node</a>(<a class="code" href="../../d0/d6e/struct___node.html">Node</a>* <a class="code" href="../../d7/dc0/parse_8y.html#a0d7af8a92c4b0a07f71585584ef9634f">node</a>, <span class="keywordtype">int</span> flag)
<a name="l01483"></a>01483 {
<a name="l01484"></a>01484   <a class="code" href="../../d1/dfc/regparse_8h.html#aa63b31f6718866f81a7efd9263270f82">SET_NTYPE</a>(node, <a class="code" href="../../d1/dfc/regparse_8h.html#ad5d1aafda0801d24b9425f6c01515ed9">NT_STR</a>);
<a name="l01485"></a>01485   <a class="code" href="../../d1/dfc/regparse_8h.html#a24a4b2af18dda01ae000ec64129eb50e">NSTR</a>(node)-&gt;flag = flag;
<a name="l01486"></a>01486   <a class="code" href="../../d1/dfc/regparse_8h.html#a24a4b2af18dda01ae000ec64129eb50e">NSTR</a>(node)-&gt;capa = 0;
<a name="l01487"></a>01487   <a class="code" href="../../d1/dfc/regparse_8h.html#a24a4b2af18dda01ae000ec64129eb50e">NSTR</a>(node)-&gt;s    = <a class="code" href="../../d1/dfc/regparse_8h.html#a24a4b2af18dda01ae000ec64129eb50e">NSTR</a>(node)-&gt;buf;
<a name="l01488"></a>01488   <a class="code" href="../../d1/dfc/regparse_8h.html#a24a4b2af18dda01ae000ec64129eb50e">NSTR</a>(node)-&gt;end  = <a class="code" href="../../d1/dfc/regparse_8h.html#a24a4b2af18dda01ae000ec64129eb50e">NSTR</a>(node)-&gt;buf;
<a name="l01489"></a>01489 }
<a name="l01490"></a>01490 
<a name="l01491"></a>01491 <span class="keyword">extern</span> <span class="keywordtype">void</span>
<a name="l01492"></a><a class="code" href="../../d6/dda/regparse_8c.html#ac2820ba3ea44a85a3e7e8e5f5806350b">01492</a> <a class="code" href="../../d6/dda/regparse_8c.html#ac2820ba3ea44a85a3e7e8e5f5806350b">onig_node_str_clear</a>(<a class="code" href="../../d0/d6e/struct___node.html">Node</a>* <a class="code" href="../../d7/dc0/parse_8y.html#a0d7af8a92c4b0a07f71585584ef9634f">node</a>)
<a name="l01493"></a>01493 {
<a name="l01494"></a>01494   <span class="keywordflow">if</span> (<a class="code" href="../../d1/dfc/regparse_8h.html#a24a4b2af18dda01ae000ec64129eb50e">NSTR</a>(node)-&gt;capa != 0 &amp;&amp;
<a name="l01495"></a>01495       <a class="code" href="../../d6/d87/regint_8h.html#a4bc25fbd4749a2c130d1ae7f15ba140c">IS_NOT_NULL</a>(<a class="code" href="../../d1/dfc/regparse_8h.html#a24a4b2af18dda01ae000ec64129eb50e">NSTR</a>(node)-&gt;s) &amp;&amp; <a class="code" href="../../d1/dfc/regparse_8h.html#a24a4b2af18dda01ae000ec64129eb50e">NSTR</a>(node)-&gt;s != <a class="code" href="../../d1/dfc/regparse_8h.html#a24a4b2af18dda01ae000ec64129eb50e">NSTR</a>(node)-&gt;<a class="code" href="../../d6/da0/nkf-utf8_2nkf_8c.html#ac37f17a60c8b5533aac4840c681f62b8">buf</a>) {
<a name="l01496"></a>01496     <a class="code" href="../../d8/db0/defines_8h.html#a2c3897f7c46ca54a2e0dd7b24a40c7cb">xfree</a>(<a class="code" href="../../d1/dfc/regparse_8h.html#a24a4b2af18dda01ae000ec64129eb50e">NSTR</a>(node)-&gt;s);
<a name="l01497"></a>01497   }
<a name="l01498"></a>01498 
<a name="l01499"></a>01499   <a class="code" href="../../d1/dfc/regparse_8h.html#a24a4b2af18dda01ae000ec64129eb50e">NSTR</a>(node)-&gt;capa = 0;
<a name="l01500"></a>01500   <a class="code" href="../../d1/dfc/regparse_8h.html#a24a4b2af18dda01ae000ec64129eb50e">NSTR</a>(node)-&gt;flag = 0;
<a name="l01501"></a>01501   <a class="code" href="../../d1/dfc/regparse_8h.html#a24a4b2af18dda01ae000ec64129eb50e">NSTR</a>(node)-&gt;s    = <a class="code" href="../../d1/dfc/regparse_8h.html#a24a4b2af18dda01ae000ec64129eb50e">NSTR</a>(node)-&gt;buf;
<a name="l01502"></a>01502   <a class="code" href="../../d1/dfc/regparse_8h.html#a24a4b2af18dda01ae000ec64129eb50e">NSTR</a>(node)-&gt;end  = <a class="code" href="../../d1/dfc/regparse_8h.html#a24a4b2af18dda01ae000ec64129eb50e">NSTR</a>(node)-&gt;buf;
<a name="l01503"></a>01503 }
<a name="l01504"></a>01504 
<a name="l01505"></a>01505 <span class="keyword">static</span> <a class="code" href="../../d0/d6e/struct___node.html">Node</a>*
<a name="l01506"></a><a class="code" href="../../d6/dda/regparse_8c.html#abb2eaf4904c08177eb3e2ed65ad4adcf">01506</a> <a class="code" href="../../d6/dda/regparse_8c.html#abb2eaf4904c08177eb3e2ed65ad4adcf">node_new_str</a>(<span class="keyword">const</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>* s, <span class="keyword">const</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>* end)
<a name="l01507"></a>01507 {
<a name="l01508"></a>01508   <a class="code" href="../../d0/d6e/struct___node.html">Node</a>* <a class="code" href="../../d7/dc0/parse_8y.html#a0d7af8a92c4b0a07f71585584ef9634f">node</a> = <a class="code" href="../../d6/dda/regparse_8c.html#a0dd497b9e45c03476d0a453d1987499c">node_new</a>();
<a name="l01509"></a>01509   <a class="code" href="../../d6/d87/regint_8h.html#a44eb2d3a10149e1d94651052bcdcb2bb">CHECK_NULL_RETURN</a>(node);
<a name="l01510"></a>01510 
<a name="l01511"></a>01511   <a class="code" href="../../d1/dfc/regparse_8h.html#aa63b31f6718866f81a7efd9263270f82">SET_NTYPE</a>(node, <a class="code" href="../../d1/dfc/regparse_8h.html#ad5d1aafda0801d24b9425f6c01515ed9">NT_STR</a>);
<a name="l01512"></a>01512   <a class="code" href="../../d1/dfc/regparse_8h.html#a24a4b2af18dda01ae000ec64129eb50e">NSTR</a>(node)-&gt;capa = 0;
<a name="l01513"></a>01513   <a class="code" href="../../d1/dfc/regparse_8h.html#a24a4b2af18dda01ae000ec64129eb50e">NSTR</a>(node)-&gt;flag = 0;
<a name="l01514"></a>01514   <a class="code" href="../../d1/dfc/regparse_8h.html#a24a4b2af18dda01ae000ec64129eb50e">NSTR</a>(node)-&gt;s    = <a class="code" href="../../d1/dfc/regparse_8h.html#a24a4b2af18dda01ae000ec64129eb50e">NSTR</a>(node)-&gt;buf;
<a name="l01515"></a>01515   <a class="code" href="../../d1/dfc/regparse_8h.html#a24a4b2af18dda01ae000ec64129eb50e">NSTR</a>(node)-&gt;end  = <a class="code" href="../../d1/dfc/regparse_8h.html#a24a4b2af18dda01ae000ec64129eb50e">NSTR</a>(node)-&gt;buf;
<a name="l01516"></a>01516   <span class="keywordflow">if</span> (<a class="code" href="../../d6/dda/regparse_8c.html#a4c9f32699c8567f97bf22053473ec09e">onig_node_str_cat</a>(node, s, end)) {
<a name="l01517"></a>01517     <a class="code" href="../../d6/dda/regparse_8c.html#aa98ee34de192fd4997906389f70f4808">onig_node_free</a>(node);
<a name="l01518"></a>01518     <span class="keywordflow">return</span> <a class="code" href="../../d3/d09/ripper_8y.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01519"></a>01519   }
<a name="l01520"></a>01520   <span class="keywordflow">return</span> node;
<a name="l01521"></a>01521 }
<a name="l01522"></a>01522 
<a name="l01523"></a>01523 <span class="keyword">extern</span> <a class="code" href="../../d0/d6e/struct___node.html">Node</a>*
<a name="l01524"></a><a class="code" href="../../d6/dda/regparse_8c.html#aa43586564529e972a0cc1e7fec489aff">01524</a> <a class="code" href="../../d6/dda/regparse_8c.html#aa43586564529e972a0cc1e7fec489aff">onig_node_new_str</a>(<span class="keyword">const</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>* s, <span class="keyword">const</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>* end)
<a name="l01525"></a>01525 {
<a name="l01526"></a>01526   <span class="keywordflow">return</span> <a class="code" href="../../d6/dda/regparse_8c.html#abb2eaf4904c08177eb3e2ed65ad4adcf">node_new_str</a>(s, end);
<a name="l01527"></a>01527 }
<a name="l01528"></a>01528 
<a name="l01529"></a>01529 <span class="keyword">static</span> <a class="code" href="../../d0/d6e/struct___node.html">Node</a>*
<a name="l01530"></a><a class="code" href="../../d6/dda/regparse_8c.html#a562380d9d821f065083635705ea1d51c">01530</a> <a class="code" href="../../d6/dda/regparse_8c.html#a562380d9d821f065083635705ea1d51c">node_new_str_raw</a>(<a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>* s, <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>* end)
<a name="l01531"></a>01531 {
<a name="l01532"></a>01532   <a class="code" href="../../d0/d6e/struct___node.html">Node</a>* <a class="code" href="../../d7/dc0/parse_8y.html#a0d7af8a92c4b0a07f71585584ef9634f">node</a> = <a class="code" href="../../d6/dda/regparse_8c.html#abb2eaf4904c08177eb3e2ed65ad4adcf">node_new_str</a>(s, end);
<a name="l01533"></a>01533   <a class="code" href="../../d1/dfc/regparse_8h.html#a0b60661ac8af8eec10dbe93c2e0eaad3">NSTRING_SET_RAW</a>(node);
<a name="l01534"></a>01534   <span class="keywordflow">return</span> node;
<a name="l01535"></a>01535 }
<a name="l01536"></a>01536 
<a name="l01537"></a>01537 <span class="keyword">static</span> <a class="code" href="../../d0/d6e/struct___node.html">Node</a>*
<a name="l01538"></a><a class="code" href="../../d6/dda/regparse_8c.html#a989b3c8a59c2bd7c3b1d33849ebc59e3">01538</a> <a class="code" href="../../d6/dda/regparse_8c.html#a989b3c8a59c2bd7c3b1d33849ebc59e3">node_new_empty</a>(<span class="keywordtype">void</span>)
<a name="l01539"></a>01539 {
<a name="l01540"></a>01540   <span class="keywordflow">return</span> <a class="code" href="../../d6/dda/regparse_8c.html#abb2eaf4904c08177eb3e2ed65ad4adcf">node_new_str</a>(<a class="code" href="../../d3/d09/ripper_8y.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d3/d09/ripper_8y.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l01541"></a>01541 }
<a name="l01542"></a>01542 
<a name="l01543"></a>01543 <span class="keyword">static</span> <a class="code" href="../../d0/d6e/struct___node.html">Node</a>*
<a name="l01544"></a><a class="code" href="../../d6/dda/regparse_8c.html#acae68a89de83097271f990cce054a0ec">01544</a> <a class="code" href="../../d6/dda/regparse_8c.html#acae68a89de83097271f990cce054a0ec">node_new_str_raw_char</a>(<a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a> c)
<a name="l01545"></a>01545 {
<a name="l01546"></a>01546   <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a> p[1];
<a name="l01547"></a>01547 
<a name="l01548"></a>01548   p[0] = c;
<a name="l01549"></a>01549   <span class="keywordflow">return</span> <a class="code" href="../../d6/dda/regparse_8c.html#a562380d9d821f065083635705ea1d51c">node_new_str_raw</a>(p, p + 1);
<a name="l01550"></a>01550 }
<a name="l01551"></a>01551 
<a name="l01552"></a>01552 <span class="keyword">static</span> <a class="code" href="../../d0/d6e/struct___node.html">Node</a>*
<a name="l01553"></a><a class="code" href="../../d6/dda/regparse_8c.html#a5a7bcd095caf1c5e0a32107d91530bb2">01553</a> <a class="code" href="../../d6/dda/regparse_8c.html#a5a7bcd095caf1c5e0a32107d91530bb2">str_node_split_last_char</a>(<a class="code" href="../../d2/db7/struct_str_node.html">StrNode</a>* sn, <a class="code" href="../../d1/d7b/struct_onig_encoding_type_s_t.html">OnigEncoding</a> enc)
<a name="l01554"></a>01554 {
<a name="l01555"></a>01555   <span class="keyword">const</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a> *p;
<a name="l01556"></a>01556   <a class="code" href="../../d0/d6e/struct___node.html">Node</a>* n = <a class="code" href="../../d3/d7f/gram_8c.html#ac00d2982d51115efbe8a13840d47b7a7">NULL_NODE</a>;
<a name="l01557"></a>01557 
<a name="l01558"></a>01558   <span class="keywordflow">if</span> (sn-&gt;<a class="code" href="../../d2/db7/struct_str_node.html#abf9ee3af9216b1e5d2724692a339d2bf">end</a> &gt; sn-&gt;<a class="code" href="../../d2/db7/struct_str_node.html#a8b07267d3e1ef65804a2888ed2f46211">s</a>) {
<a name="l01559"></a>01559     p = <a class="code" href="../../d6/d8e/regenc_8c.html#ac4ab9e1bfcb6b9ce53d2818ddc2c7051">onigenc_get_prev_char_head</a>(enc, sn-&gt;<a class="code" href="../../d2/db7/struct_str_node.html#a8b07267d3e1ef65804a2888ed2f46211">s</a>, sn-&gt;<a class="code" href="../../d2/db7/struct_str_node.html#abf9ee3af9216b1e5d2724692a339d2bf">end</a>, sn-&gt;<a class="code" href="../../d2/db7/struct_str_node.html#abf9ee3af9216b1e5d2724692a339d2bf">end</a>);
<a name="l01560"></a>01560     <span class="keywordflow">if</span> (p &amp;&amp; p &gt; sn-&gt;<a class="code" href="../../d2/db7/struct_str_node.html#a8b07267d3e1ef65804a2888ed2f46211">s</a>) { <span class="comment">/* can be splitted. */</span>
<a name="l01561"></a>01561       n = <a class="code" href="../../d6/dda/regparse_8c.html#abb2eaf4904c08177eb3e2ed65ad4adcf">node_new_str</a>(p, sn-&gt;<a class="code" href="../../d2/db7/struct_str_node.html#abf9ee3af9216b1e5d2724692a339d2bf">end</a>);
<a name="l01562"></a>01562       <span class="keywordflow">if</span> ((sn-&gt;<a class="code" href="../../d2/db7/struct_str_node.html#a8c85cb0d523f77cab8a78ff094043aca">flag</a> &amp; <a class="code" href="../../d1/dfc/regparse_8h.html#a585ac9a272500b052dca9237e074664f">NSTR_RAW</a>) != 0)
<a name="l01563"></a>01563         <a class="code" href="../../d1/dfc/regparse_8h.html#a0b60661ac8af8eec10dbe93c2e0eaad3">NSTRING_SET_RAW</a>(n);
<a name="l01564"></a>01564       sn-&gt;<a class="code" href="../../d2/db7/struct_str_node.html#abf9ee3af9216b1e5d2724692a339d2bf">end</a> = (<a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>* )p;
<a name="l01565"></a>01565     }
<a name="l01566"></a>01566   }
<a name="l01567"></a>01567   <span class="keywordflow">return</span> n;
<a name="l01568"></a>01568 }
<a name="l01569"></a>01569 
<a name="l01570"></a>01570 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l01571"></a><a class="code" href="../../d6/dda/regparse_8c.html#a2b69c9575ebabd08f63f66a20a375885">01571</a> <a class="code" href="../../d6/dda/regparse_8c.html#a2b69c9575ebabd08f63f66a20a375885">str_node_can_be_split</a>(<a class="code" href="../../d2/db7/struct_str_node.html">StrNode</a>* sn, <a class="code" href="../../d1/d7b/struct_onig_encoding_type_s_t.html">OnigEncoding</a> enc)
<a name="l01572"></a>01572 {
<a name="l01573"></a>01573   <span class="keywordflow">if</span> (sn-&gt;<a class="code" href="../../d2/db7/struct_str_node.html#abf9ee3af9216b1e5d2724692a339d2bf">end</a> &gt; sn-&gt;<a class="code" href="../../d2/db7/struct_str_node.html#a8b07267d3e1ef65804a2888ed2f46211">s</a>) {
<a name="l01574"></a>01574     <span class="keywordflow">return</span> ((<a class="code" href="../../d3/d09/ripper_8y.html#ae9f8530a4c9ec89ae8d62ce5b4410aad">enclen</a>(enc, sn-&gt;<a class="code" href="../../d2/db7/struct_str_node.html#a8b07267d3e1ef65804a2888ed2f46211">s</a>, sn-&gt;<a class="code" href="../../d2/db7/struct_str_node.html#abf9ee3af9216b1e5d2724692a339d2bf">end</a>) &lt; sn-&gt;<a class="code" href="../../d2/db7/struct_str_node.html#abf9ee3af9216b1e5d2724692a339d2bf">end</a> - sn-&gt;<a class="code" href="../../d2/db7/struct_str_node.html#a8b07267d3e1ef65804a2888ed2f46211">s</a>)  ?  1 : 0);
<a name="l01575"></a>01575   }
<a name="l01576"></a>01576   <span class="keywordflow">return</span> 0;
<a name="l01577"></a>01577 }
<a name="l01578"></a>01578 
<a name="l01579"></a>01579 <span class="preprocessor">#ifdef USE_PAD_TO_SHORT_BYTE_CHAR</span>
<a name="l01580"></a>01580 <span class="preprocessor"></span><span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l01581"></a>01581 node_str_head_pad(<a class="code" href="../../d2/db7/struct_str_node.html">StrNode</a>* sn, <span class="keywordtype">int</span> num, <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a> val)
<a name="l01582"></a>01582 {
<a name="l01583"></a>01583   <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a> <a class="code" href="../../d6/da0/nkf-utf8_2nkf_8c.html#ac37f17a60c8b5533aac4840c681f62b8">buf</a>[<a class="code" href="../../d1/dfc/regparse_8h.html#a9814d431677483621091229d7500e1d6">NODE_STR_BUF_SIZE</a>];
<a name="l01584"></a>01584   <span class="keywordtype">int</span> i, len;
<a name="l01585"></a>01585 
<a name="l01586"></a>01586   len = sn-&gt;<a class="code" href="../../d2/db7/struct_str_node.html#abf9ee3af9216b1e5d2724692a339d2bf">end</a> - sn-&gt;<a class="code" href="../../d2/db7/struct_str_node.html#a8b07267d3e1ef65804a2888ed2f46211">s</a>;
<a name="l01587"></a>01587   <a class="code" href="../../d6/dda/regparse_8c.html#ae1ec1f619a502e243e88146945e3e911">onig_strcpy</a>(buf, sn-&gt;<a class="code" href="../../d2/db7/struct_str_node.html#a8b07267d3e1ef65804a2888ed2f46211">s</a>, sn-&gt;<a class="code" href="../../d2/db7/struct_str_node.html#abf9ee3af9216b1e5d2724692a339d2bf">end</a>);
<a name="l01588"></a>01588   <a class="code" href="../../d6/dda/regparse_8c.html#ae1ec1f619a502e243e88146945e3e911">onig_strcpy</a>(&amp;(sn-&gt;<a class="code" href="../../d2/db7/struct_str_node.html#a8b07267d3e1ef65804a2888ed2f46211">s</a>[num]), buf, buf + len);
<a name="l01589"></a>01589   sn-&gt;<a class="code" href="../../d2/db7/struct_str_node.html#abf9ee3af9216b1e5d2724692a339d2bf">end</a> += num;
<a name="l01590"></a>01590 
<a name="l01591"></a>01591   <span class="keywordflow">for</span> (i = 0; i &lt; num; i++) {
<a name="l01592"></a>01592     sn-&gt;<a class="code" href="../../d2/db7/struct_str_node.html#a8b07267d3e1ef65804a2888ed2f46211">s</a>[i] = val;
<a name="l01593"></a>01593   }
<a name="l01594"></a>01594 }
<a name="l01595"></a>01595 <span class="preprocessor">#endif</span>
<a name="l01596"></a>01596 <span class="preprocessor"></span>
<a name="l01597"></a>01597 <span class="keyword">extern</span> <span class="keywordtype">int</span>
<a name="l01598"></a><a class="code" href="../../d6/dda/regparse_8c.html#af172b663db06124c2c4b62a7e1377472">01598</a> <a class="code" href="../../d6/dda/regparse_8c.html#af172b663db06124c2c4b62a7e1377472">onig_scan_unsigned_number</a>(<a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>** src, <span class="keyword">const</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>* end, <a class="code" href="../../d1/d7b/struct_onig_encoding_type_s_t.html">OnigEncoding</a> enc)
<a name="l01599"></a>01599 {
<a name="l01600"></a>01600   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> num, val;
<a name="l01601"></a>01601   <a class="code" href="../../d8/db3/oniguruma_8h.html#a7c8a84bc12127007886efbfcf53b6fb5">OnigCodePoint</a> c;
<a name="l01602"></a>01602   <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>* p = *src;
<a name="l01603"></a>01603   <a class="code" href="../../d6/dda/regparse_8c.html#a44975cffe07e4559bf5638cafb4a6b30">PFETCH_READY</a>;
<a name="l01604"></a>01604 
<a name="l01605"></a>01605   num = 0;
<a name="l01606"></a>01606   <span class="keywordflow">while</span> (!<a class="code" href="../../d6/dda/regparse_8c.html#a43ce1d83d1961694adc2dfcbfac7d690">PEND</a>) {
<a name="l01607"></a>01607     <a class="code" href="../../d6/dda/regparse_8c.html#a8a8898c873b81a88454a968371696cab">PFETCH</a>(c);
<a name="l01608"></a>01608     <span class="keywordflow">if</span> (<a class="code" href="../../d8/db3/oniguruma_8h.html#a5ce23077f30d0af86e623ee1e0838a2e">ONIGENC_IS_CODE_DIGIT</a>(enc, c)) {
<a name="l01609"></a>01609       val = (<span class="keywordtype">unsigned</span> int )<a class="code" href="../../d6/d87/regint_8h.html#a17b1aae870bcd4f2c344528a3b7a3427">DIGITVAL</a>(c);
<a name="l01610"></a>01610       <span class="keywordflow">if</span> ((<a class="code" href="../../d6/d87/regint_8h.html#a00e039dc44978566a93730f99751dbed">INT_MAX_LIMIT</a> - val) / 10UL &lt; num)
<a name="l01611"></a>01611         <span class="keywordflow">return</span> -1;  <span class="comment">/* overflow */</span>
<a name="l01612"></a>01612 
<a name="l01613"></a>01613       num = num * 10 + val;
<a name="l01614"></a>01614     }
<a name="l01615"></a>01615     <span class="keywordflow">else</span> {
<a name="l01616"></a>01616       <a class="code" href="../../d6/dda/regparse_8c.html#ad0350add3c44d502c77357f6012b1bf2">PUNFETCH</a>;
<a name="l01617"></a>01617       <span class="keywordflow">break</span>;
<a name="l01618"></a>01618     }
<a name="l01619"></a>01619   }
<a name="l01620"></a>01620   *src = p;
<a name="l01621"></a>01621   <span class="keywordflow">return</span> num;
<a name="l01622"></a>01622 }
<a name="l01623"></a>01623 
<a name="l01624"></a>01624 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l01625"></a><a class="code" href="../../d6/dda/regparse_8c.html#ac28095d363fabc3f8e789710b8b41df1">01625</a> <a class="code" href="../../d6/dda/regparse_8c.html#ac28095d363fabc3f8e789710b8b41df1">scan_unsigned_hexadecimal_number</a>(<a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>** src, <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>* end, <span class="keywordtype">int</span> maxlen,
<a name="l01626"></a>01626                                  <a class="code" href="../../d1/d7b/struct_onig_encoding_type_s_t.html">OnigEncoding</a> enc)
<a name="l01627"></a>01627 {
<a name="l01628"></a>01628   <a class="code" href="../../d8/db3/oniguruma_8h.html#a7c8a84bc12127007886efbfcf53b6fb5">OnigCodePoint</a> c;
<a name="l01629"></a>01629   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> num, val;
<a name="l01630"></a>01630   <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>* p = *src;
<a name="l01631"></a>01631   <a class="code" href="../../d6/dda/regparse_8c.html#a44975cffe07e4559bf5638cafb4a6b30">PFETCH_READY</a>;
<a name="l01632"></a>01632 
<a name="l01633"></a>01633   num = 0;
<a name="l01634"></a>01634   <span class="keywordflow">while</span> (!<a class="code" href="../../d6/dda/regparse_8c.html#a43ce1d83d1961694adc2dfcbfac7d690">PEND</a> &amp;&amp; maxlen-- != 0) {
<a name="l01635"></a>01635     <a class="code" href="../../d6/dda/regparse_8c.html#a8a8898c873b81a88454a968371696cab">PFETCH</a>(c);
<a name="l01636"></a>01636     <span class="keywordflow">if</span> (<a class="code" href="../../d8/db3/oniguruma_8h.html#a4aa7f107cf374fefbc0633d94a5477a0">ONIGENC_IS_CODE_XDIGIT</a>(enc, c)) {
<a name="l01637"></a>01637       val = (<span class="keywordtype">unsigned</span> int )<a class="code" href="../../d6/d87/regint_8h.html#ad59a0a4554c9f12ea8a14e2b4bb068a6">XDIGITVAL</a>(enc,c);
<a name="l01638"></a>01638       <span class="keywordflow">if</span> ((<a class="code" href="../../d6/d87/regint_8h.html#a00e039dc44978566a93730f99751dbed">INT_MAX_LIMIT</a> - val) / 16UL &lt; num)
<a name="l01639"></a>01639         <span class="keywordflow">return</span> -1;  <span class="comment">/* overflow */</span>
<a name="l01640"></a>01640 
<a name="l01641"></a>01641       num = (num &lt;&lt; 4) + <a class="code" href="../../d6/d87/regint_8h.html#ad59a0a4554c9f12ea8a14e2b4bb068a6">XDIGITVAL</a>(enc,c);
<a name="l01642"></a>01642     }
<a name="l01643"></a>01643     <span class="keywordflow">else</span> {
<a name="l01644"></a>01644       <a class="code" href="../../d6/dda/regparse_8c.html#ad0350add3c44d502c77357f6012b1bf2">PUNFETCH</a>;
<a name="l01645"></a>01645       <span class="keywordflow">break</span>;
<a name="l01646"></a>01646     }
<a name="l01647"></a>01647   }
<a name="l01648"></a>01648   *src = p;
<a name="l01649"></a>01649   <span class="keywordflow">return</span> num;
<a name="l01650"></a>01650 }
<a name="l01651"></a>01651 
<a name="l01652"></a>01652 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l01653"></a><a class="code" href="../../d6/dda/regparse_8c.html#af9a4fd42a5f01d15769e6c8640fa40d7">01653</a> <a class="code" href="../../d6/dda/regparse_8c.html#af9a4fd42a5f01d15769e6c8640fa40d7">scan_unsigned_octal_number</a>(<a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>** src, <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>* end, <span class="keywordtype">int</span> maxlen,
<a name="l01654"></a>01654                            <a class="code" href="../../d1/d7b/struct_onig_encoding_type_s_t.html">OnigEncoding</a> enc)
<a name="l01655"></a>01655 {
<a name="l01656"></a>01656   <a class="code" href="../../d8/db3/oniguruma_8h.html#a7c8a84bc12127007886efbfcf53b6fb5">OnigCodePoint</a> c;
<a name="l01657"></a>01657   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> num, val;
<a name="l01658"></a>01658   <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>* p = *src;
<a name="l01659"></a>01659   <a class="code" href="../../d6/dda/regparse_8c.html#a44975cffe07e4559bf5638cafb4a6b30">PFETCH_READY</a>;
<a name="l01660"></a>01660 
<a name="l01661"></a>01661   num = 0;
<a name="l01662"></a>01662   <span class="keywordflow">while</span> (!<a class="code" href="../../d6/dda/regparse_8c.html#a43ce1d83d1961694adc2dfcbfac7d690">PEND</a> &amp;&amp; maxlen-- != 0) {
<a name="l01663"></a>01663     <a class="code" href="../../d6/dda/regparse_8c.html#a8a8898c873b81a88454a968371696cab">PFETCH</a>(c);
<a name="l01664"></a>01664     <span class="keywordflow">if</span> (<a class="code" href="../../d8/db3/oniguruma_8h.html#a5ce23077f30d0af86e623ee1e0838a2e">ONIGENC_IS_CODE_DIGIT</a>(enc, c) &amp;&amp; c &lt; <span class="charliteral">&apos;8&apos;</span>) {
<a name="l01665"></a>01665       val = <a class="code" href="../../d6/d87/regint_8h.html#a935508703d753791e556c09f074a56af">ODIGITVAL</a>(c);
<a name="l01666"></a>01666       <span class="keywordflow">if</span> ((<a class="code" href="../../d6/d87/regint_8h.html#a00e039dc44978566a93730f99751dbed">INT_MAX_LIMIT</a> - val) / 8UL &lt; num)
<a name="l01667"></a>01667         <span class="keywordflow">return</span> -1;  <span class="comment">/* overflow */</span>
<a name="l01668"></a>01668 
<a name="l01669"></a>01669       num = (num &lt;&lt; 3) + val;
<a name="l01670"></a>01670     }
<a name="l01671"></a>01671     <span class="keywordflow">else</span> {
<a name="l01672"></a>01672       <a class="code" href="../../d6/dda/regparse_8c.html#ad0350add3c44d502c77357f6012b1bf2">PUNFETCH</a>;
<a name="l01673"></a>01673       <span class="keywordflow">break</span>;
<a name="l01674"></a>01674     }
<a name="l01675"></a>01675   }
<a name="l01676"></a>01676   *src = p;
<a name="l01677"></a>01677   <span class="keywordflow">return</span> num;
<a name="l01678"></a>01678 }
<a name="l01679"></a>01679 
<a name="l01680"></a>01680 
<a name="l01681"></a><a class="code" href="../../d6/dda/regparse_8c.html#adad4f4bfe360866cc4493f0260b2f7f7">01681</a> <span class="preprocessor">#define BBUF_WRITE_CODE_POINT(bbuf,pos,code) \</span>
<a name="l01682"></a>01682 <span class="preprocessor">    BBUF_WRITE(bbuf, pos, &amp;(code), SIZE_CODE_POINT)</span>
<a name="l01683"></a>01683 <span class="preprocessor"></span>
<a name="l01684"></a>01684 <span class="comment">/* data format:</span>
<a name="l01685"></a>01685 <span class="comment">     [n][from-1][to-1][from-2][to-2] ... [from-n][to-n]</span>
<a name="l01686"></a>01686 <span class="comment">     (all data size is OnigCodePoint)</span>
<a name="l01687"></a>01687 <span class="comment"> */</span>
<a name="l01688"></a>01688 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l01689"></a><a class="code" href="../../d6/dda/regparse_8c.html#a68c715d629ff5424d853963189739b05">01689</a> <a class="code" href="../../d6/dda/regparse_8c.html#a68c715d629ff5424d853963189739b05">new_code_range</a>(<a class="code" href="../../d0/deb/struct___b_buf.html">BBuf</a>** pbuf)
<a name="l01690"></a>01690 {
<a name="l01691"></a>01691 <span class="preprocessor">#define INIT_MULTI_BYTE_RANGE_SIZE  (SIZE_CODE_POINT * 5)</span>
<a name="l01692"></a>01692 <span class="preprocessor"></span>  <span class="keywordtype">int</span> r;
<a name="l01693"></a>01693   <a class="code" href="../../d8/db3/oniguruma_8h.html#a7c8a84bc12127007886efbfcf53b6fb5">OnigCodePoint</a> n;
<a name="l01694"></a>01694   <a class="code" href="../../d0/deb/struct___b_buf.html">BBuf</a>* bbuf;
<a name="l01695"></a>01695 
<a name="l01696"></a>01696   bbuf = *pbuf = (<a class="code" href="../../d0/deb/struct___b_buf.html">BBuf</a>* )<a class="code" href="../../d8/db0/defines_8h.html#a6af5faec3f9662b20ffc9903f923dec0">xmalloc</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../d0/deb/struct___b_buf.html">BBuf</a>));
<a name="l01697"></a>01697   <a class="code" href="../../d6/d87/regint_8h.html#a17ebb2a12300dcf6d79916e357fae45a">CHECK_NULL_RETURN_MEMERR</a>(*pbuf);
<a name="l01698"></a>01698   r = <a class="code" href="../../d6/d87/regint_8h.html#a791a20675ed654805f305bd867813a89">BBUF_INIT</a>(*pbuf, <a class="code" href="../../d6/dda/regparse_8c.html#a05089d592d1f5a0e630301d37dd8e27f">INIT_MULTI_BYTE_RANGE_SIZE</a>);
<a name="l01699"></a>01699   <span class="keywordflow">if</span> (r) <span class="keywordflow">return</span> r;
<a name="l01700"></a>01700 
<a name="l01701"></a>01701   n = 0;
<a name="l01702"></a>01702   <a class="code" href="../../d6/dda/regparse_8c.html#adad4f4bfe360866cc4493f0260b2f7f7">BBUF_WRITE_CODE_POINT</a>(bbuf, 0, n);
<a name="l01703"></a>01703   <span class="keywordflow">return</span> 0;
<a name="l01704"></a>01704 }
<a name="l01705"></a>01705 
<a name="l01706"></a>01706 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l01707"></a><a class="code" href="../../d6/dda/regparse_8c.html#ad2c85a5d29ed3bf23b4db4cbe5d67961">01707</a> <a class="code" href="../../d6/dda/regparse_8c.html#ad2c85a5d29ed3bf23b4db4cbe5d67961">add_code_range_to_buf0</a>(<a class="code" href="../../d0/deb/struct___b_buf.html">BBuf</a>** pbuf, <a class="code" href="../../d6/dbe/struct_scan_env.html">ScanEnv</a>* env, <a class="code" href="../../d8/db3/oniguruma_8h.html#a7c8a84bc12127007886efbfcf53b6fb5">OnigCodePoint</a> from, <a class="code" href="../../d8/db3/oniguruma_8h.html#a7c8a84bc12127007886efbfcf53b6fb5">OnigCodePoint</a> to,
<a name="l01708"></a>01708         <span class="keywordtype">int</span> checkdup)
<a name="l01709"></a>01709 {
<a name="l01710"></a>01710   <span class="keywordtype">int</span> r, inc_n, pos;
<a name="l01711"></a>01711   <span class="keywordtype">int</span> low, high, bound, x;
<a name="l01712"></a>01712   <a class="code" href="../../d8/db3/oniguruma_8h.html#a7c8a84bc12127007886efbfcf53b6fb5">OnigCodePoint</a> n, *data;
<a name="l01713"></a>01713   <a class="code" href="../../d0/deb/struct___b_buf.html">BBuf</a>* bbuf;
<a name="l01714"></a>01714 
<a name="l01715"></a>01715   <span class="keywordflow">if</span> (from &gt; to) {
<a name="l01716"></a>01716     n = from; from = to; to = n;
<a name="l01717"></a>01717   }
<a name="l01718"></a>01718 
<a name="l01719"></a>01719   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d87/regint_8h.html#a91a9c9242dc3810582965d1882d1894d">IS_NULL</a>(*pbuf)) {
<a name="l01720"></a>01720     r = <a class="code" href="../../d6/dda/regparse_8c.html#a68c715d629ff5424d853963189739b05">new_code_range</a>(pbuf);
<a name="l01721"></a>01721     <span class="keywordflow">if</span> (r) <span class="keywordflow">return</span> r;
<a name="l01722"></a>01722     bbuf = *pbuf;
<a name="l01723"></a>01723     n = 0;
<a name="l01724"></a>01724   }
<a name="l01725"></a>01725   <span class="keywordflow">else</span> {
<a name="l01726"></a>01726     bbuf = *pbuf;
<a name="l01727"></a>01727     <a class="code" href="../../d6/d87/regint_8h.html#a90db6270cec0f45da03f16ce0590eecf">GET_CODE_POINT</a>(n, bbuf-&gt;<a class="code" href="../../d0/deb/struct___b_buf.html#a3d79f476af8e7a57dd240e68f11867a1">p</a>);
<a name="l01728"></a>01728   }
<a name="l01729"></a>01729   data = (<a class="code" href="../../d8/db3/oniguruma_8h.html#a7c8a84bc12127007886efbfcf53b6fb5">OnigCodePoint</a>* )(bbuf-&gt;<a class="code" href="../../d0/deb/struct___b_buf.html#a3d79f476af8e7a57dd240e68f11867a1">p</a>);
<a name="l01730"></a>01730   data++;
<a name="l01731"></a>01731 
<a name="l01732"></a>01732   <span class="keywordflow">for</span> (low = 0, bound = n; low &lt; bound; ) {
<a name="l01733"></a>01733     x = (low + bound) &gt;&gt; 1;
<a name="l01734"></a>01734     <span class="keywordflow">if</span> (from &gt; data[x*2 + 1])
<a name="l01735"></a>01735       low = x + 1;
<a name="l01736"></a>01736     <span class="keywordflow">else</span>
<a name="l01737"></a>01737       bound = x;
<a name="l01738"></a>01738   }
<a name="l01739"></a>01739 
<a name="l01740"></a>01740   <span class="keywordflow">for</span> (high = low, bound = n; high &lt; bound; ) {
<a name="l01741"></a>01741     x = (high + bound) &gt;&gt; 1;
<a name="l01742"></a>01742     <span class="keywordflow">if</span> (to &gt;= data[x*2] - 1)
<a name="l01743"></a>01743       high = x + 1;
<a name="l01744"></a>01744     <span class="keywordflow">else</span>
<a name="l01745"></a>01745       bound = x;
<a name="l01746"></a>01746   }
<a name="l01747"></a>01747   <span class="comment">/* data[(low-1)*2+1] &lt;&lt; from &lt;= data[low*2]</span>
<a name="l01748"></a>01748 <span class="comment">   * data[(high-1)*2+1] &lt;= to &lt;&lt; data[high*2]</span>
<a name="l01749"></a>01749 <span class="comment">   */</span>
<a name="l01750"></a>01750 
<a name="l01751"></a>01751   inc_n = low + 1 - high;
<a name="l01752"></a>01752   <span class="keywordflow">if</span> (n + inc_n &gt; <a class="code" href="../../d8/db3/oniguruma_8h.html#af2fccf85f0e6f89b4b572a3cc2334afb">ONIG_MAX_MULTI_BYTE_RANGES_NUM</a>)
<a name="l01753"></a>01753     <span class="keywordflow">return</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#aa6ff0cd7eb2a865cc602b52a054d4d6e">ONIGERR_TOO_MANY_MULTI_BYTE_RANGES</a>;
<a name="l01754"></a>01754 
<a name="l01755"></a>01755   <span class="keywordflow">if</span> (inc_n != 1) {
<a name="l01756"></a>01756     <span class="keywordflow">if</span> (checkdup &amp;&amp; from &lt;= data[low*2+1]
<a name="l01757"></a>01757         &amp;&amp; (data[low*2] &lt;= from  || data[low*2+1] &lt;= to))
<a name="l01758"></a>01758         <a class="code" href="../../d6/dda/regparse_8c.html#af3eccf7a260f9d9f50a8be9c54502a1f">CC_DUP_WARN</a>(env);
<a name="l01759"></a>01759     <span class="keywordflow">if</span> (from &gt; data[low*2])
<a name="l01760"></a>01760       from = data[low*2];
<a name="l01761"></a>01761     <span class="keywordflow">if</span> (to &lt; data[(high - 1)*2 + 1])
<a name="l01762"></a>01762       to = data[(high - 1)*2 + 1];
<a name="l01763"></a>01763   }
<a name="l01764"></a>01764 
<a name="l01765"></a>01765   <span class="keywordflow">if</span> (inc_n != 0 &amp;&amp; (<a class="code" href="../../d8/db3/oniguruma_8h.html#a7c8a84bc12127007886efbfcf53b6fb5">OnigCodePoint</a> )high &lt; n) {
<a name="l01766"></a>01766     <span class="keywordtype">int</span> from_pos = <a class="code" href="../../d6/d87/regint_8h.html#a99f3148d8a6f4cbaede285b574ba8882">SIZE_CODE_POINT</a> * (1 + high * 2);
<a name="l01767"></a>01767     <span class="keywordtype">int</span> to_pos   = <a class="code" href="../../d6/d87/regint_8h.html#a99f3148d8a6f4cbaede285b574ba8882">SIZE_CODE_POINT</a> * (1 + (low + 1) * 2);
<a name="l01768"></a>01768     <span class="keywordtype">int</span> <a class="code" href="../../d5/db5/encoding_8c.html#a439227feff9d7f55384e8780cfc2eb82">size</a> = (n - high) * 2 * <a class="code" href="../../d6/d87/regint_8h.html#a99f3148d8a6f4cbaede285b574ba8882">SIZE_CODE_POINT</a>;
<a name="l01769"></a>01769 
<a name="l01770"></a>01770     <span class="keywordflow">if</span> (inc_n &gt; 0) {
<a name="l01771"></a>01771       <a class="code" href="../../d6/d87/regint_8h.html#a0cfb8c2a26e045dc2ac8729568182f29">BBUF_MOVE_RIGHT</a>(bbuf, from_pos, to_pos, size);
<a name="l01772"></a>01772     }
<a name="l01773"></a>01773     <span class="keywordflow">else</span> {
<a name="l01774"></a>01774       <a class="code" href="../../d6/d87/regint_8h.html#a12340cf3fe482170f11ea66aa7f5eddb">BBUF_MOVE_LEFT_REDUCE</a>(bbuf, from_pos, to_pos);
<a name="l01775"></a>01775     }
<a name="l01776"></a>01776   }
<a name="l01777"></a>01777 
<a name="l01778"></a>01778   pos = <a class="code" href="../../d6/d87/regint_8h.html#a99f3148d8a6f4cbaede285b574ba8882">SIZE_CODE_POINT</a> * (1 + low * 2);
<a name="l01779"></a>01779   <a class="code" href="../../d6/d87/regint_8h.html#a2501efb6020169f0335db912f33ca129">BBUF_ENSURE_SIZE</a>(bbuf, pos + <a class="code" href="../../d6/d87/regint_8h.html#a99f3148d8a6f4cbaede285b574ba8882">SIZE_CODE_POINT</a> * 2);
<a name="l01780"></a>01780   <a class="code" href="../../d6/dda/regparse_8c.html#adad4f4bfe360866cc4493f0260b2f7f7">BBUF_WRITE_CODE_POINT</a>(bbuf, pos, from);
<a name="l01781"></a>01781   <a class="code" href="../../d6/dda/regparse_8c.html#adad4f4bfe360866cc4493f0260b2f7f7">BBUF_WRITE_CODE_POINT</a>(bbuf, pos + <a class="code" href="../../d6/d87/regint_8h.html#a99f3148d8a6f4cbaede285b574ba8882">SIZE_CODE_POINT</a>, to);
<a name="l01782"></a>01782   n += inc_n;
<a name="l01783"></a>01783   <a class="code" href="../../d6/dda/regparse_8c.html#adad4f4bfe360866cc4493f0260b2f7f7">BBUF_WRITE_CODE_POINT</a>(bbuf, 0, n);
<a name="l01784"></a>01784 
<a name="l01785"></a>01785   <span class="keywordflow">return</span> 0;
<a name="l01786"></a>01786 }
<a name="l01787"></a>01787 
<a name="l01788"></a>01788 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l01789"></a><a class="code" href="../../d6/dda/regparse_8c.html#a4a737460fe75cbdeebcb1a4a2738358c">01789</a> <a class="code" href="../../d6/dda/regparse_8c.html#a4a737460fe75cbdeebcb1a4a2738358c">add_code_range_to_buf</a>(<a class="code" href="../../d0/deb/struct___b_buf.html">BBuf</a>** pbuf, <a class="code" href="../../d6/dbe/struct_scan_env.html">ScanEnv</a>* env, <a class="code" href="../../d8/db3/oniguruma_8h.html#a7c8a84bc12127007886efbfcf53b6fb5">OnigCodePoint</a> from, <a class="code" href="../../d8/db3/oniguruma_8h.html#a7c8a84bc12127007886efbfcf53b6fb5">OnigCodePoint</a> to)
<a name="l01790"></a>01790 {
<a name="l01791"></a>01791   <span class="keywordflow">return</span> <a class="code" href="../../d6/dda/regparse_8c.html#ad2c85a5d29ed3bf23b4db4cbe5d67961">add_code_range_to_buf0</a>(pbuf, env, from, to, 1);
<a name="l01792"></a>01792 }
<a name="l01793"></a>01793 
<a name="l01794"></a>01794 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l01795"></a><a class="code" href="../../d6/dda/regparse_8c.html#acf95eb846040766dbd346b81ee63dc06">01795</a> <a class="code" href="../../d6/dda/regparse_8c.html#acf95eb846040766dbd346b81ee63dc06">add_code_range0</a>(<a class="code" href="../../d0/deb/struct___b_buf.html">BBuf</a>** pbuf, <a class="code" href="../../d6/dbe/struct_scan_env.html">ScanEnv</a>* env, <a class="code" href="../../d8/db3/oniguruma_8h.html#a7c8a84bc12127007886efbfcf53b6fb5">OnigCodePoint</a> from, <a class="code" href="../../d8/db3/oniguruma_8h.html#a7c8a84bc12127007886efbfcf53b6fb5">OnigCodePoint</a> to, <span class="keywordtype">int</span> checkdup)
<a name="l01796"></a>01796 {
<a name="l01797"></a>01797   <span class="keywordflow">if</span> (from &gt; to) {
<a name="l01798"></a>01798     <span class="keywordflow">if</span> (<a class="code" href="../../d1/dfc/regparse_8h.html#a18bfc9ee154d6dd516347bd71b4810f6">IS_SYNTAX_BV</a>(env-&gt;<a class="code" href="../../d6/dbe/struct_scan_env.html#ae5c4502ad7b7a4a418eda464919d2bda">syntax</a>, <a class="code" href="../../d8/db3/oniguruma_8h.html#af9e3b558a77c0236af963af79f95f4ae">ONIG_SYN_ALLOW_EMPTY_RANGE_IN_CC</a>))
<a name="l01799"></a>01799       <span class="keywordflow">return</span> 0;
<a name="l01800"></a>01800     <span class="keywordflow">else</span>
<a name="l01801"></a>01801       <span class="keywordflow">return</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#a0de83e3a45bf4467e70afd55f353a269">ONIGERR_EMPTY_RANGE_IN_CHAR_CLASS</a>;
<a name="l01802"></a>01802   }
<a name="l01803"></a>01803 
<a name="l01804"></a>01804   <span class="keywordflow">return</span> <a class="code" href="../../d6/dda/regparse_8c.html#ad2c85a5d29ed3bf23b4db4cbe5d67961">add_code_range_to_buf0</a>(pbuf, env, from, to, checkdup);
<a name="l01805"></a>01805 }
<a name="l01806"></a>01806 
<a name="l01807"></a>01807 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l01808"></a><a class="code" href="../../d6/dda/regparse_8c.html#a6f589d793cc94713e0ec3a9ffa861b3a">01808</a> <a class="code" href="../../d6/dda/regparse_8c.html#a6f589d793cc94713e0ec3a9ffa861b3a">add_code_range</a>(<a class="code" href="../../d0/deb/struct___b_buf.html">BBuf</a>** pbuf, <a class="code" href="../../d6/dbe/struct_scan_env.html">ScanEnv</a>* env, <a class="code" href="../../d8/db3/oniguruma_8h.html#a7c8a84bc12127007886efbfcf53b6fb5">OnigCodePoint</a> from, <a class="code" href="../../d8/db3/oniguruma_8h.html#a7c8a84bc12127007886efbfcf53b6fb5">OnigCodePoint</a> to)
<a name="l01809"></a>01809 {
<a name="l01810"></a>01810     <span class="keywordflow">return</span> <a class="code" href="../../d6/dda/regparse_8c.html#acf95eb846040766dbd346b81ee63dc06">add_code_range0</a>(pbuf, env, from, to, 1);
<a name="l01811"></a>01811 }
<a name="l01812"></a>01812 
<a name="l01813"></a>01813 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l01814"></a><a class="code" href="../../d6/dda/regparse_8c.html#a07c32563959155ac0b27e95128eec38a">01814</a> <a class="code" href="../../d6/dda/regparse_8c.html#a07c32563959155ac0b27e95128eec38a">not_code_range_buf</a>(<a class="code" href="../../d1/d7b/struct_onig_encoding_type_s_t.html">OnigEncoding</a> enc, <a class="code" href="../../d0/deb/struct___b_buf.html">BBuf</a>* bbuf, <a class="code" href="../../d0/deb/struct___b_buf.html">BBuf</a>** pbuf, <a class="code" href="../../d6/dbe/struct_scan_env.html">ScanEnv</a>* env)
<a name="l01815"></a>01815 {
<a name="l01816"></a>01816   <span class="keywordtype">int</span> r, i, n;
<a name="l01817"></a>01817   <a class="code" href="../../d8/db3/oniguruma_8h.html#a7c8a84bc12127007886efbfcf53b6fb5">OnigCodePoint</a> pre, from, *data, to = 0;
<a name="l01818"></a>01818 
<a name="l01819"></a>01819   *pbuf = (<a class="code" href="../../d0/deb/struct___b_buf.html">BBuf</a>* )<a class="code" href="../../d3/d09/ripper_8y.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01820"></a>01820   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d87/regint_8h.html#a91a9c9242dc3810582965d1882d1894d">IS_NULL</a>(bbuf)) {
<a name="l01821"></a>01821   set_all:
<a name="l01822"></a>01822     <span class="keywordflow">return</span> <a class="code" href="../../d6/dda/regparse_8c.html#af72e49d78040e67cd3e66882a8e49b1d">SET_ALL_MULTI_BYTE_RANGE</a>(enc, pbuf);
<a name="l01823"></a>01823   }
<a name="l01824"></a>01824 
<a name="l01825"></a>01825   data = (<a class="code" href="../../d8/db3/oniguruma_8h.html#a7c8a84bc12127007886efbfcf53b6fb5">OnigCodePoint</a>* )(bbuf-&gt;<a class="code" href="../../d0/deb/struct___b_buf.html#a3d79f476af8e7a57dd240e68f11867a1">p</a>);
<a name="l01826"></a>01826   <a class="code" href="../../d6/d87/regint_8h.html#a90db6270cec0f45da03f16ce0590eecf">GET_CODE_POINT</a>(n, data);
<a name="l01827"></a>01827   data++;
<a name="l01828"></a>01828   <span class="keywordflow">if</span> (n &lt;= 0) <span class="keywordflow">goto</span> set_all;
<a name="l01829"></a>01829 
<a name="l01830"></a>01830   r = 0;
<a name="l01831"></a>01831   pre = <a class="code" href="../../d6/dda/regparse_8c.html#a80c61185f8f4a16b70dcc75b41aad485">MBCODE_START_POS</a>(enc);
<a name="l01832"></a>01832   <span class="keywordflow">for</span> (i = 0; i &lt; n; i++) {
<a name="l01833"></a>01833     from = data[i*2];
<a name="l01834"></a>01834     to   = data[i*2+1];
<a name="l01835"></a>01835     <span class="keywordflow">if</span> (pre &lt;= from - 1) {
<a name="l01836"></a>01836       r = <a class="code" href="../../d6/dda/regparse_8c.html#a4a737460fe75cbdeebcb1a4a2738358c">add_code_range_to_buf</a>(pbuf, env, pre, from - 1);
<a name="l01837"></a>01837       <span class="keywordflow">if</span> (r != 0) <span class="keywordflow">return</span> r;
<a name="l01838"></a>01838     }
<a name="l01839"></a>01839     <span class="keywordflow">if</span> (to == ~((<a class="code" href="../../d8/db3/oniguruma_8h.html#a7c8a84bc12127007886efbfcf53b6fb5">OnigCodePoint</a> )0)) <span class="keywordflow">break</span>;
<a name="l01840"></a>01840     pre = to + 1;
<a name="l01841"></a>01841   }
<a name="l01842"></a>01842   <span class="keywordflow">if</span> (to &lt; ~((<a class="code" href="../../d8/db3/oniguruma_8h.html#a7c8a84bc12127007886efbfcf53b6fb5">OnigCodePoint</a> )0)) {
<a name="l01843"></a>01843     r = <a class="code" href="../../d6/dda/regparse_8c.html#a4a737460fe75cbdeebcb1a4a2738358c">add_code_range_to_buf</a>(pbuf, env, to + 1, ~((<a class="code" href="../../d8/db3/oniguruma_8h.html#a7c8a84bc12127007886efbfcf53b6fb5">OnigCodePoint</a> )0));
<a name="l01844"></a>01844   }
<a name="l01845"></a>01845   <span class="keywordflow">return</span> r;
<a name="l01846"></a>01846 }
<a name="l01847"></a>01847 
<a name="l01848"></a><a class="code" href="../../d6/dda/regparse_8c.html#aaaf6eb1eeef3a365dc46394bb7b2ddb4">01848</a> <span class="preprocessor">#define SWAP_BBUF_NOT(bbuf1, not1, bbuf2, not2) do {\</span>
<a name="l01849"></a>01849 <span class="preprocessor">  BBuf *tbuf; \</span>
<a name="l01850"></a>01850 <span class="preprocessor">  int  tnot; \</span>
<a name="l01851"></a>01851 <span class="preprocessor">  tnot = not1;  not1  = not2;  not2  = tnot; \</span>
<a name="l01852"></a>01852 <span class="preprocessor">  tbuf = bbuf1; bbuf1 = bbuf2; bbuf2 = tbuf; \</span>
<a name="l01853"></a>01853 <span class="preprocessor">} while (0)</span>
<a name="l01854"></a>01854 <span class="preprocessor"></span>
<a name="l01855"></a>01855 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l01856"></a><a class="code" href="../../d6/dda/regparse_8c.html#ad60c46004ca23dfd6069d5418e310aa0">01856</a> <a class="code" href="../../d6/dda/regparse_8c.html#ad60c46004ca23dfd6069d5418e310aa0">or_code_range_buf</a>(<a class="code" href="../../d1/d7b/struct_onig_encoding_type_s_t.html">OnigEncoding</a> enc, <a class="code" href="../../d0/deb/struct___b_buf.html">BBuf</a>* bbuf1, <span class="keywordtype">int</span> not1,
<a name="l01857"></a>01857                   <a class="code" href="../../d0/deb/struct___b_buf.html">BBuf</a>* bbuf2, <span class="keywordtype">int</span> not2, <a class="code" href="../../d0/deb/struct___b_buf.html">BBuf</a>** pbuf, <a class="code" href="../../d6/dbe/struct_scan_env.html">ScanEnv</a>* env)
<a name="l01858"></a>01858 {
<a name="l01859"></a>01859   <span class="keywordtype">int</span> r;
<a name="l01860"></a>01860   <a class="code" href="../../d8/db3/oniguruma_8h.html#a7c8a84bc12127007886efbfcf53b6fb5">OnigCodePoint</a> i, n1, *data1;
<a name="l01861"></a>01861   <a class="code" href="../../d8/db3/oniguruma_8h.html#a7c8a84bc12127007886efbfcf53b6fb5">OnigCodePoint</a> from, to;
<a name="l01862"></a>01862 
<a name="l01863"></a>01863   *pbuf = (<a class="code" href="../../d0/deb/struct___b_buf.html">BBuf</a>* )<a class="code" href="../../d3/d09/ripper_8y.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01864"></a>01864   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d87/regint_8h.html#a91a9c9242dc3810582965d1882d1894d">IS_NULL</a>(bbuf1) &amp;&amp; <a class="code" href="../../d6/d87/regint_8h.html#a91a9c9242dc3810582965d1882d1894d">IS_NULL</a>(bbuf2)) {
<a name="l01865"></a>01865     <span class="keywordflow">if</span> (not1 != 0 || not2 != 0)
<a name="l01866"></a>01866       <span class="keywordflow">return</span> <a class="code" href="../../d6/dda/regparse_8c.html#af72e49d78040e67cd3e66882a8e49b1d">SET_ALL_MULTI_BYTE_RANGE</a>(enc, pbuf);
<a name="l01867"></a>01867     <span class="keywordflow">return</span> 0;
<a name="l01868"></a>01868   }
<a name="l01869"></a>01869 
<a name="l01870"></a>01870   r = 0;
<a name="l01871"></a>01871   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d87/regint_8h.html#a91a9c9242dc3810582965d1882d1894d">IS_NULL</a>(bbuf2))
<a name="l01872"></a>01872     <a class="code" href="../../d6/dda/regparse_8c.html#aaaf6eb1eeef3a365dc46394bb7b2ddb4">SWAP_BBUF_NOT</a>(bbuf1, not1, bbuf2, not2);
<a name="l01873"></a>01873 
<a name="l01874"></a>01874   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d87/regint_8h.html#a91a9c9242dc3810582965d1882d1894d">IS_NULL</a>(bbuf1)) {
<a name="l01875"></a>01875     <span class="keywordflow">if</span> (not1 != 0) {
<a name="l01876"></a>01876       <span class="keywordflow">return</span> <a class="code" href="../../d6/dda/regparse_8c.html#af72e49d78040e67cd3e66882a8e49b1d">SET_ALL_MULTI_BYTE_RANGE</a>(enc, pbuf);
<a name="l01877"></a>01877     }
<a name="l01878"></a>01878     <span class="keywordflow">else</span> {
<a name="l01879"></a>01879       <span class="keywordflow">if</span> (not2 == 0) {
<a name="l01880"></a>01880         <span class="keywordflow">return</span> <a class="code" href="../../d6/dda/regparse_8c.html#a8092183b871bc7c73c6aed93c11cc01e">bbuf_clone</a>(pbuf, bbuf2);
<a name="l01881"></a>01881       }
<a name="l01882"></a>01882       <span class="keywordflow">else</span> {
<a name="l01883"></a>01883         <span class="keywordflow">return</span> <a class="code" href="../../d6/dda/regparse_8c.html#a07c32563959155ac0b27e95128eec38a">not_code_range_buf</a>(enc, bbuf2, pbuf, env);
<a name="l01884"></a>01884       }
<a name="l01885"></a>01885     }
<a name="l01886"></a>01886   }
<a name="l01887"></a>01887 
<a name="l01888"></a>01888   <span class="keywordflow">if</span> (not1 != 0)
<a name="l01889"></a>01889     <a class="code" href="../../d6/dda/regparse_8c.html#aaaf6eb1eeef3a365dc46394bb7b2ddb4">SWAP_BBUF_NOT</a>(bbuf1, not1, bbuf2, not2);
<a name="l01890"></a>01890 
<a name="l01891"></a>01891   data1 = (<a class="code" href="../../d8/db3/oniguruma_8h.html#a7c8a84bc12127007886efbfcf53b6fb5">OnigCodePoint</a>* )(bbuf1-&gt;<a class="code" href="../../d0/deb/struct___b_buf.html#a3d79f476af8e7a57dd240e68f11867a1">p</a>);
<a name="l01892"></a>01892   <a class="code" href="../../d6/d87/regint_8h.html#a90db6270cec0f45da03f16ce0590eecf">GET_CODE_POINT</a>(n1, data1);
<a name="l01893"></a>01893   data1++;
<a name="l01894"></a>01894 
<a name="l01895"></a>01895   <span class="keywordflow">if</span> (not2 == 0 &amp;&amp; not1 == 0) { <span class="comment">/* 1 OR 2 */</span>
<a name="l01896"></a>01896     r = <a class="code" href="../../d6/dda/regparse_8c.html#a8092183b871bc7c73c6aed93c11cc01e">bbuf_clone</a>(pbuf, bbuf2);
<a name="l01897"></a>01897   }
<a name="l01898"></a>01898   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (not1 == 0) { <span class="comment">/* 1 OR (not 2) */</span>
<a name="l01899"></a>01899     r = <a class="code" href="../../d6/dda/regparse_8c.html#a07c32563959155ac0b27e95128eec38a">not_code_range_buf</a>(enc, bbuf2, pbuf, env);
<a name="l01900"></a>01900   }
<a name="l01901"></a>01901   <span class="keywordflow">if</span> (r != 0) <span class="keywordflow">return</span> r;
<a name="l01902"></a>01902 
<a name="l01903"></a>01903   <span class="keywordflow">for</span> (i = 0; i &lt; n1; i++) {
<a name="l01904"></a>01904     from = data1[i*2];
<a name="l01905"></a>01905     to   = data1[i*2+1];
<a name="l01906"></a>01906     r = <a class="code" href="../../d6/dda/regparse_8c.html#a4a737460fe75cbdeebcb1a4a2738358c">add_code_range_to_buf</a>(pbuf, env, from, to);
<a name="l01907"></a>01907     <span class="keywordflow">if</span> (r != 0) <span class="keywordflow">return</span> r;
<a name="l01908"></a>01908   }
<a name="l01909"></a>01909   <span class="keywordflow">return</span> 0;
<a name="l01910"></a>01910 }
<a name="l01911"></a>01911 
<a name="l01912"></a>01912 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l01913"></a><a class="code" href="../../d6/dda/regparse_8c.html#a01e483ecf1d1ee40b9b523f526c255b1">01913</a> <a class="code" href="../../d6/dda/regparse_8c.html#a01e483ecf1d1ee40b9b523f526c255b1">and_code_range1</a>(<a class="code" href="../../d0/deb/struct___b_buf.html">BBuf</a>** pbuf, <a class="code" href="../../d6/dbe/struct_scan_env.html">ScanEnv</a>* env, <a class="code" href="../../d8/db3/oniguruma_8h.html#a7c8a84bc12127007886efbfcf53b6fb5">OnigCodePoint</a> from1, <a class="code" href="../../d8/db3/oniguruma_8h.html#a7c8a84bc12127007886efbfcf53b6fb5">OnigCodePoint</a> to1,
<a name="l01914"></a>01914                 <a class="code" href="../../d8/db3/oniguruma_8h.html#a7c8a84bc12127007886efbfcf53b6fb5">OnigCodePoint</a>* data, <span class="keywordtype">int</span> n)
<a name="l01915"></a>01915 {
<a name="l01916"></a>01916   <span class="keywordtype">int</span> i, r;
<a name="l01917"></a>01917   <a class="code" href="../../d8/db3/oniguruma_8h.html#a7c8a84bc12127007886efbfcf53b6fb5">OnigCodePoint</a> from2, to2;
<a name="l01918"></a>01918 
<a name="l01919"></a>01919   <span class="keywordflow">for</span> (i = 0; i &lt; n; i++) {
<a name="l01920"></a>01920     from2 = data[i*2];
<a name="l01921"></a>01921     to2   = data[i*2+1];
<a name="l01922"></a>01922     <span class="keywordflow">if</span> (from2 &lt; from1) {
<a name="l01923"></a>01923       <span class="keywordflow">if</span> (to2 &lt; from1) <span class="keywordflow">continue</span>;
<a name="l01924"></a>01924       <span class="keywordflow">else</span> {
<a name="l01925"></a>01925         from1 = to2 + 1;
<a name="l01926"></a>01926       }
<a name="l01927"></a>01927     }
<a name="l01928"></a>01928     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (from2 &lt;= to1) {
<a name="l01929"></a>01929       <span class="keywordflow">if</span> (to2 &lt; to1) {
<a name="l01930"></a>01930         <span class="keywordflow">if</span> (from1 &lt;= from2 - 1) {
<a name="l01931"></a>01931           r = <a class="code" href="../../d6/dda/regparse_8c.html#a4a737460fe75cbdeebcb1a4a2738358c">add_code_range_to_buf</a>(pbuf, env, from1, from2-1);
<a name="l01932"></a>01932           <span class="keywordflow">if</span> (r != 0) <span class="keywordflow">return</span> r;
<a name="l01933"></a>01933         }
<a name="l01934"></a>01934         from1 = to2 + 1;
<a name="l01935"></a>01935       }
<a name="l01936"></a>01936       <span class="keywordflow">else</span> {
<a name="l01937"></a>01937         to1 = from2 - 1;
<a name="l01938"></a>01938       }
<a name="l01939"></a>01939     }
<a name="l01940"></a>01940     <span class="keywordflow">else</span> {
<a name="l01941"></a>01941       from1 = from2;
<a name="l01942"></a>01942     }
<a name="l01943"></a>01943     <span class="keywordflow">if</span> (from1 &gt; to1) <span class="keywordflow">break</span>;
<a name="l01944"></a>01944   }
<a name="l01945"></a>01945   <span class="keywordflow">if</span> (from1 &lt;= to1) {
<a name="l01946"></a>01946     r = <a class="code" href="../../d6/dda/regparse_8c.html#a4a737460fe75cbdeebcb1a4a2738358c">add_code_range_to_buf</a>(pbuf, env, from1, to1);
<a name="l01947"></a>01947     <span class="keywordflow">if</span> (r != 0) <span class="keywordflow">return</span> r;
<a name="l01948"></a>01948   }
<a name="l01949"></a>01949   <span class="keywordflow">return</span> 0;
<a name="l01950"></a>01950 }
<a name="l01951"></a>01951 
<a name="l01952"></a>01952 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l01953"></a><a class="code" href="../../d6/dda/regparse_8c.html#a5136486f32d44c5e1abb6ed0b346cb7e">01953</a> <a class="code" href="../../d6/dda/regparse_8c.html#a5136486f32d44c5e1abb6ed0b346cb7e">and_code_range_buf</a>(<a class="code" href="../../d0/deb/struct___b_buf.html">BBuf</a>* bbuf1, <span class="keywordtype">int</span> not1, <a class="code" href="../../d0/deb/struct___b_buf.html">BBuf</a>* bbuf2, <span class="keywordtype">int</span> not2, <a class="code" href="../../d0/deb/struct___b_buf.html">BBuf</a>** pbuf, <a class="code" href="../../d6/dbe/struct_scan_env.html">ScanEnv</a>* env)
<a name="l01954"></a>01954 {
<a name="l01955"></a>01955   <span class="keywordtype">int</span> r;
<a name="l01956"></a>01956   <a class="code" href="../../d8/db3/oniguruma_8h.html#a7c8a84bc12127007886efbfcf53b6fb5">OnigCodePoint</a> i, j, n1, n2, *data1, *data2;
<a name="l01957"></a>01957   <a class="code" href="../../d8/db3/oniguruma_8h.html#a7c8a84bc12127007886efbfcf53b6fb5">OnigCodePoint</a> from, to, from1, to1, from2, to2;
<a name="l01958"></a>01958 
<a name="l01959"></a>01959   *pbuf = (<a class="code" href="../../d0/deb/struct___b_buf.html">BBuf</a>* )<a class="code" href="../../d3/d09/ripper_8y.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01960"></a>01960   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d87/regint_8h.html#a91a9c9242dc3810582965d1882d1894d">IS_NULL</a>(bbuf1)) {
<a name="l01961"></a>01961     <span class="keywordflow">if</span> (not1 != 0 &amp;&amp; <a class="code" href="../../d6/d87/regint_8h.html#a4bc25fbd4749a2c130d1ae7f15ba140c">IS_NOT_NULL</a>(bbuf2)) <span class="comment">/* not1 != 0 -&gt; not2 == 0 */</span>
<a name="l01962"></a>01962       <span class="keywordflow">return</span> <a class="code" href="../../d6/dda/regparse_8c.html#a8092183b871bc7c73c6aed93c11cc01e">bbuf_clone</a>(pbuf, bbuf2);
<a name="l01963"></a>01963     <span class="keywordflow">return</span> 0;
<a name="l01964"></a>01964   }
<a name="l01965"></a>01965   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d6/d87/regint_8h.html#a91a9c9242dc3810582965d1882d1894d">IS_NULL</a>(bbuf2)) {
<a name="l01966"></a>01966     <span class="keywordflow">if</span> (not2 != 0)
<a name="l01967"></a>01967       <span class="keywordflow">return</span> <a class="code" href="../../d6/dda/regparse_8c.html#a8092183b871bc7c73c6aed93c11cc01e">bbuf_clone</a>(pbuf, bbuf1);
<a name="l01968"></a>01968     <span class="keywordflow">return</span> 0;
<a name="l01969"></a>01969   }
<a name="l01970"></a>01970 
<a name="l01971"></a>01971   <span class="keywordflow">if</span> (not1 != 0)
<a name="l01972"></a>01972     <a class="code" href="../../d6/dda/regparse_8c.html#aaaf6eb1eeef3a365dc46394bb7b2ddb4">SWAP_BBUF_NOT</a>(bbuf1, not1, bbuf2, not2);
<a name="l01973"></a>01973 
<a name="l01974"></a>01974   data1 = (<a class="code" href="../../d8/db3/oniguruma_8h.html#a7c8a84bc12127007886efbfcf53b6fb5">OnigCodePoint</a>* )(bbuf1-&gt;<a class="code" href="../../d0/deb/struct___b_buf.html#a3d79f476af8e7a57dd240e68f11867a1">p</a>);
<a name="l01975"></a>01975   data2 = (<a class="code" href="../../d8/db3/oniguruma_8h.html#a7c8a84bc12127007886efbfcf53b6fb5">OnigCodePoint</a>* )(bbuf2-&gt;<a class="code" href="../../d0/deb/struct___b_buf.html#a3d79f476af8e7a57dd240e68f11867a1">p</a>);
<a name="l01976"></a>01976   <a class="code" href="../../d6/d87/regint_8h.html#a90db6270cec0f45da03f16ce0590eecf">GET_CODE_POINT</a>(n1, data1);
<a name="l01977"></a>01977   <a class="code" href="../../d6/d87/regint_8h.html#a90db6270cec0f45da03f16ce0590eecf">GET_CODE_POINT</a>(n2, data2);
<a name="l01978"></a>01978   data1++;
<a name="l01979"></a>01979   data2++;
<a name="l01980"></a>01980 
<a name="l01981"></a>01981   <span class="keywordflow">if</span> (not2 == 0 &amp;&amp; not1 == 0) { <span class="comment">/* 1 AND 2 */</span>
<a name="l01982"></a>01982     <span class="keywordflow">for</span> (i = 0; i &lt; n1; i++) {
<a name="l01983"></a>01983       from1 = data1[i*2];
<a name="l01984"></a>01984       to1   = data1[i*2+1];
<a name="l01985"></a>01985       <span class="keywordflow">for</span> (j = 0; j &lt; n2; j++) {
<a name="l01986"></a>01986         from2 = data2[j*2];
<a name="l01987"></a>01987         to2   = data2[j*2+1];
<a name="l01988"></a>01988         <span class="keywordflow">if</span> (from2 &gt; to1) <span class="keywordflow">break</span>;
<a name="l01989"></a>01989         <span class="keywordflow">if</span> (to2 &lt; from1) <span class="keywordflow">continue</span>;
<a name="l01990"></a>01990         from = <a class="code" href="../../d6/d87/regint_8h.html#afa99ec4acc4ecb2dc3c2d05da15d0e3f">MAX</a>(from1, from2);
<a name="l01991"></a>01991         to   = <a class="code" href="../../d6/d87/regint_8h.html#a3acffbd305ee72dcd4593c0d8af64a4f">MIN</a>(to1, to2);
<a name="l01992"></a>01992         r = <a class="code" href="../../d6/dda/regparse_8c.html#a4a737460fe75cbdeebcb1a4a2738358c">add_code_range_to_buf</a>(pbuf, env, from, to);
<a name="l01993"></a>01993         <span class="keywordflow">if</span> (r != 0) <span class="keywordflow">return</span> r;
<a name="l01994"></a>01994       }
<a name="l01995"></a>01995     }
<a name="l01996"></a>01996   }
<a name="l01997"></a>01997   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (not1 == 0) { <span class="comment">/* 1 AND (not 2) */</span>
<a name="l01998"></a>01998     <span class="keywordflow">for</span> (i = 0; i &lt; n1; i++) {
<a name="l01999"></a>01999       from1 = data1[i*2];
<a name="l02000"></a>02000       to1   = data1[i*2+1];
<a name="l02001"></a>02001       r = <a class="code" href="../../d6/dda/regparse_8c.html#a01e483ecf1d1ee40b9b523f526c255b1">and_code_range1</a>(pbuf, env, from1, to1, data2, n2);
<a name="l02002"></a>02002       <span class="keywordflow">if</span> (r != 0) <span class="keywordflow">return</span> r;
<a name="l02003"></a>02003     }
<a name="l02004"></a>02004   }
<a name="l02005"></a>02005 
<a name="l02006"></a>02006   <span class="keywordflow">return</span> 0;
<a name="l02007"></a>02007 }
<a name="l02008"></a>02008 
<a name="l02009"></a>02009 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l02010"></a><a class="code" href="../../d6/dda/regparse_8c.html#a9a4c177896f1539d8e6293a0a989e544">02010</a> <a class="code" href="../../d6/dda/regparse_8c.html#a9a4c177896f1539d8e6293a0a989e544">and_cclass</a>(<a class="code" href="../../d8/d79/struct_c_class_node.html">CClassNode</a>* dest, <a class="code" href="../../d8/d79/struct_c_class_node.html">CClassNode</a>* cc, <a class="code" href="../../d6/dbe/struct_scan_env.html">ScanEnv</a>* env)
<a name="l02011"></a>02011 {
<a name="l02012"></a>02012   <a class="code" href="../../d1/d7b/struct_onig_encoding_type_s_t.html">OnigEncoding</a> enc = env-&gt;<a class="code" href="../../d6/dbe/struct_scan_env.html#a97f766db4ac9dabc9d173bf99fbcc11b">enc</a>;
<a name="l02013"></a>02013   <span class="keywordtype">int</span> r, not1, not2;
<a name="l02014"></a>02014   <a class="code" href="../../d0/deb/struct___b_buf.html">BBuf</a> *buf1, *buf2, *pbuf = 0;
<a name="l02015"></a>02015   <a class="code" href="../../d6/d87/regint_8h.html#adb2b463784f4cfa2f5504eb0ed9ee70a">BitSetRef</a> bsr1, bsr2;
<a name="l02016"></a>02016   <a class="code" href="../../d6/d87/regint_8h.html#aa90e0ae541ce0c9cfff450c7717b7856">BitSet</a> bs1, bs2;
<a name="l02017"></a>02017 
<a name="l02018"></a>02018   not1 = <a class="code" href="../../d6/d87/regint_8h.html#aa719ec00173511740495f30fc0878c9e">IS_NCCLASS_NOT</a>(dest);
<a name="l02019"></a>02019   bsr1 = dest-&gt;<a class="code" href="../../d8/d79/struct_c_class_node.html#a082458e56c928f78db90f08e242a9f3d">bs</a>;
<a name="l02020"></a>02020   buf1 = dest-&gt;<a class="code" href="../../d8/d79/struct_c_class_node.html#a599db43b8eea536a4e4d08400fa445cb">mbuf</a>;
<a name="l02021"></a>02021   not2 = <a class="code" href="../../d6/d87/regint_8h.html#aa719ec00173511740495f30fc0878c9e">IS_NCCLASS_NOT</a>(cc);
<a name="l02022"></a>02022   bsr2 = cc-&gt;<a class="code" href="../../d8/d79/struct_c_class_node.html#a082458e56c928f78db90f08e242a9f3d">bs</a>;
<a name="l02023"></a>02023   buf2 = cc-&gt;<a class="code" href="../../d8/d79/struct_c_class_node.html#a599db43b8eea536a4e4d08400fa445cb">mbuf</a>;
<a name="l02024"></a>02024 
<a name="l02025"></a>02025   <span class="keywordflow">if</span> (not1 != 0) {
<a name="l02026"></a>02026     <a class="code" href="../../d6/dda/regparse_8c.html#a0b41c67edff811e8e24db2f78def34dd">bitset_invert_to</a>(bsr1, bs1);
<a name="l02027"></a>02027     bsr1 = bs1;
<a name="l02028"></a>02028   }
<a name="l02029"></a>02029   <span class="keywordflow">if</span> (not2 != 0) {
<a name="l02030"></a>02030     <a class="code" href="../../d6/dda/regparse_8c.html#a0b41c67edff811e8e24db2f78def34dd">bitset_invert_to</a>(bsr2, bs2);
<a name="l02031"></a>02031     bsr2 = bs2;
<a name="l02032"></a>02032   }
<a name="l02033"></a>02033   <a class="code" href="../../d6/dda/regparse_8c.html#ad8273b2084e2d2a864d61a63c1cd0717">bitset_and</a>(bsr1, bsr2);
<a name="l02034"></a>02034   <span class="keywordflow">if</span> (bsr1 != dest-&gt;<a class="code" href="../../d8/d79/struct_c_class_node.html#a082458e56c928f78db90f08e242a9f3d">bs</a>) {
<a name="l02035"></a>02035     <a class="code" href="../../d6/dda/regparse_8c.html#a3fd4d479afe1fbd2aac0924f70b87160">bitset_copy</a>(dest-&gt;<a class="code" href="../../d8/d79/struct_c_class_node.html#a082458e56c928f78db90f08e242a9f3d">bs</a>, bsr1);
<a name="l02036"></a>02036     bsr1 = dest-&gt;<a class="code" href="../../d8/d79/struct_c_class_node.html#a082458e56c928f78db90f08e242a9f3d">bs</a>;
<a name="l02037"></a>02037   }
<a name="l02038"></a>02038   <span class="keywordflow">if</span> (not1 != 0) {
<a name="l02039"></a>02039     <a class="code" href="../../d6/dda/regparse_8c.html#a8d37acb2da0c1b9a62bd817b2cc36818">bitset_invert</a>(dest-&gt;<a class="code" href="../../d8/d79/struct_c_class_node.html#a082458e56c928f78db90f08e242a9f3d">bs</a>);
<a name="l02040"></a>02040   }
<a name="l02041"></a>02041 
<a name="l02042"></a>02042   <span class="keywordflow">if</span> (! <a class="code" href="../../d8/db3/oniguruma_8h.html#acbe29a5b40372a14b37b70efda999676">ONIGENC_IS_SINGLEBYTE</a>(enc)) {
<a name="l02043"></a>02043     <span class="keywordflow">if</span> (not1 != 0 &amp;&amp; not2 != 0) {
<a name="l02044"></a>02044       r = <a class="code" href="../../d6/dda/regparse_8c.html#ad60c46004ca23dfd6069d5418e310aa0">or_code_range_buf</a>(enc, buf1, 0, buf2, 0, &amp;pbuf, env);
<a name="l02045"></a>02045     }
<a name="l02046"></a>02046     <span class="keywordflow">else</span> {
<a name="l02047"></a>02047       r = <a class="code" href="../../d6/dda/regparse_8c.html#a5136486f32d44c5e1abb6ed0b346cb7e">and_code_range_buf</a>(buf1, not1, buf2, not2, &amp;pbuf, env);
<a name="l02048"></a>02048       <span class="keywordflow">if</span> (r == 0 &amp;&amp; not1 != 0) {
<a name="l02049"></a>02049         <a class="code" href="../../d0/deb/struct___b_buf.html">BBuf</a> *tbuf = 0;
<a name="l02050"></a>02050         r = <a class="code" href="../../d6/dda/regparse_8c.html#a07c32563959155ac0b27e95128eec38a">not_code_range_buf</a>(enc, pbuf, &amp;tbuf, env);
<a name="l02051"></a>02051         <a class="code" href="../../d6/dda/regparse_8c.html#ac57154f90d1120d13c794cb9ba3cdba2">bbuf_free</a>(pbuf);
<a name="l02052"></a>02052         pbuf = tbuf;
<a name="l02053"></a>02053       }
<a name="l02054"></a>02054     }
<a name="l02055"></a>02055     <span class="keywordflow">if</span> (r != 0) {
<a name="l02056"></a>02056         <a class="code" href="../../d6/dda/regparse_8c.html#ac57154f90d1120d13c794cb9ba3cdba2">bbuf_free</a>(pbuf);
<a name="l02057"></a>02057         <span class="keywordflow">return</span> r;
<a name="l02058"></a>02058     }
<a name="l02059"></a>02059 
<a name="l02060"></a>02060     dest-&gt;<a class="code" href="../../d8/d79/struct_c_class_node.html#a599db43b8eea536a4e4d08400fa445cb">mbuf</a> = pbuf;
<a name="l02061"></a>02061     <a class="code" href="../../d6/dda/regparse_8c.html#ac57154f90d1120d13c794cb9ba3cdba2">bbuf_free</a>(buf1);
<a name="l02062"></a>02062     <span class="keywordflow">return</span> r;
<a name="l02063"></a>02063   }
<a name="l02064"></a>02064   <span class="keywordflow">return</span> 0;
<a name="l02065"></a>02065 }
<a name="l02066"></a>02066 
<a name="l02067"></a>02067 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l02068"></a><a class="code" href="../../d6/dda/regparse_8c.html#a0e86fc9a55be3a8fe36993b6b1d9af44">02068</a> <a class="code" href="../../d6/dda/regparse_8c.html#a0e86fc9a55be3a8fe36993b6b1d9af44">or_cclass</a>(<a class="code" href="../../d8/d79/struct_c_class_node.html">CClassNode</a>* dest, <a class="code" href="../../d8/d79/struct_c_class_node.html">CClassNode</a>* cc, <a class="code" href="../../d6/dbe/struct_scan_env.html">ScanEnv</a>* env)
<a name="l02069"></a>02069 {
<a name="l02070"></a>02070   <a class="code" href="../../d1/d7b/struct_onig_encoding_type_s_t.html">OnigEncoding</a> enc = env-&gt;<a class="code" href="../../d6/dbe/struct_scan_env.html#a97f766db4ac9dabc9d173bf99fbcc11b">enc</a>;
<a name="l02071"></a>02071   <span class="keywordtype">int</span> r, not1, not2;
<a name="l02072"></a>02072   <a class="code" href="../../d0/deb/struct___b_buf.html">BBuf</a> *buf1, *buf2, *pbuf = 0;
<a name="l02073"></a>02073   <a class="code" href="../../d6/d87/regint_8h.html#adb2b463784f4cfa2f5504eb0ed9ee70a">BitSetRef</a> bsr1, bsr2;
<a name="l02074"></a>02074   <a class="code" href="../../d6/d87/regint_8h.html#aa90e0ae541ce0c9cfff450c7717b7856">BitSet</a> bs1, bs2;
<a name="l02075"></a>02075 
<a name="l02076"></a>02076   not1 = <a class="code" href="../../d6/d87/regint_8h.html#aa719ec00173511740495f30fc0878c9e">IS_NCCLASS_NOT</a>(dest);
<a name="l02077"></a>02077   bsr1 = dest-&gt;<a class="code" href="../../d8/d79/struct_c_class_node.html#a082458e56c928f78db90f08e242a9f3d">bs</a>;
<a name="l02078"></a>02078   buf1 = dest-&gt;<a class="code" href="../../d8/d79/struct_c_class_node.html#a599db43b8eea536a4e4d08400fa445cb">mbuf</a>;
<a name="l02079"></a>02079   not2 = <a class="code" href="../../d6/d87/regint_8h.html#aa719ec00173511740495f30fc0878c9e">IS_NCCLASS_NOT</a>(cc);
<a name="l02080"></a>02080   bsr2 = cc-&gt;<a class="code" href="../../d8/d79/struct_c_class_node.html#a082458e56c928f78db90f08e242a9f3d">bs</a>;
<a name="l02081"></a>02081   buf2 = cc-&gt;<a class="code" href="../../d8/d79/struct_c_class_node.html#a599db43b8eea536a4e4d08400fa445cb">mbuf</a>;
<a name="l02082"></a>02082 
<a name="l02083"></a>02083   <span class="keywordflow">if</span> (not1 != 0) {
<a name="l02084"></a>02084     <a class="code" href="../../d6/dda/regparse_8c.html#a0b41c67edff811e8e24db2f78def34dd">bitset_invert_to</a>(bsr1, bs1);
<a name="l02085"></a>02085     bsr1 = bs1;
<a name="l02086"></a>02086   }
<a name="l02087"></a>02087   <span class="keywordflow">if</span> (not2 != 0) {
<a name="l02088"></a>02088     <a class="code" href="../../d6/dda/regparse_8c.html#a0b41c67edff811e8e24db2f78def34dd">bitset_invert_to</a>(bsr2, bs2);
<a name="l02089"></a>02089     bsr2 = bs2;
<a name="l02090"></a>02090   }
<a name="l02091"></a>02091   <a class="code" href="../../d6/dda/regparse_8c.html#a3cf872fa935e0920dcd727bce187e469">bitset_or</a>(bsr1, bsr2);
<a name="l02092"></a>02092   <span class="keywordflow">if</span> (bsr1 != dest-&gt;<a class="code" href="../../d8/d79/struct_c_class_node.html#a082458e56c928f78db90f08e242a9f3d">bs</a>) {
<a name="l02093"></a>02093     <a class="code" href="../../d6/dda/regparse_8c.html#a3fd4d479afe1fbd2aac0924f70b87160">bitset_copy</a>(dest-&gt;<a class="code" href="../../d8/d79/struct_c_class_node.html#a082458e56c928f78db90f08e242a9f3d">bs</a>, bsr1);
<a name="l02094"></a>02094     bsr1 = dest-&gt;<a class="code" href="../../d8/d79/struct_c_class_node.html#a082458e56c928f78db90f08e242a9f3d">bs</a>;
<a name="l02095"></a>02095   }
<a name="l02096"></a>02096   <span class="keywordflow">if</span> (not1 != 0) {
<a name="l02097"></a>02097     <a class="code" href="../../d6/dda/regparse_8c.html#a8d37acb2da0c1b9a62bd817b2cc36818">bitset_invert</a>(dest-&gt;<a class="code" href="../../d8/d79/struct_c_class_node.html#a082458e56c928f78db90f08e242a9f3d">bs</a>);
<a name="l02098"></a>02098   }
<a name="l02099"></a>02099 
<a name="l02100"></a>02100   <span class="keywordflow">if</span> (! <a class="code" href="../../d8/db3/oniguruma_8h.html#acbe29a5b40372a14b37b70efda999676">ONIGENC_IS_SINGLEBYTE</a>(enc)) {
<a name="l02101"></a>02101     <span class="keywordflow">if</span> (not1 != 0 &amp;&amp; not2 != 0) {
<a name="l02102"></a>02102       r = <a class="code" href="../../d6/dda/regparse_8c.html#a5136486f32d44c5e1abb6ed0b346cb7e">and_code_range_buf</a>(buf1, 0, buf2, 0, &amp;pbuf, env);
<a name="l02103"></a>02103     }
<a name="l02104"></a>02104     <span class="keywordflow">else</span> {
<a name="l02105"></a>02105       r = <a class="code" href="../../d6/dda/regparse_8c.html#ad60c46004ca23dfd6069d5418e310aa0">or_code_range_buf</a>(enc, buf1, not1, buf2, not2, &amp;pbuf, env);
<a name="l02106"></a>02106       <span class="keywordflow">if</span> (r == 0 &amp;&amp; not1 != 0) {
<a name="l02107"></a>02107         <a class="code" href="../../d0/deb/struct___b_buf.html">BBuf</a> *tbuf = 0;
<a name="l02108"></a>02108         r = <a class="code" href="../../d6/dda/regparse_8c.html#a07c32563959155ac0b27e95128eec38a">not_code_range_buf</a>(enc, pbuf, &amp;tbuf, env);
<a name="l02109"></a>02109         <a class="code" href="../../d6/dda/regparse_8c.html#ac57154f90d1120d13c794cb9ba3cdba2">bbuf_free</a>(pbuf);
<a name="l02110"></a>02110         pbuf = tbuf;
<a name="l02111"></a>02111       }
<a name="l02112"></a>02112     }
<a name="l02113"></a>02113     <span class="keywordflow">if</span> (r != 0) {
<a name="l02114"></a>02114         <a class="code" href="../../d6/dda/regparse_8c.html#ac57154f90d1120d13c794cb9ba3cdba2">bbuf_free</a>(pbuf);
<a name="l02115"></a>02115         <span class="keywordflow">return</span> r;
<a name="l02116"></a>02116     }
<a name="l02117"></a>02117 
<a name="l02118"></a>02118     dest-&gt;<a class="code" href="../../d8/d79/struct_c_class_node.html#a599db43b8eea536a4e4d08400fa445cb">mbuf</a> = pbuf;
<a name="l02119"></a>02119     <a class="code" href="../../d6/dda/regparse_8c.html#ac57154f90d1120d13c794cb9ba3cdba2">bbuf_free</a>(buf1);
<a name="l02120"></a>02120     <span class="keywordflow">return</span> r;
<a name="l02121"></a>02121   }
<a name="l02122"></a>02122   <span class="keywordflow">else</span>
<a name="l02123"></a>02123     <span class="keywordflow">return</span> 0;
<a name="l02124"></a>02124 }
<a name="l02125"></a>02125 
<a name="l02126"></a>02126 <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d6/dda/regparse_8c.html#a22db37d780657eeda054796e3f7bef27">UNKNOWN_ESC_WARN</a>(<a class="code" href="../../d6/dbe/struct_scan_env.html">ScanEnv</a> *env, <span class="keywordtype">int</span> c);
<a name="l02127"></a>02127 
<a name="l02128"></a>02128 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l02129"></a><a class="code" href="../../d6/dda/regparse_8c.html#a8b55f92f3133c69d4a7a6bf87aa41138">02129</a> <a class="code" href="../../d6/dda/regparse_8c.html#a8b55f92f3133c69d4a7a6bf87aa41138">conv_backslash_value</a>(<span class="keywordtype">int</span> c, <a class="code" href="../../d6/dbe/struct_scan_env.html">ScanEnv</a>* env)
<a name="l02130"></a>02130 {
<a name="l02131"></a>02131   <span class="keywordflow">if</span> (<a class="code" href="../../d1/dfc/regparse_8h.html#aeeb7aa0f60553ade62b7338e8f21256b">IS_SYNTAX_OP</a>(env-&gt;<a class="code" href="../../d6/dbe/struct_scan_env.html#ae5c4502ad7b7a4a418eda464919d2bda">syntax</a>, <a class="code" href="../../d8/db3/oniguruma_8h.html#a9ecb3a3cdbef8f8e62fcfb1a3227466e">ONIG_SYN_OP_ESC_CONTROL_CHARS</a>)) {
<a name="l02132"></a>02132     <span class="keywordflow">switch</span> (c) {
<a name="l02133"></a>02133     <span class="keywordflow">case</span> <span class="charliteral">&apos;n&apos;</span>: <span class="keywordflow">return</span> <span class="charliteral">&apos;\n&apos;</span>;
<a name="l02134"></a>02134     <span class="keywordflow">case</span> <span class="charliteral">&apos;t&apos;</span>: <span class="keywordflow">return</span> <span class="charliteral">&apos;\t&apos;</span>;
<a name="l02135"></a>02135     <span class="keywordflow">case</span> <span class="charliteral">&apos;r&apos;</span>: <span class="keywordflow">return</span> <span class="charliteral">&apos;\r&apos;</span>;
<a name="l02136"></a>02136     <span class="keywordflow">case</span> <span class="charliteral">&apos;f&apos;</span>: <span class="keywordflow">return</span> <span class="charliteral">&apos;\f&apos;</span>;
<a name="l02137"></a>02137     <span class="keywordflow">case</span> <span class="charliteral">&apos;a&apos;</span>: <span class="keywordflow">return</span> <span class="charliteral">&apos;\007&apos;</span>;
<a name="l02138"></a>02138     <span class="keywordflow">case</span> <span class="charliteral">&apos;b&apos;</span>: <span class="keywordflow">return</span> <span class="charliteral">&apos;\010&apos;</span>;
<a name="l02139"></a>02139     <span class="keywordflow">case</span> <span class="charliteral">&apos;e&apos;</span>: <span class="keywordflow">return</span> <span class="charliteral">&apos;\033&apos;</span>;
<a name="l02140"></a>02140     <span class="keywordflow">case</span> <span class="charliteral">&apos;v&apos;</span>:
<a name="l02141"></a>02141       <span class="keywordflow">if</span> (<a class="code" href="../../d1/dfc/regparse_8h.html#a2ff963239e972932cefd5adaae161e76">IS_SYNTAX_OP2</a>(env-&gt;<a class="code" href="../../d6/dbe/struct_scan_env.html#ae5c4502ad7b7a4a418eda464919d2bda">syntax</a>, <a class="code" href="../../d8/db3/oniguruma_8h.html#a7639bc82cae8f0cac8cfa1b600a3ca0b">ONIG_SYN_OP2_ESC_V_VTAB</a>))
<a name="l02142"></a>02142         <span class="keywordflow">return</span> <span class="charliteral">&apos;\v&apos;</span>;
<a name="l02143"></a>02143       <span class="keywordflow">break</span>;
<a name="l02144"></a>02144 
<a name="l02145"></a>02145     <span class="keywordflow">default</span>:
<a name="l02146"></a>02146       <span class="keywordflow">if</span> ((<span class="charliteral">&apos;a&apos;</span> &lt;= c &amp;&amp; c &lt;= <span class="charliteral">&apos;z&apos;</span>) || (<span class="charliteral">&apos;A&apos;</span> &lt;= c &amp;&amp; c &lt;= <span class="charliteral">&apos;Z&apos;</span>))
<a name="l02147"></a>02147           <a class="code" href="../../d6/dda/regparse_8c.html#a22db37d780657eeda054796e3f7bef27">UNKNOWN_ESC_WARN</a>(env, c);
<a name="l02148"></a>02148       <span class="keywordflow">break</span>;
<a name="l02149"></a>02149     }
<a name="l02150"></a>02150   }
<a name="l02151"></a>02151   <span class="keywordflow">return</span> c;
<a name="l02152"></a>02152 }
<a name="l02153"></a>02153 
<a name="l02154"></a>02154 <span class="preprocessor">#if 0                           </span><span class="comment">/* no invalid quantifier */</span>
<a name="l02155"></a>02155 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l02156"></a>02156 <a class="code" href="../../d6/dda/regparse_8c.html#a04707c51659bce94885f3eef37be748b">is_invalid_quantifier_target</a>(<a class="code" href="../../d0/d6e/struct___node.html">Node</a>* <a class="code" href="../../d7/dc0/parse_8y.html#a0d7af8a92c4b0a07f71585584ef9634f">node</a>)
<a name="l02157"></a>02157 {
<a name="l02158"></a>02158   <span class="keywordflow">switch</span> (<a class="code" href="../../d1/dfc/regparse_8h.html#ad500a736993c4ddc933ff93b42eeb1e5">NTYPE</a>(node)) {
<a name="l02159"></a>02159   <span class="keywordflow">case</span> <a class="code" href="../../d1/dfc/regparse_8h.html#a4169804cb78eccf494a7f72ae737be32">NT_ANCHOR</a>:
<a name="l02160"></a>02160     <span class="keywordflow">return</span> 1;
<a name="l02161"></a>02161     <span class="keywordflow">break</span>;
<a name="l02162"></a>02162 
<a name="l02163"></a>02163   <span class="keywordflow">case</span> <a class="code" href="../../d1/dfc/regparse_8h.html#a28d3349039b07e17b82e258cd8f73897">NT_ENCLOSE</a>:
<a name="l02164"></a>02164     <span class="comment">/* allow enclosed elements */</span>
<a name="l02165"></a>02165     <span class="comment">/* return is_invalid_quantifier_target(NENCLOSE(node)-&gt;target); */</span>
<a name="l02166"></a>02166     <span class="keywordflow">break</span>;
<a name="l02167"></a>02167 
<a name="l02168"></a>02168   <span class="keywordflow">case</span> <a class="code" href="../../d1/dfc/regparse_8h.html#aba3b5392b65c7a886251ccb7bdf93cf0">NT_LIST</a>:
<a name="l02169"></a>02169     <span class="keywordflow">do</span> {
<a name="l02170"></a>02170       <span class="keywordflow">if</span> (! <a class="code" href="../../d6/dda/regparse_8c.html#a04707c51659bce94885f3eef37be748b">is_invalid_quantifier_target</a>(<a class="code" href="../../d1/dfc/regparse_8h.html#ace12d76fd705497f81e4e2cd95cd247e">NCAR</a>(node))) <span class="keywordflow">return</span> 0;
<a name="l02171"></a>02171     } <span class="keywordflow">while</span> (<a class="code" href="../../d6/d87/regint_8h.html#a4bc25fbd4749a2c130d1ae7f15ba140c">IS_NOT_NULL</a>(node = <a class="code" href="../../d1/dfc/regparse_8h.html#ac3a01065a5b7f17aad984671c730739e">NCDR</a>(node)));
<a name="l02172"></a>02172     <span class="keywordflow">return</span> 0;
<a name="l02173"></a>02173     <span class="keywordflow">break</span>;
<a name="l02174"></a>02174 
<a name="l02175"></a>02175   <span class="keywordflow">case</span> <a class="code" href="../../d1/dfc/regparse_8h.html#ae71a11e8c4757331e146c7c055c28294">NT_ALT</a>:
<a name="l02176"></a>02176     <span class="keywordflow">do</span> {
<a name="l02177"></a>02177       <span class="keywordflow">if</span> (<a class="code" href="../../d6/dda/regparse_8c.html#a04707c51659bce94885f3eef37be748b">is_invalid_quantifier_target</a>(<a class="code" href="../../d1/dfc/regparse_8h.html#ace12d76fd705497f81e4e2cd95cd247e">NCAR</a>(node))) <span class="keywordflow">return</span> 1;
<a name="l02178"></a>02178     } <span class="keywordflow">while</span> (<a class="code" href="../../d6/d87/regint_8h.html#a4bc25fbd4749a2c130d1ae7f15ba140c">IS_NOT_NULL</a>(node = <a class="code" href="../../d1/dfc/regparse_8h.html#ac3a01065a5b7f17aad984671c730739e">NCDR</a>(node)));
<a name="l02179"></a>02179     <span class="keywordflow">break</span>;
<a name="l02180"></a>02180 
<a name="l02181"></a>02181   <span class="keywordflow">default</span>:
<a name="l02182"></a>02182     <span class="keywordflow">break</span>;
<a name="l02183"></a>02183   }
<a name="l02184"></a>02184   <span class="keywordflow">return</span> 0;
<a name="l02185"></a>02185 }
<a name="l02186"></a>02186 <span class="preprocessor">#else</span>
<a name="l02187"></a><a class="code" href="../../d6/dda/regparse_8c.html#a04707c51659bce94885f3eef37be748b">02187</a> <span class="preprocessor"></span><span class="preprocessor">#define is_invalid_quantifier_target(node) 0</span>
<a name="l02188"></a>02188 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l02189"></a>02189 <span class="preprocessor"></span>
<a name="l02190"></a>02190 <span class="comment">/* ?:0, *:1, +:2, ??:3, *?:4, +?:5 */</span>
<a name="l02191"></a>02191 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l02192"></a><a class="code" href="../../d6/dda/regparse_8c.html#ad0588379c3e11c85d9df21597c747590">02192</a> <a class="code" href="../../d6/dda/regparse_8c.html#ad0588379c3e11c85d9df21597c747590">popular_quantifier_num</a>(<a class="code" href="../../d4/dfa/struct_qtfr_node.html">QtfrNode</a>* q)
<a name="l02193"></a>02193 {
<a name="l02194"></a>02194   <span class="keywordflow">if</span> (q-&gt;<a class="code" href="../../d4/dfa/struct_qtfr_node.html#a8a7f7398dce22e1445a7900f90e374bf">greedy</a>) {
<a name="l02195"></a>02195     <span class="keywordflow">if</span> (q-&gt;<a class="code" href="../../d4/dfa/struct_qtfr_node.html#a2a09a09d1685822771870905699f4c4d">lower</a> == 0) {
<a name="l02196"></a>02196       <span class="keywordflow">if</span> (q-&gt;<a class="code" href="../../d4/dfa/struct_qtfr_node.html#ad6302c7e3c130ed1f322b11ca7b7b3b8">upper</a> == 1) <span class="keywordflow">return</span> 0;
<a name="l02197"></a>02197       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d6/d87/regint_8h.html#a7b7f11d4b2705496b7711598403d4f72">IS_REPEAT_INFINITE</a>(q-&gt;<a class="code" href="../../d4/dfa/struct_qtfr_node.html#ad6302c7e3c130ed1f322b11ca7b7b3b8">upper</a>)) <span class="keywordflow">return</span> 1;
<a name="l02198"></a>02198     }
<a name="l02199"></a>02199     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (q-&gt;<a class="code" href="../../d4/dfa/struct_qtfr_node.html#a2a09a09d1685822771870905699f4c4d">lower</a> == 1) {
<a name="l02200"></a>02200       <span class="keywordflow">if</span> (<a class="code" href="../../d6/d87/regint_8h.html#a7b7f11d4b2705496b7711598403d4f72">IS_REPEAT_INFINITE</a>(q-&gt;<a class="code" href="../../d4/dfa/struct_qtfr_node.html#ad6302c7e3c130ed1f322b11ca7b7b3b8">upper</a>)) <span class="keywordflow">return</span> 2;
<a name="l02201"></a>02201     }
<a name="l02202"></a>02202   }
<a name="l02203"></a>02203   <span class="keywordflow">else</span> {
<a name="l02204"></a>02204     <span class="keywordflow">if</span> (q-&gt;<a class="code" href="../../d4/dfa/struct_qtfr_node.html#a2a09a09d1685822771870905699f4c4d">lower</a> == 0) {
<a name="l02205"></a>02205       <span class="keywordflow">if</span> (q-&gt;<a class="code" href="../../d4/dfa/struct_qtfr_node.html#ad6302c7e3c130ed1f322b11ca7b7b3b8">upper</a> == 1) <span class="keywordflow">return</span> 3;
<a name="l02206"></a>02206       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d6/d87/regint_8h.html#a7b7f11d4b2705496b7711598403d4f72">IS_REPEAT_INFINITE</a>(q-&gt;<a class="code" href="../../d4/dfa/struct_qtfr_node.html#ad6302c7e3c130ed1f322b11ca7b7b3b8">upper</a>)) <span class="keywordflow">return</span> 4;
<a name="l02207"></a>02207     }
<a name="l02208"></a>02208     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (q-&gt;<a class="code" href="../../d4/dfa/struct_qtfr_node.html#a2a09a09d1685822771870905699f4c4d">lower</a> == 1) {
<a name="l02209"></a>02209       <span class="keywordflow">if</span> (<a class="code" href="../../d6/d87/regint_8h.html#a7b7f11d4b2705496b7711598403d4f72">IS_REPEAT_INFINITE</a>(q-&gt;<a class="code" href="../../d4/dfa/struct_qtfr_node.html#ad6302c7e3c130ed1f322b11ca7b7b3b8">upper</a>)) <span class="keywordflow">return</span> 5;
<a name="l02210"></a>02210     }
<a name="l02211"></a>02211   }
<a name="l02212"></a>02212   <span class="keywordflow">return</span> -1;
<a name="l02213"></a>02213 }
<a name="l02214"></a>02214 
<a name="l02215"></a>02215 
<a name="l02216"></a><a class="code" href="../../d6/dda/regparse_8c.html#a26fff899180e6c348dc9565f49ff47be">02216</a> <span class="keyword">enum</span> <a class="code" href="../../d6/dda/regparse_8c.html#a26fff899180e6c348dc9565f49ff47be">ReduceType</a> {
<a name="l02217"></a><a class="code" href="../../d6/dda/regparse_8c.html#a26fff899180e6c348dc9565f49ff47beabe88693340c4c0c4faf73309b9abd3fe">02217</a>   <a class="code" href="../../d6/dda/regparse_8c.html#a26fff899180e6c348dc9565f49ff47beabe88693340c4c0c4faf73309b9abd3fe">RQ_ASIS</a> = 0, <span class="comment">/* as is */</span>
<a name="l02218"></a><a class="code" href="../../d6/dda/regparse_8c.html#a26fff899180e6c348dc9565f49ff47beadf468bf43946f854b6ce42b414a30774">02218</a>   <a class="code" href="../../d6/dda/regparse_8c.html#a26fff899180e6c348dc9565f49ff47beadf468bf43946f854b6ce42b414a30774">RQ_DEL</a>  = 1, <span class="comment">/* delete parent */</span>
<a name="l02219"></a><a class="code" href="../../d6/dda/regparse_8c.html#a26fff899180e6c348dc9565f49ff47beaf3b343f9ea0a6ddf9fece497d657f01a">02219</a>   <a class="code" href="../../d6/dda/regparse_8c.html#a26fff899180e6c348dc9565f49ff47beaf3b343f9ea0a6ddf9fece497d657f01a">RQ_A</a>,        <span class="comment">/* to &apos;*&apos;    */</span>
<a name="l02220"></a><a class="code" href="../../d6/dda/regparse_8c.html#a26fff899180e6c348dc9565f49ff47beac86dac37fa637a4e07f85c07f0f1f101">02220</a>   <a class="code" href="../../d6/dda/regparse_8c.html#a26fff899180e6c348dc9565f49ff47beac86dac37fa637a4e07f85c07f0f1f101">RQ_AQ</a>,       <span class="comment">/* to &apos;*?&apos;   */</span>
<a name="l02221"></a><a class="code" href="../../d6/dda/regparse_8c.html#a26fff899180e6c348dc9565f49ff47bea1b442d85c43bc6cf9f78dcec6689a6b0">02221</a>   <a class="code" href="../../d6/dda/regparse_8c.html#a26fff899180e6c348dc9565f49ff47bea1b442d85c43bc6cf9f78dcec6689a6b0">RQ_QQ</a>,       <span class="comment">/* to &apos;??&apos;   */</span>
<a name="l02222"></a><a class="code" href="../../d6/dda/regparse_8c.html#a26fff899180e6c348dc9565f49ff47beacf2afe7d48cf77b1280b55b740216482">02222</a>   <a class="code" href="../../d6/dda/regparse_8c.html#a26fff899180e6c348dc9565f49ff47beacf2afe7d48cf77b1280b55b740216482">RQ_P_QQ</a>,     <span class="comment">/* to &apos;+)??&apos; */</span>
<a name="l02223"></a><a class="code" href="../../d6/dda/regparse_8c.html#a26fff899180e6c348dc9565f49ff47beab09e1a488ae7d72f1958e54323e733a3">02223</a>   <a class="code" href="../../d6/dda/regparse_8c.html#a26fff899180e6c348dc9565f49ff47beab09e1a488ae7d72f1958e54323e733a3">RQ_PQ_Q</a>      <span class="comment">/* to &apos;+?)?&apos; */</span>
<a name="l02224"></a>02224 };
<a name="l02225"></a>02225 
<a name="l02226"></a><a class="code" href="../../d6/dda/regparse_8c.html#a4838a46ac41acd0aa758f6ed8ced5a81">02226</a> <span class="keyword">static</span> <span class="keyword">enum</span> <a class="code" href="../../d6/dda/regparse_8c.html#a26fff899180e6c348dc9565f49ff47be">ReduceType</a> <span class="keyword">const</span> <a class="code" href="../../d6/dda/regparse_8c.html#a4838a46ac41acd0aa758f6ed8ced5a81">ReduceTypeTable</a>[6][6] = {
<a name="l02227"></a>02227   {<a class="code" href="../../d6/dda/regparse_8c.html#a26fff899180e6c348dc9565f49ff47beadf468bf43946f854b6ce42b414a30774">RQ_DEL</a>,  <a class="code" href="../../d6/dda/regparse_8c.html#a26fff899180e6c348dc9565f49ff47beaf3b343f9ea0a6ddf9fece497d657f01a">RQ_A</a>,    RQ_A,   <a class="code" href="../../d6/dda/regparse_8c.html#a26fff899180e6c348dc9565f49ff47bea1b442d85c43bc6cf9f78dcec6689a6b0">RQ_QQ</a>,   <a class="code" href="../../d6/dda/regparse_8c.html#a26fff899180e6c348dc9565f49ff47beac86dac37fa637a4e07f85c07f0f1f101">RQ_AQ</a>,   <a class="code" href="../../d6/dda/regparse_8c.html#a26fff899180e6c348dc9565f49ff47beabe88693340c4c0c4faf73309b9abd3fe">RQ_ASIS</a>}, <span class="comment">/* &apos;?&apos;  */</span>
<a name="l02228"></a>02228   {<a class="code" href="../../d6/dda/regparse_8c.html#a26fff899180e6c348dc9565f49ff47beadf468bf43946f854b6ce42b414a30774">RQ_DEL</a>,  <a class="code" href="../../d6/dda/regparse_8c.html#a26fff899180e6c348dc9565f49ff47beadf468bf43946f854b6ce42b414a30774">RQ_DEL</a>,  RQ_DEL, <a class="code" href="../../d6/dda/regparse_8c.html#a26fff899180e6c348dc9565f49ff47beacf2afe7d48cf77b1280b55b740216482">RQ_P_QQ</a>, RQ_P_QQ, RQ_DEL},  <span class="comment">/* &apos;*&apos;  */</span>
<a name="l02229"></a>02229   {<a class="code" href="../../d6/dda/regparse_8c.html#a26fff899180e6c348dc9565f49ff47beaf3b343f9ea0a6ddf9fece497d657f01a">RQ_A</a>,    <a class="code" href="../../d6/dda/regparse_8c.html#a26fff899180e6c348dc9565f49ff47beaf3b343f9ea0a6ddf9fece497d657f01a">RQ_A</a>,    <a class="code" href="../../d6/dda/regparse_8c.html#a26fff899180e6c348dc9565f49ff47beadf468bf43946f854b6ce42b414a30774">RQ_DEL</a>, <a class="code" href="../../d6/dda/regparse_8c.html#a26fff899180e6c348dc9565f49ff47beabe88693340c4c0c4faf73309b9abd3fe">RQ_ASIS</a>, <a class="code" href="../../d6/dda/regparse_8c.html#a26fff899180e6c348dc9565f49ff47beacf2afe7d48cf77b1280b55b740216482">RQ_P_QQ</a>, RQ_DEL},  <span class="comment">/* &apos;+&apos;  */</span>
<a name="l02230"></a>02230   {<a class="code" href="../../d6/dda/regparse_8c.html#a26fff899180e6c348dc9565f49ff47beadf468bf43946f854b6ce42b414a30774">RQ_DEL</a>,  <a class="code" href="../../d6/dda/regparse_8c.html#a26fff899180e6c348dc9565f49ff47beac86dac37fa637a4e07f85c07f0f1f101">RQ_AQ</a>,   RQ_AQ,  <a class="code" href="../../d6/dda/regparse_8c.html#a26fff899180e6c348dc9565f49ff47beadf468bf43946f854b6ce42b414a30774">RQ_DEL</a>,  RQ_AQ,   RQ_AQ},   <span class="comment">/* &apos;??&apos; */</span>
<a name="l02231"></a>02231   {<a class="code" href="../../d6/dda/regparse_8c.html#a26fff899180e6c348dc9565f49ff47beadf468bf43946f854b6ce42b414a30774">RQ_DEL</a>,  <a class="code" href="../../d6/dda/regparse_8c.html#a26fff899180e6c348dc9565f49ff47beadf468bf43946f854b6ce42b414a30774">RQ_DEL</a>,  RQ_DEL, RQ_DEL,  RQ_DEL,  RQ_DEL},  <span class="comment">/* &apos;*?&apos; */</span>
<a name="l02232"></a>02232   {<a class="code" href="../../d6/dda/regparse_8c.html#a26fff899180e6c348dc9565f49ff47beabe88693340c4c0c4faf73309b9abd3fe">RQ_ASIS</a>, <a class="code" href="../../d6/dda/regparse_8c.html#a26fff899180e6c348dc9565f49ff47beab09e1a488ae7d72f1958e54323e733a3">RQ_PQ_Q</a>, <a class="code" href="../../d6/dda/regparse_8c.html#a26fff899180e6c348dc9565f49ff47beadf468bf43946f854b6ce42b414a30774">RQ_DEL</a>, <a class="code" href="../../d6/dda/regparse_8c.html#a26fff899180e6c348dc9565f49ff47beac86dac37fa637a4e07f85c07f0f1f101">RQ_AQ</a>,   RQ_AQ,   RQ_DEL}   <span class="comment">/* &apos;+?&apos; */</span>
<a name="l02233"></a>02233 };
<a name="l02234"></a>02234 
<a name="l02235"></a>02235 <span class="keyword">extern</span> <span class="keywordtype">void</span>
<a name="l02236"></a><a class="code" href="../../d6/dda/regparse_8c.html#ace588d68b5808852a8265c27b18e6ed2">02236</a> <a class="code" href="../../d6/dda/regparse_8c.html#ace588d68b5808852a8265c27b18e6ed2">onig_reduce_nested_quantifier</a>(<a class="code" href="../../d0/d6e/struct___node.html">Node</a>* pnode, <a class="code" href="../../d0/d6e/struct___node.html">Node</a>* cnode)
<a name="l02237"></a>02237 {
<a name="l02238"></a>02238   <span class="keywordtype">int</span> pnum, cnum;
<a name="l02239"></a>02239   <a class="code" href="../../d4/dfa/struct_qtfr_node.html">QtfrNode</a> *p, *c;
<a name="l02240"></a>02240 
<a name="l02241"></a>02241   p = <a class="code" href="../../d1/dfc/regparse_8h.html#addc653094848075876587782124e9504">NQTFR</a>(pnode);
<a name="l02242"></a>02242   c = <a class="code" href="../../d1/dfc/regparse_8h.html#addc653094848075876587782124e9504">NQTFR</a>(cnode);
<a name="l02243"></a>02243   pnum = <a class="code" href="../../d6/dda/regparse_8c.html#ad0588379c3e11c85d9df21597c747590">popular_quantifier_num</a>(p);
<a name="l02244"></a>02244   cnum = <a class="code" href="../../d6/dda/regparse_8c.html#ad0588379c3e11c85d9df21597c747590">popular_quantifier_num</a>(c);
<a name="l02245"></a>02245   <span class="keywordflow">if</span> (pnum &lt; 0 || cnum &lt; 0) return ;
<a name="l02246"></a>02246 
<a name="l02247"></a>02247   <span class="keywordflow">switch</span>(ReduceTypeTable[cnum][pnum]) {
<a name="l02248"></a>02248   <span class="keywordflow">case</span> <a class="code" href="../../d6/dda/regparse_8c.html#a26fff899180e6c348dc9565f49ff47beadf468bf43946f854b6ce42b414a30774">RQ_DEL</a>:
<a name="l02249"></a>02249     *pnode = *cnode;
<a name="l02250"></a>02250     <span class="keywordflow">break</span>;
<a name="l02251"></a>02251   <span class="keywordflow">case</span> <a class="code" href="../../d6/dda/regparse_8c.html#a26fff899180e6c348dc9565f49ff47beaf3b343f9ea0a6ddf9fece497d657f01a">RQ_A</a>:
<a name="l02252"></a>02252     p-&gt;<a class="code" href="../../d4/dfa/struct_qtfr_node.html#a358ba7208e8bf097527cc9813adc5017">target</a> = c-&gt;<a class="code" href="../../d4/dfa/struct_qtfr_node.html#a358ba7208e8bf097527cc9813adc5017">target</a>;
<a name="l02253"></a>02253     p-&gt;<a class="code" href="../../d4/dfa/struct_qtfr_node.html#a2a09a09d1685822771870905699f4c4d">lower</a>  = 0;  p-&gt;<a class="code" href="../../d4/dfa/struct_qtfr_node.html#ad6302c7e3c130ed1f322b11ca7b7b3b8">upper</a> = <a class="code" href="../../d6/d87/regint_8h.html#aaaf8d5e1b9d204ddb0b681077890b01f">REPEAT_INFINITE</a>;  p-&gt;<a class="code" href="../../d4/dfa/struct_qtfr_node.html#a8a7f7398dce22e1445a7900f90e374bf">greedy</a> = 1;
<a name="l02254"></a>02254     <span class="keywordflow">break</span>;
<a name="l02255"></a>02255   <span class="keywordflow">case</span> <a class="code" href="../../d6/dda/regparse_8c.html#a26fff899180e6c348dc9565f49ff47beac86dac37fa637a4e07f85c07f0f1f101">RQ_AQ</a>:
<a name="l02256"></a>02256     p-&gt;<a class="code" href="../../d4/dfa/struct_qtfr_node.html#a358ba7208e8bf097527cc9813adc5017">target</a> = c-&gt;<a class="code" href="../../d4/dfa/struct_qtfr_node.html#a358ba7208e8bf097527cc9813adc5017">target</a>;
<a name="l02257"></a>02257     p-&gt;<a class="code" href="../../d4/dfa/struct_qtfr_node.html#a2a09a09d1685822771870905699f4c4d">lower</a>  = 0;  p-&gt;<a class="code" href="../../d4/dfa/struct_qtfr_node.html#ad6302c7e3c130ed1f322b11ca7b7b3b8">upper</a> = <a class="code" href="../../d6/d87/regint_8h.html#aaaf8d5e1b9d204ddb0b681077890b01f">REPEAT_INFINITE</a>;  p-&gt;<a class="code" href="../../d4/dfa/struct_qtfr_node.html#a8a7f7398dce22e1445a7900f90e374bf">greedy</a> = 0;
<a name="l02258"></a>02258     <span class="keywordflow">break</span>;
<a name="l02259"></a>02259   <span class="keywordflow">case</span> <a class="code" href="../../d6/dda/regparse_8c.html#a26fff899180e6c348dc9565f49ff47bea1b442d85c43bc6cf9f78dcec6689a6b0">RQ_QQ</a>:
<a name="l02260"></a>02260     p-&gt;<a class="code" href="../../d4/dfa/struct_qtfr_node.html#a358ba7208e8bf097527cc9813adc5017">target</a> = c-&gt;<a class="code" href="../../d4/dfa/struct_qtfr_node.html#a358ba7208e8bf097527cc9813adc5017">target</a>;
<a name="l02261"></a>02261     p-&gt;<a class="code" href="../../d4/dfa/struct_qtfr_node.html#a2a09a09d1685822771870905699f4c4d">lower</a>  = 0;  p-&gt;<a class="code" href="../../d4/dfa/struct_qtfr_node.html#ad6302c7e3c130ed1f322b11ca7b7b3b8">upper</a> = 1;  p-&gt;<a class="code" href="../../d4/dfa/struct_qtfr_node.html#a8a7f7398dce22e1445a7900f90e374bf">greedy</a> = 0;
<a name="l02262"></a>02262     <span class="keywordflow">break</span>;
<a name="l02263"></a>02263   <span class="keywordflow">case</span> <a class="code" href="../../d6/dda/regparse_8c.html#a26fff899180e6c348dc9565f49ff47beacf2afe7d48cf77b1280b55b740216482">RQ_P_QQ</a>:
<a name="l02264"></a>02264     p-&gt;<a class="code" href="../../d4/dfa/struct_qtfr_node.html#a358ba7208e8bf097527cc9813adc5017">target</a> = cnode;
<a name="l02265"></a>02265     p-&gt;<a class="code" href="../../d4/dfa/struct_qtfr_node.html#a2a09a09d1685822771870905699f4c4d">lower</a>  = 0;  p-&gt;<a class="code" href="../../d4/dfa/struct_qtfr_node.html#ad6302c7e3c130ed1f322b11ca7b7b3b8">upper</a> = 1;  p-&gt;<a class="code" href="../../d4/dfa/struct_qtfr_node.html#a8a7f7398dce22e1445a7900f90e374bf">greedy</a> = 0;
<a name="l02266"></a>02266     c-&gt;<a class="code" href="../../d4/dfa/struct_qtfr_node.html#a2a09a09d1685822771870905699f4c4d">lower</a>  = 1;  c-&gt;<a class="code" href="../../d4/dfa/struct_qtfr_node.html#ad6302c7e3c130ed1f322b11ca7b7b3b8">upper</a> = <a class="code" href="../../d6/d87/regint_8h.html#aaaf8d5e1b9d204ddb0b681077890b01f">REPEAT_INFINITE</a>;  c-&gt;<a class="code" href="../../d4/dfa/struct_qtfr_node.html#a8a7f7398dce22e1445a7900f90e374bf">greedy</a> = 1;
<a name="l02267"></a>02267     return ;
<a name="l02268"></a>02268     <span class="keywordflow">break</span>;
<a name="l02269"></a>02269   <span class="keywordflow">case</span> <a class="code" href="../../d6/dda/regparse_8c.html#a26fff899180e6c348dc9565f49ff47beab09e1a488ae7d72f1958e54323e733a3">RQ_PQ_Q</a>:
<a name="l02270"></a>02270     p-&gt;<a class="code" href="../../d4/dfa/struct_qtfr_node.html#a358ba7208e8bf097527cc9813adc5017">target</a> = cnode;
<a name="l02271"></a>02271     p-&gt;<a class="code" href="../../d4/dfa/struct_qtfr_node.html#a2a09a09d1685822771870905699f4c4d">lower</a>  = 0;  p-&gt;<a class="code" href="../../d4/dfa/struct_qtfr_node.html#ad6302c7e3c130ed1f322b11ca7b7b3b8">upper</a> = 1;  p-&gt;<a class="code" href="../../d4/dfa/struct_qtfr_node.html#a8a7f7398dce22e1445a7900f90e374bf">greedy</a> = 1;
<a name="l02272"></a>02272     c-&gt;<a class="code" href="../../d4/dfa/struct_qtfr_node.html#a2a09a09d1685822771870905699f4c4d">lower</a>  = 1;  c-&gt;<a class="code" href="../../d4/dfa/struct_qtfr_node.html#ad6302c7e3c130ed1f322b11ca7b7b3b8">upper</a> = <a class="code" href="../../d6/d87/regint_8h.html#aaaf8d5e1b9d204ddb0b681077890b01f">REPEAT_INFINITE</a>;  c-&gt;<a class="code" href="../../d4/dfa/struct_qtfr_node.html#a8a7f7398dce22e1445a7900f90e374bf">greedy</a> = 0;
<a name="l02273"></a>02273     return ;
<a name="l02274"></a>02274     <span class="keywordflow">break</span>;
<a name="l02275"></a>02275   <span class="keywordflow">case</span> <a class="code" href="../../d6/dda/regparse_8c.html#a26fff899180e6c348dc9565f49ff47beabe88693340c4c0c4faf73309b9abd3fe">RQ_ASIS</a>:
<a name="l02276"></a>02276     p-&gt;<a class="code" href="../../d4/dfa/struct_qtfr_node.html#a358ba7208e8bf097527cc9813adc5017">target</a> = cnode;
<a name="l02277"></a>02277     return ;
<a name="l02278"></a>02278     <span class="keywordflow">break</span>;
<a name="l02279"></a>02279   }
<a name="l02280"></a>02280 
<a name="l02281"></a>02281   c-&gt;<a class="code" href="../../d4/dfa/struct_qtfr_node.html#a358ba7208e8bf097527cc9813adc5017">target</a> = <a class="code" href="../../d3/d7f/gram_8c.html#ac00d2982d51115efbe8a13840d47b7a7">NULL_NODE</a>;
<a name="l02282"></a>02282   <a class="code" href="../../d6/dda/regparse_8c.html#aa98ee34de192fd4997906389f70f4808">onig_node_free</a>(cnode);
<a name="l02283"></a>02283 }
<a name="l02284"></a>02284 
<a name="l02285"></a>02285 
<a name="l02286"></a><a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250d">02286</a> <span class="keyword">enum</span> <a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250d">TokenSyms</a> {
<a name="l02287"></a><a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250da4b2acbe6a651813a07506f06d624ac3b">02287</a>   <a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250da4b2acbe6a651813a07506f06d624ac3b">TK_EOT</a>      = 0,   <span class="comment">/* end of token */</span>
<a name="l02288"></a><a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250dab0e056f20d46d5a9696dd7fdea89de88">02288</a>   <a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250dab0e056f20d46d5a9696dd7fdea89de88">TK_RAW_BYTE</a> = 1,
<a name="l02289"></a><a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250dafa4fad7de330d203eb444651f110045d">02289</a>   <a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250dafa4fad7de330d203eb444651f110045d">TK_CHAR</a>,
<a name="l02290"></a><a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250da2f748d118b4a20e2b1dc12538ccd9876">02290</a>   <a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250da2f748d118b4a20e2b1dc12538ccd9876">TK_STRING</a>,
<a name="l02291"></a><a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250da7a451b3ab1e788efaa2da058c6c8b49c">02291</a>   <a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250da7a451b3ab1e788efaa2da058c6c8b49c">TK_CODE_POINT</a>,
<a name="l02292"></a><a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250da1753696cfcc436c5ed6c31a5de77b3cd">02292</a>   <a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250da1753696cfcc436c5ed6c31a5de77b3cd">TK_ANYCHAR</a>,
<a name="l02293"></a><a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250da664a7e468d295958edd0864e4f3cf461">02293</a>   <a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250da664a7e468d295958edd0864e4f3cf461">TK_CHAR_TYPE</a>,
<a name="l02294"></a><a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250da6009b276a2eb504bd2db835140ef34c4">02294</a>   <a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250da6009b276a2eb504bd2db835140ef34c4">TK_BACKREF</a>,
<a name="l02295"></a><a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250da8198b2b556338495587a25b47927061a">02295</a>   <a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250da8198b2b556338495587a25b47927061a">TK_CALL</a>,
<a name="l02296"></a><a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250da35870f30489b8c9a3dc0c7197b8e880b">02296</a>   <a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250da35870f30489b8c9a3dc0c7197b8e880b">TK_ANCHOR</a>,
<a name="l02297"></a><a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250daef6e175c79d6876bc5d93d82c1d13eb8">02297</a>   <a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250daef6e175c79d6876bc5d93d82c1d13eb8">TK_OP_REPEAT</a>,
<a name="l02298"></a><a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250da6d79c0cbba40a10a9d6790b9b874c833">02298</a>   <a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250da6d79c0cbba40a10a9d6790b9b874c833">TK_INTERVAL</a>,
<a name="l02299"></a><a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250da280d14d1e68a04cda6cdeb5ffe52791f">02299</a>   <a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250da280d14d1e68a04cda6cdeb5ffe52791f">TK_ANYCHAR_ANYTIME</a>,  <span class="comment">/* SQL &apos;%&apos; == .* */</span>
<a name="l02300"></a><a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250da902b0cdea9f57e86f33e1c42c38bae8a">02300</a>   <a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250da902b0cdea9f57e86f33e1c42c38bae8a">TK_ALT</a>,
<a name="l02301"></a><a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250da6d28cfb6350f8a3218170fd0f913aec3">02301</a>   <a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250da6d28cfb6350f8a3218170fd0f913aec3">TK_SUBEXP_OPEN</a>,
<a name="l02302"></a><a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250da2abb18f0f4ef734b4ce575c044b4e1e7">02302</a>   <a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250da2abb18f0f4ef734b4ce575c044b4e1e7">TK_SUBEXP_CLOSE</a>,
<a name="l02303"></a><a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250da5817d25633c6a037e356c292ea7622d7">02303</a>   <a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250da5817d25633c6a037e356c292ea7622d7">TK_CC_OPEN</a>,
<a name="l02304"></a><a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250da4bf244fe4348e0d0491bafa6adfa13d1">02304</a>   <a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250da4bf244fe4348e0d0491bafa6adfa13d1">TK_QUOTE_OPEN</a>,
<a name="l02305"></a><a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250da81d0318969b984a3d42eab29ec60fb47">02305</a>   <a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250da81d0318969b984a3d42eab29ec60fb47">TK_CHAR_PROPERTY</a>,    <span class="comment">/* \p{...}, \P{...} */</span>
<a name="l02306"></a>02306   <span class="comment">/* in cc */</span>
<a name="l02307"></a><a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250dae586fca38ba46f46c46282713162c015">02307</a>   <a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250dae586fca38ba46f46c46282713162c015">TK_CC_CLOSE</a>,
<a name="l02308"></a><a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250da2e4091d6c916e3a8bf35cce296ed7cea">02308</a>   <a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250da2e4091d6c916e3a8bf35cce296ed7cea">TK_CC_RANGE</a>,
<a name="l02309"></a><a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250da6e96fa876eef3f96744f4c75918c5fe0">02309</a>   <a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250da6e96fa876eef3f96744f4c75918c5fe0">TK_POSIX_BRACKET_OPEN</a>,
<a name="l02310"></a><a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250da0c9bf741e5d886ddcad4642e09be7ee1">02310</a>   <a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250da0c9bf741e5d886ddcad4642e09be7ee1">TK_CC_AND</a>,             <span class="comment">/* &amp;&amp; */</span>
<a name="l02311"></a><a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250da8e5ae596c6ac79675686299605443b64">02311</a>   <a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250da8e5ae596c6ac79675686299605443b64">TK_CC_CC_OPEN</a>          <span class="comment">/* [ */</span>
<a name="l02312"></a>02312 };
<a name="l02313"></a>02313 
<a name="l02314"></a><a class="code" href="../../d0/d80/struct_onig_token.html">02314</a> <span class="keyword">typedef</span> <span class="keyword">struct </span>{
<a name="l02315"></a><a class="code" href="../../d0/d80/struct_onig_token.html#a46f3343f204ac67de13f0a774284e476">02315</a>   <span class="keyword">enum</span> <a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250d">TokenSyms</a> <a class="code" href="../../d5/d9d/tcltklib_8c.html#ac765329451135abec74c45e1897abf26">type</a>;
<a name="l02316"></a><a class="code" href="../../d0/d80/struct_onig_token.html#a71ac92059fef31b2d7932d04523f8c17">02316</a>   <span class="keywordtype">int</span> escaped;
<a name="l02317"></a><a class="code" href="../../d0/d80/struct_onig_token.html#a938bb7f9e071e3c6ce68480e3138a0cc">02317</a>   <span class="keywordtype">int</span> base;   <span class="comment">/* is number: 8, 16 (used in [....]) */</span>
<a name="l02318"></a><a class="code" href="../../d0/d80/struct_onig_token.html#accba0041ec257e1619caefea1ea12d10">02318</a>   <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>* backp;
<a name="l02319"></a>02319   <span class="keyword">union </span>{
<a name="l02320"></a><a class="code" href="../../d0/d80/struct_onig_token.html#a7bbb79ad3a0ff1e0c961df243ed45ae5">02320</a>     <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>* s;
<a name="l02321"></a><a class="code" href="../../d0/d80/struct_onig_token.html#ac1f4ee5fa57d7ebbfa95642148efe0f5">02321</a>     <span class="keywordtype">int</span>   c;
<a name="l02322"></a><a class="code" href="../../d0/d80/struct_onig_token.html#a40121b0193b6bbfbf9fdb88d82f1ea7a">02322</a>     <a class="code" href="../../d8/db3/oniguruma_8h.html#a7c8a84bc12127007886efbfcf53b6fb5">OnigCodePoint</a> code;
<a name="l02323"></a><a class="code" href="../../d0/d80/struct_onig_token.html#a8f7fd17d715a4ce24540eef7b411ec62">02323</a>     <span class="keywordtype">int</span>   anchor;
<a name="l02324"></a><a class="code" href="../../d0/d80/struct_onig_token.html#a35c9bc2e550c33f1909fa430fa3e7733">02324</a>     <span class="keywordtype">int</span>   subtype;
<a name="l02325"></a>02325     <span class="keyword">struct </span>{
<a name="l02326"></a><a class="code" href="../../d0/d80/struct_onig_token.html#aafb507fa1ed9d59f26e86a849f3a712a">02326</a>       <span class="keywordtype">int</span> lower;
<a name="l02327"></a><a class="code" href="../../d0/d80/struct_onig_token.html#a5ff91b0feca47ff5b69a2643e26b505f">02327</a>       <span class="keywordtype">int</span> upper;
<a name="l02328"></a><a class="code" href="../../d0/d80/struct_onig_token.html#aeaeab9aa50540ededbd16587f10f4f96">02328</a>       <span class="keywordtype">int</span> greedy;
<a name="l02329"></a><a class="code" href="../../d0/d80/struct_onig_token.html#abe5468558845f1011fda84708d816027">02329</a>       <span class="keywordtype">int</span> possessive;
<a name="l02330"></a>02330     } repeat;
<a name="l02331"></a>02331     <span class="keyword">struct </span>{
<a name="l02332"></a><a class="code" href="../../d0/d80/struct_onig_token.html#a4bf7ba1e0aa0dfe95c28a343bba5c651">02332</a>       <span class="keywordtype">int</span>  num;
<a name="l02333"></a><a class="code" href="../../d0/d80/struct_onig_token.html#a034ded8e83d0572f2aca51f18134c6a1">02333</a>       <span class="keywordtype">int</span>  ref1;
<a name="l02334"></a><a class="code" href="../../d0/d80/struct_onig_token.html#a4144217e14dfde4e4c0dce1edb505ac8">02334</a>       <span class="keywordtype">int</span>* refs;
<a name="l02335"></a><a class="code" href="../../d0/d80/struct_onig_token.html#a9f3acf29111ac66a1c3011c71eb82a64">02335</a>       <span class="keywordtype">int</span>  by_name;
<a name="l02336"></a>02336 <span class="preprocessor">#ifdef USE_BACKREF_WITH_LEVEL</span>
<a name="l02337"></a><a class="code" href="../../d0/d80/struct_onig_token.html#a4d30c66fba32b30e7b49288aa8acf914">02337</a> <span class="preprocessor"></span>      <span class="keywordtype">int</span>  exist_level;
<a name="l02338"></a><a class="code" href="../../d0/d80/struct_onig_token.html#af784e70e0320ea39fd093686432f8eea">02338</a>       <span class="keywordtype">int</span>  level;   <span class="comment">/* \k&lt;name+n&gt; */</span>
<a name="l02339"></a>02339 <span class="preprocessor">#endif</span>
<a name="l02340"></a>02340 <span class="preprocessor"></span>    } backref;
<a name="l02341"></a>02341     <span class="keyword">struct </span>{
<a name="l02342"></a><a class="code" href="../../d0/d80/struct_onig_token.html#a7984fd71874118d96468dbe178fbaa17">02342</a>       <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>* name;
<a name="l02343"></a><a class="code" href="../../d0/d80/struct_onig_token.html#aaf0bc073cfae45a2843eab484bf0c515">02343</a>       <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>* name_end;
<a name="l02344"></a><a class="code" href="../../d0/d80/struct_onig_token.html#acbef04581e0e9d663faa615877874abb">02344</a>       <span class="keywordtype">int</span>    gnum;
<a name="l02345"></a>02345     } call;
<a name="l02346"></a>02346     <span class="keyword">struct </span>{
<a name="l02347"></a><a class="code" href="../../d0/d80/struct_onig_token.html#a4a2ccb61fe5148f04949d8b9f4a6fb99">02347</a>       <span class="keywordtype">int</span> ctype;
<a name="l02348"></a><a class="code" href="../../d0/d80/struct_onig_token.html#afc1fc8893a20ea01ce98dca3304c76e3">02348</a>       <span class="keywordtype">int</span> not;
<a name="l02349"></a>02349     } prop;
<a name="l02350"></a>02350   } u;
<a name="l02351"></a>02351 } <a class="code" href="../../d0/d80/struct_onig_token.html">OnigToken</a>;
<a name="l02352"></a>02352 
<a name="l02353"></a>02353 
<a name="l02354"></a>02354 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l02355"></a><a class="code" href="../../d6/dda/regparse_8c.html#a9b58f1c872c08ae8838728d04f14463d">02355</a> <a class="code" href="../../d6/dda/regparse_8c.html#a9b58f1c872c08ae8838728d04f14463d">fetch_range_quantifier</a>(<a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>** src, <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>* end, <a class="code" href="../../d0/d80/struct_onig_token.html">OnigToken</a>* <a class="code" href="../../d5/d11/ripper_8c.html#a2b3a335d617ec14d6296ca82d3055858">tok</a>, <a class="code" href="../../d6/dbe/struct_scan_env.html">ScanEnv</a>* env)
<a name="l02356"></a>02356 {
<a name="l02357"></a>02357   <span class="keywordtype">int</span> low, up, syn_allow, non_low = 0;
<a name="l02358"></a>02358   <span class="keywordtype">int</span> r = 0;
<a name="l02359"></a>02359   <a class="code" href="../../d8/db3/oniguruma_8h.html#a7c8a84bc12127007886efbfcf53b6fb5">OnigCodePoint</a> c;
<a name="l02360"></a>02360   <a class="code" href="../../d1/d7b/struct_onig_encoding_type_s_t.html">OnigEncoding</a> enc = env-&gt;<a class="code" href="../../d6/dbe/struct_scan_env.html#a97f766db4ac9dabc9d173bf99fbcc11b">enc</a>;
<a name="l02361"></a>02361   <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>* p = *src;
<a name="l02362"></a>02362   <a class="code" href="../../d6/dda/regparse_8c.html#a44975cffe07e4559bf5638cafb4a6b30">PFETCH_READY</a>;
<a name="l02363"></a>02363 
<a name="l02364"></a>02364   syn_allow = <a class="code" href="../../d1/dfc/regparse_8h.html#a18bfc9ee154d6dd516347bd71b4810f6">IS_SYNTAX_BV</a>(env-&gt;<a class="code" href="../../d6/dbe/struct_scan_env.html#ae5c4502ad7b7a4a418eda464919d2bda">syntax</a>, <a class="code" href="../../d8/db3/oniguruma_8h.html#aad472b6be9e09a13250cf51e43e3b8e9">ONIG_SYN_ALLOW_INVALID_INTERVAL</a>);
<a name="l02365"></a>02365 
<a name="l02366"></a>02366   <span class="keywordflow">if</span> (<a class="code" href="../../d6/dda/regparse_8c.html#a43ce1d83d1961694adc2dfcbfac7d690">PEND</a>) {
<a name="l02367"></a>02367     <span class="keywordflow">if</span> (syn_allow)
<a name="l02368"></a>02368       <span class="keywordflow">return</span> 1;  <span class="comment">/* &quot;....{&quot; : OK! */</span>
<a name="l02369"></a>02369     <span class="keywordflow">else</span>
<a name="l02370"></a>02370       <span class="keywordflow">return</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#a6610820630d003987b46be973b25e7c6">ONIGERR_END_PATTERN_AT_LEFT_BRACE</a>;  <span class="comment">/* &quot;....{&quot; syntax error */</span>
<a name="l02371"></a>02371   }
<a name="l02372"></a>02372 
<a name="l02373"></a>02373   <span class="keywordflow">if</span> (! syn_allow) {
<a name="l02374"></a>02374     c = <a class="code" href="../../d6/dda/regparse_8c.html#a337ed696ab55651d216a34abbafd4cd3">PPEEK</a>;
<a name="l02375"></a>02375     <span class="keywordflow">if</span> (c == <span class="charliteral">&apos;)&apos;</span> || c == <span class="charliteral">&apos;(&apos;</span> || c == <span class="charliteral">&apos;|&apos;</span>) {
<a name="l02376"></a>02376       <span class="keywordflow">return</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#a6610820630d003987b46be973b25e7c6">ONIGERR_END_PATTERN_AT_LEFT_BRACE</a>;
<a name="l02377"></a>02377     }
<a name="l02378"></a>02378   }
<a name="l02379"></a>02379 
<a name="l02380"></a>02380   low = <a class="code" href="../../d6/dda/regparse_8c.html#af172b663db06124c2c4b62a7e1377472">onig_scan_unsigned_number</a>(&amp;p, end, env-&gt;<a class="code" href="../../d6/dbe/struct_scan_env.html#a97f766db4ac9dabc9d173bf99fbcc11b">enc</a>);
<a name="l02381"></a>02381   <span class="keywordflow">if</span> (low &lt; 0) <span class="keywordflow">return</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#ad2bd509f9f7037d1462f8cc0e9739a87">ONIGERR_TOO_BIG_NUMBER_FOR_REPEAT_RANGE</a>;
<a name="l02382"></a>02382   <span class="keywordflow">if</span> (low &gt; <a class="code" href="../../d8/db3/oniguruma_8h.html#a290abd89b1c207b93fd39cee4e8593a7">ONIG_MAX_REPEAT_NUM</a>)
<a name="l02383"></a>02383     <span class="keywordflow">return</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#ad2bd509f9f7037d1462f8cc0e9739a87">ONIGERR_TOO_BIG_NUMBER_FOR_REPEAT_RANGE</a>;
<a name="l02384"></a>02384 
<a name="l02385"></a>02385   <span class="keywordflow">if</span> (p == *src) { <span class="comment">/* can&apos;t read low */</span>
<a name="l02386"></a>02386     <span class="keywordflow">if</span> (<a class="code" href="../../d1/dfc/regparse_8h.html#a18bfc9ee154d6dd516347bd71b4810f6">IS_SYNTAX_BV</a>(env-&gt;<a class="code" href="../../d6/dbe/struct_scan_env.html#ae5c4502ad7b7a4a418eda464919d2bda">syntax</a>, <a class="code" href="../../d8/db3/oniguruma_8h.html#a5fd0eebb7d7d24b95945128a0c007f4f">ONIG_SYN_ALLOW_INTERVAL_LOW_ABBREV</a>)) {
<a name="l02387"></a>02387       <span class="comment">/* allow {,n} as {0,n} */</span>
<a name="l02388"></a>02388       low = 0;
<a name="l02389"></a>02389       non_low = 1;
<a name="l02390"></a>02390     }
<a name="l02391"></a>02391     <span class="keywordflow">else</span>
<a name="l02392"></a>02392       <span class="keywordflow">goto</span> invalid;
<a name="l02393"></a>02393   }
<a name="l02394"></a>02394 
<a name="l02395"></a>02395   <span class="keywordflow">if</span> (<a class="code" href="../../d6/dda/regparse_8c.html#a43ce1d83d1961694adc2dfcbfac7d690">PEND</a>) <span class="keywordflow">goto</span> invalid;
<a name="l02396"></a>02396   <a class="code" href="../../d6/dda/regparse_8c.html#a8a8898c873b81a88454a968371696cab">PFETCH</a>(c);
<a name="l02397"></a>02397   <span class="keywordflow">if</span> (c == <span class="charliteral">&apos;,&apos;</span>) {
<a name="l02398"></a>02398     <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>* <a class="code" href="../../d7/dc0/parse_8y.html#a71f8b6ffdc0cc58ffd989c3162fb2bcf">prev</a> = p;
<a name="l02399"></a>02399     up = <a class="code" href="../../d6/dda/regparse_8c.html#af172b663db06124c2c4b62a7e1377472">onig_scan_unsigned_number</a>(&amp;p, end, env-&gt;<a class="code" href="../../d6/dbe/struct_scan_env.html#a97f766db4ac9dabc9d173bf99fbcc11b">enc</a>);
<a name="l02400"></a>02400     <span class="keywordflow">if</span> (up &lt; 0) <span class="keywordflow">return</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#ad2bd509f9f7037d1462f8cc0e9739a87">ONIGERR_TOO_BIG_NUMBER_FOR_REPEAT_RANGE</a>;
<a name="l02401"></a>02401     <span class="keywordflow">if</span> (up &gt; <a class="code" href="../../d8/db3/oniguruma_8h.html#a290abd89b1c207b93fd39cee4e8593a7">ONIG_MAX_REPEAT_NUM</a>)
<a name="l02402"></a>02402       <span class="keywordflow">return</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#ad2bd509f9f7037d1462f8cc0e9739a87">ONIGERR_TOO_BIG_NUMBER_FOR_REPEAT_RANGE</a>;
<a name="l02403"></a>02403 
<a name="l02404"></a>02404     <span class="keywordflow">if</span> (p == prev) {
<a name="l02405"></a>02405       <span class="keywordflow">if</span> (non_low != 0)
<a name="l02406"></a>02406         <span class="keywordflow">goto</span> invalid;
<a name="l02407"></a>02407       up = <a class="code" href="../../d6/d87/regint_8h.html#aaaf8d5e1b9d204ddb0b681077890b01f">REPEAT_INFINITE</a>;  <span class="comment">/* {n,} : {n,infinite} */</span>
<a name="l02408"></a>02408     }
<a name="l02409"></a>02409   }
<a name="l02410"></a>02410   <span class="keywordflow">else</span> {
<a name="l02411"></a>02411     <span class="keywordflow">if</span> (non_low != 0)
<a name="l02412"></a>02412       <span class="keywordflow">goto</span> invalid;
<a name="l02413"></a>02413 
<a name="l02414"></a>02414     <a class="code" href="../../d6/dda/regparse_8c.html#ad0350add3c44d502c77357f6012b1bf2">PUNFETCH</a>;
<a name="l02415"></a>02415     up = low;  <span class="comment">/* {n} : exact n times */</span>
<a name="l02416"></a>02416     r = 2;     <span class="comment">/* fixed */</span>
<a name="l02417"></a>02417   }
<a name="l02418"></a>02418 
<a name="l02419"></a>02419   <span class="keywordflow">if</span> (<a class="code" href="../../d6/dda/regparse_8c.html#a43ce1d83d1961694adc2dfcbfac7d690">PEND</a>) <span class="keywordflow">goto</span> invalid;
<a name="l02420"></a>02420   <a class="code" href="../../d6/dda/regparse_8c.html#a8a8898c873b81a88454a968371696cab">PFETCH</a>(c);
<a name="l02421"></a>02421   <span class="keywordflow">if</span> (<a class="code" href="../../d1/dfc/regparse_8h.html#aeeb7aa0f60553ade62b7338e8f21256b">IS_SYNTAX_OP</a>(env-&gt;<a class="code" href="../../d6/dbe/struct_scan_env.html#ae5c4502ad7b7a4a418eda464919d2bda">syntax</a>, <a class="code" href="../../d8/db3/oniguruma_8h.html#a306fbba82db69fd6d8d53c8d048611e8">ONIG_SYN_OP_ESC_BRACE_INTERVAL</a>)) {
<a name="l02422"></a>02422     <span class="keywordflow">if</span> (c != <a class="code" href="../../d6/d87/regint_8h.html#ae4a605f4b8bee0d69ab6d6418ddbec1b">MC_ESC</a>(env-&gt;<a class="code" href="../../d6/dbe/struct_scan_env.html#ae5c4502ad7b7a4a418eda464919d2bda">syntax</a>)) <span class="keywordflow">goto</span> invalid;
<a name="l02423"></a>02423     <a class="code" href="../../d6/dda/regparse_8c.html#a8a8898c873b81a88454a968371696cab">PFETCH</a>(c);
<a name="l02424"></a>02424   }
<a name="l02425"></a>02425   <span class="keywordflow">if</span> (c != <span class="charliteral">&apos;}&apos;</span>) <span class="keywordflow">goto</span> invalid;
<a name="l02426"></a>02426 
<a name="l02427"></a>02427   <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d87/regint_8h.html#a7b7f11d4b2705496b7711598403d4f72">IS_REPEAT_INFINITE</a>(up) &amp;&amp; low &gt; up) {
<a name="l02428"></a>02428     <span class="keywordflow">return</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#a775195002190ef8373cbe7a6874f7f3a">ONIGERR_UPPER_SMALLER_THAN_LOWER_IN_REPEAT_RANGE</a>;
<a name="l02429"></a>02429   }
<a name="l02430"></a>02430 
<a name="l02431"></a>02431   tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#a46f3343f204ac67de13f0a774284e476">type</a> = <a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250da6d79c0cbba40a10a9d6790b9b874c833">TK_INTERVAL</a>;
<a name="l02432"></a>02432   tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#aaea3a0bd5a46ef32e4a9552046a070b3">u</a>.<a class="code" href="../../d0/d80/struct_onig_token.html#a7ff69fe23d1d3da2bfd163c760ef4e44">repeat</a>.lower = low;
<a name="l02433"></a>02433   tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#aaea3a0bd5a46ef32e4a9552046a070b3">u</a>.<a class="code" href="../../d0/d80/struct_onig_token.html#a7ff69fe23d1d3da2bfd163c760ef4e44">repeat</a>.upper = up;
<a name="l02434"></a>02434   *src = p;
<a name="l02435"></a>02435   <span class="keywordflow">return</span> r; <span class="comment">/* 0: normal {n,m}, 2: fixed {n} */</span>
<a name="l02436"></a>02436 
<a name="l02437"></a>02437  invalid:
<a name="l02438"></a>02438   <span class="keywordflow">if</span> (syn_allow)
<a name="l02439"></a>02439     <span class="keywordflow">return</span> 1;  <span class="comment">/* OK */</span>
<a name="l02440"></a>02440   <span class="keywordflow">else</span>
<a name="l02441"></a>02441     <span class="keywordflow">return</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#ae5bc9d7bc2ab7fb66bf370d510d2b7ab">ONIGERR_INVALID_REPEAT_RANGE_PATTERN</a>;
<a name="l02442"></a>02442 }
<a name="l02443"></a>02443 
<a name="l02444"></a>02444 <span class="comment">/* \M-, \C-, \c, or \... */</span>
<a name="l02445"></a>02445 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l02446"></a><a class="code" href="../../d6/dda/regparse_8c.html#ac3534284c668aefff9f97ffd5d759522">02446</a> <a class="code" href="../../d6/dda/regparse_8c.html#ac3534284c668aefff9f97ffd5d759522">fetch_escaped_value</a>(<a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>** src, <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>* end, <a class="code" href="../../d6/dbe/struct_scan_env.html">ScanEnv</a>* env)
<a name="l02447"></a>02447 {
<a name="l02448"></a>02448   <span class="keywordtype">int</span> v;
<a name="l02449"></a>02449   <a class="code" href="../../d8/db3/oniguruma_8h.html#a7c8a84bc12127007886efbfcf53b6fb5">OnigCodePoint</a> c;
<a name="l02450"></a>02450   <a class="code" href="../../d1/d7b/struct_onig_encoding_type_s_t.html">OnigEncoding</a> enc = env-&gt;<a class="code" href="../../d6/dbe/struct_scan_env.html#a97f766db4ac9dabc9d173bf99fbcc11b">enc</a>;
<a name="l02451"></a>02451   <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>* p = *src;
<a name="l02452"></a>02452   <a class="code" href="../../d6/dda/regparse_8c.html#a44975cffe07e4559bf5638cafb4a6b30">PFETCH_READY</a>;
<a name="l02453"></a>02453 
<a name="l02454"></a>02454   <span class="keywordflow">if</span> (<a class="code" href="../../d6/dda/regparse_8c.html#a43ce1d83d1961694adc2dfcbfac7d690">PEND</a>) <span class="keywordflow">return</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#a50a1adafbee790867a48752a1093444b">ONIGERR_END_PATTERN_AT_ESCAPE</a>;
<a name="l02455"></a>02455 
<a name="l02456"></a>02456   <a class="code" href="../../d6/dda/regparse_8c.html#a8a8898c873b81a88454a968371696cab">PFETCH</a>(c);
<a name="l02457"></a>02457   <span class="keywordflow">switch</span> (c) {
<a name="l02458"></a>02458   <span class="keywordflow">case</span> <span class="charliteral">&apos;M&apos;</span>:
<a name="l02459"></a>02459     <span class="keywordflow">if</span> (<a class="code" href="../../d1/dfc/regparse_8h.html#a2ff963239e972932cefd5adaae161e76">IS_SYNTAX_OP2</a>(env-&gt;<a class="code" href="../../d6/dbe/struct_scan_env.html#ae5c4502ad7b7a4a418eda464919d2bda">syntax</a>, <a class="code" href="../../d8/db3/oniguruma_8h.html#af4f3ea1b37fdb1b91c592744edae4be8">ONIG_SYN_OP2_ESC_CAPITAL_M_BAR_META</a>)) {
<a name="l02460"></a>02460       <span class="keywordflow">if</span> (<a class="code" href="../../d6/dda/regparse_8c.html#a43ce1d83d1961694adc2dfcbfac7d690">PEND</a>) <span class="keywordflow">return</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#a08f8f67dae38dd27868fd802ff05686f">ONIGERR_END_PATTERN_AT_META</a>;
<a name="l02461"></a>02461       <a class="code" href="../../d6/dda/regparse_8c.html#a8a8898c873b81a88454a968371696cab">PFETCH</a>(c);
<a name="l02462"></a>02462       <span class="keywordflow">if</span> (c != <span class="charliteral">&apos;-&apos;</span>) <span class="keywordflow">return</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#a3c9f41c17ba0f668f4aa582bbacee569">ONIGERR_META_CODE_SYNTAX</a>;
<a name="l02463"></a>02463       <span class="keywordflow">if</span> (<a class="code" href="../../d6/dda/regparse_8c.html#a43ce1d83d1961694adc2dfcbfac7d690">PEND</a>) <span class="keywordflow">return</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#a08f8f67dae38dd27868fd802ff05686f">ONIGERR_END_PATTERN_AT_META</a>;
<a name="l02464"></a>02464       <a class="code" href="../../d6/dda/regparse_8c.html#a8a8898c873b81a88454a968371696cab">PFETCH</a>(c);
<a name="l02465"></a>02465       <span class="keywordflow">if</span> (c == <a class="code" href="../../d6/d87/regint_8h.html#ae4a605f4b8bee0d69ab6d6418ddbec1b">MC_ESC</a>(env-&gt;<a class="code" href="../../d6/dbe/struct_scan_env.html#ae5c4502ad7b7a4a418eda464919d2bda">syntax</a>)) {
<a name="l02466"></a>02466         v = <a class="code" href="../../d6/dda/regparse_8c.html#ac3534284c668aefff9f97ffd5d759522">fetch_escaped_value</a>(&amp;p, end, env);
<a name="l02467"></a>02467         <span class="keywordflow">if</span> (v &lt; 0) <span class="keywordflow">return</span> v;
<a name="l02468"></a>02468         c = (<a class="code" href="../../d8/db3/oniguruma_8h.html#a7c8a84bc12127007886efbfcf53b6fb5">OnigCodePoint</a> )v;
<a name="l02469"></a>02469       }
<a name="l02470"></a>02470       c = ((c &amp; 0xff) | 0x80);
<a name="l02471"></a>02471     }
<a name="l02472"></a>02472     <span class="keywordflow">else</span>
<a name="l02473"></a>02473       <span class="keywordflow">goto</span> backslash;
<a name="l02474"></a>02474     <span class="keywordflow">break</span>;
<a name="l02475"></a>02475 
<a name="l02476"></a>02476   <span class="keywordflow">case</span> <span class="charliteral">&apos;C&apos;</span>:
<a name="l02477"></a>02477     <span class="keywordflow">if</span> (<a class="code" href="../../d1/dfc/regparse_8h.html#a2ff963239e972932cefd5adaae161e76">IS_SYNTAX_OP2</a>(env-&gt;<a class="code" href="../../d6/dbe/struct_scan_env.html#ae5c4502ad7b7a4a418eda464919d2bda">syntax</a>, <a class="code" href="../../d8/db3/oniguruma_8h.html#af255376b1d9217b200bc22f82aa7eae3">ONIG_SYN_OP2_ESC_CAPITAL_C_BAR_CONTROL</a>)) {
<a name="l02478"></a>02478       <span class="keywordflow">if</span> (<a class="code" href="../../d6/dda/regparse_8c.html#a43ce1d83d1961694adc2dfcbfac7d690">PEND</a>) <span class="keywordflow">return</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#a65e985bb52c7a596171e4b6ae0fb9610">ONIGERR_END_PATTERN_AT_CONTROL</a>;
<a name="l02479"></a>02479       <a class="code" href="../../d6/dda/regparse_8c.html#a8a8898c873b81a88454a968371696cab">PFETCH</a>(c);
<a name="l02480"></a>02480       <span class="keywordflow">if</span> (c != <span class="charliteral">&apos;-&apos;</span>) <span class="keywordflow">return</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#af77c917e1329816c5d85eb342954f874">ONIGERR_CONTROL_CODE_SYNTAX</a>;
<a name="l02481"></a>02481       <span class="keywordflow">goto</span> control;
<a name="l02482"></a>02482     }
<a name="l02483"></a>02483     <span class="keywordflow">else</span>
<a name="l02484"></a>02484       <span class="keywordflow">goto</span> backslash;
<a name="l02485"></a>02485 
<a name="l02486"></a>02486   <span class="keywordflow">case</span> <span class="charliteral">&apos;c&apos;</span>:
<a name="l02487"></a>02487     <span class="keywordflow">if</span> (<a class="code" href="../../d1/dfc/regparse_8h.html#aeeb7aa0f60553ade62b7338e8f21256b">IS_SYNTAX_OP</a>(env-&gt;<a class="code" href="../../d6/dbe/struct_scan_env.html#ae5c4502ad7b7a4a418eda464919d2bda">syntax</a>, <a class="code" href="../../d8/db3/oniguruma_8h.html#a00c37ae334ac9f7a717515cd6028372c">ONIG_SYN_OP_ESC_C_CONTROL</a>)) {
<a name="l02488"></a>02488     control:
<a name="l02489"></a>02489       <span class="keywordflow">if</span> (<a class="code" href="../../d6/dda/regparse_8c.html#a43ce1d83d1961694adc2dfcbfac7d690">PEND</a>) <span class="keywordflow">return</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#a65e985bb52c7a596171e4b6ae0fb9610">ONIGERR_END_PATTERN_AT_CONTROL</a>;
<a name="l02490"></a>02490       <a class="code" href="../../d6/dda/regparse_8c.html#a8a8898c873b81a88454a968371696cab">PFETCH</a>(c);
<a name="l02491"></a>02491       <span class="keywordflow">if</span> (c == <span class="charliteral">&apos;?&apos;</span>) {
<a name="l02492"></a>02492         c = 0177;
<a name="l02493"></a>02493       }
<a name="l02494"></a>02494       <span class="keywordflow">else</span> {
<a name="l02495"></a>02495         <span class="keywordflow">if</span> (c == <a class="code" href="../../d6/d87/regint_8h.html#ae4a605f4b8bee0d69ab6d6418ddbec1b">MC_ESC</a>(env-&gt;<a class="code" href="../../d6/dbe/struct_scan_env.html#ae5c4502ad7b7a4a418eda464919d2bda">syntax</a>)) {
<a name="l02496"></a>02496           v = <a class="code" href="../../d6/dda/regparse_8c.html#ac3534284c668aefff9f97ffd5d759522">fetch_escaped_value</a>(&amp;p, end, env);
<a name="l02497"></a>02497           <span class="keywordflow">if</span> (v &lt; 0) <span class="keywordflow">return</span> v;
<a name="l02498"></a>02498           c = (<a class="code" href="../../d8/db3/oniguruma_8h.html#a7c8a84bc12127007886efbfcf53b6fb5">OnigCodePoint</a> )v;
<a name="l02499"></a>02499         }
<a name="l02500"></a>02500         c &amp;= 0x9f;
<a name="l02501"></a>02501       }
<a name="l02502"></a>02502       <span class="keywordflow">break</span>;
<a name="l02503"></a>02503     }
<a name="l02504"></a>02504     <span class="comment">/* fall through */</span>
<a name="l02505"></a>02505 
<a name="l02506"></a>02506   <span class="keywordflow">default</span>:
<a name="l02507"></a>02507     {
<a name="l02508"></a>02508     backslash:
<a name="l02509"></a>02509       c = <a class="code" href="../../d6/dda/regparse_8c.html#a8b55f92f3133c69d4a7a6bf87aa41138">conv_backslash_value</a>(c, env);
<a name="l02510"></a>02510     }
<a name="l02511"></a>02511     <span class="keywordflow">break</span>;
<a name="l02512"></a>02512   }
<a name="l02513"></a>02513 
<a name="l02514"></a>02514   *src = p;
<a name="l02515"></a>02515   <span class="keywordflow">return</span> c;
<a name="l02516"></a>02516 }
<a name="l02517"></a>02517 
<a name="l02518"></a>02518 <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d6/dda/regparse_8c.html#af1214620e9e6133cd463d363f2cb332f">fetch_token</a>(<a class="code" href="../../d0/d80/struct_onig_token.html">OnigToken</a>* <a class="code" href="../../d5/d11/ripper_8c.html#a2b3a335d617ec14d6296ca82d3055858">tok</a>, <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>** src, <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>* end, <a class="code" href="../../d6/dbe/struct_scan_env.html">ScanEnv</a>* env);
<a name="l02519"></a>02519 
<a name="l02520"></a>02520 <span class="keyword">static</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#a7c8a84bc12127007886efbfcf53b6fb5">OnigCodePoint</a>
<a name="l02521"></a><a class="code" href="../../d6/dda/regparse_8c.html#af6e87bfb65c5e89ad600a2e650ca9187">02521</a> <a class="code" href="../../d6/dda/regparse_8c.html#af6e87bfb65c5e89ad600a2e650ca9187">get_name_end_code_point</a>(<a class="code" href="../../d8/db3/oniguruma_8h.html#a7c8a84bc12127007886efbfcf53b6fb5">OnigCodePoint</a> start)
<a name="l02522"></a>02522 {
<a name="l02523"></a>02523   <span class="keywordflow">switch</span> (start) {
<a name="l02524"></a>02524   <span class="keywordflow">case</span> <span class="charliteral">&apos;&lt;&apos;</span>:  <span class="keywordflow">return</span> (<a class="code" href="../../d8/db3/oniguruma_8h.html#a7c8a84bc12127007886efbfcf53b6fb5">OnigCodePoint</a> )<span class="charliteral">&apos;&gt;&apos;</span>; <span class="keywordflow">break</span>;
<a name="l02525"></a>02525   <span class="keywordflow">case</span> <span class="charliteral">&apos;\&apos;&apos;</span>: <span class="keywordflow">return</span> (<a class="code" href="../../d8/db3/oniguruma_8h.html#a7c8a84bc12127007886efbfcf53b6fb5">OnigCodePoint</a> )<span class="charliteral">&apos;\&apos;&apos;</span>; <span class="keywordflow">break</span>;
<a name="l02526"></a>02526   <span class="keywordflow">default</span>:
<a name="l02527"></a>02527     <span class="keywordflow">break</span>;
<a name="l02528"></a>02528   }
<a name="l02529"></a>02529 
<a name="l02530"></a>02530   <span class="keywordflow">return</span> (<a class="code" href="../../d8/db3/oniguruma_8h.html#a7c8a84bc12127007886efbfcf53b6fb5">OnigCodePoint</a> )0;
<a name="l02531"></a>02531 }
<a name="l02532"></a>02532 
<a name="l02533"></a>02533 <span class="preprocessor">#ifdef USE_NAMED_GROUP</span>
<a name="l02534"></a>02534 <span class="preprocessor"></span><span class="preprocessor">#ifdef USE_BACKREF_WITH_LEVEL</span>
<a name="l02535"></a>02535 <span class="preprocessor"></span><span class="comment">/*</span>
<a name="l02536"></a>02536 <span class="comment">   \k&lt;name+n&gt;, \k&lt;name-n&gt;</span>
<a name="l02537"></a>02537 <span class="comment">   \k&lt;num+n&gt;,  \k&lt;num-n&gt;</span>
<a name="l02538"></a>02538 <span class="comment">   \k&lt;-num+n&gt;, \k&lt;-num-n&gt;</span>
<a name="l02539"></a>02539 <span class="comment">*/</span>
<a name="l02540"></a>02540 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l02541"></a><a class="code" href="../../d6/dda/regparse_8c.html#a3a36842de2c36440fad19828c88c32ed">02541</a> <a class="code" href="../../d6/dda/regparse_8c.html#a3a36842de2c36440fad19828c88c32ed">fetch_name_with_level</a>(<a class="code" href="../../d8/db3/oniguruma_8h.html#a7c8a84bc12127007886efbfcf53b6fb5">OnigCodePoint</a> start_code, <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>** src, <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>* end,
<a name="l02542"></a>02542                       <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>** rname_end, <a class="code" href="../../d6/dbe/struct_scan_env.html">ScanEnv</a>* env,
<a name="l02543"></a>02543                       <span class="keywordtype">int</span>* rback_num, <span class="keywordtype">int</span>* rlevel)
<a name="l02544"></a>02544 {
<a name="l02545"></a>02545   <span class="keywordtype">int</span> r, sign, is_num, exist_level;
<a name="l02546"></a>02546   <a class="code" href="../../d8/db3/oniguruma_8h.html#a7c8a84bc12127007886efbfcf53b6fb5">OnigCodePoint</a> end_code;
<a name="l02547"></a>02547   <a class="code" href="../../d8/db3/oniguruma_8h.html#a7c8a84bc12127007886efbfcf53b6fb5">OnigCodePoint</a> c = 0;
<a name="l02548"></a>02548   <a class="code" href="../../d1/d7b/struct_onig_encoding_type_s_t.html">OnigEncoding</a> enc = env-&gt;<a class="code" href="../../d6/dbe/struct_scan_env.html#a97f766db4ac9dabc9d173bf99fbcc11b">enc</a>;
<a name="l02549"></a>02549   <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a> *name_end;
<a name="l02550"></a>02550   <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a> *pnum_head;
<a name="l02551"></a>02551   <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a> *p = *src;
<a name="l02552"></a>02552   <a class="code" href="../../d6/dda/regparse_8c.html#a44975cffe07e4559bf5638cafb4a6b30">PFETCH_READY</a>;
<a name="l02553"></a>02553 
<a name="l02554"></a>02554   *rback_num = 0;
<a name="l02555"></a>02555   is_num = exist_level = 0;
<a name="l02556"></a>02556   sign = 1;
<a name="l02557"></a>02557   pnum_head = *src;
<a name="l02558"></a>02558 
<a name="l02559"></a>02559   end_code = <a class="code" href="../../d6/dda/regparse_8c.html#af6e87bfb65c5e89ad600a2e650ca9187">get_name_end_code_point</a>(start_code);
<a name="l02560"></a>02560 
<a name="l02561"></a>02561   name_end = end;
<a name="l02562"></a>02562   r = 0;
<a name="l02563"></a>02563   <span class="keywordflow">if</span> (<a class="code" href="../../d6/dda/regparse_8c.html#a43ce1d83d1961694adc2dfcbfac7d690">PEND</a>) {
<a name="l02564"></a>02564     <span class="keywordflow">return</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#a9d9a35ebc32ac51053edc7ab0b149ac7">ONIGERR_EMPTY_GROUP_NAME</a>;
<a name="l02565"></a>02565   }
<a name="l02566"></a>02566   <span class="keywordflow">else</span> {
<a name="l02567"></a>02567     <a class="code" href="../../d6/dda/regparse_8c.html#a8a8898c873b81a88454a968371696cab">PFETCH</a>(c);
<a name="l02568"></a>02568     <span class="keywordflow">if</span> (c == end_code)
<a name="l02569"></a>02569       <span class="keywordflow">return</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#a9d9a35ebc32ac51053edc7ab0b149ac7">ONIGERR_EMPTY_GROUP_NAME</a>;
<a name="l02570"></a>02570 
<a name="l02571"></a>02571     <span class="keywordflow">if</span> (<a class="code" href="../../d8/db3/oniguruma_8h.html#a5ce23077f30d0af86e623ee1e0838a2e">ONIGENC_IS_CODE_DIGIT</a>(enc, c)) {
<a name="l02572"></a>02572       is_num = 1;
<a name="l02573"></a>02573     }
<a name="l02574"></a>02574     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (c == <span class="charliteral">&apos;-&apos;</span>) {
<a name="l02575"></a>02575       is_num = 2;
<a name="l02576"></a>02576       sign = -1;
<a name="l02577"></a>02577       pnum_head = p;
<a name="l02578"></a>02578     }
<a name="l02579"></a>02579     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!<a class="code" href="../../d8/db3/oniguruma_8h.html#a7b44f6afd4815b806827f9440be9e6b6">ONIGENC_IS_CODE_WORD</a>(enc, c)) {
<a name="l02580"></a>02580       r = <a class="code" href="../../d8/db3/oniguruma_8h.html#afdcd4007200d9b14ff8c93a9b3ed8cf6">ONIGERR_INVALID_CHAR_IN_GROUP_NAME</a>;
<a name="l02581"></a>02581     }
<a name="l02582"></a>02582   }
<a name="l02583"></a>02583 
<a name="l02584"></a>02584   <span class="keywordflow">while</span> (!<a class="code" href="../../d6/dda/regparse_8c.html#a43ce1d83d1961694adc2dfcbfac7d690">PEND</a>) {
<a name="l02585"></a>02585     name_end = p;
<a name="l02586"></a>02586     <a class="code" href="../../d6/dda/regparse_8c.html#a8a8898c873b81a88454a968371696cab">PFETCH</a>(c);
<a name="l02587"></a>02587     <span class="keywordflow">if</span> (c == end_code || c == <span class="charliteral">&apos;)&apos;</span> || c == <span class="charliteral">&apos;+&apos;</span> || c == <span class="charliteral">&apos;-&apos;</span>) {
<a name="l02588"></a>02588       <span class="keywordflow">if</span> (is_num == 2)  r = <a class="code" href="../../d8/db3/oniguruma_8h.html#a5a3fb0424ebe642d6209e3d2dc2e2ae8">ONIGERR_INVALID_GROUP_NAME</a>;
<a name="l02589"></a>02589       <span class="keywordflow">break</span>;
<a name="l02590"></a>02590     }
<a name="l02591"></a>02591 
<a name="l02592"></a>02592     <span class="keywordflow">if</span> (is_num != 0) {
<a name="l02593"></a>02593       <span class="keywordflow">if</span> (<a class="code" href="../../d8/db3/oniguruma_8h.html#a5ce23077f30d0af86e623ee1e0838a2e">ONIGENC_IS_CODE_DIGIT</a>(enc, c)) {
<a name="l02594"></a>02594         is_num = 1;
<a name="l02595"></a>02595       }
<a name="l02596"></a>02596       <span class="keywordflow">else</span> {
<a name="l02597"></a>02597         r = <a class="code" href="../../d8/db3/oniguruma_8h.html#a5a3fb0424ebe642d6209e3d2dc2e2ae8">ONIGERR_INVALID_GROUP_NAME</a>;
<a name="l02598"></a>02598         is_num = 0;
<a name="l02599"></a>02599       }
<a name="l02600"></a>02600     }
<a name="l02601"></a>02601     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!<a class="code" href="../../d8/db3/oniguruma_8h.html#a7b44f6afd4815b806827f9440be9e6b6">ONIGENC_IS_CODE_WORD</a>(enc, c)) {
<a name="l02602"></a>02602       r = <a class="code" href="../../d8/db3/oniguruma_8h.html#afdcd4007200d9b14ff8c93a9b3ed8cf6">ONIGERR_INVALID_CHAR_IN_GROUP_NAME</a>;
<a name="l02603"></a>02603     }
<a name="l02604"></a>02604   }
<a name="l02605"></a>02605 
<a name="l02606"></a>02606   <span class="keywordflow">if</span> (r == 0 &amp;&amp; c != end_code) {
<a name="l02607"></a>02607     <span class="keywordflow">if</span> (c == <span class="charliteral">&apos;+&apos;</span> || c == <span class="charliteral">&apos;-&apos;</span>) {
<a name="l02608"></a>02608       <span class="keywordtype">int</span> level;
<a name="l02609"></a>02609       <span class="keywordtype">int</span> flag = (c == <span class="charliteral">&apos;-&apos;</span> ? -1 : 1);
<a name="l02610"></a>02610 
<a name="l02611"></a>02611       <a class="code" href="../../d6/dda/regparse_8c.html#a8a8898c873b81a88454a968371696cab">PFETCH</a>(c);
<a name="l02612"></a>02612       <span class="keywordflow">if</span> (! <a class="code" href="../../d8/db3/oniguruma_8h.html#a5ce23077f30d0af86e623ee1e0838a2e">ONIGENC_IS_CODE_DIGIT</a>(enc, c)) <span class="keywordflow">goto</span> <a class="code" href="../../d5/df2/win32_8c.html#a6ce68847c12434f60d1b2654a3dc3409">err</a>;
<a name="l02613"></a>02613       <a class="code" href="../../d6/dda/regparse_8c.html#ad0350add3c44d502c77357f6012b1bf2">PUNFETCH</a>;
<a name="l02614"></a>02614       level = <a class="code" href="../../d6/dda/regparse_8c.html#af172b663db06124c2c4b62a7e1377472">onig_scan_unsigned_number</a>(&amp;p, end, enc);
<a name="l02615"></a>02615       <span class="keywordflow">if</span> (level &lt; 0) <span class="keywordflow">return</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#af6769c109e3a039fa74338b01c389c94">ONIGERR_TOO_BIG_NUMBER</a>;
<a name="l02616"></a>02616       *rlevel = (level * flag);
<a name="l02617"></a>02617       exist_level = 1;
<a name="l02618"></a>02618 
<a name="l02619"></a>02619       <a class="code" href="../../d6/dda/regparse_8c.html#a8a8898c873b81a88454a968371696cab">PFETCH</a>(c);
<a name="l02620"></a>02620       <span class="keywordflow">if</span> (c == end_code)
<a name="l02621"></a>02621         <span class="keywordflow">goto</span> end;
<a name="l02622"></a>02622     }
<a name="l02623"></a>02623 
<a name="l02624"></a>02624   <a class="code" href="../../d5/df2/win32_8c.html#a6ce68847c12434f60d1b2654a3dc3409">err</a>:
<a name="l02625"></a>02625     r = <a class="code" href="../../d8/db3/oniguruma_8h.html#a5a3fb0424ebe642d6209e3d2dc2e2ae8">ONIGERR_INVALID_GROUP_NAME</a>;
<a name="l02626"></a>02626     name_end = end;
<a name="l02627"></a>02627   }
<a name="l02628"></a>02628 
<a name="l02629"></a>02629  end:
<a name="l02630"></a>02630   <span class="keywordflow">if</span> (r == 0) {
<a name="l02631"></a>02631     <span class="keywordflow">if</span> (is_num != 0) {
<a name="l02632"></a>02632       *rback_num = <a class="code" href="../../d6/dda/regparse_8c.html#af172b663db06124c2c4b62a7e1377472">onig_scan_unsigned_number</a>(&amp;pnum_head, name_end, enc);
<a name="l02633"></a>02633       <span class="keywordflow">if</span> (*rback_num &lt; 0) <span class="keywordflow">return</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#af6769c109e3a039fa74338b01c389c94">ONIGERR_TOO_BIG_NUMBER</a>;
<a name="l02634"></a>02634       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (*rback_num == 0) <span class="keywordflow">goto</span> <a class="code" href="../../d5/df2/win32_8c.html#a6ce68847c12434f60d1b2654a3dc3409">err</a>;
<a name="l02635"></a>02635 
<a name="l02636"></a>02636       *rback_num *= sign;
<a name="l02637"></a>02637     }
<a name="l02638"></a>02638 
<a name="l02639"></a>02639     *rname_end = name_end;
<a name="l02640"></a>02640     *src = p;
<a name="l02641"></a>02641     <span class="keywordflow">return</span> (exist_level ? 1 : 0);
<a name="l02642"></a>02642   }
<a name="l02643"></a>02643   <span class="keywordflow">else</span> {
<a name="l02644"></a>02644     <a class="code" href="../../d6/dda/regparse_8c.html#a8d6d95d9c113545baa16fe1ff3d96191">onig_scan_env_set_error_string</a>(env, r, *src, name_end);
<a name="l02645"></a>02645     <span class="keywordflow">return</span> r;
<a name="l02646"></a>02646   }
<a name="l02647"></a>02647 }
<a name="l02648"></a>02648 <span class="preprocessor">#endif </span><span class="comment">/* USE_BACKREF_WITH_LEVEL */</span>
<a name="l02649"></a>02649 
<a name="l02650"></a>02650 <span class="comment">/*</span>
<a name="l02651"></a>02651 <span class="comment">  def: 0 -&gt; define name    (don&apos;t allow number name)</span>
<a name="l02652"></a>02652 <span class="comment">       1 -&gt; reference name (allow number name)</span>
<a name="l02653"></a>02653 <span class="comment">*/</span>
<a name="l02654"></a>02654 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l02655"></a><a class="code" href="../../d6/dda/regparse_8c.html#a67cbe5ffbeb09676c26f3c3e4094128c">02655</a> <a class="code" href="../../d6/dda/regparse_8c.html#a67cbe5ffbeb09676c26f3c3e4094128c">fetch_name</a>(<a class="code" href="../../d8/db3/oniguruma_8h.html#a7c8a84bc12127007886efbfcf53b6fb5">OnigCodePoint</a> start_code, <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>** src, <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>* end,
<a name="l02656"></a>02656            <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>** rname_end, <a class="code" href="../../d6/dbe/struct_scan_env.html">ScanEnv</a>* env, <span class="keywordtype">int</span>* rback_num, <span class="keywordtype">int</span> ref)
<a name="l02657"></a>02657 {
<a name="l02658"></a>02658   <span class="keywordtype">int</span> r, is_num, sign;
<a name="l02659"></a>02659   <a class="code" href="../../d8/db3/oniguruma_8h.html#a7c8a84bc12127007886efbfcf53b6fb5">OnigCodePoint</a> end_code;
<a name="l02660"></a>02660   <a class="code" href="../../d8/db3/oniguruma_8h.html#a7c8a84bc12127007886efbfcf53b6fb5">OnigCodePoint</a> c = 0;
<a name="l02661"></a>02661   <a class="code" href="../../d1/d7b/struct_onig_encoding_type_s_t.html">OnigEncoding</a> enc = env-&gt;<a class="code" href="../../d6/dbe/struct_scan_env.html#a97f766db4ac9dabc9d173bf99fbcc11b">enc</a>;
<a name="l02662"></a>02662   <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a> *name_end;
<a name="l02663"></a>02663   <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a> *pnum_head;
<a name="l02664"></a>02664   <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a> *p = *src;
<a name="l02665"></a>02665   <a class="code" href="../../d6/dda/regparse_8c.html#a44975cffe07e4559bf5638cafb4a6b30">PFETCH_READY</a>;
<a name="l02666"></a>02666 
<a name="l02667"></a>02667   *rback_num = 0;
<a name="l02668"></a>02668 
<a name="l02669"></a>02669   end_code = <a class="code" href="../../d6/dda/regparse_8c.html#af6e87bfb65c5e89ad600a2e650ca9187">get_name_end_code_point</a>(start_code);
<a name="l02670"></a>02670 
<a name="l02671"></a>02671   name_end = end;
<a name="l02672"></a>02672   pnum_head = *src;
<a name="l02673"></a>02673   r = 0;
<a name="l02674"></a>02674   is_num = 0;
<a name="l02675"></a>02675   sign = 1;
<a name="l02676"></a>02676   <span class="keywordflow">if</span> (<a class="code" href="../../d6/dda/regparse_8c.html#a43ce1d83d1961694adc2dfcbfac7d690">PEND</a>) {
<a name="l02677"></a>02677     <span class="keywordflow">return</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#a9d9a35ebc32ac51053edc7ab0b149ac7">ONIGERR_EMPTY_GROUP_NAME</a>;
<a name="l02678"></a>02678   }
<a name="l02679"></a>02679   <span class="keywordflow">else</span> {
<a name="l02680"></a>02680     <a class="code" href="../../d6/dda/regparse_8c.html#a8a8898c873b81a88454a968371696cab">PFETCH</a>(c);
<a name="l02681"></a>02681     <span class="keywordflow">if</span> (c == end_code)
<a name="l02682"></a>02682       <span class="keywordflow">return</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#a9d9a35ebc32ac51053edc7ab0b149ac7">ONIGERR_EMPTY_GROUP_NAME</a>;
<a name="l02683"></a>02683 
<a name="l02684"></a>02684     <span class="keywordflow">if</span> (<a class="code" href="../../d8/db3/oniguruma_8h.html#a5ce23077f30d0af86e623ee1e0838a2e">ONIGENC_IS_CODE_DIGIT</a>(enc, c)) {
<a name="l02685"></a>02685       <span class="keywordflow">if</span> (ref == 1)
<a name="l02686"></a>02686         is_num = 1;
<a name="l02687"></a>02687       <span class="keywordflow">else</span> {
<a name="l02688"></a>02688         r = <a class="code" href="../../d8/db3/oniguruma_8h.html#a5a3fb0424ebe642d6209e3d2dc2e2ae8">ONIGERR_INVALID_GROUP_NAME</a>;
<a name="l02689"></a>02689         is_num = 0;
<a name="l02690"></a>02690       }
<a name="l02691"></a>02691     }
<a name="l02692"></a>02692     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (c == <span class="charliteral">&apos;-&apos;</span>) {
<a name="l02693"></a>02693       <span class="keywordflow">if</span> (ref == 1) {
<a name="l02694"></a>02694         is_num = 2;
<a name="l02695"></a>02695         sign = -1;
<a name="l02696"></a>02696         pnum_head = p;
<a name="l02697"></a>02697       }
<a name="l02698"></a>02698       <span class="keywordflow">else</span> {
<a name="l02699"></a>02699         r = <a class="code" href="../../d8/db3/oniguruma_8h.html#a5a3fb0424ebe642d6209e3d2dc2e2ae8">ONIGERR_INVALID_GROUP_NAME</a>;
<a name="l02700"></a>02700         is_num = 0;
<a name="l02701"></a>02701       }
<a name="l02702"></a>02702     }
<a name="l02703"></a>02703     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!<a class="code" href="../../d8/db3/oniguruma_8h.html#a7b44f6afd4815b806827f9440be9e6b6">ONIGENC_IS_CODE_WORD</a>(enc, c)) {
<a name="l02704"></a>02704       r = <a class="code" href="../../d8/db3/oniguruma_8h.html#afdcd4007200d9b14ff8c93a9b3ed8cf6">ONIGERR_INVALID_CHAR_IN_GROUP_NAME</a>;
<a name="l02705"></a>02705     }
<a name="l02706"></a>02706   }
<a name="l02707"></a>02707 
<a name="l02708"></a>02708   <span class="keywordflow">if</span> (r == 0) {
<a name="l02709"></a>02709     <span class="keywordflow">while</span> (!<a class="code" href="../../d6/dda/regparse_8c.html#a43ce1d83d1961694adc2dfcbfac7d690">PEND</a>) {
<a name="l02710"></a>02710       name_end = p;
<a name="l02711"></a>02711       <a class="code" href="../../d6/dda/regparse_8c.html#a8a8898c873b81a88454a968371696cab">PFETCH</a>(c);
<a name="l02712"></a>02712       <span class="keywordflow">if</span> (c == end_code || c == <span class="charliteral">&apos;)&apos;</span>) {
<a name="l02713"></a>02713         <span class="keywordflow">if</span> (is_num == 2)        r = <a class="code" href="../../d8/db3/oniguruma_8h.html#a5a3fb0424ebe642d6209e3d2dc2e2ae8">ONIGERR_INVALID_GROUP_NAME</a>;
<a name="l02714"></a>02714         <span class="keywordflow">break</span>;
<a name="l02715"></a>02715       }
<a name="l02716"></a>02716 
<a name="l02717"></a>02717       <span class="keywordflow">if</span> (is_num != 0) {
<a name="l02718"></a>02718         <span class="keywordflow">if</span> (<a class="code" href="../../d8/db3/oniguruma_8h.html#a5ce23077f30d0af86e623ee1e0838a2e">ONIGENC_IS_CODE_DIGIT</a>(enc, c)) {
<a name="l02719"></a>02719           is_num = 1;
<a name="l02720"></a>02720         }
<a name="l02721"></a>02721         <span class="keywordflow">else</span> {
<a name="l02722"></a>02722           <span class="keywordflow">if</span> (!<a class="code" href="../../d8/db3/oniguruma_8h.html#a7b44f6afd4815b806827f9440be9e6b6">ONIGENC_IS_CODE_WORD</a>(enc, c))
<a name="l02723"></a>02723             r = <a class="code" href="../../d8/db3/oniguruma_8h.html#afdcd4007200d9b14ff8c93a9b3ed8cf6">ONIGERR_INVALID_CHAR_IN_GROUP_NAME</a>;
<a name="l02724"></a>02724           <span class="keywordflow">else</span>
<a name="l02725"></a>02725             r = <a class="code" href="../../d8/db3/oniguruma_8h.html#a5a3fb0424ebe642d6209e3d2dc2e2ae8">ONIGERR_INVALID_GROUP_NAME</a>;
<a name="l02726"></a>02726 
<a name="l02727"></a>02727           is_num = 0;
<a name="l02728"></a>02728         }
<a name="l02729"></a>02729       }
<a name="l02730"></a>02730       <span class="keywordflow">else</span> {
<a name="l02731"></a>02731         <span class="keywordflow">if</span> (!<a class="code" href="../../d8/db3/oniguruma_8h.html#a7b44f6afd4815b806827f9440be9e6b6">ONIGENC_IS_CODE_WORD</a>(enc, c)) {
<a name="l02732"></a>02732           r = <a class="code" href="../../d8/db3/oniguruma_8h.html#afdcd4007200d9b14ff8c93a9b3ed8cf6">ONIGERR_INVALID_CHAR_IN_GROUP_NAME</a>;
<a name="l02733"></a>02733         }
<a name="l02734"></a>02734       }
<a name="l02735"></a>02735     }
<a name="l02736"></a>02736 
<a name="l02737"></a>02737     <span class="keywordflow">if</span> (c != end_code) {
<a name="l02738"></a>02738       r = <a class="code" href="../../d8/db3/oniguruma_8h.html#a5a3fb0424ebe642d6209e3d2dc2e2ae8">ONIGERR_INVALID_GROUP_NAME</a>;
<a name="l02739"></a>02739       name_end = end;
<a name="l02740"></a>02740     }
<a name="l02741"></a>02741 
<a name="l02742"></a>02742     <span class="keywordflow">if</span> (is_num != 0) {
<a name="l02743"></a>02743       *rback_num = <a class="code" href="../../d6/dda/regparse_8c.html#af172b663db06124c2c4b62a7e1377472">onig_scan_unsigned_number</a>(&amp;pnum_head, name_end, enc);
<a name="l02744"></a>02744       <span class="keywordflow">if</span> (*rback_num &lt; 0) <span class="keywordflow">return</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#af6769c109e3a039fa74338b01c389c94">ONIGERR_TOO_BIG_NUMBER</a>;
<a name="l02745"></a>02745       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (*rback_num == 0) {
<a name="l02746"></a>02746         r = <a class="code" href="../../d8/db3/oniguruma_8h.html#a5a3fb0424ebe642d6209e3d2dc2e2ae8">ONIGERR_INVALID_GROUP_NAME</a>;
<a name="l02747"></a>02747         <span class="keywordflow">goto</span> <a class="code" href="../../d5/df2/win32_8c.html#a6ce68847c12434f60d1b2654a3dc3409">err</a>;
<a name="l02748"></a>02748       }
<a name="l02749"></a>02749 
<a name="l02750"></a>02750       *rback_num *= sign;
<a name="l02751"></a>02751     }
<a name="l02752"></a>02752 
<a name="l02753"></a>02753     *rname_end = name_end;
<a name="l02754"></a>02754     *src = p;
<a name="l02755"></a>02755     <span class="keywordflow">return</span> 0;
<a name="l02756"></a>02756   }
<a name="l02757"></a>02757   <span class="keywordflow">else</span> {
<a name="l02758"></a>02758     <span class="keywordflow">while</span> (!<a class="code" href="../../d6/dda/regparse_8c.html#a43ce1d83d1961694adc2dfcbfac7d690">PEND</a>) {
<a name="l02759"></a>02759       name_end = p;
<a name="l02760"></a>02760       <a class="code" href="../../d6/dda/regparse_8c.html#a8a8898c873b81a88454a968371696cab">PFETCH</a>(c);
<a name="l02761"></a>02761       <span class="keywordflow">if</span> (c == end_code || c == <span class="charliteral">&apos;)&apos;</span>)
<a name="l02762"></a>02762         <span class="keywordflow">break</span>;
<a name="l02763"></a>02763     }
<a name="l02764"></a>02764     <span class="keywordflow">if</span> (<a class="code" href="../../d6/dda/regparse_8c.html#a43ce1d83d1961694adc2dfcbfac7d690">PEND</a>)
<a name="l02765"></a>02765       name_end = end;
<a name="l02766"></a>02766 
<a name="l02767"></a>02767   <a class="code" href="../../d5/df2/win32_8c.html#a6ce68847c12434f60d1b2654a3dc3409">err</a>:
<a name="l02768"></a>02768     <a class="code" href="../../d6/dda/regparse_8c.html#a8d6d95d9c113545baa16fe1ff3d96191">onig_scan_env_set_error_string</a>(env, r, *src, name_end);
<a name="l02769"></a>02769     <span class="keywordflow">return</span> r;
<a name="l02770"></a>02770   }
<a name="l02771"></a>02771 }
<a name="l02772"></a>02772 <span class="preprocessor">#else</span>
<a name="l02773"></a>02773 <span class="preprocessor"></span><span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l02774"></a>02774 <a class="code" href="../../d6/dda/regparse_8c.html#a67cbe5ffbeb09676c26f3c3e4094128c">fetch_name</a>(<a class="code" href="../../d8/db3/oniguruma_8h.html#a7c8a84bc12127007886efbfcf53b6fb5">OnigCodePoint</a> start_code, <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>** src, <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>* end,
<a name="l02775"></a>02775            <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>** rname_end, <a class="code" href="../../d6/dbe/struct_scan_env.html">ScanEnv</a>* env, <span class="keywordtype">int</span>* rback_num, <span class="keywordtype">int</span> ref)
<a name="l02776"></a>02776 {
<a name="l02777"></a>02777   <span class="keywordtype">int</span> r, is_num, sign;
<a name="l02778"></a>02778   <a class="code" href="../../d8/db3/oniguruma_8h.html#a7c8a84bc12127007886efbfcf53b6fb5">OnigCodePoint</a> end_code;
<a name="l02779"></a>02779   <a class="code" href="../../d8/db3/oniguruma_8h.html#a7c8a84bc12127007886efbfcf53b6fb5">OnigCodePoint</a> c = 0;
<a name="l02780"></a>02780   <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a> *name_end;
<a name="l02781"></a>02781   <a class="code" href="../../d1/d7b/struct_onig_encoding_type_s_t.html">OnigEncoding</a> enc = env-&gt;<a class="code" href="../../d6/dbe/struct_scan_env.html#a97f766db4ac9dabc9d173bf99fbcc11b">enc</a>;
<a name="l02782"></a>02782   <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a> *pnum_head;
<a name="l02783"></a>02783   <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a> *p = *src;
<a name="l02784"></a>02784   <a class="code" href="../../d6/dda/regparse_8c.html#a44975cffe07e4559bf5638cafb4a6b30">PFETCH_READY</a>;
<a name="l02785"></a>02785 
<a name="l02786"></a>02786   *rback_num = 0;
<a name="l02787"></a>02787 
<a name="l02788"></a>02788   end_code = <a class="code" href="../../d6/dda/regparse_8c.html#af6e87bfb65c5e89ad600a2e650ca9187">get_name_end_code_point</a>(start_code);
<a name="l02789"></a>02789 
<a name="l02790"></a>02790   *rname_end = name_end = end;
<a name="l02791"></a>02791   r = 0;
<a name="l02792"></a>02792   pnum_head = *src;
<a name="l02793"></a>02793   is_num = 0;
<a name="l02794"></a>02794   sign = 1;
<a name="l02795"></a>02795 
<a name="l02796"></a>02796   <span class="keywordflow">if</span> (<a class="code" href="../../d6/dda/regparse_8c.html#a43ce1d83d1961694adc2dfcbfac7d690">PEND</a>) {
<a name="l02797"></a>02797     <span class="keywordflow">return</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#a9d9a35ebc32ac51053edc7ab0b149ac7">ONIGERR_EMPTY_GROUP_NAME</a>;
<a name="l02798"></a>02798   }
<a name="l02799"></a>02799   <span class="keywordflow">else</span> {
<a name="l02800"></a>02800     <a class="code" href="../../d6/dda/regparse_8c.html#a8a8898c873b81a88454a968371696cab">PFETCH</a>(c);
<a name="l02801"></a>02801     <span class="keywordflow">if</span> (c == end_code)
<a name="l02802"></a>02802       <span class="keywordflow">return</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#a9d9a35ebc32ac51053edc7ab0b149ac7">ONIGERR_EMPTY_GROUP_NAME</a>;
<a name="l02803"></a>02803 
<a name="l02804"></a>02804     <span class="keywordflow">if</span> (<a class="code" href="../../d8/db3/oniguruma_8h.html#a5ce23077f30d0af86e623ee1e0838a2e">ONIGENC_IS_CODE_DIGIT</a>(enc, c)) {
<a name="l02805"></a>02805       is_num = 1;
<a name="l02806"></a>02806     }
<a name="l02807"></a>02807     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (c == <span class="charliteral">&apos;-&apos;</span>) {
<a name="l02808"></a>02808       is_num = 2;
<a name="l02809"></a>02809       sign = -1;
<a name="l02810"></a>02810       pnum_head = p;
<a name="l02811"></a>02811     }
<a name="l02812"></a>02812     <span class="keywordflow">else</span> {
<a name="l02813"></a>02813       r = <a class="code" href="../../d8/db3/oniguruma_8h.html#afdcd4007200d9b14ff8c93a9b3ed8cf6">ONIGERR_INVALID_CHAR_IN_GROUP_NAME</a>;
<a name="l02814"></a>02814     }
<a name="l02815"></a>02815   }
<a name="l02816"></a>02816 
<a name="l02817"></a>02817   <span class="keywordflow">while</span> (!<a class="code" href="../../d6/dda/regparse_8c.html#a43ce1d83d1961694adc2dfcbfac7d690">PEND</a>) {
<a name="l02818"></a>02818     name_end = p;
<a name="l02819"></a>02819 
<a name="l02820"></a>02820     <a class="code" href="../../d6/dda/regparse_8c.html#a8a8898c873b81a88454a968371696cab">PFETCH</a>(c);
<a name="l02821"></a>02821     <span class="keywordflow">if</span> (c == end_code || c == <span class="charliteral">&apos;)&apos;</span>) <span class="keywordflow">break</span>;
<a name="l02822"></a>02822     <span class="keywordflow">if</span> (! <a class="code" href="../../d8/db3/oniguruma_8h.html#a5ce23077f30d0af86e623ee1e0838a2e">ONIGENC_IS_CODE_DIGIT</a>(enc, c))
<a name="l02823"></a>02823       r = <a class="code" href="../../d8/db3/oniguruma_8h.html#afdcd4007200d9b14ff8c93a9b3ed8cf6">ONIGERR_INVALID_CHAR_IN_GROUP_NAME</a>;
<a name="l02824"></a>02824   }
<a name="l02825"></a>02825   <span class="keywordflow">if</span> (r == 0 &amp;&amp; c != end_code) {
<a name="l02826"></a>02826     r = <a class="code" href="../../d8/db3/oniguruma_8h.html#a5a3fb0424ebe642d6209e3d2dc2e2ae8">ONIGERR_INVALID_GROUP_NAME</a>;
<a name="l02827"></a>02827     name_end = end;
<a name="l02828"></a>02828   }
<a name="l02829"></a>02829 
<a name="l02830"></a>02830   <span class="keywordflow">if</span> (r == 0) {
<a name="l02831"></a>02831     *rback_num = <a class="code" href="../../d6/dda/regparse_8c.html#af172b663db06124c2c4b62a7e1377472">onig_scan_unsigned_number</a>(&amp;pnum_head, name_end, enc);
<a name="l02832"></a>02832     <span class="keywordflow">if</span> (*rback_num &lt; 0) <span class="keywordflow">return</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#af6769c109e3a039fa74338b01c389c94">ONIGERR_TOO_BIG_NUMBER</a>;
<a name="l02833"></a>02833     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (*rback_num == 0) {
<a name="l02834"></a>02834       r = <a class="code" href="../../d8/db3/oniguruma_8h.html#a5a3fb0424ebe642d6209e3d2dc2e2ae8">ONIGERR_INVALID_GROUP_NAME</a>;
<a name="l02835"></a>02835       <span class="keywordflow">goto</span> <a class="code" href="../../d5/df2/win32_8c.html#a6ce68847c12434f60d1b2654a3dc3409">err</a>;
<a name="l02836"></a>02836     }
<a name="l02837"></a>02837     *rback_num *= sign;
<a name="l02838"></a>02838 
<a name="l02839"></a>02839     *rname_end = name_end;
<a name="l02840"></a>02840     *src = p;
<a name="l02841"></a>02841     <span class="keywordflow">return</span> 0;
<a name="l02842"></a>02842   }
<a name="l02843"></a>02843   <span class="keywordflow">else</span> {
<a name="l02844"></a>02844   <a class="code" href="../../d5/df2/win32_8c.html#a6ce68847c12434f60d1b2654a3dc3409">err</a>:
<a name="l02845"></a>02845     <a class="code" href="../../d6/dda/regparse_8c.html#a8d6d95d9c113545baa16fe1ff3d96191">onig_scan_env_set_error_string</a>(env, r, *src, name_end);
<a name="l02846"></a>02846     <span class="keywordflow">return</span> r;
<a name="l02847"></a>02847   }
<a name="l02848"></a>02848 }
<a name="l02849"></a>02849 <span class="preprocessor">#endif </span><span class="comment">/* USE_NAMED_GROUP */</span>
<a name="l02850"></a>02850 
<a name="l02851"></a>02851 <span class="keywordtype">void</span> <a class="code" href="../../d5/d61/regerror_8c.html#abb8201a9c445bcea24c77d760e01b08b">onig_vsnprintf_with_pattern</a>(<a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a> buf[], <span class="keywordtype">int</span> bufsize, <a class="code" href="../../d1/d7b/struct_onig_encoding_type_s_t.html">OnigEncoding</a> enc,
<a name="l02852"></a>02852                            <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>* pat, <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>* pat_end, <span class="keyword">const</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a> *fmt, va_list <a class="code" href="../../d3/d09/ripper_8y.html#a8187411843a6284ffb964ef3fb9fcab3">args</a>);
<a name="l02853"></a>02853 
<a name="l02854"></a>02854 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l02855"></a><a class="code" href="../../d6/dda/regparse_8c.html#acb67057765575ddb27b1d90fd972fde5">02855</a> <a class="code" href="../../d6/dda/regparse_8c.html#acb67057765575ddb27b1d90fd972fde5">onig_syntax_warn</a>(<a class="code" href="../../d6/dbe/struct_scan_env.html">ScanEnv</a> *env, <span class="keyword">const</span> <span class="keywordtype">char</span> *fmt, ...)
<a name="l02856"></a>02856 {
<a name="l02857"></a>02857     va_list <a class="code" href="../../d3/d09/ripper_8y.html#a8187411843a6284ffb964ef3fb9fcab3">args</a>;
<a name="l02858"></a>02858     <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a> buf[<a class="code" href="../../d6/dda/regparse_8c.html#a672827e035b8ebbeae739f715a4757b7">WARN_BUFSIZE</a>];
<a name="l02859"></a>02859     va_start(args, fmt);
<a name="l02860"></a>02860     <a class="code" href="../../d5/d61/regerror_8c.html#abb8201a9c445bcea24c77d760e01b08b">onig_vsnprintf_with_pattern</a>(buf, <a class="code" href="../../d6/dda/regparse_8c.html#a672827e035b8ebbeae739f715a4757b7">WARN_BUFSIZE</a>, env-&gt;<a class="code" href="../../d6/dbe/struct_scan_env.html#a97f766db4ac9dabc9d173bf99fbcc11b">enc</a>,
<a name="l02861"></a>02861                 env-&gt;<a class="code" href="../../d6/dbe/struct_scan_env.html#af50cd3b4f33598bb18cd17465186775e">pattern</a>, env-&gt;<a class="code" href="../../d6/dbe/struct_scan_env.html#a4181f23bd0ae880c5e3f0dff09e71277">pattern_end</a>,
<a name="l02862"></a>02862                 (<span class="keyword">const</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a> *)fmt, args);
<a name="l02863"></a>02863     va_end(args);
<a name="l02864"></a>02864     <span class="keywordflow">if</span> (env-&gt;<a class="code" href="../../d6/dbe/struct_scan_env.html#ac098ebd6891beee70cc019bec3ce4cfd">sourcefile</a> == <a class="code" href="../../d3/d09/ripper_8y.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l02865"></a>02865       <a class="code" href="../../db/dcc/error_8c.html#aa5b1972d475e9a090c8ef607ce033008">rb_warn</a>(<span class="stringliteral">&quot;%s&quot;</span>, (<span class="keywordtype">char</span> *)buf);
<a name="l02866"></a>02866     <span class="keywordflow">else</span>
<a name="l02867"></a>02867       <a class="code" href="../../db/dcc/error_8c.html#a146caf541551298053f23e384ce4ce2a">rb_compile_warn</a>(env-&gt;<a class="code" href="../../d6/dbe/struct_scan_env.html#ac098ebd6891beee70cc019bec3ce4cfd">sourcefile</a>, env-&gt;<a class="code" href="../../d6/dbe/struct_scan_env.html#a5ae929d1df22fc2dfd24700262934b38">sourceline</a>, <span class="stringliteral">&quot;%s&quot;</span>, (<span class="keywordtype">char</span> *)buf);
<a name="l02868"></a>02868 }
<a name="l02869"></a>02869 
<a name="l02870"></a>02870 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l02871"></a><a class="code" href="../../d6/dda/regparse_8c.html#ab3756f3c29ed37db51ab30cfab1f8b55">02871</a> <a class="code" href="../../d6/dda/regparse_8c.html#ab3756f3c29ed37db51ab30cfab1f8b55">CC_ESC_WARN</a>(<a class="code" href="../../d6/dbe/struct_scan_env.html">ScanEnv</a> *env, <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a> *c)
<a name="l02872"></a>02872 {
<a name="l02873"></a>02873   <span class="keywordflow">if</span> (<a class="code" href="../../d6/dda/regparse_8c.html#a85dc90a01fd054e748019cd1858c39b8">onig_warn</a> == <a class="code" href="../../d6/dda/regparse_8c.html#a32f51f068bd8e9c2eb940e259f054e9f">onig_null_warn</a>) return ;
<a name="l02874"></a>02874 
<a name="l02875"></a>02875   <span class="keywordflow">if</span> (<a class="code" href="../../d1/dfc/regparse_8h.html#a18bfc9ee154d6dd516347bd71b4810f6">IS_SYNTAX_BV</a>(env-&gt;<a class="code" href="../../d6/dbe/struct_scan_env.html#ae5c4502ad7b7a4a418eda464919d2bda">syntax</a>, <a class="code" href="../../d8/db3/oniguruma_8h.html#a6bbc59312864308b494c106283c5e10f">ONIG_SYN_WARN_CC_OP_NOT_ESCAPED</a>) &amp;&amp;
<a name="l02876"></a>02876       <a class="code" href="../../d1/dfc/regparse_8h.html#a18bfc9ee154d6dd516347bd71b4810f6">IS_SYNTAX_BV</a>(env-&gt;<a class="code" href="../../d6/dbe/struct_scan_env.html#ae5c4502ad7b7a4a418eda464919d2bda">syntax</a>, <a class="code" href="../../d8/db3/oniguruma_8h.html#a2fd9cf752963a571df5efc655ee5b5b3">ONIG_SYN_BACKSLASH_ESCAPE_IN_CC</a>)) {
<a name="l02877"></a>02877     <a class="code" href="../../d6/dda/regparse_8c.html#acb67057765575ddb27b1d90fd972fde5">onig_syntax_warn</a>(env, <span class="stringliteral">&quot;character class has &apos;%s&apos; without escape&quot;</span>, c);
<a name="l02878"></a>02878   }
<a name="l02879"></a>02879 }
<a name="l02880"></a>02880 
<a name="l02881"></a>02881 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l02882"></a><a class="code" href="../../d6/dda/regparse_8c.html#a601f73629174ca96bc93fd877f69403d">02882</a> <a class="code" href="../../d6/dda/regparse_8c.html#a601f73629174ca96bc93fd877f69403d">CLOSE_BRACKET_WITHOUT_ESC_WARN</a>(<a class="code" href="../../d6/dbe/struct_scan_env.html">ScanEnv</a>* env, <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>* c)
<a name="l02883"></a>02883 {
<a name="l02884"></a>02884   <span class="keywordflow">if</span> (<a class="code" href="../../d6/dda/regparse_8c.html#a85dc90a01fd054e748019cd1858c39b8">onig_warn</a> == <a class="code" href="../../d6/dda/regparse_8c.html#a32f51f068bd8e9c2eb940e259f054e9f">onig_null_warn</a>) return ;
<a name="l02885"></a>02885 
<a name="l02886"></a>02886   <span class="keywordflow">if</span> (<a class="code" href="../../d1/dfc/regparse_8h.html#a18bfc9ee154d6dd516347bd71b4810f6">IS_SYNTAX_BV</a>((env)-&gt;syntax, <a class="code" href="../../d8/db3/oniguruma_8h.html#a6bbc59312864308b494c106283c5e10f">ONIG_SYN_WARN_CC_OP_NOT_ESCAPED</a>)) {
<a name="l02887"></a>02887       <a class="code" href="../../d6/dda/regparse_8c.html#acb67057765575ddb27b1d90fd972fde5">onig_syntax_warn</a>(env, <span class="stringliteral">&quot;regular expression has &apos;%s&apos; without escape&quot;</span>, c);
<a name="l02888"></a>02888   }
<a name="l02889"></a>02889 }
<a name="l02890"></a>02890 
<a name="l02891"></a>02891 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l02892"></a><a class="code" href="../../d6/dda/regparse_8c.html#af3eccf7a260f9d9f50a8be9c54502a1f">02892</a> <a class="code" href="../../d6/dda/regparse_8c.html#af3eccf7a260f9d9f50a8be9c54502a1f">CC_DUP_WARN</a>(<a class="code" href="../../d6/dbe/struct_scan_env.html">ScanEnv</a> *env)
<a name="l02893"></a>02893 {
<a name="l02894"></a>02894   <span class="keywordflow">if</span> (<a class="code" href="../../d6/dda/regparse_8c.html#a85dc90a01fd054e748019cd1858c39b8">onig_warn</a> == <a class="code" href="../../d6/dda/regparse_8c.html#a32f51f068bd8e9c2eb940e259f054e9f">onig_null_warn</a> || !<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a117741045763c090b26e30a85bd0e0a6">RTEST</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a56087d5316e4c73027105c023006cb15">ruby_verbose</a>)) return ;
<a name="l02895"></a>02895 
<a name="l02896"></a>02896   <span class="keywordflow">if</span> (<a class="code" href="../../d1/dfc/regparse_8h.html#a18bfc9ee154d6dd516347bd71b4810f6">IS_SYNTAX_BV</a>((env)-&gt;syntax, <a class="code" href="../../d8/db3/oniguruma_8h.html#a3c9685ef00f2d7375294fb0703bcc070">ONIG_SYN_WARN_CC_DUP</a>) &amp;&amp;
<a name="l02897"></a>02897     !((env)-&gt;warnings_flag &amp; <a class="code" href="../../d8/db3/oniguruma_8h.html#a3c9685ef00f2d7375294fb0703bcc070">ONIG_SYN_WARN_CC_DUP</a>)) {
<a name="l02898"></a>02898     (env)-&gt;warnings_flag |= ONIG_SYN_WARN_CC_DUP;
<a name="l02899"></a>02899     <a class="code" href="../../d6/dda/regparse_8c.html#acb67057765575ddb27b1d90fd972fde5">onig_syntax_warn</a>(env, <span class="stringliteral">&quot;character class has duplicated range&quot;</span>);
<a name="l02900"></a>02900   }
<a name="l02901"></a>02901 }
<a name="l02902"></a>02902 
<a name="l02903"></a>02903 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l02904"></a><a class="code" href="../../d6/dda/regparse_8c.html#a22db37d780657eeda054796e3f7bef27">02904</a> <a class="code" href="../../d6/dda/regparse_8c.html#a22db37d780657eeda054796e3f7bef27">UNKNOWN_ESC_WARN</a>(<a class="code" href="../../d6/dbe/struct_scan_env.html">ScanEnv</a> *env, <span class="keywordtype">int</span> c)
<a name="l02905"></a>02905 {
<a name="l02906"></a>02906   <span class="keywordflow">if</span> (<a class="code" href="../../d6/dda/regparse_8c.html#a85dc90a01fd054e748019cd1858c39b8">onig_warn</a> == <a class="code" href="../../d6/dda/regparse_8c.html#a32f51f068bd8e9c2eb940e259f054e9f">onig_null_warn</a> || !<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a117741045763c090b26e30a85bd0e0a6">RTEST</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a56087d5316e4c73027105c023006cb15">ruby_verbose</a>)) return ;
<a name="l02907"></a>02907   <a class="code" href="../../d6/dda/regparse_8c.html#acb67057765575ddb27b1d90fd972fde5">onig_syntax_warn</a>(env, <span class="stringliteral">&quot;Unknown escape \\%c is ignored&quot;</span>, c);
<a name="l02908"></a>02908 }
<a name="l02909"></a>02909 
<a name="l02910"></a>02910 <span class="keyword">static</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>*
<a name="l02911"></a><a class="code" href="../../d6/dda/regparse_8c.html#a1a357dfbe638de157057aaab280f0101">02911</a> <a class="code" href="../../d6/dda/regparse_8c.html#a1a357dfbe638de157057aaab280f0101">find_str_position</a>(<a class="code" href="../../d8/db3/oniguruma_8h.html#a7c8a84bc12127007886efbfcf53b6fb5">OnigCodePoint</a> s[], <span class="keywordtype">int</span> n, <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>* from, <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>* to,
<a name="l02912"></a>02912                   <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a> **next, <a class="code" href="../../d1/d7b/struct_onig_encoding_type_s_t.html">OnigEncoding</a> enc)
<a name="l02913"></a>02913 {
<a name="l02914"></a>02914   <span class="keywordtype">int</span> i;
<a name="l02915"></a>02915   <a class="code" href="../../d8/db3/oniguruma_8h.html#a7c8a84bc12127007886efbfcf53b6fb5">OnigCodePoint</a> x;
<a name="l02916"></a>02916   <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a> *q;
<a name="l02917"></a>02917   <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a> *p = from;
<a name="l02918"></a>02918 
<a name="l02919"></a>02919   <span class="keywordflow">while</span> (p &lt; to) {
<a name="l02920"></a>02920     x = <a class="code" href="../../d8/db3/oniguruma_8h.html#a375d2932370b8067cb9c73f17051ae89">ONIGENC_MBC_TO_CODE</a>(enc, p, to);
<a name="l02921"></a>02921     q = p + <a class="code" href="../../d3/d09/ripper_8y.html#ae9f8530a4c9ec89ae8d62ce5b4410aad">enclen</a>(enc, p, to);
<a name="l02922"></a>02922     <span class="keywordflow">if</span> (x == s[0]) {
<a name="l02923"></a>02923       <span class="keywordflow">for</span> (i = 1; i &lt; n &amp;&amp; q &lt; to; i++) {
<a name="l02924"></a>02924         x = <a class="code" href="../../d8/db3/oniguruma_8h.html#a375d2932370b8067cb9c73f17051ae89">ONIGENC_MBC_TO_CODE</a>(enc, q, to);
<a name="l02925"></a>02925         <span class="keywordflow">if</span> (x != s[i]) <span class="keywordflow">break</span>;
<a name="l02926"></a>02926         q += enclen(enc, q, to);
<a name="l02927"></a>02927       }
<a name="l02928"></a>02928       <span class="keywordflow">if</span> (i &gt;= n) {
<a name="l02929"></a>02929         <span class="keywordflow">if</span> (<a class="code" href="../../d6/d87/regint_8h.html#a4bc25fbd4749a2c130d1ae7f15ba140c">IS_NOT_NULL</a>(next))
<a name="l02930"></a>02930           *next = q;
<a name="l02931"></a>02931         <span class="keywordflow">return</span> p;
<a name="l02932"></a>02932       }
<a name="l02933"></a>02933     }
<a name="l02934"></a>02934     p = q;
<a name="l02935"></a>02935   }
<a name="l02936"></a>02936   <span class="keywordflow">return</span> <a class="code" href="../../d6/d87/regint_8h.html#a710fb6bef4455b84c75bbb919e1f9496">NULL_UCHARP</a>;
<a name="l02937"></a>02937 }
<a name="l02938"></a>02938 
<a name="l02939"></a>02939 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l02940"></a><a class="code" href="../../d6/dda/regparse_8c.html#aab94b87f1402882e62414bd26531521c">02940</a> <a class="code" href="../../d6/dda/regparse_8c.html#aab94b87f1402882e62414bd26531521c">str_exist_check_with_esc</a>(<a class="code" href="../../d8/db3/oniguruma_8h.html#a7c8a84bc12127007886efbfcf53b6fb5">OnigCodePoint</a> s[], <span class="keywordtype">int</span> n, <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>* from, <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>* to,
<a name="l02941"></a>02941                  <a class="code" href="../../d8/db3/oniguruma_8h.html#a7c8a84bc12127007886efbfcf53b6fb5">OnigCodePoint</a> <a class="code" href="../../d4/db0/__sdbm_8c.html#ada436df6a31dab0938235cc56320e487">bad</a>, <a class="code" href="../../d1/d7b/struct_onig_encoding_type_s_t.html">OnigEncoding</a> enc, <span class="keyword">const</span> <a class="code" href="../../d3/d3f/struct_onig_syntax_type.html">OnigSyntaxType</a>* syn)
<a name="l02942"></a>02942 {
<a name="l02943"></a>02943   <span class="keywordtype">int</span> i, in_esc;
<a name="l02944"></a>02944   <a class="code" href="../../d8/db3/oniguruma_8h.html#a7c8a84bc12127007886efbfcf53b6fb5">OnigCodePoint</a> x;
<a name="l02945"></a>02945   <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a> *q;
<a name="l02946"></a>02946   <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a> *p = from;
<a name="l02947"></a>02947 
<a name="l02948"></a>02948   in_esc = 0;
<a name="l02949"></a>02949   <span class="keywordflow">while</span> (p &lt; to) {
<a name="l02950"></a>02950     <span class="keywordflow">if</span> (in_esc) {
<a name="l02951"></a>02951       in_esc = 0;
<a name="l02952"></a>02952       p += <a class="code" href="../../d3/d09/ripper_8y.html#ae9f8530a4c9ec89ae8d62ce5b4410aad">enclen</a>(enc, p, to);
<a name="l02953"></a>02953     }
<a name="l02954"></a>02954     <span class="keywordflow">else</span> {
<a name="l02955"></a>02955       x = <a class="code" href="../../d8/db3/oniguruma_8h.html#a375d2932370b8067cb9c73f17051ae89">ONIGENC_MBC_TO_CODE</a>(enc, p, to);
<a name="l02956"></a>02956       q = p + <a class="code" href="../../d3/d09/ripper_8y.html#ae9f8530a4c9ec89ae8d62ce5b4410aad">enclen</a>(enc, p, to);
<a name="l02957"></a>02957       <span class="keywordflow">if</span> (x == s[0]) {
<a name="l02958"></a>02958         <span class="keywordflow">for</span> (i = 1; i &lt; n &amp;&amp; q &lt; to; i++) {
<a name="l02959"></a>02959           x = <a class="code" href="../../d8/db3/oniguruma_8h.html#a375d2932370b8067cb9c73f17051ae89">ONIGENC_MBC_TO_CODE</a>(enc, q, to);
<a name="l02960"></a>02960           <span class="keywordflow">if</span> (x != s[i]) <span class="keywordflow">break</span>;
<a name="l02961"></a>02961           q += enclen(enc, q, to);
<a name="l02962"></a>02962         }
<a name="l02963"></a>02963         <span class="keywordflow">if</span> (i &gt;= n) <span class="keywordflow">return</span> 1;
<a name="l02964"></a>02964         p += enclen(enc, p, to);
<a name="l02965"></a>02965       }
<a name="l02966"></a>02966       <span class="keywordflow">else</span> {
<a name="l02967"></a>02967         x = <a class="code" href="../../d8/db3/oniguruma_8h.html#a375d2932370b8067cb9c73f17051ae89">ONIGENC_MBC_TO_CODE</a>(enc, p, to);
<a name="l02968"></a>02968         <span class="keywordflow">if</span> (x == bad) <span class="keywordflow">return</span> 0;
<a name="l02969"></a>02969         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (x == <a class="code" href="../../d6/d87/regint_8h.html#ae4a605f4b8bee0d69ab6d6418ddbec1b">MC_ESC</a>(syn)) in_esc = 1;
<a name="l02970"></a>02970         p = q;
<a name="l02971"></a>02971       }
<a name="l02972"></a>02972     }
<a name="l02973"></a>02973   }
<a name="l02974"></a>02974   <span class="keywordflow">return</span> 0;
<a name="l02975"></a>02975 }
<a name="l02976"></a>02976 
<a name="l02977"></a>02977 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l02978"></a><a class="code" href="../../d6/dda/regparse_8c.html#aa9e1371973aab648c9781c5d38ef5a39">02978</a> <a class="code" href="../../d6/dda/regparse_8c.html#aa9e1371973aab648c9781c5d38ef5a39">fetch_token_in_cc</a>(<a class="code" href="../../d0/d80/struct_onig_token.html">OnigToken</a>* <a class="code" href="../../d5/d11/ripper_8c.html#a2b3a335d617ec14d6296ca82d3055858">tok</a>, <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>** src, <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>* end, <a class="code" href="../../d6/dbe/struct_scan_env.html">ScanEnv</a>* env)
<a name="l02979"></a>02979 {
<a name="l02980"></a>02980   <span class="keywordtype">int</span> num;
<a name="l02981"></a>02981   <a class="code" href="../../d8/db3/oniguruma_8h.html#a7c8a84bc12127007886efbfcf53b6fb5">OnigCodePoint</a> c, c2;
<a name="l02982"></a>02982   <span class="keyword">const</span> <a class="code" href="../../d3/d3f/struct_onig_syntax_type.html">OnigSyntaxType</a>* syn = env-&gt;<a class="code" href="../../d6/dbe/struct_scan_env.html#ae5c4502ad7b7a4a418eda464919d2bda">syntax</a>;
<a name="l02983"></a>02983   <a class="code" href="../../d1/d7b/struct_onig_encoding_type_s_t.html">OnigEncoding</a> enc = env-&gt;<a class="code" href="../../d6/dbe/struct_scan_env.html#a97f766db4ac9dabc9d173bf99fbcc11b">enc</a>;
<a name="l02984"></a>02984   <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>* <a class="code" href="../../d7/dc0/parse_8y.html#a71f8b6ffdc0cc58ffd989c3162fb2bcf">prev</a>;
<a name="l02985"></a>02985   <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>* p = *src;
<a name="l02986"></a>02986   <a class="code" href="../../d6/dda/regparse_8c.html#a44975cffe07e4559bf5638cafb4a6b30">PFETCH_READY</a>;
<a name="l02987"></a>02987 
<a name="l02988"></a>02988   <span class="keywordflow">if</span> (<a class="code" href="../../d6/dda/regparse_8c.html#a43ce1d83d1961694adc2dfcbfac7d690">PEND</a>) {
<a name="l02989"></a>02989     tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#a46f3343f204ac67de13f0a774284e476">type</a> = <a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250da4b2acbe6a651813a07506f06d624ac3b">TK_EOT</a>;
<a name="l02990"></a>02990     <span class="keywordflow">return</span> tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#a46f3343f204ac67de13f0a774284e476">type</a>;
<a name="l02991"></a>02991   }
<a name="l02992"></a>02992 
<a name="l02993"></a>02993   <a class="code" href="../../d6/dda/regparse_8c.html#a8a8898c873b81a88454a968371696cab">PFETCH</a>(c);
<a name="l02994"></a>02994   tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#a46f3343f204ac67de13f0a774284e476">type</a> = <a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250dafa4fad7de330d203eb444651f110045d">TK_CHAR</a>;
<a name="l02995"></a>02995   tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#a938bb7f9e071e3c6ce68480e3138a0cc">base</a> = 0;
<a name="l02996"></a>02996   tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#aaea3a0bd5a46ef32e4a9552046a070b3">u</a>.<a class="code" href="../../d0/d80/struct_onig_token.html#ac1f4ee5fa57d7ebbfa95642148efe0f5">c</a>  = c;
<a name="l02997"></a>02997   tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#a71ac92059fef31b2d7932d04523f8c17">escaped</a> = 0;
<a name="l02998"></a>02998 
<a name="l02999"></a>02999   <span class="keywordflow">if</span> (c == <span class="charliteral">&apos;]&apos;</span>) {
<a name="l03000"></a>03000     tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#a46f3343f204ac67de13f0a774284e476">type</a> = <a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250dae586fca38ba46f46c46282713162c015">TK_CC_CLOSE</a>;
<a name="l03001"></a>03001   }
<a name="l03002"></a>03002   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (c == <span class="charliteral">&apos;-&apos;</span>) {
<a name="l03003"></a>03003     tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#a46f3343f204ac67de13f0a774284e476">type</a> = <a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250da2e4091d6c916e3a8bf35cce296ed7cea">TK_CC_RANGE</a>;
<a name="l03004"></a>03004   }
<a name="l03005"></a>03005   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (c == <a class="code" href="../../d6/d87/regint_8h.html#ae4a605f4b8bee0d69ab6d6418ddbec1b">MC_ESC</a>(syn)) {
<a name="l03006"></a>03006     <span class="keywordflow">if</span> (! <a class="code" href="../../d1/dfc/regparse_8h.html#a18bfc9ee154d6dd516347bd71b4810f6">IS_SYNTAX_BV</a>(syn, <a class="code" href="../../d8/db3/oniguruma_8h.html#a2fd9cf752963a571df5efc655ee5b5b3">ONIG_SYN_BACKSLASH_ESCAPE_IN_CC</a>))
<a name="l03007"></a>03007       <span class="keywordflow">goto</span> end;
<a name="l03008"></a>03008 
<a name="l03009"></a>03009     <span class="keywordflow">if</span> (<a class="code" href="../../d6/dda/regparse_8c.html#a43ce1d83d1961694adc2dfcbfac7d690">PEND</a>) <span class="keywordflow">return</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#a50a1adafbee790867a48752a1093444b">ONIGERR_END_PATTERN_AT_ESCAPE</a>;
<a name="l03010"></a>03010 
<a name="l03011"></a>03011     <a class="code" href="../../d6/dda/regparse_8c.html#a8a8898c873b81a88454a968371696cab">PFETCH</a>(c);
<a name="l03012"></a>03012     tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#a71ac92059fef31b2d7932d04523f8c17">escaped</a> = 1;
<a name="l03013"></a>03013     tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#aaea3a0bd5a46ef32e4a9552046a070b3">u</a>.<a class="code" href="../../d0/d80/struct_onig_token.html#ac1f4ee5fa57d7ebbfa95642148efe0f5">c</a> = c;
<a name="l03014"></a>03014     <span class="keywordflow">switch</span> (c) {
<a name="l03015"></a>03015     <span class="keywordflow">case</span> <span class="charliteral">&apos;w&apos;</span>:
<a name="l03016"></a>03016       tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#a46f3343f204ac67de13f0a774284e476">type</a> = <a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250da664a7e468d295958edd0864e4f3cf461">TK_CHAR_TYPE</a>;
<a name="l03017"></a>03017       tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#aaea3a0bd5a46ef32e4a9552046a070b3">u</a>.<a class="code" href="../../d0/d80/struct_onig_token.html#a84f464445695ec0d70cdc5f02db11833">prop</a>.ctype = <a class="code" href="../../d8/db3/oniguruma_8h.html#aaf70c7a1261acd2f76a4db97af5b3226">ONIGENC_CTYPE_W</a>;
<a name="l03018"></a>03018       tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#aaea3a0bd5a46ef32e4a9552046a070b3">u</a>.<a class="code" href="../../d0/d80/struct_onig_token.html#a84f464445695ec0d70cdc5f02db11833">prop</a>.not   = 0;
<a name="l03019"></a>03019       <span class="keywordflow">break</span>;
<a name="l03020"></a>03020     <span class="keywordflow">case</span> <span class="charliteral">&apos;W&apos;</span>:
<a name="l03021"></a>03021       tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#a46f3343f204ac67de13f0a774284e476">type</a> = <a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250da664a7e468d295958edd0864e4f3cf461">TK_CHAR_TYPE</a>;
<a name="l03022"></a>03022       tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#aaea3a0bd5a46ef32e4a9552046a070b3">u</a>.<a class="code" href="../../d0/d80/struct_onig_token.html#a84f464445695ec0d70cdc5f02db11833">prop</a>.ctype = <a class="code" href="../../d8/db3/oniguruma_8h.html#aaf70c7a1261acd2f76a4db97af5b3226">ONIGENC_CTYPE_W</a>;
<a name="l03023"></a>03023       tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#aaea3a0bd5a46ef32e4a9552046a070b3">u</a>.<a class="code" href="../../d0/d80/struct_onig_token.html#a84f464445695ec0d70cdc5f02db11833">prop</a>.not   = 1;
<a name="l03024"></a>03024       <span class="keywordflow">break</span>;
<a name="l03025"></a>03025     <span class="keywordflow">case</span> <span class="charliteral">&apos;d&apos;</span>:
<a name="l03026"></a>03026       tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#a46f3343f204ac67de13f0a774284e476">type</a> = <a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250da664a7e468d295958edd0864e4f3cf461">TK_CHAR_TYPE</a>;
<a name="l03027"></a>03027       tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#aaea3a0bd5a46ef32e4a9552046a070b3">u</a>.<a class="code" href="../../d0/d80/struct_onig_token.html#a84f464445695ec0d70cdc5f02db11833">prop</a>.ctype = <a class="code" href="../../d8/db3/oniguruma_8h.html#a4878161b7a1adcf807bcff0a8722e778">ONIGENC_CTYPE_D</a>;
<a name="l03028"></a>03028       tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#aaea3a0bd5a46ef32e4a9552046a070b3">u</a>.<a class="code" href="../../d0/d80/struct_onig_token.html#a84f464445695ec0d70cdc5f02db11833">prop</a>.not   = 0;
<a name="l03029"></a>03029       <span class="keywordflow">break</span>;
<a name="l03030"></a>03030     <span class="keywordflow">case</span> <span class="charliteral">&apos;D&apos;</span>:
<a name="l03031"></a>03031       tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#a46f3343f204ac67de13f0a774284e476">type</a> = <a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250da664a7e468d295958edd0864e4f3cf461">TK_CHAR_TYPE</a>;
<a name="l03032"></a>03032       tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#aaea3a0bd5a46ef32e4a9552046a070b3">u</a>.<a class="code" href="../../d0/d80/struct_onig_token.html#a84f464445695ec0d70cdc5f02db11833">prop</a>.ctype = <a class="code" href="../../d8/db3/oniguruma_8h.html#a4878161b7a1adcf807bcff0a8722e778">ONIGENC_CTYPE_D</a>;
<a name="l03033"></a>03033       tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#aaea3a0bd5a46ef32e4a9552046a070b3">u</a>.<a class="code" href="../../d0/d80/struct_onig_token.html#a84f464445695ec0d70cdc5f02db11833">prop</a>.not   = 1;
<a name="l03034"></a>03034       <span class="keywordflow">break</span>;
<a name="l03035"></a>03035     <span class="keywordflow">case</span> <span class="charliteral">&apos;s&apos;</span>:
<a name="l03036"></a>03036       tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#a46f3343f204ac67de13f0a774284e476">type</a> = <a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250da664a7e468d295958edd0864e4f3cf461">TK_CHAR_TYPE</a>;
<a name="l03037"></a>03037       tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#aaea3a0bd5a46ef32e4a9552046a070b3">u</a>.<a class="code" href="../../d0/d80/struct_onig_token.html#a84f464445695ec0d70cdc5f02db11833">prop</a>.ctype = <a class="code" href="../../d8/db3/oniguruma_8h.html#a8613b809ebb0533177db19ceb9eff366">ONIGENC_CTYPE_S</a>;
<a name="l03038"></a>03038       tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#aaea3a0bd5a46ef32e4a9552046a070b3">u</a>.<a class="code" href="../../d0/d80/struct_onig_token.html#a84f464445695ec0d70cdc5f02db11833">prop</a>.not   = 0;
<a name="l03039"></a>03039       <span class="keywordflow">break</span>;
<a name="l03040"></a>03040     <span class="keywordflow">case</span> <span class="charliteral">&apos;S&apos;</span>:
<a name="l03041"></a>03041       tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#a46f3343f204ac67de13f0a774284e476">type</a> = <a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250da664a7e468d295958edd0864e4f3cf461">TK_CHAR_TYPE</a>;
<a name="l03042"></a>03042       tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#aaea3a0bd5a46ef32e4a9552046a070b3">u</a>.<a class="code" href="../../d0/d80/struct_onig_token.html#a84f464445695ec0d70cdc5f02db11833">prop</a>.ctype = <a class="code" href="../../d8/db3/oniguruma_8h.html#a8613b809ebb0533177db19ceb9eff366">ONIGENC_CTYPE_S</a>;
<a name="l03043"></a>03043       tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#aaea3a0bd5a46ef32e4a9552046a070b3">u</a>.<a class="code" href="../../d0/d80/struct_onig_token.html#a84f464445695ec0d70cdc5f02db11833">prop</a>.not   = 1;
<a name="l03044"></a>03044       <span class="keywordflow">break</span>;
<a name="l03045"></a>03045     <span class="keywordflow">case</span> <span class="charliteral">&apos;h&apos;</span>:
<a name="l03046"></a>03046       <span class="keywordflow">if</span> (! <a class="code" href="../../d1/dfc/regparse_8h.html#a2ff963239e972932cefd5adaae161e76">IS_SYNTAX_OP2</a>(syn, <a class="code" href="../../d8/db3/oniguruma_8h.html#a9dbad596d7c30d8a2ba5e59d07dc1827">ONIG_SYN_OP2_ESC_H_XDIGIT</a>)) <span class="keywordflow">break</span>;
<a name="l03047"></a>03047       tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#a46f3343f204ac67de13f0a774284e476">type</a> = <a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250da664a7e468d295958edd0864e4f3cf461">TK_CHAR_TYPE</a>;
<a name="l03048"></a>03048       tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#aaea3a0bd5a46ef32e4a9552046a070b3">u</a>.<a class="code" href="../../d0/d80/struct_onig_token.html#a84f464445695ec0d70cdc5f02db11833">prop</a>.ctype = <a class="code" href="../../d8/db3/oniguruma_8h.html#a2964cbf76712be02ed2d0f07e4b8386e">ONIGENC_CTYPE_XDIGIT</a>;
<a name="l03049"></a>03049       tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#aaea3a0bd5a46ef32e4a9552046a070b3">u</a>.<a class="code" href="../../d0/d80/struct_onig_token.html#a84f464445695ec0d70cdc5f02db11833">prop</a>.not   = 0;
<a name="l03050"></a>03050       <span class="keywordflow">break</span>;
<a name="l03051"></a>03051     <span class="keywordflow">case</span> <span class="charliteral">&apos;H&apos;</span>:
<a name="l03052"></a>03052       <span class="keywordflow">if</span> (! <a class="code" href="../../d1/dfc/regparse_8h.html#a2ff963239e972932cefd5adaae161e76">IS_SYNTAX_OP2</a>(syn, <a class="code" href="../../d8/db3/oniguruma_8h.html#a9dbad596d7c30d8a2ba5e59d07dc1827">ONIG_SYN_OP2_ESC_H_XDIGIT</a>)) <span class="keywordflow">break</span>;
<a name="l03053"></a>03053       tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#a46f3343f204ac67de13f0a774284e476">type</a> = <a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250da664a7e468d295958edd0864e4f3cf461">TK_CHAR_TYPE</a>;
<a name="l03054"></a>03054       tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#aaea3a0bd5a46ef32e4a9552046a070b3">u</a>.<a class="code" href="../../d0/d80/struct_onig_token.html#a84f464445695ec0d70cdc5f02db11833">prop</a>.ctype = <a class="code" href="../../d8/db3/oniguruma_8h.html#a2964cbf76712be02ed2d0f07e4b8386e">ONIGENC_CTYPE_XDIGIT</a>;
<a name="l03055"></a>03055       tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#aaea3a0bd5a46ef32e4a9552046a070b3">u</a>.<a class="code" href="../../d0/d80/struct_onig_token.html#a84f464445695ec0d70cdc5f02db11833">prop</a>.not   = 1;
<a name="l03056"></a>03056       <span class="keywordflow">break</span>;
<a name="l03057"></a>03057 
<a name="l03058"></a>03058     <span class="keywordflow">case</span> <span class="charliteral">&apos;p&apos;</span>:
<a name="l03059"></a>03059     <span class="keywordflow">case</span> <span class="charliteral">&apos;P&apos;</span>:
<a name="l03060"></a>03060       c2 = <a class="code" href="../../d6/dda/regparse_8c.html#a337ed696ab55651d216a34abbafd4cd3">PPEEK</a>;
<a name="l03061"></a>03061       <span class="keywordflow">if</span> (c2 == <span class="charliteral">&apos;{&apos;</span> &amp;&amp;
<a name="l03062"></a>03062           <a class="code" href="../../d1/dfc/regparse_8h.html#a2ff963239e972932cefd5adaae161e76">IS_SYNTAX_OP2</a>(syn, <a class="code" href="../../d8/db3/oniguruma_8h.html#a292134a70cda1a681a663e11180fd0c2">ONIG_SYN_OP2_ESC_P_BRACE_CHAR_PROPERTY</a>)) {
<a name="l03063"></a>03063         <a class="code" href="../../d6/dda/regparse_8c.html#a0545e73dc7ae14b1f62293c1feba3983">PINC</a>;
<a name="l03064"></a>03064         tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#a46f3343f204ac67de13f0a774284e476">type</a> = <a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250da81d0318969b984a3d42eab29ec60fb47">TK_CHAR_PROPERTY</a>;
<a name="l03065"></a>03065         tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#aaea3a0bd5a46ef32e4a9552046a070b3">u</a>.<a class="code" href="../../d0/d80/struct_onig_token.html#a84f464445695ec0d70cdc5f02db11833">prop</a>.not = (c == <span class="charliteral">&apos;P&apos;</span> ? 1 : 0);
<a name="l03066"></a>03066 
<a name="l03067"></a>03067         <span class="keywordflow">if</span> (<a class="code" href="../../d1/dfc/regparse_8h.html#a2ff963239e972932cefd5adaae161e76">IS_SYNTAX_OP2</a>(syn, <a class="code" href="../../d8/db3/oniguruma_8h.html#a2dbc25f5f5e66628427c51fb4d100441">ONIG_SYN_OP2_ESC_P_BRACE_CIRCUMFLEX_NOT</a>)) {
<a name="l03068"></a>03068           <a class="code" href="../../d6/dda/regparse_8c.html#a8a8898c873b81a88454a968371696cab">PFETCH</a>(c2);
<a name="l03069"></a>03069           <span class="keywordflow">if</span> (c2 == <span class="charliteral">&apos;^&apos;</span>) {
<a name="l03070"></a>03070             tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#aaea3a0bd5a46ef32e4a9552046a070b3">u</a>.<a class="code" href="../../d0/d80/struct_onig_token.html#a84f464445695ec0d70cdc5f02db11833">prop</a>.not = (tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#aaea3a0bd5a46ef32e4a9552046a070b3">u</a>.<a class="code" href="../../d0/d80/struct_onig_token.html#a84f464445695ec0d70cdc5f02db11833">prop</a>.not == 0 ? 1 : 0);
<a name="l03071"></a>03071           }
<a name="l03072"></a>03072           <span class="keywordflow">else</span>
<a name="l03073"></a>03073             <a class="code" href="../../d6/dda/regparse_8c.html#ad0350add3c44d502c77357f6012b1bf2">PUNFETCH</a>;
<a name="l03074"></a>03074         }
<a name="l03075"></a>03075       }
<a name="l03076"></a>03076       <span class="keywordflow">else</span> {
<a name="l03077"></a>03077           <a class="code" href="../../d6/dda/regparse_8c.html#acb67057765575ddb27b1d90fd972fde5">onig_syntax_warn</a>(env, <span class="stringliteral">&quot;invalid Unicode Property \\%c&quot;</span>, c);
<a name="l03078"></a>03078       }
<a name="l03079"></a>03079       <span class="keywordflow">break</span>;
<a name="l03080"></a>03080 
<a name="l03081"></a>03081     <span class="keywordflow">case</span> <span class="charliteral">&apos;x&apos;</span>:
<a name="l03082"></a>03082       <span class="keywordflow">if</span> (<a class="code" href="../../d6/dda/regparse_8c.html#a43ce1d83d1961694adc2dfcbfac7d690">PEND</a>) <span class="keywordflow">break</span>;
<a name="l03083"></a>03083 
<a name="l03084"></a>03084       prev = p;
<a name="l03085"></a>03085       <span class="keywordflow">if</span> (<a class="code" href="../../d6/dda/regparse_8c.html#a4ed53b7baf65c82f4ba37027979ed82d">PPEEK_IS</a>(<span class="charliteral">&apos;{&apos;</span>) &amp;&amp; <a class="code" href="../../d1/dfc/regparse_8h.html#aeeb7aa0f60553ade62b7338e8f21256b">IS_SYNTAX_OP</a>(syn, <a class="code" href="../../d8/db3/oniguruma_8h.html#a5bedbddb8c6796ca25a1dad1154d696c">ONIG_SYN_OP_ESC_X_BRACE_HEX8</a>)) {
<a name="l03086"></a>03086         <a class="code" href="../../d6/dda/regparse_8c.html#a0545e73dc7ae14b1f62293c1feba3983">PINC</a>;
<a name="l03087"></a>03087         num = <a class="code" href="../../d6/dda/regparse_8c.html#ac28095d363fabc3f8e789710b8b41df1">scan_unsigned_hexadecimal_number</a>(&amp;p, end, 8, enc);
<a name="l03088"></a>03088         <span class="keywordflow">if</span> (num &lt; 0) <span class="keywordflow">return</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#a880878ea3cebc76ef9b37a346188fe5f">ONIGERR_TOO_BIG_WIDE_CHAR_VALUE</a>;
<a name="l03089"></a>03089         <span class="keywordflow">if</span> (!<a class="code" href="../../d6/dda/regparse_8c.html#a43ce1d83d1961694adc2dfcbfac7d690">PEND</a>) {
<a name="l03090"></a>03090           c2 = <a class="code" href="../../d6/dda/regparse_8c.html#a337ed696ab55651d216a34abbafd4cd3">PPEEK</a>;
<a name="l03091"></a>03091           <span class="keywordflow">if</span> (<a class="code" href="../../d8/db3/oniguruma_8h.html#a4aa7f107cf374fefbc0633d94a5477a0">ONIGENC_IS_CODE_XDIGIT</a>(enc, c2))
<a name="l03092"></a>03092             <span class="keywordflow">return</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#a5313281a8031631e132c01ee50010251">ONIGERR_TOO_LONG_WIDE_CHAR_VALUE</a>;
<a name="l03093"></a>03093         }
<a name="l03094"></a>03094 
<a name="l03095"></a>03095         <span class="keywordflow">if</span> (p &gt; prev + <a class="code" href="../../d3/d09/ripper_8y.html#ae9f8530a4c9ec89ae8d62ce5b4410aad">enclen</a>(enc, prev, end) &amp;&amp; !<a class="code" href="../../d6/dda/regparse_8c.html#a43ce1d83d1961694adc2dfcbfac7d690">PEND</a> &amp;&amp; (<a class="code" href="../../d6/dda/regparse_8c.html#a4ed53b7baf65c82f4ba37027979ed82d">PPEEK_IS</a>(<span class="charliteral">&apos;}&apos;</span>))) {
<a name="l03096"></a>03096           <a class="code" href="../../d6/dda/regparse_8c.html#a0545e73dc7ae14b1f62293c1feba3983">PINC</a>;
<a name="l03097"></a>03097           tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#a46f3343f204ac67de13f0a774284e476">type</a>   = <a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250da7a451b3ab1e788efaa2da058c6c8b49c">TK_CODE_POINT</a>;
<a name="l03098"></a>03098           tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#a938bb7f9e071e3c6ce68480e3138a0cc">base</a>   = 16;
<a name="l03099"></a>03099           tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#aaea3a0bd5a46ef32e4a9552046a070b3">u</a>.<a class="code" href="../../d0/d80/struct_onig_token.html#a40121b0193b6bbfbf9fdb88d82f1ea7a">code</a> = (<a class="code" href="../../d8/db3/oniguruma_8h.html#a7c8a84bc12127007886efbfcf53b6fb5">OnigCodePoint</a> )num;
<a name="l03100"></a>03100         }
<a name="l03101"></a>03101         <span class="keywordflow">else</span> {
<a name="l03102"></a>03102           <span class="comment">/* can&apos;t read nothing or invalid format */</span>
<a name="l03103"></a>03103           p = prev;
<a name="l03104"></a>03104         }
<a name="l03105"></a>03105       }
<a name="l03106"></a>03106       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d1/dfc/regparse_8h.html#aeeb7aa0f60553ade62b7338e8f21256b">IS_SYNTAX_OP</a>(syn, <a class="code" href="../../d8/db3/oniguruma_8h.html#af14ad84f8fe1489439420a17287fd994">ONIG_SYN_OP_ESC_X_HEX2</a>)) {
<a name="l03107"></a>03107         num = <a class="code" href="../../d6/dda/regparse_8c.html#ac28095d363fabc3f8e789710b8b41df1">scan_unsigned_hexadecimal_number</a>(&amp;p, end, 2, enc);
<a name="l03108"></a>03108         <span class="keywordflow">if</span> (num &lt; 0) <span class="keywordflow">return</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#af6769c109e3a039fa74338b01c389c94">ONIGERR_TOO_BIG_NUMBER</a>;
<a name="l03109"></a>03109         <span class="keywordflow">if</span> (p == prev) {  <span class="comment">/* can&apos;t read nothing. */</span>
<a name="l03110"></a>03110           num = 0; <span class="comment">/* but, it&apos;s not error */</span>
<a name="l03111"></a>03111         }
<a name="l03112"></a>03112         tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#a46f3343f204ac67de13f0a774284e476">type</a> = <a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250dab0e056f20d46d5a9696dd7fdea89de88">TK_RAW_BYTE</a>;
<a name="l03113"></a>03113         tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#a938bb7f9e071e3c6ce68480e3138a0cc">base</a> = 16;
<a name="l03114"></a>03114         tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#aaea3a0bd5a46ef32e4a9552046a070b3">u</a>.<a class="code" href="../../d0/d80/struct_onig_token.html#ac1f4ee5fa57d7ebbfa95642148efe0f5">c</a>  = num;
<a name="l03115"></a>03115       }
<a name="l03116"></a>03116       <span class="keywordflow">break</span>;
<a name="l03117"></a>03117 
<a name="l03118"></a>03118     <span class="keywordflow">case</span> <span class="charliteral">&apos;u&apos;</span>:
<a name="l03119"></a>03119       <span class="keywordflow">if</span> (<a class="code" href="../../d6/dda/regparse_8c.html#a43ce1d83d1961694adc2dfcbfac7d690">PEND</a>) <span class="keywordflow">break</span>;
<a name="l03120"></a>03120 
<a name="l03121"></a>03121       prev = p;
<a name="l03122"></a>03122       <span class="keywordflow">if</span> (<a class="code" href="../../d1/dfc/regparse_8h.html#a2ff963239e972932cefd5adaae161e76">IS_SYNTAX_OP2</a>(syn, <a class="code" href="../../d8/db3/oniguruma_8h.html#ac7dab6dc212e4163285d924b2572c4b3">ONIG_SYN_OP2_ESC_U_HEX4</a>)) {
<a name="l03123"></a>03123         num = <a class="code" href="../../d6/dda/regparse_8c.html#ac28095d363fabc3f8e789710b8b41df1">scan_unsigned_hexadecimal_number</a>(&amp;p, end, 4, enc);
<a name="l03124"></a>03124         <span class="keywordflow">if</span> (num &lt; 0) <span class="keywordflow">return</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#af6769c109e3a039fa74338b01c389c94">ONIGERR_TOO_BIG_NUMBER</a>;
<a name="l03125"></a>03125         <span class="keywordflow">if</span> (p == prev) {  <span class="comment">/* can&apos;t read nothing. */</span>
<a name="l03126"></a>03126           num = 0; <span class="comment">/* but, it&apos;s not error */</span>
<a name="l03127"></a>03127         }
<a name="l03128"></a>03128         tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#a46f3343f204ac67de13f0a774284e476">type</a>   = <a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250da7a451b3ab1e788efaa2da058c6c8b49c">TK_CODE_POINT</a>;
<a name="l03129"></a>03129         tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#a938bb7f9e071e3c6ce68480e3138a0cc">base</a>   = 16;
<a name="l03130"></a>03130         tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#aaea3a0bd5a46ef32e4a9552046a070b3">u</a>.<a class="code" href="../../d0/d80/struct_onig_token.html#a40121b0193b6bbfbf9fdb88d82f1ea7a">code</a> = (<a class="code" href="../../d8/db3/oniguruma_8h.html#a7c8a84bc12127007886efbfcf53b6fb5">OnigCodePoint</a> )num;
<a name="l03131"></a>03131       }
<a name="l03132"></a>03132       <span class="keywordflow">break</span>;
<a name="l03133"></a>03133 
<a name="l03134"></a>03134     <span class="keywordflow">case</span> <span class="charliteral">&apos;0&apos;</span>:
<a name="l03135"></a>03135     <span class="keywordflow">case</span> <span class="charliteral">&apos;1&apos;</span>: <span class="keywordflow">case</span> <span class="charliteral">&apos;2&apos;</span>: <span class="keywordflow">case</span> <span class="charliteral">&apos;3&apos;</span>: <span class="keywordflow">case</span> <span class="charliteral">&apos;4&apos;</span>: <span class="keywordflow">case</span> <span class="charliteral">&apos;5&apos;</span>: <span class="keywordflow">case</span> <span class="charliteral">&apos;6&apos;</span>: <span class="keywordflow">case</span> <span class="charliteral">&apos;7&apos;</span>:
<a name="l03136"></a>03136       <span class="keywordflow">if</span> (<a class="code" href="../../d1/dfc/regparse_8h.html#aeeb7aa0f60553ade62b7338e8f21256b">IS_SYNTAX_OP</a>(syn, <a class="code" href="../../d8/db3/oniguruma_8h.html#a840371e8111b6e76aeb0a7a872009d37">ONIG_SYN_OP_ESC_OCTAL3</a>)) {
<a name="l03137"></a>03137         <a class="code" href="../../d6/dda/regparse_8c.html#ad0350add3c44d502c77357f6012b1bf2">PUNFETCH</a>;
<a name="l03138"></a>03138         prev = p;
<a name="l03139"></a>03139         num = <a class="code" href="../../d6/dda/regparse_8c.html#af9a4fd42a5f01d15769e6c8640fa40d7">scan_unsigned_octal_number</a>(&amp;p, end, 3, enc);
<a name="l03140"></a>03140         <span class="keywordflow">if</span> (num &lt; 0) <span class="keywordflow">return</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#af6769c109e3a039fa74338b01c389c94">ONIGERR_TOO_BIG_NUMBER</a>;
<a name="l03141"></a>03141         <span class="keywordflow">if</span> (p == prev) {  <span class="comment">/* can&apos;t read nothing. */</span>
<a name="l03142"></a>03142           num = 0; <span class="comment">/* but, it&apos;s not error */</span>
<a name="l03143"></a>03143         }
<a name="l03144"></a>03144         tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#a46f3343f204ac67de13f0a774284e476">type</a> = <a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250dab0e056f20d46d5a9696dd7fdea89de88">TK_RAW_BYTE</a>;
<a name="l03145"></a>03145         tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#a938bb7f9e071e3c6ce68480e3138a0cc">base</a> = 8;
<a name="l03146"></a>03146         tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#aaea3a0bd5a46ef32e4a9552046a070b3">u</a>.<a class="code" href="../../d0/d80/struct_onig_token.html#ac1f4ee5fa57d7ebbfa95642148efe0f5">c</a>  = num;
<a name="l03147"></a>03147       }
<a name="l03148"></a>03148       <span class="keywordflow">break</span>;
<a name="l03149"></a>03149 
<a name="l03150"></a>03150     <span class="keywordflow">default</span>:
<a name="l03151"></a>03151       <a class="code" href="../../d6/dda/regparse_8c.html#ad0350add3c44d502c77357f6012b1bf2">PUNFETCH</a>;
<a name="l03152"></a>03152       num = <a class="code" href="../../d6/dda/regparse_8c.html#ac3534284c668aefff9f97ffd5d759522">fetch_escaped_value</a>(&amp;p, end, env);
<a name="l03153"></a>03153       <span class="keywordflow">if</span> (num &lt; 0) <span class="keywordflow">return</span> num;
<a name="l03154"></a>03154       <span class="keywordflow">if</span> (tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#aaea3a0bd5a46ef32e4a9552046a070b3">u</a>.<a class="code" href="../../d0/d80/struct_onig_token.html#ac1f4ee5fa57d7ebbfa95642148efe0f5">c</a> != num) {
<a name="l03155"></a>03155         tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#aaea3a0bd5a46ef32e4a9552046a070b3">u</a>.<a class="code" href="../../d0/d80/struct_onig_token.html#a40121b0193b6bbfbf9fdb88d82f1ea7a">code</a> = (<a class="code" href="../../d8/db3/oniguruma_8h.html#a7c8a84bc12127007886efbfcf53b6fb5">OnigCodePoint</a> )num;
<a name="l03156"></a>03156         tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#a46f3343f204ac67de13f0a774284e476">type</a>   = <a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250da7a451b3ab1e788efaa2da058c6c8b49c">TK_CODE_POINT</a>;
<a name="l03157"></a>03157       }
<a name="l03158"></a>03158       <span class="keywordflow">break</span>;
<a name="l03159"></a>03159     }
<a name="l03160"></a>03160   }
<a name="l03161"></a>03161   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (c == <span class="charliteral">&apos;[&apos;</span>) {
<a name="l03162"></a>03162     <span class="keywordflow">if</span> (<a class="code" href="../../d1/dfc/regparse_8h.html#aeeb7aa0f60553ade62b7338e8f21256b">IS_SYNTAX_OP</a>(syn, <a class="code" href="../../d8/db3/oniguruma_8h.html#ab5437bddeec1ff71e12ed4048ed0a9e8">ONIG_SYN_OP_POSIX_BRACKET</a>) &amp;&amp; (<a class="code" href="../../d6/dda/regparse_8c.html#a4ed53b7baf65c82f4ba37027979ed82d">PPEEK_IS</a>(<span class="charliteral">&apos;:&apos;</span>))) {
<a name="l03163"></a>03163       <a class="code" href="../../d8/db3/oniguruma_8h.html#a7c8a84bc12127007886efbfcf53b6fb5">OnigCodePoint</a> send[] = { (<a class="code" href="../../d8/db3/oniguruma_8h.html#a7c8a84bc12127007886efbfcf53b6fb5">OnigCodePoint</a> )<span class="charliteral">&apos;:&apos;</span>, (<a class="code" href="../../d8/db3/oniguruma_8h.html#a7c8a84bc12127007886efbfcf53b6fb5">OnigCodePoint</a> )<span class="charliteral">&apos;]&apos;</span> };
<a name="l03164"></a>03164       tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#accba0041ec257e1619caefea1ea12d10">backp</a> = p; <span class="comment">/* point at &apos;[&apos; is readed */</span>
<a name="l03165"></a>03165       <a class="code" href="../../d6/dda/regparse_8c.html#a0545e73dc7ae14b1f62293c1feba3983">PINC</a>;
<a name="l03166"></a>03166       <span class="keywordflow">if</span> (<a class="code" href="../../d6/dda/regparse_8c.html#aab94b87f1402882e62414bd26531521c">str_exist_check_with_esc</a>(send, 2, p, end,
<a name="l03167"></a>03167                                    (<a class="code" href="../../d8/db3/oniguruma_8h.html#a7c8a84bc12127007886efbfcf53b6fb5">OnigCodePoint</a> )<span class="charliteral">&apos;]&apos;</span>, enc, syn)) {
<a name="l03168"></a>03168         tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#a46f3343f204ac67de13f0a774284e476">type</a> = <a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250da6e96fa876eef3f96744f4c75918c5fe0">TK_POSIX_BRACKET_OPEN</a>;
<a name="l03169"></a>03169       }
<a name="l03170"></a>03170       <span class="keywordflow">else</span> {
<a name="l03171"></a>03171         <a class="code" href="../../d6/dda/regparse_8c.html#ad0350add3c44d502c77357f6012b1bf2">PUNFETCH</a>;
<a name="l03172"></a>03172         <span class="keywordflow">goto</span> cc_in_cc;
<a name="l03173"></a>03173       }
<a name="l03174"></a>03174     }
<a name="l03175"></a>03175     <span class="keywordflow">else</span> {
<a name="l03176"></a>03176     cc_in_cc:
<a name="l03177"></a>03177       <span class="keywordflow">if</span> (<a class="code" href="../../d1/dfc/regparse_8h.html#a2ff963239e972932cefd5adaae161e76">IS_SYNTAX_OP2</a>(syn, <a class="code" href="../../d8/db3/oniguruma_8h.html#aa16634dc728c68b9b4b46f006c1c7ace">ONIG_SYN_OP2_CCLASS_SET_OP</a>)) {
<a name="l03178"></a>03178         tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#a46f3343f204ac67de13f0a774284e476">type</a> = <a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250da8e5ae596c6ac79675686299605443b64">TK_CC_CC_OPEN</a>;
<a name="l03179"></a>03179       }
<a name="l03180"></a>03180       <span class="keywordflow">else</span> {
<a name="l03181"></a>03181         <a class="code" href="../../d6/dda/regparse_8c.html#ab3756f3c29ed37db51ab30cfab1f8b55">CC_ESC_WARN</a>(env, (<a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>* )<span class="stringliteral">&quot;[&quot;</span>);
<a name="l03182"></a>03182       }
<a name="l03183"></a>03183     }
<a name="l03184"></a>03184   }
<a name="l03185"></a>03185   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (c == <span class="charliteral">&apos;&amp;&apos;</span>) {
<a name="l03186"></a>03186     <span class="keywordflow">if</span> (<a class="code" href="../../d1/dfc/regparse_8h.html#a2ff963239e972932cefd5adaae161e76">IS_SYNTAX_OP2</a>(syn, <a class="code" href="../../d8/db3/oniguruma_8h.html#aa16634dc728c68b9b4b46f006c1c7ace">ONIG_SYN_OP2_CCLASS_SET_OP</a>) &amp;&amp;
<a name="l03187"></a>03187         !<a class="code" href="../../d6/dda/regparse_8c.html#a43ce1d83d1961694adc2dfcbfac7d690">PEND</a> &amp;&amp; (<a class="code" href="../../d6/dda/regparse_8c.html#a4ed53b7baf65c82f4ba37027979ed82d">PPEEK_IS</a>(<span class="charliteral">&apos;&amp;&apos;</span>))) {
<a name="l03188"></a>03188       <a class="code" href="../../d6/dda/regparse_8c.html#a0545e73dc7ae14b1f62293c1feba3983">PINC</a>;
<a name="l03189"></a>03189       tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#a46f3343f204ac67de13f0a774284e476">type</a> = <a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250da0c9bf741e5d886ddcad4642e09be7ee1">TK_CC_AND</a>;
<a name="l03190"></a>03190     }
<a name="l03191"></a>03191   }
<a name="l03192"></a>03192 
<a name="l03193"></a>03193  end:
<a name="l03194"></a>03194   *src = p;
<a name="l03195"></a>03195   <span class="keywordflow">return</span> tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#a46f3343f204ac67de13f0a774284e476">type</a>;
<a name="l03196"></a>03196 }
<a name="l03197"></a>03197 
<a name="l03198"></a>03198 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l03199"></a><a class="code" href="../../d6/dda/regparse_8c.html#af1214620e9e6133cd463d363f2cb332f">03199</a> <a class="code" href="../../d6/dda/regparse_8c.html#af1214620e9e6133cd463d363f2cb332f">fetch_token</a>(<a class="code" href="../../d0/d80/struct_onig_token.html">OnigToken</a>* <a class="code" href="../../d5/d11/ripper_8c.html#a2b3a335d617ec14d6296ca82d3055858">tok</a>, <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>** src, <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>* end, <a class="code" href="../../d6/dbe/struct_scan_env.html">ScanEnv</a>* env)
<a name="l03200"></a>03200 {
<a name="l03201"></a>03201   <span class="keywordtype">int</span> r, num;
<a name="l03202"></a>03202   <a class="code" href="../../d8/db3/oniguruma_8h.html#a7c8a84bc12127007886efbfcf53b6fb5">OnigCodePoint</a> c;
<a name="l03203"></a>03203   <a class="code" href="../../d1/d7b/struct_onig_encoding_type_s_t.html">OnigEncoding</a> enc = env-&gt;<a class="code" href="../../d6/dbe/struct_scan_env.html#a97f766db4ac9dabc9d173bf99fbcc11b">enc</a>;
<a name="l03204"></a>03204   <span class="keyword">const</span> <a class="code" href="../../d3/d3f/struct_onig_syntax_type.html">OnigSyntaxType</a>* syn = env-&gt;<a class="code" href="../../d6/dbe/struct_scan_env.html#ae5c4502ad7b7a4a418eda464919d2bda">syntax</a>;
<a name="l03205"></a>03205   <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>* <a class="code" href="../../d7/dc0/parse_8y.html#a71f8b6ffdc0cc58ffd989c3162fb2bcf">prev</a>;
<a name="l03206"></a>03206   <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>* p = *src;
<a name="l03207"></a>03207   <a class="code" href="../../d6/dda/regparse_8c.html#a44975cffe07e4559bf5638cafb4a6b30">PFETCH_READY</a>;
<a name="l03208"></a>03208 
<a name="l03209"></a>03209  start:
<a name="l03210"></a>03210   <span class="keywordflow">if</span> (<a class="code" href="../../d6/dda/regparse_8c.html#a43ce1d83d1961694adc2dfcbfac7d690">PEND</a>) {
<a name="l03211"></a>03211     tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#a46f3343f204ac67de13f0a774284e476">type</a> = <a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250da4b2acbe6a651813a07506f06d624ac3b">TK_EOT</a>;
<a name="l03212"></a>03212     <span class="keywordflow">return</span> tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#a46f3343f204ac67de13f0a774284e476">type</a>;
<a name="l03213"></a>03213   }
<a name="l03214"></a>03214 
<a name="l03215"></a>03215   tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#a46f3343f204ac67de13f0a774284e476">type</a>  = <a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250da2f748d118b4a20e2b1dc12538ccd9876">TK_STRING</a>;
<a name="l03216"></a>03216   tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#a938bb7f9e071e3c6ce68480e3138a0cc">base</a>  = 0;
<a name="l03217"></a>03217   tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#accba0041ec257e1619caefea1ea12d10">backp</a> = p;
<a name="l03218"></a>03218 
<a name="l03219"></a>03219   <a class="code" href="../../d6/dda/regparse_8c.html#a8a8898c873b81a88454a968371696cab">PFETCH</a>(c);
<a name="l03220"></a>03220   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d87/regint_8h.html#a07b129e546e7cd1e765dc7f397b699dc">IS_MC_ESC_CODE</a>(c, syn)) {
<a name="l03221"></a>03221     <span class="keywordflow">if</span> (<a class="code" href="../../d6/dda/regparse_8c.html#a43ce1d83d1961694adc2dfcbfac7d690">PEND</a>) <span class="keywordflow">return</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#a50a1adafbee790867a48752a1093444b">ONIGERR_END_PATTERN_AT_ESCAPE</a>;
<a name="l03222"></a>03222 
<a name="l03223"></a>03223     tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#accba0041ec257e1619caefea1ea12d10">backp</a> = p;
<a name="l03224"></a>03224     <a class="code" href="../../d6/dda/regparse_8c.html#a8a8898c873b81a88454a968371696cab">PFETCH</a>(c);
<a name="l03225"></a>03225 
<a name="l03226"></a>03226     tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#aaea3a0bd5a46ef32e4a9552046a070b3">u</a>.<a class="code" href="../../d0/d80/struct_onig_token.html#ac1f4ee5fa57d7ebbfa95642148efe0f5">c</a> = c;
<a name="l03227"></a>03227     tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#a71ac92059fef31b2d7932d04523f8c17">escaped</a> = 1;
<a name="l03228"></a>03228     <span class="keywordflow">switch</span> (c) {
<a name="l03229"></a>03229     <span class="keywordflow">case</span> <span class="charliteral">&apos;*&apos;</span>:
<a name="l03230"></a>03230       <span class="keywordflow">if</span> (! <a class="code" href="../../d1/dfc/regparse_8h.html#aeeb7aa0f60553ade62b7338e8f21256b">IS_SYNTAX_OP</a>(syn, <a class="code" href="../../d8/db3/oniguruma_8h.html#ae19b45b92074982f1b9b5d08d001d38e">ONIG_SYN_OP_ESC_ASTERISK_ZERO_INF</a>)) <span class="keywordflow">break</span>;
<a name="l03231"></a>03231       tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#a46f3343f204ac67de13f0a774284e476">type</a> = <a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250daef6e175c79d6876bc5d93d82c1d13eb8">TK_OP_REPEAT</a>;
<a name="l03232"></a>03232       tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#aaea3a0bd5a46ef32e4a9552046a070b3">u</a>.<a class="code" href="../../d0/d80/struct_onig_token.html#a7ff69fe23d1d3da2bfd163c760ef4e44">repeat</a>.lower = 0;
<a name="l03233"></a>03233       tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#aaea3a0bd5a46ef32e4a9552046a070b3">u</a>.<a class="code" href="../../d0/d80/struct_onig_token.html#a7ff69fe23d1d3da2bfd163c760ef4e44">repeat</a>.upper = <a class="code" href="../../d6/d87/regint_8h.html#aaaf8d5e1b9d204ddb0b681077890b01f">REPEAT_INFINITE</a>;
<a name="l03234"></a>03234       <span class="keywordflow">goto</span> greedy_check;
<a name="l03235"></a>03235       <span class="keywordflow">break</span>;
<a name="l03236"></a>03236 
<a name="l03237"></a>03237     <span class="keywordflow">case</span> <span class="charliteral">&apos;+&apos;</span>:
<a name="l03238"></a>03238       <span class="keywordflow">if</span> (! <a class="code" href="../../d1/dfc/regparse_8h.html#aeeb7aa0f60553ade62b7338e8f21256b">IS_SYNTAX_OP</a>(syn, <a class="code" href="../../d8/db3/oniguruma_8h.html#acf27ec654602e6cd31635d912d9a3e4b">ONIG_SYN_OP_ESC_PLUS_ONE_INF</a>)) <span class="keywordflow">break</span>;
<a name="l03239"></a>03239       tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#a46f3343f204ac67de13f0a774284e476">type</a> = <a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250daef6e175c79d6876bc5d93d82c1d13eb8">TK_OP_REPEAT</a>;
<a name="l03240"></a>03240       tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#aaea3a0bd5a46ef32e4a9552046a070b3">u</a>.<a class="code" href="../../d0/d80/struct_onig_token.html#a7ff69fe23d1d3da2bfd163c760ef4e44">repeat</a>.lower = 1;
<a name="l03241"></a>03241       tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#aaea3a0bd5a46ef32e4a9552046a070b3">u</a>.<a class="code" href="../../d0/d80/struct_onig_token.html#a7ff69fe23d1d3da2bfd163c760ef4e44">repeat</a>.upper = <a class="code" href="../../d6/d87/regint_8h.html#aaaf8d5e1b9d204ddb0b681077890b01f">REPEAT_INFINITE</a>;
<a name="l03242"></a>03242       <span class="keywordflow">goto</span> greedy_check;
<a name="l03243"></a>03243       <span class="keywordflow">break</span>;
<a name="l03244"></a>03244 
<a name="l03245"></a>03245     <span class="keywordflow">case</span> <span class="charliteral">&apos;?&apos;</span>:
<a name="l03246"></a>03246       <span class="keywordflow">if</span> (! <a class="code" href="../../d1/dfc/regparse_8h.html#aeeb7aa0f60553ade62b7338e8f21256b">IS_SYNTAX_OP</a>(syn, <a class="code" href="../../d8/db3/oniguruma_8h.html#a8f95d0164b27581caa2140db71006512">ONIG_SYN_OP_ESC_QMARK_ZERO_ONE</a>)) <span class="keywordflow">break</span>;
<a name="l03247"></a>03247       tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#a46f3343f204ac67de13f0a774284e476">type</a> = <a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250daef6e175c79d6876bc5d93d82c1d13eb8">TK_OP_REPEAT</a>;
<a name="l03248"></a>03248       tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#aaea3a0bd5a46ef32e4a9552046a070b3">u</a>.<a class="code" href="../../d0/d80/struct_onig_token.html#a7ff69fe23d1d3da2bfd163c760ef4e44">repeat</a>.lower = 0;
<a name="l03249"></a>03249       tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#aaea3a0bd5a46ef32e4a9552046a070b3">u</a>.<a class="code" href="../../d0/d80/struct_onig_token.html#a7ff69fe23d1d3da2bfd163c760ef4e44">repeat</a>.upper = 1;
<a name="l03250"></a>03250     greedy_check:
<a name="l03251"></a>03251       <span class="keywordflow">if</span> (!<a class="code" href="../../d6/dda/regparse_8c.html#a43ce1d83d1961694adc2dfcbfac7d690">PEND</a> &amp;&amp; <a class="code" href="../../d6/dda/regparse_8c.html#a4ed53b7baf65c82f4ba37027979ed82d">PPEEK_IS</a>(<span class="charliteral">&apos;?&apos;</span>) &amp;&amp;
<a name="l03252"></a>03252           <a class="code" href="../../d1/dfc/regparse_8h.html#aeeb7aa0f60553ade62b7338e8f21256b">IS_SYNTAX_OP</a>(syn, <a class="code" href="../../d8/db3/oniguruma_8h.html#a15002f2065623821c390b05a3891f235">ONIG_SYN_OP_QMARK_NON_GREEDY</a>)) {
<a name="l03253"></a>03253         <a class="code" href="../../d6/dda/regparse_8c.html#a8a8898c873b81a88454a968371696cab">PFETCH</a>(c);
<a name="l03254"></a>03254         tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#aaea3a0bd5a46ef32e4a9552046a070b3">u</a>.<a class="code" href="../../d0/d80/struct_onig_token.html#a7ff69fe23d1d3da2bfd163c760ef4e44">repeat</a>.greedy     = 0;
<a name="l03255"></a>03255         tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#aaea3a0bd5a46ef32e4a9552046a070b3">u</a>.<a class="code" href="../../d0/d80/struct_onig_token.html#a7ff69fe23d1d3da2bfd163c760ef4e44">repeat</a>.possessive = 0;
<a name="l03256"></a>03256       }
<a name="l03257"></a>03257       <span class="keywordflow">else</span> {
<a name="l03258"></a>03258       possessive_check:
<a name="l03259"></a>03259         <span class="keywordflow">if</span> (!<a class="code" href="../../d6/dda/regparse_8c.html#a43ce1d83d1961694adc2dfcbfac7d690">PEND</a> &amp;&amp; <a class="code" href="../../d6/dda/regparse_8c.html#a4ed53b7baf65c82f4ba37027979ed82d">PPEEK_IS</a>(<span class="charliteral">&apos;+&apos;</span>) &amp;&amp;
<a name="l03260"></a>03260             ((<a class="code" href="../../d1/dfc/regparse_8h.html#a2ff963239e972932cefd5adaae161e76">IS_SYNTAX_OP2</a>(syn, <a class="code" href="../../d8/db3/oniguruma_8h.html#a966dc399c5f4a319a9242034b81a60d5">ONIG_SYN_OP2_PLUS_POSSESSIVE_REPEAT</a>) &amp;&amp;
<a name="l03261"></a>03261               tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#a46f3343f204ac67de13f0a774284e476">type</a> != <a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250da6d79c0cbba40a10a9d6790b9b874c833">TK_INTERVAL</a>)  ||
<a name="l03262"></a>03262              (<a class="code" href="../../d1/dfc/regparse_8h.html#a2ff963239e972932cefd5adaae161e76">IS_SYNTAX_OP2</a>(syn, <a class="code" href="../../d8/db3/oniguruma_8h.html#a6f1d5a837bcb4382295f52ccde2c422e">ONIG_SYN_OP2_PLUS_POSSESSIVE_INTERVAL</a>) &amp;&amp;
<a name="l03263"></a>03263               tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#a46f3343f204ac67de13f0a774284e476">type</a> == <a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250da6d79c0cbba40a10a9d6790b9b874c833">TK_INTERVAL</a>))) {
<a name="l03264"></a>03264           <a class="code" href="../../d6/dda/regparse_8c.html#a8a8898c873b81a88454a968371696cab">PFETCH</a>(c);
<a name="l03265"></a>03265           tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#aaea3a0bd5a46ef32e4a9552046a070b3">u</a>.<a class="code" href="../../d0/d80/struct_onig_token.html#a7ff69fe23d1d3da2bfd163c760ef4e44">repeat</a>.greedy     = 1;
<a name="l03266"></a>03266           tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#aaea3a0bd5a46ef32e4a9552046a070b3">u</a>.<a class="code" href="../../d0/d80/struct_onig_token.html#a7ff69fe23d1d3da2bfd163c760ef4e44">repeat</a>.possessive = 1;
<a name="l03267"></a>03267         }
<a name="l03268"></a>03268         <span class="keywordflow">else</span> {
<a name="l03269"></a>03269           tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#aaea3a0bd5a46ef32e4a9552046a070b3">u</a>.<a class="code" href="../../d0/d80/struct_onig_token.html#a7ff69fe23d1d3da2bfd163c760ef4e44">repeat</a>.greedy     = 1;
<a name="l03270"></a>03270           tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#aaea3a0bd5a46ef32e4a9552046a070b3">u</a>.<a class="code" href="../../d0/d80/struct_onig_token.html#a7ff69fe23d1d3da2bfd163c760ef4e44">repeat</a>.possessive = 0;
<a name="l03271"></a>03271         }
<a name="l03272"></a>03272       }
<a name="l03273"></a>03273       <span class="keywordflow">break</span>;
<a name="l03274"></a>03274 
<a name="l03275"></a>03275     <span class="keywordflow">case</span> <span class="charliteral">&apos;{&apos;</span>:
<a name="l03276"></a>03276       <span class="keywordflow">if</span> (! <a class="code" href="../../d1/dfc/regparse_8h.html#aeeb7aa0f60553ade62b7338e8f21256b">IS_SYNTAX_OP</a>(syn, <a class="code" href="../../d8/db3/oniguruma_8h.html#a306fbba82db69fd6d8d53c8d048611e8">ONIG_SYN_OP_ESC_BRACE_INTERVAL</a>)) <span class="keywordflow">break</span>;
<a name="l03277"></a>03277       r = <a class="code" href="../../d6/dda/regparse_8c.html#a9b58f1c872c08ae8838728d04f14463d">fetch_range_quantifier</a>(&amp;p, end, tok, env);
<a name="l03278"></a>03278       <span class="keywordflow">if</span> (r &lt; 0) <span class="keywordflow">return</span> r;  <span class="comment">/* error */</span>
<a name="l03279"></a>03279       <span class="keywordflow">if</span> (r == 0) <span class="keywordflow">goto</span> greedy_check;
<a name="l03280"></a>03280       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (r == 2) { <span class="comment">/* {n} */</span>
<a name="l03281"></a>03281         <span class="keywordflow">if</span> (<a class="code" href="../../d1/dfc/regparse_8h.html#a18bfc9ee154d6dd516347bd71b4810f6">IS_SYNTAX_BV</a>(syn, <a class="code" href="../../d8/db3/oniguruma_8h.html#a269f5fa639cd57a23b0333cd062911be">ONIG_SYN_FIXED_INTERVAL_IS_GREEDY_ONLY</a>))
<a name="l03282"></a>03282           <span class="keywordflow">goto</span> possessive_check;
<a name="l03283"></a>03283 
<a name="l03284"></a>03284         <span class="keywordflow">goto</span> greedy_check;
<a name="l03285"></a>03285       }
<a name="l03286"></a>03286       <span class="comment">/* r == 1 : normal char */</span>
<a name="l03287"></a>03287       <span class="keywordflow">break</span>;
<a name="l03288"></a>03288 
<a name="l03289"></a>03289     <span class="keywordflow">case</span> <span class="charliteral">&apos;|&apos;</span>:
<a name="l03290"></a>03290       <span class="keywordflow">if</span> (! <a class="code" href="../../d1/dfc/regparse_8h.html#aeeb7aa0f60553ade62b7338e8f21256b">IS_SYNTAX_OP</a>(syn, <a class="code" href="../../d8/db3/oniguruma_8h.html#a20f720bd5ff48bf54fcfa479ec15151f">ONIG_SYN_OP_ESC_VBAR_ALT</a>)) <span class="keywordflow">break</span>;
<a name="l03291"></a>03291       tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#a46f3343f204ac67de13f0a774284e476">type</a> = <a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250da902b0cdea9f57e86f33e1c42c38bae8a">TK_ALT</a>;
<a name="l03292"></a>03292       <span class="keywordflow">break</span>;
<a name="l03293"></a>03293 
<a name="l03294"></a>03294     <span class="keywordflow">case</span> <span class="charliteral">&apos;(&apos;</span>:
<a name="l03295"></a>03295       <span class="keywordflow">if</span> (! <a class="code" href="../../d1/dfc/regparse_8h.html#aeeb7aa0f60553ade62b7338e8f21256b">IS_SYNTAX_OP</a>(syn, <a class="code" href="../../d8/db3/oniguruma_8h.html#a2e26c525c69debe696c184f544438bb8">ONIG_SYN_OP_ESC_LPAREN_SUBEXP</a>)) <span class="keywordflow">break</span>;
<a name="l03296"></a>03296       tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#a46f3343f204ac67de13f0a774284e476">type</a> = <a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250da6d28cfb6350f8a3218170fd0f913aec3">TK_SUBEXP_OPEN</a>;
<a name="l03297"></a>03297       <span class="keywordflow">break</span>;
<a name="l03298"></a>03298 
<a name="l03299"></a>03299     <span class="keywordflow">case</span> <span class="charliteral">&apos;)&apos;</span>:
<a name="l03300"></a>03300       <span class="keywordflow">if</span> (! <a class="code" href="../../d1/dfc/regparse_8h.html#aeeb7aa0f60553ade62b7338e8f21256b">IS_SYNTAX_OP</a>(syn, <a class="code" href="../../d8/db3/oniguruma_8h.html#a2e26c525c69debe696c184f544438bb8">ONIG_SYN_OP_ESC_LPAREN_SUBEXP</a>)) <span class="keywordflow">break</span>;
<a name="l03301"></a>03301       tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#a46f3343f204ac67de13f0a774284e476">type</a> = <a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250da2abb18f0f4ef734b4ce575c044b4e1e7">TK_SUBEXP_CLOSE</a>;
<a name="l03302"></a>03302       <span class="keywordflow">break</span>;
<a name="l03303"></a>03303 
<a name="l03304"></a>03304     <span class="keywordflow">case</span> <span class="charliteral">&apos;w&apos;</span>:
<a name="l03305"></a>03305       <span class="keywordflow">if</span> (! <a class="code" href="../../d1/dfc/regparse_8h.html#aeeb7aa0f60553ade62b7338e8f21256b">IS_SYNTAX_OP</a>(syn, <a class="code" href="../../d8/db3/oniguruma_8h.html#a44bf5bf44fb8716d806ce50cc2350f68">ONIG_SYN_OP_ESC_W_WORD</a>)) <span class="keywordflow">break</span>;
<a name="l03306"></a>03306       tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#a46f3343f204ac67de13f0a774284e476">type</a> = <a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250da664a7e468d295958edd0864e4f3cf461">TK_CHAR_TYPE</a>;
<a name="l03307"></a>03307       tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#aaea3a0bd5a46ef32e4a9552046a070b3">u</a>.<a class="code" href="../../d0/d80/struct_onig_token.html#a84f464445695ec0d70cdc5f02db11833">prop</a>.ctype = <a class="code" href="../../d8/db3/oniguruma_8h.html#aaf70c7a1261acd2f76a4db97af5b3226">ONIGENC_CTYPE_W</a>;
<a name="l03308"></a>03308       tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#aaea3a0bd5a46ef32e4a9552046a070b3">u</a>.<a class="code" href="../../d0/d80/struct_onig_token.html#a84f464445695ec0d70cdc5f02db11833">prop</a>.not   = 0;
<a name="l03309"></a>03309       <span class="keywordflow">break</span>;
<a name="l03310"></a>03310 
<a name="l03311"></a>03311     <span class="keywordflow">case</span> <span class="charliteral">&apos;W&apos;</span>:
<a name="l03312"></a>03312       <span class="keywordflow">if</span> (! <a class="code" href="../../d1/dfc/regparse_8h.html#aeeb7aa0f60553ade62b7338e8f21256b">IS_SYNTAX_OP</a>(syn, <a class="code" href="../../d8/db3/oniguruma_8h.html#a44bf5bf44fb8716d806ce50cc2350f68">ONIG_SYN_OP_ESC_W_WORD</a>)) <span class="keywordflow">break</span>;
<a name="l03313"></a>03313       tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#a46f3343f204ac67de13f0a774284e476">type</a> = <a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250da664a7e468d295958edd0864e4f3cf461">TK_CHAR_TYPE</a>;
<a name="l03314"></a>03314       tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#aaea3a0bd5a46ef32e4a9552046a070b3">u</a>.<a class="code" href="../../d0/d80/struct_onig_token.html#a84f464445695ec0d70cdc5f02db11833">prop</a>.ctype = <a class="code" href="../../d8/db3/oniguruma_8h.html#aaf70c7a1261acd2f76a4db97af5b3226">ONIGENC_CTYPE_W</a>;
<a name="l03315"></a>03315       tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#aaea3a0bd5a46ef32e4a9552046a070b3">u</a>.<a class="code" href="../../d0/d80/struct_onig_token.html#a84f464445695ec0d70cdc5f02db11833">prop</a>.not   = 1;
<a name="l03316"></a>03316       <span class="keywordflow">break</span>;
<a name="l03317"></a>03317 
<a name="l03318"></a>03318     <span class="keywordflow">case</span> <span class="charliteral">&apos;b&apos;</span>:
<a name="l03319"></a>03319       <span class="keywordflow">if</span> (! <a class="code" href="../../d1/dfc/regparse_8h.html#aeeb7aa0f60553ade62b7338e8f21256b">IS_SYNTAX_OP</a>(syn, <a class="code" href="../../d8/db3/oniguruma_8h.html#a3eaf0e0a1afee9ed6e168dcbf94e45a7">ONIG_SYN_OP_ESC_B_WORD_BOUND</a>)) <span class="keywordflow">break</span>;
<a name="l03320"></a>03320       tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#a46f3343f204ac67de13f0a774284e476">type</a> = <a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250da35870f30489b8c9a3dc0c7197b8e880b">TK_ANCHOR</a>;
<a name="l03321"></a>03321       tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#aaea3a0bd5a46ef32e4a9552046a070b3">u</a>.<a class="code" href="../../d0/d80/struct_onig_token.html#a8f7fd17d715a4ce24540eef7b411ec62">anchor</a> = <a class="code" href="../../d6/d87/regint_8h.html#a5963eb85b5d3cfaecc1425010a2e4357">ANCHOR_WORD_BOUND</a>;
<a name="l03322"></a>03322       <span class="keywordflow">break</span>;
<a name="l03323"></a>03323 
<a name="l03324"></a>03324     <span class="keywordflow">case</span> <span class="charliteral">&apos;B&apos;</span>:
<a name="l03325"></a>03325       <span class="keywordflow">if</span> (! <a class="code" href="../../d1/dfc/regparse_8h.html#aeeb7aa0f60553ade62b7338e8f21256b">IS_SYNTAX_OP</a>(syn, <a class="code" href="../../d8/db3/oniguruma_8h.html#a3eaf0e0a1afee9ed6e168dcbf94e45a7">ONIG_SYN_OP_ESC_B_WORD_BOUND</a>)) <span class="keywordflow">break</span>;
<a name="l03326"></a>03326       tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#a46f3343f204ac67de13f0a774284e476">type</a> = <a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250da35870f30489b8c9a3dc0c7197b8e880b">TK_ANCHOR</a>;
<a name="l03327"></a>03327       tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#aaea3a0bd5a46ef32e4a9552046a070b3">u</a>.<a class="code" href="../../d0/d80/struct_onig_token.html#a8f7fd17d715a4ce24540eef7b411ec62">anchor</a> = <a class="code" href="../../d6/d87/regint_8h.html#ab1e3503037b2e8094b2f66a32fc40683">ANCHOR_NOT_WORD_BOUND</a>;
<a name="l03328"></a>03328       <span class="keywordflow">break</span>;
<a name="l03329"></a>03329 
<a name="l03330"></a>03330 <span class="preprocessor">#ifdef USE_WORD_BEGIN_END</span>
<a name="l03331"></a>03331 <span class="preprocessor"></span>    <span class="keywordflow">case</span> <span class="charliteral">&apos;&lt;&apos;</span>:
<a name="l03332"></a>03332       <span class="keywordflow">if</span> (! <a class="code" href="../../d1/dfc/regparse_8h.html#aeeb7aa0f60553ade62b7338e8f21256b">IS_SYNTAX_OP</a>(syn, <a class="code" href="../../d8/db3/oniguruma_8h.html#a2cf4189198916ecf90fe9f51e8d55f64">ONIG_SYN_OP_ESC_LTGT_WORD_BEGIN_END</a>)) <span class="keywordflow">break</span>;
<a name="l03333"></a>03333       tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#a46f3343f204ac67de13f0a774284e476">type</a> = <a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250da35870f30489b8c9a3dc0c7197b8e880b">TK_ANCHOR</a>;
<a name="l03334"></a>03334       tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#aaea3a0bd5a46ef32e4a9552046a070b3">u</a>.<a class="code" href="../../d0/d80/struct_onig_token.html#a8f7fd17d715a4ce24540eef7b411ec62">anchor</a> = <a class="code" href="../../d6/d87/regint_8h.html#a6f3c15a0c4744c9125d79f1f157c4c05">ANCHOR_WORD_BEGIN</a>;
<a name="l03335"></a>03335       <span class="keywordflow">break</span>;
<a name="l03336"></a>03336 
<a name="l03337"></a>03337     <span class="keywordflow">case</span> <span class="charliteral">&apos;&gt;&apos;</span>:
<a name="l03338"></a>03338       <span class="keywordflow">if</span> (! <a class="code" href="../../d1/dfc/regparse_8h.html#aeeb7aa0f60553ade62b7338e8f21256b">IS_SYNTAX_OP</a>(syn, <a class="code" href="../../d8/db3/oniguruma_8h.html#a2cf4189198916ecf90fe9f51e8d55f64">ONIG_SYN_OP_ESC_LTGT_WORD_BEGIN_END</a>)) <span class="keywordflow">break</span>;
<a name="l03339"></a>03339       tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#a46f3343f204ac67de13f0a774284e476">type</a> = <a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250da35870f30489b8c9a3dc0c7197b8e880b">TK_ANCHOR</a>;
<a name="l03340"></a>03340       tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#aaea3a0bd5a46ef32e4a9552046a070b3">u</a>.<a class="code" href="../../d0/d80/struct_onig_token.html#a8f7fd17d715a4ce24540eef7b411ec62">anchor</a> = <a class="code" href="../../d6/d87/regint_8h.html#afa94e4bc6eced6f5f03a444e5e3d2d84">ANCHOR_WORD_END</a>;
<a name="l03341"></a>03341       <span class="keywordflow">break</span>;
<a name="l03342"></a>03342 <span class="preprocessor">#endif</span>
<a name="l03343"></a>03343 <span class="preprocessor"></span>
<a name="l03344"></a>03344     <span class="keywordflow">case</span> <span class="charliteral">&apos;s&apos;</span>:
<a name="l03345"></a>03345       <span class="keywordflow">if</span> (! <a class="code" href="../../d1/dfc/regparse_8h.html#aeeb7aa0f60553ade62b7338e8f21256b">IS_SYNTAX_OP</a>(syn, <a class="code" href="../../d8/db3/oniguruma_8h.html#ab94b0f2b32fab995bb98c72aad04f8f2">ONIG_SYN_OP_ESC_S_WHITE_SPACE</a>)) <span class="keywordflow">break</span>;
<a name="l03346"></a>03346       tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#a46f3343f204ac67de13f0a774284e476">type</a> = <a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250da664a7e468d295958edd0864e4f3cf461">TK_CHAR_TYPE</a>;
<a name="l03347"></a>03347       tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#aaea3a0bd5a46ef32e4a9552046a070b3">u</a>.<a class="code" href="../../d0/d80/struct_onig_token.html#a84f464445695ec0d70cdc5f02db11833">prop</a>.ctype = <a class="code" href="../../d8/db3/oniguruma_8h.html#a8613b809ebb0533177db19ceb9eff366">ONIGENC_CTYPE_S</a>;
<a name="l03348"></a>03348       tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#aaea3a0bd5a46ef32e4a9552046a070b3">u</a>.<a class="code" href="../../d0/d80/struct_onig_token.html#a84f464445695ec0d70cdc5f02db11833">prop</a>.not   = 0;
<a name="l03349"></a>03349       <span class="keywordflow">break</span>;
<a name="l03350"></a>03350 
<a name="l03351"></a>03351     <span class="keywordflow">case</span> <span class="charliteral">&apos;S&apos;</span>:
<a name="l03352"></a>03352       <span class="keywordflow">if</span> (! <a class="code" href="../../d1/dfc/regparse_8h.html#aeeb7aa0f60553ade62b7338e8f21256b">IS_SYNTAX_OP</a>(syn, <a class="code" href="../../d8/db3/oniguruma_8h.html#ab94b0f2b32fab995bb98c72aad04f8f2">ONIG_SYN_OP_ESC_S_WHITE_SPACE</a>)) <span class="keywordflow">break</span>;
<a name="l03353"></a>03353       tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#a46f3343f204ac67de13f0a774284e476">type</a> = <a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250da664a7e468d295958edd0864e4f3cf461">TK_CHAR_TYPE</a>;
<a name="l03354"></a>03354       tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#aaea3a0bd5a46ef32e4a9552046a070b3">u</a>.<a class="code" href="../../d0/d80/struct_onig_token.html#a84f464445695ec0d70cdc5f02db11833">prop</a>.ctype = <a class="code" href="../../d8/db3/oniguruma_8h.html#a8613b809ebb0533177db19ceb9eff366">ONIGENC_CTYPE_S</a>;
<a name="l03355"></a>03355       tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#aaea3a0bd5a46ef32e4a9552046a070b3">u</a>.<a class="code" href="../../d0/d80/struct_onig_token.html#a84f464445695ec0d70cdc5f02db11833">prop</a>.not   = 1;
<a name="l03356"></a>03356       <span class="keywordflow">break</span>;
<a name="l03357"></a>03357 
<a name="l03358"></a>03358     <span class="keywordflow">case</span> <span class="charliteral">&apos;d&apos;</span>:
<a name="l03359"></a>03359       <span class="keywordflow">if</span> (! <a class="code" href="../../d1/dfc/regparse_8h.html#aeeb7aa0f60553ade62b7338e8f21256b">IS_SYNTAX_OP</a>(syn, <a class="code" href="../../d8/db3/oniguruma_8h.html#ab211c273d9ff094354f83a8c9af80115">ONIG_SYN_OP_ESC_D_DIGIT</a>)) <span class="keywordflow">break</span>;
<a name="l03360"></a>03360       tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#a46f3343f204ac67de13f0a774284e476">type</a> = <a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250da664a7e468d295958edd0864e4f3cf461">TK_CHAR_TYPE</a>;
<a name="l03361"></a>03361       tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#aaea3a0bd5a46ef32e4a9552046a070b3">u</a>.<a class="code" href="../../d0/d80/struct_onig_token.html#a84f464445695ec0d70cdc5f02db11833">prop</a>.ctype = <a class="code" href="../../d8/db3/oniguruma_8h.html#a4878161b7a1adcf807bcff0a8722e778">ONIGENC_CTYPE_D</a>;
<a name="l03362"></a>03362       tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#aaea3a0bd5a46ef32e4a9552046a070b3">u</a>.<a class="code" href="../../d0/d80/struct_onig_token.html#a84f464445695ec0d70cdc5f02db11833">prop</a>.not   = 0;
<a name="l03363"></a>03363       <span class="keywordflow">break</span>;
<a name="l03364"></a>03364 
<a name="l03365"></a>03365     <span class="keywordflow">case</span> <span class="charliteral">&apos;D&apos;</span>:
<a name="l03366"></a>03366       <span class="keywordflow">if</span> (! <a class="code" href="../../d1/dfc/regparse_8h.html#aeeb7aa0f60553ade62b7338e8f21256b">IS_SYNTAX_OP</a>(syn, <a class="code" href="../../d8/db3/oniguruma_8h.html#ab211c273d9ff094354f83a8c9af80115">ONIG_SYN_OP_ESC_D_DIGIT</a>)) <span class="keywordflow">break</span>;
<a name="l03367"></a>03367       tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#a46f3343f204ac67de13f0a774284e476">type</a> = <a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250da664a7e468d295958edd0864e4f3cf461">TK_CHAR_TYPE</a>;
<a name="l03368"></a>03368       tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#aaea3a0bd5a46ef32e4a9552046a070b3">u</a>.<a class="code" href="../../d0/d80/struct_onig_token.html#a84f464445695ec0d70cdc5f02db11833">prop</a>.ctype = <a class="code" href="../../d8/db3/oniguruma_8h.html#a4878161b7a1adcf807bcff0a8722e778">ONIGENC_CTYPE_D</a>;
<a name="l03369"></a>03369       tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#aaea3a0bd5a46ef32e4a9552046a070b3">u</a>.<a class="code" href="../../d0/d80/struct_onig_token.html#a84f464445695ec0d70cdc5f02db11833">prop</a>.not   = 1;
<a name="l03370"></a>03370       <span class="keywordflow">break</span>;
<a name="l03371"></a>03371 
<a name="l03372"></a>03372     <span class="keywordflow">case</span> <span class="charliteral">&apos;h&apos;</span>:
<a name="l03373"></a>03373       <span class="keywordflow">if</span> (! <a class="code" href="../../d1/dfc/regparse_8h.html#a2ff963239e972932cefd5adaae161e76">IS_SYNTAX_OP2</a>(syn, <a class="code" href="../../d8/db3/oniguruma_8h.html#a9dbad596d7c30d8a2ba5e59d07dc1827">ONIG_SYN_OP2_ESC_H_XDIGIT</a>)) <span class="keywordflow">break</span>;
<a name="l03374"></a>03374       tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#a46f3343f204ac67de13f0a774284e476">type</a> = <a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250da664a7e468d295958edd0864e4f3cf461">TK_CHAR_TYPE</a>;
<a name="l03375"></a>03375       tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#aaea3a0bd5a46ef32e4a9552046a070b3">u</a>.<a class="code" href="../../d0/d80/struct_onig_token.html#a84f464445695ec0d70cdc5f02db11833">prop</a>.ctype = <a class="code" href="../../d8/db3/oniguruma_8h.html#a2964cbf76712be02ed2d0f07e4b8386e">ONIGENC_CTYPE_XDIGIT</a>;
<a name="l03376"></a>03376       tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#aaea3a0bd5a46ef32e4a9552046a070b3">u</a>.<a class="code" href="../../d0/d80/struct_onig_token.html#a84f464445695ec0d70cdc5f02db11833">prop</a>.not   = 0;
<a name="l03377"></a>03377       <span class="keywordflow">break</span>;
<a name="l03378"></a>03378 
<a name="l03379"></a>03379     <span class="keywordflow">case</span> <span class="charliteral">&apos;H&apos;</span>:
<a name="l03380"></a>03380       <span class="keywordflow">if</span> (! <a class="code" href="../../d1/dfc/regparse_8h.html#a2ff963239e972932cefd5adaae161e76">IS_SYNTAX_OP2</a>(syn, <a class="code" href="../../d8/db3/oniguruma_8h.html#a9dbad596d7c30d8a2ba5e59d07dc1827">ONIG_SYN_OP2_ESC_H_XDIGIT</a>)) <span class="keywordflow">break</span>;
<a name="l03381"></a>03381       tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#a46f3343f204ac67de13f0a774284e476">type</a> = <a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250da664a7e468d295958edd0864e4f3cf461">TK_CHAR_TYPE</a>;
<a name="l03382"></a>03382       tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#aaea3a0bd5a46ef32e4a9552046a070b3">u</a>.<a class="code" href="../../d0/d80/struct_onig_token.html#a84f464445695ec0d70cdc5f02db11833">prop</a>.ctype = <a class="code" href="../../d8/db3/oniguruma_8h.html#a2964cbf76712be02ed2d0f07e4b8386e">ONIGENC_CTYPE_XDIGIT</a>;
<a name="l03383"></a>03383       tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#aaea3a0bd5a46ef32e4a9552046a070b3">u</a>.<a class="code" href="../../d0/d80/struct_onig_token.html#a84f464445695ec0d70cdc5f02db11833">prop</a>.not   = 1;
<a name="l03384"></a>03384       <span class="keywordflow">break</span>;
<a name="l03385"></a>03385 
<a name="l03386"></a>03386     <span class="keywordflow">case</span> <span class="charliteral">&apos;A&apos;</span>:
<a name="l03387"></a>03387       <span class="keywordflow">if</span> (! <a class="code" href="../../d1/dfc/regparse_8h.html#aeeb7aa0f60553ade62b7338e8f21256b">IS_SYNTAX_OP</a>(syn, <a class="code" href="../../d8/db3/oniguruma_8h.html#a4cfd7581afcbcde747ab88344db724e4">ONIG_SYN_OP_ESC_AZ_BUF_ANCHOR</a>)) <span class="keywordflow">break</span>;
<a name="l03388"></a>03388     begin_buf:
<a name="l03389"></a>03389       tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#a46f3343f204ac67de13f0a774284e476">type</a> = <a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250da35870f30489b8c9a3dc0c7197b8e880b">TK_ANCHOR</a>;
<a name="l03390"></a>03390       tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#aaea3a0bd5a46ef32e4a9552046a070b3">u</a>.<a class="code" href="../../d0/d80/struct_onig_token.html#a35c9bc2e550c33f1909fa430fa3e7733">subtype</a> = <a class="code" href="../../d6/d87/regint_8h.html#a5730b2ca5b8a8bbe5262c77ee26b7879">ANCHOR_BEGIN_BUF</a>;
<a name="l03391"></a>03391       <span class="keywordflow">break</span>;
<a name="l03392"></a>03392 
<a name="l03393"></a>03393     <span class="keywordflow">case</span> <span class="charliteral">&apos;Z&apos;</span>:
<a name="l03394"></a>03394       <span class="keywordflow">if</span> (! <a class="code" href="../../d1/dfc/regparse_8h.html#aeeb7aa0f60553ade62b7338e8f21256b">IS_SYNTAX_OP</a>(syn, <a class="code" href="../../d8/db3/oniguruma_8h.html#a4cfd7581afcbcde747ab88344db724e4">ONIG_SYN_OP_ESC_AZ_BUF_ANCHOR</a>)) <span class="keywordflow">break</span>;
<a name="l03395"></a>03395       tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#a46f3343f204ac67de13f0a774284e476">type</a> = <a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250da35870f30489b8c9a3dc0c7197b8e880b">TK_ANCHOR</a>;
<a name="l03396"></a>03396       tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#aaea3a0bd5a46ef32e4a9552046a070b3">u</a>.<a class="code" href="../../d0/d80/struct_onig_token.html#a35c9bc2e550c33f1909fa430fa3e7733">subtype</a> = <a class="code" href="../../d6/d87/regint_8h.html#a9336254890d4656b7e36574b462ca093">ANCHOR_SEMI_END_BUF</a>;
<a name="l03397"></a>03397       <span class="keywordflow">break</span>;
<a name="l03398"></a>03398 
<a name="l03399"></a>03399     <span class="keywordflow">case</span> <span class="charliteral">&apos;z&apos;</span>:
<a name="l03400"></a>03400       <span class="keywordflow">if</span> (! <a class="code" href="../../d1/dfc/regparse_8h.html#aeeb7aa0f60553ade62b7338e8f21256b">IS_SYNTAX_OP</a>(syn, <a class="code" href="../../d8/db3/oniguruma_8h.html#a4cfd7581afcbcde747ab88344db724e4">ONIG_SYN_OP_ESC_AZ_BUF_ANCHOR</a>)) <span class="keywordflow">break</span>;
<a name="l03401"></a>03401     end_buf:
<a name="l03402"></a>03402       tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#a46f3343f204ac67de13f0a774284e476">type</a> = <a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250da35870f30489b8c9a3dc0c7197b8e880b">TK_ANCHOR</a>;
<a name="l03403"></a>03403       tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#aaea3a0bd5a46ef32e4a9552046a070b3">u</a>.<a class="code" href="../../d0/d80/struct_onig_token.html#a35c9bc2e550c33f1909fa430fa3e7733">subtype</a> = <a class="code" href="../../d6/d87/regint_8h.html#afae1199ac99483eb29f0824cea7b3329">ANCHOR_END_BUF</a>;
<a name="l03404"></a>03404       <span class="keywordflow">break</span>;
<a name="l03405"></a>03405 
<a name="l03406"></a>03406     <span class="keywordflow">case</span> <span class="charliteral">&apos;G&apos;</span>:
<a name="l03407"></a>03407       <span class="keywordflow">if</span> (! <a class="code" href="../../d1/dfc/regparse_8h.html#aeeb7aa0f60553ade62b7338e8f21256b">IS_SYNTAX_OP</a>(syn, <a class="code" href="../../d8/db3/oniguruma_8h.html#accd6fb819ca7cacaa919eab7ff958e78">ONIG_SYN_OP_ESC_CAPITAL_G_BEGIN_ANCHOR</a>)) <span class="keywordflow">break</span>;
<a name="l03408"></a>03408       tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#a46f3343f204ac67de13f0a774284e476">type</a> = <a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250da35870f30489b8c9a3dc0c7197b8e880b">TK_ANCHOR</a>;
<a name="l03409"></a>03409       tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#aaea3a0bd5a46ef32e4a9552046a070b3">u</a>.<a class="code" href="../../d0/d80/struct_onig_token.html#a35c9bc2e550c33f1909fa430fa3e7733">subtype</a> = <a class="code" href="../../d6/d87/regint_8h.html#a317bea7c5108d3c78717a5df263fbe09">ANCHOR_BEGIN_POSITION</a>;
<a name="l03410"></a>03410       <span class="keywordflow">break</span>;
<a name="l03411"></a>03411 
<a name="l03412"></a>03412     <span class="keywordflow">case</span> <span class="charliteral">&apos;`&apos;</span>:
<a name="l03413"></a>03413       <span class="keywordflow">if</span> (! <a class="code" href="../../d1/dfc/regparse_8h.html#a2ff963239e972932cefd5adaae161e76">IS_SYNTAX_OP2</a>(syn, <a class="code" href="../../d8/db3/oniguruma_8h.html#a23e54757ba84f9664aa13d90b71fba40">ONIG_SYN_OP2_ESC_GNU_BUF_ANCHOR</a>)) <span class="keywordflow">break</span>;
<a name="l03414"></a>03414       <span class="keywordflow">goto</span> begin_buf;
<a name="l03415"></a>03415       <span class="keywordflow">break</span>;
<a name="l03416"></a>03416 
<a name="l03417"></a>03417     <span class="keywordflow">case</span> <span class="charliteral">&apos;\&apos;&apos;</span>:
<a name="l03418"></a>03418       <span class="keywordflow">if</span> (! <a class="code" href="../../d1/dfc/regparse_8h.html#a2ff963239e972932cefd5adaae161e76">IS_SYNTAX_OP2</a>(syn, <a class="code" href="../../d8/db3/oniguruma_8h.html#a23e54757ba84f9664aa13d90b71fba40">ONIG_SYN_OP2_ESC_GNU_BUF_ANCHOR</a>)) <span class="keywordflow">break</span>;
<a name="l03419"></a>03419       <span class="keywordflow">goto</span> end_buf;
<a name="l03420"></a>03420       <span class="keywordflow">break</span>;
<a name="l03421"></a>03421 
<a name="l03422"></a>03422     <span class="keywordflow">case</span> <span class="charliteral">&apos;x&apos;</span>:
<a name="l03423"></a>03423       <span class="keywordflow">if</span> (<a class="code" href="../../d6/dda/regparse_8c.html#a43ce1d83d1961694adc2dfcbfac7d690">PEND</a>) <span class="keywordflow">break</span>;
<a name="l03424"></a>03424 
<a name="l03425"></a>03425       prev = p;
<a name="l03426"></a>03426       <span class="keywordflow">if</span> (<a class="code" href="../../d6/dda/regparse_8c.html#a4ed53b7baf65c82f4ba37027979ed82d">PPEEK_IS</a>(<span class="charliteral">&apos;{&apos;</span>) &amp;&amp; <a class="code" href="../../d1/dfc/regparse_8h.html#aeeb7aa0f60553ade62b7338e8f21256b">IS_SYNTAX_OP</a>(syn, <a class="code" href="../../d8/db3/oniguruma_8h.html#a5bedbddb8c6796ca25a1dad1154d696c">ONIG_SYN_OP_ESC_X_BRACE_HEX8</a>)) {
<a name="l03427"></a>03427         <a class="code" href="../../d6/dda/regparse_8c.html#a0545e73dc7ae14b1f62293c1feba3983">PINC</a>;
<a name="l03428"></a>03428         num = <a class="code" href="../../d6/dda/regparse_8c.html#ac28095d363fabc3f8e789710b8b41df1">scan_unsigned_hexadecimal_number</a>(&amp;p, end, 8, enc);
<a name="l03429"></a>03429         <span class="keywordflow">if</span> (num &lt; 0) <span class="keywordflow">return</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#a880878ea3cebc76ef9b37a346188fe5f">ONIGERR_TOO_BIG_WIDE_CHAR_VALUE</a>;
<a name="l03430"></a>03430         <span class="keywordflow">if</span> (!<a class="code" href="../../d6/dda/regparse_8c.html#a43ce1d83d1961694adc2dfcbfac7d690">PEND</a>) {
<a name="l03431"></a>03431           <span class="keywordflow">if</span> (<a class="code" href="../../d8/db3/oniguruma_8h.html#a4aa7f107cf374fefbc0633d94a5477a0">ONIGENC_IS_CODE_XDIGIT</a>(enc, <a class="code" href="../../d6/dda/regparse_8c.html#a337ed696ab55651d216a34abbafd4cd3">PPEEK</a>))
<a name="l03432"></a>03432             <span class="keywordflow">return</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#a5313281a8031631e132c01ee50010251">ONIGERR_TOO_LONG_WIDE_CHAR_VALUE</a>;
<a name="l03433"></a>03433         }
<a name="l03434"></a>03434 
<a name="l03435"></a>03435         <span class="keywordflow">if</span> ((p &gt; prev + <a class="code" href="../../d3/d09/ripper_8y.html#ae9f8530a4c9ec89ae8d62ce5b4410aad">enclen</a>(enc, prev, end)) &amp;&amp; !<a class="code" href="../../d6/dda/regparse_8c.html#a43ce1d83d1961694adc2dfcbfac7d690">PEND</a> &amp;&amp; <a class="code" href="../../d6/dda/regparse_8c.html#a4ed53b7baf65c82f4ba37027979ed82d">PPEEK_IS</a>(<span class="charliteral">&apos;}&apos;</span>)) {
<a name="l03436"></a>03436           <a class="code" href="../../d6/dda/regparse_8c.html#a0545e73dc7ae14b1f62293c1feba3983">PINC</a>;
<a name="l03437"></a>03437           tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#a46f3343f204ac67de13f0a774284e476">type</a>   = <a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250da7a451b3ab1e788efaa2da058c6c8b49c">TK_CODE_POINT</a>;
<a name="l03438"></a>03438           tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#aaea3a0bd5a46ef32e4a9552046a070b3">u</a>.<a class="code" href="../../d0/d80/struct_onig_token.html#a40121b0193b6bbfbf9fdb88d82f1ea7a">code</a> = (<a class="code" href="../../d8/db3/oniguruma_8h.html#a7c8a84bc12127007886efbfcf53b6fb5">OnigCodePoint</a> )num;
<a name="l03439"></a>03439         }
<a name="l03440"></a>03440         <span class="keywordflow">else</span> {
<a name="l03441"></a>03441           <span class="comment">/* can&apos;t read nothing or invalid format */</span>
<a name="l03442"></a>03442           p = prev;
<a name="l03443"></a>03443         }
<a name="l03444"></a>03444       }
<a name="l03445"></a>03445       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d1/dfc/regparse_8h.html#aeeb7aa0f60553ade62b7338e8f21256b">IS_SYNTAX_OP</a>(syn, <a class="code" href="../../d8/db3/oniguruma_8h.html#af14ad84f8fe1489439420a17287fd994">ONIG_SYN_OP_ESC_X_HEX2</a>)) {
<a name="l03446"></a>03446         num = <a class="code" href="../../d6/dda/regparse_8c.html#ac28095d363fabc3f8e789710b8b41df1">scan_unsigned_hexadecimal_number</a>(&amp;p, end, 2, enc);
<a name="l03447"></a>03447         <span class="keywordflow">if</span> (num &lt; 0) <span class="keywordflow">return</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#af6769c109e3a039fa74338b01c389c94">ONIGERR_TOO_BIG_NUMBER</a>;
<a name="l03448"></a>03448         <span class="keywordflow">if</span> (p == prev) {  <span class="comment">/* can&apos;t read nothing. */</span>
<a name="l03449"></a>03449           num = 0; <span class="comment">/* but, it&apos;s not error */</span>
<a name="l03450"></a>03450         }
<a name="l03451"></a>03451         tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#a46f3343f204ac67de13f0a774284e476">type</a> = <a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250dab0e056f20d46d5a9696dd7fdea89de88">TK_RAW_BYTE</a>;
<a name="l03452"></a>03452         tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#a938bb7f9e071e3c6ce68480e3138a0cc">base</a> = 16;
<a name="l03453"></a>03453         tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#aaea3a0bd5a46ef32e4a9552046a070b3">u</a>.<a class="code" href="../../d0/d80/struct_onig_token.html#ac1f4ee5fa57d7ebbfa95642148efe0f5">c</a>  = num;
<a name="l03454"></a>03454       }
<a name="l03455"></a>03455       <span class="keywordflow">break</span>;
<a name="l03456"></a>03456 
<a name="l03457"></a>03457     <span class="keywordflow">case</span> <span class="charliteral">&apos;u&apos;</span>:
<a name="l03458"></a>03458       <span class="keywordflow">if</span> (<a class="code" href="../../d6/dda/regparse_8c.html#a43ce1d83d1961694adc2dfcbfac7d690">PEND</a>) <span class="keywordflow">break</span>;
<a name="l03459"></a>03459 
<a name="l03460"></a>03460       prev = p;
<a name="l03461"></a>03461       <span class="keywordflow">if</span> (<a class="code" href="../../d1/dfc/regparse_8h.html#a2ff963239e972932cefd5adaae161e76">IS_SYNTAX_OP2</a>(syn, <a class="code" href="../../d8/db3/oniguruma_8h.html#ac7dab6dc212e4163285d924b2572c4b3">ONIG_SYN_OP2_ESC_U_HEX4</a>)) {
<a name="l03462"></a>03462         num = <a class="code" href="../../d6/dda/regparse_8c.html#ac28095d363fabc3f8e789710b8b41df1">scan_unsigned_hexadecimal_number</a>(&amp;p, end, 4, enc);
<a name="l03463"></a>03463         <span class="keywordflow">if</span> (num &lt; 0) <span class="keywordflow">return</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#af6769c109e3a039fa74338b01c389c94">ONIGERR_TOO_BIG_NUMBER</a>;
<a name="l03464"></a>03464         <span class="keywordflow">if</span> (p == prev) {  <span class="comment">/* can&apos;t read nothing. */</span>
<a name="l03465"></a>03465           num = 0; <span class="comment">/* but, it&apos;s not error */</span>
<a name="l03466"></a>03466         }
<a name="l03467"></a>03467         tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#a46f3343f204ac67de13f0a774284e476">type</a>   = <a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250da7a451b3ab1e788efaa2da058c6c8b49c">TK_CODE_POINT</a>;
<a name="l03468"></a>03468         tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#a938bb7f9e071e3c6ce68480e3138a0cc">base</a>   = 16;
<a name="l03469"></a>03469         tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#aaea3a0bd5a46ef32e4a9552046a070b3">u</a>.<a class="code" href="../../d0/d80/struct_onig_token.html#a40121b0193b6bbfbf9fdb88d82f1ea7a">code</a> = (<a class="code" href="../../d8/db3/oniguruma_8h.html#a7c8a84bc12127007886efbfcf53b6fb5">OnigCodePoint</a> )num;
<a name="l03470"></a>03470       }
<a name="l03471"></a>03471       <span class="keywordflow">break</span>;
<a name="l03472"></a>03472 
<a name="l03473"></a>03473     <span class="keywordflow">case</span> <span class="charliteral">&apos;1&apos;</span>: <span class="keywordflow">case</span> <span class="charliteral">&apos;2&apos;</span>: <span class="keywordflow">case</span> <span class="charliteral">&apos;3&apos;</span>: <span class="keywordflow">case</span> <span class="charliteral">&apos;4&apos;</span>:
<a name="l03474"></a>03474     <span class="keywordflow">case</span> <span class="charliteral">&apos;5&apos;</span>: <span class="keywordflow">case</span> <span class="charliteral">&apos;6&apos;</span>: <span class="keywordflow">case</span> <span class="charliteral">&apos;7&apos;</span>: <span class="keywordflow">case</span> <span class="charliteral">&apos;8&apos;</span>: <span class="keywordflow">case</span> <span class="charliteral">&apos;9&apos;</span>:
<a name="l03475"></a>03475       <a class="code" href="../../d6/dda/regparse_8c.html#ad0350add3c44d502c77357f6012b1bf2">PUNFETCH</a>;
<a name="l03476"></a>03476       prev = p;
<a name="l03477"></a>03477       num = <a class="code" href="../../d6/dda/regparse_8c.html#af172b663db06124c2c4b62a7e1377472">onig_scan_unsigned_number</a>(&amp;p, end, enc);
<a name="l03478"></a>03478       <span class="keywordflow">if</span> (num &lt; 0 || num &gt; <a class="code" href="../../d8/db3/oniguruma_8h.html#aba535639043aabd9e5db5f52a00be1a2">ONIG_MAX_BACKREF_NUM</a>) {
<a name="l03479"></a>03479         <span class="keywordflow">goto</span> skip_backref;
<a name="l03480"></a>03480       }
<a name="l03481"></a>03481 
<a name="l03482"></a>03482       <span class="keywordflow">if</span> (<a class="code" href="../../d1/dfc/regparse_8h.html#aeeb7aa0f60553ade62b7338e8f21256b">IS_SYNTAX_OP</a>(syn, <a class="code" href="../../d8/db3/oniguruma_8h.html#a43e86a2a8b36fea01e84e21b5a60b083">ONIG_SYN_OP_DECIMAL_BACKREF</a>) &amp;&amp;
<a name="l03483"></a>03483           (num &lt;= env-&gt;num_mem || num &lt;= 9)) { <span class="comment">/* This spec. from GNU regex */</span>
<a name="l03484"></a>03484         <span class="keywordflow">if</span> (<a class="code" href="../../d1/dfc/regparse_8h.html#a18bfc9ee154d6dd516347bd71b4810f6">IS_SYNTAX_BV</a>(syn, <a class="code" href="../../d8/db3/oniguruma_8h.html#abe12879521ed04a228fd86d02f1f4d0f">ONIG_SYN_STRICT_CHECK_BACKREF</a>)) {
<a name="l03485"></a>03485           <span class="keywordflow">if</span> (num &gt; env-&gt;<a class="code" href="../../d6/dbe/struct_scan_env.html#a5f71c0a538e047bc63962df55ff304b0">num_mem</a> || <a class="code" href="../../d6/d87/regint_8h.html#a91a9c9242dc3810582965d1882d1894d">IS_NULL</a>(<a class="code" href="../../d1/dfc/regparse_8h.html#a82066fdd1d2abdcc23ae01f55bfbe321">SCANENV_MEM_NODES</a>(env)[num]))
<a name="l03486"></a>03486             <span class="keywordflow">return</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#adbf6f094cfd29f00edfcf0484dcbe7fa">ONIGERR_INVALID_BACKREF</a>;
<a name="l03487"></a>03487         }
<a name="l03488"></a>03488 
<a name="l03489"></a>03489         tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#a46f3343f204ac67de13f0a774284e476">type</a> = <a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250da6009b276a2eb504bd2db835140ef34c4">TK_BACKREF</a>;
<a name="l03490"></a>03490         tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#aaea3a0bd5a46ef32e4a9552046a070b3">u</a>.<a class="code" href="../../d0/d80/struct_onig_token.html#adfd59d141a94df1a86846e7a56e9ab3a">backref</a>.num     = 1;
<a name="l03491"></a>03491         tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#aaea3a0bd5a46ef32e4a9552046a070b3">u</a>.<a class="code" href="../../d0/d80/struct_onig_token.html#adfd59d141a94df1a86846e7a56e9ab3a">backref</a>.ref1    = num;
<a name="l03492"></a>03492         tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#aaea3a0bd5a46ef32e4a9552046a070b3">u</a>.<a class="code" href="../../d0/d80/struct_onig_token.html#adfd59d141a94df1a86846e7a56e9ab3a">backref</a>.by_name = 0;
<a name="l03493"></a>03493 <span class="preprocessor">#ifdef USE_BACKREF_WITH_LEVEL</span>
<a name="l03494"></a>03494 <span class="preprocessor"></span>        tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#aaea3a0bd5a46ef32e4a9552046a070b3">u</a>.<a class="code" href="../../d0/d80/struct_onig_token.html#adfd59d141a94df1a86846e7a56e9ab3a">backref</a>.exist_level = 0;
<a name="l03495"></a>03495 <span class="preprocessor">#endif</span>
<a name="l03496"></a>03496 <span class="preprocessor"></span>        <span class="keywordflow">break</span>;
<a name="l03497"></a>03497       }
<a name="l03498"></a>03498 
<a name="l03499"></a>03499     skip_backref:
<a name="l03500"></a>03500       <span class="keywordflow">if</span> (c == <span class="charliteral">&apos;8&apos;</span> || c == <span class="charliteral">&apos;9&apos;</span>) {
<a name="l03501"></a>03501         <span class="comment">/* normal char */</span>
<a name="l03502"></a>03502         p = prev; <a class="code" href="../../d6/dda/regparse_8c.html#a0545e73dc7ae14b1f62293c1feba3983">PINC</a>;
<a name="l03503"></a>03503         <span class="keywordflow">break</span>;
<a name="l03504"></a>03504       }
<a name="l03505"></a>03505 
<a name="l03506"></a>03506       p = prev;
<a name="l03507"></a>03507       <span class="comment">/* fall through */</span>
<a name="l03508"></a>03508     <span class="keywordflow">case</span> <span class="charliteral">&apos;0&apos;</span>:
<a name="l03509"></a>03509       <span class="keywordflow">if</span> (<a class="code" href="../../d1/dfc/regparse_8h.html#aeeb7aa0f60553ade62b7338e8f21256b">IS_SYNTAX_OP</a>(syn, <a class="code" href="../../d8/db3/oniguruma_8h.html#a840371e8111b6e76aeb0a7a872009d37">ONIG_SYN_OP_ESC_OCTAL3</a>)) {
<a name="l03510"></a>03510         prev = p;
<a name="l03511"></a>03511         num = <a class="code" href="../../d6/dda/regparse_8c.html#af9a4fd42a5f01d15769e6c8640fa40d7">scan_unsigned_octal_number</a>(&amp;p, end, (c == <span class="charliteral">&apos;0&apos;</span> ? 2:3), enc);
<a name="l03512"></a>03512         <span class="keywordflow">if</span> (num &lt; 0) <span class="keywordflow">return</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#af6769c109e3a039fa74338b01c389c94">ONIGERR_TOO_BIG_NUMBER</a>;
<a name="l03513"></a>03513         <span class="keywordflow">if</span> (p == prev) {  <span class="comment">/* can&apos;t read nothing. */</span>
<a name="l03514"></a>03514           num = 0; <span class="comment">/* but, it&apos;s not error */</span>
<a name="l03515"></a>03515         }
<a name="l03516"></a>03516         tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#a46f3343f204ac67de13f0a774284e476">type</a> = <a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250dab0e056f20d46d5a9696dd7fdea89de88">TK_RAW_BYTE</a>;
<a name="l03517"></a>03517         tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#a938bb7f9e071e3c6ce68480e3138a0cc">base</a> = 8;
<a name="l03518"></a>03518         tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#aaea3a0bd5a46ef32e4a9552046a070b3">u</a>.<a class="code" href="../../d0/d80/struct_onig_token.html#ac1f4ee5fa57d7ebbfa95642148efe0f5">c</a>  = num;
<a name="l03519"></a>03519       }
<a name="l03520"></a>03520       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (c != <span class="charliteral">&apos;0&apos;</span>) {
<a name="l03521"></a>03521         <a class="code" href="../../d6/dda/regparse_8c.html#a0545e73dc7ae14b1f62293c1feba3983">PINC</a>;
<a name="l03522"></a>03522       }
<a name="l03523"></a>03523       <span class="keywordflow">break</span>;
<a name="l03524"></a>03524 
<a name="l03525"></a>03525 <span class="preprocessor">#ifdef USE_NAMED_GROUP</span>
<a name="l03526"></a>03526 <span class="preprocessor"></span>    <span class="keywordflow">case</span> <span class="charliteral">&apos;k&apos;</span>:
<a name="l03527"></a>03527       <span class="keywordflow">if</span> (<a class="code" href="../../d1/dfc/regparse_8h.html#a2ff963239e972932cefd5adaae161e76">IS_SYNTAX_OP2</a>(syn, <a class="code" href="../../d8/db3/oniguruma_8h.html#ac2661872d7b556c75f5f5c1beab3ddf9">ONIG_SYN_OP2_ESC_K_NAMED_BACKREF</a>)) {
<a name="l03528"></a>03528         <a class="code" href="../../d6/dda/regparse_8c.html#a8a8898c873b81a88454a968371696cab">PFETCH</a>(c);
<a name="l03529"></a>03529         <span class="keywordflow">if</span> (c == <span class="charliteral">&apos;&lt;&apos;</span> || c == <span class="charliteral">&apos;\&apos;&apos;</span>) {
<a name="l03530"></a>03530           <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>* name_end;
<a name="l03531"></a>03531           <span class="keywordtype">int</span>* backs;
<a name="l03532"></a>03532           <span class="keywordtype">int</span> back_num;
<a name="l03533"></a>03533 
<a name="l03534"></a>03534           prev = p;
<a name="l03535"></a>03535 
<a name="l03536"></a>03536 <span class="preprocessor">#ifdef USE_BACKREF_WITH_LEVEL</span>
<a name="l03537"></a>03537 <span class="preprocessor"></span>          name_end = <a class="code" href="../../d6/d87/regint_8h.html#a710fb6bef4455b84c75bbb919e1f9496">NULL_UCHARP</a>; <span class="comment">/* no need. escape gcc warning. */</span>
<a name="l03538"></a>03538           r = <a class="code" href="../../d6/dda/regparse_8c.html#a3a36842de2c36440fad19828c88c32ed">fetch_name_with_level</a>((<a class="code" href="../../d8/db3/oniguruma_8h.html#a7c8a84bc12127007886efbfcf53b6fb5">OnigCodePoint</a> )c, &amp;p, end, &amp;name_end,
<a name="l03539"></a>03539                                     env, &amp;back_num, &amp;tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#aaea3a0bd5a46ef32e4a9552046a070b3">u</a>.<a class="code" href="../../d0/d80/struct_onig_token.html#adfd59d141a94df1a86846e7a56e9ab3a">backref</a>.level);
<a name="l03540"></a>03540           <span class="keywordflow">if</span> (r == 1) tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#aaea3a0bd5a46ef32e4a9552046a070b3">u</a>.<a class="code" href="../../d0/d80/struct_onig_token.html#adfd59d141a94df1a86846e7a56e9ab3a">backref</a>.exist_level = 1;
<a name="l03541"></a>03541           <span class="keywordflow">else</span>        tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#aaea3a0bd5a46ef32e4a9552046a070b3">u</a>.<a class="code" href="../../d0/d80/struct_onig_token.html#adfd59d141a94df1a86846e7a56e9ab3a">backref</a>.exist_level = 0;
<a name="l03542"></a>03542 <span class="preprocessor">#else</span>
<a name="l03543"></a>03543 <span class="preprocessor"></span>          r = <a class="code" href="../../d6/dda/regparse_8c.html#a67cbe5ffbeb09676c26f3c3e4094128c">fetch_name</a>(&amp;p, end, &amp;name_end, env, &amp;back_num, 1);
<a name="l03544"></a>03544 <span class="preprocessor">#endif</span>
<a name="l03545"></a>03545 <span class="preprocessor"></span>          <span class="keywordflow">if</span> (r &lt; 0) <span class="keywordflow">return</span> r;
<a name="l03546"></a>03546 
<a name="l03547"></a>03547           <span class="keywordflow">if</span> (back_num != 0) {
<a name="l03548"></a>03548             <span class="keywordflow">if</span> (back_num &lt; 0) {
<a name="l03549"></a>03549               back_num = <a class="code" href="../../d6/dda/regparse_8c.html#ab46c3e257763e4d4732f97674ea1689c">BACKREF_REL_TO_ABS</a>(back_num, env);
<a name="l03550"></a>03550               <span class="keywordflow">if</span> (back_num &lt;= 0)
<a name="l03551"></a>03551                 <span class="keywordflow">return</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#adbf6f094cfd29f00edfcf0484dcbe7fa">ONIGERR_INVALID_BACKREF</a>;
<a name="l03552"></a>03552             }
<a name="l03553"></a>03553 
<a name="l03554"></a>03554             <span class="keywordflow">if</span> (<a class="code" href="../../d1/dfc/regparse_8h.html#a18bfc9ee154d6dd516347bd71b4810f6">IS_SYNTAX_BV</a>(syn, <a class="code" href="../../d8/db3/oniguruma_8h.html#abe12879521ed04a228fd86d02f1f4d0f">ONIG_SYN_STRICT_CHECK_BACKREF</a>)) {
<a name="l03555"></a>03555               <span class="keywordflow">if</span> (back_num &gt; env-&gt;<a class="code" href="../../d6/dbe/struct_scan_env.html#a5f71c0a538e047bc63962df55ff304b0">num_mem</a> ||
<a name="l03556"></a>03556                   <a class="code" href="../../d6/d87/regint_8h.html#a91a9c9242dc3810582965d1882d1894d">IS_NULL</a>(<a class="code" href="../../d1/dfc/regparse_8h.html#a82066fdd1d2abdcc23ae01f55bfbe321">SCANENV_MEM_NODES</a>(env)[back_num]))
<a name="l03557"></a>03557                 <span class="keywordflow">return</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#adbf6f094cfd29f00edfcf0484dcbe7fa">ONIGERR_INVALID_BACKREF</a>;
<a name="l03558"></a>03558             }
<a name="l03559"></a>03559             tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#a46f3343f204ac67de13f0a774284e476">type</a> = <a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250da6009b276a2eb504bd2db835140ef34c4">TK_BACKREF</a>;
<a name="l03560"></a>03560             tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#aaea3a0bd5a46ef32e4a9552046a070b3">u</a>.<a class="code" href="../../d0/d80/struct_onig_token.html#adfd59d141a94df1a86846e7a56e9ab3a">backref</a>.by_name = 0;
<a name="l03561"></a>03561             tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#aaea3a0bd5a46ef32e4a9552046a070b3">u</a>.<a class="code" href="../../d0/d80/struct_onig_token.html#adfd59d141a94df1a86846e7a56e9ab3a">backref</a>.num  = 1;
<a name="l03562"></a>03562             tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#aaea3a0bd5a46ef32e4a9552046a070b3">u</a>.<a class="code" href="../../d0/d80/struct_onig_token.html#adfd59d141a94df1a86846e7a56e9ab3a">backref</a>.ref1 = back_num;
<a name="l03563"></a>03563           }
<a name="l03564"></a>03564           <span class="keywordflow">else</span> {
<a name="l03565"></a>03565             num = <a class="code" href="../../d6/dda/regparse_8c.html#a083f9c0f9e54ad206e6464554876abe9">onig_name_to_group_numbers</a>(env-&gt;<a class="code" href="../../d6/dbe/struct_scan_env.html#ae4606d4fccc90f08112b577ef1822eac">reg</a>, prev, name_end, &amp;backs);
<a name="l03566"></a>03566             <span class="keywordflow">if</span> (num &lt;= 0) {
<a name="l03567"></a>03567               <a class="code" href="../../d6/dda/regparse_8c.html#a8d6d95d9c113545baa16fe1ff3d96191">onig_scan_env_set_error_string</a>(env,
<a name="l03568"></a>03568                              <a class="code" href="../../d8/db3/oniguruma_8h.html#a6f16c9adf6c6e9e769b0ea84f9b32665">ONIGERR_UNDEFINED_NAME_REFERENCE</a>, prev, name_end);
<a name="l03569"></a>03569               <span class="keywordflow">return</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#a6f16c9adf6c6e9e769b0ea84f9b32665">ONIGERR_UNDEFINED_NAME_REFERENCE</a>;
<a name="l03570"></a>03570             }
<a name="l03571"></a>03571             <span class="keywordflow">if</span> (<a class="code" href="../../d1/dfc/regparse_8h.html#a18bfc9ee154d6dd516347bd71b4810f6">IS_SYNTAX_BV</a>(syn, <a class="code" href="../../d8/db3/oniguruma_8h.html#abe12879521ed04a228fd86d02f1f4d0f">ONIG_SYN_STRICT_CHECK_BACKREF</a>)) {
<a name="l03572"></a>03572               <span class="keywordtype">int</span> i;
<a name="l03573"></a>03573               <span class="keywordflow">for</span> (i = 0; i &lt; num; i++) {
<a name="l03574"></a>03574                 <span class="keywordflow">if</span> (backs[i] &gt; env-&gt;<a class="code" href="../../d6/dbe/struct_scan_env.html#a5f71c0a538e047bc63962df55ff304b0">num_mem</a> ||
<a name="l03575"></a>03575                     <a class="code" href="../../d6/d87/regint_8h.html#a91a9c9242dc3810582965d1882d1894d">IS_NULL</a>(<a class="code" href="../../d1/dfc/regparse_8h.html#a82066fdd1d2abdcc23ae01f55bfbe321">SCANENV_MEM_NODES</a>(env)[backs[i]]))
<a name="l03576"></a>03576                   <span class="keywordflow">return</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#adbf6f094cfd29f00edfcf0484dcbe7fa">ONIGERR_INVALID_BACKREF</a>;
<a name="l03577"></a>03577               }
<a name="l03578"></a>03578             }
<a name="l03579"></a>03579 
<a name="l03580"></a>03580             tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#a46f3343f204ac67de13f0a774284e476">type</a> = <a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250da6009b276a2eb504bd2db835140ef34c4">TK_BACKREF</a>;
<a name="l03581"></a>03581             tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#aaea3a0bd5a46ef32e4a9552046a070b3">u</a>.<a class="code" href="../../d0/d80/struct_onig_token.html#adfd59d141a94df1a86846e7a56e9ab3a">backref</a>.by_name = 1;
<a name="l03582"></a>03582             <span class="keywordflow">if</span> (num == 1) {
<a name="l03583"></a>03583               tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#aaea3a0bd5a46ef32e4a9552046a070b3">u</a>.<a class="code" href="../../d0/d80/struct_onig_token.html#adfd59d141a94df1a86846e7a56e9ab3a">backref</a>.num  = 1;
<a name="l03584"></a>03584               tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#aaea3a0bd5a46ef32e4a9552046a070b3">u</a>.<a class="code" href="../../d0/d80/struct_onig_token.html#adfd59d141a94df1a86846e7a56e9ab3a">backref</a>.ref1 = backs[0];
<a name="l03585"></a>03585             }
<a name="l03586"></a>03586             <span class="keywordflow">else</span> {
<a name="l03587"></a>03587               tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#aaea3a0bd5a46ef32e4a9552046a070b3">u</a>.<a class="code" href="../../d0/d80/struct_onig_token.html#adfd59d141a94df1a86846e7a56e9ab3a">backref</a>.num  = num;
<a name="l03588"></a>03588               tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#aaea3a0bd5a46ef32e4a9552046a070b3">u</a>.<a class="code" href="../../d0/d80/struct_onig_token.html#adfd59d141a94df1a86846e7a56e9ab3a">backref</a>.refs = backs;
<a name="l03589"></a>03589             }
<a name="l03590"></a>03590           }
<a name="l03591"></a>03591         }
<a name="l03592"></a>03592         <span class="keywordflow">else</span> {
<a name="l03593"></a>03593             <a class="code" href="../../d6/dda/regparse_8c.html#ad0350add3c44d502c77357f6012b1bf2">PUNFETCH</a>;
<a name="l03594"></a>03594             <a class="code" href="../../d6/dda/regparse_8c.html#acb67057765575ddb27b1d90fd972fde5">onig_syntax_warn</a>(env, <span class="stringliteral">&quot;invalid back reference&quot;</span>);
<a name="l03595"></a>03595         }
<a name="l03596"></a>03596       }
<a name="l03597"></a>03597       <span class="keywordflow">break</span>;
<a name="l03598"></a>03598 <span class="preprocessor">#endif</span>
<a name="l03599"></a>03599 <span class="preprocessor"></span>
<a name="l03600"></a>03600 <span class="preprocessor">#ifdef USE_SUBEXP_CALL</span>
<a name="l03601"></a>03601 <span class="preprocessor"></span>    <span class="keywordflow">case</span> <span class="charliteral">&apos;g&apos;</span>:
<a name="l03602"></a>03602       <span class="keywordflow">if</span> (<a class="code" href="../../d1/dfc/regparse_8h.html#a2ff963239e972932cefd5adaae161e76">IS_SYNTAX_OP2</a>(syn, <a class="code" href="../../d8/db3/oniguruma_8h.html#ae6de0d8bc3c3ae511fdb6b2f15221713">ONIG_SYN_OP2_ESC_G_SUBEXP_CALL</a>)) {
<a name="l03603"></a>03603         <a class="code" href="../../d6/dda/regparse_8c.html#a8a8898c873b81a88454a968371696cab">PFETCH</a>(c);
<a name="l03604"></a>03604         <span class="keywordflow">if</span> (c == <span class="charliteral">&apos;&lt;&apos;</span> || c == <span class="charliteral">&apos;\&apos;&apos;</span>) {
<a name="l03605"></a>03605           <span class="keywordtype">int</span> gnum;
<a name="l03606"></a>03606           <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>* name_end;
<a name="l03607"></a>03607 
<a name="l03608"></a>03608           prev = p;
<a name="l03609"></a>03609           r = <a class="code" href="../../d6/dda/regparse_8c.html#a67cbe5ffbeb09676c26f3c3e4094128c">fetch_name</a>((<a class="code" href="../../d8/db3/oniguruma_8h.html#a7c8a84bc12127007886efbfcf53b6fb5">OnigCodePoint</a> )c, &amp;p, end, &amp;name_end, env, &amp;gnum, 1);
<a name="l03610"></a>03610           <span class="keywordflow">if</span> (r &lt; 0) <span class="keywordflow">return</span> r;
<a name="l03611"></a>03611 
<a name="l03612"></a>03612           tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#a46f3343f204ac67de13f0a774284e476">type</a> = <a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250da8198b2b556338495587a25b47927061a">TK_CALL</a>;
<a name="l03613"></a>03613           tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#aaea3a0bd5a46ef32e4a9552046a070b3">u</a>.<a class="code" href="../../d0/d80/struct_onig_token.html#a97792b06ff75408d4a1bdd94523e4f5d">call</a>.name     = prev;
<a name="l03614"></a>03614           tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#aaea3a0bd5a46ef32e4a9552046a070b3">u</a>.<a class="code" href="../../d0/d80/struct_onig_token.html#a97792b06ff75408d4a1bdd94523e4f5d">call</a>.name_end = name_end;
<a name="l03615"></a>03615           tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#aaea3a0bd5a46ef32e4a9552046a070b3">u</a>.<a class="code" href="../../d0/d80/struct_onig_token.html#a97792b06ff75408d4a1bdd94523e4f5d">call</a>.gnum     = gnum;
<a name="l03616"></a>03616         }
<a name="l03617"></a>03617         <span class="keywordflow">else</span> {
<a name="l03618"></a>03618             <a class="code" href="../../d6/dda/regparse_8c.html#acb67057765575ddb27b1d90fd972fde5">onig_syntax_warn</a>(env, <span class="stringliteral">&quot;invalid subexp call&quot;</span>);
<a name="l03619"></a>03619             <a class="code" href="../../d6/dda/regparse_8c.html#ad0350add3c44d502c77357f6012b1bf2">PUNFETCH</a>;
<a name="l03620"></a>03620         }
<a name="l03621"></a>03621       }
<a name="l03622"></a>03622       <span class="keywordflow">break</span>;
<a name="l03623"></a>03623 <span class="preprocessor">#endif</span>
<a name="l03624"></a>03624 <span class="preprocessor"></span>
<a name="l03625"></a>03625     <span class="keywordflow">case</span> <span class="charliteral">&apos;Q&apos;</span>:
<a name="l03626"></a>03626       <span class="keywordflow">if</span> (<a class="code" href="../../d1/dfc/regparse_8h.html#a2ff963239e972932cefd5adaae161e76">IS_SYNTAX_OP2</a>(syn, <a class="code" href="../../d8/db3/oniguruma_8h.html#a050024668a5b779dd9a5bf2c53e6ef87">ONIG_SYN_OP2_ESC_CAPITAL_Q_QUOTE</a>)) {
<a name="l03627"></a>03627         tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#a46f3343f204ac67de13f0a774284e476">type</a> = <a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250da4bf244fe4348e0d0491bafa6adfa13d1">TK_QUOTE_OPEN</a>;
<a name="l03628"></a>03628       }
<a name="l03629"></a>03629       <span class="keywordflow">break</span>;
<a name="l03630"></a>03630 
<a name="l03631"></a>03631     <span class="keywordflow">case</span> <span class="charliteral">&apos;p&apos;</span>:
<a name="l03632"></a>03632     <span class="keywordflow">case</span> <span class="charliteral">&apos;P&apos;</span>:
<a name="l03633"></a>03633       <span class="keywordflow">if</span> (<a class="code" href="../../d6/dda/regparse_8c.html#a4ed53b7baf65c82f4ba37027979ed82d">PPEEK_IS</a>(<span class="charliteral">&apos;{&apos;</span>) &amp;&amp;
<a name="l03634"></a>03634           <a class="code" href="../../d1/dfc/regparse_8h.html#a2ff963239e972932cefd5adaae161e76">IS_SYNTAX_OP2</a>(syn, <a class="code" href="../../d8/db3/oniguruma_8h.html#a292134a70cda1a681a663e11180fd0c2">ONIG_SYN_OP2_ESC_P_BRACE_CHAR_PROPERTY</a>)) {
<a name="l03635"></a>03635         <a class="code" href="../../d6/dda/regparse_8c.html#a0545e73dc7ae14b1f62293c1feba3983">PINC</a>;
<a name="l03636"></a>03636         tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#a46f3343f204ac67de13f0a774284e476">type</a> = <a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250da81d0318969b984a3d42eab29ec60fb47">TK_CHAR_PROPERTY</a>;
<a name="l03637"></a>03637         tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#aaea3a0bd5a46ef32e4a9552046a070b3">u</a>.<a class="code" href="../../d0/d80/struct_onig_token.html#a84f464445695ec0d70cdc5f02db11833">prop</a>.not = (c == <span class="charliteral">&apos;P&apos;</span> ? 1 : 0);
<a name="l03638"></a>03638 
<a name="l03639"></a>03639         <span class="keywordflow">if</span> (<a class="code" href="../../d1/dfc/regparse_8h.html#a2ff963239e972932cefd5adaae161e76">IS_SYNTAX_OP2</a>(syn, <a class="code" href="../../d8/db3/oniguruma_8h.html#a2dbc25f5f5e66628427c51fb4d100441">ONIG_SYN_OP2_ESC_P_BRACE_CIRCUMFLEX_NOT</a>)) {
<a name="l03640"></a>03640           <a class="code" href="../../d6/dda/regparse_8c.html#a8a8898c873b81a88454a968371696cab">PFETCH</a>(c);
<a name="l03641"></a>03641           <span class="keywordflow">if</span> (c == <span class="charliteral">&apos;^&apos;</span>) {
<a name="l03642"></a>03642             tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#aaea3a0bd5a46ef32e4a9552046a070b3">u</a>.<a class="code" href="../../d0/d80/struct_onig_token.html#a84f464445695ec0d70cdc5f02db11833">prop</a>.not = (tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#aaea3a0bd5a46ef32e4a9552046a070b3">u</a>.<a class="code" href="../../d0/d80/struct_onig_token.html#a84f464445695ec0d70cdc5f02db11833">prop</a>.not == 0 ? 1 : 0);
<a name="l03643"></a>03643           }
<a name="l03644"></a>03644           <span class="keywordflow">else</span>
<a name="l03645"></a>03645             <a class="code" href="../../d6/dda/regparse_8c.html#ad0350add3c44d502c77357f6012b1bf2">PUNFETCH</a>;
<a name="l03646"></a>03646         }
<a name="l03647"></a>03647       }
<a name="l03648"></a>03648       <span class="keywordflow">else</span> {
<a name="l03649"></a>03649           <a class="code" href="../../d6/dda/regparse_8c.html#acb67057765575ddb27b1d90fd972fde5">onig_syntax_warn</a>(env, <span class="stringliteral">&quot;invalid Unicode Property \\%c&quot;</span>, c);
<a name="l03650"></a>03650       }
<a name="l03651"></a>03651       <span class="keywordflow">break</span>;
<a name="l03652"></a>03652 
<a name="l03653"></a>03653     <span class="keywordflow">default</span>:
<a name="l03654"></a>03654       <a class="code" href="../../d6/dda/regparse_8c.html#ad0350add3c44d502c77357f6012b1bf2">PUNFETCH</a>;
<a name="l03655"></a>03655       num = <a class="code" href="../../d6/dda/regparse_8c.html#ac3534284c668aefff9f97ffd5d759522">fetch_escaped_value</a>(&amp;p, end, env);
<a name="l03656"></a>03656       <span class="keywordflow">if</span> (num &lt; 0) <span class="keywordflow">return</span> num;
<a name="l03657"></a>03657       <span class="comment">/* set_raw: */</span>
<a name="l03658"></a>03658       <span class="keywordflow">if</span> (tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#aaea3a0bd5a46ef32e4a9552046a070b3">u</a>.<a class="code" href="../../d0/d80/struct_onig_token.html#ac1f4ee5fa57d7ebbfa95642148efe0f5">c</a> != num) {
<a name="l03659"></a>03659         tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#a46f3343f204ac67de13f0a774284e476">type</a> = <a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250da7a451b3ab1e788efaa2da058c6c8b49c">TK_CODE_POINT</a>;
<a name="l03660"></a>03660         tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#aaea3a0bd5a46ef32e4a9552046a070b3">u</a>.<a class="code" href="../../d0/d80/struct_onig_token.html#a40121b0193b6bbfbf9fdb88d82f1ea7a">code</a> = (<a class="code" href="../../d8/db3/oniguruma_8h.html#a7c8a84bc12127007886efbfcf53b6fb5">OnigCodePoint</a> )num;
<a name="l03661"></a>03661       }
<a name="l03662"></a>03662       <span class="keywordflow">else</span> { <span class="comment">/* string */</span>
<a name="l03663"></a>03663         p = tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#accba0041ec257e1619caefea1ea12d10">backp</a> + <a class="code" href="../../d3/d09/ripper_8y.html#ae9f8530a4c9ec89ae8d62ce5b4410aad">enclen</a>(enc, tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#accba0041ec257e1619caefea1ea12d10">backp</a>, end);
<a name="l03664"></a>03664       }
<a name="l03665"></a>03665       <span class="keywordflow">break</span>;
<a name="l03666"></a>03666     }
<a name="l03667"></a>03667   }
<a name="l03668"></a>03668   <span class="keywordflow">else</span> {
<a name="l03669"></a>03669     tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#aaea3a0bd5a46ef32e4a9552046a070b3">u</a>.<a class="code" href="../../d0/d80/struct_onig_token.html#ac1f4ee5fa57d7ebbfa95642148efe0f5">c</a> = c;
<a name="l03670"></a>03670     tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#a71ac92059fef31b2d7932d04523f8c17">escaped</a> = 0;
<a name="l03671"></a>03671 
<a name="l03672"></a>03672 <span class="preprocessor">#ifdef USE_VARIABLE_META_CHARS</span>
<a name="l03673"></a>03673 <span class="preprocessor"></span>    <span class="keywordflow">if</span> ((c != <a class="code" href="../../d8/db3/oniguruma_8h.html#a3215ed7f35ff11e2c20849fee66ae602">ONIG_INEFFECTIVE_META_CHAR</a>) &amp;&amp;
<a name="l03674"></a>03674         <a class="code" href="../../d1/dfc/regparse_8h.html#aeeb7aa0f60553ade62b7338e8f21256b">IS_SYNTAX_OP</a>(syn, <a class="code" href="../../d8/db3/oniguruma_8h.html#af0f6480dbbac5a5e147d404a77118e30">ONIG_SYN_OP_VARIABLE_META_CHARACTERS</a>)) {
<a name="l03675"></a>03675       <span class="keywordflow">if</span> (c == <a class="code" href="../../d6/d87/regint_8h.html#a8fb6e18fd1fb61e3c11f035a6e6ac33a">MC_ANYCHAR</a>(syn))
<a name="l03676"></a>03676         <span class="keywordflow">goto</span> any_char;
<a name="l03677"></a>03677       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (c == <a class="code" href="../../d6/d87/regint_8h.html#a0a364868cfca262f2a305b23263bfb00">MC_ANYTIME</a>(syn))
<a name="l03678"></a>03678         <span class="keywordflow">goto</span> anytime;
<a name="l03679"></a>03679       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (c == <a class="code" href="../../d6/d87/regint_8h.html#afb8a3deeaadeb603342541f41310fb1d">MC_ZERO_OR_ONE_TIME</a>(syn))
<a name="l03680"></a>03680         <span class="keywordflow">goto</span> zero_or_one_time;
<a name="l03681"></a>03681       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (c == <a class="code" href="../../d6/d87/regint_8h.html#a284d5779fd038e357d2d1b4012b01d82">MC_ONE_OR_MORE_TIME</a>(syn))
<a name="l03682"></a>03682         <span class="keywordflow">goto</span> one_or_more_time;
<a name="l03683"></a>03683       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (c == <a class="code" href="../../d6/d87/regint_8h.html#aeba02cb54591fdfe2adb2e55c760acc4">MC_ANYCHAR_ANYTIME</a>(syn)) {
<a name="l03684"></a>03684         tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#a46f3343f204ac67de13f0a774284e476">type</a> = <a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250da280d14d1e68a04cda6cdeb5ffe52791f">TK_ANYCHAR_ANYTIME</a>;
<a name="l03685"></a>03685         <span class="keywordflow">goto</span> out;
<a name="l03686"></a>03686       }
<a name="l03687"></a>03687     }
<a name="l03688"></a>03688 <span class="preprocessor">#endif</span>
<a name="l03689"></a>03689 <span class="preprocessor"></span>
<a name="l03690"></a>03690     <span class="keywordflow">switch</span> (c) {
<a name="l03691"></a>03691     <span class="keywordflow">case</span> <span class="charliteral">&apos;.&apos;</span>:
<a name="l03692"></a>03692       <span class="keywordflow">if</span> (! <a class="code" href="../../d1/dfc/regparse_8h.html#aeeb7aa0f60553ade62b7338e8f21256b">IS_SYNTAX_OP</a>(syn, <a class="code" href="../../d8/db3/oniguruma_8h.html#a871dc5a91b66aaa89ed40828f0827bd6">ONIG_SYN_OP_DOT_ANYCHAR</a>)) <span class="keywordflow">break</span>;
<a name="l03693"></a>03693 <span class="preprocessor">#ifdef USE_VARIABLE_META_CHARS</span>
<a name="l03694"></a>03694 <span class="preprocessor"></span>    any_char:
<a name="l03695"></a>03695 <span class="preprocessor">#endif</span>
<a name="l03696"></a>03696 <span class="preprocessor"></span>      tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#a46f3343f204ac67de13f0a774284e476">type</a> = <a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250da1753696cfcc436c5ed6c31a5de77b3cd">TK_ANYCHAR</a>;
<a name="l03697"></a>03697       <span class="keywordflow">break</span>;
<a name="l03698"></a>03698 
<a name="l03699"></a>03699     <span class="keywordflow">case</span> <span class="charliteral">&apos;*&apos;</span>:
<a name="l03700"></a>03700       <span class="keywordflow">if</span> (! <a class="code" href="../../d1/dfc/regparse_8h.html#aeeb7aa0f60553ade62b7338e8f21256b">IS_SYNTAX_OP</a>(syn, <a class="code" href="../../d8/db3/oniguruma_8h.html#a0b234d172b26e5430cdec005af2611e5">ONIG_SYN_OP_ASTERISK_ZERO_INF</a>)) <span class="keywordflow">break</span>;
<a name="l03701"></a>03701 <span class="preprocessor">#ifdef USE_VARIABLE_META_CHARS</span>
<a name="l03702"></a>03702 <span class="preprocessor"></span>    anytime:
<a name="l03703"></a>03703 <span class="preprocessor">#endif</span>
<a name="l03704"></a>03704 <span class="preprocessor"></span>      tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#a46f3343f204ac67de13f0a774284e476">type</a> = <a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250daef6e175c79d6876bc5d93d82c1d13eb8">TK_OP_REPEAT</a>;
<a name="l03705"></a>03705       tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#aaea3a0bd5a46ef32e4a9552046a070b3">u</a>.<a class="code" href="../../d0/d80/struct_onig_token.html#a7ff69fe23d1d3da2bfd163c760ef4e44">repeat</a>.lower = 0;
<a name="l03706"></a>03706       tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#aaea3a0bd5a46ef32e4a9552046a070b3">u</a>.<a class="code" href="../../d0/d80/struct_onig_token.html#a7ff69fe23d1d3da2bfd163c760ef4e44">repeat</a>.upper = <a class="code" href="../../d6/d87/regint_8h.html#aaaf8d5e1b9d204ddb0b681077890b01f">REPEAT_INFINITE</a>;
<a name="l03707"></a>03707       <span class="keywordflow">goto</span> greedy_check;
<a name="l03708"></a>03708       <span class="keywordflow">break</span>;
<a name="l03709"></a>03709 
<a name="l03710"></a>03710     <span class="keywordflow">case</span> <span class="charliteral">&apos;+&apos;</span>:
<a name="l03711"></a>03711       <span class="keywordflow">if</span> (! <a class="code" href="../../d1/dfc/regparse_8h.html#aeeb7aa0f60553ade62b7338e8f21256b">IS_SYNTAX_OP</a>(syn, <a class="code" href="../../d8/db3/oniguruma_8h.html#a852bdacb98f1a27d73fc42eb6fef8e63">ONIG_SYN_OP_PLUS_ONE_INF</a>)) <span class="keywordflow">break</span>;
<a name="l03712"></a>03712 <span class="preprocessor">#ifdef USE_VARIABLE_META_CHARS</span>
<a name="l03713"></a>03713 <span class="preprocessor"></span>    one_or_more_time:
<a name="l03714"></a>03714 <span class="preprocessor">#endif</span>
<a name="l03715"></a>03715 <span class="preprocessor"></span>      tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#a46f3343f204ac67de13f0a774284e476">type</a> = <a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250daef6e175c79d6876bc5d93d82c1d13eb8">TK_OP_REPEAT</a>;
<a name="l03716"></a>03716       tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#aaea3a0bd5a46ef32e4a9552046a070b3">u</a>.<a class="code" href="../../d0/d80/struct_onig_token.html#a7ff69fe23d1d3da2bfd163c760ef4e44">repeat</a>.lower = 1;
<a name="l03717"></a>03717       tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#aaea3a0bd5a46ef32e4a9552046a070b3">u</a>.<a class="code" href="../../d0/d80/struct_onig_token.html#a7ff69fe23d1d3da2bfd163c760ef4e44">repeat</a>.upper = <a class="code" href="../../d6/d87/regint_8h.html#aaaf8d5e1b9d204ddb0b681077890b01f">REPEAT_INFINITE</a>;
<a name="l03718"></a>03718       <span class="keywordflow">goto</span> greedy_check;
<a name="l03719"></a>03719       <span class="keywordflow">break</span>;
<a name="l03720"></a>03720 
<a name="l03721"></a>03721     <span class="keywordflow">case</span> <span class="charliteral">&apos;?&apos;</span>:
<a name="l03722"></a>03722       <span class="keywordflow">if</span> (! <a class="code" href="../../d1/dfc/regparse_8h.html#aeeb7aa0f60553ade62b7338e8f21256b">IS_SYNTAX_OP</a>(syn, <a class="code" href="../../d8/db3/oniguruma_8h.html#aec01a914bf436335fdc1e351a22ca5eb">ONIG_SYN_OP_QMARK_ZERO_ONE</a>)) <span class="keywordflow">break</span>;
<a name="l03723"></a>03723 <span class="preprocessor">#ifdef USE_VARIABLE_META_CHARS</span>
<a name="l03724"></a>03724 <span class="preprocessor"></span>    zero_or_one_time:
<a name="l03725"></a>03725 <span class="preprocessor">#endif</span>
<a name="l03726"></a>03726 <span class="preprocessor"></span>      tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#a46f3343f204ac67de13f0a774284e476">type</a> = <a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250daef6e175c79d6876bc5d93d82c1d13eb8">TK_OP_REPEAT</a>;
<a name="l03727"></a>03727       tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#aaea3a0bd5a46ef32e4a9552046a070b3">u</a>.<a class="code" href="../../d0/d80/struct_onig_token.html#a7ff69fe23d1d3da2bfd163c760ef4e44">repeat</a>.lower = 0;
<a name="l03728"></a>03728       tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#aaea3a0bd5a46ef32e4a9552046a070b3">u</a>.<a class="code" href="../../d0/d80/struct_onig_token.html#a7ff69fe23d1d3da2bfd163c760ef4e44">repeat</a>.upper = 1;
<a name="l03729"></a>03729       <span class="keywordflow">goto</span> greedy_check;
<a name="l03730"></a>03730       <span class="keywordflow">break</span>;
<a name="l03731"></a>03731 
<a name="l03732"></a>03732     <span class="keywordflow">case</span> <span class="charliteral">&apos;{&apos;</span>:
<a name="l03733"></a>03733       <span class="keywordflow">if</span> (! <a class="code" href="../../d1/dfc/regparse_8h.html#aeeb7aa0f60553ade62b7338e8f21256b">IS_SYNTAX_OP</a>(syn, <a class="code" href="../../d8/db3/oniguruma_8h.html#a3e0cba340ec1d55f98482a4a37e05098">ONIG_SYN_OP_BRACE_INTERVAL</a>)) <span class="keywordflow">break</span>;
<a name="l03734"></a>03734       r = <a class="code" href="../../d6/dda/regparse_8c.html#a9b58f1c872c08ae8838728d04f14463d">fetch_range_quantifier</a>(&amp;p, end, tok, env);
<a name="l03735"></a>03735       <span class="keywordflow">if</span> (r &lt; 0) <span class="keywordflow">return</span> r;  <span class="comment">/* error */</span>
<a name="l03736"></a>03736       <span class="keywordflow">if</span> (r == 0) <span class="keywordflow">goto</span> greedy_check;
<a name="l03737"></a>03737       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (r == 2) { <span class="comment">/* {n} */</span>
<a name="l03738"></a>03738         <span class="keywordflow">if</span> (<a class="code" href="../../d1/dfc/regparse_8h.html#a18bfc9ee154d6dd516347bd71b4810f6">IS_SYNTAX_BV</a>(syn, <a class="code" href="../../d8/db3/oniguruma_8h.html#a269f5fa639cd57a23b0333cd062911be">ONIG_SYN_FIXED_INTERVAL_IS_GREEDY_ONLY</a>))
<a name="l03739"></a>03739           <span class="keywordflow">goto</span> possessive_check;
<a name="l03740"></a>03740 
<a name="l03741"></a>03741         <span class="keywordflow">goto</span> greedy_check;
<a name="l03742"></a>03742       }
<a name="l03743"></a>03743       <span class="comment">/* r == 1 : normal char */</span>
<a name="l03744"></a>03744       <span class="keywordflow">break</span>;
<a name="l03745"></a>03745 
<a name="l03746"></a>03746     <span class="keywordflow">case</span> <span class="charliteral">&apos;|&apos;</span>:
<a name="l03747"></a>03747       <span class="keywordflow">if</span> (! <a class="code" href="../../d1/dfc/regparse_8h.html#aeeb7aa0f60553ade62b7338e8f21256b">IS_SYNTAX_OP</a>(syn, <a class="code" href="../../d8/db3/oniguruma_8h.html#ad068e4ab89234bcd3a1ed0b0cc4060a5">ONIG_SYN_OP_VBAR_ALT</a>)) <span class="keywordflow">break</span>;
<a name="l03748"></a>03748       tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#a46f3343f204ac67de13f0a774284e476">type</a> = <a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250da902b0cdea9f57e86f33e1c42c38bae8a">TK_ALT</a>;
<a name="l03749"></a>03749       <span class="keywordflow">break</span>;
<a name="l03750"></a>03750 
<a name="l03751"></a>03751     <span class="keywordflow">case</span> <span class="charliteral">&apos;(&apos;</span>:
<a name="l03752"></a>03752       <span class="keywordflow">if</span> (<a class="code" href="../../d6/dda/regparse_8c.html#a4ed53b7baf65c82f4ba37027979ed82d">PPEEK_IS</a>(<span class="charliteral">&apos;?&apos;</span>) &amp;&amp;
<a name="l03753"></a>03753           <a class="code" href="../../d1/dfc/regparse_8h.html#a2ff963239e972932cefd5adaae161e76">IS_SYNTAX_OP2</a>(syn, <a class="code" href="../../d8/db3/oniguruma_8h.html#a13b0e230fa74c42ddd7b50fb6ad9d3b4">ONIG_SYN_OP2_QMARK_GROUP_EFFECT</a>)) {
<a name="l03754"></a>03754         <a class="code" href="../../d6/dda/regparse_8c.html#a0545e73dc7ae14b1f62293c1feba3983">PINC</a>;
<a name="l03755"></a>03755         <span class="keywordflow">if</span> (<a class="code" href="../../d6/dda/regparse_8c.html#a4ed53b7baf65c82f4ba37027979ed82d">PPEEK_IS</a>(<span class="charliteral">&apos;#&apos;</span>)) {
<a name="l03756"></a>03756           <a class="code" href="../../d6/dda/regparse_8c.html#a8a8898c873b81a88454a968371696cab">PFETCH</a>(c);
<a name="l03757"></a>03757           <span class="keywordflow">while</span> (1) {
<a name="l03758"></a>03758             <span class="keywordflow">if</span> (<a class="code" href="../../d6/dda/regparse_8c.html#a43ce1d83d1961694adc2dfcbfac7d690">PEND</a>) <span class="keywordflow">return</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#aa914f30bf7876b915b075d14df37ae96">ONIGERR_END_PATTERN_IN_GROUP</a>;
<a name="l03759"></a>03759             <a class="code" href="../../d6/dda/regparse_8c.html#a8a8898c873b81a88454a968371696cab">PFETCH</a>(c);
<a name="l03760"></a>03760             <span class="keywordflow">if</span> (c == <a class="code" href="../../d6/d87/regint_8h.html#ae4a605f4b8bee0d69ab6d6418ddbec1b">MC_ESC</a>(syn)) {
<a name="l03761"></a>03761               <span class="keywordflow">if</span> (!<a class="code" href="../../d6/dda/regparse_8c.html#a43ce1d83d1961694adc2dfcbfac7d690">PEND</a>) <a class="code" href="../../d6/dda/regparse_8c.html#a8a8898c873b81a88454a968371696cab">PFETCH</a>(c);
<a name="l03762"></a>03762             }
<a name="l03763"></a>03763             <span class="keywordflow">else</span> {
<a name="l03764"></a>03764               <span class="keywordflow">if</span> (c == <span class="charliteral">&apos;)&apos;</span>) <span class="keywordflow">break</span>;
<a name="l03765"></a>03765             }
<a name="l03766"></a>03766           }
<a name="l03767"></a>03767           <span class="keywordflow">goto</span> start;
<a name="l03768"></a>03768         }
<a name="l03769"></a>03769         <a class="code" href="../../d6/dda/regparse_8c.html#ad0350add3c44d502c77357f6012b1bf2">PUNFETCH</a>;
<a name="l03770"></a>03770       }
<a name="l03771"></a>03771 
<a name="l03772"></a>03772       <span class="keywordflow">if</span> (! <a class="code" href="../../d1/dfc/regparse_8h.html#aeeb7aa0f60553ade62b7338e8f21256b">IS_SYNTAX_OP</a>(syn, <a class="code" href="../../d8/db3/oniguruma_8h.html#a020a7e28ba6433d3336031b385f30e33">ONIG_SYN_OP_LPAREN_SUBEXP</a>)) <span class="keywordflow">break</span>;
<a name="l03773"></a>03773       tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#a46f3343f204ac67de13f0a774284e476">type</a> = <a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250da6d28cfb6350f8a3218170fd0f913aec3">TK_SUBEXP_OPEN</a>;
<a name="l03774"></a>03774       <span class="keywordflow">break</span>;
<a name="l03775"></a>03775 
<a name="l03776"></a>03776     <span class="keywordflow">case</span> <span class="charliteral">&apos;)&apos;</span>:
<a name="l03777"></a>03777       <span class="keywordflow">if</span> (! <a class="code" href="../../d1/dfc/regparse_8h.html#aeeb7aa0f60553ade62b7338e8f21256b">IS_SYNTAX_OP</a>(syn, <a class="code" href="../../d8/db3/oniguruma_8h.html#a020a7e28ba6433d3336031b385f30e33">ONIG_SYN_OP_LPAREN_SUBEXP</a>)) <span class="keywordflow">break</span>;
<a name="l03778"></a>03778       tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#a46f3343f204ac67de13f0a774284e476">type</a> = <a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250da2abb18f0f4ef734b4ce575c044b4e1e7">TK_SUBEXP_CLOSE</a>;
<a name="l03779"></a>03779       <span class="keywordflow">break</span>;
<a name="l03780"></a>03780 
<a name="l03781"></a>03781     <span class="keywordflow">case</span> <span class="charliteral">&apos;^&apos;</span>:
<a name="l03782"></a>03782       <span class="keywordflow">if</span> (! <a class="code" href="../../d1/dfc/regparse_8h.html#aeeb7aa0f60553ade62b7338e8f21256b">IS_SYNTAX_OP</a>(syn, <a class="code" href="../../d8/db3/oniguruma_8h.html#a745bbb9c29137903bffbd5696cff8c67">ONIG_SYN_OP_LINE_ANCHOR</a>)) <span class="keywordflow">break</span>;
<a name="l03783"></a>03783       tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#a46f3343f204ac67de13f0a774284e476">type</a> = <a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250da35870f30489b8c9a3dc0c7197b8e880b">TK_ANCHOR</a>;
<a name="l03784"></a>03784       tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#aaea3a0bd5a46ef32e4a9552046a070b3">u</a>.<a class="code" href="../../d0/d80/struct_onig_token.html#a35c9bc2e550c33f1909fa430fa3e7733">subtype</a> = (<a class="code" href="../../d6/d87/regint_8h.html#ac13bf2e47ce6f25b2b1787efd072686a">IS_SINGLELINE</a>(env-&gt;<a class="code" href="../../d6/dbe/struct_scan_env.html#a1a7599f3079dfc7ab6d0b317f0f37d93">option</a>)
<a name="l03785"></a>03785                         ? <a class="code" href="../../d6/d87/regint_8h.html#a5730b2ca5b8a8bbe5262c77ee26b7879">ANCHOR_BEGIN_BUF</a> : <a class="code" href="../../d6/d87/regint_8h.html#a0d426ab760f616696759ce14c060b622">ANCHOR_BEGIN_LINE</a>);
<a name="l03786"></a>03786       <span class="keywordflow">break</span>;
<a name="l03787"></a>03787 
<a name="l03788"></a>03788     <span class="keywordflow">case</span> <span class="charliteral">&apos;$&apos;</span>:
<a name="l03789"></a>03789       <span class="keywordflow">if</span> (! <a class="code" href="../../d1/dfc/regparse_8h.html#aeeb7aa0f60553ade62b7338e8f21256b">IS_SYNTAX_OP</a>(syn, <a class="code" href="../../d8/db3/oniguruma_8h.html#a745bbb9c29137903bffbd5696cff8c67">ONIG_SYN_OP_LINE_ANCHOR</a>)) <span class="keywordflow">break</span>;
<a name="l03790"></a>03790       tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#a46f3343f204ac67de13f0a774284e476">type</a> = <a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250da35870f30489b8c9a3dc0c7197b8e880b">TK_ANCHOR</a>;
<a name="l03791"></a>03791       tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#aaea3a0bd5a46ef32e4a9552046a070b3">u</a>.<a class="code" href="../../d0/d80/struct_onig_token.html#a35c9bc2e550c33f1909fa430fa3e7733">subtype</a> = (<a class="code" href="../../d6/d87/regint_8h.html#ac13bf2e47ce6f25b2b1787efd072686a">IS_SINGLELINE</a>(env-&gt;<a class="code" href="../../d6/dbe/struct_scan_env.html#a1a7599f3079dfc7ab6d0b317f0f37d93">option</a>)
<a name="l03792"></a>03792                         ? <a class="code" href="../../d6/d87/regint_8h.html#a9336254890d4656b7e36574b462ca093">ANCHOR_SEMI_END_BUF</a> : <a class="code" href="../../d6/d87/regint_8h.html#a4dd9db8ffc551d1a759f1fac90baff78">ANCHOR_END_LINE</a>);
<a name="l03793"></a>03793       <span class="keywordflow">break</span>;
<a name="l03794"></a>03794 
<a name="l03795"></a>03795     <span class="keywordflow">case</span> <span class="charliteral">&apos;[&apos;</span>:
<a name="l03796"></a>03796       <span class="keywordflow">if</span> (! <a class="code" href="../../d1/dfc/regparse_8h.html#aeeb7aa0f60553ade62b7338e8f21256b">IS_SYNTAX_OP</a>(syn, <a class="code" href="../../d8/db3/oniguruma_8h.html#a20e0285fa49a7fceffaf7e268a15f395">ONIG_SYN_OP_BRACKET_CC</a>)) <span class="keywordflow">break</span>;
<a name="l03797"></a>03797       tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#a46f3343f204ac67de13f0a774284e476">type</a> = <a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250da5817d25633c6a037e356c292ea7622d7">TK_CC_OPEN</a>;
<a name="l03798"></a>03798       <span class="keywordflow">break</span>;
<a name="l03799"></a>03799 
<a name="l03800"></a>03800     <span class="keywordflow">case</span> <span class="charliteral">&apos;]&apos;</span>:
<a name="l03801"></a>03801       <span class="keywordflow">if</span> (*src &gt; env-&gt;<a class="code" href="../../d6/dbe/struct_scan_env.html#af50cd3b4f33598bb18cd17465186775e">pattern</a>)   <span class="comment">/* /].../ is allowed. */</span>
<a name="l03802"></a>03802         <a class="code" href="../../d6/dda/regparse_8c.html#a601f73629174ca96bc93fd877f69403d">CLOSE_BRACKET_WITHOUT_ESC_WARN</a>(env, (<a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>* )<span class="stringliteral">&quot;]&quot;</span>);
<a name="l03803"></a>03803       <span class="keywordflow">break</span>;
<a name="l03804"></a>03804 
<a name="l03805"></a>03805     <span class="keywordflow">case</span> <span class="charliteral">&apos;#&apos;</span>:
<a name="l03806"></a>03806       <span class="keywordflow">if</span> (<a class="code" href="../../d6/d87/regint_8h.html#ac8a8a3804c2b131cfaf65714abecd105">IS_EXTEND</a>(env-&gt;<a class="code" href="../../d6/dbe/struct_scan_env.html#a1a7599f3079dfc7ab6d0b317f0f37d93">option</a>)) {
<a name="l03807"></a>03807         <span class="keywordflow">while</span> (!<a class="code" href="../../d6/dda/regparse_8c.html#a43ce1d83d1961694adc2dfcbfac7d690">PEND</a>) {
<a name="l03808"></a>03808           <a class="code" href="../../d6/dda/regparse_8c.html#a8a8898c873b81a88454a968371696cab">PFETCH</a>(c);
<a name="l03809"></a>03809           <span class="keywordflow">if</span> (<a class="code" href="../../d8/db3/oniguruma_8h.html#afe325e094cd9677e27e2bbe095ff1b16">ONIGENC_IS_CODE_NEWLINE</a>(enc, c))
<a name="l03810"></a>03810             <span class="keywordflow">break</span>;
<a name="l03811"></a>03811         }
<a name="l03812"></a>03812         <span class="keywordflow">goto</span> start;
<a name="l03813"></a>03813         <span class="keywordflow">break</span>;
<a name="l03814"></a>03814       }
<a name="l03815"></a>03815       <span class="keywordflow">break</span>;
<a name="l03816"></a>03816 
<a name="l03817"></a>03817     <span class="keywordflow">case</span> <span class="charliteral">&apos; &apos;</span>: <span class="keywordflow">case</span> <span class="charliteral">&apos;\t&apos;</span>: <span class="keywordflow">case</span> <span class="charliteral">&apos;\n&apos;</span>: <span class="keywordflow">case</span> <span class="charliteral">&apos;\r&apos;</span>: <span class="keywordflow">case</span> <span class="charliteral">&apos;\f&apos;</span>:
<a name="l03818"></a>03818       <span class="keywordflow">if</span> (<a class="code" href="../../d6/d87/regint_8h.html#ac8a8a3804c2b131cfaf65714abecd105">IS_EXTEND</a>(env-&gt;<a class="code" href="../../d6/dbe/struct_scan_env.html#a1a7599f3079dfc7ab6d0b317f0f37d93">option</a>))
<a name="l03819"></a>03819         <span class="keywordflow">goto</span> start;
<a name="l03820"></a>03820       <span class="keywordflow">break</span>;
<a name="l03821"></a>03821 
<a name="l03822"></a>03822     <span class="keywordflow">default</span>:
<a name="l03823"></a>03823       <span class="comment">/* string */</span>
<a name="l03824"></a>03824       <span class="keywordflow">break</span>;
<a name="l03825"></a>03825     }
<a name="l03826"></a>03826   }
<a name="l03827"></a>03827 
<a name="l03828"></a>03828 <span class="preprocessor">#ifdef USE_VARIABLE_META_CHARS</span>
<a name="l03829"></a>03829 <span class="preprocessor"></span> out:
<a name="l03830"></a>03830 <span class="preprocessor">#endif</span>
<a name="l03831"></a>03831 <span class="preprocessor"></span>  *src = p;
<a name="l03832"></a>03832   <span class="keywordflow">return</span> tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#a46f3343f204ac67de13f0a774284e476">type</a>;
<a name="l03833"></a>03833 }
<a name="l03834"></a>03834 
<a name="l03835"></a>03835 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l03836"></a><a class="code" href="../../d6/dda/regparse_8c.html#ad258ca88905c9338718a8d398b51cbbf">03836</a> <a class="code" href="../../d6/dda/regparse_8c.html#ad258ca88905c9338718a8d398b51cbbf">add_ctype_to_cc_by_range</a>(<a class="code" href="../../d8/d79/struct_c_class_node.html">CClassNode</a>* cc, <span class="keywordtype">int</span> ctype ARG_UNUSED, <span class="keywordtype">int</span> not,
<a name="l03837"></a>03837                          <a class="code" href="../../d6/dbe/struct_scan_env.html">ScanEnv</a>* env,
<a name="l03838"></a>03838                          <a class="code" href="../../d8/db3/oniguruma_8h.html#a7c8a84bc12127007886efbfcf53b6fb5">OnigCodePoint</a> sb_out, <span class="keyword">const</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#a7c8a84bc12127007886efbfcf53b6fb5">OnigCodePoint</a> mbr[])
<a name="l03839"></a>03839 {
<a name="l03840"></a>03840   <span class="keywordtype">int</span> i, r;
<a name="l03841"></a>03841   <a class="code" href="../../d8/db3/oniguruma_8h.html#a7c8a84bc12127007886efbfcf53b6fb5">OnigCodePoint</a> j;
<a name="l03842"></a>03842 
<a name="l03843"></a>03843   <span class="keywordtype">int</span> n = <a class="code" href="../../d8/db3/oniguruma_8h.html#ab94c91d5d242fb022443401092575f63">ONIGENC_CODE_RANGE_NUM</a>(mbr);
<a name="l03844"></a>03844 
<a name="l03845"></a>03845   <span class="keywordflow">if</span> (not == 0) {
<a name="l03846"></a>03846     <span class="keywordflow">for</span> (i = 0; i &lt; n; i++) {
<a name="l03847"></a>03847       <span class="keywordflow">for</span> (j  = <a class="code" href="../../d8/db3/oniguruma_8h.html#a2e05e13ed865ef08054cc10486015717">ONIGENC_CODE_RANGE_FROM</a>(mbr, i);
<a name="l03848"></a>03848            j &lt;= <a class="code" href="../../d8/db3/oniguruma_8h.html#ac115987e0dd65b25788f5ccb8e4b7ed1">ONIGENC_CODE_RANGE_TO</a>(mbr, i); j++) {
<a name="l03849"></a>03849         <span class="keywordflow">if</span> (j &gt;= sb_out) {
<a name="l03850"></a>03850           <span class="keywordflow">if</span> (j &gt; <a class="code" href="../../d8/db3/oniguruma_8h.html#a2e05e13ed865ef08054cc10486015717">ONIGENC_CODE_RANGE_FROM</a>(mbr, i)) {
<a name="l03851"></a>03851             r = <a class="code" href="../../d6/dda/regparse_8c.html#a4a737460fe75cbdeebcb1a4a2738358c">add_code_range_to_buf</a>(&amp;(cc-&gt;<a class="code" href="../../d8/d79/struct_c_class_node.html#a599db43b8eea536a4e4d08400fa445cb">mbuf</a>), env, j,
<a name="l03852"></a>03852                                       <a class="code" href="../../d8/db3/oniguruma_8h.html#ac115987e0dd65b25788f5ccb8e4b7ed1">ONIGENC_CODE_RANGE_TO</a>(mbr, i));
<a name="l03853"></a>03853             <span class="keywordflow">if</span> (r != 0) <span class="keywordflow">return</span> r;
<a name="l03854"></a>03854             i++;
<a name="l03855"></a>03855           }
<a name="l03856"></a>03856 
<a name="l03857"></a>03857           <span class="keywordflow">goto</span> sb_end;
<a name="l03858"></a>03858         }
<a name="l03859"></a>03859         <a class="code" href="../../d6/dda/regparse_8c.html#acafa6a8e6b897efa2f65abaf8790a220">BITSET_SET_BIT_CHKDUP</a>(cc-&gt;<a class="code" href="../../d8/d79/struct_c_class_node.html#a082458e56c928f78db90f08e242a9f3d">bs</a>, j);
<a name="l03860"></a>03860       }
<a name="l03861"></a>03861     }
<a name="l03862"></a>03862 
<a name="l03863"></a>03863   sb_end:
<a name="l03864"></a>03864     <span class="keywordflow">for</span> ( ; i &lt; n; i++) {
<a name="l03865"></a>03865       r = <a class="code" href="../../d6/dda/regparse_8c.html#a4a737460fe75cbdeebcb1a4a2738358c">add_code_range_to_buf</a>(&amp;(cc-&gt;<a class="code" href="../../d8/d79/struct_c_class_node.html#a599db43b8eea536a4e4d08400fa445cb">mbuf</a>), env,
<a name="l03866"></a>03866                                 <a class="code" href="../../d8/db3/oniguruma_8h.html#a2e05e13ed865ef08054cc10486015717">ONIGENC_CODE_RANGE_FROM</a>(mbr, i),
<a name="l03867"></a>03867                                 <a class="code" href="../../d8/db3/oniguruma_8h.html#ac115987e0dd65b25788f5ccb8e4b7ed1">ONIGENC_CODE_RANGE_TO</a>(mbr, i));
<a name="l03868"></a>03868       <span class="keywordflow">if</span> (r != 0) <span class="keywordflow">return</span> r;
<a name="l03869"></a>03869     }
<a name="l03870"></a>03870   }
<a name="l03871"></a>03871   <span class="keywordflow">else</span> {
<a name="l03872"></a>03872     <a class="code" href="../../d8/db3/oniguruma_8h.html#a7c8a84bc12127007886efbfcf53b6fb5">OnigCodePoint</a> <a class="code" href="../../d7/dc0/parse_8y.html#a71f8b6ffdc0cc58ffd989c3162fb2bcf">prev</a> = 0;
<a name="l03873"></a>03873 
<a name="l03874"></a>03874     <span class="keywordflow">for</span> (i = 0; i &lt; n; i++) {
<a name="l03875"></a>03875       <span class="keywordflow">for</span> (j = prev;
<a name="l03876"></a>03876            j &lt; <a class="code" href="../../d8/db3/oniguruma_8h.html#a2e05e13ed865ef08054cc10486015717">ONIGENC_CODE_RANGE_FROM</a>(mbr, i); j++) {
<a name="l03877"></a>03877         <span class="keywordflow">if</span> (j &gt;= sb_out) {
<a name="l03878"></a>03878           <span class="keywordflow">goto</span> sb_end2;
<a name="l03879"></a>03879         }
<a name="l03880"></a>03880         <a class="code" href="../../d6/dda/regparse_8c.html#acafa6a8e6b897efa2f65abaf8790a220">BITSET_SET_BIT_CHKDUP</a>(cc-&gt;<a class="code" href="../../d8/d79/struct_c_class_node.html#a082458e56c928f78db90f08e242a9f3d">bs</a>, j);
<a name="l03881"></a>03881       }
<a name="l03882"></a>03882       prev = <a class="code" href="../../d8/db3/oniguruma_8h.html#ac115987e0dd65b25788f5ccb8e4b7ed1">ONIGENC_CODE_RANGE_TO</a>(mbr, i) + 1;
<a name="l03883"></a>03883     }
<a name="l03884"></a>03884     <span class="keywordflow">for</span> (j = prev; j &lt; sb_out; j++) {
<a name="l03885"></a>03885       <a class="code" href="../../d6/dda/regparse_8c.html#acafa6a8e6b897efa2f65abaf8790a220">BITSET_SET_BIT_CHKDUP</a>(cc-&gt;<a class="code" href="../../d8/d79/struct_c_class_node.html#a082458e56c928f78db90f08e242a9f3d">bs</a>, j);
<a name="l03886"></a>03886     }
<a name="l03887"></a>03887 
<a name="l03888"></a>03888   sb_end2:
<a name="l03889"></a>03889     prev = sb_out;
<a name="l03890"></a>03890 
<a name="l03891"></a>03891     <span class="keywordflow">for</span> (i = 0; i &lt; n; i++) {
<a name="l03892"></a>03892       <span class="keywordflow">if</span> (prev &lt; <a class="code" href="../../d8/db3/oniguruma_8h.html#a2e05e13ed865ef08054cc10486015717">ONIGENC_CODE_RANGE_FROM</a>(mbr, i)) {
<a name="l03893"></a>03893         r = <a class="code" href="../../d6/dda/regparse_8c.html#a4a737460fe75cbdeebcb1a4a2738358c">add_code_range_to_buf</a>(&amp;(cc-&gt;<a class="code" href="../../d8/d79/struct_c_class_node.html#a599db43b8eea536a4e4d08400fa445cb">mbuf</a>), env, prev,
<a name="l03894"></a>03894                                   <a class="code" href="../../d8/db3/oniguruma_8h.html#a2e05e13ed865ef08054cc10486015717">ONIGENC_CODE_RANGE_FROM</a>(mbr, i) - 1);
<a name="l03895"></a>03895         <span class="keywordflow">if</span> (r != 0) <span class="keywordflow">return</span> r;
<a name="l03896"></a>03896       }
<a name="l03897"></a>03897       prev = <a class="code" href="../../d8/db3/oniguruma_8h.html#ac115987e0dd65b25788f5ccb8e4b7ed1">ONIGENC_CODE_RANGE_TO</a>(mbr, i) + 1;
<a name="l03898"></a>03898     }
<a name="l03899"></a>03899     <span class="keywordflow">if</span> (prev &lt; 0x7fffffff) {
<a name="l03900"></a>03900       r = <a class="code" href="../../d6/dda/regparse_8c.html#a4a737460fe75cbdeebcb1a4a2738358c">add_code_range_to_buf</a>(&amp;(cc-&gt;<a class="code" href="../../d8/d79/struct_c_class_node.html#a599db43b8eea536a4e4d08400fa445cb">mbuf</a>), env, prev, 0x7fffffff);
<a name="l03901"></a>03901       <span class="keywordflow">if</span> (r != 0) <span class="keywordflow">return</span> r;
<a name="l03902"></a>03902     }
<a name="l03903"></a>03903   }
<a name="l03904"></a>03904 
<a name="l03905"></a>03905   <span class="keywordflow">return</span> 0;
<a name="l03906"></a>03906 }
<a name="l03907"></a>03907 
<a name="l03908"></a>03908 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l03909"></a><a class="code" href="../../d6/dda/regparse_8c.html#a30cf0640cd2a2e99e72171d90a4213f6">03909</a> <a class="code" href="../../d6/dda/regparse_8c.html#a30cf0640cd2a2e99e72171d90a4213f6">add_ctype_to_cc</a>(<a class="code" href="../../d8/d79/struct_c_class_node.html">CClassNode</a>* cc, <span class="keywordtype">int</span> ctype, <span class="keywordtype">int</span> not, <a class="code" href="../../d6/dbe/struct_scan_env.html">ScanEnv</a>* env)
<a name="l03910"></a>03910 {
<a name="l03911"></a>03911   <span class="keywordtype">int</span> c, r;
<a name="l03912"></a>03912   <span class="keyword">const</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#a7c8a84bc12127007886efbfcf53b6fb5">OnigCodePoint</a> *ranges;
<a name="l03913"></a>03913   <a class="code" href="../../d8/db3/oniguruma_8h.html#a7c8a84bc12127007886efbfcf53b6fb5">OnigCodePoint</a> sb_out;
<a name="l03914"></a>03914   <a class="code" href="../../d1/d7b/struct_onig_encoding_type_s_t.html">OnigEncoding</a> enc = env-&gt;<a class="code" href="../../d6/dbe/struct_scan_env.html#a97f766db4ac9dabc9d173bf99fbcc11b">enc</a>;
<a name="l03915"></a>03915 
<a name="l03916"></a>03916   <span class="keywordflow">switch</span> (ctype) {
<a name="l03917"></a>03917   <span class="keywordflow">case</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#a4878161b7a1adcf807bcff0a8722e778">ONIGENC_CTYPE_D</a>:
<a name="l03918"></a>03918   <span class="keywordflow">case</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#a8613b809ebb0533177db19ceb9eff366">ONIGENC_CTYPE_S</a>:
<a name="l03919"></a>03919   <span class="keywordflow">case</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#aaf70c7a1261acd2f76a4db97af5b3226">ONIGENC_CTYPE_W</a>:
<a name="l03920"></a>03920     ctype ^= <a class="code" href="../../d8/db3/oniguruma_8h.html#adfd54ee5f6831e5322f2fe8c43ba051c">ONIGENC_CTYPE_SPECIAL_MASK</a>;
<a name="l03921"></a>03921     <span class="keywordflow">if</span> (not != 0) {
<a name="l03922"></a>03922       <span class="keywordflow">for</span> (c = 0; c &lt; <a class="code" href="../../d6/d87/regint_8h.html#a8bdc62bcdfffb01985810f7aa61d5999">SINGLE_BYTE_SIZE</a>; c++) {
<a name="l03923"></a>03923         <span class="keywordflow">if</span> (! <a class="code" href="../../d3/d09/ripper_8y.html#ab38daef12b61ae626fd8ca9b3bf16b55">ONIGENC_IS_ASCII_CODE_CTYPE</a>((<a class="code" href="../../d8/db3/oniguruma_8h.html#a7c8a84bc12127007886efbfcf53b6fb5">OnigCodePoint</a> )c, ctype))
<a name="l03924"></a>03924           <a class="code" href="../../d6/dda/regparse_8c.html#acafa6a8e6b897efa2f65abaf8790a220">BITSET_SET_BIT_CHKDUP</a>(cc-&gt;<a class="code" href="../../d8/d79/struct_c_class_node.html#a082458e56c928f78db90f08e242a9f3d">bs</a>, c);
<a name="l03925"></a>03925       }
<a name="l03926"></a>03926       <a class="code" href="../../d6/dda/regparse_8c.html#a6742d030e4c0a6bbfda108f94e1554a9">ADD_ALL_MULTI_BYTE_RANGE</a>(enc, cc-&gt;<a class="code" href="../../d8/d79/struct_c_class_node.html#a599db43b8eea536a4e4d08400fa445cb">mbuf</a>);
<a name="l03927"></a>03927     }
<a name="l03928"></a>03928     <span class="keywordflow">else</span> {
<a name="l03929"></a>03929       <span class="keywordflow">for</span> (c = 0; c &lt; <a class="code" href="../../d6/d87/regint_8h.html#a8bdc62bcdfffb01985810f7aa61d5999">SINGLE_BYTE_SIZE</a>; c++) {
<a name="l03930"></a>03930         <span class="keywordflow">if</span> (<a class="code" href="../../d3/d09/ripper_8y.html#ab38daef12b61ae626fd8ca9b3bf16b55">ONIGENC_IS_ASCII_CODE_CTYPE</a>((<a class="code" href="../../d8/db3/oniguruma_8h.html#a7c8a84bc12127007886efbfcf53b6fb5">OnigCodePoint</a> )c, ctype))
<a name="l03931"></a>03931           <a class="code" href="../../d6/dda/regparse_8c.html#acafa6a8e6b897efa2f65abaf8790a220">BITSET_SET_BIT_CHKDUP</a>(cc-&gt;<a class="code" href="../../d8/d79/struct_c_class_node.html#a082458e56c928f78db90f08e242a9f3d">bs</a>, c);
<a name="l03932"></a>03932       }
<a name="l03933"></a>03933     }
<a name="l03934"></a>03934     <span class="keywordflow">return</span> 0;
<a name="l03935"></a>03935     <span class="keywordflow">break</span>;
<a name="l03936"></a>03936   }
<a name="l03937"></a>03937 
<a name="l03938"></a>03938   r = <a class="code" href="../../d8/db3/oniguruma_8h.html#adadc7b6817d54b859f2aeabcf97d4ed7">ONIGENC_GET_CTYPE_CODE_RANGE</a>(enc, ctype, &amp;sb_out, &amp;ranges);
<a name="l03939"></a>03939   <span class="keywordflow">if</span> (r == 0) {
<a name="l03940"></a>03940     <span class="keywordflow">return</span> <a class="code" href="../../d6/dda/regparse_8c.html#ad258ca88905c9338718a8d398b51cbbf">add_ctype_to_cc_by_range</a>(cc, ctype, not, env, sb_out, ranges);
<a name="l03941"></a>03941   }
<a name="l03942"></a>03942   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (r != <a class="code" href="../../d8/db3/oniguruma_8h.html#a15b7ec1aacde53c3328846512ede4f06">ONIG_NO_SUPPORT_CONFIG</a>) {
<a name="l03943"></a>03943     <span class="keywordflow">return</span> r;
<a name="l03944"></a>03944   }
<a name="l03945"></a>03945 
<a name="l03946"></a>03946   r = 0;
<a name="l03947"></a>03947   <span class="keywordflow">switch</span> (ctype) {
<a name="l03948"></a>03948   <span class="keywordflow">case</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#a4a3a6205038ed0a845d462f8dde01dde">ONIGENC_CTYPE_ALPHA</a>:
<a name="l03949"></a>03949   <span class="keywordflow">case</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#aad0d1e1de6d8f3854b81f1c1a9725e51">ONIGENC_CTYPE_BLANK</a>:
<a name="l03950"></a>03950   <span class="keywordflow">case</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#a9f97a5cd48dddfdbb8b6c37f20546bcc">ONIGENC_CTYPE_CNTRL</a>:
<a name="l03951"></a>03951   <span class="keywordflow">case</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#a14f0f2ce858aa271891329a3c5a9f6cb">ONIGENC_CTYPE_DIGIT</a>:
<a name="l03952"></a>03952   <span class="keywordflow">case</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#ab0a9ec0d461838dd2402156adf534b58">ONIGENC_CTYPE_LOWER</a>:
<a name="l03953"></a>03953   <span class="keywordflow">case</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#a58ef882d5cf53d2248c7ec9952e27d8a">ONIGENC_CTYPE_PUNCT</a>:
<a name="l03954"></a>03954   <span class="keywordflow">case</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#a4bb931592f6bcd2ab5ae44c5d866a094">ONIGENC_CTYPE_SPACE</a>:
<a name="l03955"></a>03955   <span class="keywordflow">case</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#a711c009b800441218b91d3c13c18fe46">ONIGENC_CTYPE_UPPER</a>:
<a name="l03956"></a>03956   <span class="keywordflow">case</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#a2964cbf76712be02ed2d0f07e4b8386e">ONIGENC_CTYPE_XDIGIT</a>:
<a name="l03957"></a>03957   <span class="keywordflow">case</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#a0c3ac345ed4f16f43dd61ef429ddb53c">ONIGENC_CTYPE_ASCII</a>:
<a name="l03958"></a>03958   <span class="keywordflow">case</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#a458b31fe7df4f9465e9096b5ea4ef6a8">ONIGENC_CTYPE_ALNUM</a>:
<a name="l03959"></a>03959     <span class="keywordflow">if</span> (not != 0) {
<a name="l03960"></a>03960       <span class="keywordflow">for</span> (c = 0; c &lt; <a class="code" href="../../d6/d87/regint_8h.html#a8bdc62bcdfffb01985810f7aa61d5999">SINGLE_BYTE_SIZE</a>; c++) {
<a name="l03961"></a>03961         <span class="keywordflow">if</span> (! <a class="code" href="../../d8/db3/oniguruma_8h.html#a272fbb8f2f082d39929218bbbc0ad124">ONIGENC_IS_CODE_CTYPE</a>(enc, (<a class="code" href="../../d8/db3/oniguruma_8h.html#a7c8a84bc12127007886efbfcf53b6fb5">OnigCodePoint</a> )c, ctype))
<a name="l03962"></a>03962           <a class="code" href="../../d6/dda/regparse_8c.html#acafa6a8e6b897efa2f65abaf8790a220">BITSET_SET_BIT_CHKDUP</a>(cc-&gt;<a class="code" href="../../d8/d79/struct_c_class_node.html#a082458e56c928f78db90f08e242a9f3d">bs</a>, c);
<a name="l03963"></a>03963       }
<a name="l03964"></a>03964       <a class="code" href="../../d6/dda/regparse_8c.html#a6742d030e4c0a6bbfda108f94e1554a9">ADD_ALL_MULTI_BYTE_RANGE</a>(enc, cc-&gt;<a class="code" href="../../d8/d79/struct_c_class_node.html#a599db43b8eea536a4e4d08400fa445cb">mbuf</a>);
<a name="l03965"></a>03965     }
<a name="l03966"></a>03966     <span class="keywordflow">else</span> {
<a name="l03967"></a>03967       <span class="keywordflow">for</span> (c = 0; c &lt; <a class="code" href="../../d6/d87/regint_8h.html#a8bdc62bcdfffb01985810f7aa61d5999">SINGLE_BYTE_SIZE</a>; c++) {
<a name="l03968"></a>03968         <span class="keywordflow">if</span> (<a class="code" href="../../d8/db3/oniguruma_8h.html#a272fbb8f2f082d39929218bbbc0ad124">ONIGENC_IS_CODE_CTYPE</a>(enc, (<a class="code" href="../../d8/db3/oniguruma_8h.html#a7c8a84bc12127007886efbfcf53b6fb5">OnigCodePoint</a> )c, ctype))
<a name="l03969"></a>03969           <a class="code" href="../../d6/dda/regparse_8c.html#acafa6a8e6b897efa2f65abaf8790a220">BITSET_SET_BIT_CHKDUP</a>(cc-&gt;<a class="code" href="../../d8/d79/struct_c_class_node.html#a082458e56c928f78db90f08e242a9f3d">bs</a>, c);
<a name="l03970"></a>03970       }
<a name="l03971"></a>03971     }
<a name="l03972"></a>03972     <span class="keywordflow">break</span>;
<a name="l03973"></a>03973 
<a name="l03974"></a>03974   <span class="keywordflow">case</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#a085017ee7dd1400a949e39daea210db9">ONIGENC_CTYPE_GRAPH</a>:
<a name="l03975"></a>03975   <span class="keywordflow">case</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#aa0ba2674fa84ef8eebf458c065d1ae2e">ONIGENC_CTYPE_PRINT</a>:
<a name="l03976"></a>03976     <span class="keywordflow">if</span> (not != 0) {
<a name="l03977"></a>03977       <span class="keywordflow">for</span> (c = 0; c &lt; <a class="code" href="../../d6/d87/regint_8h.html#a8bdc62bcdfffb01985810f7aa61d5999">SINGLE_BYTE_SIZE</a>; c++) {
<a name="l03978"></a>03978         <span class="keywordflow">if</span> (! <a class="code" href="../../d8/db3/oniguruma_8h.html#a272fbb8f2f082d39929218bbbc0ad124">ONIGENC_IS_CODE_CTYPE</a>(enc, (<a class="code" href="../../d8/db3/oniguruma_8h.html#a7c8a84bc12127007886efbfcf53b6fb5">OnigCodePoint</a> )c, ctype))
<a name="l03979"></a>03979           <a class="code" href="../../d6/dda/regparse_8c.html#acafa6a8e6b897efa2f65abaf8790a220">BITSET_SET_BIT_CHKDUP</a>(cc-&gt;<a class="code" href="../../d8/d79/struct_c_class_node.html#a082458e56c928f78db90f08e242a9f3d">bs</a>, c);
<a name="l03980"></a>03980       }
<a name="l03981"></a>03981     }
<a name="l03982"></a>03982     <span class="keywordflow">else</span> {
<a name="l03983"></a>03983       <span class="keywordflow">for</span> (c = 0; c &lt; <a class="code" href="../../d6/d87/regint_8h.html#a8bdc62bcdfffb01985810f7aa61d5999">SINGLE_BYTE_SIZE</a>; c++) {
<a name="l03984"></a>03984         <span class="keywordflow">if</span> (<a class="code" href="../../d8/db3/oniguruma_8h.html#a272fbb8f2f082d39929218bbbc0ad124">ONIGENC_IS_CODE_CTYPE</a>(enc, (<a class="code" href="../../d8/db3/oniguruma_8h.html#a7c8a84bc12127007886efbfcf53b6fb5">OnigCodePoint</a> )c, ctype))
<a name="l03985"></a>03985           <a class="code" href="../../d6/dda/regparse_8c.html#acafa6a8e6b897efa2f65abaf8790a220">BITSET_SET_BIT_CHKDUP</a>(cc-&gt;<a class="code" href="../../d8/d79/struct_c_class_node.html#a082458e56c928f78db90f08e242a9f3d">bs</a>, c);
<a name="l03986"></a>03986       }
<a name="l03987"></a>03987       <a class="code" href="../../d6/dda/regparse_8c.html#a6742d030e4c0a6bbfda108f94e1554a9">ADD_ALL_MULTI_BYTE_RANGE</a>(enc, cc-&gt;<a class="code" href="../../d8/d79/struct_c_class_node.html#a599db43b8eea536a4e4d08400fa445cb">mbuf</a>);
<a name="l03988"></a>03988     }
<a name="l03989"></a>03989     <span class="keywordflow">break</span>;
<a name="l03990"></a>03990 
<a name="l03991"></a>03991   <span class="keywordflow">case</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#a612fd1e82d5c1d87c6b73c15cee0ae98">ONIGENC_CTYPE_WORD</a>:
<a name="l03992"></a>03992     <span class="keywordflow">if</span> (not == 0) {
<a name="l03993"></a>03993       <span class="keywordflow">for</span> (c = 0; c &lt; <a class="code" href="../../d6/d87/regint_8h.html#a8bdc62bcdfffb01985810f7aa61d5999">SINGLE_BYTE_SIZE</a>; c++) {
<a name="l03994"></a>03994         <span class="keywordflow">if</span> (<a class="code" href="../../d6/d87/regint_8h.html#ac19cd6a0a4522316671da3b0fe76a9d2">IS_CODE_SB_WORD</a>(enc, c)) <a class="code" href="../../d6/dda/regparse_8c.html#acafa6a8e6b897efa2f65abaf8790a220">BITSET_SET_BIT_CHKDUP</a>(cc-&gt;<a class="code" href="../../d8/d79/struct_c_class_node.html#a082458e56c928f78db90f08e242a9f3d">bs</a>, c);
<a name="l03995"></a>03995       }
<a name="l03996"></a>03996       <a class="code" href="../../d6/dda/regparse_8c.html#a6742d030e4c0a6bbfda108f94e1554a9">ADD_ALL_MULTI_BYTE_RANGE</a>(enc, cc-&gt;<a class="code" href="../../d8/d79/struct_c_class_node.html#a599db43b8eea536a4e4d08400fa445cb">mbuf</a>);
<a name="l03997"></a>03997     }
<a name="l03998"></a>03998     <span class="keywordflow">else</span> {
<a name="l03999"></a>03999       <span class="keywordflow">for</span> (c = 0; c &lt; <a class="code" href="../../d6/d87/regint_8h.html#a8bdc62bcdfffb01985810f7aa61d5999">SINGLE_BYTE_SIZE</a>; c++) {
<a name="l04000"></a>04000         <span class="keywordflow">if</span> ((<a class="code" href="../../d8/db3/oniguruma_8h.html#ae9dd2f20953b82ba4589e04fabcadba7">ONIGENC_CODE_TO_MBCLEN</a>(enc, c) &gt; 0) <span class="comment">/* check invalid code point */</span>
<a name="l04001"></a>04001             &amp;&amp; ! <a class="code" href="../../d8/db3/oniguruma_8h.html#a7b44f6afd4815b806827f9440be9e6b6">ONIGENC_IS_CODE_WORD</a>(enc, c))
<a name="l04002"></a>04002           <a class="code" href="../../d6/dda/regparse_8c.html#acafa6a8e6b897efa2f65abaf8790a220">BITSET_SET_BIT_CHKDUP</a>(cc-&gt;<a class="code" href="../../d8/d79/struct_c_class_node.html#a082458e56c928f78db90f08e242a9f3d">bs</a>, c);
<a name="l04003"></a>04003       }
<a name="l04004"></a>04004     }
<a name="l04005"></a>04005     <span class="keywordflow">break</span>;
<a name="l04006"></a>04006 
<a name="l04007"></a>04007   <span class="keywordflow">default</span>:
<a name="l04008"></a>04008     <span class="keywordflow">return</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#a4067ac325df2d4bb0b4d2e692c257a49">ONIGERR_PARSER_BUG</a>;
<a name="l04009"></a>04009     <span class="keywordflow">break</span>;
<a name="l04010"></a>04010   }
<a name="l04011"></a>04011 
<a name="l04012"></a>04012   <span class="keywordflow">return</span> r;
<a name="l04013"></a>04013 }
<a name="l04014"></a>04014 
<a name="l04015"></a>04015 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l04016"></a><a class="code" href="../../d6/dda/regparse_8c.html#aa424960832460720c6888e362f958a1a">04016</a> <a class="code" href="../../d6/dda/regparse_8c.html#aa424960832460720c6888e362f958a1a">parse_posix_bracket</a>(<a class="code" href="../../d8/d79/struct_c_class_node.html">CClassNode</a>* cc, <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>** src, <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>* end, <a class="code" href="../../d6/dbe/struct_scan_env.html">ScanEnv</a>* env)
<a name="l04017"></a>04017 {
<a name="l04018"></a>04018 <span class="preprocessor">#define POSIX_BRACKET_CHECK_LIMIT_LENGTH  20</span>
<a name="l04019"></a>04019 <span class="preprocessor"></span><span class="preprocessor">#define POSIX_BRACKET_NAME_MIN_LEN         4</span>
<a name="l04020"></a>04020 <span class="preprocessor"></span>
<a name="l04021"></a>04021   <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="../../de/d94/struct_posix_bracket_entry_type.html">PosixBracketEntryType</a> PBS[] = {
<a name="l04022"></a>04022     { (<a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>* )<span class="stringliteral">&quot;alnum&quot;</span>,  <a class="code" href="../../d8/db3/oniguruma_8h.html#a458b31fe7df4f9465e9096b5ea4ef6a8">ONIGENC_CTYPE_ALNUM</a>,  5 },
<a name="l04023"></a>04023     { (<a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>* )<span class="stringliteral">&quot;alpha&quot;</span>,  <a class="code" href="../../d8/db3/oniguruma_8h.html#a4a3a6205038ed0a845d462f8dde01dde">ONIGENC_CTYPE_ALPHA</a>,  5 },
<a name="l04024"></a>04024     { (<a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>* )<span class="stringliteral">&quot;blank&quot;</span>,  <a class="code" href="../../d8/db3/oniguruma_8h.html#aad0d1e1de6d8f3854b81f1c1a9725e51">ONIGENC_CTYPE_BLANK</a>,  5 },
<a name="l04025"></a>04025     { (<a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>* )<span class="stringliteral">&quot;cntrl&quot;</span>,  <a class="code" href="../../d8/db3/oniguruma_8h.html#a9f97a5cd48dddfdbb8b6c37f20546bcc">ONIGENC_CTYPE_CNTRL</a>,  5 },
<a name="l04026"></a>04026     { (<a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>* )<span class="stringliteral">&quot;digit&quot;</span>,  <a class="code" href="../../d8/db3/oniguruma_8h.html#a14f0f2ce858aa271891329a3c5a9f6cb">ONIGENC_CTYPE_DIGIT</a>,  5 },
<a name="l04027"></a>04027     { (<a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>* )<span class="stringliteral">&quot;graph&quot;</span>,  <a class="code" href="../../d8/db3/oniguruma_8h.html#a085017ee7dd1400a949e39daea210db9">ONIGENC_CTYPE_GRAPH</a>,  5 },
<a name="l04028"></a>04028     { (<a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>* )<span class="stringliteral">&quot;lower&quot;</span>,  <a class="code" href="../../d8/db3/oniguruma_8h.html#ab0a9ec0d461838dd2402156adf534b58">ONIGENC_CTYPE_LOWER</a>,  5 },
<a name="l04029"></a>04029     { (<a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>* )<span class="stringliteral">&quot;print&quot;</span>,  <a class="code" href="../../d8/db3/oniguruma_8h.html#aa0ba2674fa84ef8eebf458c065d1ae2e">ONIGENC_CTYPE_PRINT</a>,  5 },
<a name="l04030"></a>04030     { (<a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>* )<span class="stringliteral">&quot;punct&quot;</span>,  <a class="code" href="../../d8/db3/oniguruma_8h.html#a58ef882d5cf53d2248c7ec9952e27d8a">ONIGENC_CTYPE_PUNCT</a>,  5 },
<a name="l04031"></a>04031     { (<a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>* )<span class="stringliteral">&quot;space&quot;</span>,  <a class="code" href="../../d8/db3/oniguruma_8h.html#a4bb931592f6bcd2ab5ae44c5d866a094">ONIGENC_CTYPE_SPACE</a>,  5 },
<a name="l04032"></a>04032     { (<a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>* )<span class="stringliteral">&quot;upper&quot;</span>,  <a class="code" href="../../d8/db3/oniguruma_8h.html#a711c009b800441218b91d3c13c18fe46">ONIGENC_CTYPE_UPPER</a>,  5 },
<a name="l04033"></a>04033     { (<a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>* )<span class="stringliteral">&quot;xdigit&quot;</span>, <a class="code" href="../../d8/db3/oniguruma_8h.html#a2964cbf76712be02ed2d0f07e4b8386e">ONIGENC_CTYPE_XDIGIT</a>, 6 },
<a name="l04034"></a>04034     { (<a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>* )<span class="stringliteral">&quot;ascii&quot;</span>,  <a class="code" href="../../d8/db3/oniguruma_8h.html#a0c3ac345ed4f16f43dd61ef429ddb53c">ONIGENC_CTYPE_ASCII</a>,  5 },
<a name="l04035"></a>04035     { (<a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>* )<span class="stringliteral">&quot;word&quot;</span>,   <a class="code" href="../../d8/db3/oniguruma_8h.html#a612fd1e82d5c1d87c6b73c15cee0ae98">ONIGENC_CTYPE_WORD</a>,   4 },
<a name="l04036"></a>04036     { (<a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>* )<a class="code" href="../../d3/d09/ripper_8y.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,     -1, 0 }
<a name="l04037"></a>04037   };
<a name="l04038"></a>04038 
<a name="l04039"></a>04039   <span class="keyword">const</span> <a class="code" href="../../de/d94/struct_posix_bracket_entry_type.html">PosixBracketEntryType</a> *pb;
<a name="l04040"></a>04040   <span class="keywordtype">int</span> not, i, r;
<a name="l04041"></a>04041   <a class="code" href="../../d8/db3/oniguruma_8h.html#a7c8a84bc12127007886efbfcf53b6fb5">OnigCodePoint</a> c;
<a name="l04042"></a>04042   <a class="code" href="../../d1/d7b/struct_onig_encoding_type_s_t.html">OnigEncoding</a> enc = env-&gt;<a class="code" href="../../d6/dbe/struct_scan_env.html#a97f766db4ac9dabc9d173bf99fbcc11b">enc</a>;
<a name="l04043"></a>04043   <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a> *p = *src;
<a name="l04044"></a>04044   <a class="code" href="../../d6/dda/regparse_8c.html#a44975cffe07e4559bf5638cafb4a6b30">PFETCH_READY</a>;
<a name="l04045"></a>04045 
<a name="l04046"></a>04046   <span class="keywordflow">if</span> (<a class="code" href="../../d6/dda/regparse_8c.html#a4ed53b7baf65c82f4ba37027979ed82d">PPEEK_IS</a>(<span class="charliteral">&apos;^&apos;</span>)) {
<a name="l04047"></a>04047     <a class="code" href="../../d6/dda/regparse_8c.html#a0545e73dc7ae14b1f62293c1feba3983">PINC</a>;
<a name="l04048"></a>04048     not = 1;
<a name="l04049"></a>04049   }
<a name="l04050"></a>04050   <span class="keywordflow">else</span>
<a name="l04051"></a>04051     not = 0;
<a name="l04052"></a>04052 
<a name="l04053"></a>04053   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d8e/regenc_8c.html#afe0cc4ddeec0df8528038e1b822d4a37">onigenc_strlen</a>(enc, p, end) &lt; <a class="code" href="../../d6/dda/regparse_8c.html#a2c75f278237daff1beaa644f28baf977">POSIX_BRACKET_NAME_MIN_LEN</a> + 3)
<a name="l04054"></a>04054     <span class="keywordflow">goto</span> not_posix_bracket;
<a name="l04055"></a>04055 
<a name="l04056"></a>04056   <span class="keywordflow">for</span> (pb = PBS; <a class="code" href="../../d6/d87/regint_8h.html#a4bc25fbd4749a2c130d1ae7f15ba140c">IS_NOT_NULL</a>(pb-&gt;<a class="code" href="../../de/d94/struct_posix_bracket_entry_type.html#a68b9f51fce0a0db340eb4caf57d57030">name</a>); pb++) {
<a name="l04057"></a>04057     <span class="keywordflow">if</span> (<a class="code" href="../../d6/d8e/regenc_8c.html#a90b88782935738eef92cd18221080866">onigenc_with_ascii_strncmp</a>(enc, p, end, pb-&gt;<a class="code" href="../../de/d94/struct_posix_bracket_entry_type.html#a68b9f51fce0a0db340eb4caf57d57030">name</a>, pb-&gt;<a class="code" href="../../de/d94/struct_posix_bracket_entry_type.html#a9fec69ab2991b63c85072a39d42f84f3">len</a>) == 0) {
<a name="l04058"></a>04058       p = (<a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>* )<a class="code" href="../../d6/d8e/regenc_8c.html#a1bd982c9f506b6fee7aed5e397deb531">onigenc_step</a>(enc, p, end, pb-&gt;<a class="code" href="../../de/d94/struct_posix_bracket_entry_type.html#a9fec69ab2991b63c85072a39d42f84f3">len</a>);
<a name="l04059"></a>04059       <span class="keywordflow">if</span> (<a class="code" href="../../d6/d8e/regenc_8c.html#a90b88782935738eef92cd18221080866">onigenc_with_ascii_strncmp</a>(enc, p, end, (<a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>* )<span class="stringliteral">&quot;:]&quot;</span>, 2) != 0)
<a name="l04060"></a>04060         <span class="keywordflow">return</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#a81535bab152f8568c0655760b8532f6c">ONIGERR_INVALID_POSIX_BRACKET_TYPE</a>;
<a name="l04061"></a>04061 
<a name="l04062"></a>04062       r = <a class="code" href="../../d6/dda/regparse_8c.html#a30cf0640cd2a2e99e72171d90a4213f6">add_ctype_to_cc</a>(cc, pb-&gt;<a class="code" href="../../de/d94/struct_posix_bracket_entry_type.html#a6f1d899a530999d21278788e3d61ba95">ctype</a>, not, env);
<a name="l04063"></a>04063       <span class="keywordflow">if</span> (r != 0) <span class="keywordflow">return</span> r;
<a name="l04064"></a>04064 
<a name="l04065"></a>04065       <a class="code" href="../../d6/dda/regparse_8c.html#a0545e73dc7ae14b1f62293c1feba3983">PINC</a>; <a class="code" href="../../d6/dda/regparse_8c.html#a0545e73dc7ae14b1f62293c1feba3983">PINC</a>;
<a name="l04066"></a>04066       *src = p;
<a name="l04067"></a>04067       <span class="keywordflow">return</span> 0;
<a name="l04068"></a>04068     }
<a name="l04069"></a>04069   }
<a name="l04070"></a>04070 
<a name="l04071"></a>04071  not_posix_bracket:
<a name="l04072"></a>04072   c = 0;
<a name="l04073"></a>04073   i = 0;
<a name="l04074"></a>04074   <span class="keywordflow">while</span> (!<a class="code" href="../../d6/dda/regparse_8c.html#a43ce1d83d1961694adc2dfcbfac7d690">PEND</a> &amp;&amp; ((c = <a class="code" href="../../d6/dda/regparse_8c.html#a337ed696ab55651d216a34abbafd4cd3">PPEEK</a>) != <span class="charliteral">&apos;:&apos;</span>) &amp;&amp; c != <span class="charliteral">&apos;]&apos;</span>) {
<a name="l04075"></a>04075     <a class="code" href="../../d6/dda/regparse_8c.html#a0545e73dc7ae14b1f62293c1feba3983">PINC</a>;
<a name="l04076"></a>04076     <span class="keywordflow">if</span> (++i &gt; <a class="code" href="../../d6/dda/regparse_8c.html#a5e88b3636c3d6907a52088efa2484733">POSIX_BRACKET_CHECK_LIMIT_LENGTH</a>) <span class="keywordflow">break</span>;
<a name="l04077"></a>04077   }
<a name="l04078"></a>04078   <span class="keywordflow">if</span> (c == <span class="charliteral">&apos;:&apos;</span> &amp;&amp; ! <a class="code" href="../../d6/dda/regparse_8c.html#a43ce1d83d1961694adc2dfcbfac7d690">PEND</a>) {
<a name="l04079"></a>04079     <a class="code" href="../../d6/dda/regparse_8c.html#a0545e73dc7ae14b1f62293c1feba3983">PINC</a>;
<a name="l04080"></a>04080     <span class="keywordflow">if</span> (! <a class="code" href="../../d6/dda/regparse_8c.html#a43ce1d83d1961694adc2dfcbfac7d690">PEND</a>) {
<a name="l04081"></a>04081       <a class="code" href="../../d6/dda/regparse_8c.html#a8a8898c873b81a88454a968371696cab">PFETCH</a>(c);
<a name="l04082"></a>04082       <span class="keywordflow">if</span> (c == <span class="charliteral">&apos;]&apos;</span>)
<a name="l04083"></a>04083         <span class="keywordflow">return</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#a81535bab152f8568c0655760b8532f6c">ONIGERR_INVALID_POSIX_BRACKET_TYPE</a>;
<a name="l04084"></a>04084     }
<a name="l04085"></a>04085   }
<a name="l04086"></a>04086 
<a name="l04087"></a>04087   <span class="keywordflow">return</span> 1;  <span class="comment">/* 1: is not POSIX bracket, but no error. */</span>
<a name="l04088"></a>04088 }
<a name="l04089"></a>04089 
<a name="l04090"></a>04090 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l04091"></a><a class="code" href="../../d6/dda/regparse_8c.html#ad86e55057f2ed2a0364f041801d09a98">04091</a> <a class="code" href="../../d6/dda/regparse_8c.html#ad86e55057f2ed2a0364f041801d09a98">fetch_char_property_to_ctype</a>(<a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>** src, <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>* end, <a class="code" href="../../d6/dbe/struct_scan_env.html">ScanEnv</a>* env)
<a name="l04092"></a>04092 {
<a name="l04093"></a>04093   <span class="keywordtype">int</span> r;
<a name="l04094"></a>04094   <a class="code" href="../../d8/db3/oniguruma_8h.html#a7c8a84bc12127007886efbfcf53b6fb5">OnigCodePoint</a> c;
<a name="l04095"></a>04095   <a class="code" href="../../d1/d7b/struct_onig_encoding_type_s_t.html">OnigEncoding</a> enc = env-&gt;<a class="code" href="../../d6/dbe/struct_scan_env.html#a97f766db4ac9dabc9d173bf99fbcc11b">enc</a>;
<a name="l04096"></a>04096   <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a> *<a class="code" href="../../d7/dc0/parse_8y.html#a71f8b6ffdc0cc58ffd989c3162fb2bcf">prev</a>, *start, *p = *src;
<a name="l04097"></a>04097   <a class="code" href="../../d6/dda/regparse_8c.html#a44975cffe07e4559bf5638cafb4a6b30">PFETCH_READY</a>;
<a name="l04098"></a>04098 
<a name="l04099"></a>04099   r = 0;
<a name="l04100"></a>04100   start = prev = p;
<a name="l04101"></a>04101 
<a name="l04102"></a>04102   <span class="keywordflow">while</span> (!<a class="code" href="../../d6/dda/regparse_8c.html#a43ce1d83d1961694adc2dfcbfac7d690">PEND</a>) {
<a name="l04103"></a>04103     prev = p;
<a name="l04104"></a>04104     <a class="code" href="../../d6/dda/regparse_8c.html#a8a8898c873b81a88454a968371696cab">PFETCH</a>(c);
<a name="l04105"></a>04105     <span class="keywordflow">if</span> (c == <span class="charliteral">&apos;}&apos;</span>) {
<a name="l04106"></a>04106       r = <a class="code" href="../../d8/db3/oniguruma_8h.html#a695118ec85ed0a0a02beb670bc10ed61">ONIGENC_PROPERTY_NAME_TO_CTYPE</a>(enc, start, prev);
<a name="l04107"></a>04107       <span class="keywordflow">if</span> (r &lt; 0) <span class="keywordflow">break</span>;
<a name="l04108"></a>04108 
<a name="l04109"></a>04109       *src = p;
<a name="l04110"></a>04110       <span class="keywordflow">return</span> r;
<a name="l04111"></a>04111     }
<a name="l04112"></a>04112     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (c == <span class="charliteral">&apos;(&apos;</span> || c == <span class="charliteral">&apos;)&apos;</span> || c == <span class="charliteral">&apos;{&apos;</span> || c == <span class="charliteral">&apos;|&apos;</span>) {
<a name="l04113"></a>04113       r = <a class="code" href="../../d8/db3/oniguruma_8h.html#a032bd79671ab31d8071ddd79aef482da">ONIGERR_INVALID_CHAR_PROPERTY_NAME</a>;
<a name="l04114"></a>04114       <span class="keywordflow">break</span>;
<a name="l04115"></a>04115     }
<a name="l04116"></a>04116   }
<a name="l04117"></a>04117 
<a name="l04118"></a>04118   <a class="code" href="../../d6/dda/regparse_8c.html#a8d6d95d9c113545baa16fe1ff3d96191">onig_scan_env_set_error_string</a>(env, r, *src, prev);
<a name="l04119"></a>04119   <span class="keywordflow">return</span> r;
<a name="l04120"></a>04120 }
<a name="l04121"></a>04121 
<a name="l04122"></a>04122 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l04123"></a><a class="code" href="../../d6/dda/regparse_8c.html#adaf2985bb85a858ceaf9e101e4214d35">04123</a> <a class="code" href="../../d6/dda/regparse_8c.html#adaf2985bb85a858ceaf9e101e4214d35">parse_char_property</a>(<a class="code" href="../../d0/d6e/struct___node.html">Node</a>** np, <a class="code" href="../../d0/d80/struct_onig_token.html">OnigToken</a>* <a class="code" href="../../d5/d11/ripper_8c.html#a2b3a335d617ec14d6296ca82d3055858">tok</a>, <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>** src, <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>* end,
<a name="l04124"></a>04124                     <a class="code" href="../../d6/dbe/struct_scan_env.html">ScanEnv</a>* env)
<a name="l04125"></a>04125 {
<a name="l04126"></a>04126   <span class="keywordtype">int</span> r, ctype;
<a name="l04127"></a>04127   <a class="code" href="../../d8/d79/struct_c_class_node.html">CClassNode</a>* cc;
<a name="l04128"></a>04128 
<a name="l04129"></a>04129   ctype = <a class="code" href="../../d6/dda/regparse_8c.html#ad86e55057f2ed2a0364f041801d09a98">fetch_char_property_to_ctype</a>(src, end, env);
<a name="l04130"></a>04130   <span class="keywordflow">if</span> (ctype &lt; 0) <span class="keywordflow">return</span> ctype;
<a name="l04131"></a>04131 
<a name="l04132"></a>04132   *np = <a class="code" href="../../d6/dda/regparse_8c.html#afd60d28ead746c5b464b5a114d8960f1">node_new_cclass</a>();
<a name="l04133"></a>04133   <a class="code" href="../../d6/d87/regint_8h.html#a17ebb2a12300dcf6d79916e357fae45a">CHECK_NULL_RETURN_MEMERR</a>(*np);
<a name="l04134"></a>04134   cc = <a class="code" href="../../d1/dfc/regparse_8h.html#a816a6d8f921892c2efef73eb7727d589">NCCLASS</a>(*np);
<a name="l04135"></a>04135   r = <a class="code" href="../../d6/dda/regparse_8c.html#a30cf0640cd2a2e99e72171d90a4213f6">add_ctype_to_cc</a>(cc, ctype, 0, env);
<a name="l04136"></a>04136   <span class="keywordflow">if</span> (r != 0) <span class="keywordflow">return</span> r;
<a name="l04137"></a>04137   <span class="keywordflow">if</span> (tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#aaea3a0bd5a46ef32e4a9552046a070b3">u</a>.<a class="code" href="../../d0/d80/struct_onig_token.html#a84f464445695ec0d70cdc5f02db11833">prop</a>.not != 0) <a class="code" href="../../d6/d87/regint_8h.html#afe2d37ab1bcdc5309dd3d5469f9f5aee">NCCLASS_SET_NOT</a>(cc);
<a name="l04138"></a>04138 
<a name="l04139"></a>04139   <span class="keywordflow">return</span> 0;
<a name="l04140"></a>04140 }
<a name="l04141"></a>04141 
<a name="l04142"></a>04142 
<a name="l04143"></a><a class="code" href="../../d6/dda/regparse_8c.html#ae30e5724fda2422a5d70fef528ccd1b4">04143</a> <span class="keyword">enum</span> <a class="code" href="../../d6/dda/regparse_8c.html#ae30e5724fda2422a5d70fef528ccd1b4">CCSTATE</a> {
<a name="l04144"></a><a class="code" href="../../d6/dda/regparse_8c.html#ae30e5724fda2422a5d70fef528ccd1b4ad9f01249e66361849d4c5a1e046215f2">04144</a>   <a class="code" href="../../d6/dda/regparse_8c.html#ae30e5724fda2422a5d70fef528ccd1b4ad9f01249e66361849d4c5a1e046215f2">CCS_VALUE</a>,
<a name="l04145"></a><a class="code" href="../../d6/dda/regparse_8c.html#ae30e5724fda2422a5d70fef528ccd1b4acd7828d24c4a9ba5b9ee0e29c8719079">04145</a>   <a class="code" href="../../d6/dda/regparse_8c.html#ae30e5724fda2422a5d70fef528ccd1b4acd7828d24c4a9ba5b9ee0e29c8719079">CCS_RANGE</a>,
<a name="l04146"></a><a class="code" href="../../d6/dda/regparse_8c.html#ae30e5724fda2422a5d70fef528ccd1b4a189ec4f805d5188536b764df04b87f35">04146</a>   <a class="code" href="../../d6/dda/regparse_8c.html#ae30e5724fda2422a5d70fef528ccd1b4a189ec4f805d5188536b764df04b87f35">CCS_COMPLETE</a>,
<a name="l04147"></a><a class="code" href="../../d6/dda/regparse_8c.html#ae30e5724fda2422a5d70fef528ccd1b4a68112dd2a92b31ffbaca108d9b605c9a">04147</a>   <a class="code" href="../../d6/dda/regparse_8c.html#ae30e5724fda2422a5d70fef528ccd1b4a68112dd2a92b31ffbaca108d9b605c9a">CCS_START</a>
<a name="l04148"></a>04148 };
<a name="l04149"></a>04149 
<a name="l04150"></a><a class="code" href="../../d6/dda/regparse_8c.html#af33b57f90e86d299d925cbc7f5c12f24">04150</a> <span class="keyword">enum</span> <a class="code" href="../../d6/dda/regparse_8c.html#af33b57f90e86d299d925cbc7f5c12f24">CCVALTYPE</a> {
<a name="l04151"></a><a class="code" href="../../d6/dda/regparse_8c.html#af33b57f90e86d299d925cbc7f5c12f24abc049b60184045414fb7fa5bf1398b14">04151</a>   <a class="code" href="../../d6/dda/regparse_8c.html#af33b57f90e86d299d925cbc7f5c12f24abc049b60184045414fb7fa5bf1398b14">CCV_SB</a>,
<a name="l04152"></a><a class="code" href="../../d6/dda/regparse_8c.html#af33b57f90e86d299d925cbc7f5c12f24ae3b1f32a5f7c4bebaf00de8668aeac55">04152</a>   <a class="code" href="../../d6/dda/regparse_8c.html#af33b57f90e86d299d925cbc7f5c12f24ae3b1f32a5f7c4bebaf00de8668aeac55">CCV_CODE_POINT</a>,
<a name="l04153"></a><a class="code" href="../../d6/dda/regparse_8c.html#af33b57f90e86d299d925cbc7f5c12f24a75e5584a22d1decbed7c05f3f6412750">04153</a>   <a class="code" href="../../d6/dda/regparse_8c.html#af33b57f90e86d299d925cbc7f5c12f24a75e5584a22d1decbed7c05f3f6412750">CCV_CLASS</a>
<a name="l04154"></a>04154 };
<a name="l04155"></a>04155 
<a name="l04156"></a>04156 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l04157"></a><a class="code" href="../../d6/dda/regparse_8c.html#aa92d4a41497b36b45b2e875f51404612">04157</a> <a class="code" href="../../d6/dda/regparse_8c.html#aa92d4a41497b36b45b2e875f51404612">next_state_class</a>(<a class="code" href="../../d8/d79/struct_c_class_node.html">CClassNode</a>* cc, <a class="code" href="../../d8/db3/oniguruma_8h.html#a7c8a84bc12127007886efbfcf53b6fb5">OnigCodePoint</a>* vs, <span class="keyword">enum</span> <a class="code" href="../../d6/dda/regparse_8c.html#af33b57f90e86d299d925cbc7f5c12f24">CCVALTYPE</a>* <a class="code" href="../../d5/d9d/tcltklib_8c.html#ac765329451135abec74c45e1897abf26">type</a>,
<a name="l04158"></a>04158                  <span class="keyword">enum</span> <a class="code" href="../../d6/dda/regparse_8c.html#ae30e5724fda2422a5d70fef528ccd1b4">CCSTATE</a>* <a class="code" href="../../d5/d1d/gb18030_8c.html#adc6e5733fc3c22f0a7b2914188c49c90">state</a>, <a class="code" href="../../d6/dbe/struct_scan_env.html">ScanEnv</a>* env)
<a name="l04159"></a>04159 {
<a name="l04160"></a>04160   <span class="keywordtype">int</span> r;
<a name="l04161"></a>04161 
<a name="l04162"></a>04162   <span class="keywordflow">if</span> (*state == <a class="code" href="../../d6/dda/regparse_8c.html#ae30e5724fda2422a5d70fef528ccd1b4acd7828d24c4a9ba5b9ee0e29c8719079">CCS_RANGE</a>)
<a name="l04163"></a>04163     <span class="keywordflow">return</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#ad5babcacbf4250a2e83a73fdf37fb9ce">ONIGERR_CHAR_CLASS_VALUE_AT_END_OF_RANGE</a>;
<a name="l04164"></a>04164 
<a name="l04165"></a>04165   <span class="keywordflow">if</span> (*state == <a class="code" href="../../d6/dda/regparse_8c.html#ae30e5724fda2422a5d70fef528ccd1b4ad9f01249e66361849d4c5a1e046215f2">CCS_VALUE</a> &amp;&amp; *type != <a class="code" href="../../d6/dda/regparse_8c.html#af33b57f90e86d299d925cbc7f5c12f24a75e5584a22d1decbed7c05f3f6412750">CCV_CLASS</a>) {
<a name="l04166"></a>04166     <span class="keywordflow">if</span> (*type == <a class="code" href="../../d6/dda/regparse_8c.html#af33b57f90e86d299d925cbc7f5c12f24abc049b60184045414fb7fa5bf1398b14">CCV_SB</a>)
<a name="l04167"></a>04167       <a class="code" href="../../d6/dda/regparse_8c.html#acafa6a8e6b897efa2f65abaf8790a220">BITSET_SET_BIT_CHKDUP</a>(cc-&gt;<a class="code" href="../../d8/d79/struct_c_class_node.html#a082458e56c928f78db90f08e242a9f3d">bs</a>, (<span class="keywordtype">int</span> )(*vs));
<a name="l04168"></a>04168     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (*type == <a class="code" href="../../d6/dda/regparse_8c.html#af33b57f90e86d299d925cbc7f5c12f24ae3b1f32a5f7c4bebaf00de8668aeac55">CCV_CODE_POINT</a>) {
<a name="l04169"></a>04169       r = <a class="code" href="../../d6/dda/regparse_8c.html#a6f589d793cc94713e0ec3a9ffa861b3a">add_code_range</a>(&amp;(cc-&gt;<a class="code" href="../../d8/d79/struct_c_class_node.html#a599db43b8eea536a4e4d08400fa445cb">mbuf</a>), env, *vs, *vs);
<a name="l04170"></a>04170       <span class="keywordflow">if</span> (r &lt; 0) <span class="keywordflow">return</span> r;
<a name="l04171"></a>04171     }
<a name="l04172"></a>04172   }
<a name="l04173"></a>04173 
<a name="l04174"></a>04174   *state = <a class="code" href="../../d6/dda/regparse_8c.html#ae30e5724fda2422a5d70fef528ccd1b4ad9f01249e66361849d4c5a1e046215f2">CCS_VALUE</a>;
<a name="l04175"></a>04175   *type  = <a class="code" href="../../d6/dda/regparse_8c.html#af33b57f90e86d299d925cbc7f5c12f24a75e5584a22d1decbed7c05f3f6412750">CCV_CLASS</a>;
<a name="l04176"></a>04176   <span class="keywordflow">return</span> 0;
<a name="l04177"></a>04177 }
<a name="l04178"></a>04178 
<a name="l04179"></a>04179 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l04180"></a><a class="code" href="../../d6/dda/regparse_8c.html#a85d181eec13a6c58e0e0da7b1a85ad77">04180</a> <a class="code" href="../../d6/dda/regparse_8c.html#a85d181eec13a6c58e0e0da7b1a85ad77">next_state_val</a>(<a class="code" href="../../d8/d79/struct_c_class_node.html">CClassNode</a>* cc, <a class="code" href="../../d8/db3/oniguruma_8h.html#a7c8a84bc12127007886efbfcf53b6fb5">OnigCodePoint</a> *vs, <a class="code" href="../../d8/db3/oniguruma_8h.html#a7c8a84bc12127007886efbfcf53b6fb5">OnigCodePoint</a> v,
<a name="l04181"></a>04181                <span class="keywordtype">int</span>* vs_israw, <span class="keywordtype">int</span> v_israw,
<a name="l04182"></a>04182                <span class="keyword">enum</span> <a class="code" href="../../d6/dda/regparse_8c.html#af33b57f90e86d299d925cbc7f5c12f24">CCVALTYPE</a> intype, <span class="keyword">enum</span> <a class="code" href="../../d6/dda/regparse_8c.html#af33b57f90e86d299d925cbc7f5c12f24">CCVALTYPE</a>* <a class="code" href="../../d5/d9d/tcltklib_8c.html#ac765329451135abec74c45e1897abf26">type</a>,
<a name="l04183"></a>04183                <span class="keyword">enum</span> <a class="code" href="../../d6/dda/regparse_8c.html#ae30e5724fda2422a5d70fef528ccd1b4">CCSTATE</a>* <a class="code" href="../../d5/d1d/gb18030_8c.html#adc6e5733fc3c22f0a7b2914188c49c90">state</a>, <a class="code" href="../../d6/dbe/struct_scan_env.html">ScanEnv</a>* env)
<a name="l04184"></a>04184 {
<a name="l04185"></a>04185   <span class="keywordtype">int</span> r;
<a name="l04186"></a>04186 
<a name="l04187"></a>04187   <span class="keywordflow">switch</span> (*state) {
<a name="l04188"></a>04188   <span class="keywordflow">case</span> <a class="code" href="../../d6/dda/regparse_8c.html#ae30e5724fda2422a5d70fef528ccd1b4ad9f01249e66361849d4c5a1e046215f2">CCS_VALUE</a>:
<a name="l04189"></a>04189     <span class="keywordflow">if</span> (*type == <a class="code" href="../../d6/dda/regparse_8c.html#af33b57f90e86d299d925cbc7f5c12f24abc049b60184045414fb7fa5bf1398b14">CCV_SB</a>)
<a name="l04190"></a>04190       <a class="code" href="../../d6/dda/regparse_8c.html#acafa6a8e6b897efa2f65abaf8790a220">BITSET_SET_BIT_CHKDUP</a>(cc-&gt;<a class="code" href="../../d8/d79/struct_c_class_node.html#a082458e56c928f78db90f08e242a9f3d">bs</a>, (<span class="keywordtype">int</span> )(*vs));
<a name="l04191"></a>04191     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (*type == <a class="code" href="../../d6/dda/regparse_8c.html#af33b57f90e86d299d925cbc7f5c12f24ae3b1f32a5f7c4bebaf00de8668aeac55">CCV_CODE_POINT</a>) {
<a name="l04192"></a>04192       r = <a class="code" href="../../d6/dda/regparse_8c.html#a6f589d793cc94713e0ec3a9ffa861b3a">add_code_range</a>(&amp;(cc-&gt;<a class="code" href="../../d8/d79/struct_c_class_node.html#a599db43b8eea536a4e4d08400fa445cb">mbuf</a>), env, *vs, *vs);
<a name="l04193"></a>04193       <span class="keywordflow">if</span> (r &lt; 0) <span class="keywordflow">return</span> r;
<a name="l04194"></a>04194     }
<a name="l04195"></a>04195     <span class="keywordflow">break</span>;
<a name="l04196"></a>04196 
<a name="l04197"></a>04197   <span class="keywordflow">case</span> <a class="code" href="../../d6/dda/regparse_8c.html#ae30e5724fda2422a5d70fef528ccd1b4acd7828d24c4a9ba5b9ee0e29c8719079">CCS_RANGE</a>:
<a name="l04198"></a>04198     <span class="keywordflow">if</span> (intype == *type) {
<a name="l04199"></a>04199       <span class="keywordflow">if</span> (intype == <a class="code" href="../../d6/dda/regparse_8c.html#af33b57f90e86d299d925cbc7f5c12f24abc049b60184045414fb7fa5bf1398b14">CCV_SB</a>) {
<a name="l04200"></a>04200         <span class="keywordflow">if</span> (*vs &gt; 0xff || v &gt; 0xff)
<a name="l04201"></a>04201           <span class="keywordflow">return</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#af0044280fd11887fe25afa81db2f278e">ONIGERR_INVALID_CODE_POINT_VALUE</a>;
<a name="l04202"></a>04202 
<a name="l04203"></a>04203         <span class="keywordflow">if</span> (*vs &gt; v) {
<a name="l04204"></a>04204           <span class="keywordflow">if</span> (<a class="code" href="../../d1/dfc/regparse_8h.html#a18bfc9ee154d6dd516347bd71b4810f6">IS_SYNTAX_BV</a>(env-&gt;<a class="code" href="../../d6/dbe/struct_scan_env.html#ae5c4502ad7b7a4a418eda464919d2bda">syntax</a>, <a class="code" href="../../d8/db3/oniguruma_8h.html#af9e3b558a77c0236af963af79f95f4ae">ONIG_SYN_ALLOW_EMPTY_RANGE_IN_CC</a>))
<a name="l04205"></a>04205             <span class="keywordflow">goto</span> ccs_range_end;
<a name="l04206"></a>04206           <span class="keywordflow">else</span>
<a name="l04207"></a>04207             <span class="keywordflow">return</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#a0de83e3a45bf4467e70afd55f353a269">ONIGERR_EMPTY_RANGE_IN_CHAR_CLASS</a>;
<a name="l04208"></a>04208         }
<a name="l04209"></a>04209         <a class="code" href="../../d6/dda/regparse_8c.html#a6b3d47c5e12576a16be4342107be06f7">bitset_set_range</a>(env, cc-&gt;<a class="code" href="../../d8/d79/struct_c_class_node.html#a082458e56c928f78db90f08e242a9f3d">bs</a>, (<span class="keywordtype">int</span> )*vs, (<span class="keywordtype">int</span> )v);
<a name="l04210"></a>04210       }
<a name="l04211"></a>04211       <span class="keywordflow">else</span> {
<a name="l04212"></a>04212         r = <a class="code" href="../../d6/dda/regparse_8c.html#a6f589d793cc94713e0ec3a9ffa861b3a">add_code_range</a>(&amp;(cc-&gt;<a class="code" href="../../d8/d79/struct_c_class_node.html#a599db43b8eea536a4e4d08400fa445cb">mbuf</a>), env, *vs, v);
<a name="l04213"></a>04213         <span class="keywordflow">if</span> (r &lt; 0) <span class="keywordflow">return</span> r;
<a name="l04214"></a>04214       }
<a name="l04215"></a>04215     }
<a name="l04216"></a>04216     <span class="keywordflow">else</span> {
<a name="l04217"></a>04217 <span class="preprocessor">#if 0</span>
<a name="l04218"></a>04218 <span class="preprocessor"></span>      <span class="keywordflow">if</span> (intype == <a class="code" href="../../d6/dda/regparse_8c.html#af33b57f90e86d299d925cbc7f5c12f24ae3b1f32a5f7c4bebaf00de8668aeac55">CCV_CODE_POINT</a> &amp;&amp; *type == <a class="code" href="../../d6/dda/regparse_8c.html#af33b57f90e86d299d925cbc7f5c12f24abc049b60184045414fb7fa5bf1398b14">CCV_SB</a>) {
<a name="l04219"></a>04219 <span class="preprocessor">#endif</span>
<a name="l04220"></a>04220 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (*vs &gt; v) {
<a name="l04221"></a>04221           <span class="keywordflow">if</span> (<a class="code" href="../../d1/dfc/regparse_8h.html#a18bfc9ee154d6dd516347bd71b4810f6">IS_SYNTAX_BV</a>(env-&gt;<a class="code" href="../../d6/dbe/struct_scan_env.html#ae5c4502ad7b7a4a418eda464919d2bda">syntax</a>, <a class="code" href="../../d8/db3/oniguruma_8h.html#af9e3b558a77c0236af963af79f95f4ae">ONIG_SYN_ALLOW_EMPTY_RANGE_IN_CC</a>))
<a name="l04222"></a>04222             <span class="keywordflow">goto</span> ccs_range_end;
<a name="l04223"></a>04223           <span class="keywordflow">else</span>
<a name="l04224"></a>04224             <span class="keywordflow">return</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#a0de83e3a45bf4467e70afd55f353a269">ONIGERR_EMPTY_RANGE_IN_CHAR_CLASS</a>;
<a name="l04225"></a>04225         }
<a name="l04226"></a>04226         <a class="code" href="../../d6/dda/regparse_8c.html#a6b3d47c5e12576a16be4342107be06f7">bitset_set_range</a>(env, cc-&gt;<a class="code" href="../../d8/d79/struct_c_class_node.html#a082458e56c928f78db90f08e242a9f3d">bs</a>, (<span class="keywordtype">int</span> )*vs, (<span class="keywordtype">int</span> )(v &lt; 0xff ? v : 0xff));
<a name="l04227"></a>04227         r = <a class="code" href="../../d6/dda/regparse_8c.html#a6f589d793cc94713e0ec3a9ffa861b3a">add_code_range</a>(&amp;(cc-&gt;<a class="code" href="../../d8/d79/struct_c_class_node.html#a599db43b8eea536a4e4d08400fa445cb">mbuf</a>), env, (<a class="code" href="../../d8/db3/oniguruma_8h.html#a7c8a84bc12127007886efbfcf53b6fb5">OnigCodePoint</a> )*vs, v);
<a name="l04228"></a>04228         <span class="keywordflow">if</span> (r &lt; 0) <span class="keywordflow">return</span> r;
<a name="l04229"></a>04229 <span class="preprocessor">#if 0</span>
<a name="l04230"></a>04230 <span class="preprocessor"></span>      }
<a name="l04231"></a>04231       <span class="keywordflow">else</span>
<a name="l04232"></a>04232         <span class="keywordflow">return</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#a96ce72e787f197ca0ad105425be0c869">ONIGERR_MISMATCH_CODE_LENGTH_IN_CLASS_RANGE</a>;
<a name="l04233"></a>04233 <span class="preprocessor">#endif</span>
<a name="l04234"></a>04234 <span class="preprocessor"></span>    }
<a name="l04235"></a>04235   ccs_range_end:
<a name="l04236"></a>04236     *state = <a class="code" href="../../d6/dda/regparse_8c.html#ae30e5724fda2422a5d70fef528ccd1b4a189ec4f805d5188536b764df04b87f35">CCS_COMPLETE</a>;
<a name="l04237"></a>04237     <span class="keywordflow">break</span>;
<a name="l04238"></a>04238 
<a name="l04239"></a>04239   <span class="keywordflow">case</span> <a class="code" href="../../d6/dda/regparse_8c.html#ae30e5724fda2422a5d70fef528ccd1b4a189ec4f805d5188536b764df04b87f35">CCS_COMPLETE</a>:
<a name="l04240"></a>04240   <span class="keywordflow">case</span> <a class="code" href="../../d6/dda/regparse_8c.html#ae30e5724fda2422a5d70fef528ccd1b4a68112dd2a92b31ffbaca108d9b605c9a">CCS_START</a>:
<a name="l04241"></a>04241     *state = <a class="code" href="../../d6/dda/regparse_8c.html#ae30e5724fda2422a5d70fef528ccd1b4ad9f01249e66361849d4c5a1e046215f2">CCS_VALUE</a>;
<a name="l04242"></a>04242     <span class="keywordflow">break</span>;
<a name="l04243"></a>04243 
<a name="l04244"></a>04244   <span class="keywordflow">default</span>:
<a name="l04245"></a>04245     <span class="keywordflow">break</span>;
<a name="l04246"></a>04246   }
<a name="l04247"></a>04247 
<a name="l04248"></a>04248   *vs_israw = v_israw;
<a name="l04249"></a>04249   *vs       = v;
<a name="l04250"></a>04250   *type     = intype;
<a name="l04251"></a>04251   <span class="keywordflow">return</span> 0;
<a name="l04252"></a>04252 }
<a name="l04253"></a>04253 
<a name="l04254"></a>04254 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l04255"></a><a class="code" href="../../d6/dda/regparse_8c.html#a5097e7404e749cbe05065f3dd104c754">04255</a> <a class="code" href="../../d6/dda/regparse_8c.html#a5097e7404e749cbe05065f3dd104c754">code_exist_check</a>(<a class="code" href="../../d8/db3/oniguruma_8h.html#a7c8a84bc12127007886efbfcf53b6fb5">OnigCodePoint</a> c, <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>* from, <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>* end, <span class="keywordtype">int</span> ignore_escaped,
<a name="l04256"></a>04256                  <a class="code" href="../../d6/dbe/struct_scan_env.html">ScanEnv</a>* env)
<a name="l04257"></a>04257 {
<a name="l04258"></a>04258   <span class="keywordtype">int</span> in_esc;
<a name="l04259"></a>04259   <a class="code" href="../../d8/db3/oniguruma_8h.html#a7c8a84bc12127007886efbfcf53b6fb5">OnigCodePoint</a> code;
<a name="l04260"></a>04260   <a class="code" href="../../d1/d7b/struct_onig_encoding_type_s_t.html">OnigEncoding</a> enc = env-&gt;<a class="code" href="../../d6/dbe/struct_scan_env.html#a97f766db4ac9dabc9d173bf99fbcc11b">enc</a>;
<a name="l04261"></a>04261   <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>* p = from;
<a name="l04262"></a>04262   <a class="code" href="../../d6/dda/regparse_8c.html#a44975cffe07e4559bf5638cafb4a6b30">PFETCH_READY</a>;
<a name="l04263"></a>04263 
<a name="l04264"></a>04264   in_esc = 0;
<a name="l04265"></a>04265   <span class="keywordflow">while</span> (! <a class="code" href="../../d6/dda/regparse_8c.html#a43ce1d83d1961694adc2dfcbfac7d690">PEND</a>) {
<a name="l04266"></a>04266     <span class="keywordflow">if</span> (ignore_escaped &amp;&amp; in_esc) {
<a name="l04267"></a>04267       in_esc = 0;
<a name="l04268"></a>04268     }
<a name="l04269"></a>04269     <span class="keywordflow">else</span> {
<a name="l04270"></a>04270       <a class="code" href="../../d6/dda/regparse_8c.html#a8a8898c873b81a88454a968371696cab">PFETCH</a>(code);
<a name="l04271"></a>04271       <span class="keywordflow">if</span> (code == c) <span class="keywordflow">return</span> 1;
<a name="l04272"></a>04272       <span class="keywordflow">if</span> (code == <a class="code" href="../../d6/d87/regint_8h.html#ae4a605f4b8bee0d69ab6d6418ddbec1b">MC_ESC</a>(env-&gt;<a class="code" href="../../d6/dbe/struct_scan_env.html#ae5c4502ad7b7a4a418eda464919d2bda">syntax</a>)) in_esc = 1;
<a name="l04273"></a>04273     }
<a name="l04274"></a>04274   }
<a name="l04275"></a>04275   <span class="keywordflow">return</span> 0;
<a name="l04276"></a>04276 }
<a name="l04277"></a>04277 
<a name="l04278"></a>04278 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l04279"></a><a class="code" href="../../d6/dda/regparse_8c.html#abc86706f6ac6a3fad3db8b1bf25f13ce">04279</a> <a class="code" href="../../d6/dda/regparse_8c.html#abc86706f6ac6a3fad3db8b1bf25f13ce">parse_char_class</a>(<a class="code" href="../../d0/d6e/struct___node.html">Node</a>** np, <a class="code" href="../../d0/d80/struct_onig_token.html">OnigToken</a>* <a class="code" href="../../d5/d11/ripper_8c.html#a2b3a335d617ec14d6296ca82d3055858">tok</a>, <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>** src, <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>* end,
<a name="l04280"></a>04280                  <a class="code" href="../../d6/dbe/struct_scan_env.html">ScanEnv</a>* env)
<a name="l04281"></a>04281 {
<a name="l04282"></a>04282   <span class="keywordtype">int</span> r, <a class="code" href="../../df/d73/time_8c.html#a83f11f6624f6648aa502330ab8408073">neg</a>, len, fetched, and_start;
<a name="l04283"></a>04283   <a class="code" href="../../d8/db3/oniguruma_8h.html#a7c8a84bc12127007886efbfcf53b6fb5">OnigCodePoint</a> v, vs;
<a name="l04284"></a>04284   <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a> *p;
<a name="l04285"></a>04285   <a class="code" href="../../d0/d6e/struct___node.html">Node</a>* node;
<a name="l04286"></a>04286   <a class="code" href="../../d8/d79/struct_c_class_node.html">CClassNode</a> *cc, *prev_cc;
<a name="l04287"></a>04287   <a class="code" href="../../d8/d79/struct_c_class_node.html">CClassNode</a> work_cc;
<a name="l04288"></a>04288 
<a name="l04289"></a>04289   <span class="keyword">enum</span> <a class="code" href="../../d6/dda/regparse_8c.html#ae30e5724fda2422a5d70fef528ccd1b4">CCSTATE</a> <a class="code" href="../../d5/d1d/gb18030_8c.html#adc6e5733fc3c22f0a7b2914188c49c90">state</a>;
<a name="l04290"></a>04290   <span class="keyword">enum</span> <a class="code" href="../../d6/dda/regparse_8c.html#af33b57f90e86d299d925cbc7f5c12f24">CCVALTYPE</a> val_type, in_type;
<a name="l04291"></a>04291   <span class="keywordtype">int</span> val_israw, in_israw;
<a name="l04292"></a>04292 
<a name="l04293"></a>04293   prev_cc = (<a class="code" href="../../d8/d79/struct_c_class_node.html">CClassNode</a>* )<a class="code" href="../../d3/d09/ripper_8y.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l04294"></a>04294   *np = <a class="code" href="../../d3/d7f/gram_8c.html#ac00d2982d51115efbe8a13840d47b7a7">NULL_NODE</a>;
<a name="l04295"></a>04295   r = <a class="code" href="../../d6/dda/regparse_8c.html#aa9e1371973aab648c9781c5d38ef5a39">fetch_token_in_cc</a>(tok, src, end, env);
<a name="l04296"></a>04296   <span class="keywordflow">if</span> (r == <a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250dafa4fad7de330d203eb444651f110045d">TK_CHAR</a> &amp;&amp; tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#aaea3a0bd5a46ef32e4a9552046a070b3">u</a>.<a class="code" href="../../d0/d80/struct_onig_token.html#ac1f4ee5fa57d7ebbfa95642148efe0f5">c</a> == <span class="charliteral">&apos;^&apos;</span> &amp;&amp; tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#a71ac92059fef31b2d7932d04523f8c17">escaped</a> == 0) {
<a name="l04297"></a>04297     neg = 1;
<a name="l04298"></a>04298     r = <a class="code" href="../../d6/dda/regparse_8c.html#aa9e1371973aab648c9781c5d38ef5a39">fetch_token_in_cc</a>(tok, src, end, env);
<a name="l04299"></a>04299   }
<a name="l04300"></a>04300   <span class="keywordflow">else</span> {
<a name="l04301"></a>04301     neg = 0;
<a name="l04302"></a>04302   }
<a name="l04303"></a>04303 
<a name="l04304"></a>04304   <span class="keywordflow">if</span> (r &lt; 0) <span class="keywordflow">return</span> r;
<a name="l04305"></a>04305   <span class="keywordflow">if</span> (r == <a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250dae586fca38ba46f46c46282713162c015">TK_CC_CLOSE</a>) {
<a name="l04306"></a>04306     <span class="keywordflow">if</span> (! <a class="code" href="../../d6/dda/regparse_8c.html#a5097e7404e749cbe05065f3dd104c754">code_exist_check</a>((<a class="code" href="../../d8/db3/oniguruma_8h.html#a7c8a84bc12127007886efbfcf53b6fb5">OnigCodePoint</a> )<span class="charliteral">&apos;]&apos;</span>,
<a name="l04307"></a>04307                            *src, env-&gt;<a class="code" href="../../d6/dbe/struct_scan_env.html#a4181f23bd0ae880c5e3f0dff09e71277">pattern_end</a>, 1, env))
<a name="l04308"></a>04308       <span class="keywordflow">return</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#a5cf2f9300c06d441556f3bedc5793802">ONIGERR_EMPTY_CHAR_CLASS</a>;
<a name="l04309"></a>04309 
<a name="l04310"></a>04310     <a class="code" href="../../d6/dda/regparse_8c.html#ab3756f3c29ed37db51ab30cfab1f8b55">CC_ESC_WARN</a>(env, (<a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>* )<span class="stringliteral">&quot;]&quot;</span>);
<a name="l04311"></a>04311     r = tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#a46f3343f204ac67de13f0a774284e476">type</a> = <a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250dafa4fad7de330d203eb444651f110045d">TK_CHAR</a>;  <span class="comment">/* allow []...] */</span>
<a name="l04312"></a>04312   }
<a name="l04313"></a>04313 
<a name="l04314"></a>04314   *np = node = <a class="code" href="../../d6/dda/regparse_8c.html#afd60d28ead746c5b464b5a114d8960f1">node_new_cclass</a>();
<a name="l04315"></a>04315   <a class="code" href="../../d6/d87/regint_8h.html#a17ebb2a12300dcf6d79916e357fae45a">CHECK_NULL_RETURN_MEMERR</a>(node);
<a name="l04316"></a>04316   cc = <a class="code" href="../../d1/dfc/regparse_8h.html#a816a6d8f921892c2efef73eb7727d589">NCCLASS</a>(node);
<a name="l04317"></a>04317 
<a name="l04318"></a>04318   and_start = 0;
<a name="l04319"></a>04319   state = <a class="code" href="../../d6/dda/regparse_8c.html#ae30e5724fda2422a5d70fef528ccd1b4a68112dd2a92b31ffbaca108d9b605c9a">CCS_START</a>;
<a name="l04320"></a>04320   p = *src;
<a name="l04321"></a>04321   <span class="keywordflow">while</span> (r != <a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250dae586fca38ba46f46c46282713162c015">TK_CC_CLOSE</a>) {
<a name="l04322"></a>04322     fetched = 0;
<a name="l04323"></a>04323     <span class="keywordflow">switch</span> (r) {
<a name="l04324"></a>04324     <span class="keywordflow">case</span> <a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250dafa4fad7de330d203eb444651f110045d">TK_CHAR</a>:
<a name="l04325"></a>04325       <span class="keywordflow">if</span> ((tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#aaea3a0bd5a46ef32e4a9552046a070b3">u</a>.<a class="code" href="../../d0/d80/struct_onig_token.html#a40121b0193b6bbfbf9fdb88d82f1ea7a">code</a> &gt;= <a class="code" href="../../d6/d87/regint_8h.html#a8bdc62bcdfffb01985810f7aa61d5999">SINGLE_BYTE_SIZE</a>) ||
<a name="l04326"></a>04326           (len = <a class="code" href="../../d8/db3/oniguruma_8h.html#ae9dd2f20953b82ba4589e04fabcadba7">ONIGENC_CODE_TO_MBCLEN</a>(env-&gt;<a class="code" href="../../d6/dbe/struct_scan_env.html#a97f766db4ac9dabc9d173bf99fbcc11b">enc</a>, tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#aaea3a0bd5a46ef32e4a9552046a070b3">u</a>.<a class="code" href="../../d0/d80/struct_onig_token.html#ac1f4ee5fa57d7ebbfa95642148efe0f5">c</a>)) &gt; 1) {
<a name="l04327"></a>04327         in_type = <a class="code" href="../../d6/dda/regparse_8c.html#af33b57f90e86d299d925cbc7f5c12f24ae3b1f32a5f7c4bebaf00de8668aeac55">CCV_CODE_POINT</a>;
<a name="l04328"></a>04328       }
<a name="l04329"></a>04329       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (len &lt; 0) {
<a name="l04330"></a>04330         r = len;
<a name="l04331"></a>04331         <span class="keywordflow">goto</span> <a class="code" href="../../d5/df2/win32_8c.html#a6ce68847c12434f60d1b2654a3dc3409">err</a>;
<a name="l04332"></a>04332       }
<a name="l04333"></a>04333       <span class="keywordflow">else</span> {
<a name="l04334"></a>04334       sb_char:
<a name="l04335"></a>04335         in_type = <a class="code" href="../../d6/dda/regparse_8c.html#af33b57f90e86d299d925cbc7f5c12f24abc049b60184045414fb7fa5bf1398b14">CCV_SB</a>;
<a name="l04336"></a>04336       }
<a name="l04337"></a>04337       v = (<a class="code" href="../../d8/db3/oniguruma_8h.html#a7c8a84bc12127007886efbfcf53b6fb5">OnigCodePoint</a> )tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#aaea3a0bd5a46ef32e4a9552046a070b3">u</a>.<a class="code" href="../../d0/d80/struct_onig_token.html#ac1f4ee5fa57d7ebbfa95642148efe0f5">c</a>;
<a name="l04338"></a>04338       in_israw = 0;
<a name="l04339"></a>04339       <span class="keywordflow">goto</span> val_entry2;
<a name="l04340"></a>04340       <span class="keywordflow">break</span>;
<a name="l04341"></a>04341 
<a name="l04342"></a>04342     <span class="keywordflow">case</span> <a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250dab0e056f20d46d5a9696dd7fdea89de88">TK_RAW_BYTE</a>:
<a name="l04343"></a>04343       <span class="comment">/* tok-&gt;base != 0 : octal or hexadec. */</span>
<a name="l04344"></a>04344       <a class="code" href="../../d7/dc0/parse_8y.html#a2ac1143ac343c79cbfa448e30d74fa1c">if</a> (! <a class="code" href="../../d8/db3/oniguruma_8h.html#acbe29a5b40372a14b37b70efda999676">ONIGENC_IS_SINGLEBYTE</a>(env-&gt;<a class="code" href="../../d6/dbe/struct_scan_env.html#a97f766db4ac9dabc9d173bf99fbcc11b">enc</a>) &amp;&amp; tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#a938bb7f9e071e3c6ce68480e3138a0cc">base</a> != 0) {
<a name="l04345"></a>04345         <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a> buf[<a class="code" href="../../d8/db3/oniguruma_8h.html#a5eba220c99bf5d04cfe9dc51e744b747">ONIGENC_CODE_TO_MBC_MAXLEN</a>];
<a name="l04346"></a>04346         <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>* bufe = buf + <a class="code" href="../../d8/db3/oniguruma_8h.html#a5eba220c99bf5d04cfe9dc51e744b747">ONIGENC_CODE_TO_MBC_MAXLEN</a>;
<a name="l04347"></a>04347         <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>* psave = p;
<a name="l04348"></a>04348         <span class="keywordtype">int</span> i, base = tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#a938bb7f9e071e3c6ce68480e3138a0cc">base</a>;
<a name="l04349"></a>04349 
<a name="l04350"></a>04350         buf[0] = tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#aaea3a0bd5a46ef32e4a9552046a070b3">u</a>.<a class="code" href="../../d0/d80/struct_onig_token.html#ac1f4ee5fa57d7ebbfa95642148efe0f5">c</a>;
<a name="l04351"></a>04351         <span class="keywordflow">for</span> (i = 1; i &lt; <a class="code" href="../../d8/db3/oniguruma_8h.html#a9b7b4b30cc33c93886aef6db226f8538">ONIGENC_MBC_MAXLEN</a>(env-&gt;<a class="code" href="../../d6/dbe/struct_scan_env.html#a97f766db4ac9dabc9d173bf99fbcc11b">enc</a>); i++) {
<a name="l04352"></a>04352           r = <a class="code" href="../../d6/dda/regparse_8c.html#aa9e1371973aab648c9781c5d38ef5a39">fetch_token_in_cc</a>(tok, &amp;p, end, env);
<a name="l04353"></a>04353           <span class="keywordflow">if</span> (r &lt; 0) <span class="keywordflow">goto</span> <a class="code" href="../../d5/df2/win32_8c.html#a6ce68847c12434f60d1b2654a3dc3409">err</a>;
<a name="l04354"></a>04354           <span class="keywordflow">if</span> (r != <a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250dab0e056f20d46d5a9696dd7fdea89de88">TK_RAW_BYTE</a> || tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#a938bb7f9e071e3c6ce68480e3138a0cc">base</a> != base) {
<a name="l04355"></a>04355             fetched = 1;
<a name="l04356"></a>04356             <span class="keywordflow">break</span>;
<a name="l04357"></a>04357           }
<a name="l04358"></a>04358           buf[i] = tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#aaea3a0bd5a46ef32e4a9552046a070b3">u</a>.<a class="code" href="../../d0/d80/struct_onig_token.html#ac1f4ee5fa57d7ebbfa95642148efe0f5">c</a>;
<a name="l04359"></a>04359         }
<a name="l04360"></a>04360 
<a name="l04361"></a>04361         <span class="keywordflow">if</span> (i &lt; <a class="code" href="../../d8/db3/oniguruma_8h.html#a9d0d6012e6b7de2cf851d274bb9b9c9c">ONIGENC_MBC_MINLEN</a>(env-&gt;<a class="code" href="../../d6/dbe/struct_scan_env.html#a97f766db4ac9dabc9d173bf99fbcc11b">enc</a>)) {
<a name="l04362"></a>04362           r = <a class="code" href="../../d8/db3/oniguruma_8h.html#af6e4c0472b6fd59fa61f3f53467cc6b0">ONIGERR_TOO_SHORT_MULTI_BYTE_STRING</a>;
<a name="l04363"></a>04363           <span class="keywordflow">goto</span> <a class="code" href="../../d5/df2/win32_8c.html#a6ce68847c12434f60d1b2654a3dc3409">err</a>;
<a name="l04364"></a>04364         }
<a name="l04365"></a>04365 
<a name="l04366"></a>04366         len = <a class="code" href="../../d3/d09/ripper_8y.html#ae9f8530a4c9ec89ae8d62ce5b4410aad">enclen</a>(env-&gt;<a class="code" href="../../d6/dbe/struct_scan_env.html#a97f766db4ac9dabc9d173bf99fbcc11b">enc</a>, buf, buf+i);
<a name="l04367"></a>04367         <span class="keywordflow">if</span> (i &lt; len) {
<a name="l04368"></a>04368           r = <a class="code" href="../../d8/db3/oniguruma_8h.html#af6e4c0472b6fd59fa61f3f53467cc6b0">ONIGERR_TOO_SHORT_MULTI_BYTE_STRING</a>;
<a name="l04369"></a>04369           <span class="keywordflow">goto</span> <a class="code" href="../../d5/df2/win32_8c.html#a6ce68847c12434f60d1b2654a3dc3409">err</a>;
<a name="l04370"></a>04370         }
<a name="l04371"></a>04371         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (i &gt; len) { <span class="comment">/* fetch back */</span>
<a name="l04372"></a>04372           p = psave;
<a name="l04373"></a>04373           <span class="keywordflow">for</span> (i = 1; i &lt; len; i++) {
<a name="l04374"></a>04374             r = <a class="code" href="../../d6/dda/regparse_8c.html#aa9e1371973aab648c9781c5d38ef5a39">fetch_token_in_cc</a>(tok, &amp;p, end, env);
<a name="l04375"></a>04375           }
<a name="l04376"></a>04376           fetched = 0;
<a name="l04377"></a>04377         }
<a name="l04378"></a>04378 
<a name="l04379"></a>04379         <span class="keywordflow">if</span> (i == 1) {
<a name="l04380"></a>04380           v = (<a class="code" href="../../d8/db3/oniguruma_8h.html#a7c8a84bc12127007886efbfcf53b6fb5">OnigCodePoint</a> )buf[0];
<a name="l04381"></a>04381           <span class="keywordflow">goto</span> raw_single;
<a name="l04382"></a>04382         }
<a name="l04383"></a>04383         <span class="keywordflow">else</span> {
<a name="l04384"></a>04384           v = <a class="code" href="../../d8/db3/oniguruma_8h.html#a375d2932370b8067cb9c73f17051ae89">ONIGENC_MBC_TO_CODE</a>(env-&gt;<a class="code" href="../../d6/dbe/struct_scan_env.html#a97f766db4ac9dabc9d173bf99fbcc11b">enc</a>, buf, bufe);
<a name="l04385"></a>04385           in_type = <a class="code" href="../../d6/dda/regparse_8c.html#af33b57f90e86d299d925cbc7f5c12f24ae3b1f32a5f7c4bebaf00de8668aeac55">CCV_CODE_POINT</a>;
<a name="l04386"></a>04386         }
<a name="l04387"></a>04387       }
<a name="l04388"></a>04388       <span class="keywordflow">else</span> {
<a name="l04389"></a>04389         v = (<a class="code" href="../../d8/db3/oniguruma_8h.html#a7c8a84bc12127007886efbfcf53b6fb5">OnigCodePoint</a> )tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#aaea3a0bd5a46ef32e4a9552046a070b3">u</a>.<a class="code" href="../../d0/d80/struct_onig_token.html#ac1f4ee5fa57d7ebbfa95642148efe0f5">c</a>;
<a name="l04390"></a>04390       raw_single:
<a name="l04391"></a>04391         in_type = <a class="code" href="../../d6/dda/regparse_8c.html#af33b57f90e86d299d925cbc7f5c12f24abc049b60184045414fb7fa5bf1398b14">CCV_SB</a>;
<a name="l04392"></a>04392       }
<a name="l04393"></a>04393       in_israw = 1;
<a name="l04394"></a>04394       <span class="keywordflow">goto</span> val_entry2;
<a name="l04395"></a>04395       <span class="keywordflow">break</span>;
<a name="l04396"></a>04396 
<a name="l04397"></a>04397     <span class="keywordflow">case</span> <a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250da7a451b3ab1e788efaa2da058c6c8b49c">TK_CODE_POINT</a>:
<a name="l04398"></a>04398       v = tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#aaea3a0bd5a46ef32e4a9552046a070b3">u</a>.<a class="code" href="../../d0/d80/struct_onig_token.html#a40121b0193b6bbfbf9fdb88d82f1ea7a">code</a>;
<a name="l04399"></a>04399       in_israw = 1;
<a name="l04400"></a>04400     val_entry:
<a name="l04401"></a>04401       len = <a class="code" href="../../d8/db3/oniguruma_8h.html#ae9dd2f20953b82ba4589e04fabcadba7">ONIGENC_CODE_TO_MBCLEN</a>(env-&gt;<a class="code" href="../../d6/dbe/struct_scan_env.html#a97f766db4ac9dabc9d173bf99fbcc11b">enc</a>, v);
<a name="l04402"></a>04402       <span class="keywordflow">if</span> (len &lt; 0) {
<a name="l04403"></a>04403         r = len;
<a name="l04404"></a>04404         <span class="keywordflow">goto</span> <a class="code" href="../../d5/df2/win32_8c.html#a6ce68847c12434f60d1b2654a3dc3409">err</a>;
<a name="l04405"></a>04405       }
<a name="l04406"></a>04406       in_type = (len == 1 ? <a class="code" href="../../d6/dda/regparse_8c.html#af33b57f90e86d299d925cbc7f5c12f24abc049b60184045414fb7fa5bf1398b14">CCV_SB</a> : <a class="code" href="../../d6/dda/regparse_8c.html#af33b57f90e86d299d925cbc7f5c12f24ae3b1f32a5f7c4bebaf00de8668aeac55">CCV_CODE_POINT</a>);
<a name="l04407"></a>04407     val_entry2:
<a name="l04408"></a>04408       r = <a class="code" href="../../d6/dda/regparse_8c.html#a85d181eec13a6c58e0e0da7b1a85ad77">next_state_val</a>(cc, &amp;vs, v, &amp;val_israw, in_israw, in_type, &amp;val_type,
<a name="l04409"></a>04409                          &amp;state, env);
<a name="l04410"></a>04410       <span class="keywordflow">if</span> (r != 0) <span class="keywordflow">goto</span> <a class="code" href="../../d5/df2/win32_8c.html#a6ce68847c12434f60d1b2654a3dc3409">err</a>;
<a name="l04411"></a>04411       <span class="keywordflow">break</span>;
<a name="l04412"></a>04412 
<a name="l04413"></a>04413     <span class="keywordflow">case</span> <a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250da6e96fa876eef3f96744f4c75918c5fe0">TK_POSIX_BRACKET_OPEN</a>:
<a name="l04414"></a>04414       r = <a class="code" href="../../d6/dda/regparse_8c.html#aa424960832460720c6888e362f958a1a">parse_posix_bracket</a>(cc, &amp;p, end, env);
<a name="l04415"></a>04415       <span class="keywordflow">if</span> (r &lt; 0) <span class="keywordflow">goto</span> <a class="code" href="../../d5/df2/win32_8c.html#a6ce68847c12434f60d1b2654a3dc3409">err</a>;
<a name="l04416"></a>04416       <span class="keywordflow">if</span> (r == 1) {  <span class="comment">/* is not POSIX bracket */</span>
<a name="l04417"></a>04417         <a class="code" href="../../d6/dda/regparse_8c.html#ab3756f3c29ed37db51ab30cfab1f8b55">CC_ESC_WARN</a>(env, (<a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>* )<span class="stringliteral">&quot;[&quot;</span>);
<a name="l04418"></a>04418         p = tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#accba0041ec257e1619caefea1ea12d10">backp</a>;
<a name="l04419"></a>04419         v = (<a class="code" href="../../d8/db3/oniguruma_8h.html#a7c8a84bc12127007886efbfcf53b6fb5">OnigCodePoint</a> )tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#aaea3a0bd5a46ef32e4a9552046a070b3">u</a>.<a class="code" href="../../d0/d80/struct_onig_token.html#ac1f4ee5fa57d7ebbfa95642148efe0f5">c</a>;
<a name="l04420"></a>04420         in_israw = 0;
<a name="l04421"></a>04421         <span class="keywordflow">goto</span> val_entry;
<a name="l04422"></a>04422       }
<a name="l04423"></a>04423       <span class="keywordflow">goto</span> next_class;
<a name="l04424"></a>04424       <span class="keywordflow">break</span>;
<a name="l04425"></a>04425 
<a name="l04426"></a>04426     <span class="keywordflow">case</span> <a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250da664a7e468d295958edd0864e4f3cf461">TK_CHAR_TYPE</a>:
<a name="l04427"></a>04427       r = <a class="code" href="../../d6/dda/regparse_8c.html#a30cf0640cd2a2e99e72171d90a4213f6">add_ctype_to_cc</a>(cc, tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#aaea3a0bd5a46ef32e4a9552046a070b3">u</a>.<a class="code" href="../../d0/d80/struct_onig_token.html#a84f464445695ec0d70cdc5f02db11833">prop</a>.ctype, tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#aaea3a0bd5a46ef32e4a9552046a070b3">u</a>.<a class="code" href="../../d0/d80/struct_onig_token.html#a84f464445695ec0d70cdc5f02db11833">prop</a>.not, env);
<a name="l04428"></a>04428       <span class="keywordflow">if</span> (r != 0) <span class="keywordflow">return</span> r;
<a name="l04429"></a>04429 
<a name="l04430"></a>04430     next_class:
<a name="l04431"></a>04431       r = <a class="code" href="../../d6/dda/regparse_8c.html#aa92d4a41497b36b45b2e875f51404612">next_state_class</a>(cc, &amp;vs, &amp;val_type, &amp;state, env);
<a name="l04432"></a>04432       <span class="keywordflow">if</span> (r != 0) <span class="keywordflow">goto</span> <a class="code" href="../../d5/df2/win32_8c.html#a6ce68847c12434f60d1b2654a3dc3409">err</a>;
<a name="l04433"></a>04433       <span class="keywordflow">break</span>;
<a name="l04434"></a>04434 
<a name="l04435"></a>04435     <span class="keywordflow">case</span> <a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250da81d0318969b984a3d42eab29ec60fb47">TK_CHAR_PROPERTY</a>:
<a name="l04436"></a>04436       {
<a name="l04437"></a>04437         <span class="keywordtype">int</span> ctype;
<a name="l04438"></a>04438 
<a name="l04439"></a>04439         ctype = <a class="code" href="../../d6/dda/regparse_8c.html#ad86e55057f2ed2a0364f041801d09a98">fetch_char_property_to_ctype</a>(&amp;p, end, env);
<a name="l04440"></a>04440         <span class="keywordflow">if</span> (ctype &lt; 0) <span class="keywordflow">return</span> ctype;
<a name="l04441"></a>04441         r = <a class="code" href="../../d6/dda/regparse_8c.html#a30cf0640cd2a2e99e72171d90a4213f6">add_ctype_to_cc</a>(cc, ctype, tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#aaea3a0bd5a46ef32e4a9552046a070b3">u</a>.<a class="code" href="../../d0/d80/struct_onig_token.html#a84f464445695ec0d70cdc5f02db11833">prop</a>.not, env);
<a name="l04442"></a>04442         <span class="keywordflow">if</span> (r != 0) <span class="keywordflow">return</span> r;
<a name="l04443"></a>04443         <span class="keywordflow">goto</span> next_class;
<a name="l04444"></a>04444       }
<a name="l04445"></a>04445       <span class="keywordflow">break</span>;
<a name="l04446"></a>04446 
<a name="l04447"></a>04447     <span class="keywordflow">case</span> <a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250da2e4091d6c916e3a8bf35cce296ed7cea">TK_CC_RANGE</a>:
<a name="l04448"></a>04448       <span class="keywordflow">if</span> (state == <a class="code" href="../../d6/dda/regparse_8c.html#ae30e5724fda2422a5d70fef528ccd1b4ad9f01249e66361849d4c5a1e046215f2">CCS_VALUE</a>) {
<a name="l04449"></a>04449         r = <a class="code" href="../../d6/dda/regparse_8c.html#aa9e1371973aab648c9781c5d38ef5a39">fetch_token_in_cc</a>(tok, &amp;p, end, env);
<a name="l04450"></a>04450         <span class="keywordflow">if</span> (r &lt; 0) <span class="keywordflow">goto</span> <a class="code" href="../../d5/df2/win32_8c.html#a6ce68847c12434f60d1b2654a3dc3409">err</a>;
<a name="l04451"></a>04451         fetched = 1;
<a name="l04452"></a>04452         <span class="keywordflow">if</span> (r == <a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250dae586fca38ba46f46c46282713162c015">TK_CC_CLOSE</a>) { <span class="comment">/* allow [x-] */</span>
<a name="l04453"></a>04453         range_end_val:
<a name="l04454"></a>04454           v = (<a class="code" href="../../d8/db3/oniguruma_8h.html#a7c8a84bc12127007886efbfcf53b6fb5">OnigCodePoint</a> )<span class="charliteral">&apos;-&apos;</span>;
<a name="l04455"></a>04455           in_israw = 0;
<a name="l04456"></a>04456           <span class="keywordflow">goto</span> val_entry;
<a name="l04457"></a>04457         }
<a name="l04458"></a>04458         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (r == <a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250da0c9bf741e5d886ddcad4642e09be7ee1">TK_CC_AND</a>) {
<a name="l04459"></a>04459           <a class="code" href="../../d6/dda/regparse_8c.html#ab3756f3c29ed37db51ab30cfab1f8b55">CC_ESC_WARN</a>(env, (<a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>* )<span class="stringliteral">&quot;-&quot;</span>);
<a name="l04460"></a>04460           <span class="keywordflow">goto</span> range_end_val;
<a name="l04461"></a>04461         }
<a name="l04462"></a>04462         state = <a class="code" href="../../d6/dda/regparse_8c.html#ae30e5724fda2422a5d70fef528ccd1b4acd7828d24c4a9ba5b9ee0e29c8719079">CCS_RANGE</a>;
<a name="l04463"></a>04463       }
<a name="l04464"></a>04464       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (state == <a class="code" href="../../d6/dda/regparse_8c.html#ae30e5724fda2422a5d70fef528ccd1b4a68112dd2a92b31ffbaca108d9b605c9a">CCS_START</a>) {
<a name="l04465"></a>04465         <span class="comment">/* [-xa] is allowed */</span>
<a name="l04466"></a>04466         v = (<a class="code" href="../../d8/db3/oniguruma_8h.html#a7c8a84bc12127007886efbfcf53b6fb5">OnigCodePoint</a> )tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#aaea3a0bd5a46ef32e4a9552046a070b3">u</a>.<a class="code" href="../../d0/d80/struct_onig_token.html#ac1f4ee5fa57d7ebbfa95642148efe0f5">c</a>;
<a name="l04467"></a>04467         in_israw = 0;
<a name="l04468"></a>04468 
<a name="l04469"></a>04469         r = <a class="code" href="../../d6/dda/regparse_8c.html#aa9e1371973aab648c9781c5d38ef5a39">fetch_token_in_cc</a>(tok, &amp;p, end, env);
<a name="l04470"></a>04470         <span class="keywordflow">if</span> (r &lt; 0) <span class="keywordflow">goto</span> <a class="code" href="../../d5/df2/win32_8c.html#a6ce68847c12434f60d1b2654a3dc3409">err</a>;
<a name="l04471"></a>04471         fetched = 1;
<a name="l04472"></a>04472         <span class="comment">/* [--x] or [a&amp;&amp;-x] is warned. */</span>
<a name="l04473"></a>04473         <span class="keywordflow">if</span> (r == <a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250da2e4091d6c916e3a8bf35cce296ed7cea">TK_CC_RANGE</a> || and_start != 0)
<a name="l04474"></a>04474           <a class="code" href="../../d6/dda/regparse_8c.html#ab3756f3c29ed37db51ab30cfab1f8b55">CC_ESC_WARN</a>(env, (<a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>* )<span class="stringliteral">&quot;-&quot;</span>);
<a name="l04475"></a>04475 
<a name="l04476"></a>04476         <span class="keywordflow">goto</span> val_entry;
<a name="l04477"></a>04477       }
<a name="l04478"></a>04478       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (state == <a class="code" href="../../d6/dda/regparse_8c.html#ae30e5724fda2422a5d70fef528ccd1b4acd7828d24c4a9ba5b9ee0e29c8719079">CCS_RANGE</a>) {
<a name="l04479"></a>04479         <a class="code" href="../../d6/dda/regparse_8c.html#ab3756f3c29ed37db51ab30cfab1f8b55">CC_ESC_WARN</a>(env, (<a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>* )<span class="stringliteral">&quot;-&quot;</span>);
<a name="l04480"></a>04480         <span class="keywordflow">goto</span> sb_char;  <span class="comment">/* [!--x] is allowed */</span>
<a name="l04481"></a>04481       }
<a name="l04482"></a>04482       <span class="keywordflow">else</span> { <span class="comment">/* CCS_COMPLETE */</span>
<a name="l04483"></a>04483         r = <a class="code" href="../../d6/dda/regparse_8c.html#aa9e1371973aab648c9781c5d38ef5a39">fetch_token_in_cc</a>(tok, &amp;p, end, env);
<a name="l04484"></a>04484         <span class="keywordflow">if</span> (r &lt; 0) <span class="keywordflow">goto</span> <a class="code" href="../../d5/df2/win32_8c.html#a6ce68847c12434f60d1b2654a3dc3409">err</a>;
<a name="l04485"></a>04485         fetched = 1;
<a name="l04486"></a>04486         <span class="keywordflow">if</span> (r == <a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250dae586fca38ba46f46c46282713162c015">TK_CC_CLOSE</a>) <span class="keywordflow">goto</span> range_end_val; <span class="comment">/* allow [a-b-] */</span>
<a name="l04487"></a>04487         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (r == <a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250da0c9bf741e5d886ddcad4642e09be7ee1">TK_CC_AND</a>) {
<a name="l04488"></a>04488           <a class="code" href="../../d6/dda/regparse_8c.html#ab3756f3c29ed37db51ab30cfab1f8b55">CC_ESC_WARN</a>(env, (<a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>* )<span class="stringliteral">&quot;-&quot;</span>);
<a name="l04489"></a>04489           <span class="keywordflow">goto</span> range_end_val;
<a name="l04490"></a>04490         }
<a name="l04491"></a>04491 
<a name="l04492"></a>04492         <span class="keywordflow">if</span> (<a class="code" href="../../d1/dfc/regparse_8h.html#a18bfc9ee154d6dd516347bd71b4810f6">IS_SYNTAX_BV</a>(env-&gt;<a class="code" href="../../d6/dbe/struct_scan_env.html#ae5c4502ad7b7a4a418eda464919d2bda">syntax</a>, <a class="code" href="../../d8/db3/oniguruma_8h.html#ab4d339123e8fad3ba3efc032efa0a0f6">ONIG_SYN_ALLOW_DOUBLE_RANGE_OP_IN_CC</a>)) {
<a name="l04493"></a>04493           <a class="code" href="../../d6/dda/regparse_8c.html#ab3756f3c29ed37db51ab30cfab1f8b55">CC_ESC_WARN</a>(env, (<a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>* )<span class="stringliteral">&quot;-&quot;</span>);
<a name="l04494"></a>04494           <span class="keywordflow">goto</span> range_end_val; <span class="comment">/* [0-9-a] is allowed as [0-9\-a] */</span>
<a name="l04495"></a>04495         }
<a name="l04496"></a>04496         r = <a class="code" href="../../d8/db3/oniguruma_8h.html#a7c49a15236d15854a4d66edda27b795f">ONIGERR_UNMATCHED_RANGE_SPECIFIER_IN_CHAR_CLASS</a>;
<a name="l04497"></a>04497         <span class="keywordflow">goto</span> <a class="code" href="../../d5/df2/win32_8c.html#a6ce68847c12434f60d1b2654a3dc3409">err</a>;
<a name="l04498"></a>04498       }
<a name="l04499"></a>04499       <span class="keywordflow">break</span>;
<a name="l04500"></a>04500 
<a name="l04501"></a>04501     <span class="keywordflow">case</span> <a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250da8e5ae596c6ac79675686299605443b64">TK_CC_CC_OPEN</a>: <span class="comment">/* [ */</span>
<a name="l04502"></a>04502       {
<a name="l04503"></a>04503         <a class="code" href="../../d0/d6e/struct___node.html">Node</a> *anode;
<a name="l04504"></a>04504         <a class="code" href="../../d8/d79/struct_c_class_node.html">CClassNode</a>* acc;
<a name="l04505"></a>04505 
<a name="l04506"></a>04506         r = <a class="code" href="../../d6/dda/regparse_8c.html#abc86706f6ac6a3fad3db8b1bf25f13ce">parse_char_class</a>(&amp;anode, tok, &amp;p, end, env);
<a name="l04507"></a>04507         <span class="keywordflow">if</span> (r == 0) {
<a name="l04508"></a>04508           acc = <a class="code" href="../../d1/dfc/regparse_8h.html#a816a6d8f921892c2efef73eb7727d589">NCCLASS</a>(anode);
<a name="l04509"></a>04509           r = <a class="code" href="../../d6/dda/regparse_8c.html#a0e86fc9a55be3a8fe36993b6b1d9af44">or_cclass</a>(cc, acc, env);
<a name="l04510"></a>04510         }
<a name="l04511"></a>04511         <a class="code" href="../../d6/dda/regparse_8c.html#aa98ee34de192fd4997906389f70f4808">onig_node_free</a>(anode);
<a name="l04512"></a>04512         <span class="keywordflow">if</span> (r != 0) <span class="keywordflow">goto</span> <a class="code" href="../../d5/df2/win32_8c.html#a6ce68847c12434f60d1b2654a3dc3409">err</a>;
<a name="l04513"></a>04513       }
<a name="l04514"></a>04514       <span class="keywordflow">break</span>;
<a name="l04515"></a>04515 
<a name="l04516"></a>04516     <span class="keywordflow">case</span> <a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250da0c9bf741e5d886ddcad4642e09be7ee1">TK_CC_AND</a>: <span class="comment">/* &amp;&amp; */</span>
<a name="l04517"></a>04517       {
<a name="l04518"></a>04518         <span class="keywordflow">if</span> (state == <a class="code" href="../../d6/dda/regparse_8c.html#ae30e5724fda2422a5d70fef528ccd1b4ad9f01249e66361849d4c5a1e046215f2">CCS_VALUE</a>) {
<a name="l04519"></a>04519           r = <a class="code" href="../../d6/dda/regparse_8c.html#a85d181eec13a6c58e0e0da7b1a85ad77">next_state_val</a>(cc, &amp;vs, 0, &amp;val_israw, 0, val_type,
<a name="l04520"></a>04520                              &amp;val_type, &amp;state, env);
<a name="l04521"></a>04521           <span class="keywordflow">if</span> (r != 0) <span class="keywordflow">goto</span> <a class="code" href="../../d5/df2/win32_8c.html#a6ce68847c12434f60d1b2654a3dc3409">err</a>;
<a name="l04522"></a>04522         }
<a name="l04523"></a>04523         <span class="comment">/* initialize local variables */</span>
<a name="l04524"></a>04524         and_start = 1;
<a name="l04525"></a>04525         state = <a class="code" href="../../d6/dda/regparse_8c.html#ae30e5724fda2422a5d70fef528ccd1b4a68112dd2a92b31ffbaca108d9b605c9a">CCS_START</a>;
<a name="l04526"></a>04526 
<a name="l04527"></a>04527         <span class="keywordflow">if</span> (<a class="code" href="../../d6/d87/regint_8h.html#a4bc25fbd4749a2c130d1ae7f15ba140c">IS_NOT_NULL</a>(prev_cc)) {
<a name="l04528"></a>04528           r = <a class="code" href="../../d6/dda/regparse_8c.html#a9a4c177896f1539d8e6293a0a989e544">and_cclass</a>(prev_cc, cc, env);
<a name="l04529"></a>04529           <span class="keywordflow">if</span> (r != 0) <span class="keywordflow">goto</span> <a class="code" href="../../d5/df2/win32_8c.html#a6ce68847c12434f60d1b2654a3dc3409">err</a>;
<a name="l04530"></a>04530           <a class="code" href="../../d6/dda/regparse_8c.html#ac57154f90d1120d13c794cb9ba3cdba2">bbuf_free</a>(cc-&gt;<a class="code" href="../../d8/d79/struct_c_class_node.html#a599db43b8eea536a4e4d08400fa445cb">mbuf</a>);
<a name="l04531"></a>04531         }
<a name="l04532"></a>04532         <span class="keywordflow">else</span> {
<a name="l04533"></a>04533           prev_cc = cc;
<a name="l04534"></a>04534           cc = &amp;work_cc;
<a name="l04535"></a>04535         }
<a name="l04536"></a>04536         <a class="code" href="../../d6/dda/regparse_8c.html#a3d9da551e4e10f925f1fc487fce34896">initialize_cclass</a>(cc);
<a name="l04537"></a>04537       }
<a name="l04538"></a>04538       <span class="keywordflow">break</span>;
<a name="l04539"></a>04539 
<a name="l04540"></a>04540     <span class="keywordflow">case</span> <a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250da4b2acbe6a651813a07506f06d624ac3b">TK_EOT</a>:
<a name="l04541"></a>04541       r = <a class="code" href="../../d8/db3/oniguruma_8h.html#a93ffb769c2df25b7bccfff6c169920a5">ONIGERR_PREMATURE_END_OF_CHAR_CLASS</a>;
<a name="l04542"></a>04542       <span class="keywordflow">goto</span> <a class="code" href="../../d5/df2/win32_8c.html#a6ce68847c12434f60d1b2654a3dc3409">err</a>;
<a name="l04543"></a>04543       <span class="keywordflow">break</span>;
<a name="l04544"></a>04544     <span class="keywordflow">default</span>:
<a name="l04545"></a>04545       r = <a class="code" href="../../d8/db3/oniguruma_8h.html#a4067ac325df2d4bb0b4d2e692c257a49">ONIGERR_PARSER_BUG</a>;
<a name="l04546"></a>04546       <span class="keywordflow">goto</span> <a class="code" href="../../d5/df2/win32_8c.html#a6ce68847c12434f60d1b2654a3dc3409">err</a>;
<a name="l04547"></a>04547       <span class="keywordflow">break</span>;
<a name="l04548"></a>04548     }
<a name="l04549"></a>04549 
<a name="l04550"></a>04550     <span class="keywordflow">if</span> (fetched)
<a name="l04551"></a>04551       r = tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#a46f3343f204ac67de13f0a774284e476">type</a>;
<a name="l04552"></a>04552     <span class="keywordflow">else</span> {
<a name="l04553"></a>04553       r = <a class="code" href="../../d6/dda/regparse_8c.html#aa9e1371973aab648c9781c5d38ef5a39">fetch_token_in_cc</a>(tok, &amp;p, end, env);
<a name="l04554"></a>04554       <span class="keywordflow">if</span> (r &lt; 0) <span class="keywordflow">goto</span> <a class="code" href="../../d5/df2/win32_8c.html#a6ce68847c12434f60d1b2654a3dc3409">err</a>;
<a name="l04555"></a>04555     }
<a name="l04556"></a>04556   }
<a name="l04557"></a>04557 
<a name="l04558"></a>04558   <span class="keywordflow">if</span> (state == <a class="code" href="../../d6/dda/regparse_8c.html#ae30e5724fda2422a5d70fef528ccd1b4ad9f01249e66361849d4c5a1e046215f2">CCS_VALUE</a>) {
<a name="l04559"></a>04559     r = <a class="code" href="../../d6/dda/regparse_8c.html#a85d181eec13a6c58e0e0da7b1a85ad77">next_state_val</a>(cc, &amp;vs, 0, &amp;val_israw, 0, val_type,
<a name="l04560"></a>04560                        &amp;val_type, &amp;state, env);
<a name="l04561"></a>04561     <span class="keywordflow">if</span> (r != 0) <span class="keywordflow">goto</span> <a class="code" href="../../d5/df2/win32_8c.html#a6ce68847c12434f60d1b2654a3dc3409">err</a>;
<a name="l04562"></a>04562   }
<a name="l04563"></a>04563 
<a name="l04564"></a>04564   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d87/regint_8h.html#a4bc25fbd4749a2c130d1ae7f15ba140c">IS_NOT_NULL</a>(prev_cc)) {
<a name="l04565"></a>04565     r = <a class="code" href="../../d6/dda/regparse_8c.html#a9a4c177896f1539d8e6293a0a989e544">and_cclass</a>(prev_cc, cc, env);
<a name="l04566"></a>04566     <span class="keywordflow">if</span> (r != 0) <span class="keywordflow">goto</span> <a class="code" href="../../d5/df2/win32_8c.html#a6ce68847c12434f60d1b2654a3dc3409">err</a>;
<a name="l04567"></a>04567     <a class="code" href="../../d6/dda/regparse_8c.html#ac57154f90d1120d13c794cb9ba3cdba2">bbuf_free</a>(cc-&gt;<a class="code" href="../../d8/d79/struct_c_class_node.html#a599db43b8eea536a4e4d08400fa445cb">mbuf</a>);
<a name="l04568"></a>04568     cc = prev_cc;
<a name="l04569"></a>04569   }
<a name="l04570"></a>04570 
<a name="l04571"></a>04571   <span class="keywordflow">if</span> (neg != 0)
<a name="l04572"></a>04572     <a class="code" href="../../d6/d87/regint_8h.html#afe2d37ab1bcdc5309dd3d5469f9f5aee">NCCLASS_SET_NOT</a>(cc);
<a name="l04573"></a>04573   <span class="keywordflow">else</span>
<a name="l04574"></a>04574     <a class="code" href="../../d6/d87/regint_8h.html#aa22b32b1a9c645e5d66e31e21cd9f1ed">NCCLASS_CLEAR_NOT</a>(cc);
<a name="l04575"></a>04575   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d87/regint_8h.html#aa719ec00173511740495f30fc0878c9e">IS_NCCLASS_NOT</a>(cc) &amp;&amp;
<a name="l04576"></a>04576       <a class="code" href="../../d1/dfc/regparse_8h.html#a18bfc9ee154d6dd516347bd71b4810f6">IS_SYNTAX_BV</a>(env-&gt;<a class="code" href="../../d6/dbe/struct_scan_env.html#ae5c4502ad7b7a4a418eda464919d2bda">syntax</a>, <a class="code" href="../../d8/db3/oniguruma_8h.html#aeacf0a4bc2d93f32b27639d16a9a7648">ONIG_SYN_NOT_NEWLINE_IN_NEGATIVE_CC</a>)) {
<a name="l04577"></a>04577     <span class="keywordtype">int</span> is_empty;
<a name="l04578"></a>04578 
<a name="l04579"></a>04579     is_empty = (<a class="code" href="../../d6/d87/regint_8h.html#a91a9c9242dc3810582965d1882d1894d">IS_NULL</a>(cc-&gt;<a class="code" href="../../d8/d79/struct_c_class_node.html#a599db43b8eea536a4e4d08400fa445cb">mbuf</a>) ? 1 : 0);
<a name="l04580"></a>04580     <span class="keywordflow">if</span> (is_empty != 0)
<a name="l04581"></a>04581       <a class="code" href="../../d6/dda/regparse_8c.html#ab965222074f64adfc1545ff478724d34">BITSET_IS_EMPTY</a>(cc-&gt;<a class="code" href="../../d8/d79/struct_c_class_node.html#a082458e56c928f78db90f08e242a9f3d">bs</a>, is_empty);
<a name="l04582"></a>04582 
<a name="l04583"></a>04583     <span class="keywordflow">if</span> (is_empty == 0) {
<a name="l04584"></a>04584 <span class="preprocessor">#define NEWLINE_CODE    0x0a</span>
<a name="l04585"></a>04585 <span class="preprocessor"></span>
<a name="l04586"></a>04586       <span class="keywordflow">if</span> (<a class="code" href="../../d8/db3/oniguruma_8h.html#afe325e094cd9677e27e2bbe095ff1b16">ONIGENC_IS_CODE_NEWLINE</a>(env-&gt;<a class="code" href="../../d6/dbe/struct_scan_env.html#a97f766db4ac9dabc9d173bf99fbcc11b">enc</a>, <a class="code" href="../../d6/dda/regparse_8c.html#aa7144e591c268db3c69433aa6b7cef1b">NEWLINE_CODE</a>)) {
<a name="l04587"></a>04587         <span class="keywordflow">if</span> (<a class="code" href="../../d8/db3/oniguruma_8h.html#ae9dd2f20953b82ba4589e04fabcadba7">ONIGENC_CODE_TO_MBCLEN</a>(env-&gt;<a class="code" href="../../d6/dbe/struct_scan_env.html#a97f766db4ac9dabc9d173bf99fbcc11b">enc</a>, <a class="code" href="../../d6/dda/regparse_8c.html#aa7144e591c268db3c69433aa6b7cef1b">NEWLINE_CODE</a>) == 1)
<a name="l04588"></a>04588           <a class="code" href="../../d6/dda/regparse_8c.html#acafa6a8e6b897efa2f65abaf8790a220">BITSET_SET_BIT_CHKDUP</a>(cc-&gt;<a class="code" href="../../d8/d79/struct_c_class_node.html#a082458e56c928f78db90f08e242a9f3d">bs</a>, <a class="code" href="../../d6/dda/regparse_8c.html#aa7144e591c268db3c69433aa6b7cef1b">NEWLINE_CODE</a>);
<a name="l04589"></a>04589         <span class="keywordflow">else</span>
<a name="l04590"></a>04590           <a class="code" href="../../d6/dda/regparse_8c.html#a6f589d793cc94713e0ec3a9ffa861b3a">add_code_range</a>(&amp;(cc-&gt;<a class="code" href="../../d8/d79/struct_c_class_node.html#a599db43b8eea536a4e4d08400fa445cb">mbuf</a>), env, <a class="code" href="../../d6/dda/regparse_8c.html#aa7144e591c268db3c69433aa6b7cef1b">NEWLINE_CODE</a>, <a class="code" href="../../d6/dda/regparse_8c.html#aa7144e591c268db3c69433aa6b7cef1b">NEWLINE_CODE</a>);
<a name="l04591"></a>04591       }
<a name="l04592"></a>04592     }
<a name="l04593"></a>04593   }
<a name="l04594"></a>04594   *src = p;
<a name="l04595"></a>04595   <span class="keywordflow">return</span> 0;
<a name="l04596"></a>04596 
<a name="l04597"></a>04597  <a class="code" href="../../d5/df2/win32_8c.html#a6ce68847c12434f60d1b2654a3dc3409">err</a>:
<a name="l04598"></a>04598   <span class="keywordflow">if</span> (cc != <a class="code" href="../../d1/dfc/regparse_8h.html#a816a6d8f921892c2efef73eb7727d589">NCCLASS</a>(*np))
<a name="l04599"></a>04599     <a class="code" href="../../d6/dda/regparse_8c.html#ac57154f90d1120d13c794cb9ba3cdba2">bbuf_free</a>(cc-&gt;<a class="code" href="../../d8/d79/struct_c_class_node.html#a599db43b8eea536a4e4d08400fa445cb">mbuf</a>);
<a name="l04600"></a>04600   <span class="keywordflow">return</span> r;
<a name="l04601"></a>04601 }
<a name="l04602"></a>04602 
<a name="l04603"></a>04603 <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d6/dda/regparse_8c.html#a3822726195b34935bce3ca92fe4d8085">parse_subexp</a>(<a class="code" href="../../d0/d6e/struct___node.html">Node</a>** <a class="code" href="../../d6/da0/nkf-utf8_2nkf_8c.html#a3fdd42ea34070a54e696b3adc28c4be3">top</a>, <a class="code" href="../../d0/d80/struct_onig_token.html">OnigToken</a>* <a class="code" href="../../d5/d11/ripper_8c.html#a2b3a335d617ec14d6296ca82d3055858">tok</a>, <span class="keywordtype">int</span> <a class="code" href="../../d3/d09/ripper_8y.html#a0c940d9e4ce4cfee55d7ccf714a1303d">term</a>,
<a name="l04604"></a>04604                         <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>** src, <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>* end, <a class="code" href="../../d6/dbe/struct_scan_env.html">ScanEnv</a>* env);
<a name="l04605"></a>04605 
<a name="l04606"></a>04606 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l04607"></a><a class="code" href="../../d6/dda/regparse_8c.html#ad9aeccad3a3c7ec807272797a39ce496">04607</a> <a class="code" href="../../d6/dda/regparse_8c.html#ad9aeccad3a3c7ec807272797a39ce496">parse_enclose</a>(<a class="code" href="../../d0/d6e/struct___node.html">Node</a>** np, <a class="code" href="../../d0/d80/struct_onig_token.html">OnigToken</a>* <a class="code" href="../../d5/d11/ripper_8c.html#a2b3a335d617ec14d6296ca82d3055858">tok</a>, <span class="keywordtype">int</span> <a class="code" href="../../d3/d09/ripper_8y.html#a0c940d9e4ce4cfee55d7ccf714a1303d">term</a>, <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>** src, <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>* end,
<a name="l04608"></a>04608               <a class="code" href="../../d6/dbe/struct_scan_env.html">ScanEnv</a>* env)
<a name="l04609"></a>04609 {
<a name="l04610"></a>04610   <span class="keywordtype">int</span> r, num;
<a name="l04611"></a>04611   <a class="code" href="../../d0/d6e/struct___node.html">Node</a> *target;
<a name="l04612"></a>04612   <a class="code" href="../../d8/db3/oniguruma_8h.html#ad870c1a94502ad33c083978b17911e72">OnigOptionType</a> option;
<a name="l04613"></a>04613   <a class="code" href="../../d8/db3/oniguruma_8h.html#a7c8a84bc12127007886efbfcf53b6fb5">OnigCodePoint</a> c;
<a name="l04614"></a>04614   <a class="code" href="../../d1/d7b/struct_onig_encoding_type_s_t.html">OnigEncoding</a> enc = env-&gt;<a class="code" href="../../d6/dbe/struct_scan_env.html#a97f766db4ac9dabc9d173bf99fbcc11b">enc</a>;
<a name="l04615"></a>04615 
<a name="l04616"></a>04616 <span class="preprocessor">#ifdef USE_NAMED_GROUP</span>
<a name="l04617"></a>04617 <span class="preprocessor"></span>  <span class="keywordtype">int</span> list_capture;
<a name="l04618"></a>04618 <span class="preprocessor">#endif</span>
<a name="l04619"></a>04619 <span class="preprocessor"></span>
<a name="l04620"></a>04620   <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>* p = *src;
<a name="l04621"></a>04621   <a class="code" href="../../d6/dda/regparse_8c.html#a44975cffe07e4559bf5638cafb4a6b30">PFETCH_READY</a>;
<a name="l04622"></a>04622 
<a name="l04623"></a>04623   *np = <a class="code" href="../../d3/d09/ripper_8y.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l04624"></a>04624   <span class="keywordflow">if</span> (<a class="code" href="../../d6/dda/regparse_8c.html#a43ce1d83d1961694adc2dfcbfac7d690">PEND</a>) <span class="keywordflow">return</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#ad7337f61aadafdaaffa6883966f79e0e">ONIGERR_END_PATTERN_WITH_UNMATCHED_PARENTHESIS</a>;
<a name="l04625"></a>04625 
<a name="l04626"></a>04626   option = env-&gt;<a class="code" href="../../d6/dbe/struct_scan_env.html#a1a7599f3079dfc7ab6d0b317f0f37d93">option</a>;
<a name="l04627"></a>04627   <span class="keywordflow">if</span> (<a class="code" href="../../d6/dda/regparse_8c.html#a4ed53b7baf65c82f4ba37027979ed82d">PPEEK_IS</a>(<span class="charliteral">&apos;?&apos;</span>) &amp;&amp;
<a name="l04628"></a>04628       <a class="code" href="../../d1/dfc/regparse_8h.html#a2ff963239e972932cefd5adaae161e76">IS_SYNTAX_OP2</a>(env-&gt;<a class="code" href="../../d6/dbe/struct_scan_env.html#ae5c4502ad7b7a4a418eda464919d2bda">syntax</a>, <a class="code" href="../../d8/db3/oniguruma_8h.html#a13b0e230fa74c42ddd7b50fb6ad9d3b4">ONIG_SYN_OP2_QMARK_GROUP_EFFECT</a>)) {
<a name="l04629"></a>04629     <a class="code" href="../../d6/dda/regparse_8c.html#a0545e73dc7ae14b1f62293c1feba3983">PINC</a>;
<a name="l04630"></a>04630     <span class="keywordflow">if</span> (<a class="code" href="../../d6/dda/regparse_8c.html#a43ce1d83d1961694adc2dfcbfac7d690">PEND</a>) <span class="keywordflow">return</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#aa914f30bf7876b915b075d14df37ae96">ONIGERR_END_PATTERN_IN_GROUP</a>;
<a name="l04631"></a>04631 
<a name="l04632"></a>04632     <a class="code" href="../../d6/dda/regparse_8c.html#a8a8898c873b81a88454a968371696cab">PFETCH</a>(c);
<a name="l04633"></a>04633     <span class="keywordflow">switch</span> (c) {
<a name="l04634"></a>04634     <span class="keywordflow">case</span> <span class="charliteral">&apos;:&apos;</span>:   <span class="comment">/* (?:...) grouping only */</span>
<a name="l04635"></a>04635     group:
<a name="l04636"></a>04636       r = <a class="code" href="../../d6/dda/regparse_8c.html#af1214620e9e6133cd463d363f2cb332f">fetch_token</a>(tok, &amp;p, end, env);
<a name="l04637"></a>04637       <span class="keywordflow">if</span> (r &lt; 0) <span class="keywordflow">return</span> r;
<a name="l04638"></a>04638       r = <a class="code" href="../../d6/dda/regparse_8c.html#a3822726195b34935bce3ca92fe4d8085">parse_subexp</a>(np, tok, term, &amp;p, end, env);
<a name="l04639"></a>04639       <span class="keywordflow">if</span> (r &lt; 0) <span class="keywordflow">return</span> r;
<a name="l04640"></a>04640       *src = p;
<a name="l04641"></a>04641       <span class="keywordflow">return</span> 1; <span class="comment">/* group */</span>
<a name="l04642"></a>04642       <span class="keywordflow">break</span>;
<a name="l04643"></a>04643 
<a name="l04644"></a>04644     <span class="keywordflow">case</span> <span class="charliteral">&apos;=&apos;</span>:
<a name="l04645"></a>04645       *np = <a class="code" href="../../d6/dda/regparse_8c.html#a153ac14abd8927a6edd4da2f445d1c30">onig_node_new_anchor</a>(<a class="code" href="../../d6/d87/regint_8h.html#aa0f9fc98186b637ecce6d72e12ee1eed">ANCHOR_PREC_READ</a>);
<a name="l04646"></a>04646       <span class="keywordflow">break</span>;
<a name="l04647"></a>04647     <span class="keywordflow">case</span> <span class="charliteral">&apos;!&apos;</span>:  <span class="comment">/*         preceding read */</span>
<a name="l04648"></a>04648       *np = <a class="code" href="../../d6/dda/regparse_8c.html#a153ac14abd8927a6edd4da2f445d1c30">onig_node_new_anchor</a>(<a class="code" href="../../d6/d87/regint_8h.html#a1c64ac74f61b2ffbf3b60f391ae65cbf">ANCHOR_PREC_READ_NOT</a>);
<a name="l04649"></a>04649       <span class="keywordflow">break</span>;
<a name="l04650"></a>04650     <span class="keywordflow">case</span> <span class="charliteral">&apos;&gt;&apos;</span>:            <span class="comment">/* (?&gt;...) stop backtrack */</span>
<a name="l04651"></a>04651       *np = <a class="code" href="../../d6/dda/regparse_8c.html#a266745047dad368886ed92677abae972">node_new_enclose</a>(<a class="code" href="../../d1/dfc/regparse_8h.html#a8a9f973f8fdb597a604757521ae63fe2">ENCLOSE_STOP_BACKTRACK</a>);
<a name="l04652"></a>04652       <span class="keywordflow">break</span>;
<a name="l04653"></a>04653 
<a name="l04654"></a>04654 <span class="preprocessor">#ifdef USE_NAMED_GROUP</span>
<a name="l04655"></a>04655 <span class="preprocessor"></span>    <span class="keywordflow">case</span> <span class="charliteral">&apos;\&apos;&apos;</span>:
<a name="l04656"></a>04656       <span class="keywordflow">if</span> (<a class="code" href="../../d1/dfc/regparse_8h.html#a2ff963239e972932cefd5adaae161e76">IS_SYNTAX_OP2</a>(env-&gt;<a class="code" href="../../d6/dbe/struct_scan_env.html#ae5c4502ad7b7a4a418eda464919d2bda">syntax</a>, <a class="code" href="../../d8/db3/oniguruma_8h.html#aa086dbb42e890875bbb8e2aace784490">ONIG_SYN_OP2_QMARK_LT_NAMED_GROUP</a>)) {
<a name="l04657"></a>04657         <span class="keywordflow">goto</span> named_group1;
<a name="l04658"></a>04658       }
<a name="l04659"></a>04659       <span class="keywordflow">else</span>
<a name="l04660"></a>04660         <span class="keywordflow">return</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#a6319fd25d2876af141d9bce6354d3743">ONIGERR_UNDEFINED_GROUP_OPTION</a>;
<a name="l04661"></a>04661       <span class="keywordflow">break</span>;
<a name="l04662"></a>04662 <span class="preprocessor">#endif</span>
<a name="l04663"></a>04663 <span class="preprocessor"></span>
<a name="l04664"></a>04664     <span class="keywordflow">case</span> <span class="charliteral">&apos;&lt;&apos;</span>:   <span class="comment">/* look behind (?&lt;=...), (?&lt;!...) */</span>
<a name="l04665"></a>04665       <a class="code" href="../../d6/dda/regparse_8c.html#a8a8898c873b81a88454a968371696cab">PFETCH</a>(c);
<a name="l04666"></a>04666       <span class="keywordflow">if</span> (c == <span class="charliteral">&apos;=&apos;</span>)
<a name="l04667"></a>04667         *np = <a class="code" href="../../d6/dda/regparse_8c.html#a153ac14abd8927a6edd4da2f445d1c30">onig_node_new_anchor</a>(<a class="code" href="../../d6/d87/regint_8h.html#a460ceecc3150bd7cd2437d41fbeb9ea8">ANCHOR_LOOK_BEHIND</a>);
<a name="l04668"></a>04668       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (c == <span class="charliteral">&apos;!&apos;</span>)
<a name="l04669"></a>04669         *np = <a class="code" href="../../d6/dda/regparse_8c.html#a153ac14abd8927a6edd4da2f445d1c30">onig_node_new_anchor</a>(<a class="code" href="../../d6/d87/regint_8h.html#a8812f9a061dd987fe8426262589b52c4">ANCHOR_LOOK_BEHIND_NOT</a>);
<a name="l04670"></a>04670 <span class="preprocessor">#ifdef USE_NAMED_GROUP</span>
<a name="l04671"></a>04671 <span class="preprocessor"></span>      <span class="keywordflow">else</span> {
<a name="l04672"></a>04672         <span class="keywordflow">if</span> (<a class="code" href="../../d1/dfc/regparse_8h.html#a2ff963239e972932cefd5adaae161e76">IS_SYNTAX_OP2</a>(env-&gt;<a class="code" href="../../d6/dbe/struct_scan_env.html#ae5c4502ad7b7a4a418eda464919d2bda">syntax</a>, <a class="code" href="../../d8/db3/oniguruma_8h.html#aa086dbb42e890875bbb8e2aace784490">ONIG_SYN_OP2_QMARK_LT_NAMED_GROUP</a>)) {
<a name="l04673"></a>04673           <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a> *name;
<a name="l04674"></a>04674           <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a> *name_end;
<a name="l04675"></a>04675 
<a name="l04676"></a>04676           <a class="code" href="../../d6/dda/regparse_8c.html#ad0350add3c44d502c77357f6012b1bf2">PUNFETCH</a>;
<a name="l04677"></a>04677           c = <span class="charliteral">&apos;&lt;&apos;</span>;
<a name="l04678"></a>04678 
<a name="l04679"></a>04679         named_group1:
<a name="l04680"></a>04680           list_capture = 0;
<a name="l04681"></a>04681 
<a name="l04682"></a>04682         named_group2:
<a name="l04683"></a>04683           name = p;
<a name="l04684"></a>04684           r = <a class="code" href="../../d6/dda/regparse_8c.html#a67cbe5ffbeb09676c26f3c3e4094128c">fetch_name</a>((<a class="code" href="../../d8/db3/oniguruma_8h.html#a7c8a84bc12127007886efbfcf53b6fb5">OnigCodePoint</a> )c, &amp;p, end, &amp;name_end, env, &amp;num, 0);
<a name="l04685"></a>04685           <span class="keywordflow">if</span> (r &lt; 0) <span class="keywordflow">return</span> r;
<a name="l04686"></a>04686 
<a name="l04687"></a>04687           num = <a class="code" href="../../d6/dda/regparse_8c.html#a3e5e1df9342133d21ffc0e237a6dbc70">scan_env_add_mem_entry</a>(env);
<a name="l04688"></a>04688           <span class="keywordflow">if</span> (num &lt; 0) <span class="keywordflow">return</span> num;
<a name="l04689"></a>04689           <span class="keywordflow">if</span> (list_capture != 0 &amp;&amp; num &gt;= (<span class="keywordtype">int</span> )<a class="code" href="../../d6/d87/regint_8h.html#a25d47543f457d3ae3219b004202cb919">BIT_STATUS_BITS_NUM</a>)
<a name="l04690"></a>04690             <span class="keywordflow">return</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#aece40f34e9d21a2822b291e1ab93ab63">ONIGERR_GROUP_NUMBER_OVER_FOR_CAPTURE_HISTORY</a>;
<a name="l04691"></a>04691 
<a name="l04692"></a>04692           r = <a class="code" href="../../d6/dda/regparse_8c.html#a18d0ecab53a77bd25604a68115200c6d">name_add</a>(env-&gt;<a class="code" href="../../d6/dbe/struct_scan_env.html#ae4606d4fccc90f08112b577ef1822eac">reg</a>, name, name_end, num, env);
<a name="l04693"></a>04693           <span class="keywordflow">if</span> (r != 0) <span class="keywordflow">return</span> r;
<a name="l04694"></a>04694           *np = <a class="code" href="../../d6/dda/regparse_8c.html#a0c09ce0753bb659111af8de34d8dd658">node_new_enclose_memory</a>(env-&gt;<a class="code" href="../../d6/dbe/struct_scan_env.html#a1a7599f3079dfc7ab6d0b317f0f37d93">option</a>, 1);
<a name="l04695"></a>04695           <a class="code" href="../../d6/d87/regint_8h.html#a17ebb2a12300dcf6d79916e357fae45a">CHECK_NULL_RETURN_MEMERR</a>(*np);
<a name="l04696"></a>04696           <a class="code" href="../../d1/dfc/regparse_8h.html#a2fea29a34640f28158788eef43a9bfd2">NENCLOSE</a>(*np)-&gt;regnum = num;
<a name="l04697"></a>04697           <a class="code" href="../../d7/dc0/parse_8y.html#a2ac1143ac343c79cbfa448e30d74fa1c">if</a> (list_capture != 0)
<a name="l04698"></a>04698             <a class="code" href="../../d6/d87/regint_8h.html#aed4001fbb4000757ab2f5a08d48d3fe9">BIT_STATUS_ON_AT_SIMPLE</a>(env-&gt;<a class="code" href="../../d6/dbe/struct_scan_env.html#aa096c240d283344fe4dd0626ac52e9ba">capture_history</a>, num);
<a name="l04699"></a>04699           env-&gt;<a class="code" href="../../d6/dbe/struct_scan_env.html#a6631d9427686a047869c75049f0d6c02">num_named</a>++;
<a name="l04700"></a>04700         }
<a name="l04701"></a>04701         <span class="keywordflow">else</span> {
<a name="l04702"></a>04702           <span class="keywordflow">return</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#a6319fd25d2876af141d9bce6354d3743">ONIGERR_UNDEFINED_GROUP_OPTION</a>;
<a name="l04703"></a>04703         }
<a name="l04704"></a>04704       }
<a name="l04705"></a>04705 <span class="preprocessor">#else</span>
<a name="l04706"></a>04706 <span class="preprocessor"></span>      <span class="keywordflow">else</span> {
<a name="l04707"></a>04707         <span class="keywordflow">return</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#a6319fd25d2876af141d9bce6354d3743">ONIGERR_UNDEFINED_GROUP_OPTION</a>;
<a name="l04708"></a>04708       }
<a name="l04709"></a>04709 <span class="preprocessor">#endif</span>
<a name="l04710"></a>04710 <span class="preprocessor"></span>      <span class="keywordflow">break</span>;
<a name="l04711"></a>04711 
<a name="l04712"></a>04712     <span class="keywordflow">case</span> <span class="charliteral">&apos;@&apos;</span>:
<a name="l04713"></a>04713       <span class="keywordflow">if</span> (<a class="code" href="../../d1/dfc/regparse_8h.html#a2ff963239e972932cefd5adaae161e76">IS_SYNTAX_OP2</a>(env-&gt;<a class="code" href="../../d6/dbe/struct_scan_env.html#ae5c4502ad7b7a4a418eda464919d2bda">syntax</a>, <a class="code" href="../../d8/db3/oniguruma_8h.html#a9ded5b41a807ceb5e9f8285ddad45505">ONIG_SYN_OP2_ATMARK_CAPTURE_HISTORY</a>)) {
<a name="l04714"></a>04714 <span class="preprocessor">#ifdef USE_NAMED_GROUP</span>
<a name="l04715"></a>04715 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (<a class="code" href="../../d1/dfc/regparse_8h.html#a2ff963239e972932cefd5adaae161e76">IS_SYNTAX_OP2</a>(env-&gt;<a class="code" href="../../d6/dbe/struct_scan_env.html#ae5c4502ad7b7a4a418eda464919d2bda">syntax</a>, <a class="code" href="../../d8/db3/oniguruma_8h.html#aa086dbb42e890875bbb8e2aace784490">ONIG_SYN_OP2_QMARK_LT_NAMED_GROUP</a>)) {
<a name="l04716"></a>04716           <a class="code" href="../../d6/dda/regparse_8c.html#a8a8898c873b81a88454a968371696cab">PFETCH</a>(c);
<a name="l04717"></a>04717           <span class="keywordflow">if</span> (c == <span class="charliteral">&apos;&lt;&apos;</span> || c == <span class="charliteral">&apos;\&apos;&apos;</span>) {
<a name="l04718"></a>04718             list_capture = 1;
<a name="l04719"></a>04719             <span class="keywordflow">goto</span> named_group2; <span class="comment">/* (?@&lt;name&gt;...) */</span>
<a name="l04720"></a>04720           }
<a name="l04721"></a>04721           <a class="code" href="../../d6/dda/regparse_8c.html#ad0350add3c44d502c77357f6012b1bf2">PUNFETCH</a>;
<a name="l04722"></a>04722         }
<a name="l04723"></a>04723 <span class="preprocessor">#endif</span>
<a name="l04724"></a>04724 <span class="preprocessor"></span>        *np = <a class="code" href="../../d6/dda/regparse_8c.html#a0c09ce0753bb659111af8de34d8dd658">node_new_enclose_memory</a>(env-&gt;<a class="code" href="../../d6/dbe/struct_scan_env.html#a1a7599f3079dfc7ab6d0b317f0f37d93">option</a>, 0);
<a name="l04725"></a>04725         <a class="code" href="../../d6/d87/regint_8h.html#a17ebb2a12300dcf6d79916e357fae45a">CHECK_NULL_RETURN_MEMERR</a>(*np);
<a name="l04726"></a>04726         num = <a class="code" href="../../d6/dda/regparse_8c.html#a3e5e1df9342133d21ffc0e237a6dbc70">scan_env_add_mem_entry</a>(env);
<a name="l04727"></a>04727         <span class="keywordflow">if</span> (num &lt; 0) {
<a name="l04728"></a>04728           <a class="code" href="../../d6/dda/regparse_8c.html#aa98ee34de192fd4997906389f70f4808">onig_node_free</a>(*np);
<a name="l04729"></a>04729           <span class="keywordflow">return</span> num;
<a name="l04730"></a>04730         }
<a name="l04731"></a>04731         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (num &gt;= (<span class="keywordtype">int</span> )<a class="code" href="../../d6/d87/regint_8h.html#a25d47543f457d3ae3219b004202cb919">BIT_STATUS_BITS_NUM</a>) {
<a name="l04732"></a>04732           <a class="code" href="../../d6/dda/regparse_8c.html#aa98ee34de192fd4997906389f70f4808">onig_node_free</a>(*np);
<a name="l04733"></a>04733           <span class="keywordflow">return</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#aece40f34e9d21a2822b291e1ab93ab63">ONIGERR_GROUP_NUMBER_OVER_FOR_CAPTURE_HISTORY</a>;
<a name="l04734"></a>04734         }
<a name="l04735"></a>04735         <a class="code" href="../../d1/dfc/regparse_8h.html#a2fea29a34640f28158788eef43a9bfd2">NENCLOSE</a>(*np)-&gt;regnum = num;
<a name="l04736"></a>04736         <a class="code" href="../../d6/d87/regint_8h.html#aed4001fbb4000757ab2f5a08d48d3fe9">BIT_STATUS_ON_AT_SIMPLE</a>(env-&gt;<a class="code" href="../../d6/dbe/struct_scan_env.html#aa096c240d283344fe4dd0626ac52e9ba">capture_history</a>, num);
<a name="l04737"></a>04737       }
<a name="l04738"></a>04738       <span class="keywordflow">else</span> {
<a name="l04739"></a>04739         <span class="keywordflow">return</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#a6319fd25d2876af141d9bce6354d3743">ONIGERR_UNDEFINED_GROUP_OPTION</a>;
<a name="l04740"></a>04740       }
<a name="l04741"></a>04741       <span class="keywordflow">break</span>;
<a name="l04742"></a>04742 
<a name="l04743"></a>04743 <span class="preprocessor">#ifdef USE_POSIXLINE_OPTION</span>
<a name="l04744"></a>04744 <span class="preprocessor"></span>    <span class="keywordflow">case</span> <span class="charliteral">&apos;p&apos;</span>:
<a name="l04745"></a>04745 <span class="preprocessor">#endif</span>
<a name="l04746"></a>04746 <span class="preprocessor"></span>    <span class="keywordflow">case</span> <span class="charliteral">&apos;-&apos;</span>: <span class="keywordflow">case</span> <span class="charliteral">&apos;i&apos;</span>: <span class="keywordflow">case</span> <span class="charliteral">&apos;m&apos;</span>: <span class="keywordflow">case</span> <span class="charliteral">&apos;s&apos;</span>: <span class="keywordflow">case</span> <span class="charliteral">&apos;x&apos;</span>:
<a name="l04747"></a>04747       {
<a name="l04748"></a>04748         <span class="keywordtype">int</span> <a class="code" href="../../df/d73/time_8c.html#a83f11f6624f6648aa502330ab8408073">neg</a> = 0;
<a name="l04749"></a>04749 
<a name="l04750"></a>04750         <span class="keywordflow">while</span> (1) {
<a name="l04751"></a>04751           <span class="keywordflow">switch</span> (c) {
<a name="l04752"></a>04752           <span class="keywordflow">case</span> <span class="charliteral">&apos;:&apos;</span>:
<a name="l04753"></a>04753           <span class="keywordflow">case</span> <span class="charliteral">&apos;)&apos;</span>:
<a name="l04754"></a>04754           <span class="keywordflow">break</span>;
<a name="l04755"></a>04755 
<a name="l04756"></a>04756           <span class="keywordflow">case</span> <span class="charliteral">&apos;-&apos;</span>:  neg = 1; <span class="keywordflow">break</span>;
<a name="l04757"></a>04757           <span class="keywordflow">case</span> <span class="charliteral">&apos;x&apos;</span>:  <a class="code" href="../../d6/dda/regparse_8c.html#a4602f81600008fe353870e4d762cb698">ONOFF</a>(option, <a class="code" href="../../d8/db3/oniguruma_8h.html#afa67d670a1e49f79cd06cc00e162276f">ONIG_OPTION_EXTEND</a>,     neg); <span class="keywordflow">break</span>;
<a name="l04758"></a>04758           <span class="keywordflow">case</span> <span class="charliteral">&apos;i&apos;</span>:  <a class="code" href="../../d6/dda/regparse_8c.html#a4602f81600008fe353870e4d762cb698">ONOFF</a>(option, <a class="code" href="../../d8/db3/oniguruma_8h.html#a7caf1d0c5932b5b8bb7c63185b0aa1d9">ONIG_OPTION_IGNORECASE</a>, neg); <span class="keywordflow">break</span>;
<a name="l04759"></a>04759           <span class="keywordflow">case</span> <span class="charliteral">&apos;s&apos;</span>:
<a name="l04760"></a>04760             <span class="keywordflow">if</span> (<a class="code" href="../../d1/dfc/regparse_8h.html#a2ff963239e972932cefd5adaae161e76">IS_SYNTAX_OP2</a>(env-&gt;<a class="code" href="../../d6/dbe/struct_scan_env.html#ae5c4502ad7b7a4a418eda464919d2bda">syntax</a>, <a class="code" href="../../d8/db3/oniguruma_8h.html#a268e0a74e3f9b4a4eed366f4e7bcddac">ONIG_SYN_OP2_OPTION_PERL</a>)) {
<a name="l04761"></a>04761               <a class="code" href="../../d6/dda/regparse_8c.html#a4602f81600008fe353870e4d762cb698">ONOFF</a>(option, <a class="code" href="../../d8/db3/oniguruma_8h.html#a52010cee374ac651e98e3182a862289d">ONIG_OPTION_MULTILINE</a>,  neg);
<a name="l04762"></a>04762             }
<a name="l04763"></a>04763             <span class="keywordflow">else</span>
<a name="l04764"></a>04764               <span class="keywordflow">return</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#a6319fd25d2876af141d9bce6354d3743">ONIGERR_UNDEFINED_GROUP_OPTION</a>;
<a name="l04765"></a>04765             <span class="keywordflow">break</span>;
<a name="l04766"></a>04766 
<a name="l04767"></a>04767           <span class="keywordflow">case</span> <span class="charliteral">&apos;m&apos;</span>:
<a name="l04768"></a>04768             <span class="keywordflow">if</span> (<a class="code" href="../../d1/dfc/regparse_8h.html#a2ff963239e972932cefd5adaae161e76">IS_SYNTAX_OP2</a>(env-&gt;<a class="code" href="../../d6/dbe/struct_scan_env.html#ae5c4502ad7b7a4a418eda464919d2bda">syntax</a>, <a class="code" href="../../d8/db3/oniguruma_8h.html#a268e0a74e3f9b4a4eed366f4e7bcddac">ONIG_SYN_OP2_OPTION_PERL</a>)) {
<a name="l04769"></a>04769               <a class="code" href="../../d6/dda/regparse_8c.html#a4602f81600008fe353870e4d762cb698">ONOFF</a>(option, <a class="code" href="../../d8/db3/oniguruma_8h.html#af2bf97acd558ad6e9dd18dfbfbeda7a4">ONIG_OPTION_SINGLELINE</a>, (neg == 0 ? 1 : 0));
<a name="l04770"></a>04770             }
<a name="l04771"></a>04771             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d1/dfc/regparse_8h.html#a2ff963239e972932cefd5adaae161e76">IS_SYNTAX_OP2</a>(env-&gt;<a class="code" href="../../d6/dbe/struct_scan_env.html#ae5c4502ad7b7a4a418eda464919d2bda">syntax</a>, <a class="code" href="../../d8/db3/oniguruma_8h.html#a7d320b0fe7a9c66212bc05b768dceaf7">ONIG_SYN_OP2_OPTION_RUBY</a>)) {
<a name="l04772"></a>04772               <a class="code" href="../../d6/dda/regparse_8c.html#a4602f81600008fe353870e4d762cb698">ONOFF</a>(option, <a class="code" href="../../d8/db3/oniguruma_8h.html#a52010cee374ac651e98e3182a862289d">ONIG_OPTION_MULTILINE</a>,  neg);
<a name="l04773"></a>04773             }
<a name="l04774"></a>04774             <span class="keywordflow">else</span>
<a name="l04775"></a>04775               <span class="keywordflow">return</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#a6319fd25d2876af141d9bce6354d3743">ONIGERR_UNDEFINED_GROUP_OPTION</a>;
<a name="l04776"></a>04776             <span class="keywordflow">break</span>;
<a name="l04777"></a>04777 <span class="preprocessor">#ifdef USE_POSIXLINE_OPTION</span>
<a name="l04778"></a>04778 <span class="preprocessor"></span>          <span class="keywordflow">case</span> <span class="charliteral">&apos;p&apos;</span>:
<a name="l04779"></a>04779             <a class="code" href="../../d6/dda/regparse_8c.html#a4602f81600008fe353870e4d762cb698">ONOFF</a>(option, <a class="code" href="../../d8/db3/oniguruma_8h.html#a52010cee374ac651e98e3182a862289d">ONIG_OPTION_MULTILINE</a>|<a class="code" href="../../d8/db3/oniguruma_8h.html#af2bf97acd558ad6e9dd18dfbfbeda7a4">ONIG_OPTION_SINGLELINE</a>, neg);
<a name="l04780"></a>04780             <span class="keywordflow">break</span>;
<a name="l04781"></a>04781 <span class="preprocessor">#endif</span>
<a name="l04782"></a>04782 <span class="preprocessor"></span>          <span class="keywordflow">default</span>:
<a name="l04783"></a>04783             <span class="keywordflow">return</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#a6319fd25d2876af141d9bce6354d3743">ONIGERR_UNDEFINED_GROUP_OPTION</a>;
<a name="l04784"></a>04784           }
<a name="l04785"></a>04785 
<a name="l04786"></a>04786           <span class="keywordflow">if</span> (c == <span class="charliteral">&apos;)&apos;</span>) {
<a name="l04787"></a>04787             *np = <a class="code" href="../../d6/dda/regparse_8c.html#a1f5cf25b24e05e8cf525e22e94d82fb4">node_new_option</a>(option);
<a name="l04788"></a>04788             <a class="code" href="../../d6/d87/regint_8h.html#a17ebb2a12300dcf6d79916e357fae45a">CHECK_NULL_RETURN_MEMERR</a>(*np);
<a name="l04789"></a>04789             *src = p;
<a name="l04790"></a>04790             <span class="keywordflow">return</span> 2; <span class="comment">/* option only */</span>
<a name="l04791"></a>04791           }
<a name="l04792"></a>04792           <span class="keywordflow">else</span> <span class="keywordflow">if</span> (c == <span class="charliteral">&apos;:&apos;</span>) {
<a name="l04793"></a>04793             <a class="code" href="../../d8/db3/oniguruma_8h.html#ad870c1a94502ad33c083978b17911e72">OnigOptionType</a> <a class="code" href="../../d7/dc0/parse_8y.html#a71f8b6ffdc0cc58ffd989c3162fb2bcf">prev</a> = env-&gt;<a class="code" href="../../d6/dbe/struct_scan_env.html#a1a7599f3079dfc7ab6d0b317f0f37d93">option</a>;
<a name="l04794"></a>04794 
<a name="l04795"></a>04795             env-&gt;<a class="code" href="../../d6/dbe/struct_scan_env.html#a1a7599f3079dfc7ab6d0b317f0f37d93">option</a>     = option;
<a name="l04796"></a>04796             r = <a class="code" href="../../d6/dda/regparse_8c.html#af1214620e9e6133cd463d363f2cb332f">fetch_token</a>(tok, &amp;p, end, env);
<a name="l04797"></a>04797             <span class="keywordflow">if</span> (r &lt; 0) <span class="keywordflow">return</span> r;
<a name="l04798"></a>04798             r = <a class="code" href="../../d6/dda/regparse_8c.html#a3822726195b34935bce3ca92fe4d8085">parse_subexp</a>(&amp;target, tok, term, &amp;p, end, env);
<a name="l04799"></a>04799             env-&gt;<a class="code" href="../../d6/dbe/struct_scan_env.html#a1a7599f3079dfc7ab6d0b317f0f37d93">option</a> = prev;
<a name="l04800"></a>04800             <span class="keywordflow">if</span> (r &lt; 0) <span class="keywordflow">return</span> r;
<a name="l04801"></a>04801             *np = <a class="code" href="../../d6/dda/regparse_8c.html#a1f5cf25b24e05e8cf525e22e94d82fb4">node_new_option</a>(option);
<a name="l04802"></a>04802             <a class="code" href="../../d6/d87/regint_8h.html#a17ebb2a12300dcf6d79916e357fae45a">CHECK_NULL_RETURN_MEMERR</a>(*np);
<a name="l04803"></a>04803             <a class="code" href="../../d1/dfc/regparse_8h.html#a2fea29a34640f28158788eef43a9bfd2">NENCLOSE</a>(*np)-&gt;target = target;
<a name="l04804"></a>04804             *src = p;
<a name="l04805"></a>04805             <span class="keywordflow">return</span> 0;
<a name="l04806"></a>04806           }
<a name="l04807"></a>04807 
<a name="l04808"></a>04808           <span class="keywordflow">if</span> (<a class="code" href="../../d6/dda/regparse_8c.html#a43ce1d83d1961694adc2dfcbfac7d690">PEND</a>) <span class="keywordflow">return</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#aa914f30bf7876b915b075d14df37ae96">ONIGERR_END_PATTERN_IN_GROUP</a>;
<a name="l04809"></a>04809           <a class="code" href="../../d6/dda/regparse_8c.html#a8a8898c873b81a88454a968371696cab">PFETCH</a>(c);
<a name="l04810"></a>04810         }
<a name="l04811"></a>04811       }
<a name="l04812"></a>04812       <span class="keywordflow">break</span>;
<a name="l04813"></a>04813 
<a name="l04814"></a>04814     <span class="keywordflow">default</span>:
<a name="l04815"></a>04815       <span class="keywordflow">return</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#a6319fd25d2876af141d9bce6354d3743">ONIGERR_UNDEFINED_GROUP_OPTION</a>;
<a name="l04816"></a>04816     }
<a name="l04817"></a>04817   }
<a name="l04818"></a>04818   <span class="keywordflow">else</span> {
<a name="l04819"></a>04819     <span class="keywordflow">if</span> (<a class="code" href="../../d8/db3/oniguruma_8h.html#a2ff7c691b88c0b43377bbe3f409b036a">ONIG_IS_OPTION_ON</a>(env-&gt;<a class="code" href="../../d6/dbe/struct_scan_env.html#a1a7599f3079dfc7ab6d0b317f0f37d93">option</a>, <a class="code" href="../../d8/db3/oniguruma_8h.html#a11bf0bcd0621c5ceb91d60d7c17103c7">ONIG_OPTION_DONT_CAPTURE_GROUP</a>))
<a name="l04820"></a>04820       <span class="keywordflow">goto</span> group;
<a name="l04821"></a>04821 
<a name="l04822"></a>04822     *np = <a class="code" href="../../d6/dda/regparse_8c.html#a0c09ce0753bb659111af8de34d8dd658">node_new_enclose_memory</a>(env-&gt;<a class="code" href="../../d6/dbe/struct_scan_env.html#a1a7599f3079dfc7ab6d0b317f0f37d93">option</a>, 0);
<a name="l04823"></a>04823     <a class="code" href="../../d6/d87/regint_8h.html#a17ebb2a12300dcf6d79916e357fae45a">CHECK_NULL_RETURN_MEMERR</a>(*np);
<a name="l04824"></a>04824     num = <a class="code" href="../../d6/dda/regparse_8c.html#a3e5e1df9342133d21ffc0e237a6dbc70">scan_env_add_mem_entry</a>(env);
<a name="l04825"></a>04825     <span class="keywordflow">if</span> (num &lt; 0) <span class="keywordflow">return</span> num;
<a name="l04826"></a>04826     <a class="code" href="../../d1/dfc/regparse_8h.html#a2fea29a34640f28158788eef43a9bfd2">NENCLOSE</a>(*np)-&gt;regnum = num;
<a name="l04827"></a>04827   }
<a name="l04828"></a>04828 
<a name="l04829"></a>04829   <a class="code" href="../../d6/d87/regint_8h.html#a17ebb2a12300dcf6d79916e357fae45a">CHECK_NULL_RETURN_MEMERR</a>(*np);
<a name="l04830"></a>04830   r = <a class="code" href="../../d6/dda/regparse_8c.html#af1214620e9e6133cd463d363f2cb332f">fetch_token</a>(tok, &amp;p, end, env);
<a name="l04831"></a>04831   <span class="keywordflow">if</span> (r &lt; 0) <span class="keywordflow">return</span> r;
<a name="l04832"></a>04832   r = <a class="code" href="../../d6/dda/regparse_8c.html#a3822726195b34935bce3ca92fe4d8085">parse_subexp</a>(&amp;target, tok, term, &amp;p, end, env);
<a name="l04833"></a>04833   <span class="keywordflow">if</span> (r &lt; 0) {
<a name="l04834"></a>04834     <a class="code" href="../../d6/dda/regparse_8c.html#aa98ee34de192fd4997906389f70f4808">onig_node_free</a>(target);
<a name="l04835"></a>04835     <span class="keywordflow">return</span> r;
<a name="l04836"></a>04836   }
<a name="l04837"></a>04837 
<a name="l04838"></a>04838   <span class="keywordflow">if</span> (<a class="code" href="../../d1/dfc/regparse_8h.html#ad500a736993c4ddc933ff93b42eeb1e5">NTYPE</a>(*np) == <a class="code" href="../../d1/dfc/regparse_8h.html#a4169804cb78eccf494a7f72ae737be32">NT_ANCHOR</a>)
<a name="l04839"></a>04839     <a class="code" href="../../d1/dfc/regparse_8h.html#aff69a39d6dfe87d4eb079758e46cb226">NANCHOR</a>(*np)-&gt;target = target;
<a name="l04840"></a>04840   <span class="keywordflow">else</span> {
<a name="l04841"></a>04841     <a class="code" href="../../d1/dfc/regparse_8h.html#a2fea29a34640f28158788eef43a9bfd2">NENCLOSE</a>(*np)-&gt;target = target;
<a name="l04842"></a>04842     <a class="code" href="../../d7/dc0/parse_8y.html#a2ac1143ac343c79cbfa448e30d74fa1c">if</a> (<a class="code" href="../../d1/dfc/regparse_8h.html#a2fea29a34640f28158788eef43a9bfd2">NENCLOSE</a>(*np)-&gt;type == <a class="code" href="../../d1/dfc/regparse_8h.html#a32e44d8ddaca8fd4931a8c13677972ad">ENCLOSE_MEMORY</a>) {
<a name="l04843"></a>04843       <span class="comment">/* Don&apos;t move this to previous of parse_subexp() */</span>
<a name="l04844"></a>04844       r = <a class="code" href="../../d6/dda/regparse_8c.html#aebbe7e869e902b29a5a9867fd47c9c1f">scan_env_set_mem_node</a>(env, <a class="code" href="../../d1/dfc/regparse_8h.html#a2fea29a34640f28158788eef43a9bfd2">NENCLOSE</a>(*np)-&gt;regnum, *np);
<a name="l04845"></a>04845       <span class="keywordflow">if</span> (r != 0) <span class="keywordflow">return</span> r;
<a name="l04846"></a>04846     }
<a name="l04847"></a>04847   }
<a name="l04848"></a>04848 
<a name="l04849"></a>04849   *src = p;
<a name="l04850"></a>04850   <span class="keywordflow">return</span> 0;
<a name="l04851"></a>04851 }
<a name="l04852"></a>04852 
<a name="l04853"></a><a class="code" href="../../d6/dda/regparse_8c.html#ac309e9ee632ae044ce25eaf623987f8f">04853</a> <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span>* <span class="keyword">const</span> <a class="code" href="../../d6/dda/regparse_8c.html#ac309e9ee632ae044ce25eaf623987f8f">PopularQStr</a>[] = {
<a name="l04854"></a>04854   <span class="stringliteral">&quot;?&quot;</span>, <span class="stringliteral">&quot;*&quot;</span>, <span class="stringliteral">&quot;+&quot;</span>, <span class="stringliteral">&quot;??&quot;</span>, <span class="stringliteral">&quot;*?&quot;</span>, <span class="stringliteral">&quot;+?&quot;</span>
<a name="l04855"></a>04855 };
<a name="l04856"></a>04856 
<a name="l04857"></a><a class="code" href="../../d6/dda/regparse_8c.html#a476c755e51ea4644b4a169b42fc9b143">04857</a> <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span>* <span class="keyword">const</span> <a class="code" href="../../d6/dda/regparse_8c.html#a476c755e51ea4644b4a169b42fc9b143">ReduceQStr</a>[] = {
<a name="l04858"></a>04858   <span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;*&quot;</span>, <span class="stringliteral">&quot;*?&quot;</span>, <span class="stringliteral">&quot;??&quot;</span>, <span class="stringliteral">&quot;+ and ??&quot;</span>, <span class="stringliteral">&quot;+? and ?&quot;</span>
<a name="l04859"></a>04859 };
<a name="l04860"></a>04860 
<a name="l04861"></a>04861 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l04862"></a><a class="code" href="../../d6/dda/regparse_8c.html#a303bd068bc2aa1a3e21b2f36bc2f2cc5">04862</a> <a class="code" href="../../d6/dda/regparse_8c.html#a303bd068bc2aa1a3e21b2f36bc2f2cc5">set_quantifier</a>(<a class="code" href="../../d0/d6e/struct___node.html">Node</a>* qnode, <a class="code" href="../../d0/d6e/struct___node.html">Node</a>* target, <span class="keywordtype">int</span> group, <a class="code" href="../../d6/dbe/struct_scan_env.html">ScanEnv</a>* env)
<a name="l04863"></a>04863 {
<a name="l04864"></a>04864   <a class="code" href="../../d4/dfa/struct_qtfr_node.html">QtfrNode</a>* qn;
<a name="l04865"></a>04865 
<a name="l04866"></a>04866   qn = <a class="code" href="../../d1/dfc/regparse_8h.html#addc653094848075876587782124e9504">NQTFR</a>(qnode);
<a name="l04867"></a>04867   <span class="keywordflow">if</span> (qn-&gt;<a class="code" href="../../d4/dfa/struct_qtfr_node.html#a2a09a09d1685822771870905699f4c4d">lower</a> == 1 &amp;&amp; qn-&gt;<a class="code" href="../../d4/dfa/struct_qtfr_node.html#ad6302c7e3c130ed1f322b11ca7b7b3b8">upper</a> == 1) {
<a name="l04868"></a>04868     <span class="keywordflow">return</span> 1;
<a name="l04869"></a>04869   }
<a name="l04870"></a>04870 
<a name="l04871"></a>04871   <span class="keywordflow">switch</span> (<a class="code" href="../../d1/dfc/regparse_8h.html#ad500a736993c4ddc933ff93b42eeb1e5">NTYPE</a>(target)) {
<a name="l04872"></a>04872   <span class="keywordflow">case</span> <a class="code" href="../../d1/dfc/regparse_8h.html#ad5d1aafda0801d24b9425f6c01515ed9">NT_STR</a>:
<a name="l04873"></a>04873     <span class="keywordflow">if</span> (! group) {
<a name="l04874"></a>04874       <a class="code" href="../../d2/db7/struct_str_node.html">StrNode</a>* sn = <a class="code" href="../../d1/dfc/regparse_8h.html#a24a4b2af18dda01ae000ec64129eb50e">NSTR</a>(target);
<a name="l04875"></a>04875       <span class="keywordflow">if</span> (<a class="code" href="../../d6/dda/regparse_8c.html#a2b69c9575ebabd08f63f66a20a375885">str_node_can_be_split</a>(sn, env-&gt;<a class="code" href="../../d6/dbe/struct_scan_env.html#a97f766db4ac9dabc9d173bf99fbcc11b">enc</a>)) {
<a name="l04876"></a>04876         <a class="code" href="../../d0/d6e/struct___node.html">Node</a>* n = <a class="code" href="../../d6/dda/regparse_8c.html#a5a7bcd095caf1c5e0a32107d91530bb2">str_node_split_last_char</a>(sn, env-&gt;<a class="code" href="../../d6/dbe/struct_scan_env.html#a97f766db4ac9dabc9d173bf99fbcc11b">enc</a>);
<a name="l04877"></a>04877         <span class="keywordflow">if</span> (<a class="code" href="../../d6/d87/regint_8h.html#a4bc25fbd4749a2c130d1ae7f15ba140c">IS_NOT_NULL</a>(n)) {
<a name="l04878"></a>04878           qn-&gt;<a class="code" href="../../d4/dfa/struct_qtfr_node.html#a358ba7208e8bf097527cc9813adc5017">target</a> = n;
<a name="l04879"></a>04879           <span class="keywordflow">return</span> 2;
<a name="l04880"></a>04880         }
<a name="l04881"></a>04881       }
<a name="l04882"></a>04882     }
<a name="l04883"></a>04883     <span class="keywordflow">break</span>;
<a name="l04884"></a>04884 
<a name="l04885"></a>04885   <span class="keywordflow">case</span> <a class="code" href="../../d1/dfc/regparse_8h.html#a307b2dd57583d60d4d89eae6478b69ab">NT_QTFR</a>:
<a name="l04886"></a>04886     { <span class="comment">/* check redundant double repeat. */</span>
<a name="l04887"></a>04887       <span class="comment">/* verbose warn (?:.?)? etc... but not warn (.?)? etc... */</span>
<a name="l04888"></a>04888       <a class="code" href="../../d4/dfa/struct_qtfr_node.html">QtfrNode</a>* qnt   = <a class="code" href="../../d1/dfc/regparse_8h.html#addc653094848075876587782124e9504">NQTFR</a>(target);
<a name="l04889"></a>04889       <span class="keywordtype">int</span> nestq_num   = <a class="code" href="../../d6/dda/regparse_8c.html#ad0588379c3e11c85d9df21597c747590">popular_quantifier_num</a>(qn);
<a name="l04890"></a>04890       <span class="keywordtype">int</span> targetq_num = <a class="code" href="../../d6/dda/regparse_8c.html#ad0588379c3e11c85d9df21597c747590">popular_quantifier_num</a>(qnt);
<a name="l04891"></a>04891 
<a name="l04892"></a>04892 <span class="preprocessor">#ifdef USE_WARNING_REDUNDANT_NESTED_REPEAT_OPERATOR</span>
<a name="l04893"></a>04893 <span class="preprocessor"></span>      <span class="keywordflow">if</span> (!<a class="code" href="../../d1/dfc/regparse_8h.html#ad8fa003e04d421ca24f09441a6e8af5e">IS_QUANTIFIER_BY_NUMBER</a>(qn) &amp;&amp; !<a class="code" href="../../d1/dfc/regparse_8h.html#ad8fa003e04d421ca24f09441a6e8af5e">IS_QUANTIFIER_BY_NUMBER</a>(qnt) &amp;&amp;
<a name="l04894"></a>04894           <a class="code" href="../../d1/dfc/regparse_8h.html#a18bfc9ee154d6dd516347bd71b4810f6">IS_SYNTAX_BV</a>(env-&gt;<a class="code" href="../../d6/dbe/struct_scan_env.html#ae5c4502ad7b7a4a418eda464919d2bda">syntax</a>, <a class="code" href="../../d8/db3/oniguruma_8h.html#a7f435020030f24a088a8aa07b47710ff">ONIG_SYN_WARN_REDUNDANT_NESTED_REPEAT</a>)) {
<a name="l04895"></a>04895         <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a> buf[<a class="code" href="../../d6/dda/regparse_8c.html#a672827e035b8ebbeae739f715a4757b7">WARN_BUFSIZE</a>];
<a name="l04896"></a>04896 
<a name="l04897"></a>04897         <span class="keywordflow">switch</span>(ReduceTypeTable[targetq_num][nestq_num]) {
<a name="l04898"></a>04898         <span class="keywordflow">case</span> <a class="code" href="../../d6/dda/regparse_8c.html#a26fff899180e6c348dc9565f49ff47beabe88693340c4c0c4faf73309b9abd3fe">RQ_ASIS</a>:
<a name="l04899"></a>04899           <span class="keywordflow">break</span>;
<a name="l04900"></a>04900 
<a name="l04901"></a>04901         <span class="keywordflow">case</span> <a class="code" href="../../d6/dda/regparse_8c.html#a26fff899180e6c348dc9565f49ff47beadf468bf43946f854b6ce42b414a30774">RQ_DEL</a>:
<a name="l04902"></a>04902           <span class="keywordflow">if</span> (<a class="code" href="../../d6/dda/regparse_8c.html#a6b03912e53a004c0523030d1b31bbe1f">onig_verb_warn</a> != <a class="code" href="../../d6/dda/regparse_8c.html#a32f51f068bd8e9c2eb940e259f054e9f">onig_null_warn</a>) {
<a name="l04903"></a>04903             <a class="code" href="../../d5/d61/regerror_8c.html#a9820b6d3b0b87ef9199aff744725bda6">onig_snprintf_with_pattern</a>(buf, <a class="code" href="../../d6/dda/regparse_8c.html#a672827e035b8ebbeae739f715a4757b7">WARN_BUFSIZE</a>, env-&gt;<a class="code" href="../../d6/dbe/struct_scan_env.html#a97f766db4ac9dabc9d173bf99fbcc11b">enc</a>,
<a name="l04904"></a>04904                                  env-&gt;<a class="code" href="../../d6/dbe/struct_scan_env.html#af50cd3b4f33598bb18cd17465186775e">pattern</a>, env-&gt;<a class="code" href="../../d6/dbe/struct_scan_env.html#a4181f23bd0ae880c5e3f0dff09e71277">pattern_end</a>,
<a name="l04905"></a>04905                                  (<a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>* )<span class="stringliteral">&quot;redundant nested repeat operator&quot;</span>);
<a name="l04906"></a>04906             (*onig_verb_warn)((<span class="keywordtype">char</span>* )buf);
<a name="l04907"></a>04907           }
<a name="l04908"></a>04908           <span class="keywordflow">goto</span> warn_exit;
<a name="l04909"></a>04909           <span class="keywordflow">break</span>;
<a name="l04910"></a>04910 
<a name="l04911"></a>04911         <span class="keywordflow">default</span>:
<a name="l04912"></a>04912           <span class="keywordflow">if</span> (<a class="code" href="../../d6/dda/regparse_8c.html#a6b03912e53a004c0523030d1b31bbe1f">onig_verb_warn</a> != <a class="code" href="../../d6/dda/regparse_8c.html#a32f51f068bd8e9c2eb940e259f054e9f">onig_null_warn</a>) {
<a name="l04913"></a>04913             <a class="code" href="../../d5/d61/regerror_8c.html#a9820b6d3b0b87ef9199aff744725bda6">onig_snprintf_with_pattern</a>(buf, <a class="code" href="../../d6/dda/regparse_8c.html#a672827e035b8ebbeae739f715a4757b7">WARN_BUFSIZE</a>, env-&gt;<a class="code" href="../../d6/dbe/struct_scan_env.html#a97f766db4ac9dabc9d173bf99fbcc11b">enc</a>,
<a name="l04914"></a>04914                                        env-&gt;<a class="code" href="../../d6/dbe/struct_scan_env.html#af50cd3b4f33598bb18cd17465186775e">pattern</a>, env-&gt;<a class="code" href="../../d6/dbe/struct_scan_env.html#a4181f23bd0ae880c5e3f0dff09e71277">pattern_end</a>,
<a name="l04915"></a>04915             (<a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>* )<span class="stringliteral">&quot;nested repeat operator %s and %s was replaced with &apos;%s&apos;&quot;</span>,
<a name="l04916"></a>04916             PopularQStr[targetq_num], PopularQStr[nestq_num],
<a name="l04917"></a>04917             ReduceQStr[ReduceTypeTable[targetq_num][nestq_num]]);
<a name="l04918"></a>04918             (*onig_verb_warn)((<span class="keywordtype">char</span>* )buf);
<a name="l04919"></a>04919           }
<a name="l04920"></a>04920           <span class="keywordflow">goto</span> warn_exit;
<a name="l04921"></a>04921           <span class="keywordflow">break</span>;
<a name="l04922"></a>04922         }
<a name="l04923"></a>04923       }
<a name="l04924"></a>04924 
<a name="l04925"></a>04925     warn_exit:
<a name="l04926"></a>04926 <span class="preprocessor">#endif</span>
<a name="l04927"></a>04927 <span class="preprocessor"></span>      <span class="keywordflow">if</span> (targetq_num &gt;= 0) {
<a name="l04928"></a>04928         <span class="keywordflow">if</span> (nestq_num &gt;= 0) {
<a name="l04929"></a>04929           <a class="code" href="../../d6/dda/regparse_8c.html#ace588d68b5808852a8265c27b18e6ed2">onig_reduce_nested_quantifier</a>(qnode, target);
<a name="l04930"></a>04930           <span class="keywordflow">goto</span> q_exit;
<a name="l04931"></a>04931         }
<a name="l04932"></a>04932         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (targetq_num == 1 || targetq_num == 2) { <span class="comment">/* * or + */</span>
<a name="l04933"></a>04933           <span class="comment">/* (?:a*){n,m}, (?:a+){n,m} =&gt; (?:a*){n,n}, (?:a+){n,n} */</span>
<a name="l04934"></a>04934           <span class="keywordflow">if</span> (! <a class="code" href="../../d6/d87/regint_8h.html#a7b7f11d4b2705496b7711598403d4f72">IS_REPEAT_INFINITE</a>(qn-&gt;<a class="code" href="../../d4/dfa/struct_qtfr_node.html#ad6302c7e3c130ed1f322b11ca7b7b3b8">upper</a>) &amp;&amp; qn-&gt;<a class="code" href="../../d4/dfa/struct_qtfr_node.html#ad6302c7e3c130ed1f322b11ca7b7b3b8">upper</a> &gt; 1 &amp;&amp; qn-&gt;<a class="code" href="../../d4/dfa/struct_qtfr_node.html#a8a7f7398dce22e1445a7900f90e374bf">greedy</a>) {
<a name="l04935"></a>04935             qn-&gt;<a class="code" href="../../d4/dfa/struct_qtfr_node.html#ad6302c7e3c130ed1f322b11ca7b7b3b8">upper</a> = (qn-&gt;<a class="code" href="../../d4/dfa/struct_qtfr_node.html#a2a09a09d1685822771870905699f4c4d">lower</a> == 0 ? 1 : qn-&gt;<a class="code" href="../../d4/dfa/struct_qtfr_node.html#a2a09a09d1685822771870905699f4c4d">lower</a>);
<a name="l04936"></a>04936           }
<a name="l04937"></a>04937         }
<a name="l04938"></a>04938       }
<a name="l04939"></a>04939     }
<a name="l04940"></a>04940     <span class="keywordflow">break</span>;
<a name="l04941"></a>04941 
<a name="l04942"></a>04942   <span class="keywordflow">default</span>:
<a name="l04943"></a>04943     <span class="keywordflow">break</span>;
<a name="l04944"></a>04944   }
<a name="l04945"></a>04945 
<a name="l04946"></a>04946   qn-&gt;<a class="code" href="../../d4/dfa/struct_qtfr_node.html#a358ba7208e8bf097527cc9813adc5017">target</a> = target;
<a name="l04947"></a>04947  q_exit:
<a name="l04948"></a>04948   <span class="keywordflow">return</span> 0;
<a name="l04949"></a>04949 }
<a name="l04950"></a>04950 
<a name="l04951"></a>04951 
<a name="l04952"></a>04952 <span class="preprocessor">#ifdef USE_SHARED_CCLASS_TABLE</span>
<a name="l04953"></a>04953 <span class="preprocessor"></span>
<a name="l04954"></a><a class="code" href="../../d6/dda/regparse_8c.html#aa56df0b504a51051736f28ef2396175f">04954</a> <span class="preprocessor">#define THRESHOLD_RANGE_NUM_FOR_SHARE_CCLASS     8</span>
<a name="l04955"></a>04955 <span class="preprocessor"></span>
<a name="l04956"></a>04956 <span class="comment">/* for ctype node hash table */</span>
<a name="l04957"></a>04957 
<a name="l04958"></a><a class="code" href="../../dc/d85/structtype__cclass__key.html">04958</a> <span class="keyword">typedef</span> <span class="keyword">struct </span>{
<a name="l04959"></a><a class="code" href="../../dc/d85/structtype__cclass__key.html#a1faea618be3c6662cb3868496f3b2867">04959</a>   <a class="code" href="../../d1/d7b/struct_onig_encoding_type_s_t.html">OnigEncoding</a> enc;
<a name="l04960"></a><a class="code" href="../../dc/d85/structtype__cclass__key.html#aba17e22a7eece4b1fc97dac64ae8ae3f">04960</a>   <span class="keywordtype">int</span> not;
<a name="l04961"></a><a class="code" href="../../dc/d85/structtype__cclass__key.html#aa809515f1a338c4e0b2185458e22af25">04961</a>   <span class="keywordtype">int</span> <a class="code" href="../../d5/d9d/tcltklib_8c.html#ac765329451135abec74c45e1897abf26">type</a>;
<a name="l04962"></a>04962 } <a class="code" href="../../dc/d85/structtype__cclass__key.html">type_cclass_key</a>;
<a name="l04963"></a>04963 
<a name="l04964"></a><a class="code" href="../../d6/dda/regparse_8c.html#af461c684cd2f34bce5b132ec13428d99">04964</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d6/dda/regparse_8c.html#af461c684cd2f34bce5b132ec13428d99">type_cclass_cmp</a>(<a class="code" href="../../dc/d85/structtype__cclass__key.html">type_cclass_key</a>* x, <a class="code" href="../../dc/d85/structtype__cclass__key.html">type_cclass_key</a>* y)
<a name="l04965"></a>04965 {
<a name="l04966"></a>04966   <span class="keywordflow">if</span> (x-&gt;<a class="code" href="../../dc/d85/structtype__cclass__key.html#aa809515f1a338c4e0b2185458e22af25">type</a> != y-&gt;<a class="code" href="../../dc/d85/structtype__cclass__key.html#aa809515f1a338c4e0b2185458e22af25">type</a>) <span class="keywordflow">return</span> 1;
<a name="l04967"></a>04967   <span class="keywordflow">if</span> (x-&gt;<a class="code" href="../../dc/d85/structtype__cclass__key.html#a1faea618be3c6662cb3868496f3b2867">enc</a>  != y-&gt;<a class="code" href="../../dc/d85/structtype__cclass__key.html#a1faea618be3c6662cb3868496f3b2867">enc</a>)  <span class="keywordflow">return</span> 1;
<a name="l04968"></a>04968   <span class="keywordflow">if</span> (x-&gt;<a class="code" href="../../dc/d85/structtype__cclass__key.html#aba17e22a7eece4b1fc97dac64ae8ae3f">not</a>  != y-&gt;<a class="code" href="../../dc/d85/structtype__cclass__key.html#aba17e22a7eece4b1fc97dac64ae8ae3f">not</a>)  <span class="keywordflow">return</span> 1;
<a name="l04969"></a>04969   <span class="keywordflow">return</span> 0;
<a name="l04970"></a>04970 }
<a name="l04971"></a>04971 
<a name="l04972"></a><a class="code" href="../../d6/dda/regparse_8c.html#aa9c9e9f620273a073687aa403eb5dd01">04972</a> <span class="keyword">static</span> <a class="code" href="../../dd/d24/st_8h.html#ac214e5cdcf0de6a2108b9643e7fc12e0">st_index_t</a> <a class="code" href="../../d6/dda/regparse_8c.html#aa9c9e9f620273a073687aa403eb5dd01">type_cclass_hash</a>(<a class="code" href="../../dc/d85/structtype__cclass__key.html">type_cclass_key</a>* <a class="code" href="../../dc/de5/random_8c.html#a742229490b6759a90ece7ba82ba129d5">key</a>)
<a name="l04973"></a>04973 {
<a name="l04974"></a>04974   <span class="keywordtype">int</span> i, val;
<a name="l04975"></a>04975   <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a> *p;
<a name="l04976"></a>04976 
<a name="l04977"></a>04977   val = 0;
<a name="l04978"></a>04978 
<a name="l04979"></a>04979   p = (<a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>* )&amp;(key-&gt;<a class="code" href="../../dc/d85/structtype__cclass__key.html#a1faea618be3c6662cb3868496f3b2867">enc</a>);
<a name="l04980"></a>04980   <span class="keywordflow">for</span> (i = 0; i &lt; (int )<span class="keyword">sizeof</span>(key-&gt;<a class="code" href="../../dc/d85/structtype__cclass__key.html#a1faea618be3c6662cb3868496f3b2867">enc</a>); i++) {
<a name="l04981"></a>04981     val = val * 997 + (int )*p++;
<a name="l04982"></a>04982   }
<a name="l04983"></a>04983 
<a name="l04984"></a>04984   p = (<a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>* )(&amp;key-&gt;<a class="code" href="../../dc/d85/structtype__cclass__key.html#aa809515f1a338c4e0b2185458e22af25">type</a>);
<a name="l04985"></a>04985   <span class="keywordflow">for</span> (i = 0; i &lt; (int )<span class="keyword">sizeof</span>(key-&gt;<a class="code" href="../../dc/d85/structtype__cclass__key.html#aa809515f1a338c4e0b2185458e22af25">type</a>); i++) {
<a name="l04986"></a>04986     val = val * 997 + (int )*p++;
<a name="l04987"></a>04987   }
<a name="l04988"></a>04988 
<a name="l04989"></a>04989   val += key-&gt;<a class="code" href="../../dc/d85/structtype__cclass__key.html#aba17e22a7eece4b1fc97dac64ae8ae3f">not</a>;
<a name="l04990"></a>04990   <span class="keywordflow">return</span> val + (val &gt;&gt; 5);
<a name="l04991"></a>04991 }
<a name="l04992"></a>04992 
<a name="l04993"></a><a class="code" href="../../d6/dda/regparse_8c.html#a0955681b58b965e3fd12de0111dde7dc">04993</a> <span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="../../d6/d34/structst__hash__type.html">st_hash_type</a> <a class="code" href="../../d6/dda/regparse_8c.html#a0955681b58b965e3fd12de0111dde7dc">type_type_cclass_hash</a> = {
<a name="l04994"></a>04994     <a class="code" href="../../d6/dda/regparse_8c.html#af461c684cd2f34bce5b132ec13428d99">type_cclass_cmp</a>,
<a name="l04995"></a>04995     <a class="code" href="../../d6/dda/regparse_8c.html#aa9c9e9f620273a073687aa403eb5dd01">type_cclass_hash</a>,
<a name="l04996"></a>04996 };
<a name="l04997"></a>04997 
<a name="l04998"></a><a class="code" href="../../d6/dda/regparse_8c.html#a926f1a322293b4ef608b218e9bedd9a7">04998</a> <span class="keyword">static</span> <a class="code" href="../../d0/ddd/structst__table.html">st_table</a>* <a class="code" href="../../d6/dda/regparse_8c.html#a926f1a322293b4ef608b218e9bedd9a7">OnigTypeCClassTable</a>;
<a name="l04999"></a>04999 
<a name="l05000"></a>05000 
<a name="l05001"></a>05001 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l05002"></a><a class="code" href="../../d6/dda/regparse_8c.html#ad8bcd6fdf837cd44c7ff5d9414f8d6b9">05002</a> <a class="code" href="../../d6/dda/regparse_8c.html#ad8bcd6fdf837cd44c7ff5d9414f8d6b9">i_free_shared_class</a>(<a class="code" href="../../dc/d85/structtype__cclass__key.html">type_cclass_key</a>* <a class="code" href="../../dc/de5/random_8c.html#a742229490b6759a90ece7ba82ba129d5">key</a>, <a class="code" href="../../d0/d6e/struct___node.html">Node</a>* node, <span class="keywordtype">void</span>* arg ARG_UNUSED)
<a name="l05003"></a>05003 {
<a name="l05004"></a>05004   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d87/regint_8h.html#a4bc25fbd4749a2c130d1ae7f15ba140c">IS_NOT_NULL</a>(node)) {
<a name="l05005"></a>05005     <a class="code" href="../../d8/d79/struct_c_class_node.html">CClassNode</a>* cc = <a class="code" href="../../d1/dfc/regparse_8h.html#a816a6d8f921892c2efef73eb7727d589">NCCLASS</a>(node);
<a name="l05006"></a>05006     <span class="keywordflow">if</span> (<a class="code" href="../../d6/d87/regint_8h.html#a4bc25fbd4749a2c130d1ae7f15ba140c">IS_NOT_NULL</a>(cc-&gt;<a class="code" href="../../d8/d79/struct_c_class_node.html#a599db43b8eea536a4e4d08400fa445cb">mbuf</a>)) <a class="code" href="../../d8/db0/defines_8h.html#a2c3897f7c46ca54a2e0dd7b24a40c7cb">xfree</a>(cc-&gt;<a class="code" href="../../d8/d79/struct_c_class_node.html#a599db43b8eea536a4e4d08400fa445cb">mbuf</a>);
<a name="l05007"></a>05007     <a class="code" href="../../d8/db0/defines_8h.html#a2c3897f7c46ca54a2e0dd7b24a40c7cb">xfree</a>(node);
<a name="l05008"></a>05008   }
<a name="l05009"></a>05009 
<a name="l05010"></a>05010   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d87/regint_8h.html#a4bc25fbd4749a2c130d1ae7f15ba140c">IS_NOT_NULL</a>(key)) <a class="code" href="../../d8/db0/defines_8h.html#a2c3897f7c46ca54a2e0dd7b24a40c7cb">xfree</a>(key);
<a name="l05011"></a>05011   <span class="keywordflow">return</span> <a class="code" href="../../dd/d24/st_8h.html#a0c6a172fd99de7928916e65034ed8b1fa64ab176f8e8b9719bcd9b5297ccda9c7">ST_DELETE</a>;
<a name="l05012"></a>05012 }
<a name="l05013"></a>05013 
<a name="l05014"></a>05014 <span class="keyword">extern</span> <span class="keywordtype">int</span>
<a name="l05015"></a><a class="code" href="../../d6/dda/regparse_8c.html#a6ae87922922adc49dfb3a0de952c5a95">05015</a> <a class="code" href="../../d6/dda/regparse_8c.html#a6ae87922922adc49dfb3a0de952c5a95">onig_free_shared_cclass_table</a>(<span class="keywordtype">void</span>)
<a name="l05016"></a>05016 {
<a name="l05017"></a>05017   <a class="code" href="../../d6/d87/regint_8h.html#a89044129ef788a94169add8be849e66b">THREAD_ATOMIC_START</a>;
<a name="l05018"></a>05018   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d87/regint_8h.html#a4bc25fbd4749a2c130d1ae7f15ba140c">IS_NOT_NULL</a>(OnigTypeCClassTable)) {
<a name="l05019"></a>05019     <a class="code" href="../../d6/d87/regint_8h.html#a19807bc745107ca04c237f9d9d4563ed">onig_st_foreach</a>(OnigTypeCClassTable, <a class="code" href="../../d6/dda/regparse_8c.html#ad8bcd6fdf837cd44c7ff5d9414f8d6b9">i_free_shared_class</a>, 0);
<a name="l05020"></a>05020     <a class="code" href="../../d6/d87/regint_8h.html#a8f9bdf7a7a9520094f4a60bc9ba2d90d">onig_st_free_table</a>(OnigTypeCClassTable);
<a name="l05021"></a>05021     OnigTypeCClassTable = <a class="code" href="../../d3/d09/ripper_8y.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l05022"></a>05022   }
<a name="l05023"></a>05023   <a class="code" href="../../d6/d87/regint_8h.html#a88a1ea7a04c3da104c4ef1ff6444b3ae">THREAD_ATOMIC_END</a>;
<a name="l05024"></a>05024 
<a name="l05025"></a>05025   <span class="keywordflow">return</span> 0;
<a name="l05026"></a>05026 }
<a name="l05027"></a>05027 
<a name="l05028"></a>05028 <span class="preprocessor">#endif </span><span class="comment">/* USE_SHARED_CCLASS_TABLE */</span>
<a name="l05029"></a>05029 
<a name="l05030"></a>05030 
<a name="l05031"></a>05031 <span class="preprocessor">#ifndef CASE_FOLD_IS_APPLIED_INSIDE_NEGATIVE_CCLASS</span>
<a name="l05032"></a>05032 <span class="preprocessor"></span><span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l05033"></a>05033 clear_not_flag_cclass(<a class="code" href="../../d8/d79/struct_c_class_node.html">CClassNode</a>* cc, <a class="code" href="../../d1/d7b/struct_onig_encoding_type_s_t.html">OnigEncoding</a> enc)
<a name="l05034"></a>05034 {
<a name="l05035"></a>05035   <a class="code" href="../../d0/deb/struct___b_buf.html">BBuf</a> *tbuf;
<a name="l05036"></a>05036   <span class="keywordtype">int</span> r;
<a name="l05037"></a>05037 
<a name="l05038"></a>05038   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d87/regint_8h.html#aa719ec00173511740495f30fc0878c9e">IS_NCCLASS_NOT</a>(cc)) {
<a name="l05039"></a>05039     <a class="code" href="../../d6/dda/regparse_8c.html#a8d37acb2da0c1b9a62bd817b2cc36818">bitset_invert</a>(cc-&gt;<a class="code" href="../../d8/d79/struct_c_class_node.html#a082458e56c928f78db90f08e242a9f3d">bs</a>);
<a name="l05040"></a>05040 
<a name="l05041"></a>05041     <span class="keywordflow">if</span> (! <a class="code" href="../../d8/db3/oniguruma_8h.html#acbe29a5b40372a14b37b70efda999676">ONIGENC_IS_SINGLEBYTE</a>(enc)) {
<a name="l05042"></a>05042       r = <a class="code" href="../../d6/dda/regparse_8c.html#a07c32563959155ac0b27e95128eec38a">not_code_range_buf</a>(enc, cc-&gt;<a class="code" href="../../d8/d79/struct_c_class_node.html#a599db43b8eea536a4e4d08400fa445cb">mbuf</a>, &amp;tbuf);
<a name="l05043"></a>05043       <span class="keywordflow">if</span> (r != 0) <span class="keywordflow">return</span> r;
<a name="l05044"></a>05044 
<a name="l05045"></a>05045       <a class="code" href="../../d6/dda/regparse_8c.html#ac57154f90d1120d13c794cb9ba3cdba2">bbuf_free</a>(cc-&gt;<a class="code" href="../../d8/d79/struct_c_class_node.html#a599db43b8eea536a4e4d08400fa445cb">mbuf</a>);
<a name="l05046"></a>05046       cc-&gt;<a class="code" href="../../d8/d79/struct_c_class_node.html#a599db43b8eea536a4e4d08400fa445cb">mbuf</a> = tbuf;
<a name="l05047"></a>05047     }
<a name="l05048"></a>05048 
<a name="l05049"></a>05049     <a class="code" href="../../d6/d87/regint_8h.html#aa22b32b1a9c645e5d66e31e21cd9f1ed">NCCLASS_CLEAR_NOT</a>(cc);
<a name="l05050"></a>05050   }
<a name="l05051"></a>05051 
<a name="l05052"></a>05052   <span class="keywordflow">return</span> 0;
<a name="l05053"></a>05053 }
<a name="l05054"></a>05054 <span class="preprocessor">#endif </span><span class="comment">/* CASE_FOLD_IS_APPLIED_INSIDE_NEGATIVE_CCLASS */</span>
<a name="l05055"></a>05055 
<a name="l05056"></a><a class="code" href="../../d9/d20/struct_i_apply_case_fold_arg.html">05056</a> <span class="keyword">typedef</span> <span class="keyword">struct </span>{
<a name="l05057"></a><a class="code" href="../../d9/d20/struct_i_apply_case_fold_arg.html#a9373e696418859ceef2dc3d026d20b57">05057</a>   <a class="code" href="../../d6/dbe/struct_scan_env.html">ScanEnv</a>*    env;
<a name="l05058"></a><a class="code" href="../../d9/d20/struct_i_apply_case_fold_arg.html#aa531ebb2a3caff9ba4fcee92b4b48fba">05058</a>   <a class="code" href="../../d8/d79/struct_c_class_node.html">CClassNode</a>* cc;
<a name="l05059"></a><a class="code" href="../../d9/d20/struct_i_apply_case_fold_arg.html#ab6d5bedca599f2295e09f0ce1e2283fb">05059</a>   <a class="code" href="../../d0/d6e/struct___node.html">Node</a>*       alt_root;
<a name="l05060"></a><a class="code" href="../../d9/d20/struct_i_apply_case_fold_arg.html#a12f71f4be6c3b1d9169d5bedb6467fa9">05060</a>   <a class="code" href="../../d0/d6e/struct___node.html">Node</a>**      ptail;
<a name="l05061"></a>05061 } <a class="code" href="../../d9/d20/struct_i_apply_case_fold_arg.html">IApplyCaseFoldArg</a>;
<a name="l05062"></a>05062 
<a name="l05063"></a>05063 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l05064"></a><a class="code" href="../../d6/dda/regparse_8c.html#ae98372c3ef790f3800ab507b029916a1">05064</a> <a class="code" href="../../d6/dda/regparse_8c.html#ae98372c3ef790f3800ab507b029916a1">i_apply_case_fold</a>(<a class="code" href="../../d8/db3/oniguruma_8h.html#a7c8a84bc12127007886efbfcf53b6fb5">OnigCodePoint</a> from, <a class="code" href="../../d8/db3/oniguruma_8h.html#a7c8a84bc12127007886efbfcf53b6fb5">OnigCodePoint</a> to[],
<a name="l05065"></a>05065                   <span class="keywordtype">int</span> to_len, <span class="keywordtype">void</span>* arg)
<a name="l05066"></a>05066 {
<a name="l05067"></a>05067   <a class="code" href="../../d9/d20/struct_i_apply_case_fold_arg.html">IApplyCaseFoldArg</a>* iarg;
<a name="l05068"></a>05068   <a class="code" href="../../d6/dbe/struct_scan_env.html">ScanEnv</a>* env;
<a name="l05069"></a>05069   <a class="code" href="../../d8/d79/struct_c_class_node.html">CClassNode</a>* cc;
<a name="l05070"></a>05070   <a class="code" href="../../d6/d87/regint_8h.html#adb2b463784f4cfa2f5504eb0ed9ee70a">BitSetRef</a> bs;
<a name="l05071"></a>05071 
<a name="l05072"></a>05072   iarg = (<a class="code" href="../../d9/d20/struct_i_apply_case_fold_arg.html">IApplyCaseFoldArg</a>* )arg;
<a name="l05073"></a>05073   env = iarg-&gt;<a class="code" href="../../d9/d20/struct_i_apply_case_fold_arg.html#a9373e696418859ceef2dc3d026d20b57">env</a>;
<a name="l05074"></a>05074   cc  = iarg-&gt;<a class="code" href="../../d9/d20/struct_i_apply_case_fold_arg.html#aa531ebb2a3caff9ba4fcee92b4b48fba">cc</a>;
<a name="l05075"></a>05075   bs = cc-&gt;<a class="code" href="../../d8/d79/struct_c_class_node.html#a082458e56c928f78db90f08e242a9f3d">bs</a>;
<a name="l05076"></a>05076 
<a name="l05077"></a>05077   <span class="keywordflow">if</span> (to_len == 1) {
<a name="l05078"></a>05078     <span class="keywordtype">int</span> is_in = <a class="code" href="../../d0/d86/regcomp_8c.html#a7cf5f4a5bd94180443ca81ffa1e449b5">onig_is_code_in_cc</a>(env-&gt;<a class="code" href="../../d6/dbe/struct_scan_env.html#a97f766db4ac9dabc9d173bf99fbcc11b">enc</a>, from, cc);
<a name="l05079"></a>05079 <span class="preprocessor">#ifdef CASE_FOLD_IS_APPLIED_INSIDE_NEGATIVE_CCLASS</span>
<a name="l05080"></a>05080 <span class="preprocessor"></span>    <span class="keywordflow">if</span> ((is_in != 0 &amp;&amp; !<a class="code" href="../../d6/d87/regint_8h.html#aa719ec00173511740495f30fc0878c9e">IS_NCCLASS_NOT</a>(cc)) ||
<a name="l05081"></a>05081         (is_in == 0 &amp;&amp;  <a class="code" href="../../d6/d87/regint_8h.html#aa719ec00173511740495f30fc0878c9e">IS_NCCLASS_NOT</a>(cc))) {
<a name="l05082"></a>05082       <span class="keywordflow">if</span> (<a class="code" href="../../d8/db3/oniguruma_8h.html#a9d0d6012e6b7de2cf851d274bb9b9c9c">ONIGENC_MBC_MINLEN</a>(env-&gt;<a class="code" href="../../d6/dbe/struct_scan_env.html#a97f766db4ac9dabc9d173bf99fbcc11b">enc</a>) &gt; 1 || *to &gt;= <a class="code" href="../../d6/d87/regint_8h.html#a8bdc62bcdfffb01985810f7aa61d5999">SINGLE_BYTE_SIZE</a>) {
<a name="l05083"></a>05083         <a class="code" href="../../d6/dda/regparse_8c.html#acf95eb846040766dbd346b81ee63dc06">add_code_range0</a>(&amp;(cc-&gt;<a class="code" href="../../d8/d79/struct_c_class_node.html#a599db43b8eea536a4e4d08400fa445cb">mbuf</a>), env, *to, *to, 0);
<a name="l05084"></a>05084       }
<a name="l05085"></a>05085       <span class="keywordflow">else</span> {
<a name="l05086"></a>05086         <a class="code" href="../../d6/d87/regint_8h.html#ab26fef19fa4f7e653f86ba09d2278e32">BITSET_SET_BIT</a>(bs, *to);
<a name="l05087"></a>05087       }
<a name="l05088"></a>05088     }
<a name="l05089"></a>05089 <span class="preprocessor">#else</span>
<a name="l05090"></a>05090 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (is_in != 0) {
<a name="l05091"></a>05091       <span class="keywordflow">if</span> (<a class="code" href="../../d8/db3/oniguruma_8h.html#a9d0d6012e6b7de2cf851d274bb9b9c9c">ONIGENC_MBC_MINLEN</a>(env-&gt;<a class="code" href="../../d6/dbe/struct_scan_env.html#a97f766db4ac9dabc9d173bf99fbcc11b">enc</a>) &gt; 1 || *to &gt;= <a class="code" href="../../d6/d87/regint_8h.html#a8bdc62bcdfffb01985810f7aa61d5999">SINGLE_BYTE_SIZE</a>) {
<a name="l05092"></a>05092         <span class="keywordflow">if</span> (<a class="code" href="../../d6/d87/regint_8h.html#aa719ec00173511740495f30fc0878c9e">IS_NCCLASS_NOT</a>(cc)) clear_not_flag_cclass(cc, env-&gt;<a class="code" href="../../d6/dbe/struct_scan_env.html#a97f766db4ac9dabc9d173bf99fbcc11b">enc</a>);
<a name="l05093"></a>05093         <a class="code" href="../../d6/dda/regparse_8c.html#acf95eb846040766dbd346b81ee63dc06">add_code_range0</a>(&amp;(cc-&gt;<a class="code" href="../../d8/d79/struct_c_class_node.html#a599db43b8eea536a4e4d08400fa445cb">mbuf</a>), env, *to, *to, 0);
<a name="l05094"></a>05094       }
<a name="l05095"></a>05095       <span class="keywordflow">else</span> {
<a name="l05096"></a>05096         <span class="keywordflow">if</span> (<a class="code" href="../../d6/d87/regint_8h.html#aa719ec00173511740495f30fc0878c9e">IS_NCCLASS_NOT</a>(cc)) {
<a name="l05097"></a>05097           <a class="code" href="../../d6/d87/regint_8h.html#a2c997bf35d973c0d483f08d1ac1940e6">BITSET_CLEAR_BIT</a>(bs, *to);
<a name="l05098"></a>05098         }
<a name="l05099"></a>05099         <span class="keywordflow">else</span>
<a name="l05100"></a>05100           <a class="code" href="../../d6/d87/regint_8h.html#ab26fef19fa4f7e653f86ba09d2278e32">BITSET_SET_BIT</a>(bs, *to);
<a name="l05101"></a>05101       }
<a name="l05102"></a>05102     }
<a name="l05103"></a>05103 <span class="preprocessor">#endif </span><span class="comment">/* CASE_FOLD_IS_APPLIED_INSIDE_NEGATIVE_CCLASS */</span>
<a name="l05104"></a>05104   }
<a name="l05105"></a>05105   <span class="keywordflow">else</span> {
<a name="l05106"></a>05106     <span class="keywordtype">int</span> r, i, len;
<a name="l05107"></a>05107     <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a> buf[<a class="code" href="../../d8/db3/oniguruma_8h.html#a5eba220c99bf5d04cfe9dc51e744b747">ONIGENC_CODE_TO_MBC_MAXLEN</a>];
<a name="l05108"></a>05108     <a class="code" href="../../d0/d6e/struct___node.html">Node</a> *snode = <a class="code" href="../../d3/d7f/gram_8c.html#ac00d2982d51115efbe8a13840d47b7a7">NULL_NODE</a>;
<a name="l05109"></a>05109 
<a name="l05110"></a>05110     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d86/regcomp_8c.html#a7cf5f4a5bd94180443ca81ffa1e449b5">onig_is_code_in_cc</a>(env-&gt;<a class="code" href="../../d6/dbe/struct_scan_env.html#a97f766db4ac9dabc9d173bf99fbcc11b">enc</a>, from, cc)
<a name="l05111"></a>05111 #ifdef <a class="code" href="../../d6/dda/regparse_8c.html#ab2c1b06d583864757000b9ef2c0c9324">CASE_FOLD_IS_APPLIED_INSIDE_NEGATIVE_CCLASS</a>
<a name="l05112"></a>05112         &amp;&amp; !<a class="code" href="../../d6/d87/regint_8h.html#aa719ec00173511740495f30fc0878c9e">IS_NCCLASS_NOT</a>(cc)
<a name="l05113"></a>05113 #endif
<a name="l05114"></a>05114         ) {
<a name="l05115"></a>05115       <span class="keywordflow">for</span> (i = 0; i &lt; to_len; i++) {
<a name="l05116"></a>05116         len = <a class="code" href="../../d8/db3/oniguruma_8h.html#a203e2c46a8be4e9dccc830d1b408b83b">ONIGENC_CODE_TO_MBC</a>(env-&gt;<a class="code" href="../../d6/dbe/struct_scan_env.html#a97f766db4ac9dabc9d173bf99fbcc11b">enc</a>, to[i], buf);
<a name="l05117"></a>05117         <span class="keywordflow">if</span> (i == 0) {
<a name="l05118"></a>05118           snode = <a class="code" href="../../d6/dda/regparse_8c.html#aa43586564529e972a0cc1e7fec489aff">onig_node_new_str</a>(buf, buf + len);
<a name="l05119"></a>05119           <a class="code" href="../../d6/d87/regint_8h.html#a17ebb2a12300dcf6d79916e357fae45a">CHECK_NULL_RETURN_MEMERR</a>(snode);
<a name="l05120"></a>05120 
<a name="l05121"></a>05121           <span class="comment">/* char-class expanded multi-char only</span>
<a name="l05122"></a>05122 <span class="comment">             compare with string folded at match time. */</span>
<a name="l05123"></a>05123           <a class="code" href="../../d1/dfc/regparse_8h.html#a9ae80d34bf54720801a9f96840734944">NSTRING_SET_AMBIG</a>(snode);
<a name="l05124"></a>05124         }
<a name="l05125"></a>05125         <span class="keywordflow">else</span> {
<a name="l05126"></a>05126           r = <a class="code" href="../../d6/dda/regparse_8c.html#a4c9f32699c8567f97bf22053473ec09e">onig_node_str_cat</a>(snode, buf, buf + len);
<a name="l05127"></a>05127           <span class="keywordflow">if</span> (r &lt; 0) {
<a name="l05128"></a>05128             <a class="code" href="../../d6/dda/regparse_8c.html#aa98ee34de192fd4997906389f70f4808">onig_node_free</a>(snode);
<a name="l05129"></a>05129             <span class="keywordflow">return</span> r;
<a name="l05130"></a>05130           }
<a name="l05131"></a>05131         }
<a name="l05132"></a>05132       }
<a name="l05133"></a>05133 
<a name="l05134"></a>05134       *(iarg-&gt;<a class="code" href="../../d9/d20/struct_i_apply_case_fold_arg.html#a12f71f4be6c3b1d9169d5bedb6467fa9">ptail</a>) = <a class="code" href="../../d6/dda/regparse_8c.html#a9ee0d6fbf2d9ed077e5c5831b93444a6">onig_node_new_alt</a>(snode, <a class="code" href="../../d3/d7f/gram_8c.html#ac00d2982d51115efbe8a13840d47b7a7">NULL_NODE</a>);
<a name="l05135"></a>05135       <a class="code" href="../../d6/d87/regint_8h.html#a17ebb2a12300dcf6d79916e357fae45a">CHECK_NULL_RETURN_MEMERR</a>(*(iarg-&gt;<a class="code" href="../../d9/d20/struct_i_apply_case_fold_arg.html#a12f71f4be6c3b1d9169d5bedb6467fa9">ptail</a>));
<a name="l05136"></a>05136       iarg-&gt;<a class="code" href="../../d9/d20/struct_i_apply_case_fold_arg.html#a12f71f4be6c3b1d9169d5bedb6467fa9">ptail</a> = &amp;(<a class="code" href="../../d1/dfc/regparse_8h.html#ac3a01065a5b7f17aad984671c730739e">NCDR</a>((*(iarg-&gt;<a class="code" href="../../d9/d20/struct_i_apply_case_fold_arg.html#a12f71f4be6c3b1d9169d5bedb6467fa9">ptail</a>))));
<a name="l05137"></a>05137     }
<a name="l05138"></a>05138   }
<a name="l05139"></a>05139 
<a name="l05140"></a>05140   <span class="keywordflow">return</span> 0;
<a name="l05141"></a>05141 }
<a name="l05142"></a>05142 
<a name="l05143"></a>05143 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l05144"></a><a class="code" href="../../d6/dda/regparse_8c.html#ad281aaac939a085676b002a3221d203d">05144</a> <a class="code" href="../../d6/dda/regparse_8c.html#ad281aaac939a085676b002a3221d203d">parse_exp</a>(<a class="code" href="../../d0/d6e/struct___node.html">Node</a>** np, <a class="code" href="../../d0/d80/struct_onig_token.html">OnigToken</a>* <a class="code" href="../../d5/d11/ripper_8c.html#a2b3a335d617ec14d6296ca82d3055858">tok</a>, <span class="keywordtype">int</span> <a class="code" href="../../d3/d09/ripper_8y.html#a0c940d9e4ce4cfee55d7ccf714a1303d">term</a>,
<a name="l05145"></a>05145           <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>** src, <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>* end, <a class="code" href="../../d6/dbe/struct_scan_env.html">ScanEnv</a>* env)
<a name="l05146"></a>05146 {
<a name="l05147"></a>05147   <span class="keywordtype">int</span> r, len, group = 0;
<a name="l05148"></a>05148   <a class="code" href="../../d0/d6e/struct___node.html">Node</a>* qn;
<a name="l05149"></a>05149   <a class="code" href="../../d0/d6e/struct___node.html">Node</a>** targetp;
<a name="l05150"></a>05150 
<a name="l05151"></a>05151   *np = <a class="code" href="../../d3/d09/ripper_8y.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l05152"></a>05152   <span class="keywordflow">if</span> (tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#a46f3343f204ac67de13f0a774284e476">type</a> == (<span class="keyword">enum</span> <a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250d">TokenSyms</a> )term)
<a name="l05153"></a>05153     <span class="keywordflow">goto</span> end_of_token;
<a name="l05154"></a>05154 
<a name="l05155"></a>05155   <span class="keywordflow">switch</span> (tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#a46f3343f204ac67de13f0a774284e476">type</a>) {
<a name="l05156"></a>05156   <span class="keywordflow">case</span> <a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250da902b0cdea9f57e86f33e1c42c38bae8a">TK_ALT</a>:
<a name="l05157"></a>05157   <span class="keywordflow">case</span> <a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250da4b2acbe6a651813a07506f06d624ac3b">TK_EOT</a>:
<a name="l05158"></a>05158   end_of_token:
<a name="l05159"></a>05159     *np = <a class="code" href="../../d6/dda/regparse_8c.html#a989b3c8a59c2bd7c3b1d33849ebc59e3">node_new_empty</a>();
<a name="l05160"></a>05160     <span class="keywordflow">return</span> tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#a46f3343f204ac67de13f0a774284e476">type</a>;
<a name="l05161"></a>05161 
<a name="l05162"></a>05162   <span class="keywordflow">case</span> <a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250da6d28cfb6350f8a3218170fd0f913aec3">TK_SUBEXP_OPEN</a>:
<a name="l05163"></a>05163     r = <a class="code" href="../../d6/dda/regparse_8c.html#ad9aeccad3a3c7ec807272797a39ce496">parse_enclose</a>(np, tok, <a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250da2abb18f0f4ef734b4ce575c044b4e1e7">TK_SUBEXP_CLOSE</a>, src, end, env);
<a name="l05164"></a>05164     <span class="keywordflow">if</span> (r &lt; 0) <span class="keywordflow">return</span> r;
<a name="l05165"></a>05165     <span class="keywordflow">if</span> (r == 1) group = 1;
<a name="l05166"></a>05166     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (r == 2) { <span class="comment">/* option only */</span>
<a name="l05167"></a>05167       <a class="code" href="../../d0/d6e/struct___node.html">Node</a>* target;
<a name="l05168"></a>05168       <a class="code" href="../../d8/db3/oniguruma_8h.html#ad870c1a94502ad33c083978b17911e72">OnigOptionType</a> <a class="code" href="../../d7/dc0/parse_8y.html#a71f8b6ffdc0cc58ffd989c3162fb2bcf">prev</a> = env-&gt;<a class="code" href="../../d6/dbe/struct_scan_env.html#a1a7599f3079dfc7ab6d0b317f0f37d93">option</a>;
<a name="l05169"></a>05169 
<a name="l05170"></a>05170       env-&gt;<a class="code" href="../../d6/dbe/struct_scan_env.html#a1a7599f3079dfc7ab6d0b317f0f37d93">option</a> = <a class="code" href="../../d1/dfc/regparse_8h.html#a2fea29a34640f28158788eef43a9bfd2">NENCLOSE</a>(*np)-&gt;option;
<a name="l05171"></a>05171       r = <a class="code" href="../../d6/dda/regparse_8c.html#af1214620e9e6133cd463d363f2cb332f">fetch_token</a>(tok, src, end, env);
<a name="l05172"></a>05172       <span class="keywordflow">if</span> (r &lt; 0) <span class="keywordflow">return</span> r;
<a name="l05173"></a>05173       r = <a class="code" href="../../d6/dda/regparse_8c.html#a3822726195b34935bce3ca92fe4d8085">parse_subexp</a>(&amp;target, tok, term, src, end, env);
<a name="l05174"></a>05174       env-&gt;<a class="code" href="../../d6/dbe/struct_scan_env.html#a1a7599f3079dfc7ab6d0b317f0f37d93">option</a> = prev;
<a name="l05175"></a>05175       <span class="keywordflow">if</span> (r &lt; 0) {
<a name="l05176"></a>05176         <a class="code" href="../../d6/dda/regparse_8c.html#aa98ee34de192fd4997906389f70f4808">onig_node_free</a>(target);
<a name="l05177"></a>05177         <span class="keywordflow">return</span> r;
<a name="l05178"></a>05178       }
<a name="l05179"></a>05179       <a class="code" href="../../d1/dfc/regparse_8h.html#a2fea29a34640f28158788eef43a9bfd2">NENCLOSE</a>(*np)-&gt;target = target;
<a name="l05180"></a>05180       <span class="keywordflow">return</span> tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#a46f3343f204ac67de13f0a774284e476">type</a>;
<a name="l05181"></a>05181     }
<a name="l05182"></a>05182     <span class="keywordflow">break</span>;
<a name="l05183"></a>05183 
<a name="l05184"></a>05184   <span class="keywordflow">case</span> <a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250da2abb18f0f4ef734b4ce575c044b4e1e7">TK_SUBEXP_CLOSE</a>:
<a name="l05185"></a>05185     <span class="keywordflow">if</span> (! <a class="code" href="../../d1/dfc/regparse_8h.html#a18bfc9ee154d6dd516347bd71b4810f6">IS_SYNTAX_BV</a>(env-&gt;<a class="code" href="../../d6/dbe/struct_scan_env.html#ae5c4502ad7b7a4a418eda464919d2bda">syntax</a>, <a class="code" href="../../d8/db3/oniguruma_8h.html#ae5ff824a3b09a050e91ccd891fddee79">ONIG_SYN_ALLOW_UNMATCHED_CLOSE_SUBEXP</a>))
<a name="l05186"></a>05186       <span class="keywordflow">return</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#a8b35f7e24026f3f9e078e7f4973eb7db">ONIGERR_UNMATCHED_CLOSE_PARENTHESIS</a>;
<a name="l05187"></a>05187 
<a name="l05188"></a>05188     <span class="keywordflow">if</span> (tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#a71ac92059fef31b2d7932d04523f8c17">escaped</a>) <span class="keywordflow">goto</span> tk_raw_byte;
<a name="l05189"></a>05189     <span class="keywordflow">else</span> <span class="keywordflow">goto</span> tk_byte;
<a name="l05190"></a>05190     <span class="keywordflow">break</span>;
<a name="l05191"></a>05191 
<a name="l05192"></a>05192   <span class="keywordflow">case</span> <a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250da2f748d118b4a20e2b1dc12538ccd9876">TK_STRING</a>:
<a name="l05193"></a>05193   tk_byte:
<a name="l05194"></a>05194     {
<a name="l05195"></a>05195       *np = <a class="code" href="../../d6/dda/regparse_8c.html#abb2eaf4904c08177eb3e2ed65ad4adcf">node_new_str</a>(tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#accba0041ec257e1619caefea1ea12d10">backp</a>, *src);
<a name="l05196"></a>05196       <a class="code" href="../../d6/d87/regint_8h.html#a17ebb2a12300dcf6d79916e357fae45a">CHECK_NULL_RETURN_MEMERR</a>(*np);
<a name="l05197"></a>05197 
<a name="l05198"></a>05198       <span class="keywordflow">while</span> (1) {
<a name="l05199"></a>05199         r = <a class="code" href="../../d6/dda/regparse_8c.html#af1214620e9e6133cd463d363f2cb332f">fetch_token</a>(tok, src, end, env);
<a name="l05200"></a>05200         <span class="keywordflow">if</span> (r &lt; 0) <span class="keywordflow">return</span> r;
<a name="l05201"></a>05201         <span class="keywordflow">if</span> (r != <a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250da2f748d118b4a20e2b1dc12538ccd9876">TK_STRING</a>) <span class="keywordflow">break</span>;
<a name="l05202"></a>05202 
<a name="l05203"></a>05203         r = <a class="code" href="../../d6/dda/regparse_8c.html#a4c9f32699c8567f97bf22053473ec09e">onig_node_str_cat</a>(*np, tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#accba0041ec257e1619caefea1ea12d10">backp</a>, *src);
<a name="l05204"></a>05204         <span class="keywordflow">if</span> (r &lt; 0) <span class="keywordflow">return</span> r;
<a name="l05205"></a>05205       }
<a name="l05206"></a>05206 
<a name="l05207"></a>05207     string_end:
<a name="l05208"></a>05208       targetp = np;
<a name="l05209"></a>05209       <span class="keywordflow">goto</span> repeat;
<a name="l05210"></a>05210     }
<a name="l05211"></a>05211     <span class="keywordflow">break</span>;
<a name="l05212"></a>05212 
<a name="l05213"></a>05213   <span class="keywordflow">case</span> <a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250dab0e056f20d46d5a9696dd7fdea89de88">TK_RAW_BYTE</a>:
<a name="l05214"></a>05214   tk_raw_byte:
<a name="l05215"></a>05215     {
<a name="l05216"></a>05216       *np = <a class="code" href="../../d6/dda/regparse_8c.html#acae68a89de83097271f990cce054a0ec">node_new_str_raw_char</a>((<a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a> )tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#aaea3a0bd5a46ef32e4a9552046a070b3">u</a>.<a class="code" href="../../d0/d80/struct_onig_token.html#ac1f4ee5fa57d7ebbfa95642148efe0f5">c</a>);
<a name="l05217"></a>05217       <a class="code" href="../../d6/d87/regint_8h.html#a17ebb2a12300dcf6d79916e357fae45a">CHECK_NULL_RETURN_MEMERR</a>(*np);
<a name="l05218"></a>05218       len = 1;
<a name="l05219"></a>05219       <span class="keywordflow">while</span> (1) {
<a name="l05220"></a>05220         <span class="keywordflow">if</span> (len &gt;= <a class="code" href="../../d8/db3/oniguruma_8h.html#a9d0d6012e6b7de2cf851d274bb9b9c9c">ONIGENC_MBC_MINLEN</a>(env-&gt;<a class="code" href="../../d6/dbe/struct_scan_env.html#a97f766db4ac9dabc9d173bf99fbcc11b">enc</a>)) {
<a name="l05221"></a>05221           <span class="keywordflow">if</span> (len == <a class="code" href="../../d3/d09/ripper_8y.html#ae9f8530a4c9ec89ae8d62ce5b4410aad">enclen</a>(env-&gt;<a class="code" href="../../d6/dbe/struct_scan_env.html#a97f766db4ac9dabc9d173bf99fbcc11b">enc</a>, <a class="code" href="../../d1/dfc/regparse_8h.html#a24a4b2af18dda01ae000ec64129eb50e">NSTR</a>(*np)-&gt;s, <a class="code" href="../../d1/dfc/regparse_8h.html#a24a4b2af18dda01ae000ec64129eb50e">NSTR</a>(*np)-&gt;end)) {
<a name="l05222"></a>05222             r = <a class="code" href="../../d6/dda/regparse_8c.html#af1214620e9e6133cd463d363f2cb332f">fetch_token</a>(tok, src, end, env);
<a name="l05223"></a>05223             <a class="code" href="../../d1/dfc/regparse_8h.html#a5cd89d5dcf76ce3aef0f51b7d0c960e5">NSTRING_CLEAR_RAW</a>(*np);
<a name="l05224"></a>05224             <span class="keywordflow">goto</span> string_end;
<a name="l05225"></a>05225           }
<a name="l05226"></a>05226         }
<a name="l05227"></a>05227 
<a name="l05228"></a>05228         r = <a class="code" href="../../d6/dda/regparse_8c.html#af1214620e9e6133cd463d363f2cb332f">fetch_token</a>(tok, src, end, env);
<a name="l05229"></a>05229         <span class="keywordflow">if</span> (r &lt; 0) <span class="keywordflow">return</span> r;
<a name="l05230"></a>05230         <span class="keywordflow">if</span> (r != <a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250dab0e056f20d46d5a9696dd7fdea89de88">TK_RAW_BYTE</a>) {
<a name="l05231"></a>05231           <span class="comment">/* Don&apos;t use this, it is wrong for little endian encodings. */</span>
<a name="l05232"></a>05232 <span class="preprocessor">#ifdef USE_PAD_TO_SHORT_BYTE_CHAR</span>
<a name="l05233"></a>05233 <span class="preprocessor"></span>          <span class="keywordtype">int</span> rem;
<a name="l05234"></a>05234           <span class="keywordflow">if</span> (len &lt; <a class="code" href="../../d8/db3/oniguruma_8h.html#a9d0d6012e6b7de2cf851d274bb9b9c9c">ONIGENC_MBC_MINLEN</a>(env-&gt;<a class="code" href="../../d6/dbe/struct_scan_env.html#a97f766db4ac9dabc9d173bf99fbcc11b">enc</a>)) {
<a name="l05235"></a>05235             rem = <a class="code" href="../../d8/db3/oniguruma_8h.html#a9d0d6012e6b7de2cf851d274bb9b9c9c">ONIGENC_MBC_MINLEN</a>(env-&gt;<a class="code" href="../../d6/dbe/struct_scan_env.html#a97f766db4ac9dabc9d173bf99fbcc11b">enc</a>) - len;
<a name="l05236"></a>05236             (void )node_str_head_pad(<a class="code" href="../../d1/dfc/regparse_8h.html#a24a4b2af18dda01ae000ec64129eb50e">NSTR</a>(*np), rem, (<a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a> )0);
<a name="l05237"></a>05237             <span class="keywordflow">if</span> (len + rem == <a class="code" href="../../d3/d09/ripper_8y.html#ae9f8530a4c9ec89ae8d62ce5b4410aad">enclen</a>(env-&gt;<a class="code" href="../../d6/dbe/struct_scan_env.html#a97f766db4ac9dabc9d173bf99fbcc11b">enc</a>, <a class="code" href="../../d1/dfc/regparse_8h.html#a24a4b2af18dda01ae000ec64129eb50e">NSTR</a>(*np)-&gt;s)) {
<a name="l05238"></a>05238               <a class="code" href="../../d1/dfc/regparse_8h.html#a5cd89d5dcf76ce3aef0f51b7d0c960e5">NSTRING_CLEAR_RAW</a>(*np);
<a name="l05239"></a>05239               <span class="keywordflow">goto</span> string_end;
<a name="l05240"></a>05240             }
<a name="l05241"></a>05241           }
<a name="l05242"></a>05242 <span class="preprocessor">#endif</span>
<a name="l05243"></a>05243 <span class="preprocessor"></span>          <span class="keywordflow">return</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#af6e4c0472b6fd59fa61f3f53467cc6b0">ONIGERR_TOO_SHORT_MULTI_BYTE_STRING</a>;
<a name="l05244"></a>05244         }
<a name="l05245"></a>05245 
<a name="l05246"></a>05246         r = <a class="code" href="../../d6/dda/regparse_8c.html#a749f25c911a2a10579db549fb0100dc0">node_str_cat_char</a>(*np, (<a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a> )tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#aaea3a0bd5a46ef32e4a9552046a070b3">u</a>.<a class="code" href="../../d0/d80/struct_onig_token.html#ac1f4ee5fa57d7ebbfa95642148efe0f5">c</a>);
<a name="l05247"></a>05247         <span class="keywordflow">if</span> (r &lt; 0) <span class="keywordflow">return</span> r;
<a name="l05248"></a>05248 
<a name="l05249"></a>05249         len++;
<a name="l05250"></a>05250       }
<a name="l05251"></a>05251     }
<a name="l05252"></a>05252     <span class="keywordflow">break</span>;
<a name="l05253"></a>05253 
<a name="l05254"></a>05254   <span class="keywordflow">case</span> <a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250da7a451b3ab1e788efaa2da058c6c8b49c">TK_CODE_POINT</a>:
<a name="l05255"></a>05255     {
<a name="l05256"></a>05256       <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a> buf[<a class="code" href="../../d8/db3/oniguruma_8h.html#a5eba220c99bf5d04cfe9dc51e744b747">ONIGENC_CODE_TO_MBC_MAXLEN</a>];
<a name="l05257"></a>05257       <span class="keywordtype">int</span> num = <a class="code" href="../../d8/db3/oniguruma_8h.html#a203e2c46a8be4e9dccc830d1b408b83b">ONIGENC_CODE_TO_MBC</a>(env-&gt;<a class="code" href="../../d6/dbe/struct_scan_env.html#a97f766db4ac9dabc9d173bf99fbcc11b">enc</a>, tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#aaea3a0bd5a46ef32e4a9552046a070b3">u</a>.<a class="code" href="../../d0/d80/struct_onig_token.html#a40121b0193b6bbfbf9fdb88d82f1ea7a">code</a>, buf);
<a name="l05258"></a>05258       <span class="keywordflow">if</span> (num &lt; 0) <span class="keywordflow">return</span> num;
<a name="l05259"></a>05259 <span class="preprocessor">#ifdef NUMBERED_CHAR_IS_NOT_CASE_AMBIG</span>
<a name="l05260"></a>05260 <span class="preprocessor"></span>      *np = <a class="code" href="../../d6/dda/regparse_8c.html#a562380d9d821f065083635705ea1d51c">node_new_str_raw</a>(buf, buf + num);
<a name="l05261"></a>05261 <span class="preprocessor">#else</span>
<a name="l05262"></a>05262 <span class="preprocessor"></span>      *np = <a class="code" href="../../d6/dda/regparse_8c.html#abb2eaf4904c08177eb3e2ed65ad4adcf">node_new_str</a>(buf, buf + num);
<a name="l05263"></a>05263 <span class="preprocessor">#endif</span>
<a name="l05264"></a>05264 <span class="preprocessor"></span>      <a class="code" href="../../d6/d87/regint_8h.html#a17ebb2a12300dcf6d79916e357fae45a">CHECK_NULL_RETURN_MEMERR</a>(*np);
<a name="l05265"></a>05265     }
<a name="l05266"></a>05266     <span class="keywordflow">break</span>;
<a name="l05267"></a>05267 
<a name="l05268"></a>05268   <span class="keywordflow">case</span> <a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250da4bf244fe4348e0d0491bafa6adfa13d1">TK_QUOTE_OPEN</a>:
<a name="l05269"></a>05269     {
<a name="l05270"></a>05270       <a class="code" href="../../d8/db3/oniguruma_8h.html#a7c8a84bc12127007886efbfcf53b6fb5">OnigCodePoint</a> end_op[2];
<a name="l05271"></a>05271       <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a> *qstart, *qend, *nextp;
<a name="l05272"></a>05272 
<a name="l05273"></a>05273       end_op[0] = (<a class="code" href="../../d8/db3/oniguruma_8h.html#a7c8a84bc12127007886efbfcf53b6fb5">OnigCodePoint</a> )<a class="code" href="../../d6/d87/regint_8h.html#ae4a605f4b8bee0d69ab6d6418ddbec1b">MC_ESC</a>(env-&gt;<a class="code" href="../../d6/dbe/struct_scan_env.html#ae5c4502ad7b7a4a418eda464919d2bda">syntax</a>);
<a name="l05274"></a>05274       end_op[1] = (<a class="code" href="../../d8/db3/oniguruma_8h.html#a7c8a84bc12127007886efbfcf53b6fb5">OnigCodePoint</a> )<span class="charliteral">&apos;E&apos;</span>;
<a name="l05275"></a>05275       qstart = *src;
<a name="l05276"></a>05276       qend = <a class="code" href="../../d6/dda/regparse_8c.html#a1a357dfbe638de157057aaab280f0101">find_str_position</a>(end_op, 2, qstart, end, &amp;nextp, env-&gt;<a class="code" href="../../d6/dbe/struct_scan_env.html#a97f766db4ac9dabc9d173bf99fbcc11b">enc</a>);
<a name="l05277"></a>05277       <span class="keywordflow">if</span> (<a class="code" href="../../d6/d87/regint_8h.html#a91a9c9242dc3810582965d1882d1894d">IS_NULL</a>(qend)) {
<a name="l05278"></a>05278         nextp = qend = end;
<a name="l05279"></a>05279       }
<a name="l05280"></a>05280       *np = <a class="code" href="../../d6/dda/regparse_8c.html#abb2eaf4904c08177eb3e2ed65ad4adcf">node_new_str</a>(qstart, qend);
<a name="l05281"></a>05281       <a class="code" href="../../d6/d87/regint_8h.html#a17ebb2a12300dcf6d79916e357fae45a">CHECK_NULL_RETURN_MEMERR</a>(*np);
<a name="l05282"></a>05282       *src = nextp;
<a name="l05283"></a>05283     }
<a name="l05284"></a>05284     <span class="keywordflow">break</span>;
<a name="l05285"></a>05285 
<a name="l05286"></a>05286   <span class="keywordflow">case</span> <a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250da664a7e468d295958edd0864e4f3cf461">TK_CHAR_TYPE</a>:
<a name="l05287"></a>05287     {
<a name="l05288"></a>05288       <span class="keywordflow">switch</span> (tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#aaea3a0bd5a46ef32e4a9552046a070b3">u</a>.<a class="code" href="../../d0/d80/struct_onig_token.html#a84f464445695ec0d70cdc5f02db11833">prop</a>.ctype) {
<a name="l05289"></a>05289       <span class="keywordflow">case</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#a4878161b7a1adcf807bcff0a8722e778">ONIGENC_CTYPE_D</a>:
<a name="l05290"></a>05290       <span class="keywordflow">case</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#a8613b809ebb0533177db19ceb9eff366">ONIGENC_CTYPE_S</a>:
<a name="l05291"></a>05291       <span class="keywordflow">case</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#aaf70c7a1261acd2f76a4db97af5b3226">ONIGENC_CTYPE_W</a>:
<a name="l05292"></a>05292         {
<a name="l05293"></a>05293             <a class="code" href="../../d8/d79/struct_c_class_node.html">CClassNode</a>* cc;
<a name="l05294"></a>05294             *np = <a class="code" href="../../d6/dda/regparse_8c.html#afd60d28ead746c5b464b5a114d8960f1">node_new_cclass</a>();
<a name="l05295"></a>05295             <a class="code" href="../../d6/d87/regint_8h.html#a17ebb2a12300dcf6d79916e357fae45a">CHECK_NULL_RETURN_MEMERR</a>(*np);
<a name="l05296"></a>05296             cc = <a class="code" href="../../d1/dfc/regparse_8h.html#a816a6d8f921892c2efef73eb7727d589">NCCLASS</a>(*np);
<a name="l05297"></a>05297             <a class="code" href="../../d6/dda/regparse_8c.html#a30cf0640cd2a2e99e72171d90a4213f6">add_ctype_to_cc</a>(cc, tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#aaea3a0bd5a46ef32e4a9552046a070b3">u</a>.<a class="code" href="../../d0/d80/struct_onig_token.html#a84f464445695ec0d70cdc5f02db11833">prop</a>.ctype, 0, env);
<a name="l05298"></a>05298             <span class="keywordflow">if</span> (tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#aaea3a0bd5a46ef32e4a9552046a070b3">u</a>.<a class="code" href="../../d0/d80/struct_onig_token.html#a84f464445695ec0d70cdc5f02db11833">prop</a>.not != 0) <a class="code" href="../../d6/d87/regint_8h.html#afe2d37ab1bcdc5309dd3d5469f9f5aee">NCCLASS_SET_NOT</a>(cc);
<a name="l05299"></a>05299         }
<a name="l05300"></a>05300         <span class="keywordflow">break</span>;
<a name="l05301"></a>05301 
<a name="l05302"></a>05302       <span class="keywordflow">case</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#a612fd1e82d5c1d87c6b73c15cee0ae98">ONIGENC_CTYPE_WORD</a>:
<a name="l05303"></a>05303         *np = <a class="code" href="../../d6/dda/regparse_8c.html#a091fb26f4d8b1649cfbff7879ce9023e">node_new_ctype</a>(tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#aaea3a0bd5a46ef32e4a9552046a070b3">u</a>.<a class="code" href="../../d0/d80/struct_onig_token.html#a84f464445695ec0d70cdc5f02db11833">prop</a>.ctype, tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#aaea3a0bd5a46ef32e4a9552046a070b3">u</a>.<a class="code" href="../../d0/d80/struct_onig_token.html#a84f464445695ec0d70cdc5f02db11833">prop</a>.not);
<a name="l05304"></a>05304         <a class="code" href="../../d6/d87/regint_8h.html#a17ebb2a12300dcf6d79916e357fae45a">CHECK_NULL_RETURN_MEMERR</a>(*np);
<a name="l05305"></a>05305         <span class="keywordflow">break</span>;
<a name="l05306"></a>05306 
<a name="l05307"></a>05307       <span class="keywordflow">case</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#a4bb931592f6bcd2ab5ae44c5d866a094">ONIGENC_CTYPE_SPACE</a>:
<a name="l05308"></a>05308       <span class="keywordflow">case</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#a14f0f2ce858aa271891329a3c5a9f6cb">ONIGENC_CTYPE_DIGIT</a>:
<a name="l05309"></a>05309       <span class="keywordflow">case</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#a2964cbf76712be02ed2d0f07e4b8386e">ONIGENC_CTYPE_XDIGIT</a>:
<a name="l05310"></a>05310         {
<a name="l05311"></a>05311           <a class="code" href="../../d8/d79/struct_c_class_node.html">CClassNode</a>* cc;
<a name="l05312"></a>05312 
<a name="l05313"></a>05313 <span class="preprocessor">#ifdef USE_SHARED_CCLASS_TABLE</span>
<a name="l05314"></a>05314 <span class="preprocessor"></span>          <span class="keyword">const</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#a7c8a84bc12127007886efbfcf53b6fb5">OnigCodePoint</a> *mbr;
<a name="l05315"></a>05315           <a class="code" href="../../d8/db3/oniguruma_8h.html#a7c8a84bc12127007886efbfcf53b6fb5">OnigCodePoint</a> sb_out;
<a name="l05316"></a>05316 
<a name="l05317"></a>05317           r = <a class="code" href="../../d8/db3/oniguruma_8h.html#adadc7b6817d54b859f2aeabcf97d4ed7">ONIGENC_GET_CTYPE_CODE_RANGE</a>(env-&gt;<a class="code" href="../../d6/dbe/struct_scan_env.html#a97f766db4ac9dabc9d173bf99fbcc11b">enc</a>, tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#aaea3a0bd5a46ef32e4a9552046a070b3">u</a>.<a class="code" href="../../d0/d80/struct_onig_token.html#a84f464445695ec0d70cdc5f02db11833">prop</a>.ctype,
<a name="l05318"></a>05318                                            &amp;sb_out, &amp;mbr);
<a name="l05319"></a>05319           <span class="keywordflow">if</span> (r == 0 &amp;&amp;
<a name="l05320"></a>05320               <a class="code" href="../../d8/db3/oniguruma_8h.html#ab94c91d5d242fb022443401092575f63">ONIGENC_CODE_RANGE_NUM</a>(mbr)
<a name="l05321"></a>05321               &gt;= <a class="code" href="../../d6/dda/regparse_8c.html#aa56df0b504a51051736f28ef2396175f">THRESHOLD_RANGE_NUM_FOR_SHARE_CCLASS</a>) {
<a name="l05322"></a>05322             <a class="code" href="../../dc/d85/structtype__cclass__key.html">type_cclass_key</a>  <a class="code" href="../../dc/de5/random_8c.html#a742229490b6759a90ece7ba82ba129d5">key</a>;
<a name="l05323"></a>05323             <a class="code" href="../../dc/d85/structtype__cclass__key.html">type_cclass_key</a>* new_key;
<a name="l05324"></a>05324 
<a name="l05325"></a>05325             key.<a class="code" href="../../dc/d85/structtype__cclass__key.html#a1faea618be3c6662cb3868496f3b2867">enc</a>  = env-&gt;<a class="code" href="../../d6/dbe/struct_scan_env.html#a97f766db4ac9dabc9d173bf99fbcc11b">enc</a>;
<a name="l05326"></a>05326             key.<a class="code" href="../../dc/d85/structtype__cclass__key.html#aba17e22a7eece4b1fc97dac64ae8ae3f">not</a>  = tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#aaea3a0bd5a46ef32e4a9552046a070b3">u</a>.<a class="code" href="../../d0/d80/struct_onig_token.html#a84f464445695ec0d70cdc5f02db11833">prop</a>.not;
<a name="l05327"></a>05327             key.<a class="code" href="../../dc/d85/structtype__cclass__key.html#aa809515f1a338c4e0b2185458e22af25">type</a> = tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#aaea3a0bd5a46ef32e4a9552046a070b3">u</a>.<a class="code" href="../../d0/d80/struct_onig_token.html#a84f464445695ec0d70cdc5f02db11833">prop</a>.ctype;
<a name="l05328"></a>05328 
<a name="l05329"></a>05329             <a class="code" href="../../d6/d87/regint_8h.html#a89044129ef788a94169add8be849e66b">THREAD_ATOMIC_START</a>;
<a name="l05330"></a>05330 
<a name="l05331"></a>05331             <span class="keywordflow">if</span> (<a class="code" href="../../d6/d87/regint_8h.html#a91a9c9242dc3810582965d1882d1894d">IS_NULL</a>(OnigTypeCClassTable)) {
<a name="l05332"></a>05332               OnigTypeCClassTable
<a name="l05333"></a>05333                 = <a class="code" href="../../d6/d87/regint_8h.html#a8efc6c47658fce57d397718a64a03ca0">onig_st_init_table_with_size</a>(&amp;type_type_cclass_hash, 10);
<a name="l05334"></a>05334               <span class="keywordflow">if</span> (<a class="code" href="../../d6/d87/regint_8h.html#a91a9c9242dc3810582965d1882d1894d">IS_NULL</a>(OnigTypeCClassTable)) {
<a name="l05335"></a>05335                 <a class="code" href="../../d6/d87/regint_8h.html#a88a1ea7a04c3da104c4ef1ff6444b3ae">THREAD_ATOMIC_END</a>;
<a name="l05336"></a>05336                 <span class="keywordflow">return</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#a843ef92c5edce533877d3d65ef94a142">ONIGERR_MEMORY</a>;
<a name="l05337"></a>05337               }
<a name="l05338"></a>05338             }
<a name="l05339"></a>05339             <span class="keywordflow">else</span> {
<a name="l05340"></a>05340               <span class="keywordflow">if</span> (<a class="code" href="../../d6/d87/regint_8h.html#af5c4d169f5e1aa4b80012e1e67a76dc1">onig_st_lookup</a>(OnigTypeCClassTable, (<a class="code" href="../../de/dce/syck_8h.html#a8a45dfe133c1fd041e1b902bda9e43e8">st_data_t</a> )&amp;key,
<a name="l05341"></a>05341                                  (<a class="code" href="../../de/dce/syck_8h.html#a8a45dfe133c1fd041e1b902bda9e43e8">st_data_t</a>* )np)) {
<a name="l05342"></a>05342                 <a class="code" href="../../d6/d87/regint_8h.html#a88a1ea7a04c3da104c4ef1ff6444b3ae">THREAD_ATOMIC_END</a>;
<a name="l05343"></a>05343                 <span class="keywordflow">break</span>;
<a name="l05344"></a>05344               }
<a name="l05345"></a>05345             }
<a name="l05346"></a>05346 
<a name="l05347"></a>05347             *np = <a class="code" href="../../d6/dda/regparse_8c.html#a51188ccfbbf16afcaf725f0485c4120d">node_new_cclass_by_codepoint_range</a>(tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#aaea3a0bd5a46ef32e4a9552046a070b3">u</a>.<a class="code" href="../../d0/d80/struct_onig_token.html#a84f464445695ec0d70cdc5f02db11833">prop</a>.not,
<a name="l05348"></a>05348                                                      sb_out, mbr);
<a name="l05349"></a>05349             <span class="keywordflow">if</span> (<a class="code" href="../../d6/d87/regint_8h.html#a91a9c9242dc3810582965d1882d1894d">IS_NULL</a>(*np)) {
<a name="l05350"></a>05350               <a class="code" href="../../d6/d87/regint_8h.html#a88a1ea7a04c3da104c4ef1ff6444b3ae">THREAD_ATOMIC_END</a>;
<a name="l05351"></a>05351               <span class="keywordflow">return</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#a843ef92c5edce533877d3d65ef94a142">ONIGERR_MEMORY</a>;
<a name="l05352"></a>05352             }
<a name="l05353"></a>05353 
<a name="l05354"></a>05354             cc = <a class="code" href="../../d1/dfc/regparse_8h.html#a816a6d8f921892c2efef73eb7727d589">NCCLASS</a>(*np);
<a name="l05355"></a>05355             <a class="code" href="../../d6/d87/regint_8h.html#a3605ecb2eade0dfa916046c97860548b">NCCLASS_SET_SHARE</a>(cc);
<a name="l05356"></a>05356             new_key = (<a class="code" href="../../dc/d85/structtype__cclass__key.html">type_cclass_key</a>* )<a class="code" href="../../d8/db0/defines_8h.html#a6af5faec3f9662b20ffc9903f923dec0">xmalloc</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../dc/d85/structtype__cclass__key.html">type_cclass_key</a>));
<a name="l05357"></a>05357             <a class="code" href="../../d6/d87/regint_8h.html#ad9f94f6a1ee2c69b34d8034684b31518">xmemcpy</a>(new_key, &amp;key, <span class="keyword">sizeof</span>(<a class="code" href="../../dc/d85/structtype__cclass__key.html">type_cclass_key</a>));
<a name="l05358"></a>05358             <a class="code" href="../../d6/d87/regint_8h.html#ae558dbf37c0fb7937031b8e371e39d1a">onig_st_add_direct</a>(OnigTypeCClassTable, (<a class="code" href="../../de/dce/syck_8h.html#a8a45dfe133c1fd041e1b902bda9e43e8">st_data_t</a> )new_key,
<a name="l05359"></a>05359                                (<a class="code" href="../../de/dce/syck_8h.html#a8a45dfe133c1fd041e1b902bda9e43e8">st_data_t</a> )*np);
<a name="l05360"></a>05360 
<a name="l05361"></a>05361             <a class="code" href="../../d6/d87/regint_8h.html#a88a1ea7a04c3da104c4ef1ff6444b3ae">THREAD_ATOMIC_END</a>;
<a name="l05362"></a>05362           }
<a name="l05363"></a>05363           <span class="keywordflow">else</span> {
<a name="l05364"></a>05364 <span class="preprocessor">#endif</span>
<a name="l05365"></a>05365 <span class="preprocessor"></span>            *np = <a class="code" href="../../d6/dda/regparse_8c.html#afd60d28ead746c5b464b5a114d8960f1">node_new_cclass</a>();
<a name="l05366"></a>05366             <a class="code" href="../../d6/d87/regint_8h.html#a17ebb2a12300dcf6d79916e357fae45a">CHECK_NULL_RETURN_MEMERR</a>(*np);
<a name="l05367"></a>05367             cc = <a class="code" href="../../d1/dfc/regparse_8h.html#a816a6d8f921892c2efef73eb7727d589">NCCLASS</a>(*np);
<a name="l05368"></a>05368             <a class="code" href="../../d6/dda/regparse_8c.html#a30cf0640cd2a2e99e72171d90a4213f6">add_ctype_to_cc</a>(cc, tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#aaea3a0bd5a46ef32e4a9552046a070b3">u</a>.<a class="code" href="../../d0/d80/struct_onig_token.html#a84f464445695ec0d70cdc5f02db11833">prop</a>.ctype, 0, env);
<a name="l05369"></a>05369             <span class="keywordflow">if</span> (tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#aaea3a0bd5a46ef32e4a9552046a070b3">u</a>.<a class="code" href="../../d0/d80/struct_onig_token.html#a84f464445695ec0d70cdc5f02db11833">prop</a>.not != 0) <a class="code" href="../../d6/d87/regint_8h.html#afe2d37ab1bcdc5309dd3d5469f9f5aee">NCCLASS_SET_NOT</a>(cc);
<a name="l05370"></a>05370 <span class="preprocessor">#ifdef USE_SHARED_CCLASS_TABLE</span>
<a name="l05371"></a>05371 <span class="preprocessor"></span>          }
<a name="l05372"></a>05372 <span class="preprocessor">#endif</span>
<a name="l05373"></a>05373 <span class="preprocessor"></span>        }
<a name="l05374"></a>05374         <span class="keywordflow">break</span>;
<a name="l05375"></a>05375 
<a name="l05376"></a>05376       <span class="keywordflow">default</span>:
<a name="l05377"></a>05377         <span class="keywordflow">return</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#a4067ac325df2d4bb0b4d2e692c257a49">ONIGERR_PARSER_BUG</a>;
<a name="l05378"></a>05378         <span class="keywordflow">break</span>;
<a name="l05379"></a>05379       }
<a name="l05380"></a>05380     }
<a name="l05381"></a>05381     <span class="keywordflow">break</span>;
<a name="l05382"></a>05382 
<a name="l05383"></a>05383   <span class="keywordflow">case</span> <a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250da81d0318969b984a3d42eab29ec60fb47">TK_CHAR_PROPERTY</a>:
<a name="l05384"></a>05384     r = <a class="code" href="../../d6/dda/regparse_8c.html#adaf2985bb85a858ceaf9e101e4214d35">parse_char_property</a>(np, tok, src, end, env);
<a name="l05385"></a>05385     <span class="keywordflow">if</span> (r != 0) <span class="keywordflow">return</span> r;
<a name="l05386"></a>05386     <span class="keywordflow">break</span>;
<a name="l05387"></a>05387 
<a name="l05388"></a>05388   <span class="keywordflow">case</span> <a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250da5817d25633c6a037e356c292ea7622d7">TK_CC_OPEN</a>:
<a name="l05389"></a>05389     {
<a name="l05390"></a>05390       <a class="code" href="../../d8/d79/struct_c_class_node.html">CClassNode</a>* cc;
<a name="l05391"></a>05391 
<a name="l05392"></a>05392       r = <a class="code" href="../../d6/dda/regparse_8c.html#abc86706f6ac6a3fad3db8b1bf25f13ce">parse_char_class</a>(np, tok, src, end, env);
<a name="l05393"></a>05393       <span class="keywordflow">if</span> (r != 0) <span class="keywordflow">return</span> r;
<a name="l05394"></a>05394 
<a name="l05395"></a>05395       cc = <a class="code" href="../../d1/dfc/regparse_8h.html#a816a6d8f921892c2efef73eb7727d589">NCCLASS</a>(*np);
<a name="l05396"></a>05396       <span class="keywordflow">if</span> (<a class="code" href="../../d6/d87/regint_8h.html#ae42e344c5336b241948a7a47c99d6533">IS_IGNORECASE</a>(env-&gt;<a class="code" href="../../d6/dbe/struct_scan_env.html#a1a7599f3079dfc7ab6d0b317f0f37d93">option</a>)) {
<a name="l05397"></a>05397         <a class="code" href="../../d9/d20/struct_i_apply_case_fold_arg.html">IApplyCaseFoldArg</a> iarg;
<a name="l05398"></a>05398 
<a name="l05399"></a>05399         iarg.<a class="code" href="../../d9/d20/struct_i_apply_case_fold_arg.html#a9373e696418859ceef2dc3d026d20b57">env</a>      = env;
<a name="l05400"></a>05400         iarg.<a class="code" href="../../d9/d20/struct_i_apply_case_fold_arg.html#aa531ebb2a3caff9ba4fcee92b4b48fba">cc</a>       = cc;
<a name="l05401"></a>05401         iarg.<a class="code" href="../../d9/d20/struct_i_apply_case_fold_arg.html#ab6d5bedca599f2295e09f0ce1e2283fb">alt_root</a> = <a class="code" href="../../d3/d7f/gram_8c.html#ac00d2982d51115efbe8a13840d47b7a7">NULL_NODE</a>;
<a name="l05402"></a>05402         iarg.<a class="code" href="../../d9/d20/struct_i_apply_case_fold_arg.html#a12f71f4be6c3b1d9169d5bedb6467fa9">ptail</a>    = &amp;(iarg.<a class="code" href="../../d9/d20/struct_i_apply_case_fold_arg.html#ab6d5bedca599f2295e09f0ce1e2283fb">alt_root</a>);
<a name="l05403"></a>05403 
<a name="l05404"></a>05404         r = <a class="code" href="../../d8/db3/oniguruma_8h.html#a0bd32be69be640d653aa08a35edf44bf">ONIGENC_APPLY_ALL_CASE_FOLD</a>(env-&gt;<a class="code" href="../../d6/dbe/struct_scan_env.html#a97f766db4ac9dabc9d173bf99fbcc11b">enc</a>, env-&gt;<a class="code" href="../../d6/dbe/struct_scan_env.html#abf6865ae87b1bbad0341c78bf44199e1">case_fold_flag</a>,
<a name="l05405"></a>05405                                         <a class="code" href="../../d6/dda/regparse_8c.html#ae98372c3ef790f3800ab507b029916a1">i_apply_case_fold</a>, &amp;iarg);
<a name="l05406"></a>05406         <span class="keywordflow">if</span> (r != 0) {
<a name="l05407"></a>05407           <a class="code" href="../../d6/dda/regparse_8c.html#aa98ee34de192fd4997906389f70f4808">onig_node_free</a>(iarg.<a class="code" href="../../d9/d20/struct_i_apply_case_fold_arg.html#ab6d5bedca599f2295e09f0ce1e2283fb">alt_root</a>);
<a name="l05408"></a>05408           <span class="keywordflow">return</span> r;
<a name="l05409"></a>05409         }
<a name="l05410"></a>05410         <span class="keywordflow">if</span> (<a class="code" href="../../d6/d87/regint_8h.html#a4bc25fbd4749a2c130d1ae7f15ba140c">IS_NOT_NULL</a>(iarg.<a class="code" href="../../d9/d20/struct_i_apply_case_fold_arg.html#ab6d5bedca599f2295e09f0ce1e2283fb">alt_root</a>)) {
<a name="l05411"></a>05411           <a class="code" href="../../d0/d6e/struct___node.html">Node</a>* work = <a class="code" href="../../d6/dda/regparse_8c.html#a9ee0d6fbf2d9ed077e5c5831b93444a6">onig_node_new_alt</a>(*np, iarg.<a class="code" href="../../d9/d20/struct_i_apply_case_fold_arg.html#ab6d5bedca599f2295e09f0ce1e2283fb">alt_root</a>);
<a name="l05412"></a>05412           <span class="keywordflow">if</span> (<a class="code" href="../../d6/d87/regint_8h.html#a91a9c9242dc3810582965d1882d1894d">IS_NULL</a>(work)) {
<a name="l05413"></a>05413             <a class="code" href="../../d6/dda/regparse_8c.html#aa98ee34de192fd4997906389f70f4808">onig_node_free</a>(iarg.<a class="code" href="../../d9/d20/struct_i_apply_case_fold_arg.html#ab6d5bedca599f2295e09f0ce1e2283fb">alt_root</a>);
<a name="l05414"></a>05414             <span class="keywordflow">return</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#a843ef92c5edce533877d3d65ef94a142">ONIGERR_MEMORY</a>;
<a name="l05415"></a>05415           }
<a name="l05416"></a>05416           *np = work;
<a name="l05417"></a>05417         }
<a name="l05418"></a>05418       }
<a name="l05419"></a>05419     }
<a name="l05420"></a>05420     <span class="keywordflow">break</span>;
<a name="l05421"></a>05421 
<a name="l05422"></a>05422   <span class="keywordflow">case</span> <a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250da1753696cfcc436c5ed6c31a5de77b3cd">TK_ANYCHAR</a>:
<a name="l05423"></a>05423     *np = <a class="code" href="../../d6/dda/regparse_8c.html#a29549d0c76087762275031d66141050b">node_new_anychar</a>();
<a name="l05424"></a>05424     <a class="code" href="../../d6/d87/regint_8h.html#a17ebb2a12300dcf6d79916e357fae45a">CHECK_NULL_RETURN_MEMERR</a>(*np);
<a name="l05425"></a>05425     <span class="keywordflow">break</span>;
<a name="l05426"></a>05426 
<a name="l05427"></a>05427   <span class="keywordflow">case</span> <a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250da280d14d1e68a04cda6cdeb5ffe52791f">TK_ANYCHAR_ANYTIME</a>:
<a name="l05428"></a>05428     *np = <a class="code" href="../../d6/dda/regparse_8c.html#a29549d0c76087762275031d66141050b">node_new_anychar</a>();
<a name="l05429"></a>05429     <a class="code" href="../../d6/d87/regint_8h.html#a17ebb2a12300dcf6d79916e357fae45a">CHECK_NULL_RETURN_MEMERR</a>(*np);
<a name="l05430"></a>05430     qn = <a class="code" href="../../d6/dda/regparse_8c.html#ac5adfdb214b7e15f4a0439d28a7a11b9">node_new_quantifier</a>(0, <a class="code" href="../../d6/d87/regint_8h.html#aaaf8d5e1b9d204ddb0b681077890b01f">REPEAT_INFINITE</a>, 0);
<a name="l05431"></a>05431     <a class="code" href="../../d6/d87/regint_8h.html#a17ebb2a12300dcf6d79916e357fae45a">CHECK_NULL_RETURN_MEMERR</a>(qn);
<a name="l05432"></a>05432     <a class="code" href="../../d1/dfc/regparse_8h.html#addc653094848075876587782124e9504">NQTFR</a>(qn)-&gt;target = *np;
<a name="l05433"></a>05433     *np = qn;
<a name="l05434"></a>05434     <span class="keywordflow">break</span>;
<a name="l05435"></a>05435 
<a name="l05436"></a>05436   <span class="keywordflow">case</span> <a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250da6009b276a2eb504bd2db835140ef34c4">TK_BACKREF</a>:
<a name="l05437"></a>05437     len = tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#aaea3a0bd5a46ef32e4a9552046a070b3">u</a>.<a class="code" href="../../d0/d80/struct_onig_token.html#adfd59d141a94df1a86846e7a56e9ab3a">backref</a>.num;
<a name="l05438"></a>05438     *np = <a class="code" href="../../d6/dda/regparse_8c.html#aa10b21fdcb9ddfc3437cfe4fa2a280c4">node_new_backref</a>(len,
<a name="l05439"></a>05439                    (len &gt; 1 ? tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#aaea3a0bd5a46ef32e4a9552046a070b3">u</a>.<a class="code" href="../../d0/d80/struct_onig_token.html#adfd59d141a94df1a86846e7a56e9ab3a">backref</a>.refs : &amp;(tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#aaea3a0bd5a46ef32e4a9552046a070b3">u</a>.<a class="code" href="../../d0/d80/struct_onig_token.html#adfd59d141a94df1a86846e7a56e9ab3a">backref</a>.ref1)),
<a name="l05440"></a>05440                            tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#aaea3a0bd5a46ef32e4a9552046a070b3">u</a>.<a class="code" href="../../d0/d80/struct_onig_token.html#adfd59d141a94df1a86846e7a56e9ab3a">backref</a>.by_name,
<a name="l05441"></a>05441 #ifdef <a class="code" href="../../d6/d87/regint_8h.html#ad06b56f5a7d10a85e880f076d728f11b">USE_BACKREF_WITH_LEVEL</a>
<a name="l05442"></a>05442                            tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#aaea3a0bd5a46ef32e4a9552046a070b3">u</a>.<a class="code" href="../../d0/d80/struct_onig_token.html#adfd59d141a94df1a86846e7a56e9ab3a">backref</a>.exist_level,
<a name="l05443"></a>05443                            tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#aaea3a0bd5a46ef32e4a9552046a070b3">u</a>.<a class="code" href="../../d0/d80/struct_onig_token.html#adfd59d141a94df1a86846e7a56e9ab3a">backref</a>.level,
<a name="l05444"></a>05444 #endif
<a name="l05445"></a>05445                            env);
<a name="l05446"></a>05446     <a class="code" href="../../d6/d87/regint_8h.html#a17ebb2a12300dcf6d79916e357fae45a">CHECK_NULL_RETURN_MEMERR</a>(*np);
<a name="l05447"></a>05447     <span class="keywordflow">break</span>;
<a name="l05448"></a>05448 
<a name="l05449"></a>05449 <span class="preprocessor">#ifdef USE_SUBEXP_CALL</span>
<a name="l05450"></a>05450 <span class="preprocessor"></span>  <span class="keywordflow">case</span> <a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250da8198b2b556338495587a25b47927061a">TK_CALL</a>:
<a name="l05451"></a>05451     {
<a name="l05452"></a>05452       <span class="keywordtype">int</span> gnum = tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#aaea3a0bd5a46ef32e4a9552046a070b3">u</a>.<a class="code" href="../../d0/d80/struct_onig_token.html#a97792b06ff75408d4a1bdd94523e4f5d">call</a>.gnum;
<a name="l05453"></a>05453 
<a name="l05454"></a>05454       <span class="keywordflow">if</span> (gnum &lt; 0) {
<a name="l05455"></a>05455         gnum = <a class="code" href="../../d6/dda/regparse_8c.html#ab46c3e257763e4d4732f97674ea1689c">BACKREF_REL_TO_ABS</a>(gnum, env);
<a name="l05456"></a>05456         <span class="keywordflow">if</span> (gnum &lt;= 0)
<a name="l05457"></a>05457           <span class="keywordflow">return</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#adbf6f094cfd29f00edfcf0484dcbe7fa">ONIGERR_INVALID_BACKREF</a>;
<a name="l05458"></a>05458       }
<a name="l05459"></a>05459       *np = <a class="code" href="../../d6/dda/regparse_8c.html#afe414bf273e80530aa328c4cf0e2ba09">node_new_call</a>(tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#aaea3a0bd5a46ef32e4a9552046a070b3">u</a>.<a class="code" href="../../d0/d80/struct_onig_token.html#a97792b06ff75408d4a1bdd94523e4f5d">call</a>.name, tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#aaea3a0bd5a46ef32e4a9552046a070b3">u</a>.<a class="code" href="../../d0/d80/struct_onig_token.html#a97792b06ff75408d4a1bdd94523e4f5d">call</a>.name_end, gnum);
<a name="l05460"></a>05460       <a class="code" href="../../d6/d87/regint_8h.html#a17ebb2a12300dcf6d79916e357fae45a">CHECK_NULL_RETURN_MEMERR</a>(*np);
<a name="l05461"></a>05461       env-&gt;num_call++;
<a name="l05462"></a>05462     }
<a name="l05463"></a>05463     <span class="keywordflow">break</span>;
<a name="l05464"></a>05464 <span class="preprocessor">#endif</span>
<a name="l05465"></a>05465 <span class="preprocessor"></span>
<a name="l05466"></a>05466   <span class="keywordflow">case</span> <a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250da35870f30489b8c9a3dc0c7197b8e880b">TK_ANCHOR</a>:
<a name="l05467"></a>05467     *np = <a class="code" href="../../d6/dda/regparse_8c.html#a153ac14abd8927a6edd4da2f445d1c30">onig_node_new_anchor</a>(tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#aaea3a0bd5a46ef32e4a9552046a070b3">u</a>.<a class="code" href="../../d0/d80/struct_onig_token.html#a8f7fd17d715a4ce24540eef7b411ec62">anchor</a>);
<a name="l05468"></a>05468     <span class="keywordflow">break</span>;
<a name="l05469"></a>05469 
<a name="l05470"></a>05470   <span class="keywordflow">case</span> <a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250daef6e175c79d6876bc5d93d82c1d13eb8">TK_OP_REPEAT</a>:
<a name="l05471"></a>05471   <span class="keywordflow">case</span> <a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250da6d79c0cbba40a10a9d6790b9b874c833">TK_INTERVAL</a>:
<a name="l05472"></a>05472     <span class="keywordflow">if</span> (<a class="code" href="../../d1/dfc/regparse_8h.html#a18bfc9ee154d6dd516347bd71b4810f6">IS_SYNTAX_BV</a>(env-&gt;syntax, <a class="code" href="../../d8/db3/oniguruma_8h.html#afc0c228803db17e2bdff7a9ca0b79361">ONIG_SYN_CONTEXT_INDEP_REPEAT_OPS</a>)) {
<a name="l05473"></a>05473       <span class="keywordflow">if</span> (<a class="code" href="../../d1/dfc/regparse_8h.html#a18bfc9ee154d6dd516347bd71b4810f6">IS_SYNTAX_BV</a>(env-&gt;syntax, <a class="code" href="../../d8/db3/oniguruma_8h.html#ae2684f2f9a9f79ee02473d0556b09996">ONIG_SYN_CONTEXT_INVALID_REPEAT_OPS</a>))
<a name="l05474"></a>05474         <span class="keywordflow">return</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#ad2b3578c328ef7b20b48e16c1d642c26">ONIGERR_TARGET_OF_REPEAT_OPERATOR_NOT_SPECIFIED</a>;
<a name="l05475"></a>05475       <span class="keywordflow">else</span>
<a name="l05476"></a>05476         *np = <a class="code" href="../../d6/dda/regparse_8c.html#a989b3c8a59c2bd7c3b1d33849ebc59e3">node_new_empty</a>();
<a name="l05477"></a>05477     }
<a name="l05478"></a>05478     <span class="keywordflow">else</span> {
<a name="l05479"></a>05479       <span class="keywordflow">goto</span> tk_byte;
<a name="l05480"></a>05480     }
<a name="l05481"></a>05481     <span class="keywordflow">break</span>;
<a name="l05482"></a>05482 
<a name="l05483"></a>05483   <span class="keywordflow">default</span>:
<a name="l05484"></a>05484     <span class="keywordflow">return</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#a4067ac325df2d4bb0b4d2e692c257a49">ONIGERR_PARSER_BUG</a>;
<a name="l05485"></a>05485     <span class="keywordflow">break</span>;
<a name="l05486"></a>05486   }
<a name="l05487"></a>05487 
<a name="l05488"></a>05488   {
<a name="l05489"></a>05489     targetp = np;
<a name="l05490"></a>05490 
<a name="l05491"></a>05491   re_entry:
<a name="l05492"></a>05492     r = <a class="code" href="../../d6/dda/regparse_8c.html#af1214620e9e6133cd463d363f2cb332f">fetch_token</a>(tok, src, end, env);
<a name="l05493"></a>05493     <span class="keywordflow">if</span> (r &lt; 0) <span class="keywordflow">return</span> r;
<a name="l05494"></a>05494 
<a name="l05495"></a>05495   repeat:
<a name="l05496"></a>05496     <span class="keywordflow">if</span> (r == <a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250daef6e175c79d6876bc5d93d82c1d13eb8">TK_OP_REPEAT</a> || r == <a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250da6d79c0cbba40a10a9d6790b9b874c833">TK_INTERVAL</a>) {
<a name="l05497"></a>05497       <span class="keywordflow">if</span> (<a class="code" href="../../d6/dda/regparse_8c.html#a04707c51659bce94885f3eef37be748b">is_invalid_quantifier_target</a>(*targetp))
<a name="l05498"></a>05498         <span class="keywordflow">return</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#a28b3e0c4012762c8287ddf214750449e">ONIGERR_TARGET_OF_REPEAT_OPERATOR_INVALID</a>;
<a name="l05499"></a>05499 
<a name="l05500"></a>05500       qn = <a class="code" href="../../d6/dda/regparse_8c.html#ac5adfdb214b7e15f4a0439d28a7a11b9">node_new_quantifier</a>(tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#aaea3a0bd5a46ef32e4a9552046a070b3">u</a>.<a class="code" href="../../d0/d80/struct_onig_token.html#a7ff69fe23d1d3da2bfd163c760ef4e44">repeat</a>.lower, tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#aaea3a0bd5a46ef32e4a9552046a070b3">u</a>.<a class="code" href="../../d0/d80/struct_onig_token.html#a7ff69fe23d1d3da2bfd163c760ef4e44">repeat</a>.upper,
<a name="l05501"></a>05501                                (r == <a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250da6d79c0cbba40a10a9d6790b9b874c833">TK_INTERVAL</a> ? 1 : 0));
<a name="l05502"></a>05502       <a class="code" href="../../d6/d87/regint_8h.html#a17ebb2a12300dcf6d79916e357fae45a">CHECK_NULL_RETURN_MEMERR</a>(qn);
<a name="l05503"></a>05503       <a class="code" href="../../d1/dfc/regparse_8h.html#addc653094848075876587782124e9504">NQTFR</a>(qn)-&gt;greedy = tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#aaea3a0bd5a46ef32e4a9552046a070b3">u</a>.<a class="code" href="../../d0/d80/struct_onig_token.html#a7ff69fe23d1d3da2bfd163c760ef4e44">repeat</a>.greedy;
<a name="l05504"></a>05504       r = <a class="code" href="../../d6/dda/regparse_8c.html#a303bd068bc2aa1a3e21b2f36bc2f2cc5">set_quantifier</a>(qn, *targetp, group, env);
<a name="l05505"></a>05505       <span class="keywordflow">if</span> (r &lt; 0) {
<a name="l05506"></a>05506         <a class="code" href="../../d6/dda/regparse_8c.html#aa98ee34de192fd4997906389f70f4808">onig_node_free</a>(qn);
<a name="l05507"></a>05507         <span class="keywordflow">return</span> r;
<a name="l05508"></a>05508       }
<a name="l05509"></a>05509 
<a name="l05510"></a>05510       <span class="keywordflow">if</span> (tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#aaea3a0bd5a46ef32e4a9552046a070b3">u</a>.<a class="code" href="../../d0/d80/struct_onig_token.html#a7ff69fe23d1d3da2bfd163c760ef4e44">repeat</a>.possessive != 0) {
<a name="l05511"></a>05511         <a class="code" href="../../d0/d6e/struct___node.html">Node</a>* en;
<a name="l05512"></a>05512         en = <a class="code" href="../../d6/dda/regparse_8c.html#a266745047dad368886ed92677abae972">node_new_enclose</a>(<a class="code" href="../../d1/dfc/regparse_8h.html#a8a9f973f8fdb597a604757521ae63fe2">ENCLOSE_STOP_BACKTRACK</a>);
<a name="l05513"></a>05513         <span class="keywordflow">if</span> (<a class="code" href="../../d6/d87/regint_8h.html#a91a9c9242dc3810582965d1882d1894d">IS_NULL</a>(en)) {
<a name="l05514"></a>05514           <a class="code" href="../../d6/dda/regparse_8c.html#aa98ee34de192fd4997906389f70f4808">onig_node_free</a>(qn);
<a name="l05515"></a>05515           <span class="keywordflow">return</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#a843ef92c5edce533877d3d65ef94a142">ONIGERR_MEMORY</a>;
<a name="l05516"></a>05516         }
<a name="l05517"></a>05517         <a class="code" href="../../d1/dfc/regparse_8h.html#a2fea29a34640f28158788eef43a9bfd2">NENCLOSE</a>(en)-&gt;target = qn;
<a name="l05518"></a>05518         qn = en;
<a name="l05519"></a>05519       }
<a name="l05520"></a>05520 
<a name="l05521"></a>05521       <span class="keywordflow">if</span> (r == 0) {
<a name="l05522"></a>05522         *targetp = qn;
<a name="l05523"></a>05523       }
<a name="l05524"></a>05524       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (r == 1) {
<a name="l05525"></a>05525         <a class="code" href="../../d6/dda/regparse_8c.html#aa98ee34de192fd4997906389f70f4808">onig_node_free</a>(qn);
<a name="l05526"></a>05526       }
<a name="l05527"></a>05527       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (r == 2) { <span class="comment">/* split case: /abc+/ */</span>
<a name="l05528"></a>05528         <a class="code" href="../../d0/d6e/struct___node.html">Node</a> *tmp;
<a name="l05529"></a>05529 
<a name="l05530"></a>05530         *targetp = <a class="code" href="../../d6/dda/regparse_8c.html#abc9a73fa7f2721f8bc8e9977d1d0cefa">node_new_list</a>(*targetp, <a class="code" href="../../d3/d09/ripper_8y.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l05531"></a>05531         <span class="keywordflow">if</span> (<a class="code" href="../../d6/d87/regint_8h.html#a91a9c9242dc3810582965d1882d1894d">IS_NULL</a>(*targetp)) {
<a name="l05532"></a>05532           <a class="code" href="../../d6/dda/regparse_8c.html#aa98ee34de192fd4997906389f70f4808">onig_node_free</a>(qn);
<a name="l05533"></a>05533           <span class="keywordflow">return</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#a843ef92c5edce533877d3d65ef94a142">ONIGERR_MEMORY</a>;
<a name="l05534"></a>05534         }
<a name="l05535"></a>05535         tmp = <a class="code" href="../../d1/dfc/regparse_8h.html#ac3a01065a5b7f17aad984671c730739e">NCDR</a>(*targetp) = <a class="code" href="../../d6/dda/regparse_8c.html#abc9a73fa7f2721f8bc8e9977d1d0cefa">node_new_list</a>(qn, <a class="code" href="../../d3/d09/ripper_8y.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l05536"></a>05536         <span class="keywordflow">if</span> (<a class="code" href="../../d6/d87/regint_8h.html#a91a9c9242dc3810582965d1882d1894d">IS_NULL</a>(tmp)) {
<a name="l05537"></a>05537           <a class="code" href="../../d6/dda/regparse_8c.html#aa98ee34de192fd4997906389f70f4808">onig_node_free</a>(qn);
<a name="l05538"></a>05538           <span class="keywordflow">return</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#a843ef92c5edce533877d3d65ef94a142">ONIGERR_MEMORY</a>;
<a name="l05539"></a>05539         }
<a name="l05540"></a>05540         targetp = &amp;(<a class="code" href="../../d1/dfc/regparse_8h.html#ace12d76fd705497f81e4e2cd95cd247e">NCAR</a>(tmp));
<a name="l05541"></a>05541       }
<a name="l05542"></a>05542       <span class="keywordflow">goto</span> re_entry;
<a name="l05543"></a>05543     }
<a name="l05544"></a>05544   }
<a name="l05545"></a>05545 
<a name="l05546"></a>05546   <span class="keywordflow">return</span> r;
<a name="l05547"></a>05547 }
<a name="l05548"></a>05548 
<a name="l05549"></a>05549 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l05550"></a><a class="code" href="../../d6/dda/regparse_8c.html#a64f09f44b9ae1bfa821f252f69d9a14c">05550</a> <a class="code" href="../../d6/dda/regparse_8c.html#a64f09f44b9ae1bfa821f252f69d9a14c">parse_branch</a>(<a class="code" href="../../d0/d6e/struct___node.html">Node</a>** <a class="code" href="../../d6/da0/nkf-utf8_2nkf_8c.html#a3fdd42ea34070a54e696b3adc28c4be3">top</a>, <a class="code" href="../../d0/d80/struct_onig_token.html">OnigToken</a>* <a class="code" href="../../d5/d11/ripper_8c.html#a2b3a335d617ec14d6296ca82d3055858">tok</a>, <span class="keywordtype">int</span> <a class="code" href="../../d3/d09/ripper_8y.html#a0c940d9e4ce4cfee55d7ccf714a1303d">term</a>,
<a name="l05551"></a>05551              <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>** src, <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>* end, <a class="code" href="../../d6/dbe/struct_scan_env.html">ScanEnv</a>* env)
<a name="l05552"></a>05552 {
<a name="l05553"></a>05553   <span class="keywordtype">int</span> r;
<a name="l05554"></a>05554   <a class="code" href="../../d0/d6e/struct___node.html">Node</a> *node, **headp;
<a name="l05555"></a>05555 
<a name="l05556"></a>05556   *top = <a class="code" href="../../d3/d09/ripper_8y.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l05557"></a>05557   r = <a class="code" href="../../d6/dda/regparse_8c.html#ad281aaac939a085676b002a3221d203d">parse_exp</a>(&amp;node, tok, term, src, end, env);
<a name="l05558"></a>05558   <span class="keywordflow">if</span> (r &lt; 0) {
<a name="l05559"></a>05559     <a class="code" href="../../d6/dda/regparse_8c.html#aa98ee34de192fd4997906389f70f4808">onig_node_free</a>(node);
<a name="l05560"></a>05560     <span class="keywordflow">return</span> r;
<a name="l05561"></a>05561   }
<a name="l05562"></a>05562 
<a name="l05563"></a>05563   <span class="keywordflow">if</span> (r == <a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250da4b2acbe6a651813a07506f06d624ac3b">TK_EOT</a> || r == term || r == <a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250da902b0cdea9f57e86f33e1c42c38bae8a">TK_ALT</a>) {
<a name="l05564"></a>05564     *top = node;
<a name="l05565"></a>05565   }
<a name="l05566"></a>05566   <span class="keywordflow">else</span> {
<a name="l05567"></a>05567     *top  = <a class="code" href="../../d6/dda/regparse_8c.html#abc9a73fa7f2721f8bc8e9977d1d0cefa">node_new_list</a>(node, <a class="code" href="../../d3/d09/ripper_8y.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l05568"></a>05568     headp = &amp;(<a class="code" href="../../d1/dfc/regparse_8h.html#ac3a01065a5b7f17aad984671c730739e">NCDR</a>(*top));
<a name="l05569"></a>05569     <span class="keywordflow">while</span> (r != <a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250da4b2acbe6a651813a07506f06d624ac3b">TK_EOT</a> &amp;&amp; r != term &amp;&amp; r != <a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250da902b0cdea9f57e86f33e1c42c38bae8a">TK_ALT</a>) {
<a name="l05570"></a>05570       r = <a class="code" href="../../d6/dda/regparse_8c.html#ad281aaac939a085676b002a3221d203d">parse_exp</a>(&amp;node, tok, term, src, end, env);
<a name="l05571"></a>05571       <span class="keywordflow">if</span> (r &lt; 0) {
<a name="l05572"></a>05572         <a class="code" href="../../d6/dda/regparse_8c.html#aa98ee34de192fd4997906389f70f4808">onig_node_free</a>(node);
<a name="l05573"></a>05573         <span class="keywordflow">return</span> r;
<a name="l05574"></a>05574       }
<a name="l05575"></a>05575 
<a name="l05576"></a>05576       <span class="keywordflow">if</span> (<a class="code" href="../../d1/dfc/regparse_8h.html#ad500a736993c4ddc933ff93b42eeb1e5">NTYPE</a>(node) == <a class="code" href="../../d1/dfc/regparse_8h.html#aba3b5392b65c7a886251ccb7bdf93cf0">NT_LIST</a>) {
<a name="l05577"></a>05577         *headp = node;
<a name="l05578"></a>05578         <span class="keywordflow">while</span> (<a class="code" href="../../d6/d87/regint_8h.html#a4bc25fbd4749a2c130d1ae7f15ba140c">IS_NOT_NULL</a>(<a class="code" href="../../d1/dfc/regparse_8h.html#ac3a01065a5b7f17aad984671c730739e">NCDR</a>(node))) node = <a class="code" href="../../d1/dfc/regparse_8h.html#ac3a01065a5b7f17aad984671c730739e">NCDR</a>(node);
<a name="l05579"></a>05579         headp = &amp;(<a class="code" href="../../d1/dfc/regparse_8h.html#ac3a01065a5b7f17aad984671c730739e">NCDR</a>(node));
<a name="l05580"></a>05580       }
<a name="l05581"></a>05581       <span class="keywordflow">else</span> {
<a name="l05582"></a>05582         *headp = <a class="code" href="../../d6/dda/regparse_8c.html#abc9a73fa7f2721f8bc8e9977d1d0cefa">node_new_list</a>(node, <a class="code" href="../../d3/d09/ripper_8y.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l05583"></a>05583         headp = &amp;(<a class="code" href="../../d1/dfc/regparse_8h.html#ac3a01065a5b7f17aad984671c730739e">NCDR</a>(*headp));
<a name="l05584"></a>05584       }
<a name="l05585"></a>05585     }
<a name="l05586"></a>05586   }
<a name="l05587"></a>05587 
<a name="l05588"></a>05588   <span class="keywordflow">return</span> r;
<a name="l05589"></a>05589 }
<a name="l05590"></a>05590 
<a name="l05591"></a>05591 <span class="comment">/* term_tok: TK_EOT or TK_SUBEXP_CLOSE */</span>
<a name="l05592"></a>05592 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l05593"></a><a class="code" href="../../d6/dda/regparse_8c.html#a3822726195b34935bce3ca92fe4d8085">05593</a> <a class="code" href="../../d6/dda/regparse_8c.html#a3822726195b34935bce3ca92fe4d8085">parse_subexp</a>(<a class="code" href="../../d0/d6e/struct___node.html">Node</a>** <a class="code" href="../../d6/da0/nkf-utf8_2nkf_8c.html#a3fdd42ea34070a54e696b3adc28c4be3">top</a>, <a class="code" href="../../d0/d80/struct_onig_token.html">OnigToken</a>* <a class="code" href="../../d5/d11/ripper_8c.html#a2b3a335d617ec14d6296ca82d3055858">tok</a>, <span class="keywordtype">int</span> <a class="code" href="../../d3/d09/ripper_8y.html#a0c940d9e4ce4cfee55d7ccf714a1303d">term</a>,
<a name="l05594"></a>05594              <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>** src, <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>* end, <a class="code" href="../../d6/dbe/struct_scan_env.html">ScanEnv</a>* env)
<a name="l05595"></a>05595 {
<a name="l05596"></a>05596   <span class="keywordtype">int</span> r;
<a name="l05597"></a>05597   <a class="code" href="../../d0/d6e/struct___node.html">Node</a> *node, **headp;
<a name="l05598"></a>05598 
<a name="l05599"></a>05599   *top = <a class="code" href="../../d3/d09/ripper_8y.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l05600"></a>05600   r = <a class="code" href="../../d6/dda/regparse_8c.html#a64f09f44b9ae1bfa821f252f69d9a14c">parse_branch</a>(&amp;node, tok, term, src, end, env);
<a name="l05601"></a>05601   <span class="keywordflow">if</span> (r &lt; 0) {
<a name="l05602"></a>05602     <a class="code" href="../../d6/dda/regparse_8c.html#aa98ee34de192fd4997906389f70f4808">onig_node_free</a>(node);
<a name="l05603"></a>05603     <span class="keywordflow">return</span> r;
<a name="l05604"></a>05604   }
<a name="l05605"></a>05605 
<a name="l05606"></a>05606   <span class="keywordflow">if</span> (r == term) {
<a name="l05607"></a>05607     *top = node;
<a name="l05608"></a>05608   }
<a name="l05609"></a>05609   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (r == <a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250da902b0cdea9f57e86f33e1c42c38bae8a">TK_ALT</a>) {
<a name="l05610"></a>05610     *top  = <a class="code" href="../../d6/dda/regparse_8c.html#a9ee0d6fbf2d9ed077e5c5831b93444a6">onig_node_new_alt</a>(node, <a class="code" href="../../d3/d09/ripper_8y.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l05611"></a>05611     headp = &amp;(<a class="code" href="../../d1/dfc/regparse_8h.html#ac3a01065a5b7f17aad984671c730739e">NCDR</a>(*top));
<a name="l05612"></a>05612     <span class="keywordflow">while</span> (r == <a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250da902b0cdea9f57e86f33e1c42c38bae8a">TK_ALT</a>) {
<a name="l05613"></a>05613       r = <a class="code" href="../../d6/dda/regparse_8c.html#af1214620e9e6133cd463d363f2cb332f">fetch_token</a>(tok, src, end, env);
<a name="l05614"></a>05614       <span class="keywordflow">if</span> (r &lt; 0) <span class="keywordflow">return</span> r;
<a name="l05615"></a>05615       r = <a class="code" href="../../d6/dda/regparse_8c.html#a64f09f44b9ae1bfa821f252f69d9a14c">parse_branch</a>(&amp;node, tok, term, src, end, env);
<a name="l05616"></a>05616       <span class="keywordflow">if</span> (r &lt; 0) {
<a name="l05617"></a>05617         <a class="code" href="../../d6/dda/regparse_8c.html#aa98ee34de192fd4997906389f70f4808">onig_node_free</a>(node);
<a name="l05618"></a>05618         <span class="keywordflow">return</span> r;
<a name="l05619"></a>05619       }
<a name="l05620"></a>05620 
<a name="l05621"></a>05621       *headp = <a class="code" href="../../d6/dda/regparse_8c.html#a9ee0d6fbf2d9ed077e5c5831b93444a6">onig_node_new_alt</a>(node, <a class="code" href="../../d3/d09/ripper_8y.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l05622"></a>05622       headp = &amp;(<a class="code" href="../../d1/dfc/regparse_8h.html#ac3a01065a5b7f17aad984671c730739e">NCDR</a>(*headp));
<a name="l05623"></a>05623     }
<a name="l05624"></a>05624 
<a name="l05625"></a>05625     <span class="keywordflow">if</span> (tok-&gt;<a class="code" href="../../d0/d80/struct_onig_token.html#a46f3343f204ac67de13f0a774284e476">type</a> != (<span class="keyword">enum</span> <a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250d">TokenSyms</a> )term)
<a name="l05626"></a>05626       <span class="keywordflow">goto</span> <a class="code" href="../../d5/df2/win32_8c.html#a6ce68847c12434f60d1b2654a3dc3409">err</a>;
<a name="l05627"></a>05627   }
<a name="l05628"></a>05628   <span class="keywordflow">else</span> {
<a name="l05629"></a>05629     <a class="code" href="../../d6/dda/regparse_8c.html#aa98ee34de192fd4997906389f70f4808">onig_node_free</a>(node);
<a name="l05630"></a>05630   <a class="code" href="../../d5/df2/win32_8c.html#a6ce68847c12434f60d1b2654a3dc3409">err</a>:
<a name="l05631"></a>05631     <span class="keywordflow">if</span> (term == <a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250da2abb18f0f4ef734b4ce575c044b4e1e7">TK_SUBEXP_CLOSE</a>)
<a name="l05632"></a>05632       <span class="keywordflow">return</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#ad7337f61aadafdaaffa6883966f79e0e">ONIGERR_END_PATTERN_WITH_UNMATCHED_PARENTHESIS</a>;
<a name="l05633"></a>05633     <span class="keywordflow">else</span>
<a name="l05634"></a>05634       <span class="keywordflow">return</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#a4067ac325df2d4bb0b4d2e692c257a49">ONIGERR_PARSER_BUG</a>;
<a name="l05635"></a>05635   }
<a name="l05636"></a>05636 
<a name="l05637"></a>05637   <span class="keywordflow">return</span> r;
<a name="l05638"></a>05638 }
<a name="l05639"></a>05639 
<a name="l05640"></a>05640 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l05641"></a><a class="code" href="../../d6/dda/regparse_8c.html#a5a449e33309f56a9843b4d53a15fa957">05641</a> <a class="code" href="../../d6/dda/regparse_8c.html#a5a449e33309f56a9843b4d53a15fa957">parse_regexp</a>(<a class="code" href="../../d0/d6e/struct___node.html">Node</a>** <a class="code" href="../../d6/da0/nkf-utf8_2nkf_8c.html#a3fdd42ea34070a54e696b3adc28c4be3">top</a>, <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>** src, <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>* end, <a class="code" href="../../d6/dbe/struct_scan_env.html">ScanEnv</a>* env)
<a name="l05642"></a>05642 {
<a name="l05643"></a>05643   <span class="keywordtype">int</span> r;
<a name="l05644"></a>05644   <a class="code" href="../../d0/d80/struct_onig_token.html">OnigToken</a> <a class="code" href="../../d5/d11/ripper_8c.html#a2b3a335d617ec14d6296ca82d3055858">tok</a>;
<a name="l05645"></a>05645 
<a name="l05646"></a>05646   r = <a class="code" href="../../d6/dda/regparse_8c.html#af1214620e9e6133cd463d363f2cb332f">fetch_token</a>(&amp;tok, src, end, env);
<a name="l05647"></a>05647   <span class="keywordflow">if</span> (r &lt; 0) <span class="keywordflow">return</span> r;
<a name="l05648"></a>05648   r = <a class="code" href="../../d6/dda/regparse_8c.html#a3822726195b34935bce3ca92fe4d8085">parse_subexp</a>(top, &amp;tok, <a class="code" href="../../d6/dda/regparse_8c.html#abdbce4de6f29a432a816baee4cce250da4b2acbe6a651813a07506f06d624ac3b">TK_EOT</a>, src, end, env);
<a name="l05649"></a>05649   <span class="keywordflow">if</span> (r &lt; 0) <span class="keywordflow">return</span> r;
<a name="l05650"></a>05650   <span class="keywordflow">return</span> 0;
<a name="l05651"></a>05651 }
<a name="l05652"></a>05652 
<a name="l05653"></a>05653 <span class="keyword">extern</span> <span class="keywordtype">int</span>
<a name="l05654"></a><a class="code" href="../../d6/dda/regparse_8c.html#a65633994c3490b701c540cdf9c54e0ed">05654</a> <a class="code" href="../../d6/dda/regparse_8c.html#a65633994c3490b701c540cdf9c54e0ed">onig_parse_make_tree</a>(<a class="code" href="../../d0/d6e/struct___node.html">Node</a>** root, <span class="keyword">const</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>* pattern, <span class="keyword">const</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>* end,
<a name="l05655"></a>05655                      <a class="code" href="../../db/d0e/structre__pattern__buffer.html">regex_t</a>* reg, <a class="code" href="../../d6/dbe/struct_scan_env.html">ScanEnv</a>* env)
<a name="l05656"></a>05656 {
<a name="l05657"></a>05657   <span class="keywordtype">int</span> r;
<a name="l05658"></a>05658   <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>* p;
<a name="l05659"></a>05659 
<a name="l05660"></a>05660 <span class="preprocessor">#ifdef USE_NAMED_GROUP</span>
<a name="l05661"></a>05661 <span class="preprocessor"></span>  <a class="code" href="../../d6/dda/regparse_8c.html#a4fe174e6f8a47f1532a18bb4f93f622e">names_clear</a>(reg);
<a name="l05662"></a>05662 <span class="preprocessor">#endif</span>
<a name="l05663"></a>05663 <span class="preprocessor"></span>
<a name="l05664"></a>05664   <a class="code" href="../../d6/dda/regparse_8c.html#a178bdeffafbd3fe240bba6c12acfa5f1">scan_env_clear</a>(env);
<a name="l05665"></a>05665   env-&gt;<a class="code" href="../../d6/dbe/struct_scan_env.html#a1a7599f3079dfc7ab6d0b317f0f37d93">option</a>         = reg-&gt;<a class="code" href="../../db/d0e/structre__pattern__buffer.html#ae696111fa040a69294344d08baf062b4">options</a>;
<a name="l05666"></a>05666   env-&gt;<a class="code" href="../../d6/dbe/struct_scan_env.html#abf6865ae87b1bbad0341c78bf44199e1">case_fold_flag</a> = reg-&gt;<a class="code" href="../../db/d0e/structre__pattern__buffer.html#a4c22ffab8b6aec7bfa1fc8ccda3a1a27">case_fold_flag</a>;
<a name="l05667"></a>05667   env-&gt;<a class="code" href="../../d6/dbe/struct_scan_env.html#a97f766db4ac9dabc9d173bf99fbcc11b">enc</a>            = reg-&gt;<a class="code" href="../../db/d0e/structre__pattern__buffer.html#a1857fd68f4ca091d03855fa49b449080">enc</a>;
<a name="l05668"></a>05668   env-&gt;<a class="code" href="../../d6/dbe/struct_scan_env.html#ae5c4502ad7b7a4a418eda464919d2bda">syntax</a>         = reg-&gt;<a class="code" href="../../db/d0e/structre__pattern__buffer.html#a5b52ffc15e914d2414c4c13f94b776d2">syntax</a>;
<a name="l05669"></a>05669   env-&gt;<a class="code" href="../../d6/dbe/struct_scan_env.html#af50cd3b4f33598bb18cd17465186775e">pattern</a>        = (<a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>* )pattern;
<a name="l05670"></a>05670   env-&gt;<a class="code" href="../../d6/dbe/struct_scan_env.html#a4181f23bd0ae880c5e3f0dff09e71277">pattern_end</a>    = (<a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>* )end;
<a name="l05671"></a>05671   env-&gt;<a class="code" href="../../d6/dbe/struct_scan_env.html#ae4606d4fccc90f08112b577ef1822eac">reg</a>            = reg;
<a name="l05672"></a>05672 
<a name="l05673"></a>05673   *root = <a class="code" href="../../d3/d09/ripper_8y.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l05674"></a>05674   p = (<a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>* )pattern;
<a name="l05675"></a>05675   r = <a class="code" href="../../d6/dda/regparse_8c.html#a5a449e33309f56a9843b4d53a15fa957">parse_regexp</a>(root, &amp;p, (<a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>* )end, env);
<a name="l05676"></a>05676   reg-&gt;<a class="code" href="../../db/d0e/structre__pattern__buffer.html#aaeb8694dde3a66fd839603fede774ca5">num_mem</a> = env-&gt;<a class="code" href="../../d6/dbe/struct_scan_env.html#a5f71c0a538e047bc63962df55ff304b0">num_mem</a>;
<a name="l05677"></a>05677   <span class="keywordflow">return</span> r;
<a name="l05678"></a>05678 }
<a name="l05679"></a>05679 
<a name="l05680"></a>05680 <span class="keyword">extern</span> <span class="keywordtype">void</span>
<a name="l05681"></a><a class="code" href="../../d6/dda/regparse_8c.html#a8d6d95d9c113545baa16fe1ff3d96191">05681</a> <a class="code" href="../../d6/dda/regparse_8c.html#a8d6d95d9c113545baa16fe1ff3d96191">onig_scan_env_set_error_string</a>(<a class="code" href="../../d6/dbe/struct_scan_env.html">ScanEnv</a>* env, <span class="keywordtype">int</span> ecode ARG_UNUSED,
<a name="l05682"></a>05682                                 <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>* arg, <a class="code" href="../../d8/db3/oniguruma_8h.html#a5d08c75474105d0e4acc21cd56769904">UChar</a>* arg_end)
<a name="l05683"></a>05683 {
<a name="l05684"></a>05684   env-&gt;<a class="code" href="../../d6/dbe/struct_scan_env.html#a0b7bcb0b7b0237b6e29edf1a46a37c7f">error</a>     = arg;
<a name="l05685"></a>05685   env-&gt;<a class="code" href="../../d6/dbe/struct_scan_env.html#a690ca18c42c8090f932ffa64f38ad1a9">error_end</a> = arg_end;
<a name="l05686"></a>05686 }
<a name="l05687"></a>05687 
</pre></div></div>
<hr size="1"/><address style="text-align: right;"><small>Generated on 1 Mar 2013 for Ruby by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
