<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Ruby: string.c Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="../../index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="../../files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="../../globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<h1>string.c</h1><a href="../../d1/db0/string_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/**********************************************************************</span>
<a name="l00002"></a>00002 <span class="comment"></span>
<a name="l00003"></a>00003 <span class="comment">  string.c -</span>
<a name="l00004"></a>00004 <span class="comment"></span>
<a name="l00005"></a>00005 <span class="comment">  $Author: usa $</span>
<a name="l00006"></a>00006 <span class="comment">  created at: Mon Aug  9 17:12:58 JST 1993</span>
<a name="l00007"></a>00007 <span class="comment"></span>
<a name="l00008"></a>00008 <span class="comment">  Copyright (C) 1993-2007 Yukihiro Matsumoto</span>
<a name="l00009"></a>00009 <span class="comment">  Copyright (C) 2000  Network Applied Communication Laboratory, Inc.</span>
<a name="l00010"></a>00010 <span class="comment">  Copyright (C) 2000  Information-technology Promotion Agency, Japan</span>
<a name="l00011"></a>00011 <span class="comment"></span>
<a name="l00012"></a>00012 <span class="comment">**********************************************************************/</span>
<a name="l00013"></a>00013 
<a name="l00014"></a>00014 <span class="preprocessor">#include &quot;<a class="code" href="../../de/de6/ruby_2ruby_8h.html">ruby/ruby.h</a>&quot;</span>
<a name="l00015"></a>00015 <span class="preprocessor">#include &quot;<a class="code" href="../../db/db6/re_8h.html">ruby/re.h</a>&quot;</span>
<a name="l00016"></a>00016 <span class="preprocessor">#include &quot;<a class="code" href="../../d5/de3/encoding_8h.html">ruby/encoding.h</a>&quot;</span>
<a name="l00017"></a>00017 <span class="preprocessor">#include &quot;<a class="code" href="../../db/dde/internal_8h.html">internal.h</a>&quot;</span>
<a name="l00018"></a>00018 <span class="preprocessor">#include &lt;assert.h&gt;</span>
<a name="l00019"></a>00019 
<a name="l00020"></a><a class="code" href="../../d1/db0/string_8c.html#a84a2ca0496ad2a7c4852c539acb90180">00020</a> <span class="preprocessor">#define BEG(no) (regs-&gt;beg[(no)])</span>
<a name="l00021"></a><a class="code" href="../../d1/db0/string_8c.html#a929c3af0864e28922d4e442a4dcfbe7c">00021</a> <span class="preprocessor"></span><span class="preprocessor">#define END(no) (regs-&gt;end[(no)])</span>
<a name="l00022"></a>00022 <span class="preprocessor"></span>
<a name="l00023"></a>00023 <span class="preprocessor">#include &lt;math.h&gt;</span>
<a name="l00024"></a>00024 <span class="preprocessor">#include &lt;ctype.h&gt;</span>
<a name="l00025"></a>00025 
<a name="l00026"></a>00026 <span class="preprocessor">#ifdef HAVE_UNISTD_H</span>
<a name="l00027"></a>00027 <span class="preprocessor"></span><span class="preprocessor">#include &lt;unistd.h&gt;</span>
<a name="l00028"></a>00028 <span class="preprocessor">#endif</span>
<a name="l00029"></a>00029 <span class="preprocessor"></span>
<a name="l00030"></a><a class="code" href="../../d1/db0/string_8c.html#a4ac8fee05a285361c33a2b0d9c2d555c">00030</a> <span class="preprocessor">#define numberof(array) (int)(sizeof(array) / sizeof((array)[0]))</span>
<a name="l00031"></a>00031 <span class="preprocessor"></span>
<a name="l00032"></a>00032 <span class="preprocessor">#undef rb_str_new_cstr</span>
<a name="l00033"></a>00033 <span class="preprocessor"></span><span class="preprocessor">#undef rb_tainted_str_new_cstr</span>
<a name="l00034"></a>00034 <span class="preprocessor"></span><span class="preprocessor">#undef rb_usascii_str_new_cstr</span>
<a name="l00035"></a>00035 <span class="preprocessor"></span><span class="preprocessor">#undef rb_external_str_new_cstr</span>
<a name="l00036"></a>00036 <span class="preprocessor"></span><span class="preprocessor">#undef rb_locale_str_new_cstr</span>
<a name="l00037"></a>00037 <span class="preprocessor"></span><span class="preprocessor">#undef rb_str_new2</span>
<a name="l00038"></a>00038 <span class="preprocessor"></span><span class="preprocessor">#undef rb_str_new3</span>
<a name="l00039"></a>00039 <span class="preprocessor"></span><span class="preprocessor">#undef rb_str_new4</span>
<a name="l00040"></a>00040 <span class="preprocessor"></span><span class="preprocessor">#undef rb_str_new5</span>
<a name="l00041"></a>00041 <span class="preprocessor"></span><span class="preprocessor">#undef rb_tainted_str_new2</span>
<a name="l00042"></a>00042 <span class="preprocessor"></span><span class="preprocessor">#undef rb_usascii_str_new2</span>
<a name="l00043"></a>00043 <span class="preprocessor"></span><span class="preprocessor">#undef rb_str_dup_frozen</span>
<a name="l00044"></a>00044 <span class="preprocessor"></span><span class="preprocessor">#undef rb_str_buf_new_cstr</span>
<a name="l00045"></a>00045 <span class="preprocessor"></span><span class="preprocessor">#undef rb_str_buf_new2</span>
<a name="l00046"></a>00046 <span class="preprocessor"></span><span class="preprocessor">#undef rb_str_buf_cat2</span>
<a name="l00047"></a>00047 <span class="preprocessor"></span><span class="preprocessor">#undef rb_str_cat2</span>
<a name="l00048"></a>00048 <span class="preprocessor"></span>
<a name="l00049"></a>00049 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <a class="code" href="../../d1/db0/string_8c.html#ac5e2b2bfc50705ecea86d699d1a8dc15">rb_str_clear</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str);
<a name="l00050"></a>00050 
<a name="l00051"></a><a class="code" href="../../d1/db0/string_8c.html#af8ebd587fcc7ee588f451fc8722b8294">00051</a> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a7d36c9c3e9faa34c27eb7f2eb9c874a8">rb_cString</a>;
<a name="l00052"></a><a class="code" href="../../d1/db0/string_8c.html#aa46556fe4d2eb25d24b2f1feca3e792e">00052</a> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a9bb99c1fc98bd5e0da36ac70200081b6">rb_cSymbol</a>;
<a name="l00053"></a>00053 
<a name="l00054"></a><a class="code" href="../../d1/db0/string_8c.html#a4a171b45f691311eb103b8e563b855d7">00054</a> <span class="preprocessor">#define RUBY_MAX_CHAR_LEN 16</span>
<a name="l00055"></a><a class="code" href="../../d1/db0/string_8c.html#abd8cc5329f77d70abfffe4284503e3cd">00055</a> <span class="preprocessor"></span><span class="preprocessor">#define STR_TMPLOCK FL_USER7</span>
<a name="l00056"></a><a class="code" href="../../d1/db0/string_8c.html#ac8d3bdd1bdb620a40ed913619cdc7c6b">00056</a> <span class="preprocessor"></span><span class="preprocessor">#define STR_NOEMBED FL_USER1</span>
<a name="l00057"></a><a class="code" href="../../d1/db0/string_8c.html#a89c12e402b59050d31a1c422c520d601">00057</a> <span class="preprocessor"></span><span class="preprocessor">#define STR_SHARED  FL_USER2 </span><span class="comment">/* = ELTS_SHARED */</span>
<a name="l00058"></a><a class="code" href="../../d1/db0/string_8c.html#a2f2bd1a90a891cf8697328b4ba8d4d54">00058</a> <span class="preprocessor">#define STR_ASSOC   FL_USER3</span>
<a name="l00059"></a><a class="code" href="../../d1/db0/string_8c.html#a47a46c073102a116dc86fbe598a8694e">00059</a> <span class="preprocessor"></span><span class="preprocessor">#define STR_SHARED_P(s) FL_ALL((s), STR_NOEMBED|ELTS_SHARED)</span>
<a name="l00060"></a><a class="code" href="../../d1/db0/string_8c.html#a6fc2cd334583cde7a99b5753c6ff18a4">00060</a> <span class="preprocessor"></span><span class="preprocessor">#define STR_ASSOC_P(s)  FL_ALL((s), STR_NOEMBED|STR_ASSOC)</span>
<a name="l00061"></a><a class="code" href="../../d1/db0/string_8c.html#a082d04ab7df240d55d9c8126a81cc9b6">00061</a> <span class="preprocessor"></span><span class="preprocessor">#define STR_NOCAPA  (STR_NOEMBED|ELTS_SHARED|STR_ASSOC)</span>
<a name="l00062"></a><a class="code" href="../../d1/db0/string_8c.html#a2e4889499fa17d4a63dc76b35f4b208e">00062</a> <span class="preprocessor"></span><span class="preprocessor">#define STR_NOCAPA_P(s) (FL_TEST((s),STR_NOEMBED) &amp;&amp; FL_ANY((s),ELTS_SHARED|STR_ASSOC))</span>
<a name="l00063"></a><a class="code" href="../../d1/db0/string_8c.html#a6b683fdd88d6effd1f5391040bc32b3f">00063</a> <span class="preprocessor"></span><span class="preprocessor">#define STR_UNSET_NOCAPA(s) do {\</span>
<a name="l00064"></a>00064 <span class="preprocessor">    if (FL_TEST((s),STR_NOEMBED)) FL_UNSET((s),(ELTS_SHARED|STR_ASSOC));\</span>
<a name="l00065"></a>00065 <span class="preprocessor">} while (0)</span>
<a name="l00066"></a>00066 <span class="preprocessor"></span>
<a name="l00067"></a>00067 
<a name="l00068"></a><a class="code" href="../../d1/db0/string_8c.html#a220a3ea405f8427a2b119e8cda01524e">00068</a> <span class="preprocessor">#define STR_SET_NOEMBED(str) do {\</span>
<a name="l00069"></a>00069 <span class="preprocessor">    FL_SET((str), STR_NOEMBED);\</span>
<a name="l00070"></a>00070 <span class="preprocessor">    STR_SET_EMBED_LEN((str), 0);\</span>
<a name="l00071"></a>00071 <span class="preprocessor">} while (0)</span>
<a name="l00072"></a><a class="code" href="../../d1/db0/string_8c.html#a598a41ca866cde6d9854bf77f48b006d">00072</a> <span class="preprocessor"></span><span class="preprocessor">#define STR_SET_EMBED(str) FL_UNSET((str), STR_NOEMBED)</span>
<a name="l00073"></a><a class="code" href="../../d1/db0/string_8c.html#a0823acc422a6a849b53cf3ae0465b543">00073</a> <span class="preprocessor"></span><span class="preprocessor">#define STR_EMBED_P(str) (!FL_TEST((str), STR_NOEMBED))</span>
<a name="l00074"></a><a class="code" href="../../d1/db0/string_8c.html#ac1f52d89a2e4d0dda456490dcfe70993">00074</a> <span class="preprocessor"></span><span class="preprocessor">#define STR_SET_EMBED_LEN(str, n) do { \</span>
<a name="l00075"></a>00075 <span class="preprocessor">    long tmp_n = (n);\</span>
<a name="l00076"></a>00076 <span class="preprocessor">    RBASIC(str)-&gt;flags &amp;= ~RSTRING_EMBED_LEN_MASK;\</span>
<a name="l00077"></a>00077 <span class="preprocessor">    RBASIC(str)-&gt;flags |= (tmp_n) &lt;&lt; RSTRING_EMBED_LEN_SHIFT;\</span>
<a name="l00078"></a>00078 <span class="preprocessor">} while (0)</span>
<a name="l00079"></a>00079 <span class="preprocessor"></span>
<a name="l00080"></a><a class="code" href="../../d1/db0/string_8c.html#a056c7c0a74c83ccdb5a160bbdcbf8c3b">00080</a> <span class="preprocessor">#define STR_SET_LEN(str, n) do { \</span>
<a name="l00081"></a>00081 <span class="preprocessor">    if (STR_EMBED_P(str)) {\</span>
<a name="l00082"></a>00082 <span class="preprocessor">        STR_SET_EMBED_LEN((str), (n));\</span>
<a name="l00083"></a>00083 <span class="preprocessor">    }\</span>
<a name="l00084"></a>00084 <span class="preprocessor">    else {\</span>
<a name="l00085"></a>00085 <span class="preprocessor">        RSTRING(str)-&gt;as.heap.len = (n);\</span>
<a name="l00086"></a>00086 <span class="preprocessor">    }\</span>
<a name="l00087"></a>00087 <span class="preprocessor">} while (0)</span>
<a name="l00088"></a>00088 <span class="preprocessor"></span>
<a name="l00089"></a><a class="code" href="../../d1/db0/string_8c.html#ad6f5ad03ae5244b7ac7cab569eac3e65">00089</a> <span class="preprocessor">#define STR_DEC_LEN(str) do {\</span>
<a name="l00090"></a>00090 <span class="preprocessor">    if (STR_EMBED_P(str)) {\</span>
<a name="l00091"></a>00091 <span class="preprocessor">        long n = RSTRING_LEN(str);\</span>
<a name="l00092"></a>00092 <span class="preprocessor">        n--;\</span>
<a name="l00093"></a>00093 <span class="preprocessor">        STR_SET_EMBED_LEN((str), n);\</span>
<a name="l00094"></a>00094 <span class="preprocessor">    }\</span>
<a name="l00095"></a>00095 <span class="preprocessor">    else {\</span>
<a name="l00096"></a>00096 <span class="preprocessor">        RSTRING(str)-&gt;as.heap.len--;\</span>
<a name="l00097"></a>00097 <span class="preprocessor">    }\</span>
<a name="l00098"></a>00098 <span class="preprocessor">} while (0)</span>
<a name="l00099"></a>00099 <span class="preprocessor"></span>
<a name="l00100"></a><a class="code" href="../../d1/db0/string_8c.html#ab8dafff9534eaf6545585223ada6b1c8">00100</a> <span class="preprocessor">#define RESIZE_CAPA(str,capacity) do {\</span>
<a name="l00101"></a>00101 <span class="preprocessor">    if (STR_EMBED_P(str)) {\</span>
<a name="l00102"></a>00102 <span class="preprocessor">        if ((capacity) &gt; RSTRING_EMBED_LEN_MAX) {\</span>
<a name="l00103"></a>00103 <span class="preprocessor">            char *tmp = ALLOC_N(char, (capacity)+1);\</span>
<a name="l00104"></a>00104 <span class="preprocessor">            memcpy(tmp, RSTRING_PTR(str), RSTRING_LEN(str));\</span>
<a name="l00105"></a>00105 <span class="preprocessor">            RSTRING(str)-&gt;as.heap.ptr = tmp;\</span>
<a name="l00106"></a>00106 <span class="preprocessor">            RSTRING(str)-&gt;as.heap.len = RSTRING_LEN(str);\</span>
<a name="l00107"></a>00107 <span class="preprocessor">            STR_SET_NOEMBED(str);\</span>
<a name="l00108"></a>00108 <span class="preprocessor">            RSTRING(str)-&gt;as.heap.aux.capa = (capacity);\</span>
<a name="l00109"></a>00109 <span class="preprocessor">        }\</span>
<a name="l00110"></a>00110 <span class="preprocessor">    }\</span>
<a name="l00111"></a>00111 <span class="preprocessor">    else {\</span>
<a name="l00112"></a>00112 <span class="preprocessor">        REALLOC_N(RSTRING(str)-&gt;as.heap.ptr, char, (capacity)+1);\</span>
<a name="l00113"></a>00113 <span class="preprocessor">        if (!STR_NOCAPA_P(str))\</span>
<a name="l00114"></a>00114 <span class="preprocessor">            RSTRING(str)-&gt;as.heap.aux.capa = (capacity);\</span>
<a name="l00115"></a>00115 <span class="preprocessor">    }\</span>
<a name="l00116"></a>00116 <span class="preprocessor">} while (0)</span>
<a name="l00117"></a>00117 <span class="preprocessor"></span>
<a name="l00118"></a><a class="code" href="../../d1/db0/string_8c.html#a053ebe2487386654339f4de623e5d3a2">00118</a> <span class="preprocessor">#define is_ascii_string(str) (rb_enc_str_coderange(str) == ENC_CODERANGE_7BIT)</span>
<a name="l00119"></a><a class="code" href="../../d1/db0/string_8c.html#a8de8d2f6479866e76eeb56f5044fa583">00119</a> <span class="preprocessor"></span><span class="preprocessor">#define is_broken_string(str) (rb_enc_str_coderange(str) == ENC_CODERANGE_BROKEN)</span>
<a name="l00120"></a>00120 <span class="preprocessor"></span>
<a name="l00121"></a><a class="code" href="../../d1/db0/string_8c.html#a123891f9f9b0c87d15621d93b4fa9c41">00121</a> <span class="preprocessor">#define STR_ENC_GET(str) rb_enc_from_index(ENCODING_GET(str))</span>
<a name="l00122"></a>00122 <span class="preprocessor"></span>
<a name="l00123"></a>00123 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span>
<a name="l00124"></a><a class="code" href="../../d1/db0/string_8c.html#a5ab3c8112c2ec6943bdae8a2036fca02">00124</a> <a class="code" href="../../d1/db0/string_8c.html#a5ab3c8112c2ec6943bdae8a2036fca02">single_byte_optimizable</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str)
<a name="l00125"></a>00125 {
<a name="l00126"></a>00126     <a class="code" href="../../d1/d7b/struct_onig_encoding_type_s_t.html">rb_encoding</a> *enc;
<a name="l00127"></a>00127 
<a name="l00128"></a>00128     <span class="comment">/* Conservative.  It may be ENC_CODERANGE_UNKNOWN. */</span>
<a name="l00129"></a>00129     <span class="keywordflow">if</span> (<a class="code" href="../../d5/de3/encoding_8h.html#a5901233f6f9004aebbdeccdd33cf449f">ENC_CODERANGE</a>(str) == <a class="code" href="../../d5/de3/encoding_8h.html#a0a0e73a2d98205044e1ad19432502c5b">ENC_CODERANGE_7BIT</a>)
<a name="l00130"></a>00130         <span class="keywordflow">return</span> 1;
<a name="l00131"></a>00131 
<a name="l00132"></a>00132     enc = <a class="code" href="../../d1/db0/string_8c.html#a123891f9f9b0c87d15621d93b4fa9c41">STR_ENC_GET</a>(str);
<a name="l00133"></a>00133     <span class="keywordflow">if</span> (<a class="code" href="../../d5/de3/encoding_8h.html#a6b942f8457214c49fcf8541c60a38306">rb_enc_mbmaxlen</a>(enc) == 1)
<a name="l00134"></a>00134         <span class="keywordflow">return</span> 1;
<a name="l00135"></a>00135 
<a name="l00136"></a>00136     <span class="comment">/* Conservative.  Possibly single byte.</span>
<a name="l00137"></a>00137 <span class="comment">     * &quot;\xa1&quot; in Shift_JIS for example. */</span>
<a name="l00138"></a>00138     <span class="keywordflow">return</span> 0;
<a name="l00139"></a>00139 }
<a name="l00140"></a>00140 
<a name="l00141"></a><a class="code" href="../../d1/db0/string_8c.html#a7a6054e9a1acb4efb2c5b48bf60b927c">00141</a> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <a class="code" href="../../db/d2e/intern_8h.html#ade300b3f8270fc26be5821ad806615ff">rb_fs</a>;
<a name="l00142"></a>00142 
<a name="l00143"></a>00143 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *
<a name="l00144"></a><a class="code" href="../../d1/db0/string_8c.html#a09d26a98b1b2071c40e71eb556d87814">00144</a> <a class="code" href="../../d1/db0/string_8c.html#a09d26a98b1b2071c40e71eb556d87814">search_nonascii</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *p, <span class="keyword">const</span> <span class="keywordtype">char</span> *e)
<a name="l00145"></a>00145 {
<a name="l00146"></a>00146 <span class="preprocessor">#if SIZEOF_VALUE == 8</span>
<a name="l00147"></a>00147 <span class="preprocessor"></span><span class="preprocessor"># define NONASCII_MASK 0x8080808080808080ULL</span>
<a name="l00148"></a>00148 <span class="preprocessor"></span><span class="preprocessor">#elif SIZEOF_VALUE == 4</span>
<a name="l00149"></a>00149 <span class="preprocessor"></span><span class="preprocessor"># define NONASCII_MASK 0x80808080UL</span>
<a name="l00150"></a>00150 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00151"></a>00151 <span class="preprocessor"></span><span class="preprocessor">#ifdef NONASCII_MASK</span>
<a name="l00152"></a>00152 <span class="preprocessor"></span>    <span class="keywordflow">if</span> ((<span class="keywordtype">int</span>)<span class="keyword">sizeof</span>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>) * 2 &lt; e - p) {
<a name="l00153"></a>00153         <span class="keyword">const</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> *s, *t;
<a name="l00154"></a>00154         <span class="keyword">const</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> lowbits = <span class="keyword">sizeof</span>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>) - 1;
<a name="l00155"></a>00155         s = (<span class="keyword">const</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>*)(~lowbits &amp; ((<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>)p + lowbits));
<a name="l00156"></a>00156         <span class="keywordflow">while</span> (p &lt; (<span class="keyword">const</span> <span class="keywordtype">char</span> *)s) {
<a name="l00157"></a>00157             <span class="keywordflow">if</span> (!<a class="code" href="../../de/de6/ruby_2ruby_8h.html#af96ff81718c3c27b342b5958fac6cb7e">ISASCII</a>(*p))
<a name="l00158"></a>00158                 <span class="keywordflow">return</span> p;
<a name="l00159"></a>00159             p++;
<a name="l00160"></a>00160         }
<a name="l00161"></a>00161         t = (<span class="keyword">const</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>*)(~lowbits &amp; (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>)e);
<a name="l00162"></a>00162         <span class="keywordflow">while</span> (s &lt; t) {
<a name="l00163"></a>00163             <span class="keywordflow">if</span> (*s &amp; NONASCII_MASK) {
<a name="l00164"></a>00164                 t = s;
<a name="l00165"></a>00165                 <span class="keywordflow">break</span>;
<a name="l00166"></a>00166             }
<a name="l00167"></a>00167             s++;
<a name="l00168"></a>00168         }
<a name="l00169"></a>00169         p = (<span class="keyword">const</span> <span class="keywordtype">char</span> *)t;
<a name="l00170"></a>00170     }
<a name="l00171"></a>00171 <span class="preprocessor">#endif</span>
<a name="l00172"></a>00172 <span class="preprocessor"></span>    <span class="keywordflow">while</span> (p &lt; e) {
<a name="l00173"></a>00173         <span class="keywordflow">if</span> (!<a class="code" href="../../de/de6/ruby_2ruby_8h.html#af96ff81718c3c27b342b5958fac6cb7e">ISASCII</a>(*p))
<a name="l00174"></a>00174             <span class="keywordflow">return</span> p;
<a name="l00175"></a>00175         p++;
<a name="l00176"></a>00176     }
<a name="l00177"></a>00177     <span class="keywordflow">return</span> <a class="code" href="../../d3/d09/ripper_8y.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00178"></a>00178 }
<a name="l00179"></a>00179 
<a name="l00180"></a>00180 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l00181"></a><a class="code" href="../../d1/db0/string_8c.html#af47bc9a7bbb51656cecb095780518d7f">00181</a> <a class="code" href="../../d1/db0/string_8c.html#af47bc9a7bbb51656cecb095780518d7f">coderange_scan</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *p, <span class="keywordtype">long</span> <a class="code" href="../../d3/d15/name2ctype_8h.html#aed1cc4dca5d94cb452f79691f54f7423">len</a>, <a class="code" href="../../d1/d7b/struct_onig_encoding_type_s_t.html">rb_encoding</a> *enc)
<a name="l00182"></a>00182 {
<a name="l00183"></a>00183     <span class="keyword">const</span> <span class="keywordtype">char</span> *e = p + len;
<a name="l00184"></a>00184 
<a name="l00185"></a>00185     <span class="keywordflow">if</span> (<a class="code" href="../../d5/de3/encoding_8h.html#ad23f205c614c95726b919b2a8a1ac573">rb_enc_to_index</a>(enc) == 0) {
<a name="l00186"></a>00186         <span class="comment">/* enc is ASCII-8BIT.  ASCII-8BIT string never be broken. */</span>
<a name="l00187"></a>00187         p = <a class="code" href="../../d1/db0/string_8c.html#a09d26a98b1b2071c40e71eb556d87814">search_nonascii</a>(p, e);
<a name="l00188"></a>00188         <span class="keywordflow">return</span> p ? <a class="code" href="../../d5/de3/encoding_8h.html#a0c81a12daaa1e57009d46b9d906957dc">ENC_CODERANGE_VALID</a> : <a class="code" href="../../d5/de3/encoding_8h.html#a0a0e73a2d98205044e1ad19432502c5b">ENC_CODERANGE_7BIT</a>;
<a name="l00189"></a>00189     }
<a name="l00190"></a>00190 
<a name="l00191"></a>00191     <span class="keywordflow">if</span> (<a class="code" href="../../d5/de3/encoding_8h.html#a8b18a09a3055d3006c6d5baeaa6e7c72">rb_enc_asciicompat</a>(enc)) {
<a name="l00192"></a>00192         p = <a class="code" href="../../d1/db0/string_8c.html#a09d26a98b1b2071c40e71eb556d87814">search_nonascii</a>(p, e);
<a name="l00193"></a>00193         <span class="keywordflow">if</span> (!p) {
<a name="l00194"></a>00194             <span class="keywordflow">return</span> <a class="code" href="../../d5/de3/encoding_8h.html#a0a0e73a2d98205044e1ad19432502c5b">ENC_CODERANGE_7BIT</a>;
<a name="l00195"></a>00195         }
<a name="l00196"></a>00196         <span class="keywordflow">while</span> (p &lt; e) {
<a name="l00197"></a>00197             <span class="keywordtype">int</span> ret = <a class="code" href="../../d5/db5/encoding_8c.html#a0c6003b6aeaed218d841974b00c95870">rb_enc_precise_mbclen</a>(p, e, enc);
<a name="l00198"></a>00198             <span class="keywordflow">if</span> (!<a class="code" href="../../d5/de3/encoding_8h.html#ac3dcc15c5ed42d6590e1c1f91b74165c">MBCLEN_CHARFOUND_P</a>(ret)) {
<a name="l00199"></a>00199                 <span class="keywordflow">return</span> <a class="code" href="../../d5/de3/encoding_8h.html#abb86fbc02fc2b78d928825ea6d6922f9">ENC_CODERANGE_BROKEN</a>;
<a name="l00200"></a>00200             }
<a name="l00201"></a>00201             p += <a class="code" href="../../d5/de3/encoding_8h.html#a877f84ae22293dae2a8cf1e26ea5b1a6">MBCLEN_CHARFOUND_LEN</a>(ret);
<a name="l00202"></a>00202             <span class="keywordflow">if</span> (p &lt; e) {
<a name="l00203"></a>00203                 p = <a class="code" href="../../d1/db0/string_8c.html#a09d26a98b1b2071c40e71eb556d87814">search_nonascii</a>(p, e);
<a name="l00204"></a>00204                 <span class="keywordflow">if</span> (!p) {
<a name="l00205"></a>00205                     <span class="keywordflow">return</span> <a class="code" href="../../d5/de3/encoding_8h.html#a0c81a12daaa1e57009d46b9d906957dc">ENC_CODERANGE_VALID</a>;
<a name="l00206"></a>00206                 }
<a name="l00207"></a>00207             }
<a name="l00208"></a>00208         }
<a name="l00209"></a>00209         <span class="keywordflow">if</span> (e &lt; p) {
<a name="l00210"></a>00210             <span class="keywordflow">return</span> <a class="code" href="../../d5/de3/encoding_8h.html#abb86fbc02fc2b78d928825ea6d6922f9">ENC_CODERANGE_BROKEN</a>;
<a name="l00211"></a>00211         }
<a name="l00212"></a>00212         <span class="keywordflow">return</span> <a class="code" href="../../d5/de3/encoding_8h.html#a0c81a12daaa1e57009d46b9d906957dc">ENC_CODERANGE_VALID</a>;
<a name="l00213"></a>00213     }
<a name="l00214"></a>00214 
<a name="l00215"></a>00215     <span class="keywordflow">while</span> (p &lt; e) {
<a name="l00216"></a>00216         <span class="keywordtype">int</span> ret = <a class="code" href="../../d5/db5/encoding_8c.html#a0c6003b6aeaed218d841974b00c95870">rb_enc_precise_mbclen</a>(p, e, enc);
<a name="l00217"></a>00217 
<a name="l00218"></a>00218         <span class="keywordflow">if</span> (!<a class="code" href="../../d5/de3/encoding_8h.html#ac3dcc15c5ed42d6590e1c1f91b74165c">MBCLEN_CHARFOUND_P</a>(ret)) {
<a name="l00219"></a>00219             <span class="keywordflow">return</span> <a class="code" href="../../d5/de3/encoding_8h.html#abb86fbc02fc2b78d928825ea6d6922f9">ENC_CODERANGE_BROKEN</a>;
<a name="l00220"></a>00220         }
<a name="l00221"></a>00221         p += <a class="code" href="../../d5/de3/encoding_8h.html#a877f84ae22293dae2a8cf1e26ea5b1a6">MBCLEN_CHARFOUND_LEN</a>(ret);
<a name="l00222"></a>00222     }
<a name="l00223"></a>00223     <span class="keywordflow">if</span> (e &lt; p) {
<a name="l00224"></a>00224         <span class="keywordflow">return</span> <a class="code" href="../../d5/de3/encoding_8h.html#abb86fbc02fc2b78d928825ea6d6922f9">ENC_CODERANGE_BROKEN</a>;
<a name="l00225"></a>00225     }
<a name="l00226"></a>00226     <span class="keywordflow">return</span> <a class="code" href="../../d5/de3/encoding_8h.html#a0c81a12daaa1e57009d46b9d906957dc">ENC_CODERANGE_VALID</a>;
<a name="l00227"></a>00227 }
<a name="l00228"></a>00228 
<a name="l00229"></a>00229 <span class="keywordtype">long</span>
<a name="l00230"></a><a class="code" href="../../d1/db0/string_8c.html#a123a703ed4d8976c958f237a17fcefc0">00230</a> <a class="code" href="../../d5/de3/encoding_8h.html#ac1fbec2516e7dbaafbdf8933c5ad7946">rb_str_coderange_scan_restartable</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *s, <span class="keyword">const</span> <span class="keywordtype">char</span> *e, <a class="code" href="../../d1/d7b/struct_onig_encoding_type_s_t.html">rb_encoding</a> *enc, <span class="keywordtype">int</span> *cr)
<a name="l00231"></a>00231 {
<a name="l00232"></a>00232     <span class="keyword">const</span> <span class="keywordtype">char</span> *p = s;
<a name="l00233"></a>00233 
<a name="l00234"></a>00234     <span class="keywordflow">if</span> (*cr == <a class="code" href="../../d5/de3/encoding_8h.html#abb86fbc02fc2b78d928825ea6d6922f9">ENC_CODERANGE_BROKEN</a>)
<a name="l00235"></a>00235         <span class="keywordflow">return</span> e - s;
<a name="l00236"></a>00236 
<a name="l00237"></a>00237     <span class="keywordflow">if</span> (<a class="code" href="../../d5/de3/encoding_8h.html#ad23f205c614c95726b919b2a8a1ac573">rb_enc_to_index</a>(enc) == 0) {
<a name="l00238"></a>00238         <span class="comment">/* enc is ASCII-8BIT.  ASCII-8BIT string never be broken. */</span>
<a name="l00239"></a>00239         p = <a class="code" href="../../d1/db0/string_8c.html#a09d26a98b1b2071c40e71eb556d87814">search_nonascii</a>(p, e);
<a name="l00240"></a>00240         *cr = (!p &amp;&amp; *cr != <a class="code" href="../../d5/de3/encoding_8h.html#a0c81a12daaa1e57009d46b9d906957dc">ENC_CODERANGE_VALID</a>) ? <a class="code" href="../../d5/de3/encoding_8h.html#a0a0e73a2d98205044e1ad19432502c5b">ENC_CODERANGE_7BIT</a> : <a class="code" href="../../d5/de3/encoding_8h.html#a0c81a12daaa1e57009d46b9d906957dc">ENC_CODERANGE_VALID</a>;
<a name="l00241"></a>00241         <span class="keywordflow">return</span> e - s;
<a name="l00242"></a>00242     }
<a name="l00243"></a>00243     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d5/de3/encoding_8h.html#a8b18a09a3055d3006c6d5baeaa6e7c72">rb_enc_asciicompat</a>(enc)) {
<a name="l00244"></a>00244         p = <a class="code" href="../../d1/db0/string_8c.html#a09d26a98b1b2071c40e71eb556d87814">search_nonascii</a>(p, e);
<a name="l00245"></a>00245         <span class="keywordflow">if</span> (!p) {
<a name="l00246"></a>00246             <span class="keywordflow">if</span> (*cr != <a class="code" href="../../d5/de3/encoding_8h.html#a0c81a12daaa1e57009d46b9d906957dc">ENC_CODERANGE_VALID</a>) *cr = <a class="code" href="../../d5/de3/encoding_8h.html#a0a0e73a2d98205044e1ad19432502c5b">ENC_CODERANGE_7BIT</a>;
<a name="l00247"></a>00247             <span class="keywordflow">return</span> e - s;
<a name="l00248"></a>00248         }
<a name="l00249"></a>00249         <span class="keywordflow">while</span> (p &lt; e) {
<a name="l00250"></a>00250             <span class="keywordtype">int</span> ret = <a class="code" href="../../d5/db5/encoding_8c.html#a0c6003b6aeaed218d841974b00c95870">rb_enc_precise_mbclen</a>(p, e, enc);
<a name="l00251"></a>00251             <span class="keywordflow">if</span> (!<a class="code" href="../../d5/de3/encoding_8h.html#ac3dcc15c5ed42d6590e1c1f91b74165c">MBCLEN_CHARFOUND_P</a>(ret)) {
<a name="l00252"></a>00252                 *cr = <a class="code" href="../../d5/de3/encoding_8h.html#a9be706470754634a65ed29bcd2508ee1">MBCLEN_INVALID_P</a>(ret) ? <a class="code" href="../../d5/de3/encoding_8h.html#abb86fbc02fc2b78d928825ea6d6922f9">ENC_CODERANGE_BROKEN</a>: <a class="code" href="../../d5/de3/encoding_8h.html#a60de9709709968f9627365a6cd0ff5d1">ENC_CODERANGE_UNKNOWN</a>;
<a name="l00253"></a>00253                 <span class="keywordflow">return</span> p - s;
<a name="l00254"></a>00254             }
<a name="l00255"></a>00255             p += <a class="code" href="../../d5/de3/encoding_8h.html#a877f84ae22293dae2a8cf1e26ea5b1a6">MBCLEN_CHARFOUND_LEN</a>(ret);
<a name="l00256"></a>00256             <span class="keywordflow">if</span> (p &lt; e) {
<a name="l00257"></a>00257                 p = <a class="code" href="../../d1/db0/string_8c.html#a09d26a98b1b2071c40e71eb556d87814">search_nonascii</a>(p, e);
<a name="l00258"></a>00258                 <span class="keywordflow">if</span> (!p) {
<a name="l00259"></a>00259                     *cr = <a class="code" href="../../d5/de3/encoding_8h.html#a0c81a12daaa1e57009d46b9d906957dc">ENC_CODERANGE_VALID</a>;
<a name="l00260"></a>00260                     <span class="keywordflow">return</span> e - s;
<a name="l00261"></a>00261                 }
<a name="l00262"></a>00262             }
<a name="l00263"></a>00263         }
<a name="l00264"></a>00264         *cr = e &lt; p ? <a class="code" href="../../d5/de3/encoding_8h.html#abb86fbc02fc2b78d928825ea6d6922f9">ENC_CODERANGE_BROKEN</a>: <a class="code" href="../../d5/de3/encoding_8h.html#a0c81a12daaa1e57009d46b9d906957dc">ENC_CODERANGE_VALID</a>;
<a name="l00265"></a>00265         <span class="keywordflow">return</span> p - s;
<a name="l00266"></a>00266     }
<a name="l00267"></a>00267     <span class="keywordflow">else</span> {
<a name="l00268"></a>00268         <span class="keywordflow">while</span> (p &lt; e) {
<a name="l00269"></a>00269             <span class="keywordtype">int</span> ret = <a class="code" href="../../d5/db5/encoding_8c.html#a0c6003b6aeaed218d841974b00c95870">rb_enc_precise_mbclen</a>(p, e, enc);
<a name="l00270"></a>00270             <span class="keywordflow">if</span> (!<a class="code" href="../../d5/de3/encoding_8h.html#ac3dcc15c5ed42d6590e1c1f91b74165c">MBCLEN_CHARFOUND_P</a>(ret)) {
<a name="l00271"></a>00271                 *cr = <a class="code" href="../../d5/de3/encoding_8h.html#a9be706470754634a65ed29bcd2508ee1">MBCLEN_INVALID_P</a>(ret) ? <a class="code" href="../../d5/de3/encoding_8h.html#abb86fbc02fc2b78d928825ea6d6922f9">ENC_CODERANGE_BROKEN</a>: <a class="code" href="../../d5/de3/encoding_8h.html#a60de9709709968f9627365a6cd0ff5d1">ENC_CODERANGE_UNKNOWN</a>;
<a name="l00272"></a>00272                 <span class="keywordflow">return</span> p - s;
<a name="l00273"></a>00273             }
<a name="l00274"></a>00274             p += <a class="code" href="../../d5/de3/encoding_8h.html#a877f84ae22293dae2a8cf1e26ea5b1a6">MBCLEN_CHARFOUND_LEN</a>(ret);
<a name="l00275"></a>00275         }
<a name="l00276"></a>00276         *cr = e &lt; p ? <a class="code" href="../../d5/de3/encoding_8h.html#abb86fbc02fc2b78d928825ea6d6922f9">ENC_CODERANGE_BROKEN</a>: <a class="code" href="../../d5/de3/encoding_8h.html#a0c81a12daaa1e57009d46b9d906957dc">ENC_CODERANGE_VALID</a>;
<a name="l00277"></a>00277         <span class="keywordflow">return</span> p - s;
<a name="l00278"></a>00278     }
<a name="l00279"></a>00279 }
<a name="l00280"></a>00280 
<a name="l00281"></a>00281 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span>
<a name="l00282"></a><a class="code" href="../../d1/db0/string_8c.html#ad852306abdd51379d47cb3ead62c85ab">00282</a> <a class="code" href="../../d1/db0/string_8c.html#ad852306abdd51379d47cb3ead62c85ab">str_enc_copy</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str1, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str2)
<a name="l00283"></a>00283 {
<a name="l00284"></a>00284     <a class="code" href="../../d5/db5/encoding_8c.html#a8130988e8200f6174670b44f71b7f284">rb_enc_set_index</a>(str1, <a class="code" href="../../d5/de3/encoding_8h.html#a6ba07266a084d7a480377f1472aabfd8">ENCODING_GET</a>(str2));
<a name="l00285"></a>00285 }
<a name="l00286"></a>00286 
<a name="l00287"></a>00287 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00288"></a><a class="code" href="../../d1/db0/string_8c.html#a52e3afb878f939e397b9443c8e082c54">00288</a> <a class="code" href="../../d1/db0/string_8c.html#a52e3afb878f939e397b9443c8e082c54">rb_enc_cr_str_copy_for_substr</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> dest, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> src)
<a name="l00289"></a>00289 {
<a name="l00290"></a>00290     <span class="comment">/* this function is designed for copying encoding and coderange</span>
<a name="l00291"></a>00291 <span class="comment">     * from src to new string &quot;dest&quot; which is made from the part of src.</span>
<a name="l00292"></a>00292 <span class="comment">     */</span>
<a name="l00293"></a>00293     <a class="code" href="../../d1/db0/string_8c.html#ad852306abdd51379d47cb3ead62c85ab">str_enc_copy</a>(dest, src);
<a name="l00294"></a>00294     <span class="keywordflow">switch</span> (<a class="code" href="../../d5/de3/encoding_8h.html#a5901233f6f9004aebbdeccdd33cf449f">ENC_CODERANGE</a>(src)) {
<a name="l00295"></a>00295       <span class="keywordflow">case</span> <a class="code" href="../../d5/de3/encoding_8h.html#a0a0e73a2d98205044e1ad19432502c5b">ENC_CODERANGE_7BIT</a>:
<a name="l00296"></a>00296         <a class="code" href="../../d5/de3/encoding_8h.html#aefe5772c0116cf7131a5227de7243dbc">ENC_CODERANGE_SET</a>(dest, <a class="code" href="../../d5/de3/encoding_8h.html#a0a0e73a2d98205044e1ad19432502c5b">ENC_CODERANGE_7BIT</a>);
<a name="l00297"></a>00297         <span class="keywordflow">break</span>;
<a name="l00298"></a>00298       <span class="keywordflow">case</span> <a class="code" href="../../d5/de3/encoding_8h.html#a0c81a12daaa1e57009d46b9d906957dc">ENC_CODERANGE_VALID</a>:
<a name="l00299"></a>00299         <span class="keywordflow">if</span> (!<a class="code" href="../../d5/de3/encoding_8h.html#a8b18a09a3055d3006c6d5baeaa6e7c72">rb_enc_asciicompat</a>(<a class="code" href="../../d1/db0/string_8c.html#a123891f9f9b0c87d15621d93b4fa9c41">STR_ENC_GET</a>(src)) ||
<a name="l00300"></a>00300             <a class="code" href="../../d1/db0/string_8c.html#a09d26a98b1b2071c40e71eb556d87814">search_nonascii</a>(<a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(dest), <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a35bfa2635774977edad0a16b9fdebbaf">RSTRING_END</a>(dest)))
<a name="l00301"></a>00301             <a class="code" href="../../d5/de3/encoding_8h.html#aefe5772c0116cf7131a5227de7243dbc">ENC_CODERANGE_SET</a>(dest, <a class="code" href="../../d5/de3/encoding_8h.html#a0c81a12daaa1e57009d46b9d906957dc">ENC_CODERANGE_VALID</a>);
<a name="l00302"></a>00302         <span class="keywordflow">else</span>
<a name="l00303"></a>00303             <a class="code" href="../../d5/de3/encoding_8h.html#aefe5772c0116cf7131a5227de7243dbc">ENC_CODERANGE_SET</a>(dest, <a class="code" href="../../d5/de3/encoding_8h.html#a0a0e73a2d98205044e1ad19432502c5b">ENC_CODERANGE_7BIT</a>);
<a name="l00304"></a>00304         <span class="keywordflow">break</span>;
<a name="l00305"></a>00305       <span class="keywordflow">default</span>:
<a name="l00306"></a>00306         <span class="keywordflow">if</span> (<a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(dest) == 0) {
<a name="l00307"></a>00307             <span class="keywordflow">if</span> (!<a class="code" href="../../d5/de3/encoding_8h.html#a8b18a09a3055d3006c6d5baeaa6e7c72">rb_enc_asciicompat</a>(<a class="code" href="../../d1/db0/string_8c.html#a123891f9f9b0c87d15621d93b4fa9c41">STR_ENC_GET</a>(src)))
<a name="l00308"></a>00308                 <a class="code" href="../../d5/de3/encoding_8h.html#aefe5772c0116cf7131a5227de7243dbc">ENC_CODERANGE_SET</a>(dest, <a class="code" href="../../d5/de3/encoding_8h.html#a0c81a12daaa1e57009d46b9d906957dc">ENC_CODERANGE_VALID</a>);
<a name="l00309"></a>00309             <span class="keywordflow">else</span>
<a name="l00310"></a>00310                 <a class="code" href="../../d5/de3/encoding_8h.html#aefe5772c0116cf7131a5227de7243dbc">ENC_CODERANGE_SET</a>(dest, <a class="code" href="../../d5/de3/encoding_8h.html#a0a0e73a2d98205044e1ad19432502c5b">ENC_CODERANGE_7BIT</a>);
<a name="l00311"></a>00311         }
<a name="l00312"></a>00312         <span class="keywordflow">break</span>;
<a name="l00313"></a>00313     }
<a name="l00314"></a>00314 }
<a name="l00315"></a>00315 
<a name="l00316"></a>00316 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00317"></a><a class="code" href="../../d1/db0/string_8c.html#a0395d7e30463a34c3cd246ed51cb41a7">00317</a> <a class="code" href="../../d1/db0/string_8c.html#a0395d7e30463a34c3cd246ed51cb41a7">rb_enc_cr_str_exact_copy</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> dest, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> src)
<a name="l00318"></a>00318 {
<a name="l00319"></a>00319     <a class="code" href="../../d1/db0/string_8c.html#ad852306abdd51379d47cb3ead62c85ab">str_enc_copy</a>(dest, src);
<a name="l00320"></a>00320     <a class="code" href="../../d5/de3/encoding_8h.html#aefe5772c0116cf7131a5227de7243dbc">ENC_CODERANGE_SET</a>(dest, <a class="code" href="../../d5/de3/encoding_8h.html#a5901233f6f9004aebbdeccdd33cf449f">ENC_CODERANGE</a>(src));
<a name="l00321"></a>00321 }
<a name="l00322"></a>00322 
<a name="l00323"></a>00323 <span class="keywordtype">int</span>
<a name="l00324"></a><a class="code" href="../../d1/db0/string_8c.html#a50e3f4ed460586bf655ba4143cf53abc">00324</a> <a class="code" href="../../d5/de3/encoding_8h.html#a5282c41e11a68fe310f45c9a326ae2b8">rb_enc_str_coderange</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str)
<a name="l00325"></a>00325 {
<a name="l00326"></a>00326     <span class="keywordtype">int</span> cr = <a class="code" href="../../d5/de3/encoding_8h.html#a5901233f6f9004aebbdeccdd33cf449f">ENC_CODERANGE</a>(str);
<a name="l00327"></a>00327 
<a name="l00328"></a>00328     <span class="keywordflow">if</span> (cr == <a class="code" href="../../d5/de3/encoding_8h.html#a60de9709709968f9627365a6cd0ff5d1">ENC_CODERANGE_UNKNOWN</a>) {
<a name="l00329"></a>00329         <a class="code" href="../../d1/d7b/struct_onig_encoding_type_s_t.html">rb_encoding</a> *enc = <a class="code" href="../../d1/db0/string_8c.html#a123891f9f9b0c87d15621d93b4fa9c41">STR_ENC_GET</a>(str);
<a name="l00330"></a>00330         cr = <a class="code" href="../../d1/db0/string_8c.html#af47bc9a7bbb51656cecb095780518d7f">coderange_scan</a>(<a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(str), <a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(str), enc);
<a name="l00331"></a>00331         <a class="code" href="../../d5/de3/encoding_8h.html#aefe5772c0116cf7131a5227de7243dbc">ENC_CODERANGE_SET</a>(str, cr);
<a name="l00332"></a>00332     }
<a name="l00333"></a>00333     <span class="keywordflow">return</span> cr;
<a name="l00334"></a>00334 }
<a name="l00335"></a>00335 
<a name="l00336"></a>00336 <span class="keywordtype">int</span>
<a name="l00337"></a><a class="code" href="../../d1/db0/string_8c.html#abe438b36ac106ea046e0efbe70d109bf">00337</a> <a class="code" href="../../d5/de3/encoding_8h.html#a956549beeb7b17c93f143a7d02de6ef0">rb_enc_str_asciionly_p</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str)
<a name="l00338"></a>00338 {
<a name="l00339"></a>00339     <a class="code" href="../../d1/d7b/struct_onig_encoding_type_s_t.html">rb_encoding</a> *enc = <a class="code" href="../../d1/db0/string_8c.html#a123891f9f9b0c87d15621d93b4fa9c41">STR_ENC_GET</a>(str);
<a name="l00340"></a>00340 
<a name="l00341"></a>00341     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/de3/encoding_8h.html#a8b18a09a3055d3006c6d5baeaa6e7c72">rb_enc_asciicompat</a>(enc))
<a name="l00342"></a>00342         <span class="keywordflow">return</span> <a class="code" href="../../d1/d5c/nkf_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00343"></a>00343     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d5/de3/encoding_8h.html#a5282c41e11a68fe310f45c9a326ae2b8">rb_enc_str_coderange</a>(str) == <a class="code" href="../../d5/de3/encoding_8h.html#a0a0e73a2d98205044e1ad19432502c5b">ENC_CODERANGE_7BIT</a>)
<a name="l00344"></a>00344         <span class="keywordflow">return</span> <a class="code" href="../../d1/d5c/nkf_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00345"></a>00345     <span class="keywordflow">return</span> <a class="code" href="../../d1/d5c/nkf_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00346"></a>00346 }
<a name="l00347"></a>00347 
<a name="l00348"></a>00348 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span>
<a name="l00349"></a><a class="code" href="../../d1/db0/string_8c.html#ad2935afc9682c838023639ae7332edad">00349</a> <a class="code" href="../../d1/db0/string_8c.html#ad2935afc9682c838023639ae7332edad">str_mod_check</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> s, <span class="keyword">const</span> <span class="keywordtype">char</span> *p, <span class="keywordtype">long</span> <a class="code" href="../../d3/d15/name2ctype_8h.html#aed1cc4dca5d94cb452f79691f54f7423">len</a>)
<a name="l00350"></a>00350 {
<a name="l00351"></a>00351     <span class="keywordflow">if</span> (<a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(s) != p || <a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(s) != len){
<a name="l00352"></a>00352         <a class="code" href="../../db/dcc/error_8c.html#a0f771a2840561f1838169b3d7d4616f3">rb_raise</a>(<a class="code" href="../../db/dcc/error_8c.html#a95ad3953d535707e2cf2b1d837f5e253">rb_eRuntimeError</a>, <span class="stringliteral">&quot;string modified&quot;</span>);
<a name="l00353"></a>00353     }
<a name="l00354"></a>00354 }
<a name="l00355"></a>00355 
<a name="l00356"></a>00356 <span class="keywordtype">size_t</span>
<a name="l00357"></a><a class="code" href="../../d1/db0/string_8c.html#a55d6c2547d6412f130174bd6d76b6391">00357</a> <a class="code" href="../../db/d2e/intern_8h.html#ae3485fb3fdd9b960dc803374b044c567">rb_str_capacity</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str)
<a name="l00358"></a>00358 {
<a name="l00359"></a>00359     <span class="keywordflow">if</span> (<a class="code" href="../../d1/db0/string_8c.html#a0823acc422a6a849b53cf3ae0465b543">STR_EMBED_P</a>(str)) {
<a name="l00360"></a>00360         <span class="keywordflow">return</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a92657ad1be8a8a323df19648e33b47b5">RSTRING_EMBED_LEN_MAX</a>;
<a name="l00361"></a>00361     }
<a name="l00362"></a>00362     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d1/db0/string_8c.html#a2e4889499fa17d4a63dc76b35f4b208e">STR_NOCAPA_P</a>(str)) {
<a name="l00363"></a>00363         <span class="keywordflow">return</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac695b0c61b18410ebcf22584fe0a6f6f">RSTRING</a>(str)-&gt;as.heap.len;
<a name="l00364"></a>00364     }
<a name="l00365"></a>00365     <span class="keywordflow">else</span> {
<a name="l00366"></a>00366         <span class="keywordflow">return</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac695b0c61b18410ebcf22584fe0a6f6f">RSTRING</a>(str)-&gt;as.heap.aux.capa;
<a name="l00367"></a>00367     }
<a name="l00368"></a>00368 }
<a name="l00369"></a>00369 
<a name="l00370"></a>00370 <span class="keyword">static</span> <span class="keyword">inline</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l00371"></a><a class="code" href="../../d1/db0/string_8c.html#a185714a3c1bc25c1a0df991fe6b44204">00371</a> <a class="code" href="../../d1/db0/string_8c.html#a185714a3c1bc25c1a0df991fe6b44204">str_alloc</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> klass)
<a name="l00372"></a>00372 {
<a name="l00373"></a>00373     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ab8e75ef1f427d9b009705ebd577bee92">NEWOBJ</a>(str, <span class="keyword">struct</span> <a class="code" href="../../dd/d63/struct_r_string.html">RString</a>);
<a name="l00374"></a>00374     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a607a9da5249e026d1c4a0826dc840143">OBJSETUP</a>(str, klass, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a22a8c2a4bbaae9b68f65c9bb92fd4e39">T_STRING</a>);
<a name="l00375"></a>00375 
<a name="l00376"></a>00376     str-&gt;as.heap.ptr = 0;
<a name="l00377"></a>00377     str-&gt;as.heap.len = 0;
<a name="l00378"></a>00378     str-&gt;as.heap.aux.capa = 0;
<a name="l00379"></a>00379 
<a name="l00380"></a>00380     <span class="keywordflow">return</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>)str;
<a name="l00381"></a>00381 }
<a name="l00382"></a>00382 
<a name="l00383"></a>00383 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l00384"></a><a class="code" href="../../d1/db0/string_8c.html#aa1035aa668fabe3e095a515dd2fcc971">00384</a> <a class="code" href="../../d1/db0/string_8c.html#aa1035aa668fabe3e095a515dd2fcc971">str_new</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> klass, <span class="keyword">const</span> <span class="keywordtype">char</span> *ptr, <span class="keywordtype">long</span> <a class="code" href="../../d3/d15/name2ctype_8h.html#aed1cc4dca5d94cb452f79691f54f7423">len</a>)
<a name="l00385"></a>00385 {
<a name="l00386"></a>00386     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str;
<a name="l00387"></a>00387 
<a name="l00388"></a>00388     <span class="keywordflow">if</span> (len &lt; 0) {
<a name="l00389"></a>00389         <a class="code" href="../../db/dcc/error_8c.html#a0f771a2840561f1838169b3d7d4616f3">rb_raise</a>(<a class="code" href="../../db/dcc/error_8c.html#ab5e2a9fec766c75176fbb262bfe6a596">rb_eArgError</a>, <span class="stringliteral">&quot;negative string size (or size too big)&quot;</span>);
<a name="l00390"></a>00390     }
<a name="l00391"></a>00391 
<a name="l00392"></a>00392     str = <a class="code" href="../../d1/db0/string_8c.html#a185714a3c1bc25c1a0df991fe6b44204">str_alloc</a>(klass);
<a name="l00393"></a>00393     <span class="keywordflow">if</span> (len &gt; <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a92657ad1be8a8a323df19648e33b47b5">RSTRING_EMBED_LEN_MAX</a>) {
<a name="l00394"></a>00394         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac695b0c61b18410ebcf22584fe0a6f6f">RSTRING</a>(str)-&gt;as.heap.aux.capa = len;
<a name="l00395"></a>00395         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac695b0c61b18410ebcf22584fe0a6f6f">RSTRING</a>(str)-&gt;as.heap.ptr = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a79041aa2bc7439c11906a86f82a52eb6">ALLOC_N</a>(<span class="keywordtype">char</span>,len+1);
<a name="l00396"></a>00396         <a class="code" href="../../d1/db0/string_8c.html#a220a3ea405f8427a2b119e8cda01524e">STR_SET_NOEMBED</a>(str);
<a name="l00397"></a>00397     }
<a name="l00398"></a>00398     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (len == 0) {
<a name="l00399"></a>00399         <a class="code" href="../../d5/de3/encoding_8h.html#aefe5772c0116cf7131a5227de7243dbc">ENC_CODERANGE_SET</a>(str, <a class="code" href="../../d5/de3/encoding_8h.html#a0a0e73a2d98205044e1ad19432502c5b">ENC_CODERANGE_7BIT</a>);
<a name="l00400"></a>00400     }
<a name="l00401"></a>00401     <span class="keywordflow">if</span> (ptr) {
<a name="l00402"></a>00402         memcpy(<a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(str), ptr, len);
<a name="l00403"></a>00403     }
<a name="l00404"></a>00404     <a class="code" href="../../d1/db0/string_8c.html#a056c7c0a74c83ccdb5a160bbdcbf8c3b">STR_SET_LEN</a>(str, len);
<a name="l00405"></a>00405     <a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(str)[len] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l00406"></a>00406     <span class="keywordflow">return</span> str;
<a name="l00407"></a>00407 }
<a name="l00408"></a>00408 
<a name="l00409"></a>00409 <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l00410"></a><a class="code" href="../../d1/db0/string_8c.html#aba51f31f764903c532e22240dde50ecb">00410</a> <a class="code" href="../../db/d2e/intern_8h.html#a48b2b873adb8b6a04254bd631c4b03c5">rb_str_new</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *ptr, <span class="keywordtype">long</span> <a class="code" href="../../d3/d15/name2ctype_8h.html#aed1cc4dca5d94cb452f79691f54f7423">len</a>)
<a name="l00411"></a>00411 {
<a name="l00412"></a>00412     <span class="keywordflow">return</span> <a class="code" href="../../d1/db0/string_8c.html#aa1035aa668fabe3e095a515dd2fcc971">str_new</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a7d36c9c3e9faa34c27eb7f2eb9c874a8">rb_cString</a>, ptr, len);
<a name="l00413"></a>00413 }
<a name="l00414"></a>00414 
<a name="l00415"></a>00415 <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l00416"></a><a class="code" href="../../d1/db0/string_8c.html#a732533a6f6f20022554efcc45cc9c529">00416</a> <a class="code" href="../../db/d2e/intern_8h.html#aed107a4eacd5f626b554d2d341b58bd5">rb_usascii_str_new</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *ptr, <span class="keywordtype">long</span> <a class="code" href="../../d3/d15/name2ctype_8h.html#aed1cc4dca5d94cb452f79691f54f7423">len</a>)
<a name="l00417"></a>00417 {
<a name="l00418"></a>00418     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str = <a class="code" href="../../db/d2e/intern_8h.html#a48b2b873adb8b6a04254bd631c4b03c5">rb_str_new</a>(ptr, len);
<a name="l00419"></a>00419     <a class="code" href="../../d5/de3/encoding_8h.html#af06e3f35ff3b6d79190eaf397328e7e6">ENCODING_CODERANGE_SET</a>(str, <a class="code" href="../../d5/db5/encoding_8c.html#af8bb373eaa8036994c2e16476458d6f4">rb_usascii_encindex</a>(), <a class="code" href="../../d5/de3/encoding_8h.html#a0a0e73a2d98205044e1ad19432502c5b">ENC_CODERANGE_7BIT</a>);
<a name="l00420"></a>00420     <span class="keywordflow">return</span> str;
<a name="l00421"></a>00421 }
<a name="l00422"></a>00422 
<a name="l00423"></a>00423 <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l00424"></a><a class="code" href="../../d1/db0/string_8c.html#a960cfc256ea6b110850bbcb7837af9cd">00424</a> <a class="code" href="../../d5/de3/encoding_8h.html#a6707b730597e0e614213beb11670aca2">rb_enc_str_new</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *ptr, <span class="keywordtype">long</span> <a class="code" href="../../d3/d15/name2ctype_8h.html#aed1cc4dca5d94cb452f79691f54f7423">len</a>, <a class="code" href="../../d1/d7b/struct_onig_encoding_type_s_t.html">rb_encoding</a> *enc)
<a name="l00425"></a>00425 {
<a name="l00426"></a>00426     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str = <a class="code" href="../../db/d2e/intern_8h.html#a48b2b873adb8b6a04254bd631c4b03c5">rb_str_new</a>(ptr, len);
<a name="l00427"></a>00427     <a class="code" href="../../d5/db5/encoding_8c.html#a150a6e3ac22ac3be8f8c2ccc74a28e7b">rb_enc_associate</a>(str, enc);
<a name="l00428"></a>00428     <span class="keywordflow">return</span> str;
<a name="l00429"></a>00429 }
<a name="l00430"></a>00430 
<a name="l00431"></a>00431 <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l00432"></a><a class="code" href="../../d1/db0/string_8c.html#ad8ce7851130e4b275cf8694f469493ee">00432</a> <a class="code" href="../../db/d2e/intern_8h.html#a2b9cc485b0aa1dc270744b8b9eb47569">rb_str_new_cstr</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *ptr)
<a name="l00433"></a>00433 {
<a name="l00434"></a>00434     <span class="keywordflow">if</span> (!ptr) {
<a name="l00435"></a>00435         <a class="code" href="../../db/dcc/error_8c.html#a0f771a2840561f1838169b3d7d4616f3">rb_raise</a>(<a class="code" href="../../db/dcc/error_8c.html#ab5e2a9fec766c75176fbb262bfe6a596">rb_eArgError</a>, <span class="stringliteral">&quot;NULL pointer given&quot;</span>);
<a name="l00436"></a>00436     }
<a name="l00437"></a>00437     <span class="keywordflow">return</span> <a class="code" href="../../db/d2e/intern_8h.html#a48b2b873adb8b6a04254bd631c4b03c5">rb_str_new</a>(ptr, <a class="code" href="../../d6/d7b/strchr_8c.html#a219836f542ce53545052bed5353820ca">strlen</a>(ptr));
<a name="l00438"></a>00438 }
<a name="l00439"></a>00439 
<a name="l00440"></a><a class="code" href="../../d1/db0/string_8c.html#a8e5b395da13d903f77e9474dc5eb01c2">00440</a> <a class="code" href="../../d8/db0/defines_8h.html#a4e367f1663d56ddd63e2cb1a8a3449b1">RUBY_ALIAS_FUNCTION</a>(<a class="code" href="../../db/d2e/intern_8h.html#a03acd62c0b1edebbe1d61f957c19b7ac">rb_str_new2</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *ptr), <a class="code" href="../../db/d2e/intern_8h.html#a2b9cc485b0aa1dc270744b8b9eb47569">rb_str_new_cstr</a>, (ptr))
<a name="l00441"></a>00441 <span class="preprocessor">#define rb_str_new2 rb_str_new_cstr</span>
<a name="l00442"></a>00442 <span class="preprocessor"></span>
<a name="l00443"></a>00443 <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l00444"></a>00444 <a class="code" href="../../db/d2e/intern_8h.html#a14cee14f3a9a89e96144482560957ea0">rb_usascii_str_new_cstr</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *ptr)
<a name="l00445"></a>00445 {
<a name="l00446"></a>00446     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str = <a class="code" href="../../db/d2e/intern_8h.html#a03acd62c0b1edebbe1d61f957c19b7ac">rb_str_new2</a>(ptr);
<a name="l00447"></a>00447     <a class="code" href="../../d5/de3/encoding_8h.html#af06e3f35ff3b6d79190eaf397328e7e6">ENCODING_CODERANGE_SET</a>(str, <a class="code" href="../../d5/db5/encoding_8c.html#af8bb373eaa8036994c2e16476458d6f4">rb_usascii_encindex</a>(), <a class="code" href="../../d5/de3/encoding_8h.html#a0a0e73a2d98205044e1ad19432502c5b">ENC_CODERANGE_7BIT</a>);
<a name="l00448"></a>00448     <span class="keywordflow">return</span> str;
<a name="l00449"></a>00449 }
<a name="l00450"></a>00450 
<a name="l00451"></a><a class="code" href="../../d1/db0/string_8c.html#ae24fffbbf28469dd0106b974ace1efd8">00451</a> <a class="code" href="../../d8/db0/defines_8h.html#a4e367f1663d56ddd63e2cb1a8a3449b1">RUBY_ALIAS_FUNCTION</a>(<a class="code" href="../../db/d2e/intern_8h.html#a99895fce59be905b7c7f0a88bd32fa1f">rb_usascii_str_new2</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *ptr), <a class="code" href="../../db/d2e/intern_8h.html#a14cee14f3a9a89e96144482560957ea0">rb_usascii_str_new_cstr</a>, (ptr))
<a name="l00452"></a>00452 <span class="preprocessor">#define rb_usascii_str_new2 rb_usascii_str_new_cstr</span>
<a name="l00453"></a>00453 <span class="preprocessor"></span>
<a name="l00454"></a>00454 <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l00455"></a>00455 <a class="code" href="../../db/d2e/intern_8h.html#a857320dd57dc897c57ee0345f6f04f06">rb_tainted_str_new</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *ptr, <span class="keywordtype">long</span> <a class="code" href="../../d3/d15/name2ctype_8h.html#aed1cc4dca5d94cb452f79691f54f7423">len</a>)
<a name="l00456"></a>00456 {
<a name="l00457"></a>00457     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str = <a class="code" href="../../db/d2e/intern_8h.html#a48b2b873adb8b6a04254bd631c4b03c5">rb_str_new</a>(ptr, len);
<a name="l00458"></a>00458 
<a name="l00459"></a>00459     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#afd75ea0cb81c17e76c73e593d1d8a860">OBJ_TAINT</a>(str);
<a name="l00460"></a>00460     <span class="keywordflow">return</span> str;
<a name="l00461"></a>00461 }
<a name="l00462"></a>00462 
<a name="l00463"></a>00463 <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l00464"></a><a class="code" href="../../d1/db0/string_8c.html#adf033ede930b317a580086911e804be2">00464</a> <a class="code" href="../../db/d2e/intern_8h.html#a952a6ba1061ebd52680d445331bb6a78">rb_tainted_str_new_cstr</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *ptr)
<a name="l00465"></a>00465 {
<a name="l00466"></a>00466     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str = <a class="code" href="../../db/d2e/intern_8h.html#a03acd62c0b1edebbe1d61f957c19b7ac">rb_str_new2</a>(ptr);
<a name="l00467"></a>00467 
<a name="l00468"></a>00468     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#afd75ea0cb81c17e76c73e593d1d8a860">OBJ_TAINT</a>(str);
<a name="l00469"></a>00469     <span class="keywordflow">return</span> str;
<a name="l00470"></a>00470 }
<a name="l00471"></a>00471 
<a name="l00472"></a><a class="code" href="../../d1/db0/string_8c.html#a12aef89baeecb16a7fef12b25ae0ae0f">00472</a> <a class="code" href="../../d8/db0/defines_8h.html#a4e367f1663d56ddd63e2cb1a8a3449b1">RUBY_ALIAS_FUNCTION</a>(<a class="code" href="../../db/d2e/intern_8h.html#ad16405ca7b4baa5da742798d500f00e6">rb_tainted_str_new2</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *ptr), <a class="code" href="../../db/d2e/intern_8h.html#a952a6ba1061ebd52680d445331bb6a78">rb_tainted_str_new_cstr</a>, (ptr))
<a name="l00473"></a>00473 <span class="preprocessor">#define rb_tainted_str_new2 rb_tainted_str_new_cstr</span>
<a name="l00474"></a>00474 <span class="preprocessor"></span>
<a name="l00475"></a>00475 <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l00476"></a>00476 <a class="code" href="../../d5/de3/encoding_8h.html#a6904aa86a63e18ad32716096a24e6a48">rb_str_conv_enc_opts</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str, <a class="code" href="../../d1/d7b/struct_onig_encoding_type_s_t.html">rb_encoding</a> *from, <a class="code" href="../../d1/d7b/struct_onig_encoding_type_s_t.html">rb_encoding</a> *to, <span class="keywordtype">int</span> ecflags, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> ecopts)
<a name="l00477"></a>00477 {
<a name="l00478"></a>00478     <a class="code" href="../../d3/d06/structrb__econv__t.html">rb_econv_t</a> *ec;
<a name="l00479"></a>00479     <a class="code" href="../../d5/de3/encoding_8h.html#a3b568992ff8d28593f9386fd70c831ef">rb_econv_result_t</a> ret;
<a name="l00480"></a>00480     <span class="keywordtype">long</span> <a class="code" href="../../d3/d15/name2ctype_8h.html#aed1cc4dca5d94cb452f79691f54f7423">len</a>;
<a name="l00481"></a>00481     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> newstr;
<a name="l00482"></a>00482     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *sp;
<a name="l00483"></a>00483     <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *<a class="code" href="../../db/d16/debug_8h.html#a08a47aff6867e5ae146382e66d2cc26b">dp</a>;
<a name="l00484"></a>00484 
<a name="l00485"></a>00485     <span class="keywordflow">if</span> (!to) <span class="keywordflow">return</span> str;
<a name="l00486"></a>00486     <span class="keywordflow">if</span> (from == to) <span class="keywordflow">return</span> str;
<a name="l00487"></a>00487     <span class="keywordflow">if</span> ((<a class="code" href="../../d5/de3/encoding_8h.html#a8b18a09a3055d3006c6d5baeaa6e7c72">rb_enc_asciicompat</a>(to) &amp;&amp; <a class="code" href="../../d5/de3/encoding_8h.html#a5901233f6f9004aebbdeccdd33cf449f">ENC_CODERANGE</a>(str) == <a class="code" href="../../d5/de3/encoding_8h.html#a0a0e73a2d98205044e1ad19432502c5b">ENC_CODERANGE_7BIT</a>) ||
<a name="l00488"></a>00488         to == <a class="code" href="../../d5/db5/encoding_8c.html#a767d777810f0d48add93857b52057262">rb_ascii8bit_encoding</a>()) {
<a name="l00489"></a>00489         <span class="keywordflow">if</span> (<a class="code" href="../../d1/db0/string_8c.html#a123891f9f9b0c87d15621d93b4fa9c41">STR_ENC_GET</a>(str) != to) {
<a name="l00490"></a>00490             str = <a class="code" href="../../db/d2e/intern_8h.html#ae2843c766c24b80116bb127ebf22d5bf">rb_str_dup</a>(str);
<a name="l00491"></a>00491             <a class="code" href="../../d5/db5/encoding_8c.html#a150a6e3ac22ac3be8f8c2ccc74a28e7b">rb_enc_associate</a>(str, to);
<a name="l00492"></a>00492         }
<a name="l00493"></a>00493         <span class="keywordflow">return</span> str;
<a name="l00494"></a>00494     }
<a name="l00495"></a>00495 
<a name="l00496"></a>00496     len = <a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(str);
<a name="l00497"></a>00497     newstr = <a class="code" href="../../db/d2e/intern_8h.html#a48b2b873adb8b6a04254bd631c4b03c5">rb_str_new</a>(0, len);
<a name="l00498"></a>00498 
<a name="l00499"></a>00499   retry:
<a name="l00500"></a>00500     ec = <a class="code" href="../../d5/de3/encoding_8h.html#ac48226d977525efbbf4ed18ff36fce23">rb_econv_open_opts</a>(from-&gt;<a class="code" href="../../d1/d7b/struct_onig_encoding_type_s_t.html#a297b454a05f56650dbba59d0109b3f7f">name</a>, to-&gt;<a class="code" href="../../d1/d7b/struct_onig_encoding_type_s_t.html#a297b454a05f56650dbba59d0109b3f7f">name</a>, ecflags, ecopts);
<a name="l00501"></a>00501     <span class="keywordflow">if</span> (!ec) <span class="keywordflow">return</span> str;
<a name="l00502"></a>00502 
<a name="l00503"></a>00503     sp = (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*)<a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(str);
<a name="l00504"></a>00504     dp = (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*)<a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(newstr);
<a name="l00505"></a>00505     ret = <a class="code" href="../../d5/de3/encoding_8h.html#a346451a419b3ce73da0d2323eb3238ee">rb_econv_convert</a>(ec, &amp;sp, (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*)<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a35bfa2635774977edad0a16b9fdebbaf">RSTRING_END</a>(str),
<a name="l00506"></a>00506                            &amp;dp, (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*)<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a35bfa2635774977edad0a16b9fdebbaf">RSTRING_END</a>(newstr), 0);
<a name="l00507"></a>00507     <a class="code" href="../../d5/de3/encoding_8h.html#adaf53306799f8796d7e6437bc98d0b0e">rb_econv_close</a>(ec);
<a name="l00508"></a>00508     <span class="keywordflow">switch</span> (ret) {
<a name="l00509"></a>00509       <span class="keywordflow">case</span> <a class="code" href="../../d5/de3/encoding_8h.html#a3b568992ff8d28593f9386fd70c831efad0abfbc72141011421aafa70c9763666">econv_destination_buffer_full</a>:
<a name="l00510"></a>00510         <span class="comment">/* destination buffer short */</span>
<a name="l00511"></a>00511         len = len &lt; 2 ? 2 : len * 2;
<a name="l00512"></a>00512         <a class="code" href="../../db/d2e/intern_8h.html#a0a133856edb99f69eae3cb5a9e275ac9">rb_str_resize</a>(newstr, len);
<a name="l00513"></a>00513         <span class="keywordflow">goto</span> retry;
<a name="l00514"></a>00514 
<a name="l00515"></a>00515       <span class="keywordflow">case</span> <a class="code" href="../../d5/de3/encoding_8h.html#a3b568992ff8d28593f9386fd70c831efa50dc17a7e8399ca9dcd98a7b6e652764">econv_finished</a>:
<a name="l00516"></a>00516         len = dp - (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*)<a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(newstr);
<a name="l00517"></a>00517         <a class="code" href="../../d8/d81/ruby__missing_8h.html#a89ed8cb86ca6dd49d2db67adae809057">rb_str_set_len</a>(newstr, len);
<a name="l00518"></a>00518         <a class="code" href="../../d5/db5/encoding_8c.html#a150a6e3ac22ac3be8f8c2ccc74a28e7b">rb_enc_associate</a>(newstr, to);
<a name="l00519"></a>00519         <span class="keywordflow">return</span> newstr;
<a name="l00520"></a>00520 
<a name="l00521"></a>00521       <span class="keywordflow">default</span>:
<a name="l00522"></a>00522         <span class="comment">/* some error, return original */</span>
<a name="l00523"></a>00523         <span class="keywordflow">return</span> str;
<a name="l00524"></a>00524     }
<a name="l00525"></a>00525 }
<a name="l00526"></a>00526 
<a name="l00527"></a>00527 <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l00528"></a><a class="code" href="../../d1/db0/string_8c.html#a21d9b0b3f40140eab67e778264877c8a">00528</a> <a class="code" href="../../d5/de3/encoding_8h.html#a21d9b0b3f40140eab67e778264877c8a">rb_str_conv_enc</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str, <a class="code" href="../../d1/d7b/struct_onig_encoding_type_s_t.html">rb_encoding</a> *from, <a class="code" href="../../d1/d7b/struct_onig_encoding_type_s_t.html">rb_encoding</a> *to)
<a name="l00529"></a>00529 {
<a name="l00530"></a>00530     <span class="keywordflow">return</span> <a class="code" href="../../d5/de3/encoding_8h.html#a6904aa86a63e18ad32716096a24e6a48">rb_str_conv_enc_opts</a>(str, from, to, 0, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a320970f989dc8294c8203154e3db40c1">Qnil</a>);
<a name="l00531"></a>00531 }
<a name="l00532"></a>00532 
<a name="l00533"></a>00533 <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l00534"></a><a class="code" href="../../d1/db0/string_8c.html#a8b50efe6e5ed0c195201272d09845021">00534</a> <a class="code" href="../../d5/de3/encoding_8h.html#aeb5f105fc82d8495f29cf03e563bff6b">rb_external_str_new_with_enc</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *ptr, <span class="keywordtype">long</span> <a class="code" href="../../d3/d15/name2ctype_8h.html#aed1cc4dca5d94cb452f79691f54f7423">len</a>, <a class="code" href="../../d1/d7b/struct_onig_encoding_type_s_t.html">rb_encoding</a> *eenc)
<a name="l00535"></a>00535 {
<a name="l00536"></a>00536     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str;
<a name="l00537"></a>00537 
<a name="l00538"></a>00538     str = <a class="code" href="../../db/d2e/intern_8h.html#a857320dd57dc897c57ee0345f6f04f06">rb_tainted_str_new</a>(ptr, len);
<a name="l00539"></a>00539     <span class="keywordflow">if</span> (eenc == <a class="code" href="../../d5/db5/encoding_8c.html#a1e215012f16414c044f6a212973c95a8">rb_usascii_encoding</a>() &amp;&amp;
<a name="l00540"></a>00540         <a class="code" href="../../d5/de3/encoding_8h.html#a5282c41e11a68fe310f45c9a326ae2b8">rb_enc_str_coderange</a>(str) != <a class="code" href="../../d5/de3/encoding_8h.html#a0a0e73a2d98205044e1ad19432502c5b">ENC_CODERANGE_7BIT</a>) {
<a name="l00541"></a>00541         <a class="code" href="../../d5/db5/encoding_8c.html#a150a6e3ac22ac3be8f8c2ccc74a28e7b">rb_enc_associate</a>(str, <a class="code" href="../../d5/db5/encoding_8c.html#a767d777810f0d48add93857b52057262">rb_ascii8bit_encoding</a>());
<a name="l00542"></a>00542         <span class="keywordflow">return</span> str;
<a name="l00543"></a>00543     }
<a name="l00544"></a>00544     <a class="code" href="../../d5/db5/encoding_8c.html#a150a6e3ac22ac3be8f8c2ccc74a28e7b">rb_enc_associate</a>(str, eenc);
<a name="l00545"></a>00545     <span class="keywordflow">return</span> <a class="code" href="../../d5/de3/encoding_8h.html#a21d9b0b3f40140eab67e778264877c8a">rb_str_conv_enc</a>(str, eenc, <a class="code" href="../../d5/db5/encoding_8c.html#a62b808940b1049f1af6233cbbb828bd6">rb_default_internal_encoding</a>());
<a name="l00546"></a>00546 }
<a name="l00547"></a>00547 
<a name="l00548"></a>00548 <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l00549"></a><a class="code" href="../../d1/db0/string_8c.html#a33c6f4496ed2af514345293672650c00">00549</a> <a class="code" href="../../db/d2e/intern_8h.html#a37f67f5f2e117b1f20938b2f4b4a7556">rb_external_str_new</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *ptr, <span class="keywordtype">long</span> <a class="code" href="../../d3/d15/name2ctype_8h.html#aed1cc4dca5d94cb452f79691f54f7423">len</a>)
<a name="l00550"></a>00550 {
<a name="l00551"></a>00551     <span class="keywordflow">return</span> <a class="code" href="../../d5/de3/encoding_8h.html#aeb5f105fc82d8495f29cf03e563bff6b">rb_external_str_new_with_enc</a>(ptr, len, <a class="code" href="../../d5/db5/encoding_8c.html#a0724183879562529f7d3365ef5115b6d">rb_default_external_encoding</a>());
<a name="l00552"></a>00552 }
<a name="l00553"></a>00553 
<a name="l00554"></a>00554 <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l00555"></a><a class="code" href="../../d1/db0/string_8c.html#aea6fe3583c0ddb3cb525644ba1fba0c7">00555</a> <a class="code" href="../../db/d2e/intern_8h.html#a6c7ae9e860c73b7788ad9ed53b93bda9">rb_external_str_new_cstr</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *ptr)
<a name="l00556"></a>00556 {
<a name="l00557"></a>00557     <span class="keywordflow">return</span> <a class="code" href="../../d5/de3/encoding_8h.html#aeb5f105fc82d8495f29cf03e563bff6b">rb_external_str_new_with_enc</a>(ptr, <a class="code" href="../../d6/d7b/strchr_8c.html#a219836f542ce53545052bed5353820ca">strlen</a>(ptr), <a class="code" href="../../d5/db5/encoding_8c.html#a0724183879562529f7d3365ef5115b6d">rb_default_external_encoding</a>());
<a name="l00558"></a>00558 }
<a name="l00559"></a>00559 
<a name="l00560"></a>00560 <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l00561"></a><a class="code" href="../../d1/db0/string_8c.html#ae6866d8c15f66f5a3e044a22fb116ab3">00561</a> <a class="code" href="../../db/d2e/intern_8h.html#a4f290d0f16fc560d06dd8b9c100d7469">rb_locale_str_new</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *ptr, <span class="keywordtype">long</span> <a class="code" href="../../d3/d15/name2ctype_8h.html#aed1cc4dca5d94cb452f79691f54f7423">len</a>)
<a name="l00562"></a>00562 {
<a name="l00563"></a>00563     <span class="keywordflow">return</span> <a class="code" href="../../d5/de3/encoding_8h.html#aeb5f105fc82d8495f29cf03e563bff6b">rb_external_str_new_with_enc</a>(ptr, len, <a class="code" href="../../d5/db5/encoding_8c.html#a051d22249598e717317cb04798b3d76f">rb_locale_encoding</a>());
<a name="l00564"></a>00564 }
<a name="l00565"></a>00565 
<a name="l00566"></a>00566 <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l00567"></a><a class="code" href="../../d1/db0/string_8c.html#ac591a05547cd6b8c85b7d1fbeffc44a2">00567</a> <a class="code" href="../../db/d2e/intern_8h.html#ad442e5788efc79373b5909d8684983ec">rb_locale_str_new_cstr</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *ptr)
<a name="l00568"></a>00568 {
<a name="l00569"></a>00569     <span class="keywordflow">return</span> <a class="code" href="../../d5/de3/encoding_8h.html#aeb5f105fc82d8495f29cf03e563bff6b">rb_external_str_new_with_enc</a>(ptr, <a class="code" href="../../d6/d7b/strchr_8c.html#a219836f542ce53545052bed5353820ca">strlen</a>(ptr), <a class="code" href="../../d5/db5/encoding_8c.html#a051d22249598e717317cb04798b3d76f">rb_locale_encoding</a>());
<a name="l00570"></a>00570 }
<a name="l00571"></a>00571 
<a name="l00572"></a>00572 <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l00573"></a><a class="code" href="../../d1/db0/string_8c.html#a2a0cda9e4e3bc0eac02b3823eb595c0a">00573</a> <a class="code" href="../../db/d2e/intern_8h.html#a4ea7e062999998b3fb0569e52ba82005">rb_filesystem_str_new</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *ptr, <span class="keywordtype">long</span> <a class="code" href="../../d3/d15/name2ctype_8h.html#aed1cc4dca5d94cb452f79691f54f7423">len</a>)
<a name="l00574"></a>00574 {
<a name="l00575"></a>00575     <span class="keywordflow">return</span> <a class="code" href="../../d5/de3/encoding_8h.html#aeb5f105fc82d8495f29cf03e563bff6b">rb_external_str_new_with_enc</a>(ptr, len, <a class="code" href="../../d5/db5/encoding_8c.html#af99b5328ff8c5511cbccd48fc0fe82bc">rb_filesystem_encoding</a>());
<a name="l00576"></a>00576 }
<a name="l00577"></a>00577 
<a name="l00578"></a>00578 <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l00579"></a><a class="code" href="../../d1/db0/string_8c.html#a806082e39ae6795399fd152d89927a1f">00579</a> <a class="code" href="../../db/d2e/intern_8h.html#a6aae739737e04e677e302c4b24a2bac0">rb_filesystem_str_new_cstr</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *ptr)
<a name="l00580"></a>00580 {
<a name="l00581"></a>00581     <span class="keywordflow">return</span> <a class="code" href="../../d5/de3/encoding_8h.html#aeb5f105fc82d8495f29cf03e563bff6b">rb_external_str_new_with_enc</a>(ptr, <a class="code" href="../../d6/d7b/strchr_8c.html#a219836f542ce53545052bed5353820ca">strlen</a>(ptr), <a class="code" href="../../d5/db5/encoding_8c.html#af99b5328ff8c5511cbccd48fc0fe82bc">rb_filesystem_encoding</a>());
<a name="l00582"></a>00582 }
<a name="l00583"></a>00583 
<a name="l00584"></a>00584 <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l00585"></a><a class="code" href="../../d1/db0/string_8c.html#a2b8c81d42d0f719bc009f7bbe017c5fa">00585</a> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a5853af6192ab513729add06c5be37e15">rb_str_export</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str)
<a name="l00586"></a>00586 {
<a name="l00587"></a>00587     <span class="keywordflow">return</span> <a class="code" href="../../d5/de3/encoding_8h.html#a21d9b0b3f40140eab67e778264877c8a">rb_str_conv_enc</a>(str, <a class="code" href="../../d1/db0/string_8c.html#a123891f9f9b0c87d15621d93b4fa9c41">STR_ENC_GET</a>(str), <a class="code" href="../../d5/db5/encoding_8c.html#a0724183879562529f7d3365ef5115b6d">rb_default_external_encoding</a>());
<a name="l00588"></a>00588 }
<a name="l00589"></a>00589 
<a name="l00590"></a>00590 <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l00591"></a><a class="code" href="../../d1/db0/string_8c.html#a9353a99e0fe5051e1bdb33c612b26cf8">00591</a> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a4287a7a903509ea84508115d23476891">rb_str_export_locale</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str)
<a name="l00592"></a>00592 {
<a name="l00593"></a>00593     <span class="keywordflow">return</span> <a class="code" href="../../d5/de3/encoding_8h.html#a21d9b0b3f40140eab67e778264877c8a">rb_str_conv_enc</a>(str, <a class="code" href="../../d1/db0/string_8c.html#a123891f9f9b0c87d15621d93b4fa9c41">STR_ENC_GET</a>(str), <a class="code" href="../../d5/db5/encoding_8c.html#a051d22249598e717317cb04798b3d76f">rb_locale_encoding</a>());
<a name="l00594"></a>00594 }
<a name="l00595"></a>00595 
<a name="l00596"></a>00596 <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l00597"></a><a class="code" href="../../d1/db0/string_8c.html#af9f829f40f4ff6748e394b5202ab435b">00597</a> <a class="code" href="../../d5/de3/encoding_8h.html#afbc5af6d0519022b74552a42800fb93c">rb_str_export_to_enc</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str, <a class="code" href="../../d1/d7b/struct_onig_encoding_type_s_t.html">rb_encoding</a> *enc)
<a name="l00598"></a>00598 {
<a name="l00599"></a>00599     <span class="keywordflow">return</span> <a class="code" href="../../d5/de3/encoding_8h.html#a21d9b0b3f40140eab67e778264877c8a">rb_str_conv_enc</a>(str, <a class="code" href="../../d1/db0/string_8c.html#a123891f9f9b0c87d15621d93b4fa9c41">STR_ENC_GET</a>(str), enc);
<a name="l00600"></a>00600 }
<a name="l00601"></a>00601 
<a name="l00602"></a>00602 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l00603"></a><a class="code" href="../../d1/db0/string_8c.html#a39c736f7e85cc49de282dbed52cbd799">00603</a> <a class="code" href="../../d1/db0/string_8c.html#a39c736f7e85cc49de282dbed52cbd799">str_replace_shared</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str2, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str)
<a name="l00604"></a>00604 {
<a name="l00605"></a>00605     <span class="keywordflow">if</span> (<a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(str) &lt;= <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a92657ad1be8a8a323df19648e33b47b5">RSTRING_EMBED_LEN_MAX</a>) {
<a name="l00606"></a>00606         <a class="code" href="../../d1/db0/string_8c.html#a598a41ca866cde6d9854bf77f48b006d">STR_SET_EMBED</a>(str2);
<a name="l00607"></a>00607         memcpy(<a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(str2), <a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(str), <a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(str)+1);
<a name="l00608"></a>00608         <a class="code" href="../../d1/db0/string_8c.html#ac1f52d89a2e4d0dda456490dcfe70993">STR_SET_EMBED_LEN</a>(str2, <a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(str));
<a name="l00609"></a>00609     }
<a name="l00610"></a>00610     <span class="keywordflow">else</span> {
<a name="l00611"></a>00611         str = <a class="code" href="../../db/d2e/intern_8h.html#ab771cea1c6187da7a08e9f0bc309a0a6">rb_str_new_frozen</a>(str);
<a name="l00612"></a>00612         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a38d7199dc0d1dc7f7207a9b3091c8d0d">FL_SET</a>(str2, <a class="code" href="../../d1/db0/string_8c.html#ac8d3bdd1bdb620a40ed913619cdc7c6b">STR_NOEMBED</a>);
<a name="l00613"></a>00613         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac695b0c61b18410ebcf22584fe0a6f6f">RSTRING</a>(str2)-&gt;as.heap.len = <a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(str);
<a name="l00614"></a>00614         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac695b0c61b18410ebcf22584fe0a6f6f">RSTRING</a>(str2)-&gt;as.heap.ptr = <a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(str);
<a name="l00615"></a>00615         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac695b0c61b18410ebcf22584fe0a6f6f">RSTRING</a>(str2)-&gt;as.heap.aux.shared = str;
<a name="l00616"></a>00616         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a38d7199dc0d1dc7f7207a9b3091c8d0d">FL_SET</a>(str2, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a4f77ed51d02515ee27ce9fca7880ce8f">ELTS_SHARED</a>);
<a name="l00617"></a>00617     }
<a name="l00618"></a>00618     <a class="code" href="../../d1/db0/string_8c.html#a0395d7e30463a34c3cd246ed51cb41a7">rb_enc_cr_str_exact_copy</a>(str2, str);
<a name="l00619"></a>00619 
<a name="l00620"></a>00620     <span class="keywordflow">return</span> str2;
<a name="l00621"></a>00621 }
<a name="l00622"></a>00622 
<a name="l00623"></a>00623 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l00624"></a><a class="code" href="../../d1/db0/string_8c.html#a84d4e9476e2a5c227f86a0f6ba0c5bf8">00624</a> <a class="code" href="../../d1/db0/string_8c.html#a84d4e9476e2a5c227f86a0f6ba0c5bf8">str_new_shared</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> klass, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str)
<a name="l00625"></a>00625 {
<a name="l00626"></a>00626     <span class="keywordflow">return</span> <a class="code" href="../../d1/db0/string_8c.html#a39c736f7e85cc49de282dbed52cbd799">str_replace_shared</a>(<a class="code" href="../../d1/db0/string_8c.html#a185714a3c1bc25c1a0df991fe6b44204">str_alloc</a>(klass), str);
<a name="l00627"></a>00627 }
<a name="l00628"></a>00628 
<a name="l00629"></a>00629 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l00630"></a><a class="code" href="../../d1/db0/string_8c.html#a4d8a594117e1ef7b3ca1b0466b384256">00630</a> <a class="code" href="../../d1/db0/string_8c.html#a4d8a594117e1ef7b3ca1b0466b384256">str_new3</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> klass, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str)
<a name="l00631"></a>00631 {
<a name="l00632"></a>00632     <span class="keywordflow">return</span> <a class="code" href="../../d1/db0/string_8c.html#a84d4e9476e2a5c227f86a0f6ba0c5bf8">str_new_shared</a>(klass, str);
<a name="l00633"></a>00633 }
<a name="l00634"></a>00634 
<a name="l00635"></a>00635 <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l00636"></a><a class="code" href="../../d1/db0/string_8c.html#a17bc1bf19c2666106c02bcb41610af66">00636</a> <a class="code" href="../../db/d2e/intern_8h.html#a26b6747ce71f213f14bedf7f1d892ad0">rb_str_new_shared</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str)
<a name="l00637"></a>00637 {
<a name="l00638"></a>00638     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str2 = <a class="code" href="../../d1/db0/string_8c.html#a4d8a594117e1ef7b3ca1b0466b384256">str_new3</a>(<a class="code" href="../../db/d2e/intern_8h.html#ac2be7243e739fa8f5dce6be0c8ee5f6d">rb_obj_class</a>(str), str);
<a name="l00639"></a>00639 
<a name="l00640"></a>00640     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3bf9ab455a1e0e3e8cfc6ebabd8f12df">OBJ_INFECT</a>(str2, str);
<a name="l00641"></a>00641     <span class="keywordflow">return</span> str2;
<a name="l00642"></a>00642 }
<a name="l00643"></a>00643 
<a name="l00644"></a><a class="code" href="../../d1/db0/string_8c.html#ac52d842db13889b18cd3bb85332a4848">00644</a> <a class="code" href="../../d8/db0/defines_8h.html#a4e367f1663d56ddd63e2cb1a8a3449b1">RUBY_ALIAS_FUNCTION</a>(<a class="code" href="../../db/d2e/intern_8h.html#a85c5c2b573ca25e0eb249d5cdd2a1f59">rb_str_new3</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str), <a class="code" href="../../db/d2e/intern_8h.html#a26b6747ce71f213f14bedf7f1d892ad0">rb_str_new_shared</a>, (str))
<a name="l00645"></a>00645 <span class="preprocessor">#define rb_str_new3 rb_str_new_shared</span>
<a name="l00646"></a>00646 <span class="preprocessor"></span>
<a name="l00647"></a>00647 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l00648"></a>00648 str_new4(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> klass, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str)
<a name="l00649"></a>00649 {
<a name="l00650"></a>00650     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str2;
<a name="l00651"></a>00651 
<a name="l00652"></a>00652     str2 = <a class="code" href="../../d1/db0/string_8c.html#a185714a3c1bc25c1a0df991fe6b44204">str_alloc</a>(klass);
<a name="l00653"></a>00653     <a class="code" href="../../d1/db0/string_8c.html#a220a3ea405f8427a2b119e8cda01524e">STR_SET_NOEMBED</a>(str2);
<a name="l00654"></a>00654     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac695b0c61b18410ebcf22584fe0a6f6f">RSTRING</a>(str2)-&gt;as.heap.len = <a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(str);
<a name="l00655"></a>00655     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac695b0c61b18410ebcf22584fe0a6f6f">RSTRING</a>(str2)-&gt;as.heap.ptr = <a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(str);
<a name="l00656"></a>00656     <span class="keywordflow">if</span> (<a class="code" href="../../d1/db0/string_8c.html#a47a46c073102a116dc86fbe598a8694e">STR_SHARED_P</a>(str)) {
<a name="l00657"></a>00657         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> shared = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac695b0c61b18410ebcf22584fe0a6f6f">RSTRING</a>(str)-&gt;as.heap.aux.shared;
<a name="l00658"></a>00658         <a class="code" href="../../d5/dac/ossl_8h.html#acdcc5aaebf3f273c1762f24a6ece2e5e">assert</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a73db79f74bad2fb5258a2ae7ee6ef117">OBJ_FROZEN</a>(shared));
<a name="l00659"></a>00659         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a38d7199dc0d1dc7f7207a9b3091c8d0d">FL_SET</a>(str2, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a4f77ed51d02515ee27ce9fca7880ce8f">ELTS_SHARED</a>);
<a name="l00660"></a>00660         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac695b0c61b18410ebcf22584fe0a6f6f">RSTRING</a>(str2)-&gt;as.heap.aux.shared = shared;
<a name="l00661"></a>00661     }
<a name="l00662"></a>00662     <span class="keywordflow">else</span> {
<a name="l00663"></a>00663         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a38d7199dc0d1dc7f7207a9b3091c8d0d">FL_SET</a>(str, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a4f77ed51d02515ee27ce9fca7880ce8f">ELTS_SHARED</a>);
<a name="l00664"></a>00664         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac695b0c61b18410ebcf22584fe0a6f6f">RSTRING</a>(str)-&gt;as.heap.aux.shared = str2;
<a name="l00665"></a>00665     }
<a name="l00666"></a>00666     <a class="code" href="../../d1/db0/string_8c.html#a0395d7e30463a34c3cd246ed51cb41a7">rb_enc_cr_str_exact_copy</a>(str2, str);
<a name="l00667"></a>00667     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3bf9ab455a1e0e3e8cfc6ebabd8f12df">OBJ_INFECT</a>(str2, str);
<a name="l00668"></a>00668     <span class="keywordflow">return</span> str2;
<a name="l00669"></a>00669 }
<a name="l00670"></a>00670 
<a name="l00671"></a>00671 <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l00672"></a><a class="code" href="../../d1/db0/string_8c.html#a1f8d56af3502435d684d511db3cb7516">00672</a> <a class="code" href="../../db/d2e/intern_8h.html#ab771cea1c6187da7a08e9f0bc309a0a6">rb_str_new_frozen</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> orig)
<a name="l00673"></a>00673 {
<a name="l00674"></a>00674     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> klass, str;
<a name="l00675"></a>00675 
<a name="l00676"></a>00676     <span class="keywordflow">if</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a73db79f74bad2fb5258a2ae7ee6ef117">OBJ_FROZEN</a>(orig)) <span class="keywordflow">return</span> orig;
<a name="l00677"></a>00677     klass = <a class="code" href="../../db/d2e/intern_8h.html#ac2be7243e739fa8f5dce6be0c8ee5f6d">rb_obj_class</a>(orig);
<a name="l00678"></a>00678     <span class="keywordflow">if</span> (<a class="code" href="../../d1/db0/string_8c.html#a47a46c073102a116dc86fbe598a8694e">STR_SHARED_P</a>(orig) &amp;&amp; (str = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac695b0c61b18410ebcf22584fe0a6f6f">RSTRING</a>(orig)-&gt;as.heap.aux.shared)) {
<a name="l00679"></a>00679         <span class="keywordtype">long</span> ofs;
<a name="l00680"></a>00680         <a class="code" href="../../d5/dac/ossl_8h.html#acdcc5aaebf3f273c1762f24a6ece2e5e">assert</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a73db79f74bad2fb5258a2ae7ee6ef117">OBJ_FROZEN</a>(str));
<a name="l00681"></a>00681         ofs = <a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(str) - <a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(orig);
<a name="l00682"></a>00682         <span class="keywordflow">if</span> ((ofs &gt; 0) || (klass != <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a1d4c05021aacd8cab989ff60f95ebe2d">RBASIC</a>(str)-&gt;klass) ||
<a name="l00683"></a>00683             (!<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a621bc62b1fd82640c1078daf90e1c061">OBJ_TAINTED</a>(str) &amp;&amp; <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a621bc62b1fd82640c1078daf90e1c061">OBJ_TAINTED</a>(orig)) ||
<a name="l00684"></a>00684             <a class="code" href="../../d5/de3/encoding_8h.html#a6ba07266a084d7a480377f1472aabfd8">ENCODING_GET</a>(str) != <a class="code" href="../../d5/de3/encoding_8h.html#a6ba07266a084d7a480377f1472aabfd8">ENCODING_GET</a>(orig)) {
<a name="l00685"></a>00685             str = <a class="code" href="../../d1/db0/string_8c.html#a4d8a594117e1ef7b3ca1b0466b384256">str_new3</a>(klass, str);
<a name="l00686"></a>00686             <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac695b0c61b18410ebcf22584fe0a6f6f">RSTRING</a>(str)-&gt;as.heap.ptr += ofs;
<a name="l00687"></a>00687             <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac695b0c61b18410ebcf22584fe0a6f6f">RSTRING</a>(str)-&gt;as.heap.len -= ofs;
<a name="l00688"></a>00688             <a class="code" href="../../d1/db0/string_8c.html#a0395d7e30463a34c3cd246ed51cb41a7">rb_enc_cr_str_exact_copy</a>(str, orig);
<a name="l00689"></a>00689             <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3bf9ab455a1e0e3e8cfc6ebabd8f12df">OBJ_INFECT</a>(str, orig);
<a name="l00690"></a>00690         }
<a name="l00691"></a>00691     }
<a name="l00692"></a>00692     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d1/db0/string_8c.html#a0823acc422a6a849b53cf3ae0465b543">STR_EMBED_P</a>(orig)) {
<a name="l00693"></a>00693         str = <a class="code" href="../../d1/db0/string_8c.html#aa1035aa668fabe3e095a515dd2fcc971">str_new</a>(klass, <a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(orig), <a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(orig));
<a name="l00694"></a>00694         <a class="code" href="../../d1/db0/string_8c.html#a0395d7e30463a34c3cd246ed51cb41a7">rb_enc_cr_str_exact_copy</a>(str, orig);
<a name="l00695"></a>00695         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3bf9ab455a1e0e3e8cfc6ebabd8f12df">OBJ_INFECT</a>(str, orig);
<a name="l00696"></a>00696     }
<a name="l00697"></a>00697     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d1/db0/string_8c.html#a6fc2cd334583cde7a99b5753c6ff18a4">STR_ASSOC_P</a>(orig)) {
<a name="l00698"></a>00698         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> assoc = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac695b0c61b18410ebcf22584fe0a6f6f">RSTRING</a>(orig)-&gt;as.heap.aux.shared;
<a name="l00699"></a>00699         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a6db7676c6cc4059a7cf021be34f53840">FL_UNSET</a>(orig, <a class="code" href="../../d8/d16/gc_8c.html#a2f2bd1a90a891cf8697328b4ba8d4d54">STR_ASSOC</a>);
<a name="l00700"></a>00700         str = str_new4(klass, orig);
<a name="l00701"></a>00701         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a38d7199dc0d1dc7f7207a9b3091c8d0d">FL_SET</a>(str, <a class="code" href="../../d8/d16/gc_8c.html#a2f2bd1a90a891cf8697328b4ba8d4d54">STR_ASSOC</a>);
<a name="l00702"></a>00702         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac695b0c61b18410ebcf22584fe0a6f6f">RSTRING</a>(str)-&gt;as.heap.aux.shared = assoc;
<a name="l00703"></a>00703     }
<a name="l00704"></a>00704     <span class="keywordflow">else</span> {
<a name="l00705"></a>00705         str = str_new4(klass, orig);
<a name="l00706"></a>00706     }
<a name="l00707"></a>00707     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a7ae8fa209abf837905d53c1c4be7c75d">OBJ_FREEZE</a>(str);
<a name="l00708"></a>00708     <span class="keywordflow">return</span> str;
<a name="l00709"></a>00709 }
<a name="l00710"></a>00710 
<a name="l00711"></a><a class="code" href="../../d1/db0/string_8c.html#a1afb928d12db6149d787e37d7ecb33f6">00711</a> <a class="code" href="../../d8/db0/defines_8h.html#a4e367f1663d56ddd63e2cb1a8a3449b1">RUBY_ALIAS_FUNCTION</a>(<a class="code" href="../../db/d2e/intern_8h.html#af609add406b0ef084a38f6dd615119d6">rb_str_new4</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> orig), <a class="code" href="../../db/d2e/intern_8h.html#ab771cea1c6187da7a08e9f0bc309a0a6">rb_str_new_frozen</a>, (orig))
<a name="l00712"></a>00712 <span class="preprocessor">#define rb_str_new4 rb_str_new_frozen</span>
<a name="l00713"></a>00713 <span class="preprocessor"></span>
<a name="l00714"></a>00714 <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l00715"></a>00715 <a class="code" href="../../db/d2e/intern_8h.html#a861351a1cb7ae75a5d8b1a0bcec057da">rb_str_new_with_class</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> obj, <span class="keyword">const</span> <span class="keywordtype">char</span> *ptr, <span class="keywordtype">long</span> <a class="code" href="../../d3/d15/name2ctype_8h.html#aed1cc4dca5d94cb452f79691f54f7423">len</a>)
<a name="l00716"></a>00716 {
<a name="l00717"></a>00717     <span class="keywordflow">return</span> <a class="code" href="../../d1/db0/string_8c.html#aa1035aa668fabe3e095a515dd2fcc971">str_new</a>(<a class="code" href="../../db/d2e/intern_8h.html#ac2be7243e739fa8f5dce6be0c8ee5f6d">rb_obj_class</a>(obj), ptr, len);
<a name="l00718"></a>00718 }
<a name="l00719"></a>00719 
<a name="l00720"></a><a class="code" href="../../d1/db0/string_8c.html#a3fef8aabe2cb43b22bf102979ec31601">00720</a> <a class="code" href="../../d8/db0/defines_8h.html#a4e367f1663d56ddd63e2cb1a8a3449b1">RUBY_ALIAS_FUNCTION</a>(<a class="code" href="../../db/d2e/intern_8h.html#a70b7301e6960c402803fa81c7a0777d0">rb_str_new5</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> obj, <span class="keyword">const</span> <span class="keywordtype">char</span> *ptr, <span class="keywordtype">long</span> <a class="code" href="../../d3/d15/name2ctype_8h.html#aed1cc4dca5d94cb452f79691f54f7423">len</a>),
<a name="l00721"></a>00721            <a class="code" href="../../db/d2e/intern_8h.html#a861351a1cb7ae75a5d8b1a0bcec057da">rb_str_new_with_class</a>, (obj, ptr, len))
<a name="l00722"></a>00722 <span class="preprocessor">#define rb_str_new5 rb_str_new_with_class</span>
<a name="l00723"></a>00723 <span class="preprocessor"></span>
<a name="l00724"></a>00724 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l00725"></a>00725 str_new_empty(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str)
<a name="l00726"></a>00726 {
<a name="l00727"></a>00727     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> v = <a class="code" href="../../db/d2e/intern_8h.html#a70b7301e6960c402803fa81c7a0777d0">rb_str_new5</a>(str, 0, 0);
<a name="l00728"></a>00728     <a class="code" href="../../d5/db5/encoding_8c.html#a626b498f5a765b3590ff5ed16765c8bb">rb_enc_copy</a>(v, str);
<a name="l00729"></a>00729     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3bf9ab455a1e0e3e8cfc6ebabd8f12df">OBJ_INFECT</a>(v, str);
<a name="l00730"></a>00730     <span class="keywordflow">return</span> v;
<a name="l00731"></a>00731 }
<a name="l00732"></a>00732 
<a name="l00733"></a><a class="code" href="../../d1/db0/string_8c.html#aea1fe372e557b759998bc2202f4d1d59">00733</a> <span class="preprocessor">#define STR_BUF_MIN_SIZE 128</span>
<a name="l00734"></a>00734 <span class="preprocessor"></span>
<a name="l00735"></a>00735 <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l00736"></a><a class="code" href="../../d1/db0/string_8c.html#ae7fd2c64471c09054c3cada7727174a5">00736</a> <a class="code" href="../../db/d2e/intern_8h.html#a65dee742ae2daaab92ac8974cb2fbff2">rb_str_buf_new</a>(<span class="keywordtype">long</span> capa)
<a name="l00737"></a>00737 {
<a name="l00738"></a>00738     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str = <a class="code" href="../../d1/db0/string_8c.html#a185714a3c1bc25c1a0df991fe6b44204">str_alloc</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a7d36c9c3e9faa34c27eb7f2eb9c874a8">rb_cString</a>);
<a name="l00739"></a>00739 
<a name="l00740"></a>00740     <span class="keywordflow">if</span> (capa &lt; <a class="code" href="../../d1/db0/string_8c.html#aea1fe372e557b759998bc2202f4d1d59">STR_BUF_MIN_SIZE</a>) {
<a name="l00741"></a>00741         capa = <a class="code" href="../../d1/db0/string_8c.html#aea1fe372e557b759998bc2202f4d1d59">STR_BUF_MIN_SIZE</a>;
<a name="l00742"></a>00742     }
<a name="l00743"></a>00743     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a38d7199dc0d1dc7f7207a9b3091c8d0d">FL_SET</a>(str, <a class="code" href="../../d1/db0/string_8c.html#ac8d3bdd1bdb620a40ed913619cdc7c6b">STR_NOEMBED</a>);
<a name="l00744"></a>00744     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac695b0c61b18410ebcf22584fe0a6f6f">RSTRING</a>(str)-&gt;as.heap.aux.capa = capa;
<a name="l00745"></a>00745     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac695b0c61b18410ebcf22584fe0a6f6f">RSTRING</a>(str)-&gt;as.heap.ptr = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a79041aa2bc7439c11906a86f82a52eb6">ALLOC_N</a>(<span class="keywordtype">char</span>, capa+1);
<a name="l00746"></a>00746     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac695b0c61b18410ebcf22584fe0a6f6f">RSTRING</a>(str)-&gt;as.heap.ptr[0] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l00747"></a>00747 
<a name="l00748"></a>00748     <span class="keywordflow">return</span> str;
<a name="l00749"></a>00749 }
<a name="l00750"></a>00750 
<a name="l00751"></a>00751 <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l00752"></a><a class="code" href="../../d1/db0/string_8c.html#a96345b2ca3aec78b13f9678d12340a02">00752</a> <a class="code" href="../../db/d2e/intern_8h.html#a8854acff4bbb9b50a3c83a493f353167">rb_str_buf_new_cstr</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *ptr)
<a name="l00753"></a>00753 {
<a name="l00754"></a>00754     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str;
<a name="l00755"></a>00755     <span class="keywordtype">long</span> len = <a class="code" href="../../d6/d7b/strchr_8c.html#a219836f542ce53545052bed5353820ca">strlen</a>(ptr);
<a name="l00756"></a>00756 
<a name="l00757"></a>00757     str = <a class="code" href="../../db/d2e/intern_8h.html#a65dee742ae2daaab92ac8974cb2fbff2">rb_str_buf_new</a>(len);
<a name="l00758"></a>00758     <a class="code" href="../../db/d2e/intern_8h.html#a4dff49e6d9aa925fd94fc5100b3c399b">rb_str_buf_cat</a>(str, ptr, len);
<a name="l00759"></a>00759 
<a name="l00760"></a>00760     <span class="keywordflow">return</span> str;
<a name="l00761"></a>00761 }
<a name="l00762"></a>00762 
<a name="l00763"></a><a class="code" href="../../d1/db0/string_8c.html#a85560ef1829b6524836d1a8a6c767f8b">00763</a> <a class="code" href="../../d8/db0/defines_8h.html#a4e367f1663d56ddd63e2cb1a8a3449b1">RUBY_ALIAS_FUNCTION</a>(<a class="code" href="../../db/d2e/intern_8h.html#a428d54807c6e5b98fa840f5e6d642355">rb_str_buf_new2</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *ptr), <a class="code" href="../../db/d2e/intern_8h.html#a8854acff4bbb9b50a3c83a493f353167">rb_str_buf_new_cstr</a>, (ptr))
<a name="l00764"></a>00764 <span class="preprocessor">#define rb_str_buf_new2 rb_str_buf_new_cstr</span>
<a name="l00765"></a>00765 <span class="preprocessor"></span>
<a name="l00766"></a>00766 <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l00767"></a>00767 <a class="code" href="../../db/d2e/intern_8h.html#a9c93a5402138185ceff87cb1f483c4f5">rb_str_tmp_new</a>(<span class="keywordtype">long</span> len)
<a name="l00768"></a>00768 {
<a name="l00769"></a>00769     <span class="keywordflow">return</span> <a class="code" href="../../d1/db0/string_8c.html#aa1035aa668fabe3e095a515dd2fcc971">str_new</a>(0, 0, len);
<a name="l00770"></a>00770 }
<a name="l00771"></a>00771 
<a name="l00772"></a>00772 <span class="keywordtype">void</span> *
<a name="l00773"></a><a class="code" href="../../d1/db0/string_8c.html#a444bf6cfeb841db77c328ba48e1a8e18">00773</a> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a444bf6cfeb841db77c328ba48e1a8e18">rb_alloc_tmp_buffer</a>(<span class="keyword">volatile</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> *store, <span class="keywordtype">long</span> len)
<a name="l00774"></a>00774 {
<a name="l00775"></a>00775     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> s = <a class="code" href="../../db/d2e/intern_8h.html#a9c93a5402138185ceff87cb1f483c4f5">rb_str_tmp_new</a>(len);
<a name="l00776"></a>00776     *store = s;
<a name="l00777"></a>00777     <span class="keywordflow">return</span> <a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(s);
<a name="l00778"></a>00778 }
<a name="l00779"></a>00779 
<a name="l00780"></a>00780 <span class="keywordtype">void</span>
<a name="l00781"></a><a class="code" href="../../d1/db0/string_8c.html#aec0988b9d2c82affd72778de7f26871b">00781</a> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aec0988b9d2c82affd72778de7f26871b">rb_free_tmp_buffer</a>(<span class="keyword">volatile</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> *store)
<a name="l00782"></a>00782 {
<a name="l00783"></a>00783     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> s = *store;
<a name="l00784"></a>00784     *store = 0;
<a name="l00785"></a>00785     <span class="keywordflow">if</span> (s) <a class="code" href="../../d1/db0/string_8c.html#ac5e2b2bfc50705ecea86d699d1a8dc15">rb_str_clear</a>(s);
<a name="l00786"></a>00786 }
<a name="l00787"></a>00787 
<a name="l00788"></a>00788 <span class="keywordtype">void</span>
<a name="l00789"></a><a class="code" href="../../d1/db0/string_8c.html#a0d9f0d76d388957aa67c2b1ef7cbff74">00789</a> <a class="code" href="../../db/d2e/intern_8h.html#a62f03b299bc2bbe479e3ab3c3ca76ad0">rb_str_free</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str)
<a name="l00790"></a>00790 {
<a name="l00791"></a>00791     <span class="keywordflow">if</span> (!<a class="code" href="../../d1/db0/string_8c.html#a0823acc422a6a849b53cf3ae0465b543">STR_EMBED_P</a>(str) &amp;&amp; !<a class="code" href="../../d1/db0/string_8c.html#a47a46c073102a116dc86fbe598a8694e">STR_SHARED_P</a>(str)) {
<a name="l00792"></a>00792         <a class="code" href="../../d8/db0/defines_8h.html#a2c3897f7c46ca54a2e0dd7b24a40c7cb">xfree</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac695b0c61b18410ebcf22584fe0a6f6f">RSTRING</a>(str)-&gt;as.heap.ptr);
<a name="l00793"></a>00793     }
<a name="l00794"></a>00794 }
<a name="l00795"></a>00795 
<a name="l00796"></a>00796 RUBY_FUNC_EXPORTED <span class="keywordtype">size_t</span>
<a name="l00797"></a><a class="code" href="../../d1/db0/string_8c.html#ad262d2b1cd1a5b131bd94b74895f4c09">00797</a> <a class="code" href="../../d3/d4e/objspace_8c.html#a35705693dcd6c61cd5d517c6526ba62c">rb_str_memsize</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str)
<a name="l00798"></a>00798 {
<a name="l00799"></a>00799     <span class="keywordflow">if</span> (!<a class="code" href="../../d1/db0/string_8c.html#a0823acc422a6a849b53cf3ae0465b543">STR_EMBED_P</a>(str) &amp;&amp; !<a class="code" href="../../d1/db0/string_8c.html#a47a46c073102a116dc86fbe598a8694e">STR_SHARED_P</a>(str)) {
<a name="l00800"></a>00800         <span class="keywordflow">return</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac695b0c61b18410ebcf22584fe0a6f6f">RSTRING</a>(str)-&gt;as.heap.aux.capa;
<a name="l00801"></a>00801     }
<a name="l00802"></a>00802     <span class="keywordflow">else</span> {
<a name="l00803"></a>00803         <span class="keywordflow">return</span> 0;
<a name="l00804"></a>00804     }
<a name="l00805"></a>00805 }
<a name="l00806"></a>00806 
<a name="l00807"></a>00807 <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l00808"></a><a class="code" href="../../d1/db0/string_8c.html#a5fc3f9cde32b449b9dfa71dc528a6b90">00808</a> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a068e98dc4a38f5462a01223a1ea63672">rb_str_to_str</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str)
<a name="l00809"></a>00809 {
<a name="l00810"></a>00810     <span class="keywordflow">return</span> <a class="code" href="../../db/d2e/intern_8h.html#a692c7c3caf5cdcf40d3812136f757fb5">rb_convert_type</a>(str, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a22a8c2a4bbaae9b68f65c9bb92fd4e39">T_STRING</a>, <span class="stringliteral">&quot;String&quot;</span>, <span class="stringliteral">&quot;to_str&quot;</span>);
<a name="l00811"></a>00811 }
<a name="l00812"></a>00812 
<a name="l00813"></a>00813 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="../../d1/db0/string_8c.html#a9324063c75002bd7b4cc10d80b77fff7">str_discard</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str);
<a name="l00814"></a>00814 
<a name="l00815"></a>00815 <span class="keywordtype">void</span>
<a name="l00816"></a><a class="code" href="../../d1/db0/string_8c.html#a3321b3b501c8b33c30082ca7161cb389">00816</a> <a class="code" href="../../db/d2e/intern_8h.html#a284132f9d055bd8adef45b71f26ee6ae">rb_str_shared_replace</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str2)
<a name="l00817"></a>00817 {
<a name="l00818"></a>00818     <a class="code" href="../../d1/d7b/struct_onig_encoding_type_s_t.html">rb_encoding</a> *enc;
<a name="l00819"></a>00819     <span class="keywordtype">int</span> cr;
<a name="l00820"></a>00820     <span class="keywordflow">if</span> (str == str2) <span class="keywordflow">return</span>;
<a name="l00821"></a>00821     enc = <a class="code" href="../../d1/db0/string_8c.html#a123891f9f9b0c87d15621d93b4fa9c41">STR_ENC_GET</a>(str2);
<a name="l00822"></a>00822     cr = <a class="code" href="../../d5/de3/encoding_8h.html#a5901233f6f9004aebbdeccdd33cf449f">ENC_CODERANGE</a>(str2);
<a name="l00823"></a>00823     <a class="code" href="../../d1/db0/string_8c.html#a9324063c75002bd7b4cc10d80b77fff7">str_discard</a>(str);
<a name="l00824"></a>00824     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3bf9ab455a1e0e3e8cfc6ebabd8f12df">OBJ_INFECT</a>(str, str2);
<a name="l00825"></a>00825     <span class="keywordflow">if</span> (<a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(str2) &lt;= <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a92657ad1be8a8a323df19648e33b47b5">RSTRING_EMBED_LEN_MAX</a>) {
<a name="l00826"></a>00826         <a class="code" href="../../d1/db0/string_8c.html#a598a41ca866cde6d9854bf77f48b006d">STR_SET_EMBED</a>(str);
<a name="l00827"></a>00827         memcpy(<a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(str), <a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(str2), <a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(str2)+1);
<a name="l00828"></a>00828         <a class="code" href="../../d1/db0/string_8c.html#ac1f52d89a2e4d0dda456490dcfe70993">STR_SET_EMBED_LEN</a>(str, <a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(str2));
<a name="l00829"></a>00829         <a class="code" href="../../d5/db5/encoding_8c.html#a150a6e3ac22ac3be8f8c2ccc74a28e7b">rb_enc_associate</a>(str, enc);
<a name="l00830"></a>00830         <a class="code" href="../../d5/de3/encoding_8h.html#aefe5772c0116cf7131a5227de7243dbc">ENC_CODERANGE_SET</a>(str, cr);
<a name="l00831"></a>00831         <span class="keywordflow">return</span>;
<a name="l00832"></a>00832     }
<a name="l00833"></a>00833     <a class="code" href="../../d1/db0/string_8c.html#a220a3ea405f8427a2b119e8cda01524e">STR_SET_NOEMBED</a>(str);
<a name="l00834"></a>00834     <a class="code" href="../../d1/db0/string_8c.html#a6b683fdd88d6effd1f5391040bc32b3f">STR_UNSET_NOCAPA</a>(str);
<a name="l00835"></a>00835     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac695b0c61b18410ebcf22584fe0a6f6f">RSTRING</a>(str)-&gt;as.heap.ptr = <a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(str2);
<a name="l00836"></a>00836     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac695b0c61b18410ebcf22584fe0a6f6f">RSTRING</a>(str)-&gt;as.heap.len = <a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(str2);
<a name="l00837"></a>00837     <span class="keywordflow">if</span> (<a class="code" href="../../d1/db0/string_8c.html#a2e4889499fa17d4a63dc76b35f4b208e">STR_NOCAPA_P</a>(str2)) {
<a name="l00838"></a>00838         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a38d7199dc0d1dc7f7207a9b3091c8d0d">FL_SET</a>(str, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a1d4c05021aacd8cab989ff60f95ebe2d">RBASIC</a>(str2)-&gt;flags &amp; <a class="code" href="../../d1/db0/string_8c.html#a082d04ab7df240d55d9c8126a81cc9b6">STR_NOCAPA</a>);
<a name="l00839"></a>00839         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac695b0c61b18410ebcf22584fe0a6f6f">RSTRING</a>(str)-&gt;as.heap.aux.shared = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac695b0c61b18410ebcf22584fe0a6f6f">RSTRING</a>(str2)-&gt;as.heap.aux.shared;
<a name="l00840"></a>00840     }
<a name="l00841"></a>00841     <span class="keywordflow">else</span> {
<a name="l00842"></a>00842         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac695b0c61b18410ebcf22584fe0a6f6f">RSTRING</a>(str)-&gt;as.heap.aux.capa = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac695b0c61b18410ebcf22584fe0a6f6f">RSTRING</a>(str2)-&gt;as.heap.aux.capa;
<a name="l00843"></a>00843     }
<a name="l00844"></a>00844     <a class="code" href="../../d1/db0/string_8c.html#a598a41ca866cde6d9854bf77f48b006d">STR_SET_EMBED</a>(str2);        <span class="comment">/* abandon str2 */</span>
<a name="l00845"></a>00845     <a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(str2)[0] = 0;
<a name="l00846"></a>00846     <a class="code" href="../../d1/db0/string_8c.html#ac1f52d89a2e4d0dda456490dcfe70993">STR_SET_EMBED_LEN</a>(str2, 0);
<a name="l00847"></a>00847     <a class="code" href="../../d5/db5/encoding_8c.html#a150a6e3ac22ac3be8f8c2ccc74a28e7b">rb_enc_associate</a>(str, enc);
<a name="l00848"></a>00848     <a class="code" href="../../d5/de3/encoding_8h.html#aefe5772c0116cf7131a5227de7243dbc">ENC_CODERANGE_SET</a>(str, cr);
<a name="l00849"></a>00849 }
<a name="l00850"></a>00850 
<a name="l00851"></a><a class="code" href="../../d1/db0/string_8c.html#ad1aaf2d2c5bc8f00dcfa470bb55c49f0">00851</a> <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#afa5b9137f051ac26d7ccc8824f178233">ID</a> <a class="code" href="../../d1/db0/string_8c.html#ad1aaf2d2c5bc8f00dcfa470bb55c49f0">id_to_s</a>;
<a name="l00852"></a>00852 
<a name="l00853"></a>00853 <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l00854"></a><a class="code" href="../../d1/db0/string_8c.html#aff7ab0694dc051eb361bdc18518de2f6">00854</a> <a class="code" href="../../db/d2e/intern_8h.html#acae5350f5d539c4654e4e33690256a9f">rb_obj_as_string</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> obj)
<a name="l00855"></a>00855 {
<a name="l00856"></a>00856     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str;
<a name="l00857"></a>00857 
<a name="l00858"></a>00858     <span class="keywordflow">if</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a394faf7191f18552a20cb17ce14226f0">TYPE</a>(obj) == <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a22a8c2a4bbaae9b68f65c9bb92fd4e39">T_STRING</a>) {
<a name="l00859"></a>00859         <span class="keywordflow">return</span> obj;
<a name="l00860"></a>00860     }
<a name="l00861"></a>00861     str = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a6a973fe624aa9aa9ba0cdeb6792d3187" title="Calls a method.">rb_funcall</a>(obj, id_to_s, 0);
<a name="l00862"></a>00862     <span class="keywordflow">if</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a394faf7191f18552a20cb17ce14226f0">TYPE</a>(str) != <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a22a8c2a4bbaae9b68f65c9bb92fd4e39">T_STRING</a>)
<a name="l00863"></a>00863         <span class="keywordflow">return</span> <a class="code" href="../../db/d2e/intern_8h.html#a24afa0db60cabea2fb47545b1ff9edf4">rb_any_to_s</a>(obj);
<a name="l00864"></a>00864     <span class="keywordflow">if</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a621bc62b1fd82640c1078daf90e1c061">OBJ_TAINTED</a>(obj)) <a class="code" href="../../de/de6/ruby_2ruby_8h.html#afd75ea0cb81c17e76c73e593d1d8a860">OBJ_TAINT</a>(str);
<a name="l00865"></a>00865     <span class="keywordflow">return</span> str;
<a name="l00866"></a>00866 }
<a name="l00867"></a>00867 
<a name="l00868"></a>00868 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l00869"></a><a class="code" href="../../d1/db0/string_8c.html#a357da4e1cf3dd6b4df807598603187ea">00869</a> <a class="code" href="../../d1/db0/string_8c.html#a357da4e1cf3dd6b4df807598603187ea">str_replace</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str2)
<a name="l00870"></a>00870 {
<a name="l00871"></a>00871     <span class="keywordtype">long</span> len;
<a name="l00872"></a>00872 
<a name="l00873"></a>00873     len = <a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(str2);
<a name="l00874"></a>00874     <span class="keywordflow">if</span> (<a class="code" href="../../d1/db0/string_8c.html#a6fc2cd334583cde7a99b5753c6ff18a4">STR_ASSOC_P</a>(str2)) {
<a name="l00875"></a>00875         str2 = <a class="code" href="../../db/d2e/intern_8h.html#af609add406b0ef084a38f6dd615119d6">rb_str_new4</a>(str2);
<a name="l00876"></a>00876     }
<a name="l00877"></a>00877     <span class="keywordflow">if</span> (<a class="code" href="../../d1/db0/string_8c.html#a47a46c073102a116dc86fbe598a8694e">STR_SHARED_P</a>(str2)) {
<a name="l00878"></a>00878         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> shared = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac695b0c61b18410ebcf22584fe0a6f6f">RSTRING</a>(str2)-&gt;as.heap.aux.shared;
<a name="l00879"></a>00879         <a class="code" href="../../d5/dac/ossl_8h.html#acdcc5aaebf3f273c1762f24a6ece2e5e">assert</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a73db79f74bad2fb5258a2ae7ee6ef117">OBJ_FROZEN</a>(shared));
<a name="l00880"></a>00880         <a class="code" href="../../d1/db0/string_8c.html#a220a3ea405f8427a2b119e8cda01524e">STR_SET_NOEMBED</a>(str);
<a name="l00881"></a>00881         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac695b0c61b18410ebcf22584fe0a6f6f">RSTRING</a>(str)-&gt;as.heap.len = len;
<a name="l00882"></a>00882         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac695b0c61b18410ebcf22584fe0a6f6f">RSTRING</a>(str)-&gt;as.heap.ptr = <a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(str2);
<a name="l00883"></a>00883         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a38d7199dc0d1dc7f7207a9b3091c8d0d">FL_SET</a>(str, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a4f77ed51d02515ee27ce9fca7880ce8f">ELTS_SHARED</a>);
<a name="l00884"></a>00884         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a6db7676c6cc4059a7cf021be34f53840">FL_UNSET</a>(str, <a class="code" href="../../d8/d16/gc_8c.html#a2f2bd1a90a891cf8697328b4ba8d4d54">STR_ASSOC</a>);
<a name="l00885"></a>00885         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac695b0c61b18410ebcf22584fe0a6f6f">RSTRING</a>(str)-&gt;as.heap.aux.shared = shared;
<a name="l00886"></a>00886     }
<a name="l00887"></a>00887     <span class="keywordflow">else</span> {
<a name="l00888"></a>00888         <a class="code" href="../../d1/db0/string_8c.html#a39c736f7e85cc49de282dbed52cbd799">str_replace_shared</a>(str, str2);
<a name="l00889"></a>00889     }
<a name="l00890"></a>00890 
<a name="l00891"></a>00891     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3bf9ab455a1e0e3e8cfc6ebabd8f12df">OBJ_INFECT</a>(str, str2);
<a name="l00892"></a>00892     <a class="code" href="../../d1/db0/string_8c.html#a0395d7e30463a34c3cd246ed51cb41a7">rb_enc_cr_str_exact_copy</a>(str, str2);
<a name="l00893"></a>00893     <span class="keywordflow">return</span> str;
<a name="l00894"></a>00894 }
<a name="l00895"></a>00895 
<a name="l00896"></a>00896 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l00897"></a><a class="code" href="../../d1/db0/string_8c.html#af9b5e11f0eeedf21b644d72282953438">00897</a> <a class="code" href="../../d1/db0/string_8c.html#af9b5e11f0eeedf21b644d72282953438">str_duplicate</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> klass, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str)
<a name="l00898"></a>00898 {
<a name="l00899"></a>00899     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> dup = <a class="code" href="../../d1/db0/string_8c.html#a185714a3c1bc25c1a0df991fe6b44204">str_alloc</a>(klass);
<a name="l00900"></a>00900     <a class="code" href="../../d1/db0/string_8c.html#a357da4e1cf3dd6b4df807598603187ea">str_replace</a>(dup, str);
<a name="l00901"></a>00901     <span class="keywordflow">return</span> dup;
<a name="l00902"></a>00902 }
<a name="l00903"></a>00903 
<a name="l00904"></a>00904 <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l00905"></a><a class="code" href="../../d1/db0/string_8c.html#a5c9b8acdc03c0dad1cb371762e6ac5dc">00905</a> <a class="code" href="../../db/d2e/intern_8h.html#ae2843c766c24b80116bb127ebf22d5bf">rb_str_dup</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str)
<a name="l00906"></a>00906 {
<a name="l00907"></a>00907     <span class="keywordflow">return</span> <a class="code" href="../../d1/db0/string_8c.html#af9b5e11f0eeedf21b644d72282953438">str_duplicate</a>(<a class="code" href="../../db/d2e/intern_8h.html#ac2be7243e739fa8f5dce6be0c8ee5f6d">rb_obj_class</a>(str), str);
<a name="l00908"></a>00908 }
<a name="l00909"></a>00909 
<a name="l00910"></a>00910 <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l00911"></a><a class="code" href="../../d1/db0/string_8c.html#a682a7356c3dcf8faf21dcff7439312c4">00911</a> <a class="code" href="../../db/d2e/intern_8h.html#a682a7356c3dcf8faf21dcff7439312c4">rb_str_resurrect</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str)
<a name="l00912"></a>00912 {
<a name="l00913"></a>00913     <span class="keywordflow">return</span> <a class="code" href="../../d1/db0/string_8c.html#a357da4e1cf3dd6b4df807598603187ea">str_replace</a>(<a class="code" href="../../d1/db0/string_8c.html#a185714a3c1bc25c1a0df991fe6b44204">str_alloc</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a7d36c9c3e9faa34c27eb7f2eb9c874a8">rb_cString</a>), str);
<a name="l00914"></a>00914 }
<a name="l00915"></a>00915 
<a name="l00916"></a>00916 <span class="comment">/*</span>
<a name="l00917"></a>00917 <span class="comment"> *  call-seq:</span>
<a name="l00918"></a>00918 <span class="comment"> *     String.new(str=&quot;&quot;)   -&gt; new_str</span>
<a name="l00919"></a>00919 <span class="comment"> *</span>
<a name="l00920"></a>00920 <span class="comment"> *  Returns a new string object containing a copy of &lt;i&gt;str&lt;/i&gt;.</span>
<a name="l00921"></a>00921 <span class="comment"> */</span>
<a name="l00922"></a>00922 
<a name="l00923"></a>00923 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l00924"></a><a class="code" href="../../d1/db0/string_8c.html#a7d557e0b93d4162d80daac2ccc494b1c">00924</a> <a class="code" href="../../d1/db0/string_8c.html#a7d557e0b93d4162d80daac2ccc494b1c">rb_str_init</a>(<span class="keywordtype">int</span> <a class="code" href="../../df/d77/ruby_8c.html#ad1447518f4372828b8435ae82e48499e">argc</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> *<a class="code" href="../../df/d77/ruby_8c.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str)
<a name="l00925"></a>00925 {
<a name="l00926"></a>00926     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> orig;
<a name="l00927"></a>00927 
<a name="l00928"></a>00928     <span class="keywordflow">if</span> (argc &gt; 0 &amp;&amp; <a class="code" href="../../d7/d19/group__defmethod.html#gaa7bed88640f01bee619f85fda09d28d7">rb_scan_args</a>(argc, argv, <span class="stringliteral">&quot;01&quot;</span>, &amp;orig) == 1)
<a name="l00929"></a>00929         <a class="code" href="../../db/d2e/intern_8h.html#a5ea7db726948a2669aaa95cff05e050b">rb_str_replace</a>(str, orig);
<a name="l00930"></a>00930     <span class="keywordflow">return</span> str;
<a name="l00931"></a>00931 }
<a name="l00932"></a>00932 
<a name="l00933"></a>00933 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">long</span>
<a name="l00934"></a><a class="code" href="../../d1/db0/string_8c.html#a19cd61bcffaaf77eb3e1a0bc24c318e2">00934</a> <a class="code" href="../../d1/db0/string_8c.html#a19cd61bcffaaf77eb3e1a0bc24c318e2">enc_strlen</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *p, <span class="keyword">const</span> <span class="keywordtype">char</span> *e, <a class="code" href="../../d1/d7b/struct_onig_encoding_type_s_t.html">rb_encoding</a> *enc, <span class="keywordtype">int</span> cr)
<a name="l00935"></a>00935 {
<a name="l00936"></a>00936     <span class="keywordtype">long</span> c;
<a name="l00937"></a>00937     <span class="keyword">const</span> <span class="keywordtype">char</span> *q;
<a name="l00938"></a>00938 
<a name="l00939"></a>00939     <span class="keywordflow">if</span> (<a class="code" href="../../d5/de3/encoding_8h.html#a6b942f8457214c49fcf8541c60a38306">rb_enc_mbmaxlen</a>(enc) == <a class="code" href="../../d5/de3/encoding_8h.html#aaffb0395eb9bf0b3ba3175fa5c9c1615">rb_enc_mbminlen</a>(enc)) {
<a name="l00940"></a>00940         <span class="keywordflow">return</span> (e - p + <a class="code" href="../../d5/de3/encoding_8h.html#aaffb0395eb9bf0b3ba3175fa5c9c1615">rb_enc_mbminlen</a>(enc) - 1) / <a class="code" href="../../d5/de3/encoding_8h.html#aaffb0395eb9bf0b3ba3175fa5c9c1615">rb_enc_mbminlen</a>(enc);
<a name="l00941"></a>00941     }
<a name="l00942"></a>00942     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d5/de3/encoding_8h.html#a8b18a09a3055d3006c6d5baeaa6e7c72">rb_enc_asciicompat</a>(enc)) {
<a name="l00943"></a>00943         c = 0;
<a name="l00944"></a>00944         <span class="keywordflow">if</span> (cr == <a class="code" href="../../d5/de3/encoding_8h.html#a0a0e73a2d98205044e1ad19432502c5b">ENC_CODERANGE_7BIT</a> || cr == <a class="code" href="../../d5/de3/encoding_8h.html#a0c81a12daaa1e57009d46b9d906957dc">ENC_CODERANGE_VALID</a>) {
<a name="l00945"></a>00945             <span class="keywordflow">while</span> (p &lt; e) {
<a name="l00946"></a>00946                 <span class="keywordflow">if</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#af96ff81718c3c27b342b5958fac6cb7e">ISASCII</a>(*p)) {
<a name="l00947"></a>00947                     q = <a class="code" href="../../d1/db0/string_8c.html#a09d26a98b1b2071c40e71eb556d87814">search_nonascii</a>(p, e);
<a name="l00948"></a>00948                     <span class="keywordflow">if</span> (!q)
<a name="l00949"></a>00949                         <span class="keywordflow">return</span> c + (e - p);
<a name="l00950"></a>00950                     c += q - p;
<a name="l00951"></a>00951                     p = q;
<a name="l00952"></a>00952                 }
<a name="l00953"></a>00953                 p += <a class="code" href="../../d5/db5/encoding_8c.html#a405ec52962866fac46a16f02f3f92832">rb_enc_fast_mbclen</a>(p, e, enc);
<a name="l00954"></a>00954                 c++;
<a name="l00955"></a>00955             }
<a name="l00956"></a>00956         }
<a name="l00957"></a>00957         <span class="keywordflow">else</span> {
<a name="l00958"></a>00958             <span class="keywordflow">while</span> (p &lt; e) {
<a name="l00959"></a>00959                 <span class="keywordflow">if</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#af96ff81718c3c27b342b5958fac6cb7e">ISASCII</a>(*p)) {
<a name="l00960"></a>00960                     q = <a class="code" href="../../d1/db0/string_8c.html#a09d26a98b1b2071c40e71eb556d87814">search_nonascii</a>(p, e);
<a name="l00961"></a>00961                     <span class="keywordflow">if</span> (!q)
<a name="l00962"></a>00962                         <span class="keywordflow">return</span> c + (e - p);
<a name="l00963"></a>00963                     c += q - p;
<a name="l00964"></a>00964                     p = q;
<a name="l00965"></a>00965                 }
<a name="l00966"></a>00966                 p += <a class="code" href="../../d5/db5/encoding_8c.html#aa91c0fa3dfdfe3c55fcaa6029c35bbb8">rb_enc_mbclen</a>(p, e, enc);
<a name="l00967"></a>00967                 c++;
<a name="l00968"></a>00968             }
<a name="l00969"></a>00969         }
<a name="l00970"></a>00970         <span class="keywordflow">return</span> c;
<a name="l00971"></a>00971     }
<a name="l00972"></a>00972 
<a name="l00973"></a>00973     <span class="keywordflow">for</span> (c=0; p&lt;e; c++) {
<a name="l00974"></a>00974         p += <a class="code" href="../../d5/db5/encoding_8c.html#aa91c0fa3dfdfe3c55fcaa6029c35bbb8">rb_enc_mbclen</a>(p, e, enc);
<a name="l00975"></a>00975     }
<a name="l00976"></a>00976     <span class="keywordflow">return</span> c;
<a name="l00977"></a>00977 }
<a name="l00978"></a>00978 
<a name="l00979"></a>00979 <span class="keywordtype">long</span>
<a name="l00980"></a><a class="code" href="../../d1/db0/string_8c.html#a2ae2ee334cef827e5f3540e9b01fc2fe">00980</a> <a class="code" href="../../d5/de3/encoding_8h.html#aba107c1e47e71912eaeaf10539bf02b1">rb_enc_strlen</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *p, <span class="keyword">const</span> <span class="keywordtype">char</span> *e, <a class="code" href="../../d1/d7b/struct_onig_encoding_type_s_t.html">rb_encoding</a> *enc)
<a name="l00981"></a>00981 {
<a name="l00982"></a>00982     <span class="keywordflow">return</span> <a class="code" href="../../d1/db0/string_8c.html#a19cd61bcffaaf77eb3e1a0bc24c318e2">enc_strlen</a>(p, e, enc, <a class="code" href="../../d5/de3/encoding_8h.html#a60de9709709968f9627365a6cd0ff5d1">ENC_CODERANGE_UNKNOWN</a>);
<a name="l00983"></a>00983 }
<a name="l00984"></a>00984 
<a name="l00985"></a>00985 <span class="keywordtype">long</span>
<a name="l00986"></a><a class="code" href="../../d1/db0/string_8c.html#af61df713028687275f0379577f59057d">00986</a> <a class="code" href="../../d1/db0/string_8c.html#af61df713028687275f0379577f59057d">rb_enc_strlen_cr</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *p, <span class="keyword">const</span> <span class="keywordtype">char</span> *e, <a class="code" href="../../d1/d7b/struct_onig_encoding_type_s_t.html">rb_encoding</a> *enc, <span class="keywordtype">int</span> *cr)
<a name="l00987"></a>00987 {
<a name="l00988"></a>00988     <span class="keywordtype">long</span> c;
<a name="l00989"></a>00989     <span class="keyword">const</span> <span class="keywordtype">char</span> *q;
<a name="l00990"></a>00990     <span class="keywordtype">int</span> ret;
<a name="l00991"></a>00991 
<a name="l00992"></a>00992     *cr = 0;
<a name="l00993"></a>00993     <span class="keywordflow">if</span> (<a class="code" href="../../d5/de3/encoding_8h.html#a6b942f8457214c49fcf8541c60a38306">rb_enc_mbmaxlen</a>(enc) == <a class="code" href="../../d5/de3/encoding_8h.html#aaffb0395eb9bf0b3ba3175fa5c9c1615">rb_enc_mbminlen</a>(enc)) {
<a name="l00994"></a>00994         <span class="keywordflow">return</span> (e - p + <a class="code" href="../../d5/de3/encoding_8h.html#aaffb0395eb9bf0b3ba3175fa5c9c1615">rb_enc_mbminlen</a>(enc) - 1) / <a class="code" href="../../d5/de3/encoding_8h.html#aaffb0395eb9bf0b3ba3175fa5c9c1615">rb_enc_mbminlen</a>(enc);
<a name="l00995"></a>00995     }
<a name="l00996"></a>00996     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d5/de3/encoding_8h.html#a8b18a09a3055d3006c6d5baeaa6e7c72">rb_enc_asciicompat</a>(enc)) {
<a name="l00997"></a>00997         c = 0;
<a name="l00998"></a>00998         <span class="keywordflow">while</span> (p &lt; e) {
<a name="l00999"></a>00999             <span class="keywordflow">if</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#af96ff81718c3c27b342b5958fac6cb7e">ISASCII</a>(*p)) {
<a name="l01000"></a>01000                 q = <a class="code" href="../../d1/db0/string_8c.html#a09d26a98b1b2071c40e71eb556d87814">search_nonascii</a>(p, e);
<a name="l01001"></a>01001                 <span class="keywordflow">if</span> (!q) {
<a name="l01002"></a>01002                     <span class="keywordflow">if</span> (!*cr) *cr = <a class="code" href="../../d5/de3/encoding_8h.html#a0a0e73a2d98205044e1ad19432502c5b">ENC_CODERANGE_7BIT</a>;
<a name="l01003"></a>01003                     <span class="keywordflow">return</span> c + (e - p);
<a name="l01004"></a>01004                 }
<a name="l01005"></a>01005                 c += q - p;
<a name="l01006"></a>01006                 p = q;
<a name="l01007"></a>01007             }
<a name="l01008"></a>01008             ret = <a class="code" href="../../d5/db5/encoding_8c.html#a0c6003b6aeaed218d841974b00c95870">rb_enc_precise_mbclen</a>(p, e, enc);
<a name="l01009"></a>01009             <span class="keywordflow">if</span> (<a class="code" href="../../d5/de3/encoding_8h.html#ac3dcc15c5ed42d6590e1c1f91b74165c">MBCLEN_CHARFOUND_P</a>(ret)) {
<a name="l01010"></a>01010                 *cr |= <a class="code" href="../../d5/de3/encoding_8h.html#a0c81a12daaa1e57009d46b9d906957dc">ENC_CODERANGE_VALID</a>;
<a name="l01011"></a>01011                 p += <a class="code" href="../../d5/de3/encoding_8h.html#a877f84ae22293dae2a8cf1e26ea5b1a6">MBCLEN_CHARFOUND_LEN</a>(ret);
<a name="l01012"></a>01012             }
<a name="l01013"></a>01013             <span class="keywordflow">else</span> {
<a name="l01014"></a>01014                 *cr = <a class="code" href="../../d5/de3/encoding_8h.html#abb86fbc02fc2b78d928825ea6d6922f9">ENC_CODERANGE_BROKEN</a>;
<a name="l01015"></a>01015                 p++;
<a name="l01016"></a>01016             }
<a name="l01017"></a>01017             c++;
<a name="l01018"></a>01018         }
<a name="l01019"></a>01019         <span class="keywordflow">if</span> (!*cr) *cr = <a class="code" href="../../d5/de3/encoding_8h.html#a0a0e73a2d98205044e1ad19432502c5b">ENC_CODERANGE_7BIT</a>;
<a name="l01020"></a>01020         <span class="keywordflow">return</span> c;
<a name="l01021"></a>01021     }
<a name="l01022"></a>01022 
<a name="l01023"></a>01023     <span class="keywordflow">for</span> (c=0; p&lt;e; c++) {
<a name="l01024"></a>01024         ret = <a class="code" href="../../d5/db5/encoding_8c.html#a0c6003b6aeaed218d841974b00c95870">rb_enc_precise_mbclen</a>(p, e, enc);
<a name="l01025"></a>01025         <span class="keywordflow">if</span> (<a class="code" href="../../d5/de3/encoding_8h.html#ac3dcc15c5ed42d6590e1c1f91b74165c">MBCLEN_CHARFOUND_P</a>(ret)) {
<a name="l01026"></a>01026             *cr |= <a class="code" href="../../d5/de3/encoding_8h.html#a0c81a12daaa1e57009d46b9d906957dc">ENC_CODERANGE_VALID</a>;
<a name="l01027"></a>01027             p += <a class="code" href="../../d5/de3/encoding_8h.html#a877f84ae22293dae2a8cf1e26ea5b1a6">MBCLEN_CHARFOUND_LEN</a>(ret);
<a name="l01028"></a>01028         }
<a name="l01029"></a>01029         <span class="keywordflow">else</span> {
<a name="l01030"></a>01030             *cr = <a class="code" href="../../d5/de3/encoding_8h.html#abb86fbc02fc2b78d928825ea6d6922f9">ENC_CODERANGE_BROKEN</a>;
<a name="l01031"></a>01031             <span class="keywordflow">if</span> (p + <a class="code" href="../../d5/de3/encoding_8h.html#aaffb0395eb9bf0b3ba3175fa5c9c1615">rb_enc_mbminlen</a>(enc) &lt;= e)
<a name="l01032"></a>01032                 p += <a class="code" href="../../d5/de3/encoding_8h.html#aaffb0395eb9bf0b3ba3175fa5c9c1615">rb_enc_mbminlen</a>(enc);
<a name="l01033"></a>01033             <span class="keywordflow">else</span>
<a name="l01034"></a>01034                 p = e;
<a name="l01035"></a>01035         }
<a name="l01036"></a>01036     }
<a name="l01037"></a>01037     <span class="keywordflow">if</span> (!*cr) *cr = <a class="code" href="../../d5/de3/encoding_8h.html#a0a0e73a2d98205044e1ad19432502c5b">ENC_CODERANGE_7BIT</a>;
<a name="l01038"></a>01038     <span class="keywordflow">return</span> c;
<a name="l01039"></a>01039 }
<a name="l01040"></a>01040 
<a name="l01041"></a>01041 <span class="preprocessor">#ifdef NONASCII_MASK</span>
<a name="l01042"></a>01042 <span class="preprocessor"></span><span class="preprocessor">#define is_utf8_lead_byte(c) (((c)&amp;0xC0) != 0x80)</span>
<a name="l01043"></a>01043 <span class="preprocessor"></span>
<a name="l01044"></a>01044 <span class="comment">/*</span>
<a name="l01045"></a>01045 <span class="comment"> * UTF-8 leading bytes have either 0xxxxxxx or 11xxxxxx</span>
<a name="l01046"></a>01046 <span class="comment"> * bit represention. (see http://en.wikipedia.org/wiki/UTF-8)</span>
<a name="l01047"></a>01047 <span class="comment"> * Therefore, following pseudo code can detect UTF-8 leading byte.</span>
<a name="l01048"></a>01048 <span class="comment"> *</span>
<a name="l01049"></a>01049 <span class="comment"> * if (!(byte &amp; 0x80))</span>
<a name="l01050"></a>01050 <span class="comment"> *   byte |= 0x40;          // turn on bit6</span>
<a name="l01051"></a>01051 <span class="comment"> * return ((byte&gt;&gt;6) &amp; 1);  // bit6 represent it&apos;s leading byte or not.</span>
<a name="l01052"></a>01052 <span class="comment"> *</span>
<a name="l01053"></a>01053 <span class="comment"> * This function calculate every bytes in the argument word `s&apos;</span>
<a name="l01054"></a>01054 <span class="comment"> * using the above logic concurrently. and gather every bytes result.</span>
<a name="l01055"></a>01055 <span class="comment"> */</span>
<a name="l01056"></a>01056 <span class="keyword">static</span> <span class="keyword">inline</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l01057"></a>01057 count_utf8_lead_bytes_with_word(<span class="keyword">const</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> *s)
<a name="l01058"></a>01058 {
<a name="l01059"></a>01059     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> d = *s;
<a name="l01060"></a>01060 
<a name="l01061"></a>01061     <span class="comment">/* Transform into bit0 represent UTF-8 leading or not. */</span>
<a name="l01062"></a>01062     d |= ~(d&gt;&gt;1);
<a name="l01063"></a>01063     d &gt;&gt;= 6;
<a name="l01064"></a>01064     d &amp;= NONASCII_MASK &gt;&gt; 7;
<a name="l01065"></a>01065 
<a name="l01066"></a>01066     <span class="comment">/* Gather every bytes. */</span>
<a name="l01067"></a>01067     d += (d&gt;&gt;8);
<a name="l01068"></a>01068     d += (d&gt;&gt;16);
<a name="l01069"></a>01069 <span class="preprocessor">#if SIZEOF_VALUE == 8</span>
<a name="l01070"></a>01070 <span class="preprocessor"></span>    d += (d&gt;&gt;32);
<a name="l01071"></a>01071 <span class="preprocessor">#endif</span>
<a name="l01072"></a>01072 <span class="preprocessor"></span>    <span class="keywordflow">return</span> (d&amp;0xF);
<a name="l01073"></a>01073 }
<a name="l01074"></a>01074 <span class="preprocessor">#endif</span>
<a name="l01075"></a>01075 <span class="preprocessor"></span>
<a name="l01076"></a>01076 <span class="keyword">static</span> <span class="keywordtype">long</span>
<a name="l01077"></a><a class="code" href="../../d1/db0/string_8c.html#abe68504f1d38108a10f267f4358c53db">01077</a> <a class="code" href="../../d1/db0/string_8c.html#abe68504f1d38108a10f267f4358c53db">str_strlen</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str, <a class="code" href="../../d1/d7b/struct_onig_encoding_type_s_t.html">rb_encoding</a> *enc)
<a name="l01078"></a>01078 {
<a name="l01079"></a>01079     <span class="keyword">const</span> <span class="keywordtype">char</span> *p, *e;
<a name="l01080"></a>01080     <span class="keywordtype">long</span> n;
<a name="l01081"></a>01081     <span class="keywordtype">int</span> cr;
<a name="l01082"></a>01082 
<a name="l01083"></a>01083     <span class="keywordflow">if</span> (<a class="code" href="../../d1/db0/string_8c.html#a5ab3c8112c2ec6943bdae8a2036fca02">single_byte_optimizable</a>(str)) <span class="keywordflow">return</span> <a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(str);
<a name="l01084"></a>01084     <span class="keywordflow">if</span> (!enc) enc = <a class="code" href="../../d1/db0/string_8c.html#a123891f9f9b0c87d15621d93b4fa9c41">STR_ENC_GET</a>(str);
<a name="l01085"></a>01085     p = <a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(str);
<a name="l01086"></a>01086     e = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a35bfa2635774977edad0a16b9fdebbaf">RSTRING_END</a>(str);
<a name="l01087"></a>01087     cr = <a class="code" href="../../d5/de3/encoding_8h.html#a5901233f6f9004aebbdeccdd33cf449f">ENC_CODERANGE</a>(str);
<a name="l01088"></a>01088 <span class="preprocessor">#ifdef NONASCII_MASK</span>
<a name="l01089"></a>01089 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (<a class="code" href="../../d5/de3/encoding_8h.html#a5901233f6f9004aebbdeccdd33cf449f">ENC_CODERANGE</a>(str) == <a class="code" href="../../d5/de3/encoding_8h.html#a0c81a12daaa1e57009d46b9d906957dc">ENC_CODERANGE_VALID</a> &amp;&amp;
<a name="l01090"></a>01090         enc == <a class="code" href="../../d5/db5/encoding_8c.html#a893004271cf8c790ca40c4712261aa8c">rb_utf8_encoding</a>()) {
<a name="l01091"></a>01091 
<a name="l01092"></a>01092         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> len = 0;
<a name="l01093"></a>01093         <span class="keywordflow">if</span> ((<span class="keywordtype">int</span>)<span class="keyword">sizeof</span>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>) * 2 &lt; e - p) {
<a name="l01094"></a>01094             <span class="keyword">const</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> *s, *t;
<a name="l01095"></a>01095             <span class="keyword">const</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> lowbits = <span class="keyword">sizeof</span>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>) - 1;
<a name="l01096"></a>01096             s = (<span class="keyword">const</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>*)(~lowbits &amp; ((<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>)p + lowbits));
<a name="l01097"></a>01097             t = (<span class="keyword">const</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>*)(~lowbits &amp; (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>)e);
<a name="l01098"></a>01098             <span class="keywordflow">while</span> (p &lt; (<span class="keyword">const</span> <span class="keywordtype">char</span> *)s) {
<a name="l01099"></a>01099                 <span class="keywordflow">if</span> (is_utf8_lead_byte(*p)) len++;
<a name="l01100"></a>01100                 p++;
<a name="l01101"></a>01101             }
<a name="l01102"></a>01102             <span class="keywordflow">while</span> (s &lt; t) {
<a name="l01103"></a>01103                 len += count_utf8_lead_bytes_with_word(s);
<a name="l01104"></a>01104                 s++;
<a name="l01105"></a>01105             }
<a name="l01106"></a>01106             p = (<span class="keyword">const</span> <span class="keywordtype">char</span> *)s;
<a name="l01107"></a>01107         }
<a name="l01108"></a>01108         <span class="keywordflow">while</span> (p &lt; e) {
<a name="l01109"></a>01109             <span class="keywordflow">if</span> (is_utf8_lead_byte(*p)) len++;
<a name="l01110"></a>01110             p++;
<a name="l01111"></a>01111         }
<a name="l01112"></a>01112         <span class="keywordflow">return</span> (<span class="keywordtype">long</span>)len;
<a name="l01113"></a>01113     }
<a name="l01114"></a>01114 <span class="preprocessor">#endif</span>
<a name="l01115"></a>01115 <span class="preprocessor"></span>    n = <a class="code" href="../../d1/db0/string_8c.html#af61df713028687275f0379577f59057d">rb_enc_strlen_cr</a>(p, e, enc, &amp;cr);
<a name="l01116"></a>01116     <span class="keywordflow">if</span> (cr) {
<a name="l01117"></a>01117         <a class="code" href="../../d5/de3/encoding_8h.html#aefe5772c0116cf7131a5227de7243dbc">ENC_CODERANGE_SET</a>(str, cr);
<a name="l01118"></a>01118     }
<a name="l01119"></a>01119     <span class="keywordflow">return</span> n;
<a name="l01120"></a>01120 }
<a name="l01121"></a>01121 
<a name="l01122"></a>01122 <span class="keywordtype">long</span>
<a name="l01123"></a><a class="code" href="../../d1/db0/string_8c.html#a6600dcad06272caea3299a0d78459008">01123</a> <a class="code" href="../../db/d2e/intern_8h.html#a6c8d45286fd94753c361e7c027a95689">rb_str_strlen</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str)
<a name="l01124"></a>01124 {
<a name="l01125"></a>01125     <span class="keywordflow">return</span> <a class="code" href="../../d1/db0/string_8c.html#abe68504f1d38108a10f267f4358c53db">str_strlen</a>(str, <a class="code" href="../../d1/db0/string_8c.html#a123891f9f9b0c87d15621d93b4fa9c41">STR_ENC_GET</a>(str));
<a name="l01126"></a>01126 }
<a name="l01127"></a>01127 
<a name="l01128"></a>01128 <span class="comment">/*</span>
<a name="l01129"></a>01129 <span class="comment"> *  call-seq:</span>
<a name="l01130"></a>01130 <span class="comment"> *     str.length   -&gt; integer</span>
<a name="l01131"></a>01131 <span class="comment"> *     str.size     -&gt; integer</span>
<a name="l01132"></a>01132 <span class="comment"> *</span>
<a name="l01133"></a>01133 <span class="comment"> *  Returns the character length of &lt;i&gt;str&lt;/i&gt;.</span>
<a name="l01134"></a>01134 <span class="comment"> */</span>
<a name="l01135"></a>01135 
<a name="l01136"></a>01136 <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l01137"></a><a class="code" href="../../d1/db0/string_8c.html#aa74534a63fe2bf3b305523b913d23f2a">01137</a> <a class="code" href="../../db/d2e/intern_8h.html#aed0efe9b6a433458fbc9736a9c57d410">rb_str_length</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str)
<a name="l01138"></a>01138 {
<a name="l01139"></a>01139     <span class="keywordtype">long</span> len;
<a name="l01140"></a>01140 
<a name="l01141"></a>01141     len = <a class="code" href="../../d1/db0/string_8c.html#abe68504f1d38108a10f267f4358c53db">str_strlen</a>(str, <a class="code" href="../../d1/db0/string_8c.html#a123891f9f9b0c87d15621d93b4fa9c41">STR_ENC_GET</a>(str));
<a name="l01142"></a>01142     <span class="keywordflow">return</span> <a class="code" href="../../dc/d0c/cparse_8c.html#af1afba1194a12547a1e65d92abf03b03">LONG2NUM</a>(len);
<a name="l01143"></a>01143 }
<a name="l01144"></a>01144 
<a name="l01145"></a>01145 <span class="comment">/*</span>
<a name="l01146"></a>01146 <span class="comment"> *  call-seq:</span>
<a name="l01147"></a>01147 <span class="comment"> *     str.bytesize  -&gt; integer</span>
<a name="l01148"></a>01148 <span class="comment"> *</span>
<a name="l01149"></a>01149 <span class="comment"> *  Returns the length of &lt;i&gt;str&lt;/i&gt; in bytes.</span>
<a name="l01150"></a>01150 <span class="comment"> */</span>
<a name="l01151"></a>01151 
<a name="l01152"></a>01152 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l01153"></a><a class="code" href="../../d1/db0/string_8c.html#aa786c324384e11597f0dd72a8d2075fa">01153</a> <a class="code" href="../../d1/db0/string_8c.html#aa786c324384e11597f0dd72a8d2075fa">rb_str_bytesize</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str)
<a name="l01154"></a>01154 {
<a name="l01155"></a>01155     <span class="keywordflow">return</span> <a class="code" href="../../dc/d0c/cparse_8c.html#af1afba1194a12547a1e65d92abf03b03">LONG2NUM</a>(<a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(str));
<a name="l01156"></a>01156 }
<a name="l01157"></a>01157 
<a name="l01158"></a>01158 <span class="comment">/*</span>
<a name="l01159"></a>01159 <span class="comment"> *  call-seq:</span>
<a name="l01160"></a>01160 <span class="comment"> *     str.empty?   -&gt; true or false</span>
<a name="l01161"></a>01161 <span class="comment"> *</span>
<a name="l01162"></a>01162 <span class="comment"> *  Returns &lt;code&gt;true&lt;/code&gt; if &lt;i&gt;str&lt;/i&gt; has a length of zero.</span>
<a name="l01163"></a>01163 <span class="comment"> *</span>
<a name="l01164"></a>01164 <span class="comment"> *     &quot;hello&quot;.empty?   #=&gt; false</span>
<a name="l01165"></a>01165 <span class="comment"> *     &quot;&quot;.empty?        #=&gt; true</span>
<a name="l01166"></a>01166 <span class="comment"> */</span>
<a name="l01167"></a>01167 
<a name="l01168"></a>01168 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l01169"></a><a class="code" href="../../d1/db0/string_8c.html#a4bc8e61d2eeff246e06747471df0bab0">01169</a> <a class="code" href="../../d1/db0/string_8c.html#a4bc8e61d2eeff246e06747471df0bab0">rb_str_empty</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str)
<a name="l01170"></a>01170 {
<a name="l01171"></a>01171     <span class="keywordflow">if</span> (<a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(str) == 0)
<a name="l01172"></a>01172         <span class="keywordflow">return</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aacea3516b33941ce8149098e223a7466">Qtrue</a>;
<a name="l01173"></a>01173     <span class="keywordflow">return</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aba0717d2689eb68797421a02ab9295c6">Qfalse</a>;
<a name="l01174"></a>01174 }
<a name="l01175"></a>01175 
<a name="l01176"></a>01176 <span class="comment">/*</span>
<a name="l01177"></a>01177 <span class="comment"> *  call-seq:</span>
<a name="l01178"></a>01178 <span class="comment"> *     str + other_str   -&gt; new_str</span>
<a name="l01179"></a>01179 <span class="comment"> *</span>
<a name="l01180"></a>01180 <span class="comment"> *  Concatenation---Returns a new &lt;code&gt;String&lt;/code&gt; containing</span>
<a name="l01181"></a>01181 <span class="comment"> *  &lt;i&gt;other_str&lt;/i&gt; concatenated to &lt;i&gt;str&lt;/i&gt;.</span>
<a name="l01182"></a>01182 <span class="comment"> *</span>
<a name="l01183"></a>01183 <span class="comment"> *     &quot;Hello from &quot; + self.to_s   #=&gt; &quot;Hello from main&quot;</span>
<a name="l01184"></a>01184 <span class="comment"> */</span>
<a name="l01185"></a>01185 
<a name="l01186"></a>01186 <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l01187"></a><a class="code" href="../../d1/db0/string_8c.html#a84f5d3c29ef0b2a2fc088210c3c2c915">01187</a> <a class="code" href="../../db/d2e/intern_8h.html#a42253a059c9b3ebacd49f9fcc3fb1b91">rb_str_plus</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str1, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str2)
<a name="l01188"></a>01188 {
<a name="l01189"></a>01189     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str3;
<a name="l01190"></a>01190     <a class="code" href="../../d1/d7b/struct_onig_encoding_type_s_t.html">rb_encoding</a> *enc;
<a name="l01191"></a>01191 
<a name="l01192"></a>01192     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a0e80f207eb41e9010ec9f0f5f9419fea">StringValue</a>(str2);
<a name="l01193"></a>01193     enc = <a class="code" href="../../d5/db5/encoding_8c.html#a7d17d602fae27de649f9310511c03db0">rb_enc_check</a>(str1, str2);
<a name="l01194"></a>01194     str3 = <a class="code" href="../../db/d2e/intern_8h.html#a48b2b873adb8b6a04254bd631c4b03c5">rb_str_new</a>(0, <a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(str1)+<a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(str2));
<a name="l01195"></a>01195     memcpy(<a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(str3), <a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(str1), <a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(str1));
<a name="l01196"></a>01196     memcpy(<a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(str3) + <a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(str1),
<a name="l01197"></a>01197            <a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(str2), <a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(str2));
<a name="l01198"></a>01198     <a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(str3)[<a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(str3)] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l01199"></a>01199 
<a name="l01200"></a>01200     <span class="keywordflow">if</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a621bc62b1fd82640c1078daf90e1c061">OBJ_TAINTED</a>(str1) || <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a621bc62b1fd82640c1078daf90e1c061">OBJ_TAINTED</a>(str2))
<a name="l01201"></a>01201         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#afd75ea0cb81c17e76c73e593d1d8a860">OBJ_TAINT</a>(str3);
<a name="l01202"></a>01202     <a class="code" href="../../d5/de3/encoding_8h.html#af06e3f35ff3b6d79190eaf397328e7e6">ENCODING_CODERANGE_SET</a>(str3, <a class="code" href="../../d5/de3/encoding_8h.html#ad23f205c614c95726b919b2a8a1ac573">rb_enc_to_index</a>(enc),
<a name="l01203"></a>01203                            <a class="code" href="../../d5/de3/encoding_8h.html#a2a80e28ae5e44f3be150d5b24b65edf6">ENC_CODERANGE_AND</a>(<a class="code" href="../../d5/de3/encoding_8h.html#a5901233f6f9004aebbdeccdd33cf449f">ENC_CODERANGE</a>(str1), <a class="code" href="../../d5/de3/encoding_8h.html#a5901233f6f9004aebbdeccdd33cf449f">ENC_CODERANGE</a>(str2)));
<a name="l01204"></a>01204     <span class="keywordflow">return</span> str3;
<a name="l01205"></a>01205 }
<a name="l01206"></a>01206 
<a name="l01207"></a>01207 <span class="comment">/*</span>
<a name="l01208"></a>01208 <span class="comment"> *  call-seq:</span>
<a name="l01209"></a>01209 <span class="comment"> *     str * integer   -&gt; new_str</span>
<a name="l01210"></a>01210 <span class="comment"> *</span>
<a name="l01211"></a>01211 <span class="comment"> *  Copy---Returns a new &lt;code&gt;String&lt;/code&gt; containing &lt;i&gt;integer&lt;/i&gt; copies of</span>
<a name="l01212"></a>01212 <span class="comment"> *  the receiver.</span>
<a name="l01213"></a>01213 <span class="comment"> *</span>
<a name="l01214"></a>01214 <span class="comment"> *     &quot;Ho! &quot; * 3   #=&gt; &quot;Ho! Ho! Ho! &quot;</span>
<a name="l01215"></a>01215 <span class="comment"> */</span>
<a name="l01216"></a>01216 
<a name="l01217"></a>01217 <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l01218"></a><a class="code" href="../../d1/db0/string_8c.html#a0f47bb3a785c2355536b2e82ff84133d">01218</a> <a class="code" href="../../db/d2e/intern_8h.html#a8efad513e7493bcd2ada03102f2371c3">rb_str_times</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> times)
<a name="l01219"></a>01219 {
<a name="l01220"></a>01220     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str2;
<a name="l01221"></a>01221     <span class="keywordtype">long</span> n, len;
<a name="l01222"></a>01222     <span class="keywordtype">char</span> *ptr2;
<a name="l01223"></a>01223 
<a name="l01224"></a>01224     len = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a93f154f3dcc08027f475bf0c3cc287bd">NUM2LONG</a>(times);
<a name="l01225"></a>01225     <span class="keywordflow">if</span> (len &lt; 0) {
<a name="l01226"></a>01226         <a class="code" href="../../db/dcc/error_8c.html#a0f771a2840561f1838169b3d7d4616f3">rb_raise</a>(<a class="code" href="../../db/dcc/error_8c.html#ab5e2a9fec766c75176fbb262bfe6a596">rb_eArgError</a>, <span class="stringliteral">&quot;negative argument&quot;</span>);
<a name="l01227"></a>01227     }
<a name="l01228"></a>01228     <span class="keywordflow">if</span> (len &amp;&amp; <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a50fece4db74f09568b2938db583c5655">LONG_MAX</a>/len &lt;  <a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(str)) {
<a name="l01229"></a>01229         <a class="code" href="../../db/dcc/error_8c.html#a0f771a2840561f1838169b3d7d4616f3">rb_raise</a>(<a class="code" href="../../db/dcc/error_8c.html#ab5e2a9fec766c75176fbb262bfe6a596">rb_eArgError</a>, <span class="stringliteral">&quot;argument too big&quot;</span>);
<a name="l01230"></a>01230     }
<a name="l01231"></a>01231 
<a name="l01232"></a>01232     str2 = <a class="code" href="../../db/d2e/intern_8h.html#a70b7301e6960c402803fa81c7a0777d0">rb_str_new5</a>(str, 0, len *= <a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(str));
<a name="l01233"></a>01233     ptr2 = <a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(str2);
<a name="l01234"></a>01234     <span class="keywordflow">if</span> (len) {
<a name="l01235"></a>01235         n = <a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(str);
<a name="l01236"></a>01236         memcpy(ptr2, <a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(str), n);
<a name="l01237"></a>01237         <span class="keywordflow">while</span> (n &lt;= len/2) {
<a name="l01238"></a>01238             memcpy(ptr2 + n, ptr2, n);
<a name="l01239"></a>01239             n *= 2;
<a name="l01240"></a>01240         }
<a name="l01241"></a>01241         memcpy(ptr2 + n, ptr2, len-n);
<a name="l01242"></a>01242     }
<a name="l01243"></a>01243     ptr2[<a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(str2)] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l01244"></a>01244     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3bf9ab455a1e0e3e8cfc6ebabd8f12df">OBJ_INFECT</a>(str2, str);
<a name="l01245"></a>01245     <a class="code" href="../../d1/db0/string_8c.html#a52e3afb878f939e397b9443c8e082c54">rb_enc_cr_str_copy_for_substr</a>(str2, str);
<a name="l01246"></a>01246 
<a name="l01247"></a>01247     <span class="keywordflow">return</span> str2;
<a name="l01248"></a>01248 }
<a name="l01249"></a>01249 
<a name="l01250"></a>01250 <span class="comment">/*</span>
<a name="l01251"></a>01251 <span class="comment"> *  call-seq:</span>
<a name="l01252"></a>01252 <span class="comment"> *     str % arg   -&gt; new_str</span>
<a name="l01253"></a>01253 <span class="comment"> *</span>
<a name="l01254"></a>01254 <span class="comment"> *  Format---Uses &lt;i&gt;str&lt;/i&gt; as a format specification, and returns the result</span>
<a name="l01255"></a>01255 <span class="comment"> *  of applying it to &lt;i&gt;arg&lt;/i&gt;. If the format specification contains more than</span>
<a name="l01256"></a>01256 <span class="comment"> *  one substitution, then &lt;i&gt;arg&lt;/i&gt; must be an &lt;code&gt;Array&lt;/code&gt; or &lt;code&gt;Hash&lt;/code&gt;</span>
<a name="l01257"></a>01257 <span class="comment"> *  containing the values to be substituted. See &lt;code&gt;Kernel::sprintf&lt;/code&gt; for</span>
<a name="l01258"></a>01258 <span class="comment"> *  details of the format string.</span>
<a name="l01259"></a>01259 <span class="comment"> *</span>
<a name="l01260"></a>01260 <span class="comment"> *     &quot;%05d&quot; % 123                              #=&gt; &quot;00123&quot;</span>
<a name="l01261"></a>01261 <span class="comment"> *     &quot;%-5s: %08x&quot; % [ &quot;ID&quot;, self.object_id ]   #=&gt; &quot;ID   : 200e14d6&quot;</span>
<a name="l01262"></a>01262 <span class="comment"> *     &quot;foo = %{foo}&quot; % { :foo =&gt; &apos;bar&apos; }        #=&gt; &quot;foo = bar&quot;</span>
<a name="l01263"></a>01263 <span class="comment"> */</span>
<a name="l01264"></a>01264 
<a name="l01265"></a>01265 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l01266"></a><a class="code" href="../../d1/db0/string_8c.html#aa68d7dce95042a9ef479b32e4695e53c">01266</a> <a class="code" href="../../d1/db0/string_8c.html#aa68d7dce95042a9ef479b32e4695e53c">rb_str_format_m</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> arg)
<a name="l01267"></a>01267 {
<a name="l01268"></a>01268     <span class="keyword">volatile</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> tmp = <a class="code" href="../../dc/dcc/array_8c.html#aaa66361aff757dd7ef869f5b84b3793e">rb_check_array_type</a>(arg);
<a name="l01269"></a>01269 
<a name="l01270"></a>01270     <span class="keywordflow">if</span> (!<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a4832bad8845a35fc50f7a160901854a1">NIL_P</a>(tmp)) {
<a name="l01271"></a>01271         <span class="keywordflow">return</span> <a class="code" href="../../db/d2e/intern_8h.html#a48d7c050a9e0cabd779b9f639dfdbe43">rb_str_format</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a28084c7ad47ec550165c87e447e8356e">RARRAY_LENINT</a>(tmp), <a class="code" href="../../d8/df4/generator_8h.html#abb794fe2d7c73eea87e7ba2273939a8e">RARRAY_PTR</a>(tmp), str);
<a name="l01272"></a>01272     }
<a name="l01273"></a>01273     <span class="keywordflow">return</span> <a class="code" href="../../db/d2e/intern_8h.html#a48d7c050a9e0cabd779b9f639dfdbe43">rb_str_format</a>(1, &amp;arg, str);
<a name="l01274"></a>01274 }
<a name="l01275"></a>01275 
<a name="l01276"></a>01276 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span>
<a name="l01277"></a><a class="code" href="../../d1/db0/string_8c.html#a865d4f66b7c8fca1f7fd9afa3298a56e">01277</a> <a class="code" href="../../d1/db0/string_8c.html#a865d4f66b7c8fca1f7fd9afa3298a56e">str_modifiable</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str)
<a name="l01278"></a>01278 {
<a name="l01279"></a>01279     <span class="keywordflow">if</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a1ae918b6cc84188a9dc6ab545f732e4d">FL_TEST</a>(str, <a class="code" href="../../d1/db0/string_8c.html#abd8cc5329f77d70abfffe4284503e3cd">STR_TMPLOCK</a>)) {
<a name="l01280"></a>01280         <a class="code" href="../../db/dcc/error_8c.html#a0f771a2840561f1838169b3d7d4616f3">rb_raise</a>(<a class="code" href="../../db/dcc/error_8c.html#a95ad3953d535707e2cf2b1d837f5e253">rb_eRuntimeError</a>, <span class="stringliteral">&quot;can&apos;t modify string; temporarily locked&quot;</span>);
<a name="l01281"></a>01281     }
<a name="l01282"></a>01282     <a class="code" href="../../db/d2e/intern_8h.html#a372d6acb27d271ee4fc2e88c7022c485">rb_check_frozen</a>(str);
<a name="l01283"></a>01283     <span class="keywordflow">if</span> (!<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a981ef70b505df85f89fba2b5c2d8b462">OBJ_UNTRUSTED</a>(str) &amp;&amp; <a class="code" href="../../d5/d9d/tcltklib_8c.html#a6f520624fabb8332dc98fd223491bf8d">rb_safe_level</a>() &gt;= 4)
<a name="l01284"></a>01284         <a class="code" href="../../db/dcc/error_8c.html#a0f771a2840561f1838169b3d7d4616f3">rb_raise</a>(<a class="code" href="../../db/dcc/error_8c.html#ae53f1d228c34c2a7715d7d39ab1a2991">rb_eSecurityError</a>, <span class="stringliteral">&quot;Insecure: can&apos;t modify string&quot;</span>);
<a name="l01285"></a>01285 }
<a name="l01286"></a>01286 
<a name="l01287"></a>01287 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span>
<a name="l01288"></a><a class="code" href="../../d1/db0/string_8c.html#aaadaeb79729999ff540000c6d21349b9">01288</a> <a class="code" href="../../d1/db0/string_8c.html#aaadaeb79729999ff540000c6d21349b9">str_independent</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str)
<a name="l01289"></a>01289 {
<a name="l01290"></a>01290     <a class="code" href="../../d1/db0/string_8c.html#a865d4f66b7c8fca1f7fd9afa3298a56e">str_modifiable</a>(str);
<a name="l01291"></a>01291     <span class="keywordflow">if</span> (!<a class="code" href="../../d1/db0/string_8c.html#a47a46c073102a116dc86fbe598a8694e">STR_SHARED_P</a>(str)) <span class="keywordflow">return</span> 1;
<a name="l01292"></a>01292     <span class="keywordflow">if</span> (<a class="code" href="../../d1/db0/string_8c.html#a0823acc422a6a849b53cf3ae0465b543">STR_EMBED_P</a>(str)) <span class="keywordflow">return</span> 1;
<a name="l01293"></a>01293     <span class="keywordflow">return</span> 0;
<a name="l01294"></a>01294 }
<a name="l01295"></a>01295 
<a name="l01296"></a>01296 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l01297"></a><a class="code" href="../../d1/db0/string_8c.html#a44c8f7755f936a74a2991e3d47e0b14d">01297</a> <a class="code" href="../../d1/db0/string_8c.html#a44c8f7755f936a74a2991e3d47e0b14d">str_make_independent_expand</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str, <span class="keywordtype">long</span> expand)
<a name="l01298"></a>01298 {
<a name="l01299"></a>01299     <span class="keywordtype">char</span> *ptr;
<a name="l01300"></a>01300     <span class="keywordtype">long</span> len = <a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(str);
<a name="l01301"></a>01301     <span class="keywordtype">long</span> capa = len + expand;
<a name="l01302"></a>01302 
<a name="l01303"></a>01303     <span class="keywordflow">if</span> (len &gt; capa) len = capa;
<a name="l01304"></a>01304     ptr = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a79041aa2bc7439c11906a86f82a52eb6">ALLOC_N</a>(<span class="keywordtype">char</span>, capa + 1);
<a name="l01305"></a>01305     <span class="keywordflow">if</span> (<a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(str)) {
<a name="l01306"></a>01306         memcpy(ptr, <a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(str), len);
<a name="l01307"></a>01307     }
<a name="l01308"></a>01308     <a class="code" href="../../d1/db0/string_8c.html#a220a3ea405f8427a2b119e8cda01524e">STR_SET_NOEMBED</a>(str);
<a name="l01309"></a>01309     <a class="code" href="../../d1/db0/string_8c.html#a6b683fdd88d6effd1f5391040bc32b3f">STR_UNSET_NOCAPA</a>(str);
<a name="l01310"></a>01310     ptr[len] = 0;
<a name="l01311"></a>01311     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac695b0c61b18410ebcf22584fe0a6f6f">RSTRING</a>(str)-&gt;as.heap.ptr = ptr;
<a name="l01312"></a>01312     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac695b0c61b18410ebcf22584fe0a6f6f">RSTRING</a>(str)-&gt;as.heap.len = len;
<a name="l01313"></a>01313     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac695b0c61b18410ebcf22584fe0a6f6f">RSTRING</a>(str)-&gt;as.heap.aux.capa = capa;
<a name="l01314"></a>01314 }
<a name="l01315"></a>01315 
<a name="l01316"></a><a class="code" href="../../d1/db0/string_8c.html#a8fd8ef686fb67bcaa991cf7ecde9692d">01316</a> <span class="preprocessor">#define str_make_independent(str) str_make_independent_expand((str), 0L)</span>
<a name="l01317"></a>01317 <span class="preprocessor"></span>
<a name="l01318"></a>01318 <span class="keywordtype">void</span>
<a name="l01319"></a><a class="code" href="../../d1/db0/string_8c.html#a5da6512b5b5b24e1b4c2a7b17f2c0413">01319</a> <a class="code" href="../../db/d2e/intern_8h.html#a63a6d05687cf812131dce11743581b9d">rb_str_modify</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str)
<a name="l01320"></a>01320 {
<a name="l01321"></a>01321     <span class="keywordflow">if</span> (!<a class="code" href="../../d1/db0/string_8c.html#aaadaeb79729999ff540000c6d21349b9">str_independent</a>(str))
<a name="l01322"></a>01322         <a class="code" href="../../d1/db0/string_8c.html#a8fd8ef686fb67bcaa991cf7ecde9692d">str_make_independent</a>(str);
<a name="l01323"></a>01323     <a class="code" href="../../d5/de3/encoding_8h.html#ae0d61803f8b4b76dab41851f686c6a19">ENC_CODERANGE_CLEAR</a>(str);
<a name="l01324"></a>01324 }
<a name="l01325"></a>01325 
<a name="l01326"></a>01326 <span class="keywordtype">void</span>
<a name="l01327"></a><a class="code" href="../../d1/db0/string_8c.html#ab6f43c5cc91af4bef081c8d274d2d3cb">01327</a> <a class="code" href="../../db/d2e/intern_8h.html#abc41f64bde8ae25d5ea021cfdaa0d9dd">rb_str_modify_expand</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str, <span class="keywordtype">long</span> expand)
<a name="l01328"></a>01328 {
<a name="l01329"></a>01329     <span class="keywordflow">if</span> (expand &lt; 0) {
<a name="l01330"></a>01330         <a class="code" href="../../db/dcc/error_8c.html#a0f771a2840561f1838169b3d7d4616f3">rb_raise</a>(<a class="code" href="../../db/dcc/error_8c.html#ab5e2a9fec766c75176fbb262bfe6a596">rb_eArgError</a>, <span class="stringliteral">&quot;negative expanding string size&quot;</span>);
<a name="l01331"></a>01331     }
<a name="l01332"></a>01332     <span class="keywordflow">if</span> (!<a class="code" href="../../d1/db0/string_8c.html#aaadaeb79729999ff540000c6d21349b9">str_independent</a>(str)) {
<a name="l01333"></a>01333         <a class="code" href="../../d1/db0/string_8c.html#a44c8f7755f936a74a2991e3d47e0b14d">str_make_independent_expand</a>(str, expand);
<a name="l01334"></a>01334     }
<a name="l01335"></a>01335     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (expand &gt; 0) {
<a name="l01336"></a>01336         <span class="keywordtype">long</span> len = <a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(str);
<a name="l01337"></a>01337         <span class="keywordtype">long</span> capa = len + expand;
<a name="l01338"></a>01338         <span class="keywordflow">if</span> (!<a class="code" href="../../d1/db0/string_8c.html#a0823acc422a6a849b53cf3ae0465b543">STR_EMBED_P</a>(str)) {
<a name="l01339"></a>01339             <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a5160cad2d7d090e4d2e8803f1ba5ee3c">REALLOC_N</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac695b0c61b18410ebcf22584fe0a6f6f">RSTRING</a>(str)-&gt;as.heap.ptr, <span class="keywordtype">char</span>, capa+1);
<a name="l01340"></a>01340             <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac695b0c61b18410ebcf22584fe0a6f6f">RSTRING</a>(str)-&gt;as.heap.aux.capa = capa;
<a name="l01341"></a>01341         }
<a name="l01342"></a>01342         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (capa &gt; <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a92657ad1be8a8a323df19648e33b47b5">RSTRING_EMBED_LEN_MAX</a>) {
<a name="l01343"></a>01343             <a class="code" href="../../d1/db0/string_8c.html#a44c8f7755f936a74a2991e3d47e0b14d">str_make_independent_expand</a>(str, expand);
<a name="l01344"></a>01344         }
<a name="l01345"></a>01345     }
<a name="l01346"></a>01346     <a class="code" href="../../d5/de3/encoding_8h.html#ae0d61803f8b4b76dab41851f686c6a19">ENC_CODERANGE_CLEAR</a>(str);
<a name="l01347"></a>01347 }
<a name="l01348"></a>01348 
<a name="l01349"></a>01349 <span class="comment">/* As rb_str_modify(), but don&apos;t clear coderange */</span>
<a name="l01350"></a>01350 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l01351"></a><a class="code" href="../../d1/db0/string_8c.html#a106a1166130a12736cf57bacc164e4a5">01351</a> <a class="code" href="../../d1/db0/string_8c.html#a106a1166130a12736cf57bacc164e4a5">str_modify_keep_cr</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str)
<a name="l01352"></a>01352 {
<a name="l01353"></a>01353     <span class="keywordflow">if</span> (!<a class="code" href="../../d1/db0/string_8c.html#aaadaeb79729999ff540000c6d21349b9">str_independent</a>(str))
<a name="l01354"></a>01354         <a class="code" href="../../d1/db0/string_8c.html#a8fd8ef686fb67bcaa991cf7ecde9692d">str_make_independent</a>(str);
<a name="l01355"></a>01355     <span class="keywordflow">if</span> (<a class="code" href="../../d5/de3/encoding_8h.html#a5901233f6f9004aebbdeccdd33cf449f">ENC_CODERANGE</a>(str) == <a class="code" href="../../d5/de3/encoding_8h.html#abb86fbc02fc2b78d928825ea6d6922f9">ENC_CODERANGE_BROKEN</a>)
<a name="l01356"></a>01356         <span class="comment">/* Force re-scan later */</span>
<a name="l01357"></a>01357         <a class="code" href="../../d5/de3/encoding_8h.html#ae0d61803f8b4b76dab41851f686c6a19">ENC_CODERANGE_CLEAR</a>(str);
<a name="l01358"></a>01358 }
<a name="l01359"></a>01359 
<a name="l01360"></a>01360 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span>
<a name="l01361"></a><a class="code" href="../../d1/db0/string_8c.html#a9324063c75002bd7b4cc10d80b77fff7">01361</a> <a class="code" href="../../d1/db0/string_8c.html#a9324063c75002bd7b4cc10d80b77fff7">str_discard</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str)
<a name="l01362"></a>01362 {
<a name="l01363"></a>01363     <a class="code" href="../../d1/db0/string_8c.html#a865d4f66b7c8fca1f7fd9afa3298a56e">str_modifiable</a>(str);
<a name="l01364"></a>01364     <span class="keywordflow">if</span> (!<a class="code" href="../../d1/db0/string_8c.html#a47a46c073102a116dc86fbe598a8694e">STR_SHARED_P</a>(str) &amp;&amp; !<a class="code" href="../../d1/db0/string_8c.html#a0823acc422a6a849b53cf3ae0465b543">STR_EMBED_P</a>(str)) {
<a name="l01365"></a>01365         <a class="code" href="../../d8/db0/defines_8h.html#a2c3897f7c46ca54a2e0dd7b24a40c7cb">xfree</a>(<a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(str));
<a name="l01366"></a>01366         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac695b0c61b18410ebcf22584fe0a6f6f">RSTRING</a>(str)-&gt;as.heap.ptr = 0;
<a name="l01367"></a>01367         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac695b0c61b18410ebcf22584fe0a6f6f">RSTRING</a>(str)-&gt;as.heap.len = 0;
<a name="l01368"></a>01368     }
<a name="l01369"></a>01369 }
<a name="l01370"></a>01370 
<a name="l01371"></a>01371 <span class="keywordtype">void</span>
<a name="l01372"></a><a class="code" href="../../d1/db0/string_8c.html#a0f3d8d66bfebcad47b989c289ac7d0c5">01372</a> <a class="code" href="../../db/d2e/intern_8h.html#a34ee266e7ad7a1fee62f02cb01b0fc56">rb_str_associate</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <a class="code" href="../../d1/d6f/date__strftime_8c.html#aa62ba8463316e20fcef4b9db83bab2fd">add</a>)
<a name="l01373"></a>01373 {
<a name="l01374"></a>01374     <span class="comment">/* sanity check */</span>
<a name="l01375"></a>01375     <a class="code" href="../../db/d2e/intern_8h.html#a372d6acb27d271ee4fc2e88c7022c485">rb_check_frozen</a>(str);
<a name="l01376"></a>01376     <span class="keywordflow">if</span> (<a class="code" href="../../d1/db0/string_8c.html#a6fc2cd334583cde7a99b5753c6ff18a4">STR_ASSOC_P</a>(str)) {
<a name="l01377"></a>01377         <span class="comment">/* already associated */</span>
<a name="l01378"></a>01378         <a class="code" href="../../dc/dcc/array_8c.html#a9569be4d3661f4ce54bf56b12a2d98a8">rb_ary_concat</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac695b0c61b18410ebcf22584fe0a6f6f">RSTRING</a>(str)-&gt;as.heap.aux.shared, add);
<a name="l01379"></a>01379     }
<a name="l01380"></a>01380     <span class="keywordflow">else</span> {
<a name="l01381"></a>01381         <span class="keywordflow">if</span> (<a class="code" href="../../d1/db0/string_8c.html#a47a46c073102a116dc86fbe598a8694e">STR_SHARED_P</a>(str)) {
<a name="l01382"></a>01382             <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> assoc = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac695b0c61b18410ebcf22584fe0a6f6f">RSTRING</a>(str)-&gt;as.heap.aux.shared;
<a name="l01383"></a>01383             <a class="code" href="../../d1/db0/string_8c.html#a8fd8ef686fb67bcaa991cf7ecde9692d">str_make_independent</a>(str);
<a name="l01384"></a>01384             <span class="keywordflow">if</span> (<a class="code" href="../../d1/db0/string_8c.html#a6fc2cd334583cde7a99b5753c6ff18a4">STR_ASSOC_P</a>(assoc)) {
<a name="l01385"></a>01385                 assoc = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac695b0c61b18410ebcf22584fe0a6f6f">RSTRING</a>(assoc)-&gt;as.heap.aux.shared;
<a name="l01386"></a>01386                 <a class="code" href="../../dc/dcc/array_8c.html#a9569be4d3661f4ce54bf56b12a2d98a8">rb_ary_concat</a>(assoc, add);
<a name="l01387"></a>01387                 add = assoc;
<a name="l01388"></a>01388             }
<a name="l01389"></a>01389         }
<a name="l01390"></a>01390         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d1/db0/string_8c.html#a0823acc422a6a849b53cf3ae0465b543">STR_EMBED_P</a>(str)) {
<a name="l01391"></a>01391             <a class="code" href="../../d1/db0/string_8c.html#a8fd8ef686fb67bcaa991cf7ecde9692d">str_make_independent</a>(str);
<a name="l01392"></a>01392         }
<a name="l01393"></a>01393         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac695b0c61b18410ebcf22584fe0a6f6f">RSTRING</a>(str)-&gt;as.heap.aux.capa != <a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(str)) {
<a name="l01394"></a>01394             <a class="code" href="../../d1/db0/string_8c.html#ab8dafff9534eaf6545585223ada6b1c8">RESIZE_CAPA</a>(str, <a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(str));
<a name="l01395"></a>01395         }
<a name="l01396"></a>01396         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a38d7199dc0d1dc7f7207a9b3091c8d0d">FL_SET</a>(str, <a class="code" href="../../d8/d16/gc_8c.html#a2f2bd1a90a891cf8697328b4ba8d4d54">STR_ASSOC</a>);
<a name="l01397"></a>01397         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a1d4c05021aacd8cab989ff60f95ebe2d">RBASIC</a>(add)-&gt;klass = 0;
<a name="l01398"></a>01398         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac695b0c61b18410ebcf22584fe0a6f6f">RSTRING</a>(str)-&gt;as.heap.aux.shared = add;
<a name="l01399"></a>01399     }
<a name="l01400"></a>01400 }
<a name="l01401"></a>01401 
<a name="l01402"></a>01402 <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l01403"></a><a class="code" href="../../d1/db0/string_8c.html#af925b052acfc4f7bfd050a7860606503">01403</a> <a class="code" href="../../db/d2e/intern_8h.html#a4136c19f4d8e2bfd3b48f35952305277">rb_str_associated</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str)
<a name="l01404"></a>01404 {
<a name="l01405"></a>01405     <span class="keywordflow">if</span> (<a class="code" href="../../d1/db0/string_8c.html#a47a46c073102a116dc86fbe598a8694e">STR_SHARED_P</a>(str)) str = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac695b0c61b18410ebcf22584fe0a6f6f">RSTRING</a>(str)-&gt;as.heap.aux.shared;
<a name="l01406"></a>01406     <span class="keywordflow">if</span> (<a class="code" href="../../d1/db0/string_8c.html#a6fc2cd334583cde7a99b5753c6ff18a4">STR_ASSOC_P</a>(str)) {
<a name="l01407"></a>01407         <span class="keywordflow">return</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac695b0c61b18410ebcf22584fe0a6f6f">RSTRING</a>(str)-&gt;as.heap.aux.shared;
<a name="l01408"></a>01408     }
<a name="l01409"></a>01409     <span class="keywordflow">return</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aba0717d2689eb68797421a02ab9295c6">Qfalse</a>;
<a name="l01410"></a>01410 }
<a name="l01411"></a>01411 
<a name="l01412"></a>01412 <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l01413"></a><a class="code" href="../../d1/db0/string_8c.html#ab67bf1c1c9c2b75957b8c589b9a81835">01413</a> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a9c8a94705bf55ab59e9a08a50c2adc1a">rb_string_value</a>(<span class="keyword">volatile</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> *ptr)
<a name="l01414"></a>01414 {
<a name="l01415"></a>01415     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> s = *ptr;
<a name="l01416"></a>01416     <span class="keywordflow">if</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a394faf7191f18552a20cb17ce14226f0">TYPE</a>(s) != <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a22a8c2a4bbaae9b68f65c9bb92fd4e39">T_STRING</a>) {
<a name="l01417"></a>01417         s = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a068e98dc4a38f5462a01223a1ea63672">rb_str_to_str</a>(s);
<a name="l01418"></a>01418         *ptr = s;
<a name="l01419"></a>01419     }
<a name="l01420"></a>01420     <span class="keywordflow">return</span> s;
<a name="l01421"></a>01421 }
<a name="l01422"></a>01422 
<a name="l01423"></a>01423 <span class="keywordtype">char</span> *
<a name="l01424"></a><a class="code" href="../../d1/db0/string_8c.html#a8b871cba88803599743e972b321255c7">01424</a> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a96ee0bab02a1875d8273133def4bf7cd">rb_string_value_ptr</a>(<span class="keyword">volatile</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> *ptr)
<a name="l01425"></a>01425 {
<a name="l01426"></a>01426     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a9c8a94705bf55ab59e9a08a50c2adc1a">rb_string_value</a>(ptr);
<a name="l01427"></a>01427     <span class="keywordflow">return</span> <a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(str);
<a name="l01428"></a>01428 }
<a name="l01429"></a>01429 
<a name="l01430"></a>01430 <span class="keywordtype">char</span> *
<a name="l01431"></a><a class="code" href="../../d1/db0/string_8c.html#a995573e78a759f3aa3b8025a33c3d2d2">01431</a> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac708101a05550bb092a5b2d9fbdc60fe">rb_string_value_cstr</a>(<span class="keyword">volatile</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> *ptr)
<a name="l01432"></a>01432 {
<a name="l01433"></a>01433     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a9c8a94705bf55ab59e9a08a50c2adc1a">rb_string_value</a>(ptr);
<a name="l01434"></a>01434     <span class="keywordtype">char</span> *s = <a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(str);
<a name="l01435"></a>01435     <span class="keywordtype">long</span> len = <a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(str);
<a name="l01436"></a>01436 
<a name="l01437"></a>01437     <span class="keywordflow">if</span> (!s || memchr(s, 0, len)) {
<a name="l01438"></a>01438         <a class="code" href="../../db/dcc/error_8c.html#a0f771a2840561f1838169b3d7d4616f3">rb_raise</a>(<a class="code" href="../../db/dcc/error_8c.html#ab5e2a9fec766c75176fbb262bfe6a596">rb_eArgError</a>, <span class="stringliteral">&quot;string contains null byte&quot;</span>);
<a name="l01439"></a>01439     }
<a name="l01440"></a>01440     <span class="keywordflow">if</span> (s[len]) {
<a name="l01441"></a>01441         <a class="code" href="../../db/d2e/intern_8h.html#a63a6d05687cf812131dce11743581b9d">rb_str_modify</a>(str);
<a name="l01442"></a>01442         s = <a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(str);
<a name="l01443"></a>01443         s[<a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(str)] = 0;
<a name="l01444"></a>01444     }
<a name="l01445"></a>01445     <span class="keywordflow">return</span> s;
<a name="l01446"></a>01446 }
<a name="l01447"></a>01447 
<a name="l01448"></a>01448 <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l01449"></a><a class="code" href="../../d1/db0/string_8c.html#a8feb7dcfd69fae2af0cc368fa22e4e6a">01449</a> <a class="code" href="../../db/d2e/intern_8h.html#a669b6063704b2d304844bd1553217cf0">rb_check_string_type</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str)
<a name="l01450"></a>01450 {
<a name="l01451"></a>01451     str = <a class="code" href="../../db/d2e/intern_8h.html#a16e59d05c8eb1641308bc1018c333cc1">rb_check_convert_type</a>(str, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a22a8c2a4bbaae9b68f65c9bb92fd4e39">T_STRING</a>, <span class="stringliteral">&quot;String&quot;</span>, <span class="stringliteral">&quot;to_str&quot;</span>);
<a name="l01452"></a>01452     <span class="keywordflow">return</span> str;
<a name="l01453"></a>01453 }
<a name="l01454"></a>01454 
<a name="l01455"></a>01455 <span class="comment">/*</span>
<a name="l01456"></a>01456 <span class="comment"> *  call-seq:</span>
<a name="l01457"></a>01457 <span class="comment"> *     String.try_convert(obj) -&gt; string or nil</span>
<a name="l01458"></a>01458 <span class="comment"> *</span>
<a name="l01459"></a>01459 <span class="comment"> *  Try to convert &lt;i&gt;obj&lt;/i&gt; into a String, using to_str method.</span>
<a name="l01460"></a>01460 <span class="comment"> *  Returns converted string or nil if &lt;i&gt;obj&lt;/i&gt; cannot be converted</span>
<a name="l01461"></a>01461 <span class="comment"> *  for any reason.</span>
<a name="l01462"></a>01462 <span class="comment"> *</span>
<a name="l01463"></a>01463 <span class="comment"> *     String.try_convert(&quot;str&quot;)     #=&gt; &quot;str&quot;</span>
<a name="l01464"></a>01464 <span class="comment"> *     String.try_convert(/re/)      #=&gt; nil</span>
<a name="l01465"></a>01465 <span class="comment"> */</span>
<a name="l01466"></a>01466 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l01467"></a><a class="code" href="../../d1/db0/string_8c.html#a10b57f1b7b311793950e70e762811a80">01467</a> <a class="code" href="../../d1/db0/string_8c.html#a10b57f1b7b311793950e70e762811a80">rb_str_s_try_convert</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> dummy, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str)
<a name="l01468"></a>01468 {
<a name="l01469"></a>01469     <span class="keywordflow">return</span> <a class="code" href="../../db/d2e/intern_8h.html#a669b6063704b2d304844bd1553217cf0">rb_check_string_type</a>(str);
<a name="l01470"></a>01470 }
<a name="l01471"></a>01471 
<a name="l01472"></a>01472 <span class="keyword">static</span> <span class="keywordtype">char</span>*
<a name="l01473"></a><a class="code" href="../../d1/db0/string_8c.html#ad62975cece8719a29aa8b0e43477a1a1">01473</a> <a class="code" href="../../d1/db0/string_8c.html#ad62975cece8719a29aa8b0e43477a1a1">str_nth_len</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *p, <span class="keyword">const</span> <span class="keywordtype">char</span> *e, <span class="keywordtype">long</span> *nthp, <a class="code" href="../../d1/d7b/struct_onig_encoding_type_s_t.html">rb_encoding</a> *enc)
<a name="l01474"></a>01474 {
<a name="l01475"></a>01475     <span class="keywordtype">long</span> nth = *nthp;
<a name="l01476"></a>01476     <span class="keywordflow">if</span> (<a class="code" href="../../d5/de3/encoding_8h.html#a6b942f8457214c49fcf8541c60a38306">rb_enc_mbmaxlen</a>(enc) == 1) {
<a name="l01477"></a>01477         p += nth;
<a name="l01478"></a>01478     }
<a name="l01479"></a>01479     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d5/de3/encoding_8h.html#a6b942f8457214c49fcf8541c60a38306">rb_enc_mbmaxlen</a>(enc) == <a class="code" href="../../d5/de3/encoding_8h.html#aaffb0395eb9bf0b3ba3175fa5c9c1615">rb_enc_mbminlen</a>(enc)) {
<a name="l01480"></a>01480         p += nth * <a class="code" href="../../d5/de3/encoding_8h.html#a6b942f8457214c49fcf8541c60a38306">rb_enc_mbmaxlen</a>(enc);
<a name="l01481"></a>01481     }
<a name="l01482"></a>01482     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d5/de3/encoding_8h.html#a8b18a09a3055d3006c6d5baeaa6e7c72">rb_enc_asciicompat</a>(enc)) {
<a name="l01483"></a>01483         <span class="keyword">const</span> <span class="keywordtype">char</span> *p2, *e2;
<a name="l01484"></a>01484         <span class="keywordtype">int</span> n;
<a name="l01485"></a>01485 
<a name="l01486"></a>01486         <span class="keywordflow">while</span> (p &lt; e &amp;&amp; 0 &lt; nth) {
<a name="l01487"></a>01487             e2 = p + nth;
<a name="l01488"></a>01488             <span class="keywordflow">if</span> (e &lt; e2) {
<a name="l01489"></a>01489                 *nthp = nth;
<a name="l01490"></a>01490                 <span class="keywordflow">return</span> (<span class="keywordtype">char</span> *)e;
<a name="l01491"></a>01491             }
<a name="l01492"></a>01492             <span class="keywordflow">if</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#af96ff81718c3c27b342b5958fac6cb7e">ISASCII</a>(*p)) {
<a name="l01493"></a>01493                 p2 = <a class="code" href="../../d1/db0/string_8c.html#a09d26a98b1b2071c40e71eb556d87814">search_nonascii</a>(p, e2);
<a name="l01494"></a>01494                 <span class="keywordflow">if</span> (!p2) {
<a name="l01495"></a>01495                     *nthp = nth;
<a name="l01496"></a>01496                     <span class="keywordflow">return</span> (<span class="keywordtype">char</span> *)e2;
<a name="l01497"></a>01497                 }
<a name="l01498"></a>01498                 nth -= p2 - p;
<a name="l01499"></a>01499                 p = p2;
<a name="l01500"></a>01500             }
<a name="l01501"></a>01501             n = <a class="code" href="../../d5/db5/encoding_8c.html#aa91c0fa3dfdfe3c55fcaa6029c35bbb8">rb_enc_mbclen</a>(p, e, enc);
<a name="l01502"></a>01502             p += n;
<a name="l01503"></a>01503             nth--;
<a name="l01504"></a>01504         }
<a name="l01505"></a>01505         *nthp = nth;
<a name="l01506"></a>01506         <span class="keywordflow">if</span> (nth != 0) {
<a name="l01507"></a>01507             <span class="keywordflow">return</span> (<span class="keywordtype">char</span> *)e;
<a name="l01508"></a>01508         }
<a name="l01509"></a>01509         <span class="keywordflow">return</span> (<span class="keywordtype">char</span> *)p;
<a name="l01510"></a>01510     }
<a name="l01511"></a>01511     <span class="keywordflow">else</span> {
<a name="l01512"></a>01512         <span class="keywordflow">while</span> (p &lt; e &amp;&amp; nth--) {
<a name="l01513"></a>01513             p += <a class="code" href="../../d5/db5/encoding_8c.html#aa91c0fa3dfdfe3c55fcaa6029c35bbb8">rb_enc_mbclen</a>(p, e, enc);
<a name="l01514"></a>01514         }
<a name="l01515"></a>01515     }
<a name="l01516"></a>01516     <span class="keywordflow">if</span> (p &gt; e) p = e;
<a name="l01517"></a>01517     *nthp = nth;
<a name="l01518"></a>01518     <span class="keywordflow">return</span> (<span class="keywordtype">char</span>*)p;
<a name="l01519"></a>01519 }
<a name="l01520"></a>01520 
<a name="l01521"></a>01521 <span class="keywordtype">char</span>*
<a name="l01522"></a><a class="code" href="../../d1/db0/string_8c.html#a286d8cb854375c4c1aae8dc29c1a714e">01522</a> <a class="code" href="../../d5/de3/encoding_8h.html#a06cebaeb473530e4c2dc6b3151d88832">rb_enc_nth</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *p, <span class="keyword">const</span> <span class="keywordtype">char</span> *e, <span class="keywordtype">long</span> nth, <a class="code" href="../../d1/d7b/struct_onig_encoding_type_s_t.html">rb_encoding</a> *enc)
<a name="l01523"></a>01523 {
<a name="l01524"></a>01524     <span class="keywordflow">return</span> <a class="code" href="../../d1/db0/string_8c.html#ad62975cece8719a29aa8b0e43477a1a1">str_nth_len</a>(p, e, &amp;nth, enc);
<a name="l01525"></a>01525 }
<a name="l01526"></a>01526 
<a name="l01527"></a>01527 <span class="keyword">static</span> <span class="keywordtype">char</span>*
<a name="l01528"></a><a class="code" href="../../d1/db0/string_8c.html#a3b0d63e96168203d8b9c8e1129e7224d">01528</a> <a class="code" href="../../d1/db0/string_8c.html#a3b0d63e96168203d8b9c8e1129e7224d">str_nth</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *p, <span class="keyword">const</span> <span class="keywordtype">char</span> *e, <span class="keywordtype">long</span> nth, <a class="code" href="../../d1/d7b/struct_onig_encoding_type_s_t.html">rb_encoding</a> *enc, <span class="keywordtype">int</span> singlebyte)
<a name="l01529"></a>01529 {
<a name="l01530"></a>01530     <span class="keywordflow">if</span> (singlebyte)
<a name="l01531"></a>01531         p += nth;
<a name="l01532"></a>01532     <span class="keywordflow">else</span> {
<a name="l01533"></a>01533         p = <a class="code" href="../../d1/db0/string_8c.html#ad62975cece8719a29aa8b0e43477a1a1">str_nth_len</a>(p, e, &amp;nth, enc);
<a name="l01534"></a>01534     }
<a name="l01535"></a>01535     <span class="keywordflow">if</span> (!p) <span class="keywordflow">return</span> 0;
<a name="l01536"></a>01536     <span class="keywordflow">if</span> (p &gt; e) p = e;
<a name="l01537"></a>01537     <span class="keywordflow">return</span> (<span class="keywordtype">char</span> *)p;
<a name="l01538"></a>01538 }
<a name="l01539"></a>01539 
<a name="l01540"></a>01540 <span class="comment">/* char offset to byte offset */</span>
<a name="l01541"></a>01541 <span class="keyword">static</span> <span class="keywordtype">long</span>
<a name="l01542"></a><a class="code" href="../../d1/db0/string_8c.html#a0e1c768ca3baf15d6a4ec3581ba3297c">01542</a> <a class="code" href="../../d1/db0/string_8c.html#a0e1c768ca3baf15d6a4ec3581ba3297c">str_offset</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *p, <span class="keyword">const</span> <span class="keywordtype">char</span> *e, <span class="keywordtype">long</span> nth, <a class="code" href="../../d1/d7b/struct_onig_encoding_type_s_t.html">rb_encoding</a> *enc, <span class="keywordtype">int</span> singlebyte)
<a name="l01543"></a>01543 {
<a name="l01544"></a>01544     <span class="keyword">const</span> <span class="keywordtype">char</span> *pp = <a class="code" href="../../d1/db0/string_8c.html#a3b0d63e96168203d8b9c8e1129e7224d">str_nth</a>(p, e, nth, enc, singlebyte);
<a name="l01545"></a>01545     <span class="keywordflow">if</span> (!pp) <span class="keywordflow">return</span> e - p;
<a name="l01546"></a>01546     <span class="keywordflow">return</span> pp - p;
<a name="l01547"></a>01547 }
<a name="l01548"></a>01548 
<a name="l01549"></a>01549 <span class="keywordtype">long</span>
<a name="l01550"></a><a class="code" href="../../d1/db0/string_8c.html#a38b80776a6922cc9ec44c283528a681b">01550</a> <a class="code" href="../../db/d2e/intern_8h.html#a197c031196840caab65ccbe11fa3e0ee">rb_str_offset</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str, <span class="keywordtype">long</span> pos)
<a name="l01551"></a>01551 {
<a name="l01552"></a>01552     <span class="keywordflow">return</span> <a class="code" href="../../d1/db0/string_8c.html#a0e1c768ca3baf15d6a4ec3581ba3297c">str_offset</a>(<a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(str), <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a35bfa2635774977edad0a16b9fdebbaf">RSTRING_END</a>(str), pos,
<a name="l01553"></a>01553                       <a class="code" href="../../d1/db0/string_8c.html#a123891f9f9b0c87d15621d93b4fa9c41">STR_ENC_GET</a>(str), <a class="code" href="../../d1/db0/string_8c.html#a5ab3c8112c2ec6943bdae8a2036fca02">single_byte_optimizable</a>(str));
<a name="l01554"></a>01554 }
<a name="l01555"></a>01555 
<a name="l01556"></a>01556 <span class="preprocessor">#ifdef NONASCII_MASK</span>
<a name="l01557"></a>01557 <span class="preprocessor"></span><span class="keyword">static</span> <span class="keywordtype">char</span> *
<a name="l01558"></a>01558 str_utf8_nth(<span class="keyword">const</span> <span class="keywordtype">char</span> *p, <span class="keyword">const</span> <span class="keywordtype">char</span> *e, <span class="keywordtype">long</span> *nthp)
<a name="l01559"></a>01559 {
<a name="l01560"></a>01560     <span class="keywordtype">long</span> nth = *nthp;
<a name="l01561"></a>01561     <span class="keywordflow">if</span> ((<span class="keywordtype">int</span>)<a class="code" href="../../de/de6/ruby_2ruby_8h.html#aee9b7ba3793585d33b6c1d1338b8169d">SIZEOF_VALUE</a> * 2 &lt; e - p &amp;&amp; (<span class="keywordtype">int</span>)<a class="code" href="../../de/de6/ruby_2ruby_8h.html#aee9b7ba3793585d33b6c1d1338b8169d">SIZEOF_VALUE</a> * 2 &lt; nth) {
<a name="l01562"></a>01562         <span class="keyword">const</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> *s, *t;
<a name="l01563"></a>01563         <span class="keyword">const</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> lowbits = <span class="keyword">sizeof</span>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>) - 1;
<a name="l01564"></a>01564         s = (<span class="keyword">const</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>*)(~lowbits &amp; ((<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>)p + lowbits));
<a name="l01565"></a>01565         t = (<span class="keyword">const</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>*)(~lowbits &amp; (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>)e);
<a name="l01566"></a>01566         <span class="keywordflow">while</span> (p &lt; (<span class="keyword">const</span> <span class="keywordtype">char</span> *)s) {
<a name="l01567"></a>01567             <span class="keywordflow">if</span> (is_utf8_lead_byte(*p)) nth--;
<a name="l01568"></a>01568             p++;
<a name="l01569"></a>01569         }
<a name="l01570"></a>01570         <span class="keywordflow">do</span> {
<a name="l01571"></a>01571             nth -= count_utf8_lead_bytes_with_word(s);
<a name="l01572"></a>01572             s++;
<a name="l01573"></a>01573         } <span class="keywordflow">while</span> (s &lt; t &amp;&amp; (<span class="keywordtype">int</span>)<span class="keyword">sizeof</span>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>) &lt;= nth);
<a name="l01574"></a>01574         p = (<span class="keywordtype">char</span> *)s;
<a name="l01575"></a>01575     }
<a name="l01576"></a>01576     <span class="keywordflow">while</span> (p &lt; e) {
<a name="l01577"></a>01577         <span class="keywordflow">if</span> (is_utf8_lead_byte(*p)) {
<a name="l01578"></a>01578             <span class="keywordflow">if</span> (nth == 0) <span class="keywordflow">break</span>;
<a name="l01579"></a>01579             nth--;
<a name="l01580"></a>01580         }
<a name="l01581"></a>01581         p++;
<a name="l01582"></a>01582     }
<a name="l01583"></a>01583     *nthp = nth;
<a name="l01584"></a>01584     <span class="keywordflow">return</span> (<span class="keywordtype">char</span> *)p;
<a name="l01585"></a>01585 }
<a name="l01586"></a>01586 
<a name="l01587"></a>01587 <span class="keyword">static</span> <span class="keywordtype">long</span>
<a name="l01588"></a>01588 str_utf8_offset(<span class="keyword">const</span> <span class="keywordtype">char</span> *p, <span class="keyword">const</span> <span class="keywordtype">char</span> *e, <span class="keywordtype">long</span> nth)
<a name="l01589"></a>01589 {
<a name="l01590"></a>01590     <span class="keyword">const</span> <span class="keywordtype">char</span> *pp = str_utf8_nth(p, e, &amp;nth);
<a name="l01591"></a>01591     <span class="keywordflow">return</span> pp - p;
<a name="l01592"></a>01592 }
<a name="l01593"></a>01593 <span class="preprocessor">#endif</span>
<a name="l01594"></a>01594 <span class="preprocessor"></span>
<a name="l01595"></a>01595 <span class="comment">/* byte offset to char offset */</span>
<a name="l01596"></a>01596 <span class="keywordtype">long</span>
<a name="l01597"></a><a class="code" href="../../d1/db0/string_8c.html#a87001963253a937a9f0372262fa12b34">01597</a> <a class="code" href="../../db/d2e/intern_8h.html#ad9828818c61258f1ddf03369fbcfee61">rb_str_sublen</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str, <span class="keywordtype">long</span> pos)
<a name="l01598"></a>01598 {
<a name="l01599"></a>01599     <span class="keywordflow">if</span> (<a class="code" href="../../d1/db0/string_8c.html#a5ab3c8112c2ec6943bdae8a2036fca02">single_byte_optimizable</a>(str) || pos &lt; 0)
<a name="l01600"></a>01600         <span class="keywordflow">return</span> pos;
<a name="l01601"></a>01601     <span class="keywordflow">else</span> {
<a name="l01602"></a>01602         <span class="keywordtype">char</span> *p = <a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(str);
<a name="l01603"></a>01603         <span class="keywordflow">return</span> <a class="code" href="../../d1/db0/string_8c.html#a19cd61bcffaaf77eb3e1a0bc24c318e2">enc_strlen</a>(p, p + pos, <a class="code" href="../../d1/db0/string_8c.html#a123891f9f9b0c87d15621d93b4fa9c41">STR_ENC_GET</a>(str), <a class="code" href="../../d5/de3/encoding_8h.html#a5901233f6f9004aebbdeccdd33cf449f">ENC_CODERANGE</a>(str));
<a name="l01604"></a>01604     }
<a name="l01605"></a>01605 }
<a name="l01606"></a>01606 
<a name="l01607"></a>01607 <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l01608"></a><a class="code" href="../../d1/db0/string_8c.html#a41df150a939dd712d9ca31695cb78e48">01608</a> <a class="code" href="../../db/d2e/intern_8h.html#aadf59e7cbba9319e199d85ef2448a970">rb_str_subseq</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str, <span class="keywordtype">long</span> beg, <span class="keywordtype">long</span> len)
<a name="l01609"></a>01609 {
<a name="l01610"></a>01610     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str2;
<a name="l01611"></a>01611 
<a name="l01612"></a>01612     <span class="keywordflow">if</span> (<a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(str) == beg + len &amp;&amp;
<a name="l01613"></a>01613         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a92657ad1be8a8a323df19648e33b47b5">RSTRING_EMBED_LEN_MAX</a> &lt; len) {
<a name="l01614"></a>01614         str2 = <a class="code" href="../../db/d2e/intern_8h.html#a26b6747ce71f213f14bedf7f1d892ad0">rb_str_new_shared</a>(<a class="code" href="../../db/d2e/intern_8h.html#ab771cea1c6187da7a08e9f0bc309a0a6">rb_str_new_frozen</a>(str));
<a name="l01615"></a>01615         <a class="code" href="../../db/d2e/intern_8h.html#abf3be2f0a5fdf9ab341a748201c9ffd9">rb_str_drop_bytes</a>(str2, beg);
<a name="l01616"></a>01616     }
<a name="l01617"></a>01617     <span class="keywordflow">else</span> {
<a name="l01618"></a>01618         str2 = <a class="code" href="../../db/d2e/intern_8h.html#a70b7301e6960c402803fa81c7a0777d0">rb_str_new5</a>(str, <a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(str)+beg, len);
<a name="l01619"></a>01619     }
<a name="l01620"></a>01620 
<a name="l01621"></a>01621     <a class="code" href="../../d1/db0/string_8c.html#a52e3afb878f939e397b9443c8e082c54">rb_enc_cr_str_copy_for_substr</a>(str2, str);
<a name="l01622"></a>01622     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3bf9ab455a1e0e3e8cfc6ebabd8f12df">OBJ_INFECT</a>(str2, str);
<a name="l01623"></a>01623 
<a name="l01624"></a>01624     <span class="keywordflow">return</span> str2;
<a name="l01625"></a>01625 }
<a name="l01626"></a>01626 
<a name="l01627"></a>01627 <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l01628"></a><a class="code" href="../../d1/db0/string_8c.html#ad3c8cffd2a348f884d7a9281faf13e23">01628</a> <a class="code" href="../../db/d2e/intern_8h.html#a61efad31b183f52fe068b4c0daf8fdd9">rb_str_substr</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str, <span class="keywordtype">long</span> beg, <span class="keywordtype">long</span> len)
<a name="l01629"></a>01629 {
<a name="l01630"></a>01630     <a class="code" href="../../d1/d7b/struct_onig_encoding_type_s_t.html">rb_encoding</a> *enc = <a class="code" href="../../d1/db0/string_8c.html#a123891f9f9b0c87d15621d93b4fa9c41">STR_ENC_GET</a>(str);
<a name="l01631"></a>01631     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str2;
<a name="l01632"></a>01632     <span class="keywordtype">char</span> *p, *s = <a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(str), *e = s + <a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(str);
<a name="l01633"></a>01633 
<a name="l01634"></a>01634     <span class="keywordflow">if</span> (len &lt; 0) <span class="keywordflow">return</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a320970f989dc8294c8203154e3db40c1">Qnil</a>;
<a name="l01635"></a>01635     <span class="keywordflow">if</span> (!<a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(str)) {
<a name="l01636"></a>01636         len = 0;
<a name="l01637"></a>01637     }
<a name="l01638"></a>01638     <span class="keywordflow">if</span> (<a class="code" href="../../d1/db0/string_8c.html#a5ab3c8112c2ec6943bdae8a2036fca02">single_byte_optimizable</a>(str)) {
<a name="l01639"></a>01639         <span class="keywordflow">if</span> (beg &gt; <a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(str)) <span class="keywordflow">return</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a320970f989dc8294c8203154e3db40c1">Qnil</a>;
<a name="l01640"></a>01640         <span class="keywordflow">if</span> (beg &lt; 0) {
<a name="l01641"></a>01641             beg += <a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(str);
<a name="l01642"></a>01642             <span class="keywordflow">if</span> (beg &lt; 0) <span class="keywordflow">return</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a320970f989dc8294c8203154e3db40c1">Qnil</a>;
<a name="l01643"></a>01643         }
<a name="l01644"></a>01644         <span class="keywordflow">if</span> (beg + len &gt; <a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(str))
<a name="l01645"></a>01645             len = <a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(str) - beg;
<a name="l01646"></a>01646         <span class="keywordflow">if</span> (len &lt;= 0) {
<a name="l01647"></a>01647             len = 0;
<a name="l01648"></a>01648             p = 0;
<a name="l01649"></a>01649         }
<a name="l01650"></a>01650         <span class="keywordflow">else</span>
<a name="l01651"></a>01651             p = s + beg;
<a name="l01652"></a>01652         <span class="keywordflow">goto</span> <a class="code" href="../../d1/d6f/date__strftime_8c.html#a0d7154c0cddedcee49293c3e1f47d643">sub</a>;
<a name="l01653"></a>01653     }
<a name="l01654"></a>01654     <span class="keywordflow">if</span> (beg &lt; 0) {
<a name="l01655"></a>01655         <span class="keywordflow">if</span> (len &gt; -beg) len = -beg;
<a name="l01656"></a>01656         <span class="keywordflow">if</span> (-beg * <a class="code" href="../../d5/de3/encoding_8h.html#a6b942f8457214c49fcf8541c60a38306">rb_enc_mbmaxlen</a>(enc) &lt; <a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(str) / 8) {
<a name="l01657"></a>01657             beg = -beg;
<a name="l01658"></a>01658             <span class="keywordflow">while</span> (beg-- &gt; len &amp;&amp; (e = <a class="code" href="../../d5/de3/encoding_8h.html#a48a3264058189cf218f8e9dad6513c54">rb_enc_prev_char</a>(s, e, e, enc)) != 0);
<a name="l01659"></a>01659             p = e;
<a name="l01660"></a>01660             <span class="keywordflow">if</span> (!p) <span class="keywordflow">return</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a320970f989dc8294c8203154e3db40c1">Qnil</a>;
<a name="l01661"></a>01661             <span class="keywordflow">while</span> (len-- &gt; 0 &amp;&amp; (p = <a class="code" href="../../d5/de3/encoding_8h.html#a48a3264058189cf218f8e9dad6513c54">rb_enc_prev_char</a>(s, p, e, enc)) != 0);
<a name="l01662"></a>01662             <span class="keywordflow">if</span> (!p) <span class="keywordflow">return</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a320970f989dc8294c8203154e3db40c1">Qnil</a>;
<a name="l01663"></a>01663             len = e - p;
<a name="l01664"></a>01664             <span class="keywordflow">goto</span> <a class="code" href="../../d1/d6f/date__strftime_8c.html#a0d7154c0cddedcee49293c3e1f47d643">sub</a>;
<a name="l01665"></a>01665         }
<a name="l01666"></a>01666         <span class="keywordflow">else</span> {
<a name="l01667"></a>01667             beg += <a class="code" href="../../d1/db0/string_8c.html#abe68504f1d38108a10f267f4358c53db">str_strlen</a>(str, enc);
<a name="l01668"></a>01668             <span class="keywordflow">if</span> (beg &lt; 0) <span class="keywordflow">return</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a320970f989dc8294c8203154e3db40c1">Qnil</a>;
<a name="l01669"></a>01669         }
<a name="l01670"></a>01670     }
<a name="l01671"></a>01671     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (beg &gt; 0 &amp;&amp; beg &gt; <a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(str)) {
<a name="l01672"></a>01672         <span class="keywordflow">return</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a320970f989dc8294c8203154e3db40c1">Qnil</a>;
<a name="l01673"></a>01673     }
<a name="l01674"></a>01674     <span class="keywordflow">if</span> (len == 0) {
<a name="l01675"></a>01675         <span class="keywordflow">if</span> (beg &gt; <a class="code" href="../../d1/db0/string_8c.html#abe68504f1d38108a10f267f4358c53db">str_strlen</a>(str, enc)) <span class="keywordflow">return</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a320970f989dc8294c8203154e3db40c1">Qnil</a>;
<a name="l01676"></a>01676         p = 0;
<a name="l01677"></a>01677     }
<a name="l01678"></a>01678 <span class="preprocessor">#ifdef NONASCII_MASK</span>
<a name="l01679"></a>01679 <span class="preprocessor"></span>    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d5/de3/encoding_8h.html#a5901233f6f9004aebbdeccdd33cf449f">ENC_CODERANGE</a>(str) == <a class="code" href="../../d5/de3/encoding_8h.html#a0c81a12daaa1e57009d46b9d906957dc">ENC_CODERANGE_VALID</a> &amp;&amp;
<a name="l01680"></a>01680         enc == <a class="code" href="../../d5/db5/encoding_8c.html#a893004271cf8c790ca40c4712261aa8c">rb_utf8_encoding</a>()) {
<a name="l01681"></a>01681         p = str_utf8_nth(s, e, &amp;beg);
<a name="l01682"></a>01682         <span class="keywordflow">if</span> (beg &gt; 0) <span class="keywordflow">return</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a320970f989dc8294c8203154e3db40c1">Qnil</a>;
<a name="l01683"></a>01683         len = str_utf8_offset(p, e, len);
<a name="l01684"></a>01684     }
<a name="l01685"></a>01685 <span class="preprocessor">#endif</span>
<a name="l01686"></a>01686 <span class="preprocessor"></span>    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d5/de3/encoding_8h.html#a6b942f8457214c49fcf8541c60a38306">rb_enc_mbmaxlen</a>(enc) == <a class="code" href="../../d5/de3/encoding_8h.html#aaffb0395eb9bf0b3ba3175fa5c9c1615">rb_enc_mbminlen</a>(enc)) {
<a name="l01687"></a>01687         <span class="keywordtype">int</span> char_sz = <a class="code" href="../../d5/de3/encoding_8h.html#a6b942f8457214c49fcf8541c60a38306">rb_enc_mbmaxlen</a>(enc);
<a name="l01688"></a>01688 
<a name="l01689"></a>01689         p = s + beg * char_sz;
<a name="l01690"></a>01690         <span class="keywordflow">if</span> (p &gt; e) {
<a name="l01691"></a>01691             <span class="keywordflow">return</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a320970f989dc8294c8203154e3db40c1">Qnil</a>;
<a name="l01692"></a>01692         }
<a name="l01693"></a>01693         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (len * char_sz &gt; e - p)
<a name="l01694"></a>01694             len = e - p;
<a name="l01695"></a>01695         <span class="keywordflow">else</span>
<a name="l01696"></a>01696             len *= char_sz;
<a name="l01697"></a>01697     }
<a name="l01698"></a>01698     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((p = <a class="code" href="../../d1/db0/string_8c.html#ad62975cece8719a29aa8b0e43477a1a1">str_nth_len</a>(s, e, &amp;beg, enc)) == e) {
<a name="l01699"></a>01699         <span class="keywordflow">if</span> (beg &gt; 0) <span class="keywordflow">return</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a320970f989dc8294c8203154e3db40c1">Qnil</a>;
<a name="l01700"></a>01700         len = 0;
<a name="l01701"></a>01701     }
<a name="l01702"></a>01702     <span class="keywordflow">else</span> {
<a name="l01703"></a>01703         len = <a class="code" href="../../d1/db0/string_8c.html#a0e1c768ca3baf15d6a4ec3581ba3297c">str_offset</a>(p, e, len, enc, 0);
<a name="l01704"></a>01704     }
<a name="l01705"></a>01705   <a class="code" href="../../d1/d6f/date__strftime_8c.html#a0d7154c0cddedcee49293c3e1f47d643">sub</a>:
<a name="l01706"></a>01706     <span class="keywordflow">if</span> (len &gt; <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a92657ad1be8a8a323df19648e33b47b5">RSTRING_EMBED_LEN_MAX</a> &amp;&amp; beg + len == <a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(str)) {
<a name="l01707"></a>01707         str2 = <a class="code" href="../../db/d2e/intern_8h.html#af609add406b0ef084a38f6dd615119d6">rb_str_new4</a>(str);
<a name="l01708"></a>01708         str2 = <a class="code" href="../../d1/db0/string_8c.html#a4d8a594117e1ef7b3ca1b0466b384256">str_new3</a>(<a class="code" href="../../db/d2e/intern_8h.html#ac2be7243e739fa8f5dce6be0c8ee5f6d">rb_obj_class</a>(str2), str2);
<a name="l01709"></a>01709         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac695b0c61b18410ebcf22584fe0a6f6f">RSTRING</a>(str2)-&gt;as.heap.ptr += <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac695b0c61b18410ebcf22584fe0a6f6f">RSTRING</a>(str2)-&gt;as.heap.len - len;
<a name="l01710"></a>01710         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac695b0c61b18410ebcf22584fe0a6f6f">RSTRING</a>(str2)-&gt;as.heap.len = len;
<a name="l01711"></a>01711     }
<a name="l01712"></a>01712     <span class="keywordflow">else</span> {
<a name="l01713"></a>01713         str2 = <a class="code" href="../../db/d2e/intern_8h.html#a70b7301e6960c402803fa81c7a0777d0">rb_str_new5</a>(str, p, len);
<a name="l01714"></a>01714         <a class="code" href="../../d1/db0/string_8c.html#a52e3afb878f939e397b9443c8e082c54">rb_enc_cr_str_copy_for_substr</a>(str2, str);
<a name="l01715"></a>01715         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3bf9ab455a1e0e3e8cfc6ebabd8f12df">OBJ_INFECT</a>(str2, str);
<a name="l01716"></a>01716     }
<a name="l01717"></a>01717 
<a name="l01718"></a>01718     <span class="keywordflow">return</span> str2;
<a name="l01719"></a>01719 }
<a name="l01720"></a>01720 
<a name="l01721"></a>01721 <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l01722"></a><a class="code" href="../../d1/db0/string_8c.html#ab6552b50e0fbcde3a00849b6c5d8bf62">01722</a> <a class="code" href="../../db/d2e/intern_8h.html#a086b740785459822cc7ca924430bd6d7">rb_str_freeze</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str)
<a name="l01723"></a>01723 {
<a name="l01724"></a>01724     <span class="keywordflow">if</span> (<a class="code" href="../../d1/db0/string_8c.html#a6fc2cd334583cde7a99b5753c6ff18a4">STR_ASSOC_P</a>(str)) {
<a name="l01725"></a>01725         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> ary = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac695b0c61b18410ebcf22584fe0a6f6f">RSTRING</a>(str)-&gt;as.heap.aux.shared;
<a name="l01726"></a>01726         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a7ae8fa209abf837905d53c1c4be7c75d">OBJ_FREEZE</a>(ary);
<a name="l01727"></a>01727     }
<a name="l01728"></a>01728     <span class="keywordflow">return</span> <a class="code" href="../../db/d2e/intern_8h.html#a8ea3742679211f408cb5769de6cf0d46">rb_obj_freeze</a>(str);
<a name="l01729"></a>01729 }
<a name="l01730"></a>01730 
<a name="l01731"></a><a class="code" href="../../d1/db0/string_8c.html#aa4407a6dbd52b72006589ab88b427f49">01731</a> <a class="code" href="../../d8/db0/defines_8h.html#a4e367f1663d56ddd63e2cb1a8a3449b1">RUBY_ALIAS_FUNCTION</a>(<a class="code" href="../../db/d2e/intern_8h.html#ac812c8a8fec28c0938623985eef248dc">rb_str_dup_frozen</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str), <a class="code" href="../../db/d2e/intern_8h.html#ab771cea1c6187da7a08e9f0bc309a0a6">rb_str_new_frozen</a>, (str))
<a name="l01732"></a>01732 <span class="preprocessor">#define rb_str_dup_frozen rb_str_new_frozen</span>
<a name="l01733"></a>01733 <span class="preprocessor"></span>
<a name="l01734"></a>01734 <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l01735"></a>01735 <a class="code" href="../../db/d2e/intern_8h.html#ac8be785eb014dbaac6d9daeba3cbaf17">rb_str_locktmp</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str)
<a name="l01736"></a>01736 {
<a name="l01737"></a>01737     <span class="keywordflow">if</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a1ae918b6cc84188a9dc6ab545f732e4d">FL_TEST</a>(str, <a class="code" href="../../d1/db0/string_8c.html#abd8cc5329f77d70abfffe4284503e3cd">STR_TMPLOCK</a>)) {
<a name="l01738"></a>01738         <a class="code" href="../../db/dcc/error_8c.html#a0f771a2840561f1838169b3d7d4616f3">rb_raise</a>(<a class="code" href="../../db/dcc/error_8c.html#a95ad3953d535707e2cf2b1d837f5e253">rb_eRuntimeError</a>, <span class="stringliteral">&quot;temporal locking already locked string&quot;</span>);
<a name="l01739"></a>01739     }
<a name="l01740"></a>01740     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a38d7199dc0d1dc7f7207a9b3091c8d0d">FL_SET</a>(str, <a class="code" href="../../d1/db0/string_8c.html#abd8cc5329f77d70abfffe4284503e3cd">STR_TMPLOCK</a>);
<a name="l01741"></a>01741     <span class="keywordflow">return</span> str;
<a name="l01742"></a>01742 }
<a name="l01743"></a>01743 
<a name="l01744"></a>01744 <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l01745"></a><a class="code" href="../../d1/db0/string_8c.html#ad59cfd2931491bfa35caa61f9a7fd48a">01745</a> <a class="code" href="../../db/d2e/intern_8h.html#a027ec67101bdfadde1553c0a0a70c724">rb_str_unlocktmp</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str)
<a name="l01746"></a>01746 {
<a name="l01747"></a>01747     <span class="keywordflow">if</span> (!<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a1ae918b6cc84188a9dc6ab545f732e4d">FL_TEST</a>(str, <a class="code" href="../../d1/db0/string_8c.html#abd8cc5329f77d70abfffe4284503e3cd">STR_TMPLOCK</a>)) {
<a name="l01748"></a>01748         <a class="code" href="../../db/dcc/error_8c.html#a0f771a2840561f1838169b3d7d4616f3">rb_raise</a>(<a class="code" href="../../db/dcc/error_8c.html#a95ad3953d535707e2cf2b1d837f5e253">rb_eRuntimeError</a>, <span class="stringliteral">&quot;temporal unlocking already unlocked string&quot;</span>);
<a name="l01749"></a>01749     }
<a name="l01750"></a>01750     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a6db7676c6cc4059a7cf021be34f53840">FL_UNSET</a>(str, <a class="code" href="../../d1/db0/string_8c.html#abd8cc5329f77d70abfffe4284503e3cd">STR_TMPLOCK</a>);
<a name="l01751"></a>01751     <span class="keywordflow">return</span> str;
<a name="l01752"></a>01752 }
<a name="l01753"></a>01753 
<a name="l01754"></a>01754 <span class="keywordtype">void</span>
<a name="l01755"></a><a class="code" href="../../d1/db0/string_8c.html#a8ffeaf4923db2f23e0f9003c5eb1f4cc">01755</a> <a class="code" href="../../d8/d81/ruby__missing_8h.html#a89ed8cb86ca6dd49d2db67adae809057">rb_str_set_len</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str, <span class="keywordtype">long</span> len)
<a name="l01756"></a>01756 {
<a name="l01757"></a>01757     <span class="keywordtype">long</span> capa;
<a name="l01758"></a>01758 
<a name="l01759"></a>01759     <a class="code" href="../../d1/db0/string_8c.html#a865d4f66b7c8fca1f7fd9afa3298a56e">str_modifiable</a>(str);
<a name="l01760"></a>01760     <span class="keywordflow">if</span> (<a class="code" href="../../d1/db0/string_8c.html#a47a46c073102a116dc86fbe598a8694e">STR_SHARED_P</a>(str)) {
<a name="l01761"></a>01761         <a class="code" href="../../db/dcc/error_8c.html#a0f771a2840561f1838169b3d7d4616f3">rb_raise</a>(<a class="code" href="../../db/dcc/error_8c.html#a95ad3953d535707e2cf2b1d837f5e253">rb_eRuntimeError</a>, <span class="stringliteral">&quot;can&apos;t set length of shared string&quot;</span>);
<a name="l01762"></a>01762     }
<a name="l01763"></a>01763     <span class="keywordflow">if</span> (len &gt; (capa = (<span class="keywordtype">long</span>)<a class="code" href="../../db/d2e/intern_8h.html#ae3485fb3fdd9b960dc803374b044c567">rb_str_capacity</a>(str))) {
<a name="l01764"></a>01764         <a class="code" href="../../db/dcc/error_8c.html#a2d5fb28e54f792e7341b2c45f52f3860">rb_bug</a>(<span class="stringliteral">&quot;probable buffer overflow: %ld for %ld&quot;</span>, len, capa);
<a name="l01765"></a>01765     }
<a name="l01766"></a>01766     <a class="code" href="../../d1/db0/string_8c.html#a056c7c0a74c83ccdb5a160bbdcbf8c3b">STR_SET_LEN</a>(str, len);
<a name="l01767"></a>01767     <a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(str)[len] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l01768"></a>01768 }
<a name="l01769"></a>01769 
<a name="l01770"></a>01770 <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l01771"></a><a class="code" href="../../d1/db0/string_8c.html#adb2340e9d665ee04eec4ce17d8739880">01771</a> <a class="code" href="../../db/d2e/intern_8h.html#a0a133856edb99f69eae3cb5a9e275ac9">rb_str_resize</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str, <span class="keywordtype">long</span> len)
<a name="l01772"></a>01772 {
<a name="l01773"></a>01773     <span class="keywordtype">long</span> slen;
<a name="l01774"></a>01774     <span class="keywordtype">int</span> independent;
<a name="l01775"></a>01775 
<a name="l01776"></a>01776     <span class="keywordflow">if</span> (len &lt; 0) {
<a name="l01777"></a>01777         <a class="code" href="../../db/dcc/error_8c.html#a0f771a2840561f1838169b3d7d4616f3">rb_raise</a>(<a class="code" href="../../db/dcc/error_8c.html#ab5e2a9fec766c75176fbb262bfe6a596">rb_eArgError</a>, <span class="stringliteral">&quot;negative string size (or size too big)&quot;</span>);
<a name="l01778"></a>01778     }
<a name="l01779"></a>01779 
<a name="l01780"></a>01780     independent = <a class="code" href="../../d1/db0/string_8c.html#aaadaeb79729999ff540000c6d21349b9">str_independent</a>(str);
<a name="l01781"></a>01781     <a class="code" href="../../d5/de3/encoding_8h.html#ae0d61803f8b4b76dab41851f686c6a19">ENC_CODERANGE_CLEAR</a>(str);
<a name="l01782"></a>01782     slen = <a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(str);
<a name="l01783"></a>01783     <span class="keywordflow">if</span> (len != slen) {
<a name="l01784"></a>01784         <span class="keywordflow">if</span> (<a class="code" href="../../d1/db0/string_8c.html#a0823acc422a6a849b53cf3ae0465b543">STR_EMBED_P</a>(str)) {
<a name="l01785"></a>01785             <span class="keywordflow">if</span> (len &lt;= <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a92657ad1be8a8a323df19648e33b47b5">RSTRING_EMBED_LEN_MAX</a>) {
<a name="l01786"></a>01786                 <a class="code" href="../../d1/db0/string_8c.html#ac1f52d89a2e4d0dda456490dcfe70993">STR_SET_EMBED_LEN</a>(str, len);
<a name="l01787"></a>01787                 <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac695b0c61b18410ebcf22584fe0a6f6f">RSTRING</a>(str)-&gt;as.ary[len] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l01788"></a>01788                 <span class="keywordflow">return</span> str;
<a name="l01789"></a>01789             }
<a name="l01790"></a>01790             <a class="code" href="../../d1/db0/string_8c.html#a44c8f7755f936a74a2991e3d47e0b14d">str_make_independent_expand</a>(str, len - slen);
<a name="l01791"></a>01791             <a class="code" href="../../d1/db0/string_8c.html#a220a3ea405f8427a2b119e8cda01524e">STR_SET_NOEMBED</a>(str);
<a name="l01792"></a>01792         }
<a name="l01793"></a>01793         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (len &lt;= <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a92657ad1be8a8a323df19648e33b47b5">RSTRING_EMBED_LEN_MAX</a>) {
<a name="l01794"></a>01794             <span class="keywordtype">char</span> *ptr = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac695b0c61b18410ebcf22584fe0a6f6f">RSTRING</a>(str)-&gt;as.heap.ptr;
<a name="l01795"></a>01795             <a class="code" href="../../d1/db0/string_8c.html#a598a41ca866cde6d9854bf77f48b006d">STR_SET_EMBED</a>(str);
<a name="l01796"></a>01796             <span class="keywordflow">if</span> (slen &gt; len) slen = len;
<a name="l01797"></a>01797             <span class="keywordflow">if</span> (slen &gt; 0) <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a04ab67335215e8362c63ed27ae2d1c40">MEMCPY</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac695b0c61b18410ebcf22584fe0a6f6f">RSTRING</a>(str)-&gt;as.ary, ptr, <span class="keywordtype">char</span>, slen);
<a name="l01798"></a>01798             <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac695b0c61b18410ebcf22584fe0a6f6f">RSTRING</a>(str)-&gt;as.ary[len] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l01799"></a>01799             <a class="code" href="../../d1/db0/string_8c.html#ac1f52d89a2e4d0dda456490dcfe70993">STR_SET_EMBED_LEN</a>(str, len);
<a name="l01800"></a>01800             <span class="keywordflow">if</span> (independent) <a class="code" href="../../d8/db0/defines_8h.html#a2c3897f7c46ca54a2e0dd7b24a40c7cb">xfree</a>(ptr);
<a name="l01801"></a>01801             <span class="keywordflow">return</span> str;
<a name="l01802"></a>01802         }
<a name="l01803"></a>01803         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!independent) {
<a name="l01804"></a>01804             <a class="code" href="../../d1/db0/string_8c.html#a44c8f7755f936a74a2991e3d47e0b14d">str_make_independent_expand</a>(str, len - slen);
<a name="l01805"></a>01805         }
<a name="l01806"></a>01806         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (slen &lt; len || slen - len &gt; 1024) {
<a name="l01807"></a>01807             <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a5160cad2d7d090e4d2e8803f1ba5ee3c">REALLOC_N</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac695b0c61b18410ebcf22584fe0a6f6f">RSTRING</a>(str)-&gt;as.heap.ptr, <span class="keywordtype">char</span>, len+1);
<a name="l01808"></a>01808         }
<a name="l01809"></a>01809         <span class="keywordflow">if</span> (!<a class="code" href="../../d1/db0/string_8c.html#a2e4889499fa17d4a63dc76b35f4b208e">STR_NOCAPA_P</a>(str)) {
<a name="l01810"></a>01810             <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac695b0c61b18410ebcf22584fe0a6f6f">RSTRING</a>(str)-&gt;as.heap.aux.capa = len;
<a name="l01811"></a>01811         }
<a name="l01812"></a>01812         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac695b0c61b18410ebcf22584fe0a6f6f">RSTRING</a>(str)-&gt;as.heap.len = len;
<a name="l01813"></a>01813         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac695b0c61b18410ebcf22584fe0a6f6f">RSTRING</a>(str)-&gt;as.heap.ptr[len] = <span class="charliteral">&apos;\0&apos;</span>;  <span class="comment">/* sentinel */</span>
<a name="l01814"></a>01814     }
<a name="l01815"></a>01815     <span class="keywordflow">return</span> str;
<a name="l01816"></a>01816 }
<a name="l01817"></a>01817 
<a name="l01818"></a>01818 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l01819"></a><a class="code" href="../../d1/db0/string_8c.html#a0cd14f2af7846dd4a6405fa3ada431ff">01819</a> <a class="code" href="../../d1/db0/string_8c.html#a0cd14f2af7846dd4a6405fa3ada431ff">str_buf_cat</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str, <span class="keyword">const</span> <span class="keywordtype">char</span> *ptr, <span class="keywordtype">long</span> len)
<a name="l01820"></a>01820 {
<a name="l01821"></a>01821     <span class="keywordtype">long</span> capa, total, off = -1;
<a name="l01822"></a>01822 
<a name="l01823"></a>01823     <span class="keywordflow">if</span> (ptr &gt;= <a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(str) &amp;&amp; ptr &lt;= <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a35bfa2635774977edad0a16b9fdebbaf">RSTRING_END</a>(str)) {
<a name="l01824"></a>01824         off = ptr - <a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(str);
<a name="l01825"></a>01825     }
<a name="l01826"></a>01826     <a class="code" href="../../db/d2e/intern_8h.html#a63a6d05687cf812131dce11743581b9d">rb_str_modify</a>(str);
<a name="l01827"></a>01827     <span class="keywordflow">if</span> (len == 0) <span class="keywordflow">return</span> 0;
<a name="l01828"></a>01828     <span class="keywordflow">if</span> (<a class="code" href="../../d1/db0/string_8c.html#a6fc2cd334583cde7a99b5753c6ff18a4">STR_ASSOC_P</a>(str)) {
<a name="l01829"></a>01829         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a6db7676c6cc4059a7cf021be34f53840">FL_UNSET</a>(str, <a class="code" href="../../d8/d16/gc_8c.html#a2f2bd1a90a891cf8697328b4ba8d4d54">STR_ASSOC</a>);
<a name="l01830"></a>01830         capa = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac695b0c61b18410ebcf22584fe0a6f6f">RSTRING</a>(str)-&gt;as.heap.aux.capa = <a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(str);
<a name="l01831"></a>01831     }
<a name="l01832"></a>01832     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d1/db0/string_8c.html#a0823acc422a6a849b53cf3ae0465b543">STR_EMBED_P</a>(str)) {
<a name="l01833"></a>01833         capa = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a92657ad1be8a8a323df19648e33b47b5">RSTRING_EMBED_LEN_MAX</a>;
<a name="l01834"></a>01834     }
<a name="l01835"></a>01835     <span class="keywordflow">else</span> {
<a name="l01836"></a>01836         capa = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac695b0c61b18410ebcf22584fe0a6f6f">RSTRING</a>(str)-&gt;as.heap.aux.capa;
<a name="l01837"></a>01837     }
<a name="l01838"></a>01838     <span class="keywordflow">if</span> (<a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(str) &gt;= <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a50fece4db74f09568b2938db583c5655">LONG_MAX</a> - len) {
<a name="l01839"></a>01839         <a class="code" href="../../db/dcc/error_8c.html#a0f771a2840561f1838169b3d7d4616f3">rb_raise</a>(<a class="code" href="../../db/dcc/error_8c.html#ab5e2a9fec766c75176fbb262bfe6a596">rb_eArgError</a>, <span class="stringliteral">&quot;string sizes too big&quot;</span>);
<a name="l01840"></a>01840     }
<a name="l01841"></a>01841     total = <a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(str)+len;
<a name="l01842"></a>01842     <span class="keywordflow">if</span> (capa &lt;= total) {
<a name="l01843"></a>01843         <span class="keywordflow">while</span> (total &gt; capa) {
<a name="l01844"></a>01844             <span class="keywordflow">if</span> (capa + 1 &gt;= <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a50fece4db74f09568b2938db583c5655">LONG_MAX</a> / 2) {
<a name="l01845"></a>01845                 capa = (total + 4095) / 4096;
<a name="l01846"></a>01846                 <span class="keywordflow">break</span>;
<a name="l01847"></a>01847             }
<a name="l01848"></a>01848             capa = (capa + 1) * 2;
<a name="l01849"></a>01849         }
<a name="l01850"></a>01850         <a class="code" href="../../d1/db0/string_8c.html#ab8dafff9534eaf6545585223ada6b1c8">RESIZE_CAPA</a>(str, capa);
<a name="l01851"></a>01851     }
<a name="l01852"></a>01852     <span class="keywordflow">if</span> (off != -1) {
<a name="l01853"></a>01853         ptr = <a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(str) + off;
<a name="l01854"></a>01854     }
<a name="l01855"></a>01855     memcpy(<a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(str) + <a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(str), ptr, len);
<a name="l01856"></a>01856     <a class="code" href="../../d1/db0/string_8c.html#a056c7c0a74c83ccdb5a160bbdcbf8c3b">STR_SET_LEN</a>(str, total);
<a name="l01857"></a>01857     <a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(str)[total] = <span class="charliteral">&apos;\0&apos;</span>; <span class="comment">/* sentinel */</span>
<a name="l01858"></a>01858 
<a name="l01859"></a>01859     <span class="keywordflow">return</span> str;
<a name="l01860"></a>01860 }
<a name="l01861"></a>01861 
<a name="l01862"></a><a class="code" href="../../d1/db0/string_8c.html#aa9f48497a1abe9aebc8a45041be0983d">01862</a> <span class="preprocessor">#define str_buf_cat2(str, ptr) str_buf_cat((str), (ptr), strlen(ptr))</span>
<a name="l01863"></a>01863 <span class="preprocessor"></span>
<a name="l01864"></a>01864 <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l01865"></a><a class="code" href="../../d1/db0/string_8c.html#a8067c158e2f8cafe39e8052635fe421d">01865</a> <a class="code" href="../../db/d2e/intern_8h.html#a4dff49e6d9aa925fd94fc5100b3c399b">rb_str_buf_cat</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str, <span class="keyword">const</span> <span class="keywordtype">char</span> *ptr, <span class="keywordtype">long</span> len)
<a name="l01866"></a>01866 {
<a name="l01867"></a>01867     <span class="keywordflow">if</span> (len == 0) <span class="keywordflow">return</span> str;
<a name="l01868"></a>01868     <span class="keywordflow">if</span> (len &lt; 0) {
<a name="l01869"></a>01869         <a class="code" href="../../db/dcc/error_8c.html#a0f771a2840561f1838169b3d7d4616f3">rb_raise</a>(<a class="code" href="../../db/dcc/error_8c.html#ab5e2a9fec766c75176fbb262bfe6a596">rb_eArgError</a>, <span class="stringliteral">&quot;negative string size (or size too big)&quot;</span>);
<a name="l01870"></a>01870     }
<a name="l01871"></a>01871     <span class="keywordflow">return</span> <a class="code" href="../../d1/db0/string_8c.html#a0cd14f2af7846dd4a6405fa3ada431ff">str_buf_cat</a>(str, ptr, len);
<a name="l01872"></a>01872 }
<a name="l01873"></a>01873 
<a name="l01874"></a>01874 <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l01875"></a><a class="code" href="../../d1/db0/string_8c.html#a57007e1c45c7dbe1dd84d84c8bcb59c7">01875</a> <a class="code" href="../../db/d2e/intern_8h.html#a7866feb2bb4aee9e8fbfd43195638255">rb_str_buf_cat2</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str, <span class="keyword">const</span> <span class="keywordtype">char</span> *ptr)
<a name="l01876"></a>01876 {
<a name="l01877"></a>01877     <span class="keywordflow">return</span> <a class="code" href="../../db/d2e/intern_8h.html#a4dff49e6d9aa925fd94fc5100b3c399b">rb_str_buf_cat</a>(str, ptr, <a class="code" href="../../d6/d7b/strchr_8c.html#a219836f542ce53545052bed5353820ca">strlen</a>(ptr));
<a name="l01878"></a>01878 }
<a name="l01879"></a>01879 
<a name="l01880"></a>01880 <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l01881"></a><a class="code" href="../../d1/db0/string_8c.html#a27c752337b123caf807b2cee0aa0aefb">01881</a> <a class="code" href="../../db/d2e/intern_8h.html#a4e3e3ccf959b5db6c125a68e1e1db0a3">rb_str_cat</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str, <span class="keyword">const</span> <span class="keywordtype">char</span> *ptr, <span class="keywordtype">long</span> len)
<a name="l01882"></a>01882 {
<a name="l01883"></a>01883     <span class="keywordflow">if</span> (len &lt; 0) {
<a name="l01884"></a>01884         <a class="code" href="../../db/dcc/error_8c.html#a0f771a2840561f1838169b3d7d4616f3">rb_raise</a>(<a class="code" href="../../db/dcc/error_8c.html#ab5e2a9fec766c75176fbb262bfe6a596">rb_eArgError</a>, <span class="stringliteral">&quot;negative string size (or size too big)&quot;</span>);
<a name="l01885"></a>01885     }
<a name="l01886"></a>01886     <span class="keywordflow">if</span> (<a class="code" href="../../d1/db0/string_8c.html#a6fc2cd334583cde7a99b5753c6ff18a4">STR_ASSOC_P</a>(str)) {
<a name="l01887"></a>01887         <span class="keywordtype">char</span> *p;
<a name="l01888"></a>01888         <a class="code" href="../../db/d2e/intern_8h.html#abc41f64bde8ae25d5ea021cfdaa0d9dd">rb_str_modify_expand</a>(str, len);
<a name="l01889"></a>01889         p = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac695b0c61b18410ebcf22584fe0a6f6f">RSTRING</a>(str)-&gt;as.heap.ptr;
<a name="l01890"></a>01890         memcpy(p + <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac695b0c61b18410ebcf22584fe0a6f6f">RSTRING</a>(str)-&gt;as.heap.len, ptr, len);
<a name="l01891"></a>01891         len = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac695b0c61b18410ebcf22584fe0a6f6f">RSTRING</a>(str)-&gt;as.heap.len += len;
<a name="l01892"></a>01892         p[len] = <span class="charliteral">&apos;\0&apos;</span>; <span class="comment">/* sentinel */</span>
<a name="l01893"></a>01893         <span class="keywordflow">return</span> str;
<a name="l01894"></a>01894     }
<a name="l01895"></a>01895 
<a name="l01896"></a>01896     <span class="keywordflow">return</span> <a class="code" href="../../db/d2e/intern_8h.html#a4dff49e6d9aa925fd94fc5100b3c399b">rb_str_buf_cat</a>(str, ptr, len);
<a name="l01897"></a>01897 }
<a name="l01898"></a>01898 
<a name="l01899"></a>01899 <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l01900"></a><a class="code" href="../../d1/db0/string_8c.html#ae29776f588b6fa003ba3c43310f23f66">01900</a> <a class="code" href="../../db/d2e/intern_8h.html#a5bd27db3e38af6131db24321c7cf9ec6">rb_str_cat2</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str, <span class="keyword">const</span> <span class="keywordtype">char</span> *ptr)
<a name="l01901"></a>01901 {
<a name="l01902"></a>01902     <span class="keywordflow">return</span> <a class="code" href="../../db/d2e/intern_8h.html#a4e3e3ccf959b5db6c125a68e1e1db0a3">rb_str_cat</a>(str, ptr, <a class="code" href="../../d6/d7b/strchr_8c.html#a219836f542ce53545052bed5353820ca">strlen</a>(ptr));
<a name="l01903"></a>01903 }
<a name="l01904"></a>01904 
<a name="l01905"></a>01905 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l01906"></a><a class="code" href="../../d1/db0/string_8c.html#a5dc225ff9437147d19173e7c11fb1dcd">01906</a> <a class="code" href="../../d1/db0/string_8c.html#a5dc225ff9437147d19173e7c11fb1dcd">rb_enc_cr_str_buf_cat</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str, <span class="keyword">const</span> <span class="keywordtype">char</span> *ptr, <span class="keywordtype">long</span> len,
<a name="l01907"></a>01907     <span class="keywordtype">int</span> ptr_encindex, <span class="keywordtype">int</span> ptr_cr, <span class="keywordtype">int</span> *ptr_cr_ret)
<a name="l01908"></a>01908 {
<a name="l01909"></a>01909     <span class="keywordtype">int</span> str_encindex = <a class="code" href="../../d5/de3/encoding_8h.html#a6ba07266a084d7a480377f1472aabfd8">ENCODING_GET</a>(str);
<a name="l01910"></a>01910     <span class="keywordtype">int</span> res_encindex;
<a name="l01911"></a>01911     <span class="keywordtype">int</span> str_cr, res_cr;
<a name="l01912"></a>01912 
<a name="l01913"></a>01913     str_cr = <a class="code" href="../../d5/de3/encoding_8h.html#a5901233f6f9004aebbdeccdd33cf449f">ENC_CODERANGE</a>(str);
<a name="l01914"></a>01914 
<a name="l01915"></a>01915     <span class="keywordflow">if</span> (str_encindex == ptr_encindex) {
<a name="l01916"></a>01916         <span class="keywordflow">if</span> (str_cr == <a class="code" href="../../d5/de3/encoding_8h.html#a60de9709709968f9627365a6cd0ff5d1">ENC_CODERANGE_UNKNOWN</a>)
<a name="l01917"></a>01917             ptr_cr = <a class="code" href="../../d5/de3/encoding_8h.html#a60de9709709968f9627365a6cd0ff5d1">ENC_CODERANGE_UNKNOWN</a>;
<a name="l01918"></a>01918         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ptr_cr == <a class="code" href="../../d5/de3/encoding_8h.html#a60de9709709968f9627365a6cd0ff5d1">ENC_CODERANGE_UNKNOWN</a>) {
<a name="l01919"></a>01919             ptr_cr = <a class="code" href="../../d1/db0/string_8c.html#af47bc9a7bbb51656cecb095780518d7f">coderange_scan</a>(ptr, len, <a class="code" href="../../d5/db5/encoding_8c.html#aef9c377b2d9d78b9f88e890b77593109">rb_enc_from_index</a>(ptr_encindex));
<a name="l01920"></a>01920         }
<a name="l01921"></a>01921     }
<a name="l01922"></a>01922     <span class="keywordflow">else</span> {
<a name="l01923"></a>01923         <a class="code" href="../../d1/d7b/struct_onig_encoding_type_s_t.html">rb_encoding</a> *str_enc = <a class="code" href="../../d5/db5/encoding_8c.html#aef9c377b2d9d78b9f88e890b77593109">rb_enc_from_index</a>(str_encindex);
<a name="l01924"></a>01924         <a class="code" href="../../d1/d7b/struct_onig_encoding_type_s_t.html">rb_encoding</a> *ptr_enc = <a class="code" href="../../d5/db5/encoding_8c.html#aef9c377b2d9d78b9f88e890b77593109">rb_enc_from_index</a>(ptr_encindex);
<a name="l01925"></a>01925         <span class="keywordflow">if</span> (!<a class="code" href="../../d5/de3/encoding_8h.html#a8b18a09a3055d3006c6d5baeaa6e7c72">rb_enc_asciicompat</a>(str_enc) || !<a class="code" href="../../d5/de3/encoding_8h.html#a8b18a09a3055d3006c6d5baeaa6e7c72">rb_enc_asciicompat</a>(ptr_enc)) {
<a name="l01926"></a>01926             <span class="keywordflow">if</span> (len == 0)
<a name="l01927"></a>01927                 <span class="keywordflow">return</span> str;
<a name="l01928"></a>01928             <span class="keywordflow">if</span> (<a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(str) == 0) {
<a name="l01929"></a>01929                 <a class="code" href="../../db/d2e/intern_8h.html#a4dff49e6d9aa925fd94fc5100b3c399b">rb_str_buf_cat</a>(str, ptr, len);
<a name="l01930"></a>01930                 <a class="code" href="../../d5/de3/encoding_8h.html#af06e3f35ff3b6d79190eaf397328e7e6">ENCODING_CODERANGE_SET</a>(str, ptr_encindex, ptr_cr);
<a name="l01931"></a>01931                 <span class="keywordflow">return</span> str;
<a name="l01932"></a>01932             }
<a name="l01933"></a>01933             <span class="keywordflow">goto</span> incompatible;
<a name="l01934"></a>01934         }
<a name="l01935"></a>01935         <span class="keywordflow">if</span> (ptr_cr == <a class="code" href="../../d5/de3/encoding_8h.html#a60de9709709968f9627365a6cd0ff5d1">ENC_CODERANGE_UNKNOWN</a>) {
<a name="l01936"></a>01936             ptr_cr = <a class="code" href="../../d1/db0/string_8c.html#af47bc9a7bbb51656cecb095780518d7f">coderange_scan</a>(ptr, len, ptr_enc);
<a name="l01937"></a>01937         }
<a name="l01938"></a>01938         <span class="keywordflow">if</span> (str_cr == <a class="code" href="../../d5/de3/encoding_8h.html#a60de9709709968f9627365a6cd0ff5d1">ENC_CODERANGE_UNKNOWN</a>) {
<a name="l01939"></a>01939             <span class="keywordflow">if</span> (<a class="code" href="../../d5/de3/encoding_8h.html#ae5ff9694c99a5306a9415ac51e8c4faa">ENCODING_IS_ASCII8BIT</a>(str) || ptr_cr != <a class="code" href="../../d5/de3/encoding_8h.html#a0a0e73a2d98205044e1ad19432502c5b">ENC_CODERANGE_7BIT</a>) {
<a name="l01940"></a>01940                 str_cr = <a class="code" href="../../d5/de3/encoding_8h.html#a5282c41e11a68fe310f45c9a326ae2b8">rb_enc_str_coderange</a>(str);
<a name="l01941"></a>01941             }
<a name="l01942"></a>01942         }
<a name="l01943"></a>01943     }
<a name="l01944"></a>01944     <span class="keywordflow">if</span> (ptr_cr_ret)
<a name="l01945"></a>01945         *ptr_cr_ret = ptr_cr;
<a name="l01946"></a>01946 
<a name="l01947"></a>01947     <span class="keywordflow">if</span> (str_encindex != ptr_encindex &amp;&amp;
<a name="l01948"></a>01948         str_cr != <a class="code" href="../../d5/de3/encoding_8h.html#a0a0e73a2d98205044e1ad19432502c5b">ENC_CODERANGE_7BIT</a> &amp;&amp;
<a name="l01949"></a>01949         ptr_cr != <a class="code" href="../../d5/de3/encoding_8h.html#a0a0e73a2d98205044e1ad19432502c5b">ENC_CODERANGE_7BIT</a>) {
<a name="l01950"></a>01950       incompatible:
<a name="l01951"></a>01951         <a class="code" href="../../db/dcc/error_8c.html#a0f771a2840561f1838169b3d7d4616f3">rb_raise</a>(<a class="code" href="../../db/dcc/error_8c.html#a71f980ead61a4ac261914ffaaa184e1f">rb_eEncCompatError</a>, <span class="stringliteral">&quot;incompatible character encodings: %s and %s&quot;</span>,
<a name="l01952"></a>01952             <a class="code" href="../../d5/de3/encoding_8h.html#a69d59d898802726787a168ef2e0dc92c">rb_enc_name</a>(<a class="code" href="../../d5/db5/encoding_8c.html#aef9c377b2d9d78b9f88e890b77593109">rb_enc_from_index</a>(str_encindex)),
<a name="l01953"></a>01953             <a class="code" href="../../d5/de3/encoding_8h.html#a69d59d898802726787a168ef2e0dc92c">rb_enc_name</a>(<a class="code" href="../../d5/db5/encoding_8c.html#aef9c377b2d9d78b9f88e890b77593109">rb_enc_from_index</a>(ptr_encindex)));
<a name="l01954"></a>01954     }
<a name="l01955"></a>01955 
<a name="l01956"></a>01956     <span class="keywordflow">if</span> (str_cr == <a class="code" href="../../d5/de3/encoding_8h.html#a60de9709709968f9627365a6cd0ff5d1">ENC_CODERANGE_UNKNOWN</a>) {
<a name="l01957"></a>01957         res_encindex = str_encindex;
<a name="l01958"></a>01958         res_cr = <a class="code" href="../../d5/de3/encoding_8h.html#a60de9709709968f9627365a6cd0ff5d1">ENC_CODERANGE_UNKNOWN</a>;
<a name="l01959"></a>01959     }
<a name="l01960"></a>01960     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (str_cr == <a class="code" href="../../d5/de3/encoding_8h.html#a0a0e73a2d98205044e1ad19432502c5b">ENC_CODERANGE_7BIT</a>) {
<a name="l01961"></a>01961         <span class="keywordflow">if</span> (ptr_cr == <a class="code" href="../../d5/de3/encoding_8h.html#a0a0e73a2d98205044e1ad19432502c5b">ENC_CODERANGE_7BIT</a>) {
<a name="l01962"></a>01962             res_encindex = str_encindex;
<a name="l01963"></a>01963             res_cr = <a class="code" href="../../d5/de3/encoding_8h.html#a0a0e73a2d98205044e1ad19432502c5b">ENC_CODERANGE_7BIT</a>;
<a name="l01964"></a>01964         }
<a name="l01965"></a>01965         <span class="keywordflow">else</span> {
<a name="l01966"></a>01966             res_encindex = ptr_encindex;
<a name="l01967"></a>01967             res_cr = ptr_cr;
<a name="l01968"></a>01968         }
<a name="l01969"></a>01969     }
<a name="l01970"></a>01970     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (str_cr == <a class="code" href="../../d5/de3/encoding_8h.html#a0c81a12daaa1e57009d46b9d906957dc">ENC_CODERANGE_VALID</a>) {
<a name="l01971"></a>01971         res_encindex = str_encindex;
<a name="l01972"></a>01972         <span class="keywordflow">if</span> (ptr_cr == <a class="code" href="../../d5/de3/encoding_8h.html#a0a0e73a2d98205044e1ad19432502c5b">ENC_CODERANGE_7BIT</a> || ptr_cr == <a class="code" href="../../d5/de3/encoding_8h.html#a0c81a12daaa1e57009d46b9d906957dc">ENC_CODERANGE_VALID</a>)
<a name="l01973"></a>01973             res_cr = str_cr;
<a name="l01974"></a>01974         <span class="keywordflow">else</span>
<a name="l01975"></a>01975             res_cr = ptr_cr;
<a name="l01976"></a>01976     }
<a name="l01977"></a>01977     <span class="keywordflow">else</span> { <span class="comment">/* str_cr == ENC_CODERANGE_BROKEN */</span>
<a name="l01978"></a>01978         res_encindex = str_encindex;
<a name="l01979"></a>01979         res_cr = str_cr;
<a name="l01980"></a>01980         <span class="keywordflow">if</span> (0 &lt; len) res_cr = <a class="code" href="../../d5/de3/encoding_8h.html#a60de9709709968f9627365a6cd0ff5d1">ENC_CODERANGE_UNKNOWN</a>;
<a name="l01981"></a>01981     }
<a name="l01982"></a>01982 
<a name="l01983"></a>01983     <span class="keywordflow">if</span> (len &lt; 0) {
<a name="l01984"></a>01984         <a class="code" href="../../db/dcc/error_8c.html#a0f771a2840561f1838169b3d7d4616f3">rb_raise</a>(<a class="code" href="../../db/dcc/error_8c.html#ab5e2a9fec766c75176fbb262bfe6a596">rb_eArgError</a>, <span class="stringliteral">&quot;negative string size (or size too big)&quot;</span>);
<a name="l01985"></a>01985     }
<a name="l01986"></a>01986     <a class="code" href="../../d1/db0/string_8c.html#a0cd14f2af7846dd4a6405fa3ada431ff">str_buf_cat</a>(str, ptr, len);
<a name="l01987"></a>01987     <a class="code" href="../../d5/de3/encoding_8h.html#af06e3f35ff3b6d79190eaf397328e7e6">ENCODING_CODERANGE_SET</a>(str, res_encindex, res_cr);
<a name="l01988"></a>01988     <span class="keywordflow">return</span> str;
<a name="l01989"></a>01989 }
<a name="l01990"></a>01990 
<a name="l01991"></a>01991 <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l01992"></a><a class="code" href="../../d1/db0/string_8c.html#ac154d008e2dc6452d8c637df9cadd6e9">01992</a> <a class="code" href="../../d5/de3/encoding_8h.html#a850cba00e6c7c1137d5224d4348c7fca">rb_enc_str_buf_cat</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str, <span class="keyword">const</span> <span class="keywordtype">char</span> *ptr, <span class="keywordtype">long</span> len, <a class="code" href="../../d1/d7b/struct_onig_encoding_type_s_t.html">rb_encoding</a> *ptr_enc)
<a name="l01993"></a>01993 {
<a name="l01994"></a>01994     <span class="keywordflow">return</span> <a class="code" href="../../d1/db0/string_8c.html#a5dc225ff9437147d19173e7c11fb1dcd">rb_enc_cr_str_buf_cat</a>(str, ptr, len,
<a name="l01995"></a>01995         <a class="code" href="../../d5/de3/encoding_8h.html#ad23f205c614c95726b919b2a8a1ac573">rb_enc_to_index</a>(ptr_enc), <a class="code" href="../../d5/de3/encoding_8h.html#a60de9709709968f9627365a6cd0ff5d1">ENC_CODERANGE_UNKNOWN</a>, <a class="code" href="../../d3/d09/ripper_8y.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l01996"></a>01996 }
<a name="l01997"></a>01997 
<a name="l01998"></a>01998 <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l01999"></a><a class="code" href="../../d1/db0/string_8c.html#a21995ac5c832bc54dc6d125ea09e4d2b">01999</a> <a class="code" href="../../db/d2e/intern_8h.html#ab60c5953186b8b096a23a3c7a8c0a414">rb_str_buf_cat_ascii</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str, <span class="keyword">const</span> <span class="keywordtype">char</span> *ptr)
<a name="l02000"></a>02000 {
<a name="l02001"></a>02001     <span class="comment">/* ptr must reference NUL terminated ASCII string. */</span>
<a name="l02002"></a>02002     <span class="keywordtype">int</span> encindex = <a class="code" href="../../d5/de3/encoding_8h.html#a6ba07266a084d7a480377f1472aabfd8">ENCODING_GET</a>(str);
<a name="l02003"></a>02003     <a class="code" href="../../d1/d7b/struct_onig_encoding_type_s_t.html">rb_encoding</a> *enc = <a class="code" href="../../d5/db5/encoding_8c.html#aef9c377b2d9d78b9f88e890b77593109">rb_enc_from_index</a>(encindex);
<a name="l02004"></a>02004     <span class="keywordflow">if</span> (<a class="code" href="../../d5/de3/encoding_8h.html#a8b18a09a3055d3006c6d5baeaa6e7c72">rb_enc_asciicompat</a>(enc)) {
<a name="l02005"></a>02005         <span class="keywordflow">return</span> <a class="code" href="../../d1/db0/string_8c.html#a5dc225ff9437147d19173e7c11fb1dcd">rb_enc_cr_str_buf_cat</a>(str, ptr, <a class="code" href="../../d6/d7b/strchr_8c.html#a219836f542ce53545052bed5353820ca">strlen</a>(ptr),
<a name="l02006"></a>02006             encindex, <a class="code" href="../../d5/de3/encoding_8h.html#a0a0e73a2d98205044e1ad19432502c5b">ENC_CODERANGE_7BIT</a>, 0);
<a name="l02007"></a>02007     }
<a name="l02008"></a>02008     <span class="keywordflow">else</span> {
<a name="l02009"></a>02009         <span class="keywordtype">char</span> *<a class="code" href="../../d6/da0/nkf-utf8_2nkf_8c.html#ac37f17a60c8b5533aac4840c681f62b8">buf</a> = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a1408f4b967485afd869990b67e766ceb">ALLOCA_N</a>(<span class="keywordtype">char</span>, <a class="code" href="../../d5/de3/encoding_8h.html#a6b942f8457214c49fcf8541c60a38306">rb_enc_mbmaxlen</a>(enc));
<a name="l02010"></a>02010         <span class="keywordflow">while</span> (*ptr) {
<a name="l02011"></a>02011             <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> c = (<span class="keywordtype">unsigned</span> char)*ptr;
<a name="l02012"></a>02012             <span class="keywordtype">int</span> len = <a class="code" href="../../d5/db5/encoding_8c.html#ae47c32c86d8d7d18127c9a1b2eb8c325">rb_enc_codelen</a>(c, enc);
<a name="l02013"></a>02013             <a class="code" href="../../d5/de3/encoding_8h.html#a243639504d867c0a638be91db2d19db1">rb_enc_mbcput</a>(c, buf, enc);
<a name="l02014"></a>02014             <a class="code" href="../../d1/db0/string_8c.html#a5dc225ff9437147d19173e7c11fb1dcd">rb_enc_cr_str_buf_cat</a>(str, buf, len,
<a name="l02015"></a>02015                 encindex, <a class="code" href="../../d5/de3/encoding_8h.html#a0c81a12daaa1e57009d46b9d906957dc">ENC_CODERANGE_VALID</a>, 0);
<a name="l02016"></a>02016             ptr++;
<a name="l02017"></a>02017         }
<a name="l02018"></a>02018         <span class="keywordflow">return</span> str;
<a name="l02019"></a>02019     }
<a name="l02020"></a>02020 }
<a name="l02021"></a>02021 
<a name="l02022"></a>02022 <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l02023"></a><a class="code" href="../../d1/db0/string_8c.html#a23d8aedd0724b2ae33f81211f8a4c9f9">02023</a> <a class="code" href="../../db/d2e/intern_8h.html#abea58f4d2559060d5821ff7d3d35a496">rb_str_buf_append</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str2)
<a name="l02024"></a>02024 {
<a name="l02025"></a>02025     <span class="keywordtype">int</span> str2_cr;
<a name="l02026"></a>02026 
<a name="l02027"></a>02027     str2_cr = <a class="code" href="../../d5/de3/encoding_8h.html#a5901233f6f9004aebbdeccdd33cf449f">ENC_CODERANGE</a>(str2);
<a name="l02028"></a>02028 
<a name="l02029"></a>02029     <a class="code" href="../../d1/db0/string_8c.html#a5dc225ff9437147d19173e7c11fb1dcd">rb_enc_cr_str_buf_cat</a>(str, <a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(str2), <a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(str2),
<a name="l02030"></a>02030         <a class="code" href="../../d5/de3/encoding_8h.html#a6ba07266a084d7a480377f1472aabfd8">ENCODING_GET</a>(str2), str2_cr, &amp;str2_cr);
<a name="l02031"></a>02031 
<a name="l02032"></a>02032     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3bf9ab455a1e0e3e8cfc6ebabd8f12df">OBJ_INFECT</a>(str, str2);
<a name="l02033"></a>02033     <a class="code" href="../../d5/de3/encoding_8h.html#aefe5772c0116cf7131a5227de7243dbc">ENC_CODERANGE_SET</a>(str2, str2_cr);
<a name="l02034"></a>02034 
<a name="l02035"></a>02035     <span class="keywordflow">return</span> str;
<a name="l02036"></a>02036 }
<a name="l02037"></a>02037 
<a name="l02038"></a>02038 <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l02039"></a><a class="code" href="../../d1/db0/string_8c.html#aaed414e548c3f23710bf200733416f02">02039</a> <a class="code" href="../../db/d2e/intern_8h.html#ab592dcd9e193dea76fb0ff58b5d907e4">rb_str_append</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str2)
<a name="l02040"></a>02040 {
<a name="l02041"></a>02041     <a class="code" href="../../d1/d7b/struct_onig_encoding_type_s_t.html">rb_encoding</a> *enc;
<a name="l02042"></a>02042     <span class="keywordtype">int</span> cr, cr2;
<a name="l02043"></a>02043     <span class="keywordtype">long</span> len2;
<a name="l02044"></a>02044 
<a name="l02045"></a>02045     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a0e80f207eb41e9010ec9f0f5f9419fea">StringValue</a>(str2);
<a name="l02046"></a>02046     <span class="keywordflow">if</span> ((len2 = <a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(str2)) &gt; 0 &amp;&amp; <a class="code" href="../../d1/db0/string_8c.html#a6fc2cd334583cde7a99b5753c6ff18a4">STR_ASSOC_P</a>(str)) {
<a name="l02047"></a>02047         <span class="keywordtype">long</span> len = <a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(str) + len2;
<a name="l02048"></a>02048         enc = <a class="code" href="../../d5/db5/encoding_8c.html#a7d17d602fae27de649f9310511c03db0">rb_enc_check</a>(str, str2);
<a name="l02049"></a>02049         cr = <a class="code" href="../../d5/de3/encoding_8h.html#a5901233f6f9004aebbdeccdd33cf449f">ENC_CODERANGE</a>(str);
<a name="l02050"></a>02050         <span class="keywordflow">if</span> ((cr2 = <a class="code" href="../../d5/de3/encoding_8h.html#a5901233f6f9004aebbdeccdd33cf449f">ENC_CODERANGE</a>(str2)) &gt; cr) cr = cr2;
<a name="l02051"></a>02051         <a class="code" href="../../db/d2e/intern_8h.html#abc41f64bde8ae25d5ea021cfdaa0d9dd">rb_str_modify_expand</a>(str, len2);
<a name="l02052"></a>02052         memcpy(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac695b0c61b18410ebcf22584fe0a6f6f">RSTRING</a>(str)-&gt;as.heap.ptr + <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac695b0c61b18410ebcf22584fe0a6f6f">RSTRING</a>(str)-&gt;as.heap.len,
<a name="l02053"></a>02053                <a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(str2), len2+1);
<a name="l02054"></a>02054         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac695b0c61b18410ebcf22584fe0a6f6f">RSTRING</a>(str)-&gt;as.heap.len = len;
<a name="l02055"></a>02055         <a class="code" href="../../d5/db5/encoding_8c.html#a150a6e3ac22ac3be8f8c2ccc74a28e7b">rb_enc_associate</a>(str, enc);
<a name="l02056"></a>02056         <a class="code" href="../../d5/de3/encoding_8h.html#aefe5772c0116cf7131a5227de7243dbc">ENC_CODERANGE_SET</a>(str, cr);
<a name="l02057"></a>02057         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3bf9ab455a1e0e3e8cfc6ebabd8f12df">OBJ_INFECT</a>(str, str2);
<a name="l02058"></a>02058         <span class="keywordflow">return</span> str;
<a name="l02059"></a>02059     }
<a name="l02060"></a>02060     <span class="keywordflow">return</span> <a class="code" href="../../db/d2e/intern_8h.html#abea58f4d2559060d5821ff7d3d35a496">rb_str_buf_append</a>(str, str2);
<a name="l02061"></a>02061 }
<a name="l02062"></a>02062 
<a name="l02063"></a>02063 <span class="comment">/*</span>
<a name="l02064"></a>02064 <span class="comment"> *  call-seq:</span>
<a name="l02065"></a>02065 <span class="comment"> *     str &lt;&lt; integer       -&gt; str</span>
<a name="l02066"></a>02066 <span class="comment"> *     str.concat(integer)  -&gt; str</span>
<a name="l02067"></a>02067 <span class="comment"> *     str &lt;&lt; obj           -&gt; str</span>
<a name="l02068"></a>02068 <span class="comment"> *     str.concat(obj)      -&gt; str</span>
<a name="l02069"></a>02069 <span class="comment"> *</span>
<a name="l02070"></a>02070 <span class="comment"> *  Append---Concatenates the given object to &lt;i&gt;str&lt;/i&gt;. If the object is a</span>
<a name="l02071"></a>02071 <span class="comment"> *  &lt;code&gt;Integer&lt;/code&gt;, it is considered as a codepoint, and is converted</span>
<a name="l02072"></a>02072 <span class="comment"> *  to a character before concatenation.</span>
<a name="l02073"></a>02073 <span class="comment"> *</span>
<a name="l02074"></a>02074 <span class="comment"> *     a = &quot;hello &quot;</span>
<a name="l02075"></a>02075 <span class="comment"> *     a &lt;&lt; &quot;world&quot;   #=&gt; &quot;hello world&quot;</span>
<a name="l02076"></a>02076 <span class="comment"> *     a.concat(33)   #=&gt; &quot;hello world!&quot;</span>
<a name="l02077"></a>02077 <span class="comment"> */</span>
<a name="l02078"></a>02078 
<a name="l02079"></a>02079 <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l02080"></a><a class="code" href="../../d1/db0/string_8c.html#ae4c1a24a35558e43f68de637c63b9817">02080</a> <a class="code" href="../../db/d2e/intern_8h.html#a2f12f7ad949fa2e6abb64f2311c6e2c5">rb_str_concat</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str1, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str2)
<a name="l02081"></a>02081 {
<a name="l02082"></a>02082     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> code;
<a name="l02083"></a>02083     <a class="code" href="../../d1/d7b/struct_onig_encoding_type_s_t.html">rb_encoding</a> *enc = <a class="code" href="../../d1/db0/string_8c.html#a123891f9f9b0c87d15621d93b4fa9c41">STR_ENC_GET</a>(str1);
<a name="l02084"></a>02084 
<a name="l02085"></a>02085     <span class="keywordflow">if</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#acf2fcf97dcf9c7c35452730eb3e2aeb2">FIXNUM_P</a>(str2) || <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a394faf7191f18552a20cb17ce14226f0">TYPE</a>(str2) == <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a41ac74a27dd1eadc2ca86d10590f2163">T_BIGNUM</a>) {
<a name="l02086"></a>02086         <span class="keywordflow">if</span> (<a class="code" href="../../d6/d27/numeric_8c.html#ac9a4885ac1f1d283acffad435083fffa">rb_num_to_uint</a>(str2, &amp;code) == 0) {
<a name="l02087"></a>02087         }
<a name="l02088"></a>02088         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#acf2fcf97dcf9c7c35452730eb3e2aeb2">FIXNUM_P</a>(str2)) {
<a name="l02089"></a>02089             <a class="code" href="../../db/dcc/error_8c.html#a0f771a2840561f1838169b3d7d4616f3">rb_raise</a>(<a class="code" href="../../db/dcc/error_8c.html#a5211161e80760c30e2e009ae0bee7be8">rb_eRangeError</a>, <span class="stringliteral">&quot;%ld out of char range&quot;</span>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ae9390780cd6d04a2e0ac3d6282cdefea">FIX2LONG</a>(str2));
<a name="l02090"></a>02090         }
<a name="l02091"></a>02091         <span class="keywordflow">else</span> {
<a name="l02092"></a>02092             <a class="code" href="../../db/dcc/error_8c.html#a0f771a2840561f1838169b3d7d4616f3">rb_raise</a>(<a class="code" href="../../db/dcc/error_8c.html#a5211161e80760c30e2e009ae0bee7be8">rb_eRangeError</a>, <span class="stringliteral">&quot;bignum out of char range&quot;</span>);
<a name="l02093"></a>02093         }
<a name="l02094"></a>02094     }
<a name="l02095"></a>02095     <span class="keywordflow">else</span> {
<a name="l02096"></a>02096         <span class="keywordflow">return</span> <a class="code" href="../../db/d2e/intern_8h.html#ab592dcd9e193dea76fb0ff58b5d907e4">rb_str_append</a>(str1, str2);
<a name="l02097"></a>02097     }
<a name="l02098"></a>02098 
<a name="l02099"></a>02099     <span class="keywordflow">if</span> (enc == <a class="code" href="../../d5/db5/encoding_8c.html#a1e215012f16414c044f6a212973c95a8">rb_usascii_encoding</a>()) {
<a name="l02100"></a>02100         <span class="comment">/* US-ASCII automatically extended to ASCII-8BIT */</span>
<a name="l02101"></a>02101         <span class="keywordtype">char</span> <a class="code" href="../../d6/da0/nkf-utf8_2nkf_8c.html#ac37f17a60c8b5533aac4840c681f62b8">buf</a>[1] = {(char)code};
<a name="l02102"></a>02102         <span class="keywordflow">if</span> (code &gt; 0xFF) {
<a name="l02103"></a>02103             <a class="code" href="../../db/dcc/error_8c.html#a0f771a2840561f1838169b3d7d4616f3">rb_raise</a>(<a class="code" href="../../db/dcc/error_8c.html#a5211161e80760c30e2e009ae0bee7be8">rb_eRangeError</a>, <span class="stringliteral">&quot;%u out of char range&quot;</span>, code);
<a name="l02104"></a>02104         }
<a name="l02105"></a>02105         <a class="code" href="../../db/d2e/intern_8h.html#a4e3e3ccf959b5db6c125a68e1e1db0a3">rb_str_cat</a>(str1, buf, 1);
<a name="l02106"></a>02106         <span class="keywordflow">if</span> (code &gt; 127) {
<a name="l02107"></a>02107             <a class="code" href="../../d5/db5/encoding_8c.html#a150a6e3ac22ac3be8f8c2ccc74a28e7b">rb_enc_associate</a>(str1, <a class="code" href="../../d5/db5/encoding_8c.html#a767d777810f0d48add93857b52057262">rb_ascii8bit_encoding</a>());
<a name="l02108"></a>02108             <a class="code" href="../../d5/de3/encoding_8h.html#aefe5772c0116cf7131a5227de7243dbc">ENC_CODERANGE_SET</a>(str1, <a class="code" href="../../d5/de3/encoding_8h.html#a0c81a12daaa1e57009d46b9d906957dc">ENC_CODERANGE_VALID</a>);
<a name="l02109"></a>02109         }
<a name="l02110"></a>02110     }
<a name="l02111"></a>02111     <span class="keywordflow">else</span> {
<a name="l02112"></a>02112         <span class="keywordtype">long</span> pos = <a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(str1);
<a name="l02113"></a>02113         <span class="keywordtype">int</span> cr = <a class="code" href="../../d5/de3/encoding_8h.html#a5901233f6f9004aebbdeccdd33cf449f">ENC_CODERANGE</a>(str1);
<a name="l02114"></a>02114         <span class="keywordtype">int</span> len;
<a name="l02115"></a>02115         <span class="keywordtype">char</span> *buf;
<a name="l02116"></a>02116 
<a name="l02117"></a>02117         <span class="keywordflow">switch</span> (len = <a class="code" href="../../d5/db5/encoding_8c.html#ae47c32c86d8d7d18127c9a1b2eb8c325">rb_enc_codelen</a>(code, enc)) {
<a name="l02118"></a>02118           <span class="keywordflow">case</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#af0044280fd11887fe25afa81db2f278e">ONIGERR_INVALID_CODE_POINT_VALUE</a>:
<a name="l02119"></a>02119             <a class="code" href="../../db/dcc/error_8c.html#a0f771a2840561f1838169b3d7d4616f3">rb_raise</a>(<a class="code" href="../../db/dcc/error_8c.html#a5211161e80760c30e2e009ae0bee7be8">rb_eRangeError</a>, <span class="stringliteral">&quot;invalid codepoint 0x%X in %s&quot;</span>, code, <a class="code" href="../../d5/de3/encoding_8h.html#a69d59d898802726787a168ef2e0dc92c">rb_enc_name</a>(enc));
<a name="l02120"></a>02120             <span class="keywordflow">break</span>;
<a name="l02121"></a>02121           <span class="keywordflow">case</span> <a class="code" href="../../d8/db3/oniguruma_8h.html#a880878ea3cebc76ef9b37a346188fe5f">ONIGERR_TOO_BIG_WIDE_CHAR_VALUE</a>:
<a name="l02122"></a>02122           <span class="keywordflow">case</span> 0:
<a name="l02123"></a>02123             <a class="code" href="../../db/dcc/error_8c.html#a0f771a2840561f1838169b3d7d4616f3">rb_raise</a>(<a class="code" href="../../db/dcc/error_8c.html#a5211161e80760c30e2e009ae0bee7be8">rb_eRangeError</a>, <span class="stringliteral">&quot;%u out of char range&quot;</span>, code);
<a name="l02124"></a>02124             <span class="keywordflow">break</span>;
<a name="l02125"></a>02125         }
<a name="l02126"></a>02126         buf = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a1408f4b967485afd869990b67e766ceb">ALLOCA_N</a>(<span class="keywordtype">char</span>, len + 1);
<a name="l02127"></a>02127         <a class="code" href="../../d5/de3/encoding_8h.html#a243639504d867c0a638be91db2d19db1">rb_enc_mbcput</a>(code, buf, enc);
<a name="l02128"></a>02128         <span class="keywordflow">if</span> (<a class="code" href="../../d5/db5/encoding_8c.html#a0c6003b6aeaed218d841974b00c95870">rb_enc_precise_mbclen</a>(buf, buf + len + 1, enc) != len) {
<a name="l02129"></a>02129             <a class="code" href="../../db/dcc/error_8c.html#a0f771a2840561f1838169b3d7d4616f3">rb_raise</a>(<a class="code" href="../../db/dcc/error_8c.html#a5211161e80760c30e2e009ae0bee7be8">rb_eRangeError</a>, <span class="stringliteral">&quot;invalid codepoint 0x%X in %s&quot;</span>, code, <a class="code" href="../../d5/de3/encoding_8h.html#a69d59d898802726787a168ef2e0dc92c">rb_enc_name</a>(enc));
<a name="l02130"></a>02130         }
<a name="l02131"></a>02131         <a class="code" href="../../db/d2e/intern_8h.html#a0a133856edb99f69eae3cb5a9e275ac9">rb_str_resize</a>(str1, pos+len);
<a name="l02132"></a>02132         strncpy(<a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(str1) + pos, buf, len);
<a name="l02133"></a>02133         <span class="keywordflow">if</span> (cr == <a class="code" href="../../d5/de3/encoding_8h.html#a0a0e73a2d98205044e1ad19432502c5b">ENC_CODERANGE_7BIT</a> &amp;&amp; code &gt; 127)
<a name="l02134"></a>02134             cr = <a class="code" href="../../d5/de3/encoding_8h.html#a0c81a12daaa1e57009d46b9d906957dc">ENC_CODERANGE_VALID</a>;
<a name="l02135"></a>02135         <a class="code" href="../../d5/de3/encoding_8h.html#aefe5772c0116cf7131a5227de7243dbc">ENC_CODERANGE_SET</a>(str1, cr);
<a name="l02136"></a>02136     }
<a name="l02137"></a>02137     <span class="keywordflow">return</span> str1;
<a name="l02138"></a>02138 }
<a name="l02139"></a>02139 
<a name="l02140"></a>02140 <span class="comment">/*</span>
<a name="l02141"></a>02141 <span class="comment"> *  call-seq:</span>
<a name="l02142"></a>02142 <span class="comment"> *     str.prepend(other_str)  -&gt; str</span>
<a name="l02143"></a>02143 <span class="comment"> *</span>
<a name="l02144"></a>02144 <span class="comment"> *  Prepend---Prepend the given string to &lt;i&gt;str&lt;/i&gt;.</span>
<a name="l02145"></a>02145 <span class="comment"> *</span>
<a name="l02146"></a>02146 <span class="comment"> *  a = &quot;world&quot;</span>
<a name="l02147"></a>02147 <span class="comment"> *  a.prepend(&quot;hello &quot;) #=&gt; &quot;hello world&quot;</span>
<a name="l02148"></a>02148 <span class="comment"> *  a                   #=&gt; &quot;hello world&quot;</span>
<a name="l02149"></a>02149 <span class="comment"> */</span>
<a name="l02150"></a>02150 
<a name="l02151"></a>02151 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l02152"></a><a class="code" href="../../d1/db0/string_8c.html#af58f66d19dd7dd3179b30e47a7a71743">02152</a> <a class="code" href="../../d1/db0/string_8c.html#af58f66d19dd7dd3179b30e47a7a71743">rb_str_prepend</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str2)
<a name="l02153"></a>02153 {
<a name="l02154"></a>02154     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a0e80f207eb41e9010ec9f0f5f9419fea">StringValue</a>(str2);
<a name="l02155"></a>02155     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a0e80f207eb41e9010ec9f0f5f9419fea">StringValue</a>(str);
<a name="l02156"></a>02156     <a class="code" href="../../db/d2e/intern_8h.html#a402efc00ae2755beeebb58208b9d1670">rb_str_update</a>(str, 0L, 0L, str2);
<a name="l02157"></a>02157     <span class="keywordflow">return</span> str;
<a name="l02158"></a>02158 }
<a name="l02159"></a>02159 
<a name="l02160"></a>02160 <a class="code" href="../../dd/d24/st_8h.html#ac214e5cdcf0de6a2108b9643e7fc12e0">st_index_t</a>
<a name="l02161"></a><a class="code" href="../../d1/db0/string_8c.html#a60762255dca0f7b49429538887e369eb">02161</a> <a class="code" href="../../db/d2e/intern_8h.html#ae3a4b38656e45011a94975206acf7650">rb_str_hash</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str)
<a name="l02162"></a>02162 {
<a name="l02163"></a>02163     <span class="keywordtype">int</span> e = <a class="code" href="../../d5/de3/encoding_8h.html#a6ba07266a084d7a480377f1472aabfd8">ENCODING_GET</a>(str);
<a name="l02164"></a>02164     <span class="keywordflow">if</span> (e &amp;&amp; <a class="code" href="../../d5/de3/encoding_8h.html#a5282c41e11a68fe310f45c9a326ae2b8">rb_enc_str_coderange</a>(str) == <a class="code" href="../../d5/de3/encoding_8h.html#a0a0e73a2d98205044e1ad19432502c5b">ENC_CODERANGE_7BIT</a>) {
<a name="l02165"></a>02165         e = 0;
<a name="l02166"></a>02166     }
<a name="l02167"></a>02167     <span class="keywordflow">return</span> <a class="code" href="../../db/d2e/intern_8h.html#a467461650cee651125cdac471160b9cd">rb_memhash</a>((<span class="keyword">const</span> <span class="keywordtype">void</span> *)<a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(str), <a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(str)) ^ e;
<a name="l02168"></a>02168 }
<a name="l02169"></a>02169 
<a name="l02170"></a>02170 <span class="keywordtype">int</span>
<a name="l02171"></a><a class="code" href="../../d1/db0/string_8c.html#a3c55ecad0c049c42a78db81eb1379cf2">02171</a> <a class="code" href="../../db/d2e/intern_8h.html#abff17b0baeb7275f49e3bd417aec866f">rb_str_hash_cmp</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str1, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str2)
<a name="l02172"></a>02172 {
<a name="l02173"></a>02173     <span class="keywordtype">long</span> len;
<a name="l02174"></a>02174 
<a name="l02175"></a>02175     <span class="keywordflow">if</span> (!<a class="code" href="../../db/d2e/intern_8h.html#a94accf951e989a1167bbb58d18785a8b">rb_str_comparable</a>(str1, str2)) <span class="keywordflow">return</span> 1;
<a name="l02176"></a>02176     <span class="keywordflow">if</span> (<a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(str1) == (len = <a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(str2)) &amp;&amp;
<a name="l02177"></a>02177         <a class="code" href="../../d5/d21/memcmp_8c.html#a1499ab2d0a3da86cbc3e688294f60a48">memcmp</a>(<a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(str1), <a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(str2), len) == 0) {
<a name="l02178"></a>02178         <span class="keywordflow">return</span> 0;
<a name="l02179"></a>02179     }
<a name="l02180"></a>02180     <span class="keywordflow">return</span> 1;
<a name="l02181"></a>02181 }
<a name="l02182"></a>02182 
<a name="l02183"></a>02183 <span class="comment">/*</span>
<a name="l02184"></a>02184 <span class="comment"> * call-seq:</span>
<a name="l02185"></a>02185 <span class="comment"> *    str.hash   -&gt; fixnum</span>
<a name="l02186"></a>02186 <span class="comment"> *</span>
<a name="l02187"></a>02187 <span class="comment"> * Return a hash based on the string&apos;s length and content.</span>
<a name="l02188"></a>02188 <span class="comment"> */</span>
<a name="l02189"></a>02189 
<a name="l02190"></a>02190 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l02191"></a><a class="code" href="../../d1/db0/string_8c.html#a6c69766306e90d2f603892a0c282dd8a">02191</a> <a class="code" href="../../d1/db0/string_8c.html#a6c69766306e90d2f603892a0c282dd8a">rb_str_hash_m</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str)
<a name="l02192"></a>02192 {
<a name="l02193"></a>02193     <a class="code" href="../../dd/d24/st_8h.html#ac214e5cdcf0de6a2108b9643e7fc12e0">st_index_t</a> hval = <a class="code" href="../../db/d2e/intern_8h.html#ae3a4b38656e45011a94975206acf7650">rb_str_hash</a>(str);
<a name="l02194"></a>02194     <span class="keywordflow">return</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(hval);
<a name="l02195"></a>02195 }
<a name="l02196"></a>02196 
<a name="l02197"></a><a class="code" href="../../d1/db0/string_8c.html#a2eff88cb17b92399616452212c914615">02197</a> <span class="preprocessor">#define lesser(a,b) (((a)&gt;(b))?(b):(a))</span>
<a name="l02198"></a>02198 <span class="preprocessor"></span>
<a name="l02199"></a>02199 <span class="keywordtype">int</span>
<a name="l02200"></a><a class="code" href="../../d1/db0/string_8c.html#aa8cf6f0a0c555a7394a8fd928317ced0">02200</a> <a class="code" href="../../db/d2e/intern_8h.html#a94accf951e989a1167bbb58d18785a8b">rb_str_comparable</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str1, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str2)
<a name="l02201"></a>02201 {
<a name="l02202"></a>02202     <span class="keywordtype">int</span> idx1, idx2;
<a name="l02203"></a>02203     <span class="keywordtype">int</span> rc1, rc2;
<a name="l02204"></a>02204 
<a name="l02205"></a>02205     <span class="keywordflow">if</span> (<a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(str1) == 0) <span class="keywordflow">return</span> <a class="code" href="../../d1/d5c/nkf_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l02206"></a>02206     <span class="keywordflow">if</span> (<a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(str2) == 0) <span class="keywordflow">return</span> <a class="code" href="../../d1/d5c/nkf_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l02207"></a>02207     idx1 = <a class="code" href="../../d5/de3/encoding_8h.html#a6ba07266a084d7a480377f1472aabfd8">ENCODING_GET</a>(str1);
<a name="l02208"></a>02208     idx2 = <a class="code" href="../../d5/de3/encoding_8h.html#a6ba07266a084d7a480377f1472aabfd8">ENCODING_GET</a>(str2);
<a name="l02209"></a>02209     <span class="keywordflow">if</span> (idx1 == idx2) <span class="keywordflow">return</span> <a class="code" href="../../d1/d5c/nkf_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l02210"></a>02210     rc1 = <a class="code" href="../../d5/de3/encoding_8h.html#a5282c41e11a68fe310f45c9a326ae2b8">rb_enc_str_coderange</a>(str1);
<a name="l02211"></a>02211     rc2 = <a class="code" href="../../d5/de3/encoding_8h.html#a5282c41e11a68fe310f45c9a326ae2b8">rb_enc_str_coderange</a>(str2);
<a name="l02212"></a>02212     <span class="keywordflow">if</span> (rc1 == <a class="code" href="../../d5/de3/encoding_8h.html#a0a0e73a2d98205044e1ad19432502c5b">ENC_CODERANGE_7BIT</a>) {
<a name="l02213"></a>02213         <span class="keywordflow">if</span> (rc2 == <a class="code" href="../../d5/de3/encoding_8h.html#a0a0e73a2d98205044e1ad19432502c5b">ENC_CODERANGE_7BIT</a>) <span class="keywordflow">return</span> <a class="code" href="../../d1/d5c/nkf_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l02214"></a>02214         <span class="keywordflow">if</span> (<a class="code" href="../../d5/de3/encoding_8h.html#a8b18a09a3055d3006c6d5baeaa6e7c72">rb_enc_asciicompat</a>(<a class="code" href="../../d5/db5/encoding_8c.html#aef9c377b2d9d78b9f88e890b77593109">rb_enc_from_index</a>(idx2)))
<a name="l02215"></a>02215             <span class="keywordflow">return</span> <a class="code" href="../../d1/d5c/nkf_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l02216"></a>02216     }
<a name="l02217"></a>02217     <span class="keywordflow">if</span> (rc2 == <a class="code" href="../../d5/de3/encoding_8h.html#a0a0e73a2d98205044e1ad19432502c5b">ENC_CODERANGE_7BIT</a>) {
<a name="l02218"></a>02218         <span class="keywordflow">if</span> (<a class="code" href="../../d5/de3/encoding_8h.html#a8b18a09a3055d3006c6d5baeaa6e7c72">rb_enc_asciicompat</a>(<a class="code" href="../../d5/db5/encoding_8c.html#aef9c377b2d9d78b9f88e890b77593109">rb_enc_from_index</a>(idx1)))
<a name="l02219"></a>02219             <span class="keywordflow">return</span> <a class="code" href="../../d1/d5c/nkf_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l02220"></a>02220     }
<a name="l02221"></a>02221     <span class="keywordflow">return</span> <a class="code" href="../../d1/d5c/nkf_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l02222"></a>02222 }
<a name="l02223"></a>02223 
<a name="l02224"></a>02224 <span class="keywordtype">int</span>
<a name="l02225"></a><a class="code" href="../../d1/db0/string_8c.html#ac84ec3adde6b1ae2eae8b5d0f18a83b3">02225</a> <a class="code" href="../../db/d2e/intern_8h.html#aabbf48d0162ce9a462b13b71ccf683a5">rb_str_cmp</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str1, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str2)
<a name="l02226"></a>02226 {
<a name="l02227"></a>02227     <span class="keywordtype">long</span> len1, len2;
<a name="l02228"></a>02228     <span class="keyword">const</span> <span class="keywordtype">char</span> *ptr1, *ptr2;
<a name="l02229"></a>02229     <span class="keywordtype">int</span> retval;
<a name="l02230"></a>02230 
<a name="l02231"></a>02231     <span class="keywordflow">if</span> (str1 == str2) <span class="keywordflow">return</span> 0;
<a name="l02232"></a>02232     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a72f81d81c0e378aee5074266e5ee23d5">RSTRING_GETMEM</a>(str1, ptr1, len1);
<a name="l02233"></a>02233     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a72f81d81c0e378aee5074266e5ee23d5">RSTRING_GETMEM</a>(str2, ptr2, len2);
<a name="l02234"></a>02234     <span class="keywordflow">if</span> (ptr1 == ptr2 || (retval = <a class="code" href="../../d5/d21/memcmp_8c.html#a1499ab2d0a3da86cbc3e688294f60a48">memcmp</a>(ptr1, ptr2, <a class="code" href="../../d1/db0/string_8c.html#a2eff88cb17b92399616452212c914615">lesser</a>(len1, len2))) == 0) {
<a name="l02235"></a>02235         <span class="keywordflow">if</span> (len1 == len2) {
<a name="l02236"></a>02236             <span class="keywordflow">if</span> (!<a class="code" href="../../db/d2e/intern_8h.html#a94accf951e989a1167bbb58d18785a8b">rb_str_comparable</a>(str1, str2)) {
<a name="l02237"></a>02237                 <span class="keywordflow">if</span> (<a class="code" href="../../d5/de3/encoding_8h.html#a6ba07266a084d7a480377f1472aabfd8">ENCODING_GET</a>(str1) &gt; <a class="code" href="../../d5/de3/encoding_8h.html#a6ba07266a084d7a480377f1472aabfd8">ENCODING_GET</a>(str2))
<a name="l02238"></a>02238                     <span class="keywordflow">return</span> 1;
<a name="l02239"></a>02239                 <span class="keywordflow">return</span> -1;
<a name="l02240"></a>02240             }
<a name="l02241"></a>02241             <span class="keywordflow">return</span> 0;
<a name="l02242"></a>02242         }
<a name="l02243"></a>02243         <span class="keywordflow">if</span> (len1 &gt; len2) <span class="keywordflow">return</span> 1;
<a name="l02244"></a>02244         <span class="keywordflow">return</span> -1;
<a name="l02245"></a>02245     }
<a name="l02246"></a>02246     <span class="keywordflow">if</span> (retval &gt; 0) <span class="keywordflow">return</span> 1;
<a name="l02247"></a>02247     <span class="keywordflow">return</span> -1;
<a name="l02248"></a>02248 }
<a name="l02249"></a>02249 
<a name="l02250"></a>02250 <span class="comment">/* expect tail call optimization */</span>
<a name="l02251"></a>02251 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l02252"></a><a class="code" href="../../d1/db0/string_8c.html#a5527a0b3b2f13c7ba2ae5ef6b8288b29">02252</a> <a class="code" href="../../d1/db0/string_8c.html#a5527a0b3b2f13c7ba2ae5ef6b8288b29">str_eql</a>(<span class="keyword">const</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str1, <span class="keyword">const</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str2)
<a name="l02253"></a>02253 {
<a name="l02254"></a>02254     <span class="keyword">const</span> <span class="keywordtype">long</span> len = <a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(str1);
<a name="l02255"></a>02255     <span class="keyword">const</span> <span class="keywordtype">char</span> *ptr1, *ptr2;
<a name="l02256"></a>02256 
<a name="l02257"></a>02257     <span class="keywordflow">if</span> (len != <a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(str2)) <span class="keywordflow">return</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aba0717d2689eb68797421a02ab9295c6">Qfalse</a>;
<a name="l02258"></a>02258     <span class="keywordflow">if</span> (!<a class="code" href="../../db/d2e/intern_8h.html#a94accf951e989a1167bbb58d18785a8b">rb_str_comparable</a>(str1, str2)) <span class="keywordflow">return</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aba0717d2689eb68797421a02ab9295c6">Qfalse</a>;
<a name="l02259"></a>02259     <span class="keywordflow">if</span> ((ptr1 = <a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(str1)) == (ptr2 = <a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(str2)))
<a name="l02260"></a>02260         <span class="keywordflow">return</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aacea3516b33941ce8149098e223a7466">Qtrue</a>;
<a name="l02261"></a>02261     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d21/memcmp_8c.html#a1499ab2d0a3da86cbc3e688294f60a48">memcmp</a>(ptr1, ptr2, len) == 0)
<a name="l02262"></a>02262         <span class="keywordflow">return</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aacea3516b33941ce8149098e223a7466">Qtrue</a>;
<a name="l02263"></a>02263     <span class="keywordflow">return</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aba0717d2689eb68797421a02ab9295c6">Qfalse</a>;
<a name="l02264"></a>02264 }
<a name="l02265"></a>02265 <span class="comment">/*</span>
<a name="l02266"></a>02266 <span class="comment"> *  call-seq:</span>
<a name="l02267"></a>02267 <span class="comment"> *     str == obj   -&gt; true or false</span>
<a name="l02268"></a>02268 <span class="comment"> *</span>
<a name="l02269"></a>02269 <span class="comment"> *  Equality---If &lt;i&gt;obj&lt;/i&gt; is not a &lt;code&gt;String&lt;/code&gt;, returns</span>
<a name="l02270"></a>02270 <span class="comment"> *  &lt;code&gt;false&lt;/code&gt;. Otherwise, returns &lt;code&gt;true&lt;/code&gt; if &lt;i&gt;str&lt;/i&gt;</span>
<a name="l02271"></a>02271 <span class="comment"> *  &lt;code&gt;&lt;=&gt;&lt;/code&gt; &lt;i&gt;obj&lt;/i&gt; returns zero.</span>
<a name="l02272"></a>02272 <span class="comment"> */</span>
<a name="l02273"></a>02273 
<a name="l02274"></a>02274 <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l02275"></a><a class="code" href="../../d1/db0/string_8c.html#a879d55791d2df05df7f63943ae7ff276">02275</a> <a class="code" href="../../db/d2e/intern_8h.html#a879d55791d2df05df7f63943ae7ff276">rb_str_equal</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str1, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str2)
<a name="l02276"></a>02276 {
<a name="l02277"></a>02277     <span class="keywordflow">if</span> (str1 == str2) <span class="keywordflow">return</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aacea3516b33941ce8149098e223a7466">Qtrue</a>;
<a name="l02278"></a>02278     <span class="keywordflow">if</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a394faf7191f18552a20cb17ce14226f0">TYPE</a>(str2) != <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a22a8c2a4bbaae9b68f65c9bb92fd4e39">T_STRING</a>) {
<a name="l02279"></a>02279         <span class="keywordflow">if</span> (!<a class="code" href="../../db/d2e/intern_8h.html#a5c6c63c2619b8c03df2e173ef1e73846">rb_respond_to</a>(str2, <a class="code" href="../../dc/dcc/array_8c.html#a9cfa42d4b79c89d68c53be8b2150a503">rb_intern</a>(<span class="stringliteral">&quot;to_str&quot;</span>))) {
<a name="l02280"></a>02280             <span class="keywordflow">return</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aba0717d2689eb68797421a02ab9295c6">Qfalse</a>;
<a name="l02281"></a>02281         }
<a name="l02282"></a>02282         <span class="keywordflow">return</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ae0d75edc88a608fc05dd386edf53208f">rb_equal</a>(str2, str1);
<a name="l02283"></a>02283     }
<a name="l02284"></a>02284     <span class="keywordflow">return</span> <a class="code" href="../../d1/db0/string_8c.html#a5527a0b3b2f13c7ba2ae5ef6b8288b29">str_eql</a>(str1, str2);
<a name="l02285"></a>02285 }
<a name="l02286"></a>02286 
<a name="l02287"></a>02287 <span class="comment">/*</span>
<a name="l02288"></a>02288 <span class="comment"> * call-seq:</span>
<a name="l02289"></a>02289 <span class="comment"> *   str.eql?(other)   -&gt; true or false</span>
<a name="l02290"></a>02290 <span class="comment"> *</span>
<a name="l02291"></a>02291 <span class="comment"> * Two strings are equal if they have the same length and content.</span>
<a name="l02292"></a>02292 <span class="comment"> */</span>
<a name="l02293"></a>02293 
<a name="l02294"></a>02294 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l02295"></a><a class="code" href="../../d1/db0/string_8c.html#a5ba5cf8c1d2606520ab15a3a733db4f5">02295</a> <a class="code" href="../../d1/db0/string_8c.html#a5ba5cf8c1d2606520ab15a3a733db4f5">rb_str_eql</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str1, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str2)
<a name="l02296"></a>02296 {
<a name="l02297"></a>02297     <span class="keywordflow">if</span> (str1 == str2) <span class="keywordflow">return</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aacea3516b33941ce8149098e223a7466">Qtrue</a>;
<a name="l02298"></a>02298     <span class="keywordflow">if</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a394faf7191f18552a20cb17ce14226f0">TYPE</a>(str2) != <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a22a8c2a4bbaae9b68f65c9bb92fd4e39">T_STRING</a>) <span class="keywordflow">return</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aba0717d2689eb68797421a02ab9295c6">Qfalse</a>;
<a name="l02299"></a>02299     <span class="keywordflow">return</span> <a class="code" href="../../d1/db0/string_8c.html#a5527a0b3b2f13c7ba2ae5ef6b8288b29">str_eql</a>(str1, str2);
<a name="l02300"></a>02300 }
<a name="l02301"></a>02301 
<a name="l02302"></a>02302 <span class="comment">/*</span>
<a name="l02303"></a>02303 <span class="comment"> *  call-seq:</span>
<a name="l02304"></a>02304 <span class="comment"> *     str &lt;=&gt; other_str   -&gt; -1, 0, +1 or nil</span>
<a name="l02305"></a>02305 <span class="comment"> *</span>
<a name="l02306"></a>02306 <span class="comment"> *  Comparison---Returns -1 if &lt;i&gt;other_str&lt;/i&gt; is greater than, 0 if</span>
<a name="l02307"></a>02307 <span class="comment"> *  &lt;i&gt;other_str&lt;/i&gt; is equal to, and +1 if &lt;i&gt;other_str&lt;/i&gt; is less than</span>
<a name="l02308"></a>02308 <span class="comment"> *  &lt;i&gt;str&lt;/i&gt;. If the strings are of different lengths, and the strings are</span>
<a name="l02309"></a>02309 <span class="comment"> *  equal when compared up to the shortest length, then the longer string is</span>
<a name="l02310"></a>02310 <span class="comment"> *  considered greater than the shorter one. In older versions of Ruby, setting</span>
<a name="l02311"></a>02311 <span class="comment"> *  &lt;code&gt;$=&lt;/code&gt; allowed case-insensitive comparisons; this is now deprecated</span>
<a name="l02312"></a>02312 <span class="comment"> *  in favor of using &lt;code&gt;String#casecmp&lt;/code&gt;.</span>
<a name="l02313"></a>02313 <span class="comment"> *</span>
<a name="l02314"></a>02314 <span class="comment"> *  &lt;code&gt;&lt;=&gt;&lt;/code&gt; is the basis for the methods &lt;code&gt;&lt;&lt;/code&gt;,</span>
<a name="l02315"></a>02315 <span class="comment"> *  &lt;code&gt;&lt;=&lt;/code&gt;, &lt;code&gt;&gt;&lt;/code&gt;, &lt;code&gt;&gt;=&lt;/code&gt;, and &lt;code&gt;between?&lt;/code&gt;,</span>
<a name="l02316"></a>02316 <span class="comment"> *  included from module &lt;code&gt;Comparable&lt;/code&gt;.  The method</span>
<a name="l02317"></a>02317 <span class="comment"> *  &lt;code&gt;String#==&lt;/code&gt; does not use &lt;code&gt;Comparable#==&lt;/code&gt;.</span>
<a name="l02318"></a>02318 <span class="comment"> *</span>
<a name="l02319"></a>02319 <span class="comment"> *     &quot;abcdef&quot; &lt;=&gt; &quot;abcde&quot;     #=&gt; 1</span>
<a name="l02320"></a>02320 <span class="comment"> *     &quot;abcdef&quot; &lt;=&gt; &quot;abcdef&quot;    #=&gt; 0</span>
<a name="l02321"></a>02321 <span class="comment"> *     &quot;abcdef&quot; &lt;=&gt; &quot;abcdefg&quot;   #=&gt; -1</span>
<a name="l02322"></a>02322 <span class="comment"> *     &quot;abcdef&quot; &lt;=&gt; &quot;ABCDEF&quot;    #=&gt; 1</span>
<a name="l02323"></a>02323 <span class="comment"> */</span>
<a name="l02324"></a>02324 
<a name="l02325"></a>02325 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l02326"></a><a class="code" href="../../d1/db0/string_8c.html#acd850d5463cfc6fe6381214f156b7e4d">02326</a> <a class="code" href="../../d1/db0/string_8c.html#acd850d5463cfc6fe6381214f156b7e4d">rb_str_cmp_m</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str1, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str2)
<a name="l02327"></a>02327 {
<a name="l02328"></a>02328     <span class="keywordtype">long</span> <a class="code" href="../../d8/d90/nkf_8c.html#a5ea5ac7abf5cce39283e422add1067d5">result</a>;
<a name="l02329"></a>02329 
<a name="l02330"></a>02330     <span class="keywordflow">if</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a394faf7191f18552a20cb17ce14226f0">TYPE</a>(str2) != <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a22a8c2a4bbaae9b68f65c9bb92fd4e39">T_STRING</a>) {
<a name="l02331"></a>02331         <span class="keywordflow">if</span> (!<a class="code" href="../../db/d2e/intern_8h.html#a5c6c63c2619b8c03df2e173ef1e73846">rb_respond_to</a>(str2, <a class="code" href="../../dc/dcc/array_8c.html#a9cfa42d4b79c89d68c53be8b2150a503">rb_intern</a>(<span class="stringliteral">&quot;to_str&quot;</span>))) {
<a name="l02332"></a>02332             <span class="keywordflow">return</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a320970f989dc8294c8203154e3db40c1">Qnil</a>;
<a name="l02333"></a>02333         }
<a name="l02334"></a>02334         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!<a class="code" href="../../db/d2e/intern_8h.html#a5c6c63c2619b8c03df2e173ef1e73846">rb_respond_to</a>(str2, <a class="code" href="../../dc/dcc/array_8c.html#a9cfa42d4b79c89d68c53be8b2150a503">rb_intern</a>(<span class="stringliteral">&quot;&lt;=&gt;&quot;</span>))) {
<a name="l02335"></a>02335             <span class="keywordflow">return</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a320970f989dc8294c8203154e3db40c1">Qnil</a>;
<a name="l02336"></a>02336         }
<a name="l02337"></a>02337         <span class="keywordflow">else</span> {
<a name="l02338"></a>02338             <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> tmp = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a6a973fe624aa9aa9ba0cdeb6792d3187" title="Calls a method.">rb_funcall</a>(str2, <a class="code" href="../../dc/dcc/array_8c.html#a9cfa42d4b79c89d68c53be8b2150a503">rb_intern</a>(<span class="stringliteral">&quot;&lt;=&gt;&quot;</span>), 1, str1);
<a name="l02339"></a>02339 
<a name="l02340"></a>02340             <span class="keywordflow">if</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a4832bad8845a35fc50f7a160901854a1">NIL_P</a>(tmp)) <span class="keywordflow">return</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a320970f989dc8294c8203154e3db40c1">Qnil</a>;
<a name="l02341"></a>02341             <span class="keywordflow">if</span> (!<a class="code" href="../../de/de6/ruby_2ruby_8h.html#acf2fcf97dcf9c7c35452730eb3e2aeb2">FIXNUM_P</a>(tmp)) {
<a name="l02342"></a>02342                 <span class="keywordflow">return</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a6a973fe624aa9aa9ba0cdeb6792d3187" title="Calls a method.">rb_funcall</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a2ead2f64c81efed352e79e89f29b8fc8">LONG2FIX</a>(0), <span class="charliteral">&apos;-&apos;</span>, 1, tmp);
<a name="l02343"></a>02343             }
<a name="l02344"></a>02344             result = -<a class="code" href="../../de/de6/ruby_2ruby_8h.html#ae9390780cd6d04a2e0ac3d6282cdefea">FIX2LONG</a>(tmp);
<a name="l02345"></a>02345         }
<a name="l02346"></a>02346     }
<a name="l02347"></a>02347     <span class="keywordflow">else</span> {
<a name="l02348"></a>02348         result = <a class="code" href="../../db/d2e/intern_8h.html#aabbf48d0162ce9a462b13b71ccf683a5">rb_str_cmp</a>(str1, str2);
<a name="l02349"></a>02349     }
<a name="l02350"></a>02350     <span class="keywordflow">return</span> <a class="code" href="../../dc/d0c/cparse_8c.html#af1afba1194a12547a1e65d92abf03b03">LONG2NUM</a>(result);
<a name="l02351"></a>02351 }
<a name="l02352"></a>02352 
<a name="l02353"></a>02353 <span class="comment">/*</span>
<a name="l02354"></a>02354 <span class="comment"> *  call-seq:</span>
<a name="l02355"></a>02355 <span class="comment"> *     str.casecmp(other_str)   -&gt; -1, 0, +1 or nil</span>
<a name="l02356"></a>02356 <span class="comment"> *</span>
<a name="l02357"></a>02357 <span class="comment"> *  Case-insensitive version of &lt;code&gt;String#&lt;=&gt;&lt;/code&gt;.</span>
<a name="l02358"></a>02358 <span class="comment"> *</span>
<a name="l02359"></a>02359 <span class="comment"> *     &quot;abcdef&quot;.casecmp(&quot;abcde&quot;)     #=&gt; 1</span>
<a name="l02360"></a>02360 <span class="comment"> *     &quot;aBcDeF&quot;.casecmp(&quot;abcdef&quot;)    #=&gt; 0</span>
<a name="l02361"></a>02361 <span class="comment"> *     &quot;abcdef&quot;.casecmp(&quot;abcdefg&quot;)   #=&gt; -1</span>
<a name="l02362"></a>02362 <span class="comment"> *     &quot;abcdef&quot;.casecmp(&quot;ABCDEF&quot;)    #=&gt; 0</span>
<a name="l02363"></a>02363 <span class="comment"> */</span>
<a name="l02364"></a>02364 
<a name="l02365"></a>02365 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l02366"></a><a class="code" href="../../d1/db0/string_8c.html#ada0bd9e6e4de059fed412adf1649fc09">02366</a> <a class="code" href="../../d1/db0/string_8c.html#ada0bd9e6e4de059fed412adf1649fc09">rb_str_casecmp</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str1, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str2)
<a name="l02367"></a>02367 {
<a name="l02368"></a>02368     <span class="keywordtype">long</span> len;
<a name="l02369"></a>02369     <a class="code" href="../../d1/d7b/struct_onig_encoding_type_s_t.html">rb_encoding</a> *enc;
<a name="l02370"></a>02370     <span class="keywordtype">char</span> *p1, *p1end, *p2, *p2end;
<a name="l02371"></a>02371 
<a name="l02372"></a>02372     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a0e80f207eb41e9010ec9f0f5f9419fea">StringValue</a>(str2);
<a name="l02373"></a>02373     enc = <a class="code" href="../../d5/db5/encoding_8c.html#a533ed45f02a3f72987b0f6f5ce04c996">rb_enc_compatible</a>(str1, str2);
<a name="l02374"></a>02374     <span class="keywordflow">if</span> (!enc) {
<a name="l02375"></a>02375         <span class="keywordflow">return</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a320970f989dc8294c8203154e3db40c1">Qnil</a>;
<a name="l02376"></a>02376     }
<a name="l02377"></a>02377 
<a name="l02378"></a>02378     p1 = <a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(str1); p1end = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a35bfa2635774977edad0a16b9fdebbaf">RSTRING_END</a>(str1);
<a name="l02379"></a>02379     p2 = <a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(str2); p2end = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a35bfa2635774977edad0a16b9fdebbaf">RSTRING_END</a>(str2);
<a name="l02380"></a>02380     <span class="keywordflow">if</span> (<a class="code" href="../../d1/db0/string_8c.html#a5ab3c8112c2ec6943bdae8a2036fca02">single_byte_optimizable</a>(str1) &amp;&amp; <a class="code" href="../../d1/db0/string_8c.html#a5ab3c8112c2ec6943bdae8a2036fca02">single_byte_optimizable</a>(str2)) {
<a name="l02381"></a>02381         <span class="keywordflow">while</span> (p1 &lt; p1end &amp;&amp; p2 &lt; p2end) {
<a name="l02382"></a>02382             <span class="keywordflow">if</span> (*p1 != *p2) {
<a name="l02383"></a>02383                 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> c1 = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ab54417c7c018570043920af66ba7457f">TOUPPER</a>(*p1 &amp; 0xff);
<a name="l02384"></a>02384                 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> c2 = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ab54417c7c018570043920af66ba7457f">TOUPPER</a>(*p2 &amp; 0xff);
<a name="l02385"></a>02385                 <span class="keywordflow">if</span> (c1 != c2)
<a name="l02386"></a>02386                     <span class="keywordflow">return</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(c1 &lt; c2 ? -1 : 1);
<a name="l02387"></a>02387             }
<a name="l02388"></a>02388             p1++;
<a name="l02389"></a>02389             p2++;
<a name="l02390"></a>02390         }
<a name="l02391"></a>02391     }
<a name="l02392"></a>02392     <span class="keywordflow">else</span> {
<a name="l02393"></a>02393         <span class="keywordflow">while</span> (p1 &lt; p1end &amp;&amp; p2 &lt; p2end) {
<a name="l02394"></a>02394             <span class="keywordtype">int</span> l1, c1 = <a class="code" href="../../d5/db5/encoding_8c.html#af6663b51ce857cfe600a8bc48434d6f2">rb_enc_ascget</a>(p1, p1end, &amp;l1, enc);
<a name="l02395"></a>02395             <span class="keywordtype">int</span> l2, c2 = <a class="code" href="../../d5/db5/encoding_8c.html#af6663b51ce857cfe600a8bc48434d6f2">rb_enc_ascget</a>(p2, p2end, &amp;l2, enc);
<a name="l02396"></a>02396 
<a name="l02397"></a>02397             <span class="keywordflow">if</span> (0 &lt;= c1 &amp;&amp; 0 &lt;= c2) {
<a name="l02398"></a>02398                 c1 = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ab54417c7c018570043920af66ba7457f">TOUPPER</a>(c1);
<a name="l02399"></a>02399                 c2 = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ab54417c7c018570043920af66ba7457f">TOUPPER</a>(c2);
<a name="l02400"></a>02400                 <span class="keywordflow">if</span> (c1 != c2)
<a name="l02401"></a>02401                     <span class="keywordflow">return</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(c1 &lt; c2 ? -1 : 1);
<a name="l02402"></a>02402             }
<a name="l02403"></a>02403             <span class="keywordflow">else</span> {
<a name="l02404"></a>02404                 <span class="keywordtype">int</span> r;
<a name="l02405"></a>02405                 l1 = <a class="code" href="../../d5/db5/encoding_8c.html#aa91c0fa3dfdfe3c55fcaa6029c35bbb8">rb_enc_mbclen</a>(p1, p1end, enc);
<a name="l02406"></a>02406                 l2 = <a class="code" href="../../d5/db5/encoding_8c.html#aa91c0fa3dfdfe3c55fcaa6029c35bbb8">rb_enc_mbclen</a>(p2, p2end, enc);
<a name="l02407"></a>02407                 len = l1 &lt; l2 ? l1 : l2;
<a name="l02408"></a>02408                 r = <a class="code" href="../../d5/d21/memcmp_8c.html#a1499ab2d0a3da86cbc3e688294f60a48">memcmp</a>(p1, p2, len);
<a name="l02409"></a>02409                 <span class="keywordflow">if</span> (r != 0)
<a name="l02410"></a>02410                     <span class="keywordflow">return</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(r &lt; 0 ? -1 : 1);
<a name="l02411"></a>02411                 <span class="keywordflow">if</span> (l1 != l2)
<a name="l02412"></a>02412                     <span class="keywordflow">return</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(l1 &lt; l2 ? -1 : 1);
<a name="l02413"></a>02413             }
<a name="l02414"></a>02414             p1 += l1;
<a name="l02415"></a>02415             p2 += l2;
<a name="l02416"></a>02416         }
<a name="l02417"></a>02417     }
<a name="l02418"></a>02418     <span class="keywordflow">if</span> (<a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(str1) == <a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(str2)) <span class="keywordflow">return</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(0);
<a name="l02419"></a>02419     <span class="keywordflow">if</span> (<a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(str1) &gt; <a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(str2)) <span class="keywordflow">return</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(1);
<a name="l02420"></a>02420     <span class="keywordflow">return</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(-1);
<a name="l02421"></a>02421 }
<a name="l02422"></a>02422 
<a name="l02423"></a>02423 <span class="keyword">static</span> <span class="keywordtype">long</span>
<a name="l02424"></a><a class="code" href="../../d1/db0/string_8c.html#a44f92eec2a74155cc1bb3445e7cacaf1">02424</a> <a class="code" href="../../d1/db0/string_8c.html#a44f92eec2a74155cc1bb3445e7cacaf1">rb_str_index</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <a class="code" href="../../d1/d6f/date__strftime_8c.html#a0d7154c0cddedcee49293c3e1f47d643">sub</a>, <span class="keywordtype">long</span> offset)
<a name="l02425"></a>02425 {
<a name="l02426"></a>02426     <span class="keywordtype">long</span> pos;
<a name="l02427"></a>02427     <span class="keywordtype">char</span> *s, *sptr, *e;
<a name="l02428"></a>02428     <span class="keywordtype">long</span> len, slen;
<a name="l02429"></a>02429     <a class="code" href="../../d1/d7b/struct_onig_encoding_type_s_t.html">rb_encoding</a> *enc;
<a name="l02430"></a>02430 
<a name="l02431"></a>02431     enc = <a class="code" href="../../d5/db5/encoding_8c.html#a7d17d602fae27de649f9310511c03db0">rb_enc_check</a>(str, sub);
<a name="l02432"></a>02432     <span class="keywordflow">if</span> (<a class="code" href="../../d1/db0/string_8c.html#a8de8d2f6479866e76eeb56f5044fa583">is_broken_string</a>(sub)) {
<a name="l02433"></a>02433         <span class="keywordflow">return</span> -1;
<a name="l02434"></a>02434     }
<a name="l02435"></a>02435     len = <a class="code" href="../../d1/db0/string_8c.html#abe68504f1d38108a10f267f4358c53db">str_strlen</a>(str, enc);
<a name="l02436"></a>02436     slen = <a class="code" href="../../d1/db0/string_8c.html#abe68504f1d38108a10f267f4358c53db">str_strlen</a>(sub, enc);
<a name="l02437"></a>02437     <span class="keywordflow">if</span> (offset &lt; 0) {
<a name="l02438"></a>02438         offset += len;
<a name="l02439"></a>02439         <span class="keywordflow">if</span> (offset &lt; 0) <span class="keywordflow">return</span> -1;
<a name="l02440"></a>02440     }
<a name="l02441"></a>02441     <span class="keywordflow">if</span> (len - offset &lt; slen) <span class="keywordflow">return</span> -1;
<a name="l02442"></a>02442     s = <a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(str);
<a name="l02443"></a>02443     e = s + <a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(str);
<a name="l02444"></a>02444     <span class="keywordflow">if</span> (offset) {
<a name="l02445"></a>02445         offset = <a class="code" href="../../d1/db0/string_8c.html#a0e1c768ca3baf15d6a4ec3581ba3297c">str_offset</a>(s, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a35bfa2635774977edad0a16b9fdebbaf">RSTRING_END</a>(str), offset, enc, <a class="code" href="../../d1/db0/string_8c.html#a5ab3c8112c2ec6943bdae8a2036fca02">single_byte_optimizable</a>(str));
<a name="l02446"></a>02446         s += offset;
<a name="l02447"></a>02447     }
<a name="l02448"></a>02448     <span class="keywordflow">if</span> (slen == 0) <span class="keywordflow">return</span> offset;
<a name="l02449"></a>02449     <span class="comment">/* need proceed one character at a time */</span>
<a name="l02450"></a>02450     sptr = <a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(sub);
<a name="l02451"></a>02451     slen = <a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(sub);
<a name="l02452"></a>02452     len = <a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(str) - offset;
<a name="l02453"></a>02453     <span class="keywordflow">for</span> (;;) {
<a name="l02454"></a>02454         <span class="keywordtype">char</span> *t;
<a name="l02455"></a>02455         pos = <a class="code" href="../../d5/de3/encoding_8h.html#a45cc3b058c7f36990e8733292c118047">rb_memsearch</a>(sptr, slen, s, len, enc);
<a name="l02456"></a>02456         <span class="keywordflow">if</span> (pos &lt; 0) <span class="keywordflow">return</span> pos;
<a name="l02457"></a>02457         t = <a class="code" href="../../d5/de3/encoding_8h.html#adb27dfc4f0710833a6d7b179fdef9c70">rb_enc_right_char_head</a>(s, s+pos, e, enc);
<a name="l02458"></a>02458         <span class="keywordflow">if</span> (t == s + pos) <span class="keywordflow">break</span>;
<a name="l02459"></a>02459         <span class="keywordflow">if</span> ((len -= t - s) &lt;= 0) <span class="keywordflow">return</span> -1;
<a name="l02460"></a>02460         offset += t - s;
<a name="l02461"></a>02461         s = t;
<a name="l02462"></a>02462     }
<a name="l02463"></a>02463     <span class="keywordflow">return</span> pos + offset;
<a name="l02464"></a>02464 }
<a name="l02465"></a>02465 
<a name="l02466"></a>02466 
<a name="l02467"></a>02467 <span class="comment">/*</span>
<a name="l02468"></a>02468 <span class="comment"> *  call-seq:</span>
<a name="l02469"></a>02469 <span class="comment"> *     str.index(substring [, offset])   -&gt; fixnum or nil</span>
<a name="l02470"></a>02470 <span class="comment"> *     str.index(regexp [, offset])      -&gt; fixnum or nil</span>
<a name="l02471"></a>02471 <span class="comment"> *</span>
<a name="l02472"></a>02472 <span class="comment"> *  Returns the index of the first occurrence of the given &lt;i&gt;substring&lt;/i&gt; or</span>
<a name="l02473"></a>02473 <span class="comment"> *  pattern (&lt;i&gt;regexp&lt;/i&gt;) in &lt;i&gt;str&lt;/i&gt;. Returns &lt;code&gt;nil&lt;/code&gt; if not</span>
<a name="l02474"></a>02474 <span class="comment"> *  found. If the second parameter is present, it specifies the position in the</span>
<a name="l02475"></a>02475 <span class="comment"> *  string to begin the search.</span>
<a name="l02476"></a>02476 <span class="comment"> *</span>
<a name="l02477"></a>02477 <span class="comment"> *     &quot;hello&quot;.index(&apos;e&apos;)             #=&gt; 1</span>
<a name="l02478"></a>02478 <span class="comment"> *     &quot;hello&quot;.index(&apos;lo&apos;)            #=&gt; 3</span>
<a name="l02479"></a>02479 <span class="comment"> *     &quot;hello&quot;.index(&apos;a&apos;)             #=&gt; nil</span>
<a name="l02480"></a>02480 <span class="comment"> *     &quot;hello&quot;.index(?e)              #=&gt; 1</span>
<a name="l02481"></a>02481 <span class="comment"> *     &quot;hello&quot;.index(/[aeiou]/, -3)   #=&gt; 4</span>
<a name="l02482"></a>02482 <span class="comment"> */</span>
<a name="l02483"></a>02483 
<a name="l02484"></a>02484 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l02485"></a><a class="code" href="../../d1/db0/string_8c.html#ad67c1477dff8216dff6a1a77f5e6b7f2">02485</a> <a class="code" href="../../d1/db0/string_8c.html#ad67c1477dff8216dff6a1a77f5e6b7f2">rb_str_index_m</a>(<span class="keywordtype">int</span> <a class="code" href="../../df/d77/ruby_8c.html#ad1447518f4372828b8435ae82e48499e">argc</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> *<a class="code" href="../../df/d77/ruby_8c.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str)
<a name="l02486"></a>02486 {
<a name="l02487"></a>02487     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <a class="code" href="../../d1/d6f/date__strftime_8c.html#a0d7154c0cddedcee49293c3e1f47d643">sub</a>;
<a name="l02488"></a>02488     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> initpos;
<a name="l02489"></a>02489     <span class="keywordtype">long</span> pos;
<a name="l02490"></a>02490 
<a name="l02491"></a>02491     <span class="keywordflow">if</span> (<a class="code" href="../../d7/d19/group__defmethod.html#gaa7bed88640f01bee619f85fda09d28d7">rb_scan_args</a>(argc, argv, <span class="stringliteral">&quot;11&quot;</span>, &amp;sub, &amp;initpos) == 2) {
<a name="l02492"></a>02492         pos = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a93f154f3dcc08027f475bf0c3cc287bd">NUM2LONG</a>(initpos);
<a name="l02493"></a>02493     }
<a name="l02494"></a>02494     <span class="keywordflow">else</span> {
<a name="l02495"></a>02495         pos = 0;
<a name="l02496"></a>02496     }
<a name="l02497"></a>02497     <span class="keywordflow">if</span> (pos &lt; 0) {
<a name="l02498"></a>02498         pos += <a class="code" href="../../d1/db0/string_8c.html#abe68504f1d38108a10f267f4358c53db">str_strlen</a>(str, <a class="code" href="../../d1/db0/string_8c.html#a123891f9f9b0c87d15621d93b4fa9c41">STR_ENC_GET</a>(str));
<a name="l02499"></a>02499         <span class="keywordflow">if</span> (pos &lt; 0) {
<a name="l02500"></a>02500             <span class="keywordflow">if</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a394faf7191f18552a20cb17ce14226f0">TYPE</a>(sub) == <a class="code" href="../../de/de6/ruby_2ruby_8h.html#afd5c1e36d171ecc04514332e8dcf6388">T_REGEXP</a>) {
<a name="l02501"></a>02501                 <a class="code" href="../../db/d2e/intern_8h.html#af108344435c1d0ea151c99dc859cccb4">rb_backref_set</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a320970f989dc8294c8203154e3db40c1">Qnil</a>);
<a name="l02502"></a>02502             }
<a name="l02503"></a>02503             <span class="keywordflow">return</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a320970f989dc8294c8203154e3db40c1">Qnil</a>;
<a name="l02504"></a>02504         }
<a name="l02505"></a>02505     }
<a name="l02506"></a>02506 
<a name="l02507"></a>02507     <span class="keywordflow">switch</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a394faf7191f18552a20cb17ce14226f0">TYPE</a>(sub)) {
<a name="l02508"></a>02508       <span class="keywordflow">case</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#afd5c1e36d171ecc04514332e8dcf6388">T_REGEXP</a>:
<a name="l02509"></a>02509         <span class="keywordflow">if</span> (pos &gt; <a class="code" href="../../d1/db0/string_8c.html#abe68504f1d38108a10f267f4358c53db">str_strlen</a>(str, <a class="code" href="../../d1/db0/string_8c.html#a123891f9f9b0c87d15621d93b4fa9c41">STR_ENC_GET</a>(str)))
<a name="l02510"></a>02510             <span class="keywordflow">return</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a320970f989dc8294c8203154e3db40c1">Qnil</a>;
<a name="l02511"></a>02511         pos = <a class="code" href="../../d1/db0/string_8c.html#a0e1c768ca3baf15d6a4ec3581ba3297c">str_offset</a>(<a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(str), <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a35bfa2635774977edad0a16b9fdebbaf">RSTRING_END</a>(str), pos,
<a name="l02512"></a>02512                          <a class="code" href="../../d5/db5/encoding_8c.html#a7d17d602fae27de649f9310511c03db0">rb_enc_check</a>(str, sub), <a class="code" href="../../d1/db0/string_8c.html#a5ab3c8112c2ec6943bdae8a2036fca02">single_byte_optimizable</a>(str));
<a name="l02513"></a>02513 
<a name="l02514"></a>02514         pos = <a class="code" href="../../db/db6/re_8h.html#afdf554fa234aebc803c8a4fc98c9936f">rb_reg_search</a>(sub, str, pos, 0);
<a name="l02515"></a>02515         pos = <a class="code" href="../../db/d2e/intern_8h.html#ad9828818c61258f1ddf03369fbcfee61">rb_str_sublen</a>(str, pos);
<a name="l02516"></a>02516         <span class="keywordflow">break</span>;
<a name="l02517"></a>02517 
<a name="l02518"></a>02518       <span class="keywordflow">default</span>: {
<a name="l02519"></a>02519         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> tmp;
<a name="l02520"></a>02520 
<a name="l02521"></a>02521         tmp = <a class="code" href="../../db/d2e/intern_8h.html#a669b6063704b2d304844bd1553217cf0">rb_check_string_type</a>(sub);
<a name="l02522"></a>02522         <span class="keywordflow">if</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a4832bad8845a35fc50f7a160901854a1">NIL_P</a>(tmp)) {
<a name="l02523"></a>02523             <a class="code" href="../../db/dcc/error_8c.html#a0f771a2840561f1838169b3d7d4616f3">rb_raise</a>(<a class="code" href="../../db/dcc/error_8c.html#a565ed9d70f4089e1b4a36e9b3381b8c6">rb_eTypeError</a>, <span class="stringliteral">&quot;type mismatch: %s given&quot;</span>,
<a name="l02524"></a>02524                      <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a9b4f42ada717bfbe7a78830639476aed">rb_obj_classname</a>(sub));
<a name="l02525"></a>02525         }
<a name="l02526"></a>02526         sub = tmp;
<a name="l02527"></a>02527       }
<a name="l02528"></a>02528         <span class="comment">/* fall through */</span>
<a name="l02529"></a>02529       <span class="keywordflow">case</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a22a8c2a4bbaae9b68f65c9bb92fd4e39">T_STRING</a>:
<a name="l02530"></a>02530         pos = <a class="code" href="../../d1/db0/string_8c.html#a44f92eec2a74155cc1bb3445e7cacaf1">rb_str_index</a>(str, sub, pos);
<a name="l02531"></a>02531         pos = <a class="code" href="../../db/d2e/intern_8h.html#ad9828818c61258f1ddf03369fbcfee61">rb_str_sublen</a>(str, pos);
<a name="l02532"></a>02532         <span class="keywordflow">break</span>;
<a name="l02533"></a>02533     }
<a name="l02534"></a>02534 
<a name="l02535"></a>02535     <span class="keywordflow">if</span> (pos == -1) <span class="keywordflow">return</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a320970f989dc8294c8203154e3db40c1">Qnil</a>;
<a name="l02536"></a>02536     <span class="keywordflow">return</span> <a class="code" href="../../dc/d0c/cparse_8c.html#af1afba1194a12547a1e65d92abf03b03">LONG2NUM</a>(pos);
<a name="l02537"></a>02537 }
<a name="l02538"></a>02538 
<a name="l02539"></a>02539 <span class="keyword">static</span> <span class="keywordtype">long</span>
<a name="l02540"></a><a class="code" href="../../d1/db0/string_8c.html#ad358453dbd4e7dc51510fd4fe8c6ae83">02540</a> <a class="code" href="../../d1/db0/string_8c.html#ad358453dbd4e7dc51510fd4fe8c6ae83">rb_str_rindex</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <a class="code" href="../../d1/d6f/date__strftime_8c.html#a0d7154c0cddedcee49293c3e1f47d643">sub</a>, <span class="keywordtype">long</span> pos)
<a name="l02541"></a>02541 {
<a name="l02542"></a>02542     <span class="keywordtype">long</span> len, slen;
<a name="l02543"></a>02543     <span class="keywordtype">char</span> *s, *sbeg, *e, *t;
<a name="l02544"></a>02544     <a class="code" href="../../d1/d7b/struct_onig_encoding_type_s_t.html">rb_encoding</a> *enc;
<a name="l02545"></a>02545     <span class="keywordtype">int</span> singlebyte = <a class="code" href="../../d1/db0/string_8c.html#a5ab3c8112c2ec6943bdae8a2036fca02">single_byte_optimizable</a>(str);
<a name="l02546"></a>02546 
<a name="l02547"></a>02547     enc = <a class="code" href="../../d5/db5/encoding_8c.html#a7d17d602fae27de649f9310511c03db0">rb_enc_check</a>(str, sub);
<a name="l02548"></a>02548     <span class="keywordflow">if</span> (<a class="code" href="../../d1/db0/string_8c.html#a8de8d2f6479866e76eeb56f5044fa583">is_broken_string</a>(sub)) {
<a name="l02549"></a>02549         <span class="keywordflow">return</span> -1;
<a name="l02550"></a>02550     }
<a name="l02551"></a>02551     len = <a class="code" href="../../d1/db0/string_8c.html#abe68504f1d38108a10f267f4358c53db">str_strlen</a>(str, enc);
<a name="l02552"></a>02552     slen = <a class="code" href="../../d1/db0/string_8c.html#abe68504f1d38108a10f267f4358c53db">str_strlen</a>(sub, enc);
<a name="l02553"></a>02553     <span class="comment">/* substring longer than string */</span>
<a name="l02554"></a>02554     <span class="keywordflow">if</span> (len &lt; slen) <span class="keywordflow">return</span> -1;
<a name="l02555"></a>02555     <span class="keywordflow">if</span> (len - pos &lt; slen) {
<a name="l02556"></a>02556         pos = len - slen;
<a name="l02557"></a>02557     }
<a name="l02558"></a>02558     <span class="keywordflow">if</span> (len == 0) {
<a name="l02559"></a>02559         <span class="keywordflow">return</span> pos;
<a name="l02560"></a>02560     }
<a name="l02561"></a>02561     sbeg = <a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(str);
<a name="l02562"></a>02562     e = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a35bfa2635774977edad0a16b9fdebbaf">RSTRING_END</a>(str);
<a name="l02563"></a>02563     t = <a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(sub);
<a name="l02564"></a>02564     slen = <a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(sub);
<a name="l02565"></a>02565     s = <a class="code" href="../../d1/db0/string_8c.html#a3b0d63e96168203d8b9c8e1129e7224d">str_nth</a>(sbeg, e, pos, enc, singlebyte);
<a name="l02566"></a>02566     <span class="keywordflow">while</span> (s) {
<a name="l02567"></a>02567         <span class="keywordflow">if</span> (<a class="code" href="../../d5/d21/memcmp_8c.html#a1499ab2d0a3da86cbc3e688294f60a48">memcmp</a>(s, t, slen) == 0) {
<a name="l02568"></a>02568             <span class="keywordflow">return</span> pos;
<a name="l02569"></a>02569         }
<a name="l02570"></a>02570         <span class="keywordflow">if</span> (pos == 0) <span class="keywordflow">break</span>;
<a name="l02571"></a>02571         pos--;
<a name="l02572"></a>02572         s = <a class="code" href="../../d5/de3/encoding_8h.html#a48a3264058189cf218f8e9dad6513c54">rb_enc_prev_char</a>(sbeg, s, e, enc);
<a name="l02573"></a>02573     }
<a name="l02574"></a>02574     <span class="keywordflow">return</span> -1;
<a name="l02575"></a>02575 }
<a name="l02576"></a>02576 
<a name="l02577"></a>02577 
<a name="l02578"></a>02578 <span class="comment">/*</span>
<a name="l02579"></a>02579 <span class="comment"> *  call-seq:</span>
<a name="l02580"></a>02580 <span class="comment"> *     str.rindex(substring [, fixnum])   -&gt; fixnum or nil</span>
<a name="l02581"></a>02581 <span class="comment"> *     str.rindex(regexp [, fixnum])   -&gt; fixnum or nil</span>
<a name="l02582"></a>02582 <span class="comment"> *</span>
<a name="l02583"></a>02583 <span class="comment"> *  Returns the index of the last occurrence of the given &lt;i&gt;substring&lt;/i&gt; or</span>
<a name="l02584"></a>02584 <span class="comment"> *  pattern (&lt;i&gt;regexp&lt;/i&gt;) in &lt;i&gt;str&lt;/i&gt;. Returns &lt;code&gt;nil&lt;/code&gt; if not</span>
<a name="l02585"></a>02585 <span class="comment"> *  found. If the second parameter is present, it specifies the position in the</span>
<a name="l02586"></a>02586 <span class="comment"> *  string to end the search---characters beyond this point will not be</span>
<a name="l02587"></a>02587 <span class="comment"> *  considered.</span>
<a name="l02588"></a>02588 <span class="comment"> *</span>
<a name="l02589"></a>02589 <span class="comment"> *     &quot;hello&quot;.rindex(&apos;e&apos;)             #=&gt; 1</span>
<a name="l02590"></a>02590 <span class="comment"> *     &quot;hello&quot;.rindex(&apos;l&apos;)             #=&gt; 3</span>
<a name="l02591"></a>02591 <span class="comment"> *     &quot;hello&quot;.rindex(&apos;a&apos;)             #=&gt; nil</span>
<a name="l02592"></a>02592 <span class="comment"> *     &quot;hello&quot;.rindex(?e)              #=&gt; 1</span>
<a name="l02593"></a>02593 <span class="comment"> *     &quot;hello&quot;.rindex(/[aeiou]/, -2)   #=&gt; 1</span>
<a name="l02594"></a>02594 <span class="comment"> */</span>
<a name="l02595"></a>02595 
<a name="l02596"></a>02596 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l02597"></a><a class="code" href="../../d1/db0/string_8c.html#a767d103897e02f1d2c0e21a34f727fa2">02597</a> <a class="code" href="../../d1/db0/string_8c.html#a767d103897e02f1d2c0e21a34f727fa2">rb_str_rindex_m</a>(<span class="keywordtype">int</span> <a class="code" href="../../df/d77/ruby_8c.html#ad1447518f4372828b8435ae82e48499e">argc</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> *<a class="code" href="../../df/d77/ruby_8c.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str)
<a name="l02598"></a>02598 {
<a name="l02599"></a>02599     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <a class="code" href="../../d1/d6f/date__strftime_8c.html#a0d7154c0cddedcee49293c3e1f47d643">sub</a>;
<a name="l02600"></a>02600     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> vpos;
<a name="l02601"></a>02601     <a class="code" href="../../d1/d7b/struct_onig_encoding_type_s_t.html">rb_encoding</a> *enc = <a class="code" href="../../d1/db0/string_8c.html#a123891f9f9b0c87d15621d93b4fa9c41">STR_ENC_GET</a>(str);
<a name="l02602"></a>02602     <span class="keywordtype">long</span> pos, len = <a class="code" href="../../d1/db0/string_8c.html#abe68504f1d38108a10f267f4358c53db">str_strlen</a>(str, enc);
<a name="l02603"></a>02603 
<a name="l02604"></a>02604     <span class="keywordflow">if</span> (<a class="code" href="../../d7/d19/group__defmethod.html#gaa7bed88640f01bee619f85fda09d28d7">rb_scan_args</a>(argc, argv, <span class="stringliteral">&quot;11&quot;</span>, &amp;sub, &amp;vpos) == 2) {
<a name="l02605"></a>02605         pos = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a93f154f3dcc08027f475bf0c3cc287bd">NUM2LONG</a>(vpos);
<a name="l02606"></a>02606         <span class="keywordflow">if</span> (pos &lt; 0) {
<a name="l02607"></a>02607             pos += len;
<a name="l02608"></a>02608             <span class="keywordflow">if</span> (pos &lt; 0) {
<a name="l02609"></a>02609                 <span class="keywordflow">if</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a394faf7191f18552a20cb17ce14226f0">TYPE</a>(sub) == <a class="code" href="../../de/de6/ruby_2ruby_8h.html#afd5c1e36d171ecc04514332e8dcf6388">T_REGEXP</a>) {
<a name="l02610"></a>02610                     <a class="code" href="../../db/d2e/intern_8h.html#af108344435c1d0ea151c99dc859cccb4">rb_backref_set</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a320970f989dc8294c8203154e3db40c1">Qnil</a>);
<a name="l02611"></a>02611                 }
<a name="l02612"></a>02612                 <span class="keywordflow">return</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a320970f989dc8294c8203154e3db40c1">Qnil</a>;
<a name="l02613"></a>02613             }
<a name="l02614"></a>02614         }
<a name="l02615"></a>02615         <span class="keywordflow">if</span> (pos &gt; len) pos = len;
<a name="l02616"></a>02616     }
<a name="l02617"></a>02617     <span class="keywordflow">else</span> {
<a name="l02618"></a>02618         pos = len;
<a name="l02619"></a>02619     }
<a name="l02620"></a>02620 
<a name="l02621"></a>02621     <span class="keywordflow">switch</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a394faf7191f18552a20cb17ce14226f0">TYPE</a>(sub)) {
<a name="l02622"></a>02622       <span class="keywordflow">case</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#afd5c1e36d171ecc04514332e8dcf6388">T_REGEXP</a>:
<a name="l02623"></a>02623         <span class="comment">/* enc = rb_get_check(str, sub); */</span>
<a name="l02624"></a>02624         pos = <a class="code" href="../../d1/db0/string_8c.html#a0e1c768ca3baf15d6a4ec3581ba3297c">str_offset</a>(<a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(str), <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a35bfa2635774977edad0a16b9fdebbaf">RSTRING_END</a>(str), pos,
<a name="l02625"></a>02625                          <a class="code" href="../../d1/db0/string_8c.html#a123891f9f9b0c87d15621d93b4fa9c41">STR_ENC_GET</a>(str), <a class="code" href="../../d1/db0/string_8c.html#a5ab3c8112c2ec6943bdae8a2036fca02">single_byte_optimizable</a>(str));
<a name="l02626"></a>02626 
<a name="l02627"></a>02627         <span class="keywordflow">if</span> (!<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a062a8130d6bba9a9ccde0ee143db5afd">RREGEXP</a>(sub)-&gt;ptr || <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a28ed048d980c0abb555521a028ebb479">RREGEXP_SRC_LEN</a>(sub)) {
<a name="l02628"></a>02628             pos = <a class="code" href="../../db/db6/re_8h.html#afdf554fa234aebc803c8a4fc98c9936f">rb_reg_search</a>(sub, str, pos, 1);
<a name="l02629"></a>02629             pos = <a class="code" href="../../db/d2e/intern_8h.html#ad9828818c61258f1ddf03369fbcfee61">rb_str_sublen</a>(str, pos);
<a name="l02630"></a>02630         }
<a name="l02631"></a>02631         <span class="keywordflow">if</span> (pos &gt;= 0) <span class="keywordflow">return</span> <a class="code" href="../../dc/d0c/cparse_8c.html#af1afba1194a12547a1e65d92abf03b03">LONG2NUM</a>(pos);
<a name="l02632"></a>02632         <span class="keywordflow">break</span>;
<a name="l02633"></a>02633 
<a name="l02634"></a>02634       <span class="keywordflow">default</span>: {
<a name="l02635"></a>02635         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> tmp;
<a name="l02636"></a>02636 
<a name="l02637"></a>02637         tmp = <a class="code" href="../../db/d2e/intern_8h.html#a669b6063704b2d304844bd1553217cf0">rb_check_string_type</a>(sub);
<a name="l02638"></a>02638         <span class="keywordflow">if</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a4832bad8845a35fc50f7a160901854a1">NIL_P</a>(tmp)) {
<a name="l02639"></a>02639             <a class="code" href="../../db/dcc/error_8c.html#a0f771a2840561f1838169b3d7d4616f3">rb_raise</a>(<a class="code" href="../../db/dcc/error_8c.html#a565ed9d70f4089e1b4a36e9b3381b8c6">rb_eTypeError</a>, <span class="stringliteral">&quot;type mismatch: %s given&quot;</span>,
<a name="l02640"></a>02640                      <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a9b4f42ada717bfbe7a78830639476aed">rb_obj_classname</a>(sub));
<a name="l02641"></a>02641         }
<a name="l02642"></a>02642         sub = tmp;
<a name="l02643"></a>02643       }
<a name="l02644"></a>02644         <span class="comment">/* fall through */</span>
<a name="l02645"></a>02645       <span class="keywordflow">case</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a22a8c2a4bbaae9b68f65c9bb92fd4e39">T_STRING</a>:
<a name="l02646"></a>02646         pos = <a class="code" href="../../d1/db0/string_8c.html#ad358453dbd4e7dc51510fd4fe8c6ae83">rb_str_rindex</a>(str, sub, pos);
<a name="l02647"></a>02647         <span class="keywordflow">if</span> (pos &gt;= 0) <span class="keywordflow">return</span> <a class="code" href="../../dc/d0c/cparse_8c.html#af1afba1194a12547a1e65d92abf03b03">LONG2NUM</a>(pos);
<a name="l02648"></a>02648         <span class="keywordflow">break</span>;
<a name="l02649"></a>02649     }
<a name="l02650"></a>02650     <span class="keywordflow">return</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a320970f989dc8294c8203154e3db40c1">Qnil</a>;
<a name="l02651"></a>02651 }
<a name="l02652"></a>02652 
<a name="l02653"></a>02653 <span class="comment">/*</span>
<a name="l02654"></a>02654 <span class="comment"> *  call-seq:</span>
<a name="l02655"></a>02655 <span class="comment"> *     str =~ obj   -&gt; fixnum or nil</span>
<a name="l02656"></a>02656 <span class="comment"> *</span>
<a name="l02657"></a>02657 <span class="comment"> *  Match---If &lt;i&gt;obj&lt;/i&gt; is a &lt;code&gt;Regexp&lt;/code&gt;, use it as a pattern to match</span>
<a name="l02658"></a>02658 <span class="comment"> *  against &lt;i&gt;str&lt;/i&gt;,and returns the position the match starts, or</span>
<a name="l02659"></a>02659 <span class="comment"> *  &lt;code&gt;nil&lt;/code&gt; if there is no match. Otherwise, invokes</span>
<a name="l02660"></a>02660 <span class="comment"> *  &lt;i&gt;obj.=~&lt;/i&gt;, passing &lt;i&gt;str&lt;/i&gt; as an argument. The default</span>
<a name="l02661"></a>02661 <span class="comment"> *  &lt;code&gt;=~&lt;/code&gt; in &lt;code&gt;Object&lt;/code&gt; returns &lt;code&gt;nil&lt;/code&gt;.</span>
<a name="l02662"></a>02662 <span class="comment"> *</span>
<a name="l02663"></a>02663 <span class="comment"> *     &quot;cat o&apos; 9 tails&quot; =~ /\d/   #=&gt; 7</span>
<a name="l02664"></a>02664 <span class="comment"> *     &quot;cat o&apos; 9 tails&quot; =~ 9      #=&gt; nil</span>
<a name="l02665"></a>02665 <span class="comment"> */</span>
<a name="l02666"></a>02666 
<a name="l02667"></a>02667 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l02668"></a><a class="code" href="../../d1/db0/string_8c.html#a2715777ab2236ea2aaae11365122b861">02668</a> <a class="code" href="../../d1/db0/string_8c.html#a2715777ab2236ea2aaae11365122b861">rb_str_match</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> x, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> y)
<a name="l02669"></a>02669 {
<a name="l02670"></a>02670     <span class="keywordflow">switch</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a394faf7191f18552a20cb17ce14226f0">TYPE</a>(y)) {
<a name="l02671"></a>02671       <span class="keywordflow">case</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a22a8c2a4bbaae9b68f65c9bb92fd4e39">T_STRING</a>:
<a name="l02672"></a>02672         <a class="code" href="../../db/dcc/error_8c.html#a0f771a2840561f1838169b3d7d4616f3">rb_raise</a>(<a class="code" href="../../db/dcc/error_8c.html#a565ed9d70f4089e1b4a36e9b3381b8c6">rb_eTypeError</a>, <span class="stringliteral">&quot;type mismatch: String given&quot;</span>);
<a name="l02673"></a>02673 
<a name="l02674"></a>02674       <span class="keywordflow">case</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#afd5c1e36d171ecc04514332e8dcf6388">T_REGEXP</a>:
<a name="l02675"></a>02675         <span class="keywordflow">return</span> <a class="code" href="../../db/d2e/intern_8h.html#a983894ce38d991a04563384b706240e6">rb_reg_match</a>(y, x);
<a name="l02676"></a>02676 
<a name="l02677"></a>02677       <span class="keywordflow">default</span>:
<a name="l02678"></a>02678         <span class="keywordflow">return</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a6a973fe624aa9aa9ba0cdeb6792d3187" title="Calls a method.">rb_funcall</a>(y, <a class="code" href="../../dc/dcc/array_8c.html#a9cfa42d4b79c89d68c53be8b2150a503">rb_intern</a>(<span class="stringliteral">&quot;=~&quot;</span>), 1, x);
<a name="l02679"></a>02679     }
<a name="l02680"></a>02680 }
<a name="l02681"></a>02681 
<a name="l02682"></a>02682 
<a name="l02683"></a>02683 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <a class="code" href="../../d1/db0/string_8c.html#a105b63dc9f6f07c8c6403302757e9c96">get_pat</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>, <span class="keywordtype">int</span>);
<a name="l02684"></a>02684 
<a name="l02685"></a>02685 
<a name="l02686"></a>02686 <span class="comment">/*</span>
<a name="l02687"></a>02687 <span class="comment"> *  call-seq:</span>
<a name="l02688"></a>02688 <span class="comment"> *     str.match(pattern)        -&gt; matchdata or nil</span>
<a name="l02689"></a>02689 <span class="comment"> *     str.match(pattern, pos)   -&gt; matchdata or nil</span>
<a name="l02690"></a>02690 <span class="comment"> *</span>
<a name="l02691"></a>02691 <span class="comment"> *  Converts &lt;i&gt;pattern&lt;/i&gt; to a &lt;code&gt;Regexp&lt;/code&gt; (if it isn&apos;t already one),</span>
<a name="l02692"></a>02692 <span class="comment"> *  then invokes its &lt;code&gt;match&lt;/code&gt; method on &lt;i&gt;str&lt;/i&gt;.  If the second</span>
<a name="l02693"></a>02693 <span class="comment"> *  parameter is present, it specifies the position in the string to begin the</span>
<a name="l02694"></a>02694 <span class="comment"> *  search.</span>
<a name="l02695"></a>02695 <span class="comment"> *</span>
<a name="l02696"></a>02696 <span class="comment"> *     &apos;hello&apos;.match(&apos;(.)\1&apos;)      #=&gt; #&lt;MatchData &quot;ll&quot; 1:&quot;l&quot;&gt;</span>
<a name="l02697"></a>02697 <span class="comment"> *     &apos;hello&apos;.match(&apos;(.)\1&apos;)[0]   #=&gt; &quot;ll&quot;</span>
<a name="l02698"></a>02698 <span class="comment"> *     &apos;hello&apos;.match(/(.)\1/)[0]   #=&gt; &quot;ll&quot;</span>
<a name="l02699"></a>02699 <span class="comment"> *     &apos;hello&apos;.match(&apos;xx&apos;)         #=&gt; nil</span>
<a name="l02700"></a>02700 <span class="comment"> *</span>
<a name="l02701"></a>02701 <span class="comment"> *  If a block is given, invoke the block with MatchData if match succeed, so</span>
<a name="l02702"></a>02702 <span class="comment"> *  that you can write</span>
<a name="l02703"></a>02703 <span class="comment"> *</span>
<a name="l02704"></a>02704 <span class="comment"> *     str.match(pat) {|m| ...}</span>
<a name="l02705"></a>02705 <span class="comment"> *</span>
<a name="l02706"></a>02706 <span class="comment"> *  instead of</span>
<a name="l02707"></a>02707 <span class="comment"> *</span>
<a name="l02708"></a>02708 <span class="comment"> *     if m = str.match(pat)</span>
<a name="l02709"></a>02709 <span class="comment"> *       ...</span>
<a name="l02710"></a>02710 <span class="comment"> *     end</span>
<a name="l02711"></a>02711 <span class="comment"> *</span>
<a name="l02712"></a>02712 <span class="comment"> *  The return value is a value from block execution in this case.</span>
<a name="l02713"></a>02713 <span class="comment"> */</span>
<a name="l02714"></a>02714 
<a name="l02715"></a>02715 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l02716"></a><a class="code" href="../../d1/db0/string_8c.html#a0c71a042338f6b2faf10aa3aafd9e943">02716</a> <a class="code" href="../../d1/db0/string_8c.html#a0c71a042338f6b2faf10aa3aafd9e943">rb_str_match_m</a>(<span class="keywordtype">int</span> <a class="code" href="../../df/d77/ruby_8c.html#ad1447518f4372828b8435ae82e48499e">argc</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> *<a class="code" href="../../df/d77/ruby_8c.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str)
<a name="l02717"></a>02717 {
<a name="l02718"></a>02718     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> re, <a class="code" href="../../d8/d90/nkf_8c.html#a5ea5ac7abf5cce39283e422add1067d5">result</a>;
<a name="l02719"></a>02719     <span class="keywordflow">if</span> (argc &lt; 1)
<a name="l02720"></a>02720        <a class="code" href="../../db/dcc/error_8c.html#a0f771a2840561f1838169b3d7d4616f3">rb_raise</a>(<a class="code" href="../../db/dcc/error_8c.html#ab5e2a9fec766c75176fbb262bfe6a596">rb_eArgError</a>, <span class="stringliteral">&quot;wrong number of arguments (%d for 1..2)&quot;</span>, argc);
<a name="l02721"></a>02721     re = argv[0];
<a name="l02722"></a>02722     argv[0] = str;
<a name="l02723"></a>02723     result = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#adafa8fd17636821445380e7e1881355e" title="Calls a method.">rb_funcall2</a>(<a class="code" href="../../d1/db0/string_8c.html#a105b63dc9f6f07c8c6403302757e9c96">get_pat</a>(re, 0), <a class="code" href="../../dc/dcc/array_8c.html#a9cfa42d4b79c89d68c53be8b2150a503">rb_intern</a>(<span class="stringliteral">&quot;match&quot;</span>), argc, argv);
<a name="l02724"></a>02724     <span class="keywordflow">if</span> (!<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a4832bad8845a35fc50f7a160901854a1">NIL_P</a>(result) &amp;&amp; <a class="code" href="../../d3/d57/eval_8c.html#aea346c4eb8bc06df88422e956bb05fec">rb_block_given_p</a>()) {
<a name="l02725"></a>02725         <span class="keywordflow">return</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ae6bd0c4ea4db971ebd569ca8f05c6b4a">rb_yield</a>(result);
<a name="l02726"></a>02726     }
<a name="l02727"></a>02727     <span class="keywordflow">return</span> result;
<a name="l02728"></a>02728 }
<a name="l02729"></a>02729 
<a name="l02730"></a><a class="code" href="../../d1/db0/string_8c.html#afc1587413ab4674d33ad8203e64ec21d">02730</a> <span class="keyword">enum</span> <a class="code" href="../../d1/db0/string_8c.html#afc1587413ab4674d33ad8203e64ec21d">neighbor_char</a> {
<a name="l02731"></a><a class="code" href="../../d1/db0/string_8c.html#afc1587413ab4674d33ad8203e64ec21dab9875d2fb7421d5c1eeeecc2d5a5bc7b">02731</a>     <a class="code" href="../../d1/db0/string_8c.html#afc1587413ab4674d33ad8203e64ec21dab9875d2fb7421d5c1eeeecc2d5a5bc7b">NEIGHBOR_NOT_CHAR</a>,
<a name="l02732"></a><a class="code" href="../../d1/db0/string_8c.html#afc1587413ab4674d33ad8203e64ec21da85e23b765e100038368640a06a372b03">02732</a>     <a class="code" href="../../d1/db0/string_8c.html#afc1587413ab4674d33ad8203e64ec21da85e23b765e100038368640a06a372b03">NEIGHBOR_FOUND</a>,
<a name="l02733"></a><a class="code" href="../../d1/db0/string_8c.html#afc1587413ab4674d33ad8203e64ec21daa69efe5f88edfe825766b8a7c524cb82">02733</a>     <a class="code" href="../../d1/db0/string_8c.html#afc1587413ab4674d33ad8203e64ec21daa69efe5f88edfe825766b8a7c524cb82">NEIGHBOR_WRAPPED</a>
<a name="l02734"></a>02734 };
<a name="l02735"></a>02735 
<a name="l02736"></a>02736 <span class="keyword">static</span> <span class="keyword">enum</span> <a class="code" href="../../d1/db0/string_8c.html#afc1587413ab4674d33ad8203e64ec21d">neighbor_char</a>
<a name="l02737"></a><a class="code" href="../../d1/db0/string_8c.html#a1e7e33c4c43b9ffdd76929b49bc3497a">02737</a> <a class="code" href="../../d1/db0/string_8c.html#a1e7e33c4c43b9ffdd76929b49bc3497a">enc_succ_char</a>(<span class="keywordtype">char</span> *p, <span class="keywordtype">long</span> len, <a class="code" href="../../d1/d7b/struct_onig_encoding_type_s_t.html">rb_encoding</a> *enc)
<a name="l02738"></a>02738 {
<a name="l02739"></a>02739     <span class="keywordtype">long</span> i;
<a name="l02740"></a>02740     <span class="keywordtype">int</span> l;
<a name="l02741"></a>02741     <span class="keywordflow">while</span> (1) {
<a name="l02742"></a>02742         <span class="keywordflow">for</span> (i = len-1; 0 &lt;= i &amp;&amp; (<span class="keywordtype">unsigned</span> char)p[i] == 0xff; i--)
<a name="l02743"></a>02743             p[i] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l02744"></a>02744         <span class="keywordflow">if</span> (i &lt; 0)
<a name="l02745"></a>02745             <span class="keywordflow">return</span> <a class="code" href="../../d1/db0/string_8c.html#afc1587413ab4674d33ad8203e64ec21daa69efe5f88edfe825766b8a7c524cb82">NEIGHBOR_WRAPPED</a>;
<a name="l02746"></a>02746         ++((<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*)p)[i];
<a name="l02747"></a>02747         l = <a class="code" href="../../d5/db5/encoding_8c.html#a0c6003b6aeaed218d841974b00c95870">rb_enc_precise_mbclen</a>(p, p+len, enc);
<a name="l02748"></a>02748         <span class="keywordflow">if</span> (<a class="code" href="../../d5/de3/encoding_8h.html#ac3dcc15c5ed42d6590e1c1f91b74165c">MBCLEN_CHARFOUND_P</a>(l)) {
<a name="l02749"></a>02749             l = <a class="code" href="../../d5/de3/encoding_8h.html#a877f84ae22293dae2a8cf1e26ea5b1a6">MBCLEN_CHARFOUND_LEN</a>(l);
<a name="l02750"></a>02750             <span class="keywordflow">if</span> (l == len) {
<a name="l02751"></a>02751                 <span class="keywordflow">return</span> <a class="code" href="../../d1/db0/string_8c.html#afc1587413ab4674d33ad8203e64ec21da85e23b765e100038368640a06a372b03">NEIGHBOR_FOUND</a>;
<a name="l02752"></a>02752             }
<a name="l02753"></a>02753             <span class="keywordflow">else</span> {
<a name="l02754"></a>02754                 memset(p+l, 0xff, len-l);
<a name="l02755"></a>02755             }
<a name="l02756"></a>02756         }
<a name="l02757"></a>02757         <span class="keywordflow">if</span> (<a class="code" href="../../d5/de3/encoding_8h.html#a9be706470754634a65ed29bcd2508ee1">MBCLEN_INVALID_P</a>(l) &amp;&amp; i &lt; len-1) {
<a name="l02758"></a>02758             <span class="keywordtype">long</span> len2;
<a name="l02759"></a>02759             <span class="keywordtype">int</span> l2;
<a name="l02760"></a>02760             <span class="keywordflow">for</span> (len2 = len-1; 0 &lt; len2; len2--) {
<a name="l02761"></a>02761                 l2 = <a class="code" href="../../d5/db5/encoding_8c.html#a0c6003b6aeaed218d841974b00c95870">rb_enc_precise_mbclen</a>(p, p+len2, enc);
<a name="l02762"></a>02762                 <span class="keywordflow">if</span> (!<a class="code" href="../../d5/de3/encoding_8h.html#a9be706470754634a65ed29bcd2508ee1">MBCLEN_INVALID_P</a>(l2))
<a name="l02763"></a>02763                     <span class="keywordflow">break</span>;
<a name="l02764"></a>02764             }
<a name="l02765"></a>02765             memset(p+len2+1, 0xff, len-(len2+1));
<a name="l02766"></a>02766         }
<a name="l02767"></a>02767     }
<a name="l02768"></a>02768 }
<a name="l02769"></a>02769 
<a name="l02770"></a>02770 <span class="keyword">static</span> <span class="keyword">enum</span> <a class="code" href="../../d1/db0/string_8c.html#afc1587413ab4674d33ad8203e64ec21d">neighbor_char</a>
<a name="l02771"></a><a class="code" href="../../d1/db0/string_8c.html#a3a3536cb9b2cc41e9624f908c74de3d8">02771</a> <a class="code" href="../../d1/db0/string_8c.html#a3a3536cb9b2cc41e9624f908c74de3d8">enc_pred_char</a>(<span class="keywordtype">char</span> *p, <span class="keywordtype">long</span> len, <a class="code" href="../../d1/d7b/struct_onig_encoding_type_s_t.html">rb_encoding</a> *enc)
<a name="l02772"></a>02772 {
<a name="l02773"></a>02773     <span class="keywordtype">long</span> i;
<a name="l02774"></a>02774     <span class="keywordtype">int</span> l;
<a name="l02775"></a>02775     <span class="keywordflow">while</span> (1) {
<a name="l02776"></a>02776         <span class="keywordflow">for</span> (i = len-1; 0 &lt;= i &amp;&amp; (<span class="keywordtype">unsigned</span> char)p[i] == 0; i--)
<a name="l02777"></a>02777             p[i] = <span class="stringliteral">&apos;\xff&apos;</span>;
<a name="l02778"></a>02778         <span class="keywordflow">if</span> (i &lt; 0)
<a name="l02779"></a>02779             <span class="keywordflow">return</span> <a class="code" href="../../d1/db0/string_8c.html#afc1587413ab4674d33ad8203e64ec21daa69efe5f88edfe825766b8a7c524cb82">NEIGHBOR_WRAPPED</a>;
<a name="l02780"></a>02780         --((<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*)p)[i];
<a name="l02781"></a>02781         l = <a class="code" href="../../d5/db5/encoding_8c.html#a0c6003b6aeaed218d841974b00c95870">rb_enc_precise_mbclen</a>(p, p+len, enc);
<a name="l02782"></a>02782         <span class="keywordflow">if</span> (<a class="code" href="../../d5/de3/encoding_8h.html#ac3dcc15c5ed42d6590e1c1f91b74165c">MBCLEN_CHARFOUND_P</a>(l)) {
<a name="l02783"></a>02783             l = <a class="code" href="../../d5/de3/encoding_8h.html#a877f84ae22293dae2a8cf1e26ea5b1a6">MBCLEN_CHARFOUND_LEN</a>(l);
<a name="l02784"></a>02784             <span class="keywordflow">if</span> (l == len) {
<a name="l02785"></a>02785                 <span class="keywordflow">return</span> <a class="code" href="../../d1/db0/string_8c.html#afc1587413ab4674d33ad8203e64ec21da85e23b765e100038368640a06a372b03">NEIGHBOR_FOUND</a>;
<a name="l02786"></a>02786             }
<a name="l02787"></a>02787             <span class="keywordflow">else</span> {
<a name="l02788"></a>02788                 memset(p+l, 0, len-l);
<a name="l02789"></a>02789             }
<a name="l02790"></a>02790         }
<a name="l02791"></a>02791         <span class="keywordflow">if</span> (<a class="code" href="../../d5/de3/encoding_8h.html#a9be706470754634a65ed29bcd2508ee1">MBCLEN_INVALID_P</a>(l) &amp;&amp; i &lt; len-1) {
<a name="l02792"></a>02792             <span class="keywordtype">long</span> len2;
<a name="l02793"></a>02793             <span class="keywordtype">int</span> l2;
<a name="l02794"></a>02794             <span class="keywordflow">for</span> (len2 = len-1; 0 &lt; len2; len2--) {
<a name="l02795"></a>02795                 l2 = <a class="code" href="../../d5/db5/encoding_8c.html#a0c6003b6aeaed218d841974b00c95870">rb_enc_precise_mbclen</a>(p, p+len2, enc);
<a name="l02796"></a>02796                 <span class="keywordflow">if</span> (!<a class="code" href="../../d5/de3/encoding_8h.html#a9be706470754634a65ed29bcd2508ee1">MBCLEN_INVALID_P</a>(l2))
<a name="l02797"></a>02797                     <span class="keywordflow">break</span>;
<a name="l02798"></a>02798             }
<a name="l02799"></a>02799             memset(p+len2+1, 0, len-(len2+1));
<a name="l02800"></a>02800         }
<a name="l02801"></a>02801     }
<a name="l02802"></a>02802 }
<a name="l02803"></a>02803 
<a name="l02804"></a>02804 <span class="comment">/*</span>
<a name="l02805"></a>02805 <span class="comment">  overwrite +p+ by succeeding letter in +enc+ and returns</span>
<a name="l02806"></a>02806 <span class="comment">  NEIGHBOR_FOUND or NEIGHBOR_WRAPPED.</span>
<a name="l02807"></a>02807 <span class="comment">  When NEIGHBOR_WRAPPED, carried-out letter is stored into carry.</span>
<a name="l02808"></a>02808 <span class="comment">  assuming each ranges are successive, and mbclen</span>
<a name="l02809"></a>02809 <span class="comment">  never change in each ranges.</span>
<a name="l02810"></a>02810 <span class="comment">  NEIGHBOR_NOT_CHAR is returned if invalid character or the range has only one</span>
<a name="l02811"></a>02811 <span class="comment">  character.</span>
<a name="l02812"></a>02812 <span class="comment"> */</span>
<a name="l02813"></a>02813 <span class="keyword">static</span> <span class="keyword">enum</span> <a class="code" href="../../d1/db0/string_8c.html#afc1587413ab4674d33ad8203e64ec21d">neighbor_char</a>
<a name="l02814"></a><a class="code" href="../../d1/db0/string_8c.html#ab81cc324ed82c42649c5f127259c1307">02814</a> <a class="code" href="../../d1/db0/string_8c.html#ab81cc324ed82c42649c5f127259c1307">enc_succ_alnum_char</a>(<span class="keywordtype">char</span> *p, <span class="keywordtype">long</span> len, <a class="code" href="../../d1/d7b/struct_onig_encoding_type_s_t.html">rb_encoding</a> *enc, <span class="keywordtype">char</span> *carry)
<a name="l02815"></a>02815 {
<a name="l02816"></a>02816     <span class="keyword">enum</span> <a class="code" href="../../d1/db0/string_8c.html#afc1587413ab4674d33ad8203e64ec21d">neighbor_char</a> ret;
<a name="l02817"></a>02817     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> c;
<a name="l02818"></a>02818     <span class="keywordtype">int</span> ctype;
<a name="l02819"></a>02819     <span class="keywordtype">int</span> <a class="code" href="../../d1/d6f/date__strftime_8c.html#acec32330ad44f2b584bf332775a1d328">range</a>;
<a name="l02820"></a>02820     <span class="keywordtype">char</span> save[<a class="code" href="../../d8/db3/oniguruma_8h.html#a5eba220c99bf5d04cfe9dc51e744b747">ONIGENC_CODE_TO_MBC_MAXLEN</a>];
<a name="l02821"></a>02821 
<a name="l02822"></a>02822     c = <a class="code" href="../../d5/de3/encoding_8h.html#a7f8372dd0ada95131f8a22a4d8759d39">rb_enc_mbc_to_codepoint</a>(p, p+len, enc);
<a name="l02823"></a>02823     <span class="keywordflow">if</span> (<a class="code" href="../../d5/de3/encoding_8h.html#a2881148c8f904fd052ae10793c111808">rb_enc_isctype</a>(c, <a class="code" href="../../d8/db3/oniguruma_8h.html#a14f0f2ce858aa271891329a3c5a9f6cb">ONIGENC_CTYPE_DIGIT</a>, enc))
<a name="l02824"></a>02824         ctype = <a class="code" href="../../d8/db3/oniguruma_8h.html#a14f0f2ce858aa271891329a3c5a9f6cb">ONIGENC_CTYPE_DIGIT</a>;
<a name="l02825"></a>02825     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d5/de3/encoding_8h.html#a2881148c8f904fd052ae10793c111808">rb_enc_isctype</a>(c, <a class="code" href="../../d8/db3/oniguruma_8h.html#a4a3a6205038ed0a845d462f8dde01dde">ONIGENC_CTYPE_ALPHA</a>, enc))
<a name="l02826"></a>02826         ctype = <a class="code" href="../../d8/db3/oniguruma_8h.html#a4a3a6205038ed0a845d462f8dde01dde">ONIGENC_CTYPE_ALPHA</a>;
<a name="l02827"></a>02827     <span class="keywordflow">else</span>
<a name="l02828"></a>02828         <span class="keywordflow">return</span> <a class="code" href="../../d1/db0/string_8c.html#afc1587413ab4674d33ad8203e64ec21dab9875d2fb7421d5c1eeeecc2d5a5bc7b">NEIGHBOR_NOT_CHAR</a>;
<a name="l02829"></a>02829 
<a name="l02830"></a>02830     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a04ab67335215e8362c63ed27ae2d1c40">MEMCPY</a>(save, p, <span class="keywordtype">char</span>, len);
<a name="l02831"></a>02831     ret = <a class="code" href="../../d1/db0/string_8c.html#a1e7e33c4c43b9ffdd76929b49bc3497a">enc_succ_char</a>(p, len, enc);
<a name="l02832"></a>02832     <span class="keywordflow">if</span> (ret == <a class="code" href="../../d1/db0/string_8c.html#afc1587413ab4674d33ad8203e64ec21da85e23b765e100038368640a06a372b03">NEIGHBOR_FOUND</a>) {
<a name="l02833"></a>02833         c = <a class="code" href="../../d5/de3/encoding_8h.html#a7f8372dd0ada95131f8a22a4d8759d39">rb_enc_mbc_to_codepoint</a>(p, p+len, enc);
<a name="l02834"></a>02834         <span class="keywordflow">if</span> (<a class="code" href="../../d5/de3/encoding_8h.html#a2881148c8f904fd052ae10793c111808">rb_enc_isctype</a>(c, ctype, enc))
<a name="l02835"></a>02835             <span class="keywordflow">return</span> <a class="code" href="../../d1/db0/string_8c.html#afc1587413ab4674d33ad8203e64ec21da85e23b765e100038368640a06a372b03">NEIGHBOR_FOUND</a>;
<a name="l02836"></a>02836     }
<a name="l02837"></a>02837     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a04ab67335215e8362c63ed27ae2d1c40">MEMCPY</a>(p, save, <span class="keywordtype">char</span>, len);
<a name="l02838"></a>02838     range = 1;
<a name="l02839"></a>02839     <span class="keywordflow">while</span> (1) {
<a name="l02840"></a>02840         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a04ab67335215e8362c63ed27ae2d1c40">MEMCPY</a>(save, p, <span class="keywordtype">char</span>, len);
<a name="l02841"></a>02841         ret = <a class="code" href="../../d1/db0/string_8c.html#a3a3536cb9b2cc41e9624f908c74de3d8">enc_pred_char</a>(p, len, enc);
<a name="l02842"></a>02842         <span class="keywordflow">if</span> (ret == <a class="code" href="../../d1/db0/string_8c.html#afc1587413ab4674d33ad8203e64ec21da85e23b765e100038368640a06a372b03">NEIGHBOR_FOUND</a>) {
<a name="l02843"></a>02843             c = <a class="code" href="../../d5/de3/encoding_8h.html#a7f8372dd0ada95131f8a22a4d8759d39">rb_enc_mbc_to_codepoint</a>(p, p+len, enc);
<a name="l02844"></a>02844             <span class="keywordflow">if</span> (!<a class="code" href="../../d5/de3/encoding_8h.html#a2881148c8f904fd052ae10793c111808">rb_enc_isctype</a>(c, ctype, enc)) {
<a name="l02845"></a>02845                 <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a04ab67335215e8362c63ed27ae2d1c40">MEMCPY</a>(p, save, <span class="keywordtype">char</span>, len);
<a name="l02846"></a>02846                 <span class="keywordflow">break</span>;
<a name="l02847"></a>02847             }
<a name="l02848"></a>02848         }
<a name="l02849"></a>02849         <span class="keywordflow">else</span> {
<a name="l02850"></a>02850             <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a04ab67335215e8362c63ed27ae2d1c40">MEMCPY</a>(p, save, <span class="keywordtype">char</span>, len);
<a name="l02851"></a>02851             <span class="keywordflow">break</span>;
<a name="l02852"></a>02852         }
<a name="l02853"></a>02853         range++;
<a name="l02854"></a>02854     }
<a name="l02855"></a>02855     <span class="keywordflow">if</span> (range == 1) {
<a name="l02856"></a>02856         <span class="keywordflow">return</span> <a class="code" href="../../d1/db0/string_8c.html#afc1587413ab4674d33ad8203e64ec21dab9875d2fb7421d5c1eeeecc2d5a5bc7b">NEIGHBOR_NOT_CHAR</a>;
<a name="l02857"></a>02857     }
<a name="l02858"></a>02858 
<a name="l02859"></a>02859     <span class="keywordflow">if</span> (ctype != <a class="code" href="../../d8/db3/oniguruma_8h.html#a14f0f2ce858aa271891329a3c5a9f6cb">ONIGENC_CTYPE_DIGIT</a>) {
<a name="l02860"></a>02860         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a04ab67335215e8362c63ed27ae2d1c40">MEMCPY</a>(carry, p, <span class="keywordtype">char</span>, len);
<a name="l02861"></a>02861         <span class="keywordflow">return</span> <a class="code" href="../../d1/db0/string_8c.html#afc1587413ab4674d33ad8203e64ec21daa69efe5f88edfe825766b8a7c524cb82">NEIGHBOR_WRAPPED</a>;
<a name="l02862"></a>02862     }
<a name="l02863"></a>02863 
<a name="l02864"></a>02864     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a04ab67335215e8362c63ed27ae2d1c40">MEMCPY</a>(carry, p, <span class="keywordtype">char</span>, len);
<a name="l02865"></a>02865     <a class="code" href="../../d1/db0/string_8c.html#a1e7e33c4c43b9ffdd76929b49bc3497a">enc_succ_char</a>(carry, len, enc);
<a name="l02866"></a>02866     <span class="keywordflow">return</span> <a class="code" href="../../d1/db0/string_8c.html#afc1587413ab4674d33ad8203e64ec21daa69efe5f88edfe825766b8a7c524cb82">NEIGHBOR_WRAPPED</a>;
<a name="l02867"></a>02867 }
<a name="l02868"></a>02868 
<a name="l02869"></a>02869 
<a name="l02870"></a>02870 <span class="comment">/*</span>
<a name="l02871"></a>02871 <span class="comment"> *  call-seq:</span>
<a name="l02872"></a>02872 <span class="comment"> *     str.succ   -&gt; new_str</span>
<a name="l02873"></a>02873 <span class="comment"> *     str.next   -&gt; new_str</span>
<a name="l02874"></a>02874 <span class="comment"> *</span>
<a name="l02875"></a>02875 <span class="comment"> *  Returns the successor to &lt;i&gt;str&lt;/i&gt;. The successor is calculated by</span>
<a name="l02876"></a>02876 <span class="comment"> *  incrementing characters starting from the rightmost alphanumeric (or</span>
<a name="l02877"></a>02877 <span class="comment"> *  the rightmost character if there are no alphanumerics) in the</span>
<a name="l02878"></a>02878 <span class="comment"> *  string. Incrementing a digit always results in another digit, and</span>
<a name="l02879"></a>02879 <span class="comment"> *  incrementing a letter results in another letter of the same case.</span>
<a name="l02880"></a>02880 <span class="comment"> *  Incrementing nonalphanumerics uses the underlying character set&apos;s</span>
<a name="l02881"></a>02881 <span class="comment"> *  collating sequence.</span>
<a name="l02882"></a>02882 <span class="comment"> *</span>
<a name="l02883"></a>02883 <span class="comment"> *  If the increment generates a ``carry,&apos;&apos; the character to the left of</span>
<a name="l02884"></a>02884 <span class="comment"> *  it is incremented. This process repeats until there is no carry,</span>
<a name="l02885"></a>02885 <span class="comment"> *  adding an additional character if necessary.</span>
<a name="l02886"></a>02886 <span class="comment"> *</span>
<a name="l02887"></a>02887 <span class="comment"> *     &quot;abcd&quot;.succ        #=&gt; &quot;abce&quot;</span>
<a name="l02888"></a>02888 <span class="comment"> *     &quot;THX1138&quot;.succ     #=&gt; &quot;THX1139&quot;</span>
<a name="l02889"></a>02889 <span class="comment"> *     &quot;&lt;&lt;koala&gt;&gt;&quot;.succ   #=&gt; &quot;&lt;&lt;koalb&gt;&gt;&quot;</span>
<a name="l02890"></a>02890 <span class="comment"> *     &quot;1999zzz&quot;.succ     #=&gt; &quot;2000aaa&quot;</span>
<a name="l02891"></a>02891 <span class="comment"> *     &quot;ZZZ9999&quot;.succ     #=&gt; &quot;AAAA0000&quot;</span>
<a name="l02892"></a>02892 <span class="comment"> *     &quot;***&quot;.succ         #=&gt; &quot;**+&quot;</span>
<a name="l02893"></a>02893 <span class="comment"> */</span>
<a name="l02894"></a>02894 
<a name="l02895"></a>02895 <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l02896"></a><a class="code" href="../../d1/db0/string_8c.html#a3aacc6475aa15a85760111a7d9ec9603">02896</a> <a class="code" href="../../db/d2e/intern_8h.html#af513b28149fbaaa7fecd52e514a679c2">rb_str_succ</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> orig)
<a name="l02897"></a>02897 {
<a name="l02898"></a>02898     <a class="code" href="../../d1/d7b/struct_onig_encoding_type_s_t.html">rb_encoding</a> *enc;
<a name="l02899"></a>02899     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str;
<a name="l02900"></a>02900     <span class="keywordtype">char</span> *sbeg, *s, *e, *last_alnum = 0;
<a name="l02901"></a>02901     <span class="keywordtype">int</span> c = -1;
<a name="l02902"></a>02902     <span class="keywordtype">long</span> l;
<a name="l02903"></a>02903     <span class="keywordtype">char</span> carry[<a class="code" href="../../d8/db3/oniguruma_8h.html#a5eba220c99bf5d04cfe9dc51e744b747">ONIGENC_CODE_TO_MBC_MAXLEN</a>] = <span class="stringliteral">&quot;\1&quot;</span>;
<a name="l02904"></a>02904     <span class="keywordtype">long</span> carry_pos = 0, carry_len = 1;
<a name="l02905"></a>02905     <span class="keyword">enum</span> <a class="code" href="../../d1/db0/string_8c.html#afc1587413ab4674d33ad8203e64ec21d">neighbor_char</a> neighbor = <a class="code" href="../../d1/db0/string_8c.html#afc1587413ab4674d33ad8203e64ec21da85e23b765e100038368640a06a372b03">NEIGHBOR_FOUND</a>;
<a name="l02906"></a>02906 
<a name="l02907"></a>02907     str = <a class="code" href="../../db/d2e/intern_8h.html#a70b7301e6960c402803fa81c7a0777d0">rb_str_new5</a>(orig, <a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(orig), <a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(orig));
<a name="l02908"></a>02908     <a class="code" href="../../d1/db0/string_8c.html#a52e3afb878f939e397b9443c8e082c54">rb_enc_cr_str_copy_for_substr</a>(str, orig);
<a name="l02909"></a>02909     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3bf9ab455a1e0e3e8cfc6ebabd8f12df">OBJ_INFECT</a>(str, orig);
<a name="l02910"></a>02910     <span class="keywordflow">if</span> (<a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(str) == 0) <span class="keywordflow">return</span> str;
<a name="l02911"></a>02911 
<a name="l02912"></a>02912     enc = <a class="code" href="../../d1/db0/string_8c.html#a123891f9f9b0c87d15621d93b4fa9c41">STR_ENC_GET</a>(orig);
<a name="l02913"></a>02913     sbeg = <a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(str);
<a name="l02914"></a>02914     s = e = sbeg + <a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(str);
<a name="l02915"></a>02915 
<a name="l02916"></a>02916     <span class="keywordflow">while</span> ((s = <a class="code" href="../../d5/de3/encoding_8h.html#a48a3264058189cf218f8e9dad6513c54">rb_enc_prev_char</a>(sbeg, s, e, enc)) != 0) {
<a name="l02917"></a>02917         <span class="keywordflow">if</span> (neighbor == <a class="code" href="../../d1/db0/string_8c.html#afc1587413ab4674d33ad8203e64ec21dab9875d2fb7421d5c1eeeecc2d5a5bc7b">NEIGHBOR_NOT_CHAR</a> &amp;&amp; last_alnum) {
<a name="l02918"></a>02918             <span class="keywordflow">if</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#afe0bf9496b5e0ecf253fb86072ee7ecf">ISALPHA</a>(*last_alnum) ? <a class="code" href="../../d1/dcc/bignum_8c.html#ab615ddd0d086b80219cd7e0345d6b5ef">ISDIGIT</a>(*s) :
<a name="l02919"></a>02919                 <a class="code" href="../../d1/dcc/bignum_8c.html#ab615ddd0d086b80219cd7e0345d6b5ef">ISDIGIT</a>(*last_alnum) ? <a class="code" href="../../de/de6/ruby_2ruby_8h.html#afe0bf9496b5e0ecf253fb86072ee7ecf">ISALPHA</a>(*s) : 0) {
<a name="l02920"></a>02920                 s = last_alnum;
<a name="l02921"></a>02921                 <span class="keywordflow">break</span>;
<a name="l02922"></a>02922             }
<a name="l02923"></a>02923         }
<a name="l02924"></a>02924         <span class="keywordflow">if</span> ((l = <a class="code" href="../../d5/db5/encoding_8c.html#a0c6003b6aeaed218d841974b00c95870">rb_enc_precise_mbclen</a>(s, e, enc)) &lt;= 0) <span class="keywordflow">continue</span>;
<a name="l02925"></a>02925         neighbor = <a class="code" href="../../d1/db0/string_8c.html#ab81cc324ed82c42649c5f127259c1307">enc_succ_alnum_char</a>(s, l, enc, carry);
<a name="l02926"></a>02926         <span class="keywordflow">switch</span> (neighbor) {
<a name="l02927"></a>02927           <span class="keywordflow">case</span> <a class="code" href="../../d1/db0/string_8c.html#afc1587413ab4674d33ad8203e64ec21dab9875d2fb7421d5c1eeeecc2d5a5bc7b">NEIGHBOR_NOT_CHAR</a>:
<a name="l02928"></a>02928             <span class="keywordflow">continue</span>;
<a name="l02929"></a>02929           <span class="keywordflow">case</span> <a class="code" href="../../d1/db0/string_8c.html#afc1587413ab4674d33ad8203e64ec21da85e23b765e100038368640a06a372b03">NEIGHBOR_FOUND</a>:
<a name="l02930"></a>02930             <span class="keywordflow">return</span> str;
<a name="l02931"></a>02931           <span class="keywordflow">case</span> <a class="code" href="../../d1/db0/string_8c.html#afc1587413ab4674d33ad8203e64ec21daa69efe5f88edfe825766b8a7c524cb82">NEIGHBOR_WRAPPED</a>:
<a name="l02932"></a>02932             last_alnum = s;
<a name="l02933"></a>02933             <span class="keywordflow">break</span>;
<a name="l02934"></a>02934         }
<a name="l02935"></a>02935         c = 1;
<a name="l02936"></a>02936         carry_pos = s - sbeg;
<a name="l02937"></a>02937         carry_len = l;
<a name="l02938"></a>02938     }
<a name="l02939"></a>02939     <span class="keywordflow">if</span> (c == -1) {              <span class="comment">/* str contains no alnum */</span>
<a name="l02940"></a>02940         s = e;
<a name="l02941"></a>02941         <span class="keywordflow">while</span> ((s = <a class="code" href="../../d5/de3/encoding_8h.html#a48a3264058189cf218f8e9dad6513c54">rb_enc_prev_char</a>(sbeg, s, e, enc)) != 0) {
<a name="l02942"></a>02942             <span class="keyword">enum</span> <a class="code" href="../../d1/db0/string_8c.html#afc1587413ab4674d33ad8203e64ec21d">neighbor_char</a> neighbor;
<a name="l02943"></a>02943             <span class="keywordflow">if</span> ((l = <a class="code" href="../../d5/db5/encoding_8c.html#a0c6003b6aeaed218d841974b00c95870">rb_enc_precise_mbclen</a>(s, e, enc)) &lt;= 0) <span class="keywordflow">continue</span>;
<a name="l02944"></a>02944             neighbor = <a class="code" href="../../d1/db0/string_8c.html#a1e7e33c4c43b9ffdd76929b49bc3497a">enc_succ_char</a>(s, l, enc);
<a name="l02945"></a>02945             <span class="keywordflow">if</span> (neighbor == <a class="code" href="../../d1/db0/string_8c.html#afc1587413ab4674d33ad8203e64ec21da85e23b765e100038368640a06a372b03">NEIGHBOR_FOUND</a>)
<a name="l02946"></a>02946                 <span class="keywordflow">return</span> str;
<a name="l02947"></a>02947             <span class="keywordflow">if</span> (<a class="code" href="../../d5/db5/encoding_8c.html#a0c6003b6aeaed218d841974b00c95870">rb_enc_precise_mbclen</a>(s, s+l, enc) != l) {
<a name="l02948"></a>02948                 <span class="comment">/* wrapped to \0...\0.  search next valid char. */</span>
<a name="l02949"></a>02949                 <a class="code" href="../../d1/db0/string_8c.html#a1e7e33c4c43b9ffdd76929b49bc3497a">enc_succ_char</a>(s, l, enc);
<a name="l02950"></a>02950             }
<a name="l02951"></a>02951             <span class="keywordflow">if</span> (!<a class="code" href="../../d5/de3/encoding_8h.html#a8b18a09a3055d3006c6d5baeaa6e7c72">rb_enc_asciicompat</a>(enc)) {
<a name="l02952"></a>02952                 <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a04ab67335215e8362c63ed27ae2d1c40">MEMCPY</a>(carry, s, <span class="keywordtype">char</span>, l);
<a name="l02953"></a>02953                 carry_len = l;
<a name="l02954"></a>02954             }
<a name="l02955"></a>02955             carry_pos = s - sbeg;
<a name="l02956"></a>02956         }
<a name="l02957"></a>02957     }
<a name="l02958"></a>02958     <a class="code" href="../../d1/db0/string_8c.html#ab8dafff9534eaf6545585223ada6b1c8">RESIZE_CAPA</a>(str, <a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(str) + carry_len);
<a name="l02959"></a>02959     s = <a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(str) + carry_pos;
<a name="l02960"></a>02960     <a class="code" href="../../d3/d90/missing_8h.html#a809a3e9326a0d3e5aa549b17085b057d">memmove</a>(s + carry_len, s, <a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(str) - carry_pos);
<a name="l02961"></a>02961     <a class="code" href="../../d3/d90/missing_8h.html#a809a3e9326a0d3e5aa549b17085b057d">memmove</a>(s, carry, carry_len);
<a name="l02962"></a>02962     <a class="code" href="../../d1/db0/string_8c.html#a056c7c0a74c83ccdb5a160bbdcbf8c3b">STR_SET_LEN</a>(str, <a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(str) + carry_len);
<a name="l02963"></a>02963     <a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(str)[<a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(str)] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l02964"></a>02964     <a class="code" href="../../d5/de3/encoding_8h.html#a5282c41e11a68fe310f45c9a326ae2b8">rb_enc_str_coderange</a>(str);
<a name="l02965"></a>02965     <span class="keywordflow">return</span> str;
<a name="l02966"></a>02966 }
<a name="l02967"></a>02967 
<a name="l02968"></a>02968 
<a name="l02969"></a>02969 <span class="comment">/*</span>
<a name="l02970"></a>02970 <span class="comment"> *  call-seq:</span>
<a name="l02971"></a>02971 <span class="comment"> *     str.succ!   -&gt; str</span>
<a name="l02972"></a>02972 <span class="comment"> *     str.next!   -&gt; str</span>
<a name="l02973"></a>02973 <span class="comment"> *</span>
<a name="l02974"></a>02974 <span class="comment"> *  Equivalent to &lt;code&gt;String#succ&lt;/code&gt;, but modifies the receiver in</span>
<a name="l02975"></a>02975 <span class="comment"> *  place.</span>
<a name="l02976"></a>02976 <span class="comment"> */</span>
<a name="l02977"></a>02977 
<a name="l02978"></a>02978 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l02979"></a><a class="code" href="../../d1/db0/string_8c.html#a54c29f795d752d9ee0ec36e97ae523b8">02979</a> <a class="code" href="../../d1/db0/string_8c.html#a54c29f795d752d9ee0ec36e97ae523b8">rb_str_succ_bang</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str)
<a name="l02980"></a>02980 {
<a name="l02981"></a>02981     <a class="code" href="../../db/d2e/intern_8h.html#a284132f9d055bd8adef45b71f26ee6ae">rb_str_shared_replace</a>(str, <a class="code" href="../../db/d2e/intern_8h.html#af513b28149fbaaa7fecd52e514a679c2">rb_str_succ</a>(str));
<a name="l02982"></a>02982 
<a name="l02983"></a>02983     <span class="keywordflow">return</span> str;
<a name="l02984"></a>02984 }
<a name="l02985"></a>02985 
<a name="l02986"></a>02986 
<a name="l02987"></a>02987 <span class="comment">/*</span>
<a name="l02988"></a>02988 <span class="comment"> *  call-seq:</span>
<a name="l02989"></a>02989 <span class="comment"> *     str.upto(other_str, exclusive=false) {|s| block }   -&gt; str</span>
<a name="l02990"></a>02990 <span class="comment"> *     str.upto(other_str, exclusive=false)                -&gt; an_enumerator</span>
<a name="l02991"></a>02991 <span class="comment"> *</span>
<a name="l02992"></a>02992 <span class="comment"> *  Iterates through successive values, starting at &lt;i&gt;str&lt;/i&gt; and</span>
<a name="l02993"></a>02993 <span class="comment"> *  ending at &lt;i&gt;other_str&lt;/i&gt; inclusive, passing each value in turn to</span>
<a name="l02994"></a>02994 <span class="comment"> *  the block. The &lt;code&gt;String#succ&lt;/code&gt; method is used to generate</span>
<a name="l02995"></a>02995 <span class="comment"> *  each value.  If optional second argument exclusive is omitted or is false,</span>
<a name="l02996"></a>02996 <span class="comment"> *  the last value will be included; otherwise it will be excluded.</span>
<a name="l02997"></a>02997 <span class="comment"> *</span>
<a name="l02998"></a>02998 <span class="comment"> *  If no block is given, an enumerator is returned instead.</span>
<a name="l02999"></a>02999 <span class="comment"> *</span>
<a name="l03000"></a>03000 <span class="comment"> *     &quot;a8&quot;.upto(&quot;b6&quot;) {|s| print s, &apos; &apos; }</span>
<a name="l03001"></a>03001 <span class="comment"> *     for s in &quot;a8&quot;..&quot;b6&quot;</span>
<a name="l03002"></a>03002 <span class="comment"> *       print s, &apos; &apos;</span>
<a name="l03003"></a>03003 <span class="comment"> *     end</span>
<a name="l03004"></a>03004 <span class="comment"> *</span>
<a name="l03005"></a>03005 <span class="comment"> *  &lt;em&gt;produces:&lt;/em&gt;</span>
<a name="l03006"></a>03006 <span class="comment"> *</span>
<a name="l03007"></a>03007 <span class="comment"> *     a8 a9 b0 b1 b2 b3 b4 b5 b6</span>
<a name="l03008"></a>03008 <span class="comment"> *     a8 a9 b0 b1 b2 b3 b4 b5 b6</span>
<a name="l03009"></a>03009 <span class="comment"> *</span>
<a name="l03010"></a>03010 <span class="comment"> *  If &lt;i&gt;str&lt;/i&gt; and &lt;i&gt;other_str&lt;/i&gt; contains only ascii numeric characters,</span>
<a name="l03011"></a>03011 <span class="comment"> *  both are recognized as decimal numbers. In addition, the width of</span>
<a name="l03012"></a>03012 <span class="comment"> *  string (e.g. leading zeros) is handled appropriately.</span>
<a name="l03013"></a>03013 <span class="comment"> *</span>
<a name="l03014"></a>03014 <span class="comment"> *     &quot;9&quot;.upto(&quot;11&quot;).to_a   #=&gt; [&quot;9&quot;, &quot;10&quot;, &quot;11&quot;]</span>
<a name="l03015"></a>03015 <span class="comment"> *     &quot;25&quot;.upto(&quot;5&quot;).to_a   #=&gt; []</span>
<a name="l03016"></a>03016 <span class="comment"> *     &quot;07&quot;.upto(&quot;11&quot;).to_a  #=&gt; [&quot;07&quot;, &quot;08&quot;, &quot;09&quot;, &quot;10&quot;, &quot;11&quot;]</span>
<a name="l03017"></a>03017 <span class="comment"> */</span>
<a name="l03018"></a>03018 
<a name="l03019"></a>03019 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l03020"></a><a class="code" href="../../d1/db0/string_8c.html#ad375ec53c02941aa740b1915bc0767be">03020</a> <a class="code" href="../../d1/db0/string_8c.html#ad375ec53c02941aa740b1915bc0767be">rb_str_upto</a>(<span class="keywordtype">int</span> <a class="code" href="../../df/d77/ruby_8c.html#ad1447518f4372828b8435ae82e48499e">argc</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> *<a class="code" href="../../df/d77/ruby_8c.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> beg)
<a name="l03021"></a>03021 {
<a name="l03022"></a>03022     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> end, exclusive;
<a name="l03023"></a>03023     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> current, after_end;
<a name="l03024"></a>03024     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#afa5b9137f051ac26d7ccc8824f178233">ID</a> succ;
<a name="l03025"></a>03025     <span class="keywordtype">int</span> n, excl, ascii;
<a name="l03026"></a>03026     <a class="code" href="../../d1/d7b/struct_onig_encoding_type_s_t.html">rb_encoding</a> *enc;
<a name="l03027"></a>03027 
<a name="l03028"></a>03028     <a class="code" href="../../d7/d19/group__defmethod.html#gaa7bed88640f01bee619f85fda09d28d7">rb_scan_args</a>(argc, argv, <span class="stringliteral">&quot;11&quot;</span>, &amp;end, &amp;exclusive);
<a name="l03029"></a>03029     <a class="code" href="../../db/d2e/intern_8h.html#ad174dd963d99ac27a67c8ef9cfa1eb58">RETURN_ENUMERATOR</a>(beg, argc, argv);
<a name="l03030"></a>03030     excl = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a117741045763c090b26e30a85bd0e0a6">RTEST</a>(exclusive);
<a name="l03031"></a>03031     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aa50b9d5bc665eb5545f6857c89232161">CONST_ID</a>(succ, <span class="stringliteral">&quot;succ&quot;</span>);
<a name="l03032"></a>03032     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a0e80f207eb41e9010ec9f0f5f9419fea">StringValue</a>(end);
<a name="l03033"></a>03033     enc = <a class="code" href="../../d5/db5/encoding_8c.html#a7d17d602fae27de649f9310511c03db0">rb_enc_check</a>(beg, end);
<a name="l03034"></a>03034     ascii = (<a class="code" href="../../d1/db0/string_8c.html#a053ebe2487386654339f4de623e5d3a2">is_ascii_string</a>(beg) &amp;&amp; <a class="code" href="../../d1/db0/string_8c.html#a053ebe2487386654339f4de623e5d3a2">is_ascii_string</a>(end));
<a name="l03035"></a>03035     <span class="comment">/* single character */</span>
<a name="l03036"></a>03036     <span class="keywordflow">if</span> (<a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(beg) == 1 &amp;&amp; <a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(end) == 1 &amp;&amp; ascii) {
<a name="l03037"></a>03037         <span class="keywordtype">char</span> c = <a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(beg)[0];
<a name="l03038"></a>03038         <span class="keywordtype">char</span> e = <a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(end)[0];
<a name="l03039"></a>03039 
<a name="l03040"></a>03040         <span class="keywordflow">if</span> (c &gt; e || (excl &amp;&amp; c == e)) <span class="keywordflow">return</span> beg;
<a name="l03041"></a>03041         <span class="keywordflow">for</span> (;;) {
<a name="l03042"></a>03042             <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ae6bd0c4ea4db971ebd569ca8f05c6b4a">rb_yield</a>(<a class="code" href="../../d5/de3/encoding_8h.html#a6707b730597e0e614213beb11670aca2">rb_enc_str_new</a>(&amp;c, 1, enc));
<a name="l03043"></a>03043             <span class="keywordflow">if</span> (!excl &amp;&amp; c == e) <span class="keywordflow">break</span>;
<a name="l03044"></a>03044             c++;
<a name="l03045"></a>03045             <span class="keywordflow">if</span> (excl &amp;&amp; c == e) <span class="keywordflow">break</span>;
<a name="l03046"></a>03046         }
<a name="l03047"></a>03047         <span class="keywordflow">return</span> beg;
<a name="l03048"></a>03048     }
<a name="l03049"></a>03049     <span class="comment">/* both edges are all digits */</span>
<a name="l03050"></a>03050     <span class="keywordflow">if</span> (ascii &amp;&amp; <a class="code" href="../../d1/dcc/bignum_8c.html#ab615ddd0d086b80219cd7e0345d6b5ef">ISDIGIT</a>(<a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(beg)[0]) &amp;&amp; <a class="code" href="../../d1/dcc/bignum_8c.html#ab615ddd0d086b80219cd7e0345d6b5ef">ISDIGIT</a>(<a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(end)[0])) {
<a name="l03051"></a>03051         <span class="keywordtype">char</span> *s, *send;
<a name="l03052"></a>03052         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> b, e;
<a name="l03053"></a>03053         <span class="keywordtype">int</span> width;
<a name="l03054"></a>03054 
<a name="l03055"></a>03055         s = <a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(beg); send = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a35bfa2635774977edad0a16b9fdebbaf">RSTRING_END</a>(beg);
<a name="l03056"></a>03056         width = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a89cfdffb96d481ecc590bd4f206f2e94">rb_long2int</a>(send - s);
<a name="l03057"></a>03057         <span class="keywordflow">while</span> (s &lt; send) {
<a name="l03058"></a>03058             <span class="keywordflow">if</span> (!<a class="code" href="../../d1/dcc/bignum_8c.html#ab615ddd0d086b80219cd7e0345d6b5ef">ISDIGIT</a>(*s)) <span class="keywordflow">goto</span> <a class="code" href="../../d5/d11/ripper_8c.html#a4109fdcadec8be93f3e91500b5f46fe4">no_digits</a>;
<a name="l03059"></a>03059             s++;
<a name="l03060"></a>03060         }
<a name="l03061"></a>03061         s = <a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(end); send = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a35bfa2635774977edad0a16b9fdebbaf">RSTRING_END</a>(end);
<a name="l03062"></a>03062         <span class="keywordflow">while</span> (s &lt; send) {
<a name="l03063"></a>03063             <span class="keywordflow">if</span> (!<a class="code" href="../../d1/dcc/bignum_8c.html#ab615ddd0d086b80219cd7e0345d6b5ef">ISDIGIT</a>(*s)) <span class="keywordflow">goto</span> <a class="code" href="../../d5/d11/ripper_8c.html#a4109fdcadec8be93f3e91500b5f46fe4">no_digits</a>;
<a name="l03064"></a>03064             s++;
<a name="l03065"></a>03065         }
<a name="l03066"></a>03066         b = <a class="code" href="../../d1/dcc/bignum_8c.html#a3c364897a7c673caf46ccdbf62536a07">rb_str_to_inum</a>(beg, 10, <a class="code" href="../../d1/d5c/nkf_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>);
<a name="l03067"></a>03067         e = <a class="code" href="../../d1/dcc/bignum_8c.html#a3c364897a7c673caf46ccdbf62536a07">rb_str_to_inum</a>(end, 10, <a class="code" href="../../d1/d5c/nkf_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>);
<a name="l03068"></a>03068         <span class="keywordflow">if</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#acf2fcf97dcf9c7c35452730eb3e2aeb2">FIXNUM_P</a>(b) &amp;&amp; <a class="code" href="../../de/de6/ruby_2ruby_8h.html#acf2fcf97dcf9c7c35452730eb3e2aeb2">FIXNUM_P</a>(e)) {
<a name="l03069"></a>03069             <span class="keywordtype">long</span> bi = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ae9390780cd6d04a2e0ac3d6282cdefea">FIX2LONG</a>(b);
<a name="l03070"></a>03070             <span class="keywordtype">long</span> ei = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ae9390780cd6d04a2e0ac3d6282cdefea">FIX2LONG</a>(e);
<a name="l03071"></a>03071             <a class="code" href="../../d1/d7b/struct_onig_encoding_type_s_t.html">rb_encoding</a> *usascii = <a class="code" href="../../d5/db5/encoding_8c.html#a1e215012f16414c044f6a212973c95a8">rb_usascii_encoding</a>();
<a name="l03072"></a>03072 
<a name="l03073"></a>03073             <span class="keywordflow">while</span> (bi &lt;= ei) {
<a name="l03074"></a>03074                 <span class="keywordflow">if</span> (excl &amp;&amp; bi == ei) <span class="keywordflow">break</span>;
<a name="l03075"></a>03075                 <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ae6bd0c4ea4db971ebd569ca8f05c6b4a">rb_yield</a>(<a class="code" href="../../d9/d2d/sprintf_8c.html#a216ef515f4c79ee337820c5f637b802c">rb_enc_sprintf</a>(usascii, <span class="stringliteral">&quot;%.*ld&quot;</span>, width, bi));
<a name="l03076"></a>03076                 bi++;
<a name="l03077"></a>03077             }
<a name="l03078"></a>03078         }
<a name="l03079"></a>03079         <span class="keywordflow">else</span> {
<a name="l03080"></a>03080             <a class="code" href="../../de/de6/ruby_2ruby_8h.html#afa5b9137f051ac26d7ccc8824f178233">ID</a> op = excl ? <span class="charliteral">&apos;&lt;&apos;</span> : <a class="code" href="../../dc/dcc/array_8c.html#a9cfa42d4b79c89d68c53be8b2150a503">rb_intern</a>(<span class="stringliteral">&quot;&lt;=&quot;</span>);
<a name="l03081"></a>03081             <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <a class="code" href="../../d3/d09/ripper_8y.html#a8187411843a6284ffb964ef3fb9fcab3">args</a>[2], fmt = <a class="code" href="../../db/d2e/intern_8h.html#a8ea3742679211f408cb5769de6cf0d46">rb_obj_freeze</a>(<a class="code" href="../../db/d2e/intern_8h.html#a14cee14f3a9a89e96144482560957ea0">rb_usascii_str_new_cstr</a>(<span class="stringliteral">&quot;%.*d&quot;</span>));
<a name="l03082"></a>03082 
<a name="l03083"></a>03083             args[0] = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(width);
<a name="l03084"></a>03084             <span class="keywordflow">while</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a6a973fe624aa9aa9ba0cdeb6792d3187" title="Calls a method.">rb_funcall</a>(b, op, 1, e)) {
<a name="l03085"></a>03085                 args[1] = b;
<a name="l03086"></a>03086                 <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ae6bd0c4ea4db971ebd569ca8f05c6b4a">rb_yield</a>(<a class="code" href="../../db/d2e/intern_8h.html#a48d7c050a9e0cabd779b9f639dfdbe43">rb_str_format</a>(<a class="code" href="../../dc/dcc/array_8c.html#a4ac8fee05a285361c33a2b0d9c2d555c">numberof</a>(args), args, fmt));
<a name="l03087"></a>03087                 b = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a6a973fe624aa9aa9ba0cdeb6792d3187" title="Calls a method.">rb_funcall</a>(b, succ, 0, 0);
<a name="l03088"></a>03088             }
<a name="l03089"></a>03089         }
<a name="l03090"></a>03090         <span class="keywordflow">return</span> beg;
<a name="l03091"></a>03091     }
<a name="l03092"></a>03092     <span class="comment">/* normal case */</span>
<a name="l03093"></a>03093   <a class="code" href="../../d5/d11/ripper_8c.html#a4109fdcadec8be93f3e91500b5f46fe4">no_digits</a>:
<a name="l03094"></a>03094     n = <a class="code" href="../../db/d2e/intern_8h.html#aabbf48d0162ce9a462b13b71ccf683a5">rb_str_cmp</a>(beg, end);
<a name="l03095"></a>03095     <span class="keywordflow">if</span> (n &gt; 0 || (excl &amp;&amp; n == 0)) <span class="keywordflow">return</span> beg;
<a name="l03096"></a>03096 
<a name="l03097"></a>03097     after_end = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a6a973fe624aa9aa9ba0cdeb6792d3187" title="Calls a method.">rb_funcall</a>(end, succ, 0, 0);
<a name="l03098"></a>03098     current = <a class="code" href="../../db/d2e/intern_8h.html#ae2843c766c24b80116bb127ebf22d5bf">rb_str_dup</a>(beg);
<a name="l03099"></a>03099     <span class="keywordflow">while</span> (!<a class="code" href="../../db/d2e/intern_8h.html#a879d55791d2df05df7f63943ae7ff276">rb_str_equal</a>(current, after_end)) {
<a name="l03100"></a>03100         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> next = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a320970f989dc8294c8203154e3db40c1">Qnil</a>;
<a name="l03101"></a>03101         <span class="keywordflow">if</span> (excl || !<a class="code" href="../../db/d2e/intern_8h.html#a879d55791d2df05df7f63943ae7ff276">rb_str_equal</a>(current, end))
<a name="l03102"></a>03102             next = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a6a973fe624aa9aa9ba0cdeb6792d3187" title="Calls a method.">rb_funcall</a>(current, succ, 0, 0);
<a name="l03103"></a>03103         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ae6bd0c4ea4db971ebd569ca8f05c6b4a">rb_yield</a>(current);
<a name="l03104"></a>03104         <span class="keywordflow">if</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a4832bad8845a35fc50f7a160901854a1">NIL_P</a>(next)) <span class="keywordflow">break</span>;
<a name="l03105"></a>03105         current = next;
<a name="l03106"></a>03106         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a0e80f207eb41e9010ec9f0f5f9419fea">StringValue</a>(current);
<a name="l03107"></a>03107         <span class="keywordflow">if</span> (excl &amp;&amp; <a class="code" href="../../db/d2e/intern_8h.html#a879d55791d2df05df7f63943ae7ff276">rb_str_equal</a>(current, end)) <span class="keywordflow">break</span>;
<a name="l03108"></a>03108         <span class="keywordflow">if</span> (<a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(current) &gt; <a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(end) || <a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(current) == 0)
<a name="l03109"></a>03109             <span class="keywordflow">break</span>;
<a name="l03110"></a>03110     }
<a name="l03111"></a>03111 
<a name="l03112"></a>03112     <span class="keywordflow">return</span> beg;
<a name="l03113"></a>03113 }
<a name="l03114"></a>03114 
<a name="l03115"></a>03115 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l03116"></a><a class="code" href="../../d1/db0/string_8c.html#ac0339e2068ff0835aa73f8739841dba8">03116</a> <a class="code" href="../../d1/db0/string_8c.html#ac0339e2068ff0835aa73f8739841dba8">rb_str_subpat</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> re, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> backref)
<a name="l03117"></a>03117 {
<a name="l03118"></a>03118     <span class="keywordflow">if</span> (<a class="code" href="../../db/db6/re_8h.html#afdf554fa234aebc803c8a4fc98c9936f">rb_reg_search</a>(re, str, 0, 0) &gt;= 0) {
<a name="l03119"></a>03119         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <a class="code" href="../../dd/d9f/date__parse_8c.html#aafe6a0803e756e59e5af70fdb2dcc912">match</a> = <a class="code" href="../../db/d2e/intern_8h.html#a2590f9272c0599ff0d1922bd0fb6efce">rb_backref_get</a>();
<a name="l03120"></a>03120         <span class="keywordtype">int</span> nth = <a class="code" href="../../db/d2e/intern_8h.html#a025e4673321d82a1ab18e1570849ca66">rb_reg_backref_number</a>(match, backref);
<a name="l03121"></a>03121         <span class="keywordflow">return</span> <a class="code" href="../../db/d2e/intern_8h.html#ac50ab731365028f5efab69c001fba39d">rb_reg_nth_match</a>(nth, match);
<a name="l03122"></a>03122     }
<a name="l03123"></a>03123     <span class="keywordflow">return</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a320970f989dc8294c8203154e3db40c1">Qnil</a>;
<a name="l03124"></a>03124 }
<a name="l03125"></a>03125 
<a name="l03126"></a>03126 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l03127"></a><a class="code" href="../../d1/db0/string_8c.html#a8259dcc306c1af26b14ebded45f0b777">03127</a> <a class="code" href="../../d1/db0/string_8c.html#a8259dcc306c1af26b14ebded45f0b777">rb_str_aref</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> indx)
<a name="l03128"></a>03128 {
<a name="l03129"></a>03129     <span class="keywordtype">long</span> idx;
<a name="l03130"></a>03130 
<a name="l03131"></a>03131     <span class="keywordflow">switch</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a394faf7191f18552a20cb17ce14226f0">TYPE</a>(indx)) {
<a name="l03132"></a>03132       <span class="keywordflow">case</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a523855de5546c34061e030f4606db3e9">T_FIXNUM</a>:
<a name="l03133"></a>03133         idx = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ae9390780cd6d04a2e0ac3d6282cdefea">FIX2LONG</a>(indx);
<a name="l03134"></a>03134 
<a name="l03135"></a>03135       num_index:
<a name="l03136"></a>03136         str = <a class="code" href="../../db/d2e/intern_8h.html#a61efad31b183f52fe068b4c0daf8fdd9">rb_str_substr</a>(str, idx, 1);
<a name="l03137"></a>03137         <span class="keywordflow">if</span> (!<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a4832bad8845a35fc50f7a160901854a1">NIL_P</a>(str) &amp;&amp; <a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(str) == 0) <span class="keywordflow">return</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a320970f989dc8294c8203154e3db40c1">Qnil</a>;
<a name="l03138"></a>03138         <span class="keywordflow">return</span> str;
<a name="l03139"></a>03139 
<a name="l03140"></a>03140       <span class="keywordflow">case</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#afd5c1e36d171ecc04514332e8dcf6388">T_REGEXP</a>:
<a name="l03141"></a>03141         <span class="keywordflow">return</span> <a class="code" href="../../d1/db0/string_8c.html#ac0339e2068ff0835aa73f8739841dba8">rb_str_subpat</a>(str, indx, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(0));
<a name="l03142"></a>03142 
<a name="l03143"></a>03143       <span class="keywordflow">case</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a22a8c2a4bbaae9b68f65c9bb92fd4e39">T_STRING</a>:
<a name="l03144"></a>03144         <span class="keywordflow">if</span> (<a class="code" href="../../d1/db0/string_8c.html#a44f92eec2a74155cc1bb3445e7cacaf1">rb_str_index</a>(str, indx, 0) != -1)
<a name="l03145"></a>03145             <span class="keywordflow">return</span> <a class="code" href="../../db/d2e/intern_8h.html#ae2843c766c24b80116bb127ebf22d5bf">rb_str_dup</a>(indx);
<a name="l03146"></a>03146         <span class="keywordflow">return</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a320970f989dc8294c8203154e3db40c1">Qnil</a>;
<a name="l03147"></a>03147 
<a name="l03148"></a>03148       <span class="keywordflow">default</span>:
<a name="l03149"></a>03149         <span class="comment">/* check if indx is Range */</span>
<a name="l03150"></a>03150         {
<a name="l03151"></a>03151             <span class="keywordtype">long</span> beg, len;
<a name="l03152"></a>03152             <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> tmp;
<a name="l03153"></a>03153 
<a name="l03154"></a>03154             len = <a class="code" href="../../d1/db0/string_8c.html#abe68504f1d38108a10f267f4358c53db">str_strlen</a>(str, <a class="code" href="../../d1/db0/string_8c.html#a123891f9f9b0c87d15621d93b4fa9c41">STR_ENC_GET</a>(str));
<a name="l03155"></a>03155             <span class="keywordflow">switch</span> (<a class="code" href="../../db/d2e/intern_8h.html#a2f31a8c5a891cd7eb0c42ed0b385091b">rb_range_beg_len</a>(indx, &amp;beg, &amp;len, len, 0)) {
<a name="l03156"></a>03156               <span class="keywordflow">case</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aba0717d2689eb68797421a02ab9295c6">Qfalse</a>:
<a name="l03157"></a>03157                 <span class="keywordflow">break</span>;
<a name="l03158"></a>03158               <span class="keywordflow">case</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a320970f989dc8294c8203154e3db40c1">Qnil</a>:
<a name="l03159"></a>03159                 <span class="keywordflow">return</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a320970f989dc8294c8203154e3db40c1">Qnil</a>;
<a name="l03160"></a>03160               <span class="keywordflow">default</span>:
<a name="l03161"></a>03161                 tmp = <a class="code" href="../../db/d2e/intern_8h.html#a61efad31b183f52fe068b4c0daf8fdd9">rb_str_substr</a>(str, beg, len);
<a name="l03162"></a>03162                 <span class="keywordflow">return</span> tmp;
<a name="l03163"></a>03163             }
<a name="l03164"></a>03164         }
<a name="l03165"></a>03165         idx = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a93f154f3dcc08027f475bf0c3cc287bd">NUM2LONG</a>(indx);
<a name="l03166"></a>03166         <span class="keywordflow">goto</span> num_index;
<a name="l03167"></a>03167     }
<a name="l03168"></a>03168     <span class="keywordflow">return</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a320970f989dc8294c8203154e3db40c1">Qnil</a>;                <span class="comment">/* not reached */</span>
<a name="l03169"></a>03169 }
<a name="l03170"></a>03170 
<a name="l03171"></a>03171 
<a name="l03172"></a>03172 <span class="comment">/*</span>
<a name="l03173"></a>03173 <span class="comment"> *  call-seq:</span>
<a name="l03174"></a>03174 <span class="comment"> *     str[fixnum]                 -&gt; new_str or nil</span>
<a name="l03175"></a>03175 <span class="comment"> *     str[fixnum, fixnum]         -&gt; new_str or nil</span>
<a name="l03176"></a>03176 <span class="comment"> *     str[range]                  -&gt; new_str or nil</span>
<a name="l03177"></a>03177 <span class="comment"> *     str[regexp]                 -&gt; new_str or nil</span>
<a name="l03178"></a>03178 <span class="comment"> *     str[regexp, fixnum]         -&gt; new_str or nil</span>
<a name="l03179"></a>03179 <span class="comment"> *     str[other_str]              -&gt; new_str or nil</span>
<a name="l03180"></a>03180 <span class="comment"> *     str.slice(fixnum)           -&gt; new_str or nil</span>
<a name="l03181"></a>03181 <span class="comment"> *     str.slice(fixnum, fixnum)   -&gt; new_str or nil</span>
<a name="l03182"></a>03182 <span class="comment"> *     str.slice(range)            -&gt; new_str or nil</span>
<a name="l03183"></a>03183 <span class="comment"> *     str.slice(regexp)           -&gt; new_str or nil</span>
<a name="l03184"></a>03184 <span class="comment"> *     str.slice(regexp, fixnum)   -&gt; new_str or nil</span>
<a name="l03185"></a>03185 <span class="comment"> *     str.slice(regexp, capname)  -&gt; new_str or nil</span>
<a name="l03186"></a>03186 <span class="comment"> *     str.slice(other_str)        -&gt; new_str or nil</span>
<a name="l03187"></a>03187 <span class="comment"> *</span>
<a name="l03188"></a>03188 <span class="comment"> *  Element Reference---If passed a single &lt;code&gt;Fixnum&lt;/code&gt;, returns a</span>
<a name="l03189"></a>03189 <span class="comment"> *  substring of one character at that position. If passed two &lt;code&gt;Fixnum&lt;/code&gt;</span>
<a name="l03190"></a>03190 <span class="comment"> *  objects, returns a substring starting at the offset given by the first, and</span>
<a name="l03191"></a>03191 <span class="comment"> *  with a length given by the second. If passed a range, its beginning and end</span>
<a name="l03192"></a>03192 <span class="comment"> *  are interpreted as offsets delimiting the substring to be returned. In all</span>
<a name="l03193"></a>03193 <span class="comment"> *  three cases, if an offset is negative, it is counted from the end of &lt;i&gt;str&lt;/i&gt;.</span>
<a name="l03194"></a>03194 <span class="comment"> *  Returns &lt;code&gt;nil&lt;/code&gt; if the initial offset falls outside the string or</span>
<a name="l03195"></a>03195 <span class="comment"> *  the length is negative.</span>
<a name="l03196"></a>03196 <span class="comment"> *</span>
<a name="l03197"></a>03197 <span class="comment"> *  If a &lt;code&gt;Regexp&lt;/code&gt; is supplied, the matching portion of &lt;i&gt;str&lt;/i&gt; is</span>
<a name="l03198"></a>03198 <span class="comment"> *  returned. If a numeric or name parameter follows the regular expression, that</span>
<a name="l03199"></a>03199 <span class="comment"> *  component of the &lt;code&gt;MatchData&lt;/code&gt; is returned instead. If a</span>
<a name="l03200"></a>03200 <span class="comment"> *  &lt;code&gt;String&lt;/code&gt; is given, that string is returned if it occurs in</span>
<a name="l03201"></a>03201 <span class="comment"> *  &lt;i&gt;str&lt;/i&gt;. In both cases, &lt;code&gt;nil&lt;/code&gt; is returned if there is no</span>
<a name="l03202"></a>03202 <span class="comment"> *  match.</span>
<a name="l03203"></a>03203 <span class="comment"> *</span>
<a name="l03204"></a>03204 <span class="comment"> *     a = &quot;hello there&quot;</span>
<a name="l03205"></a>03205 <span class="comment"> *     a[1]                   #=&gt; &quot;e&quot;</span>
<a name="l03206"></a>03206 <span class="comment"> *     a[2, 3]                #=&gt; &quot;llo&quot;</span>
<a name="l03207"></a>03207 <span class="comment"> *     a[2..3]                #=&gt; &quot;ll&quot;</span>
<a name="l03208"></a>03208 <span class="comment"> *     a[-3, 2]               #=&gt; &quot;er&quot;</span>
<a name="l03209"></a>03209 <span class="comment"> *     a[7..-2]               #=&gt; &quot;her&quot;</span>
<a name="l03210"></a>03210 <span class="comment"> *     a[-4..-2]              #=&gt; &quot;her&quot;</span>
<a name="l03211"></a>03211 <span class="comment"> *     a[-2..-4]              #=&gt; &quot;&quot;</span>
<a name="l03212"></a>03212 <span class="comment"> *     a[12..-1]              #=&gt; nil</span>
<a name="l03213"></a>03213 <span class="comment"> *     a[/[aeiou](.)\1/]      #=&gt; &quot;ell&quot;</span>
<a name="l03214"></a>03214 <span class="comment"> *     a[/[aeiou](.)\1/, 0]   #=&gt; &quot;ell&quot;</span>
<a name="l03215"></a>03215 <span class="comment"> *     a[/[aeiou](.)\1/, 1]   #=&gt; &quot;l&quot;</span>
<a name="l03216"></a>03216 <span class="comment"> *     a[/[aeiou](.)\1/, 2]   #=&gt; nil</span>
<a name="l03217"></a>03217 <span class="comment"> *     a[&quot;lo&quot;]                #=&gt; &quot;lo&quot;</span>
<a name="l03218"></a>03218 <span class="comment"> *     a[&quot;bye&quot;]               #=&gt; nil</span>
<a name="l03219"></a>03219 <span class="comment"> */</span>
<a name="l03220"></a>03220 
<a name="l03221"></a>03221 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l03222"></a><a class="code" href="../../d1/db0/string_8c.html#aa5327105773f1bfb1799f4a6b04587e7">03222</a> <a class="code" href="../../d1/db0/string_8c.html#aa5327105773f1bfb1799f4a6b04587e7">rb_str_aref_m</a>(<span class="keywordtype">int</span> <a class="code" href="../../df/d77/ruby_8c.html#ad1447518f4372828b8435ae82e48499e">argc</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> *<a class="code" href="../../df/d77/ruby_8c.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str)
<a name="l03223"></a>03223 {
<a name="l03224"></a>03224     <span class="keywordflow">if</span> (argc == 2) {
<a name="l03225"></a>03225         <span class="keywordflow">if</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a394faf7191f18552a20cb17ce14226f0">TYPE</a>(argv[0]) == <a class="code" href="../../de/de6/ruby_2ruby_8h.html#afd5c1e36d171ecc04514332e8dcf6388">T_REGEXP</a>) {
<a name="l03226"></a>03226             <span class="keywordflow">return</span> <a class="code" href="../../d1/db0/string_8c.html#ac0339e2068ff0835aa73f8739841dba8">rb_str_subpat</a>(str, argv[0], argv[1]);
<a name="l03227"></a>03227         }
<a name="l03228"></a>03228         <span class="keywordflow">return</span> <a class="code" href="../../db/d2e/intern_8h.html#a61efad31b183f52fe068b4c0daf8fdd9">rb_str_substr</a>(str, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a93f154f3dcc08027f475bf0c3cc287bd">NUM2LONG</a>(argv[0]), <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a93f154f3dcc08027f475bf0c3cc287bd">NUM2LONG</a>(argv[1]));
<a name="l03229"></a>03229     }
<a name="l03230"></a>03230     <span class="keywordflow">if</span> (argc != 1) {
<a name="l03231"></a>03231         <a class="code" href="../../db/dcc/error_8c.html#a0f771a2840561f1838169b3d7d4616f3">rb_raise</a>(<a class="code" href="../../db/dcc/error_8c.html#ab5e2a9fec766c75176fbb262bfe6a596">rb_eArgError</a>, <span class="stringliteral">&quot;wrong number of arguments (%d for 1..2)&quot;</span>, argc);
<a name="l03232"></a>03232     }
<a name="l03233"></a>03233     <span class="keywordflow">return</span> <a class="code" href="../../d1/db0/string_8c.html#a8259dcc306c1af26b14ebded45f0b777">rb_str_aref</a>(str, argv[0]);
<a name="l03234"></a>03234 }
<a name="l03235"></a>03235 
<a name="l03236"></a>03236 <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l03237"></a><a class="code" href="../../d1/db0/string_8c.html#af40fa69c701d61d3d8e9d5fdf73932eb">03237</a> <a class="code" href="../../db/d2e/intern_8h.html#abf3be2f0a5fdf9ab341a748201c9ffd9">rb_str_drop_bytes</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str, <span class="keywordtype">long</span> len)
<a name="l03238"></a>03238 {
<a name="l03239"></a>03239     <span class="keywordtype">char</span> *ptr = <a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(str);
<a name="l03240"></a>03240     <span class="keywordtype">long</span> olen = <a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(str), nlen;
<a name="l03241"></a>03241 
<a name="l03242"></a>03242     <a class="code" href="../../d1/db0/string_8c.html#a865d4f66b7c8fca1f7fd9afa3298a56e">str_modifiable</a>(str);
<a name="l03243"></a>03243     <span class="keywordflow">if</span> (len &gt; olen) len = olen;
<a name="l03244"></a>03244     nlen = olen - len;
<a name="l03245"></a>03245     <span class="keywordflow">if</span> (nlen &lt;= <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a92657ad1be8a8a323df19648e33b47b5">RSTRING_EMBED_LEN_MAX</a>) {
<a name="l03246"></a>03246         <span class="keywordtype">char</span> *oldptr = ptr;
<a name="l03247"></a>03247         <span class="keywordtype">int</span> fl = (int)(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a1d4c05021aacd8cab989ff60f95ebe2d">RBASIC</a>(str)-&gt;flags &amp; (<a class="code" href="../../d1/db0/string_8c.html#ac8d3bdd1bdb620a40ed913619cdc7c6b">STR_NOEMBED</a>|<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a4f77ed51d02515ee27ce9fca7880ce8f">ELTS_SHARED</a>));
<a name="l03248"></a>03248         <a class="code" href="../../d1/db0/string_8c.html#a598a41ca866cde6d9854bf77f48b006d">STR_SET_EMBED</a>(str);
<a name="l03249"></a>03249         <a class="code" href="../../d1/db0/string_8c.html#ac1f52d89a2e4d0dda456490dcfe70993">STR_SET_EMBED_LEN</a>(str, nlen);
<a name="l03250"></a>03250         ptr = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac695b0c61b18410ebcf22584fe0a6f6f">RSTRING</a>(str)-&gt;as.ary;
<a name="l03251"></a>03251         <a class="code" href="../../d3/d90/missing_8h.html#a809a3e9326a0d3e5aa549b17085b057d">memmove</a>(ptr, oldptr + len, nlen);
<a name="l03252"></a>03252         <span class="keywordflow">if</span> (fl == <a class="code" href="../../d1/db0/string_8c.html#ac8d3bdd1bdb620a40ed913619cdc7c6b">STR_NOEMBED</a>) <a class="code" href="../../d8/db0/defines_8h.html#a2c3897f7c46ca54a2e0dd7b24a40c7cb">xfree</a>(oldptr);
<a name="l03253"></a>03253     }
<a name="l03254"></a>03254     <span class="keywordflow">else</span> {
<a name="l03255"></a>03255         <span class="keywordflow">if</span> (!<a class="code" href="../../d1/db0/string_8c.html#a47a46c073102a116dc86fbe598a8694e">STR_SHARED_P</a>(str)) <a class="code" href="../../db/d2e/intern_8h.html#af609add406b0ef084a38f6dd615119d6">rb_str_new4</a>(str);
<a name="l03256"></a>03256         ptr = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac695b0c61b18410ebcf22584fe0a6f6f">RSTRING</a>(str)-&gt;as.heap.ptr += len;
<a name="l03257"></a>03257         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac695b0c61b18410ebcf22584fe0a6f6f">RSTRING</a>(str)-&gt;as.heap.len = nlen;
<a name="l03258"></a>03258     }
<a name="l03259"></a>03259     ptr[nlen] = 0;
<a name="l03260"></a>03260     <a class="code" href="../../d5/de3/encoding_8h.html#ae0d61803f8b4b76dab41851f686c6a19">ENC_CODERANGE_CLEAR</a>(str);
<a name="l03261"></a>03261     <span class="keywordflow">return</span> str;
<a name="l03262"></a>03262 }
<a name="l03263"></a>03263 
<a name="l03264"></a>03264 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l03265"></a><a class="code" href="../../d1/db0/string_8c.html#ac20d8d67e0c215e6c9944b9cc7e2d3ef">03265</a> <a class="code" href="../../d1/db0/string_8c.html#ac20d8d67e0c215e6c9944b9cc7e2d3ef">rb_str_splice_0</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str, <span class="keywordtype">long</span> beg, <span class="keywordtype">long</span> len, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> val)
<a name="l03266"></a>03266 {
<a name="l03267"></a>03267     <span class="keywordflow">if</span> (beg == 0 &amp;&amp; <a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(val) == 0) {
<a name="l03268"></a>03268         <a class="code" href="../../db/d2e/intern_8h.html#abf3be2f0a5fdf9ab341a748201c9ffd9">rb_str_drop_bytes</a>(str, len);
<a name="l03269"></a>03269         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3bf9ab455a1e0e3e8cfc6ebabd8f12df">OBJ_INFECT</a>(str, val);
<a name="l03270"></a>03270         <span class="keywordflow">return</span>;
<a name="l03271"></a>03271     }
<a name="l03272"></a>03272 
<a name="l03273"></a>03273     <a class="code" href="../../db/d2e/intern_8h.html#a63a6d05687cf812131dce11743581b9d">rb_str_modify</a>(str);
<a name="l03274"></a>03274     <span class="keywordflow">if</span> (len &lt; <a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(val)) {
<a name="l03275"></a>03275         <span class="comment">/* expand string */</span>
<a name="l03276"></a>03276         <a class="code" href="../../d1/db0/string_8c.html#ab8dafff9534eaf6545585223ada6b1c8">RESIZE_CAPA</a>(str, <a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(str) + <a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(val) - len + 1);
<a name="l03277"></a>03277     }
<a name="l03278"></a>03278 
<a name="l03279"></a>03279     <span class="keywordflow">if</span> (<a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(val) != len) {
<a name="l03280"></a>03280         <a class="code" href="../../d3/d90/missing_8h.html#a809a3e9326a0d3e5aa549b17085b057d">memmove</a>(<a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(str) + beg + <a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(val),
<a name="l03281"></a>03281                 <a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(str) + beg + len,
<a name="l03282"></a>03282                 <a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(str) - (beg + len));
<a name="l03283"></a>03283     }
<a name="l03284"></a>03284     <span class="keywordflow">if</span> (<a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(val) &lt; beg &amp;&amp; len &lt; 0) {
<a name="l03285"></a>03285         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a56d620b94b668ed7665d1616b2c54e48">MEMZERO</a>(<a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(str) + <a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(str), <span class="keywordtype">char</span>, -len);
<a name="l03286"></a>03286     }
<a name="l03287"></a>03287     <span class="keywordflow">if</span> (<a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(val) &gt; 0) {
<a name="l03288"></a>03288         <a class="code" href="../../d3/d90/missing_8h.html#a809a3e9326a0d3e5aa549b17085b057d">memmove</a>(<a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(str)+beg, <a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(val), <a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(val));
<a name="l03289"></a>03289     }
<a name="l03290"></a>03290     <a class="code" href="../../d1/db0/string_8c.html#a056c7c0a74c83ccdb5a160bbdcbf8c3b">STR_SET_LEN</a>(str, <a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(str) + <a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(val) - len);
<a name="l03291"></a>03291     <span class="keywordflow">if</span> (<a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(str)) {
<a name="l03292"></a>03292         <a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(str)[<a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(str)] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l03293"></a>03293     }
<a name="l03294"></a>03294     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3bf9ab455a1e0e3e8cfc6ebabd8f12df">OBJ_INFECT</a>(str, val);
<a name="l03295"></a>03295 }
<a name="l03296"></a>03296 
<a name="l03297"></a>03297 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l03298"></a><a class="code" href="../../d1/db0/string_8c.html#a12fe29a72a7a231ac56cc1f9a8eca581">03298</a> <a class="code" href="../../d1/db0/string_8c.html#a12fe29a72a7a231ac56cc1f9a8eca581">rb_str_splice</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str, <span class="keywordtype">long</span> beg, <span class="keywordtype">long</span> len, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> val)
<a name="l03299"></a>03299 {
<a name="l03300"></a>03300     <span class="keywordtype">long</span> slen;
<a name="l03301"></a>03301     <span class="keywordtype">char</span> *p, *e;
<a name="l03302"></a>03302     <a class="code" href="../../d1/d7b/struct_onig_encoding_type_s_t.html">rb_encoding</a> *enc;
<a name="l03303"></a>03303     <span class="keywordtype">int</span> singlebyte = <a class="code" href="../../d1/db0/string_8c.html#a5ab3c8112c2ec6943bdae8a2036fca02">single_byte_optimizable</a>(str);
<a name="l03304"></a>03304     <span class="keywordtype">int</span> cr;
<a name="l03305"></a>03305 
<a name="l03306"></a>03306     <span class="keywordflow">if</span> (len &lt; 0) <a class="code" href="../../db/dcc/error_8c.html#a0f771a2840561f1838169b3d7d4616f3">rb_raise</a>(<a class="code" href="../../db/dcc/error_8c.html#ac80019ce275be87f28c42761abe460ee">rb_eIndexError</a>, <span class="stringliteral">&quot;negative length %ld&quot;</span>, len);
<a name="l03307"></a>03307 
<a name="l03308"></a>03308     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a0e80f207eb41e9010ec9f0f5f9419fea">StringValue</a>(val);
<a name="l03309"></a>03309     enc = <a class="code" href="../../d5/db5/encoding_8c.html#a7d17d602fae27de649f9310511c03db0">rb_enc_check</a>(str, val);
<a name="l03310"></a>03310     slen = <a class="code" href="../../d1/db0/string_8c.html#abe68504f1d38108a10f267f4358c53db">str_strlen</a>(str, enc);
<a name="l03311"></a>03311 
<a name="l03312"></a>03312     <span class="keywordflow">if</span> (slen &lt; beg) {
<a name="l03313"></a>03313       out_of_range:
<a name="l03314"></a>03314         <a class="code" href="../../db/dcc/error_8c.html#a0f771a2840561f1838169b3d7d4616f3">rb_raise</a>(<a class="code" href="../../db/dcc/error_8c.html#ac80019ce275be87f28c42761abe460ee">rb_eIndexError</a>, <span class="stringliteral">&quot;index %ld out of string&quot;</span>, beg);
<a name="l03315"></a>03315     }
<a name="l03316"></a>03316     <span class="keywordflow">if</span> (beg &lt; 0) {
<a name="l03317"></a>03317         <span class="keywordflow">if</span> (-beg &gt; slen) {
<a name="l03318"></a>03318             <span class="keywordflow">goto</span> out_of_range;
<a name="l03319"></a>03319         }
<a name="l03320"></a>03320         beg += slen;
<a name="l03321"></a>03321     }
<a name="l03322"></a>03322     <span class="keywordflow">if</span> (slen &lt; len || slen &lt; beg + len) {
<a name="l03323"></a>03323         len = slen - beg;
<a name="l03324"></a>03324     }
<a name="l03325"></a>03325     <a class="code" href="../../d1/db0/string_8c.html#a106a1166130a12736cf57bacc164e4a5">str_modify_keep_cr</a>(str);
<a name="l03326"></a>03326     p = <a class="code" href="../../d1/db0/string_8c.html#a3b0d63e96168203d8b9c8e1129e7224d">str_nth</a>(<a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(str), <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a35bfa2635774977edad0a16b9fdebbaf">RSTRING_END</a>(str), beg, enc, singlebyte);
<a name="l03327"></a>03327     <span class="keywordflow">if</span> (!p) p = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a35bfa2635774977edad0a16b9fdebbaf">RSTRING_END</a>(str);
<a name="l03328"></a>03328     e = <a class="code" href="../../d1/db0/string_8c.html#a3b0d63e96168203d8b9c8e1129e7224d">str_nth</a>(p, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a35bfa2635774977edad0a16b9fdebbaf">RSTRING_END</a>(str), len, enc, singlebyte);
<a name="l03329"></a>03329     <span class="keywordflow">if</span> (!e) e = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a35bfa2635774977edad0a16b9fdebbaf">RSTRING_END</a>(str);
<a name="l03330"></a>03330     <span class="comment">/* error check */</span>
<a name="l03331"></a>03331     beg = p - <a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(str); <span class="comment">/* physical position */</span>
<a name="l03332"></a>03332     len = e - p;                <span class="comment">/* physical length */</span>
<a name="l03333"></a>03333     <a class="code" href="../../d1/db0/string_8c.html#ac20d8d67e0c215e6c9944b9cc7e2d3ef">rb_str_splice_0</a>(str, beg, len, val);
<a name="l03334"></a>03334     <a class="code" href="../../d5/db5/encoding_8c.html#a150a6e3ac22ac3be8f8c2ccc74a28e7b">rb_enc_associate</a>(str, enc);
<a name="l03335"></a>03335     cr = <a class="code" href="../../d5/de3/encoding_8h.html#a2a80e28ae5e44f3be150d5b24b65edf6">ENC_CODERANGE_AND</a>(<a class="code" href="../../d5/de3/encoding_8h.html#a5901233f6f9004aebbdeccdd33cf449f">ENC_CODERANGE</a>(str), <a class="code" href="../../d5/de3/encoding_8h.html#a5901233f6f9004aebbdeccdd33cf449f">ENC_CODERANGE</a>(val));
<a name="l03336"></a>03336     <span class="keywordflow">if</span> (cr != <a class="code" href="../../d5/de3/encoding_8h.html#abb86fbc02fc2b78d928825ea6d6922f9">ENC_CODERANGE_BROKEN</a>)
<a name="l03337"></a>03337         <a class="code" href="../../d5/de3/encoding_8h.html#aefe5772c0116cf7131a5227de7243dbc">ENC_CODERANGE_SET</a>(str, cr);
<a name="l03338"></a>03338 }
<a name="l03339"></a>03339 
<a name="l03340"></a>03340 <span class="keywordtype">void</span>
<a name="l03341"></a><a class="code" href="../../d1/db0/string_8c.html#acb62431f567ae8657dc28d866da867f1">03341</a> <a class="code" href="../../db/d2e/intern_8h.html#a402efc00ae2755beeebb58208b9d1670">rb_str_update</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str, <span class="keywordtype">long</span> beg, <span class="keywordtype">long</span> len, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> val)
<a name="l03342"></a>03342 {
<a name="l03343"></a>03343     <a class="code" href="../../d1/db0/string_8c.html#a12fe29a72a7a231ac56cc1f9a8eca581">rb_str_splice</a>(str, beg, len, val);
<a name="l03344"></a>03344 }
<a name="l03345"></a>03345 
<a name="l03346"></a>03346 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l03347"></a><a class="code" href="../../d1/db0/string_8c.html#a6f7856d001b4508e0ee50431a9a7d1e4">03347</a> <a class="code" href="../../d1/db0/string_8c.html#a6f7856d001b4508e0ee50431a9a7d1e4">rb_str_subpat_set</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> re, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> backref, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> val)
<a name="l03348"></a>03348 {
<a name="l03349"></a>03349     <span class="keywordtype">int</span> nth;
<a name="l03350"></a>03350     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <a class="code" href="../../dd/d9f/date__parse_8c.html#aafe6a0803e756e59e5af70fdb2dcc912">match</a>;
<a name="l03351"></a>03351     <span class="keywordtype">long</span> start, end, len;
<a name="l03352"></a>03352     <a class="code" href="../../d1/d7b/struct_onig_encoding_type_s_t.html">rb_encoding</a> *enc;
<a name="l03353"></a>03353     <span class="keyword">struct </span><a class="code" href="../../d6/d14/structre__registers.html">re_registers</a> *regs;
<a name="l03354"></a>03354 
<a name="l03355"></a>03355     <span class="keywordflow">if</span> (<a class="code" href="../../db/db6/re_8h.html#afdf554fa234aebc803c8a4fc98c9936f">rb_reg_search</a>(re, str, 0, 0) &lt; 0) {
<a name="l03356"></a>03356         <a class="code" href="../../db/dcc/error_8c.html#a0f771a2840561f1838169b3d7d4616f3">rb_raise</a>(<a class="code" href="../../db/dcc/error_8c.html#ac80019ce275be87f28c42761abe460ee">rb_eIndexError</a>, <span class="stringliteral">&quot;regexp not matched&quot;</span>);
<a name="l03357"></a>03357     }
<a name="l03358"></a>03358     match = <a class="code" href="../../db/d2e/intern_8h.html#a2590f9272c0599ff0d1922bd0fb6efce">rb_backref_get</a>();
<a name="l03359"></a>03359     nth = <a class="code" href="../../db/d2e/intern_8h.html#a025e4673321d82a1ab18e1570849ca66">rb_reg_backref_number</a>(match, backref);
<a name="l03360"></a>03360     regs = <a class="code" href="../../db/db6/re_8h.html#ad2abd878cfffefaeb1fc24372e80b4c8">RMATCH_REGS</a>(match);
<a name="l03361"></a>03361     <span class="keywordflow">if</span> (nth &gt;= regs-&gt;<a class="code" href="../../d6/d14/structre__registers.html#a5e03bc44d6e9761f707cc1ba4cb4d023">num_regs</a>) {
<a name="l03362"></a>03362       out_of_range:
<a name="l03363"></a>03363         <a class="code" href="../../db/dcc/error_8c.html#a0f771a2840561f1838169b3d7d4616f3">rb_raise</a>(<a class="code" href="../../db/dcc/error_8c.html#ac80019ce275be87f28c42761abe460ee">rb_eIndexError</a>, <span class="stringliteral">&quot;index %d out of regexp&quot;</span>, nth);
<a name="l03364"></a>03364     }
<a name="l03365"></a>03365     <span class="keywordflow">if</span> (nth &lt; 0) {
<a name="l03366"></a>03366         <span class="keywordflow">if</span> (-nth &gt;= regs-&gt;<a class="code" href="../../d6/d14/structre__registers.html#a5e03bc44d6e9761f707cc1ba4cb4d023">num_regs</a>) {
<a name="l03367"></a>03367             <span class="keywordflow">goto</span> out_of_range;
<a name="l03368"></a>03368         }
<a name="l03369"></a>03369         nth += regs-&gt;<a class="code" href="../../d6/d14/structre__registers.html#a5e03bc44d6e9761f707cc1ba4cb4d023">num_regs</a>;
<a name="l03370"></a>03370     }
<a name="l03371"></a>03371 
<a name="l03372"></a>03372     start = <a class="code" href="../../dc/d26/re_8c.html#a84a2ca0496ad2a7c4852c539acb90180">BEG</a>(nth);
<a name="l03373"></a>03373     <span class="keywordflow">if</span> (start == -1) {
<a name="l03374"></a>03374         <a class="code" href="../../db/dcc/error_8c.html#a0f771a2840561f1838169b3d7d4616f3">rb_raise</a>(<a class="code" href="../../db/dcc/error_8c.html#ac80019ce275be87f28c42761abe460ee">rb_eIndexError</a>, <span class="stringliteral">&quot;regexp group %d not matched&quot;</span>, nth);
<a name="l03375"></a>03375     }
<a name="l03376"></a>03376     end = <a class="code" href="../../d5/d9f/escape_8c.html#a29fd18bed01c4d836c7ebfe73a125c3f">END</a>(nth);
<a name="l03377"></a>03377     len = end - start;
<a name="l03378"></a>03378     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a0e80f207eb41e9010ec9f0f5f9419fea">StringValue</a>(val);
<a name="l03379"></a>03379     enc = <a class="code" href="../../d5/db5/encoding_8c.html#a7d17d602fae27de649f9310511c03db0">rb_enc_check</a>(str, val);
<a name="l03380"></a>03380     <a class="code" href="../../d1/db0/string_8c.html#ac20d8d67e0c215e6c9944b9cc7e2d3ef">rb_str_splice_0</a>(str, start, len, val);
<a name="l03381"></a>03381     <a class="code" href="../../d5/db5/encoding_8c.html#a150a6e3ac22ac3be8f8c2ccc74a28e7b">rb_enc_associate</a>(str, enc);
<a name="l03382"></a>03382 }
<a name="l03383"></a>03383 
<a name="l03384"></a>03384 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l03385"></a><a class="code" href="../../d1/db0/string_8c.html#ae9f6050bf9a7f624baa8dde04b0c09a6">03385</a> <a class="code" href="../../d1/db0/string_8c.html#ae9f6050bf9a7f624baa8dde04b0c09a6">rb_str_aset</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> indx, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> val)
<a name="l03386"></a>03386 {
<a name="l03387"></a>03387     <span class="keywordtype">long</span> idx, <a class="code" href="../../d6/d14/structre__registers.html#a4eb5968ed5cce3e60715b734f86e0b70">beg</a>;
<a name="l03388"></a>03388 
<a name="l03389"></a>03389     <span class="keywordflow">switch</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a394faf7191f18552a20cb17ce14226f0">TYPE</a>(indx)) {
<a name="l03390"></a>03390       <span class="keywordflow">case</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a523855de5546c34061e030f4606db3e9">T_FIXNUM</a>:
<a name="l03391"></a>03391         idx = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ae9390780cd6d04a2e0ac3d6282cdefea">FIX2LONG</a>(indx);
<a name="l03392"></a>03392       num_index:
<a name="l03393"></a>03393         <a class="code" href="../../d1/db0/string_8c.html#a12fe29a72a7a231ac56cc1f9a8eca581">rb_str_splice</a>(str, idx, 1, val);
<a name="l03394"></a>03394         <span class="keywordflow">return</span> val;
<a name="l03395"></a>03395 
<a name="l03396"></a>03396       <span class="keywordflow">case</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#afd5c1e36d171ecc04514332e8dcf6388">T_REGEXP</a>:
<a name="l03397"></a>03397         <a class="code" href="../../d1/db0/string_8c.html#a6f7856d001b4508e0ee50431a9a7d1e4">rb_str_subpat_set</a>(str, indx, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(0), val);
<a name="l03398"></a>03398         <span class="keywordflow">return</span> val;
<a name="l03399"></a>03399 
<a name="l03400"></a>03400       <span class="keywordflow">case</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a22a8c2a4bbaae9b68f65c9bb92fd4e39">T_STRING</a>:
<a name="l03401"></a>03401         beg = <a class="code" href="../../d1/db0/string_8c.html#a44f92eec2a74155cc1bb3445e7cacaf1">rb_str_index</a>(str, indx, 0);
<a name="l03402"></a>03402         <span class="keywordflow">if</span> (beg &lt; 0) {
<a name="l03403"></a>03403             <a class="code" href="../../db/dcc/error_8c.html#a0f771a2840561f1838169b3d7d4616f3">rb_raise</a>(<a class="code" href="../../db/dcc/error_8c.html#ac80019ce275be87f28c42761abe460ee">rb_eIndexError</a>, <span class="stringliteral">&quot;string not matched&quot;</span>);
<a name="l03404"></a>03404         }
<a name="l03405"></a>03405         beg = <a class="code" href="../../db/d2e/intern_8h.html#ad9828818c61258f1ddf03369fbcfee61">rb_str_sublen</a>(str, beg);
<a name="l03406"></a>03406         <a class="code" href="../../d1/db0/string_8c.html#a12fe29a72a7a231ac56cc1f9a8eca581">rb_str_splice</a>(str, beg, <a class="code" href="../../d1/db0/string_8c.html#abe68504f1d38108a10f267f4358c53db">str_strlen</a>(indx, 0), val);
<a name="l03407"></a>03407         <span class="keywordflow">return</span> val;
<a name="l03408"></a>03408 
<a name="l03409"></a>03409       <span class="keywordflow">default</span>:
<a name="l03410"></a>03410         <span class="comment">/* check if indx is Range */</span>
<a name="l03411"></a>03411         {
<a name="l03412"></a>03412             <span class="keywordtype">long</span> beg, len;
<a name="l03413"></a>03413             <span class="keywordflow">if</span> (<a class="code" href="../../db/d2e/intern_8h.html#a2f31a8c5a891cd7eb0c42ed0b385091b">rb_range_beg_len</a>(indx, &amp;beg, &amp;len, <a class="code" href="../../d1/db0/string_8c.html#abe68504f1d38108a10f267f4358c53db">str_strlen</a>(str, 0), 2)) {
<a name="l03414"></a>03414                 <a class="code" href="../../d1/db0/string_8c.html#a12fe29a72a7a231ac56cc1f9a8eca581">rb_str_splice</a>(str, beg, len, val);
<a name="l03415"></a>03415                 <span class="keywordflow">return</span> val;
<a name="l03416"></a>03416             }
<a name="l03417"></a>03417         }
<a name="l03418"></a>03418         idx = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a93f154f3dcc08027f475bf0c3cc287bd">NUM2LONG</a>(indx);
<a name="l03419"></a>03419         <span class="keywordflow">goto</span> num_index;
<a name="l03420"></a>03420     }
<a name="l03421"></a>03421 }
<a name="l03422"></a>03422 
<a name="l03423"></a>03423 <span class="comment">/*</span>
<a name="l03424"></a>03424 <span class="comment"> *  call-seq:</span>
<a name="l03425"></a>03425 <span class="comment"> *     str[fixnum] = new_str</span>
<a name="l03426"></a>03426 <span class="comment"> *     str[fixnum, fixnum] = new_str</span>
<a name="l03427"></a>03427 <span class="comment"> *     str[range] = aString</span>
<a name="l03428"></a>03428 <span class="comment"> *     str[regexp] = new_str</span>
<a name="l03429"></a>03429 <span class="comment"> *     str[regexp, fixnum] = new_str</span>
<a name="l03430"></a>03430 <span class="comment"> *     str[regexp, name] = new_str</span>
<a name="l03431"></a>03431 <span class="comment"> *     str[other_str] = new_str</span>
<a name="l03432"></a>03432 <span class="comment"> *</span>
<a name="l03433"></a>03433 <span class="comment"> *  Element Assignment---Replaces some or all of the content of &lt;i&gt;str&lt;/i&gt;. The</span>
<a name="l03434"></a>03434 <span class="comment"> *  portion of the string affected is determined using the same criteria as</span>
<a name="l03435"></a>03435 <span class="comment"> *  &lt;code&gt;String#[]&lt;/code&gt;. If the replacement string is not the same length as</span>
<a name="l03436"></a>03436 <span class="comment"> *  the text it is replacing, the string will be adjusted accordingly. If the</span>
<a name="l03437"></a>03437 <span class="comment"> *  regular expression or string is used as the index doesn&apos;t match a position</span>
<a name="l03438"></a>03438 <span class="comment"> *  in the string, &lt;code&gt;IndexError&lt;/code&gt; is raised. If the regular expression</span>
<a name="l03439"></a>03439 <span class="comment"> *  form is used, the optional second &lt;code&gt;Fixnum&lt;/code&gt; allows you to specify</span>
<a name="l03440"></a>03440 <span class="comment"> *  which portion of the match to replace (effectively using the</span>
<a name="l03441"></a>03441 <span class="comment"> *  &lt;code&gt;MatchData&lt;/code&gt; indexing rules. The forms that take a</span>
<a name="l03442"></a>03442 <span class="comment"> *  &lt;code&gt;Fixnum&lt;/code&gt; will raise an &lt;code&gt;IndexError&lt;/code&gt; if the value is</span>
<a name="l03443"></a>03443 <span class="comment"> *  out of range; the &lt;code&gt;Range&lt;/code&gt; form will raise a</span>
<a name="l03444"></a>03444 <span class="comment"> *  &lt;code&gt;RangeError&lt;/code&gt;, and the &lt;code&gt;Regexp&lt;/code&gt; and &lt;code&gt;String&lt;/code&gt;</span>
<a name="l03445"></a>03445 <span class="comment"> *  forms will silently ignore the assignment.</span>
<a name="l03446"></a>03446 <span class="comment"> */</span>
<a name="l03447"></a>03447 
<a name="l03448"></a>03448 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l03449"></a><a class="code" href="../../d1/db0/string_8c.html#a254a613e67e7bc35f521d1701ed95d1c">03449</a> <a class="code" href="../../d1/db0/string_8c.html#a254a613e67e7bc35f521d1701ed95d1c">rb_str_aset_m</a>(<span class="keywordtype">int</span> <a class="code" href="../../df/d77/ruby_8c.html#ad1447518f4372828b8435ae82e48499e">argc</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> *<a class="code" href="../../df/d77/ruby_8c.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str)
<a name="l03450"></a>03450 {
<a name="l03451"></a>03451     <span class="keywordflow">if</span> (argc == 3) {
<a name="l03452"></a>03452         <span class="keywordflow">if</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a394faf7191f18552a20cb17ce14226f0">TYPE</a>(argv[0]) == <a class="code" href="../../de/de6/ruby_2ruby_8h.html#afd5c1e36d171ecc04514332e8dcf6388">T_REGEXP</a>) {
<a name="l03453"></a>03453             <a class="code" href="../../d1/db0/string_8c.html#a6f7856d001b4508e0ee50431a9a7d1e4">rb_str_subpat_set</a>(str, argv[0], argv[1], argv[2]);
<a name="l03454"></a>03454         }
<a name="l03455"></a>03455         <span class="keywordflow">else</span> {
<a name="l03456"></a>03456             <a class="code" href="../../d1/db0/string_8c.html#a12fe29a72a7a231ac56cc1f9a8eca581">rb_str_splice</a>(str, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a93f154f3dcc08027f475bf0c3cc287bd">NUM2LONG</a>(argv[0]), <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a93f154f3dcc08027f475bf0c3cc287bd">NUM2LONG</a>(argv[1]), argv[2]);
<a name="l03457"></a>03457         }
<a name="l03458"></a>03458         <span class="keywordflow">return</span> argv[2];
<a name="l03459"></a>03459     }
<a name="l03460"></a>03460     <span class="keywordflow">if</span> (argc != 2) {
<a name="l03461"></a>03461         <a class="code" href="../../db/dcc/error_8c.html#a0f771a2840561f1838169b3d7d4616f3">rb_raise</a>(<a class="code" href="../../db/dcc/error_8c.html#ab5e2a9fec766c75176fbb262bfe6a596">rb_eArgError</a>, <span class="stringliteral">&quot;wrong number of arguments (%d for 2..3)&quot;</span>, argc);
<a name="l03462"></a>03462     }
<a name="l03463"></a>03463     <span class="keywordflow">return</span> <a class="code" href="../../d1/db0/string_8c.html#ae9f6050bf9a7f624baa8dde04b0c09a6">rb_str_aset</a>(str, argv[0], argv[1]);
<a name="l03464"></a>03464 }
<a name="l03465"></a>03465 
<a name="l03466"></a>03466 <span class="comment">/*</span>
<a name="l03467"></a>03467 <span class="comment"> *  call-seq:</span>
<a name="l03468"></a>03468 <span class="comment"> *     str.insert(index, other_str)   -&gt; str</span>
<a name="l03469"></a>03469 <span class="comment"> *</span>
<a name="l03470"></a>03470 <span class="comment"> *  Inserts &lt;i&gt;other_str&lt;/i&gt; before the character at the given</span>
<a name="l03471"></a>03471 <span class="comment"> *  &lt;i&gt;index&lt;/i&gt;, modifying &lt;i&gt;str&lt;/i&gt;. Negative indices count from the</span>
<a name="l03472"></a>03472 <span class="comment"> *  end of the string, and insert &lt;em&gt;after&lt;/em&gt; the given character.</span>
<a name="l03473"></a>03473 <span class="comment"> *  The intent is insert &lt;i&gt;aString&lt;/i&gt; so that it starts at the given</span>
<a name="l03474"></a>03474 <span class="comment"> *  &lt;i&gt;index&lt;/i&gt;.</span>
<a name="l03475"></a>03475 <span class="comment"> *</span>
<a name="l03476"></a>03476 <span class="comment"> *     &quot;abcd&quot;.insert(0, &apos;X&apos;)    #=&gt; &quot;Xabcd&quot;</span>
<a name="l03477"></a>03477 <span class="comment"> *     &quot;abcd&quot;.insert(3, &apos;X&apos;)    #=&gt; &quot;abcXd&quot;</span>
<a name="l03478"></a>03478 <span class="comment"> *     &quot;abcd&quot;.insert(4, &apos;X&apos;)    #=&gt; &quot;abcdX&quot;</span>
<a name="l03479"></a>03479 <span class="comment"> *     &quot;abcd&quot;.insert(-3, &apos;X&apos;)   #=&gt; &quot;abXcd&quot;</span>
<a name="l03480"></a>03480 <span class="comment"> *     &quot;abcd&quot;.insert(-1, &apos;X&apos;)   #=&gt; &quot;abcdX&quot;</span>
<a name="l03481"></a>03481 <span class="comment"> */</span>
<a name="l03482"></a>03482 
<a name="l03483"></a>03483 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l03484"></a><a class="code" href="../../d1/db0/string_8c.html#acdca0120090d0bc8f32d17824e6dbb8b">03484</a> <a class="code" href="../../d1/db0/string_8c.html#acdca0120090d0bc8f32d17824e6dbb8b">rb_str_insert</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> idx, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str2)
<a name="l03485"></a>03485 {
<a name="l03486"></a>03486     <span class="keywordtype">long</span> pos = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a93f154f3dcc08027f475bf0c3cc287bd">NUM2LONG</a>(idx);
<a name="l03487"></a>03487 
<a name="l03488"></a>03488     <span class="keywordflow">if</span> (pos == -1) {
<a name="l03489"></a>03489         <span class="keywordflow">return</span> <a class="code" href="../../db/d2e/intern_8h.html#ab592dcd9e193dea76fb0ff58b5d907e4">rb_str_append</a>(str, str2);
<a name="l03490"></a>03490     }
<a name="l03491"></a>03491     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pos &lt; 0) {
<a name="l03492"></a>03492         pos++;
<a name="l03493"></a>03493     }
<a name="l03494"></a>03494     <a class="code" href="../../d1/db0/string_8c.html#a12fe29a72a7a231ac56cc1f9a8eca581">rb_str_splice</a>(str, pos, 0, str2);
<a name="l03495"></a>03495     <span class="keywordflow">return</span> str;
<a name="l03496"></a>03496 }
<a name="l03497"></a>03497 
<a name="l03498"></a>03498 
<a name="l03499"></a>03499 <span class="comment">/*</span>
<a name="l03500"></a>03500 <span class="comment"> *  call-seq:</span>
<a name="l03501"></a>03501 <span class="comment"> *     str.slice!(fixnum)           -&gt; fixnum or nil</span>
<a name="l03502"></a>03502 <span class="comment"> *     str.slice!(fixnum, fixnum)   -&gt; new_str or nil</span>
<a name="l03503"></a>03503 <span class="comment"> *     str.slice!(range)            -&gt; new_str or nil</span>
<a name="l03504"></a>03504 <span class="comment"> *     str.slice!(regexp)           -&gt; new_str or nil</span>
<a name="l03505"></a>03505 <span class="comment"> *     str.slice!(other_str)        -&gt; new_str or nil</span>
<a name="l03506"></a>03506 <span class="comment"> *</span>
<a name="l03507"></a>03507 <span class="comment"> *  Deletes the specified portion from &lt;i&gt;str&lt;/i&gt;, and returns the portion</span>
<a name="l03508"></a>03508 <span class="comment"> *  deleted.</span>
<a name="l03509"></a>03509 <span class="comment"> *</span>
<a name="l03510"></a>03510 <span class="comment"> *     string = &quot;this is a string&quot;</span>
<a name="l03511"></a>03511 <span class="comment"> *     string.slice!(2)        #=&gt; &quot;i&quot;</span>
<a name="l03512"></a>03512 <span class="comment"> *     string.slice!(3..6)     #=&gt; &quot; is &quot;</span>
<a name="l03513"></a>03513 <span class="comment"> *     string.slice!(/s.*t/)   #=&gt; &quot;sa st&quot;</span>
<a name="l03514"></a>03514 <span class="comment"> *     string.slice!(&quot;r&quot;)      #=&gt; &quot;r&quot;</span>
<a name="l03515"></a>03515 <span class="comment"> *     string                  #=&gt; &quot;thing&quot;</span>
<a name="l03516"></a>03516 <span class="comment"> */</span>
<a name="l03517"></a>03517 
<a name="l03518"></a>03518 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l03519"></a><a class="code" href="../../d1/db0/string_8c.html#aa207d9e576d960b94fd7c1c3ff8cd745">03519</a> <a class="code" href="../../d1/db0/string_8c.html#aa207d9e576d960b94fd7c1c3ff8cd745">rb_str_slice_bang</a>(<span class="keywordtype">int</span> <a class="code" href="../../df/d77/ruby_8c.html#ad1447518f4372828b8435ae82e48499e">argc</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> *<a class="code" href="../../df/d77/ruby_8c.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str)
<a name="l03520"></a>03520 {
<a name="l03521"></a>03521     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <a class="code" href="../../d8/d90/nkf_8c.html#a5ea5ac7abf5cce39283e422add1067d5">result</a>;
<a name="l03522"></a>03522     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <a class="code" href="../../d6/da0/nkf-utf8_2nkf_8c.html#ac37f17a60c8b5533aac4840c681f62b8">buf</a>[3];
<a name="l03523"></a>03523     <span class="keywordtype">int</span> i;
<a name="l03524"></a>03524 
<a name="l03525"></a>03525     <span class="keywordflow">if</span> (argc &lt; 1 || 2 &lt; argc) {
<a name="l03526"></a>03526         <a class="code" href="../../db/dcc/error_8c.html#a0f771a2840561f1838169b3d7d4616f3">rb_raise</a>(<a class="code" href="../../db/dcc/error_8c.html#ab5e2a9fec766c75176fbb262bfe6a596">rb_eArgError</a>, <span class="stringliteral">&quot;wrong number of arguments (%d for 1..2)&quot;</span>, argc);
<a name="l03527"></a>03527     }
<a name="l03528"></a>03528     <span class="keywordflow">for</span> (i=0; i&lt;argc; i++) {
<a name="l03529"></a>03529         buf[i] = argv[i];
<a name="l03530"></a>03530     }
<a name="l03531"></a>03531     <a class="code" href="../../d1/db0/string_8c.html#a106a1166130a12736cf57bacc164e4a5">str_modify_keep_cr</a>(str);
<a name="l03532"></a>03532     result = <a class="code" href="../../d1/db0/string_8c.html#aa5327105773f1bfb1799f4a6b04587e7">rb_str_aref_m</a>(argc, buf, str);
<a name="l03533"></a>03533     <span class="keywordflow">if</span> (!<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a4832bad8845a35fc50f7a160901854a1">NIL_P</a>(result)) {
<a name="l03534"></a>03534         buf[i] = <a class="code" href="../../db/d2e/intern_8h.html#a48b2b873adb8b6a04254bd631c4b03c5">rb_str_new</a>(0,0);
<a name="l03535"></a>03535         <a class="code" href="../../d1/db0/string_8c.html#a254a613e67e7bc35f521d1701ed95d1c">rb_str_aset_m</a>(argc+1, buf, str);
<a name="l03536"></a>03536     }
<a name="l03537"></a>03537     <span class="keywordflow">return</span> result;
<a name="l03538"></a>03538 }
<a name="l03539"></a>03539 
<a name="l03540"></a>03540 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l03541"></a><a class="code" href="../../d1/db0/string_8c.html#a105b63dc9f6f07c8c6403302757e9c96">03541</a> <a class="code" href="../../d1/db0/string_8c.html#a105b63dc9f6f07c8c6403302757e9c96">get_pat</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> pat, <span class="keywordtype">int</span> quote)
<a name="l03542"></a>03542 {
<a name="l03543"></a>03543     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> val;
<a name="l03544"></a>03544 
<a name="l03545"></a>03545     <span class="keywordflow">switch</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a394faf7191f18552a20cb17ce14226f0">TYPE</a>(pat)) {
<a name="l03546"></a>03546       <span class="keywordflow">case</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#afd5c1e36d171ecc04514332e8dcf6388">T_REGEXP</a>:
<a name="l03547"></a>03547         <span class="keywordflow">return</span> pat;
<a name="l03548"></a>03548 
<a name="l03549"></a>03549       <span class="keywordflow">case</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a22a8c2a4bbaae9b68f65c9bb92fd4e39">T_STRING</a>:
<a name="l03550"></a>03550         <span class="keywordflow">break</span>;
<a name="l03551"></a>03551 
<a name="l03552"></a>03552       <span class="keywordflow">default</span>:
<a name="l03553"></a>03553         val = <a class="code" href="../../db/d2e/intern_8h.html#a669b6063704b2d304844bd1553217cf0">rb_check_string_type</a>(pat);
<a name="l03554"></a>03554         <span class="keywordflow">if</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a4832bad8845a35fc50f7a160901854a1">NIL_P</a>(val)) {
<a name="l03555"></a>03555             <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ad5a1e03b0a66824f95f6aaf07b4a4052">Check_Type</a>(pat, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#afd5c1e36d171ecc04514332e8dcf6388">T_REGEXP</a>);
<a name="l03556"></a>03556         }
<a name="l03557"></a>03557         pat = val;
<a name="l03558"></a>03558     }
<a name="l03559"></a>03559 
<a name="l03560"></a>03560     <span class="keywordflow">if</span> (quote) {
<a name="l03561"></a>03561         pat = <a class="code" href="../../db/db6/re_8h.html#ad2f14e3ba1d14a46cb839885741496fc">rb_reg_quote</a>(pat);
<a name="l03562"></a>03562     }
<a name="l03563"></a>03563 
<a name="l03564"></a>03564     <span class="keywordflow">return</span> <a class="code" href="../../db/db6/re_8h.html#a8f481f1d87ea2ae333883087cabcacd5">rb_reg_regcomp</a>(pat);
<a name="l03565"></a>03565 }
<a name="l03566"></a>03566 
<a name="l03567"></a>03567 
<a name="l03568"></a>03568 <span class="comment">/*</span>
<a name="l03569"></a>03569 <span class="comment"> *  call-seq:</span>
<a name="l03570"></a>03570 <span class="comment"> *     str.sub!(pattern, replacement)          -&gt; str or nil</span>
<a name="l03571"></a>03571 <span class="comment"> *     str.sub!(pattern) {|match| block }      -&gt; str or nil</span>
<a name="l03572"></a>03572 <span class="comment"> *</span>
<a name="l03573"></a>03573 <span class="comment"> *  Performs the substitutions of &lt;code&gt;String#sub&lt;/code&gt; in place,</span>
<a name="l03574"></a>03574 <span class="comment"> *  returning &lt;i&gt;str&lt;/i&gt;, or &lt;code&gt;nil&lt;/code&gt; if no substitutions were</span>
<a name="l03575"></a>03575 <span class="comment"> *  performed.</span>
<a name="l03576"></a>03576 <span class="comment"> */</span>
<a name="l03577"></a>03577 
<a name="l03578"></a>03578 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l03579"></a><a class="code" href="../../d1/db0/string_8c.html#ae69f21015b4902fd3dcfc39ab7d0cfbc">03579</a> <a class="code" href="../../d1/db0/string_8c.html#ae69f21015b4902fd3dcfc39ab7d0cfbc">rb_str_sub_bang</a>(<span class="keywordtype">int</span> <a class="code" href="../../df/d77/ruby_8c.html#ad1447518f4372828b8435ae82e48499e">argc</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> *<a class="code" href="../../df/d77/ruby_8c.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str)
<a name="l03580"></a>03580 {
<a name="l03581"></a>03581     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> pat, repl, <a class="code" href="../../d3/deb/lex_8c.html#a5541f85ce416df233cce93949f0eeeca">hash</a> = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a320970f989dc8294c8203154e3db40c1">Qnil</a>;
<a name="l03582"></a>03582     <span class="keywordtype">int</span> iter = 0;
<a name="l03583"></a>03583     <span class="keywordtype">int</span> tainted = 0;
<a name="l03584"></a>03584     <span class="keywordtype">int</span> untrusted = 0;
<a name="l03585"></a>03585     <span class="keywordtype">long</span> plen;
<a name="l03586"></a>03586 
<a name="l03587"></a>03587     <span class="keywordflow">if</span> (argc == 1 &amp;&amp; <a class="code" href="../../d3/d57/eval_8c.html#aea346c4eb8bc06df88422e956bb05fec">rb_block_given_p</a>()) {
<a name="l03588"></a>03588         iter = 1;
<a name="l03589"></a>03589     }
<a name="l03590"></a>03590     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (argc == 2) {
<a name="l03591"></a>03591         repl = argv[1];
<a name="l03592"></a>03592         hash = <a class="code" href="../../db/d2e/intern_8h.html#a16e59d05c8eb1641308bc1018c333cc1">rb_check_convert_type</a>(argv[1], <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a8357e81bbb60cb41b0a292a90653a5e5">T_HASH</a>, <span class="stringliteral">&quot;Hash&quot;</span>, <span class="stringliteral">&quot;to_hash&quot;</span>);
<a name="l03593"></a>03593         <span class="keywordflow">if</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a4832bad8845a35fc50f7a160901854a1">NIL_P</a>(hash)) {
<a name="l03594"></a>03594             <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a0e80f207eb41e9010ec9f0f5f9419fea">StringValue</a>(repl);
<a name="l03595"></a>03595         }
<a name="l03596"></a>03596         <span class="keywordflow">if</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a621bc62b1fd82640c1078daf90e1c061">OBJ_TAINTED</a>(repl)) tainted = 1;
<a name="l03597"></a>03597         <span class="keywordflow">if</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a981ef70b505df85f89fba2b5c2d8b462">OBJ_UNTRUSTED</a>(repl)) untrusted = 1;
<a name="l03598"></a>03598     }
<a name="l03599"></a>03599     <span class="keywordflow">else</span> {
<a name="l03600"></a>03600         <a class="code" href="../../db/dcc/error_8c.html#a0f771a2840561f1838169b3d7d4616f3">rb_raise</a>(<a class="code" href="../../db/dcc/error_8c.html#ab5e2a9fec766c75176fbb262bfe6a596">rb_eArgError</a>, <span class="stringliteral">&quot;wrong number of arguments (%d for 1..2)&quot;</span>, argc);
<a name="l03601"></a>03601     }
<a name="l03602"></a>03602 
<a name="l03603"></a>03603     pat = <a class="code" href="../../d1/db0/string_8c.html#a105b63dc9f6f07c8c6403302757e9c96">get_pat</a>(argv[0], 1);
<a name="l03604"></a>03604     <a class="code" href="../../d1/db0/string_8c.html#a865d4f66b7c8fca1f7fd9afa3298a56e">str_modifiable</a>(str);
<a name="l03605"></a>03605     <span class="keywordflow">if</span> (<a class="code" href="../../db/db6/re_8h.html#afdf554fa234aebc803c8a4fc98c9936f">rb_reg_search</a>(pat, str, 0, 0) &gt;= 0) {
<a name="l03606"></a>03606         <a class="code" href="../../d1/d7b/struct_onig_encoding_type_s_t.html">rb_encoding</a> *enc;
<a name="l03607"></a>03607         <span class="keywordtype">int</span> cr = <a class="code" href="../../d5/de3/encoding_8h.html#a5901233f6f9004aebbdeccdd33cf449f">ENC_CODERANGE</a>(str);
<a name="l03608"></a>03608         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <a class="code" href="../../dd/d9f/date__parse_8c.html#aafe6a0803e756e59e5af70fdb2dcc912">match</a> = <a class="code" href="../../db/d2e/intern_8h.html#a2590f9272c0599ff0d1922bd0fb6efce">rb_backref_get</a>();
<a name="l03609"></a>03609         <span class="keyword">struct </span><a class="code" href="../../d6/d14/structre__registers.html">re_registers</a> *regs = <a class="code" href="../../db/db6/re_8h.html#ad2abd878cfffefaeb1fc24372e80b4c8">RMATCH_REGS</a>(match);
<a name="l03610"></a>03610         <span class="keywordtype">long</span> beg0 = <a class="code" href="../../dc/d26/re_8c.html#a84a2ca0496ad2a7c4852c539acb90180">BEG</a>(0);
<a name="l03611"></a>03611         <span class="keywordtype">long</span> end0 = <a class="code" href="../../d5/d9f/escape_8c.html#a29fd18bed01c4d836c7ebfe73a125c3f">END</a>(0);
<a name="l03612"></a>03612         <span class="keywordtype">char</span> *p, *rp;
<a name="l03613"></a>03613         <span class="keywordtype">long</span> len, rlen;
<a name="l03614"></a>03614 
<a name="l03615"></a>03615         <span class="keywordflow">if</span> (iter || !<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a4832bad8845a35fc50f7a160901854a1">NIL_P</a>(hash)) {
<a name="l03616"></a>03616             p = <a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(str); len = <a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(str);
<a name="l03617"></a>03617 
<a name="l03618"></a>03618             <span class="keywordflow">if</span> (iter) {
<a name="l03619"></a>03619                 repl = <a class="code" href="../../db/d2e/intern_8h.html#acae5350f5d539c4654e4e33690256a9f">rb_obj_as_string</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#ae6bd0c4ea4db971ebd569ca8f05c6b4a">rb_yield</a>(<a class="code" href="../../db/d2e/intern_8h.html#ac50ab731365028f5efab69c001fba39d">rb_reg_nth_match</a>(0, match)));
<a name="l03620"></a>03620             }
<a name="l03621"></a>03621             <span class="keywordflow">else</span> {
<a name="l03622"></a>03622                 repl = <a class="code" href="../../d1/d04/hash_8c.html#ab7063832c7ed02351e87922a78e35c32">rb_hash_aref</a>(hash, <a class="code" href="../../db/d2e/intern_8h.html#aadf59e7cbba9319e199d85ef2448a970">rb_str_subseq</a>(str, beg0, end0 - beg0));
<a name="l03623"></a>03623                 repl = <a class="code" href="../../db/d2e/intern_8h.html#acae5350f5d539c4654e4e33690256a9f">rb_obj_as_string</a>(repl);
<a name="l03624"></a>03624             }
<a name="l03625"></a>03625             <a class="code" href="../../d1/db0/string_8c.html#ad2935afc9682c838023639ae7332edad">str_mod_check</a>(str, p, len);
<a name="l03626"></a>03626             <a class="code" href="../../db/d2e/intern_8h.html#a372d6acb27d271ee4fc2e88c7022c485">rb_check_frozen</a>(str);
<a name="l03627"></a>03627         }
<a name="l03628"></a>03628         <span class="keywordflow">else</span> {
<a name="l03629"></a>03629             repl = <a class="code" href="../../db/db6/re_8h.html#a91720053cc149eee23f27597e88df25c">rb_reg_regsub</a>(repl, str, regs, pat);
<a name="l03630"></a>03630         }
<a name="l03631"></a>03631         enc = <a class="code" href="../../d5/db5/encoding_8c.html#a533ed45f02a3f72987b0f6f5ce04c996">rb_enc_compatible</a>(str, repl);
<a name="l03632"></a>03632         <span class="keywordflow">if</span> (!enc) {
<a name="l03633"></a>03633             <a class="code" href="../../d1/d7b/struct_onig_encoding_type_s_t.html">rb_encoding</a> *str_enc = <a class="code" href="../../d1/db0/string_8c.html#a123891f9f9b0c87d15621d93b4fa9c41">STR_ENC_GET</a>(str);
<a name="l03634"></a>03634             p = <a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(str); len = <a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(str);
<a name="l03635"></a>03635             <span class="keywordflow">if</span> (<a class="code" href="../../d1/db0/string_8c.html#af47bc9a7bbb51656cecb095780518d7f">coderange_scan</a>(p, beg0, str_enc) != <a class="code" href="../../d5/de3/encoding_8h.html#a0a0e73a2d98205044e1ad19432502c5b">ENC_CODERANGE_7BIT</a> ||
<a name="l03636"></a>03636                 <a class="code" href="../../d1/db0/string_8c.html#af47bc9a7bbb51656cecb095780518d7f">coderange_scan</a>(p+end0, len-end0, str_enc) != <a class="code" href="../../d5/de3/encoding_8h.html#a0a0e73a2d98205044e1ad19432502c5b">ENC_CODERANGE_7BIT</a>) {
<a name="l03637"></a>03637                 <a class="code" href="../../db/dcc/error_8c.html#a0f771a2840561f1838169b3d7d4616f3">rb_raise</a>(<a class="code" href="../../db/dcc/error_8c.html#a71f980ead61a4ac261914ffaaa184e1f">rb_eEncCompatError</a>, <span class="stringliteral">&quot;incompatible character encodings: %s and %s&quot;</span>,
<a name="l03638"></a>03638                          <a class="code" href="../../d5/de3/encoding_8h.html#a69d59d898802726787a168ef2e0dc92c">rb_enc_name</a>(str_enc),
<a name="l03639"></a>03639                          <a class="code" href="../../d5/de3/encoding_8h.html#a69d59d898802726787a168ef2e0dc92c">rb_enc_name</a>(<a class="code" href="../../d1/db0/string_8c.html#a123891f9f9b0c87d15621d93b4fa9c41">STR_ENC_GET</a>(repl)));
<a name="l03640"></a>03640             }
<a name="l03641"></a>03641             enc = <a class="code" href="../../d1/db0/string_8c.html#a123891f9f9b0c87d15621d93b4fa9c41">STR_ENC_GET</a>(repl);
<a name="l03642"></a>03642         }
<a name="l03643"></a>03643         <a class="code" href="../../db/d2e/intern_8h.html#a63a6d05687cf812131dce11743581b9d">rb_str_modify</a>(str);
<a name="l03644"></a>03644         <a class="code" href="../../d5/db5/encoding_8c.html#a150a6e3ac22ac3be8f8c2ccc74a28e7b">rb_enc_associate</a>(str, enc);
<a name="l03645"></a>03645         <span class="keywordflow">if</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a621bc62b1fd82640c1078daf90e1c061">OBJ_TAINTED</a>(repl)) tainted = 1;
<a name="l03646"></a>03646         <span class="keywordflow">if</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a981ef70b505df85f89fba2b5c2d8b462">OBJ_UNTRUSTED</a>(repl)) untrusted = 1;
<a name="l03647"></a>03647         <span class="keywordflow">if</span> (<a class="code" href="../../d5/de3/encoding_8h.html#a60de9709709968f9627365a6cd0ff5d1">ENC_CODERANGE_UNKNOWN</a> &lt; cr &amp;&amp; cr &lt; <a class="code" href="../../d5/de3/encoding_8h.html#abb86fbc02fc2b78d928825ea6d6922f9">ENC_CODERANGE_BROKEN</a>) {
<a name="l03648"></a>03648             <span class="keywordtype">int</span> cr2 = <a class="code" href="../../d5/de3/encoding_8h.html#a5901233f6f9004aebbdeccdd33cf449f">ENC_CODERANGE</a>(repl);
<a name="l03649"></a>03649             <span class="keywordflow">if</span> (cr2 == <a class="code" href="../../d5/de3/encoding_8h.html#abb86fbc02fc2b78d928825ea6d6922f9">ENC_CODERANGE_BROKEN</a> ||
<a name="l03650"></a>03650                 (cr == <a class="code" href="../../d5/de3/encoding_8h.html#a0c81a12daaa1e57009d46b9d906957dc">ENC_CODERANGE_VALID</a> &amp;&amp; cr2 == <a class="code" href="../../d5/de3/encoding_8h.html#a0a0e73a2d98205044e1ad19432502c5b">ENC_CODERANGE_7BIT</a>))
<a name="l03651"></a>03651                 cr = <a class="code" href="../../d5/de3/encoding_8h.html#a60de9709709968f9627365a6cd0ff5d1">ENC_CODERANGE_UNKNOWN</a>;
<a name="l03652"></a>03652             <span class="keywordflow">else</span>
<a name="l03653"></a>03653                 cr = cr2;
<a name="l03654"></a>03654         }
<a name="l03655"></a>03655         plen = end0 - beg0;
<a name="l03656"></a>03656         rp = <a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(repl); rlen = <a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(repl);
<a name="l03657"></a>03657         len = <a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(str);
<a name="l03658"></a>03658         <span class="keywordflow">if</span> (rlen &gt; plen) {
<a name="l03659"></a>03659             <a class="code" href="../../d1/db0/string_8c.html#ab8dafff9534eaf6545585223ada6b1c8">RESIZE_CAPA</a>(str, len + rlen - plen);
<a name="l03660"></a>03660         }
<a name="l03661"></a>03661         p = <a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(str);
<a name="l03662"></a>03662         <span class="keywordflow">if</span> (rlen != plen) {
<a name="l03663"></a>03663             <a class="code" href="../../d3/d90/missing_8h.html#a809a3e9326a0d3e5aa549b17085b057d">memmove</a>(p + beg0 + rlen, p + beg0 + plen, len - beg0 - plen);
<a name="l03664"></a>03664         }
<a name="l03665"></a>03665         memcpy(p + beg0, rp, rlen);
<a name="l03666"></a>03666         len += rlen - plen;
<a name="l03667"></a>03667         <a class="code" href="../../d1/db0/string_8c.html#a056c7c0a74c83ccdb5a160bbdcbf8c3b">STR_SET_LEN</a>(str, len);
<a name="l03668"></a>03668         <a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(str)[len] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l03669"></a>03669         <a class="code" href="../../d5/de3/encoding_8h.html#aefe5772c0116cf7131a5227de7243dbc">ENC_CODERANGE_SET</a>(str, cr);
<a name="l03670"></a>03670         <span class="keywordflow">if</span> (tainted) <a class="code" href="../../de/de6/ruby_2ruby_8h.html#afd75ea0cb81c17e76c73e593d1d8a860">OBJ_TAINT</a>(str);
<a name="l03671"></a>03671         <span class="keywordflow">if</span> (untrusted) <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a745e96f2caf067a003f10eef662ea161">OBJ_UNTRUST</a>(str);
<a name="l03672"></a>03672 
<a name="l03673"></a>03673         <span class="keywordflow">return</span> str;
<a name="l03674"></a>03674     }
<a name="l03675"></a>03675     <span class="keywordflow">return</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a320970f989dc8294c8203154e3db40c1">Qnil</a>;
<a name="l03676"></a>03676 }
<a name="l03677"></a>03677 
<a name="l03678"></a>03678 
<a name="l03679"></a>03679 <span class="comment">/*</span>
<a name="l03680"></a>03680 <span class="comment"> *  call-seq:</span>
<a name="l03681"></a>03681 <span class="comment"> *     str.sub(pattern, replacement)         -&gt; new_str</span>
<a name="l03682"></a>03682 <span class="comment"> *     str.sub(pattern, hash)                -&gt; new_str</span>
<a name="l03683"></a>03683 <span class="comment"> *     str.sub(pattern) {|match| block }     -&gt; new_str</span>
<a name="l03684"></a>03684 <span class="comment"> *</span>
<a name="l03685"></a>03685 <span class="comment"> *  Returns a copy of &lt;i&gt;str&lt;/i&gt; with the &lt;em&gt;first&lt;/em&gt; occurrence of</span>
<a name="l03686"></a>03686 <span class="comment"> *  &lt;i&gt;pattern&lt;/i&gt; substituted for the second argument. The &lt;i&gt;pattern&lt;/i&gt; is</span>
<a name="l03687"></a>03687 <span class="comment"> *  typically a &lt;code&gt;Regexp&lt;/code&gt;; if given as a &lt;code&gt;String&lt;/code&gt;, any</span>
<a name="l03688"></a>03688 <span class="comment"> *  regular expression metacharacters it contains will be interpreted</span>
<a name="l03689"></a>03689 <span class="comment"> *  literally, e.g. &lt;code&gt;&apos;\\\d&apos;&lt;/code&gt; will match a backlash followed by &apos;d&apos;,</span>
<a name="l03690"></a>03690 <span class="comment"> *  instead of a digit.</span>
<a name="l03691"></a>03691 <span class="comment"> *</span>
<a name="l03692"></a>03692 <span class="comment"> *  If &lt;i&gt;replacement&lt;/i&gt; is a &lt;code&gt;String&lt;/code&gt; it will be substituted for</span>
<a name="l03693"></a>03693 <span class="comment"> *  the matched text. It may contain back-references to the pattern&apos;s capture</span>
<a name="l03694"></a>03694 <span class="comment"> *  groups of the form &lt;code&gt;\\\d&lt;/code&gt;, where &lt;i&gt;d&lt;/i&gt; is a group number, or</span>
<a name="l03695"></a>03695 <span class="comment"> *  &lt;code&gt;\\\k&lt;n&gt;&lt;/code&gt;, where &lt;i&gt;n&lt;/i&gt; is a group name. If it is a</span>
<a name="l03696"></a>03696 <span class="comment"> *  double-quoted string, both back-references must be preceded by an</span>
<a name="l03697"></a>03697 <span class="comment"> *  additional backslash. However, within &lt;i&gt;replacement&lt;/i&gt; the special match</span>
<a name="l03698"></a>03698 <span class="comment"> *  variables, such as &lt;code&gt;&amp;$&lt;/code&gt;, will not refer to the current match.</span>
<a name="l03699"></a>03699 <span class="comment"> *</span>
<a name="l03700"></a>03700 <span class="comment"> *  If the second argument is a &lt;code&gt;Hash&lt;/code&gt;, and the matched text is one</span>
<a name="l03701"></a>03701 <span class="comment"> *  of its keys, the corresponding value is the replacement string.</span>
<a name="l03702"></a>03702 <span class="comment"> *</span>
<a name="l03703"></a>03703 <span class="comment"> *  In the block form, the current match string is passed in as a parameter,</span>
<a name="l03704"></a>03704 <span class="comment"> *  and variables such as &lt;code&gt;$1&lt;/code&gt;, &lt;code&gt;$2&lt;/code&gt;, &lt;code&gt;$`&lt;/code&gt;,</span>
<a name="l03705"></a>03705 <span class="comment"> *  &lt;code&gt;$&amp;&lt;/code&gt;, and &lt;code&gt;$&apos;&lt;/code&gt; will be set appropriately. The value</span>
<a name="l03706"></a>03706 <span class="comment"> *  returned by the block will be substituted for the match on each call.</span>
<a name="l03707"></a>03707 <span class="comment"> *</span>
<a name="l03708"></a>03708 <span class="comment"> *  The result inherits any tainting in the original string or any supplied</span>
<a name="l03709"></a>03709 <span class="comment"> *  replacement string.</span>
<a name="l03710"></a>03710 <span class="comment"> *</span>
<a name="l03711"></a>03711 <span class="comment"> *     &quot;hello&quot;.sub(/[aeiou]/, &apos;*&apos;)                  #=&gt; &quot;h*llo&quot;</span>
<a name="l03712"></a>03712 <span class="comment"> *     &quot;hello&quot;.sub(/([aeiou])/, &apos;&lt;\1&gt;&apos;)             #=&gt; &quot;h&lt;e&gt;llo&quot;</span>
<a name="l03713"></a>03713 <span class="comment"> *     &quot;hello&quot;.sub(/./) {|s| s.ord.to_s + &apos; &apos; }     #=&gt; &quot;104 ello&quot;</span>
<a name="l03714"></a>03714 <span class="comment"> *     &quot;hello&quot;.sub(/(?&lt;foo&gt;[aeiou])/, &apos;*\k&lt;foo&gt;*&apos;)  #=&gt; &quot;h*e*llo&quot;</span>
<a name="l03715"></a>03715 <span class="comment"> *     &apos;Is SHELL your preferred shell?&apos;.sub(/[[:upper:]]{2,}/, ENV)</span>
<a name="l03716"></a>03716 <span class="comment"> *      #=&gt; &quot;Is /bin/bash your preferred shell?&quot;</span>
<a name="l03717"></a>03717 <span class="comment"> */</span>
<a name="l03718"></a>03718 
<a name="l03719"></a>03719 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l03720"></a><a class="code" href="../../d1/db0/string_8c.html#a162d7fb7bca6ad41fa999d3baf455e70">03720</a> <a class="code" href="../../d1/db0/string_8c.html#a162d7fb7bca6ad41fa999d3baf455e70">rb_str_sub</a>(<span class="keywordtype">int</span> <a class="code" href="../../df/d77/ruby_8c.html#ad1447518f4372828b8435ae82e48499e">argc</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> *<a class="code" href="../../df/d77/ruby_8c.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str)
<a name="l03721"></a>03721 {
<a name="l03722"></a>03722     str = <a class="code" href="../../db/d2e/intern_8h.html#ae2843c766c24b80116bb127ebf22d5bf">rb_str_dup</a>(str);
<a name="l03723"></a>03723     <a class="code" href="../../d1/db0/string_8c.html#ae69f21015b4902fd3dcfc39ab7d0cfbc">rb_str_sub_bang</a>(argc, argv, str);
<a name="l03724"></a>03724     <span class="keywordflow">return</span> str;
<a name="l03725"></a>03725 }
<a name="l03726"></a>03726 
<a name="l03727"></a>03727 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l03728"></a><a class="code" href="../../d1/db0/string_8c.html#a4fb451b31e6d39d5d4a9004fbc6bc5f7">03728</a> <a class="code" href="../../d1/db0/string_8c.html#a4fb451b31e6d39d5d4a9004fbc6bc5f7">str_gsub</a>(<span class="keywordtype">int</span> <a class="code" href="../../df/d77/ruby_8c.html#ad1447518f4372828b8435ae82e48499e">argc</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> *<a class="code" href="../../df/d77/ruby_8c.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str, <span class="keywordtype">int</span> bang)
<a name="l03729"></a>03729 {
<a name="l03730"></a>03730     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> pat, val, repl, <a class="code" href="../../dd/d9f/date__parse_8c.html#aafe6a0803e756e59e5af70fdb2dcc912">match</a>, dest, <a class="code" href="../../d3/deb/lex_8c.html#a5541f85ce416df233cce93949f0eeeca">hash</a> = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a320970f989dc8294c8203154e3db40c1">Qnil</a>;
<a name="l03731"></a>03731     <span class="keyword">struct </span><a class="code" href="../../d6/d14/structre__registers.html">re_registers</a> *regs;
<a name="l03732"></a>03732     <span class="keywordtype">long</span> <a class="code" href="../../d6/d14/structre__registers.html#a4eb5968ed5cce3e60715b734f86e0b70">beg</a>, n;
<a name="l03733"></a>03733     <span class="keywordtype">long</span> beg0, end0;
<a name="l03734"></a>03734     <span class="keywordtype">long</span> offset, blen, slen, len, <a class="code" href="../../d6/da0/nkf-utf8_2nkf_8c.html#ab0b853bc4e4e9658036bf7e604f398ad">last</a>;
<a name="l03735"></a>03735     <span class="keywordtype">int</span> iter = 0;
<a name="l03736"></a>03736     <span class="keywordtype">char</span> *sp, *cp;
<a name="l03737"></a>03737     <span class="keywordtype">int</span> tainted = 0;
<a name="l03738"></a>03738     <a class="code" href="../../d1/d7b/struct_onig_encoding_type_s_t.html">rb_encoding</a> *str_enc;
<a name="l03739"></a>03739 
<a name="l03740"></a>03740     <span class="keywordflow">switch</span> (argc) {
<a name="l03741"></a>03741       <span class="keywordflow">case</span> 1:
<a name="l03742"></a>03742         <a class="code" href="../../db/d2e/intern_8h.html#ad174dd963d99ac27a67c8ef9cfa1eb58">RETURN_ENUMERATOR</a>(str, argc, argv);
<a name="l03743"></a>03743         iter = 1;
<a name="l03744"></a>03744         <span class="keywordflow">break</span>;
<a name="l03745"></a>03745       <span class="keywordflow">case</span> 2:
<a name="l03746"></a>03746         repl = argv[1];
<a name="l03747"></a>03747         hash = <a class="code" href="../../db/d2e/intern_8h.html#a16e59d05c8eb1641308bc1018c333cc1">rb_check_convert_type</a>(argv[1], <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a8357e81bbb60cb41b0a292a90653a5e5">T_HASH</a>, <span class="stringliteral">&quot;Hash&quot;</span>, <span class="stringliteral">&quot;to_hash&quot;</span>);
<a name="l03748"></a>03748         <span class="keywordflow">if</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a4832bad8845a35fc50f7a160901854a1">NIL_P</a>(hash)) {
<a name="l03749"></a>03749             <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a0e80f207eb41e9010ec9f0f5f9419fea">StringValue</a>(repl);
<a name="l03750"></a>03750         }
<a name="l03751"></a>03751         <span class="keywordflow">if</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a621bc62b1fd82640c1078daf90e1c061">OBJ_TAINTED</a>(repl)) tainted = 1;
<a name="l03752"></a>03752         <span class="keywordflow">break</span>;
<a name="l03753"></a>03753       <span class="keywordflow">default</span>:
<a name="l03754"></a>03754         <a class="code" href="../../db/dcc/error_8c.html#a0f771a2840561f1838169b3d7d4616f3">rb_raise</a>(<a class="code" href="../../db/dcc/error_8c.html#ab5e2a9fec766c75176fbb262bfe6a596">rb_eArgError</a>, <span class="stringliteral">&quot;wrong number of arguments (%d for 1..2)&quot;</span>, argc);
<a name="l03755"></a>03755     }
<a name="l03756"></a>03756 
<a name="l03757"></a>03757     pat = <a class="code" href="../../d1/db0/string_8c.html#a105b63dc9f6f07c8c6403302757e9c96">get_pat</a>(argv[0], 1);
<a name="l03758"></a>03758     beg = <a class="code" href="../../db/db6/re_8h.html#afdf554fa234aebc803c8a4fc98c9936f">rb_reg_search</a>(pat, str, 0, 0);
<a name="l03759"></a>03759     <span class="keywordflow">if</span> (beg &lt; 0) {
<a name="l03760"></a>03760         <span class="keywordflow">if</span> (bang) <span class="keywordflow">return</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a320970f989dc8294c8203154e3db40c1">Qnil</a>;  <span class="comment">/* no match, no substitution */</span>
<a name="l03761"></a>03761         <span class="keywordflow">return</span> <a class="code" href="../../db/d2e/intern_8h.html#ae2843c766c24b80116bb127ebf22d5bf">rb_str_dup</a>(str);
<a name="l03762"></a>03762     }
<a name="l03763"></a>03763 
<a name="l03764"></a>03764     offset = 0;
<a name="l03765"></a>03765     n = 0;
<a name="l03766"></a>03766     blen = <a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(str) + 30; <span class="comment">/* len + margin */</span>
<a name="l03767"></a>03767     dest = <a class="code" href="../../db/d2e/intern_8h.html#a65dee742ae2daaab92ac8974cb2fbff2">rb_str_buf_new</a>(blen);
<a name="l03768"></a>03768     sp = <a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(str);
<a name="l03769"></a>03769     slen = <a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(str);
<a name="l03770"></a>03770     cp = sp;
<a name="l03771"></a>03771     str_enc = <a class="code" href="../../d1/db0/string_8c.html#a123891f9f9b0c87d15621d93b4fa9c41">STR_ENC_GET</a>(str);
<a name="l03772"></a>03772     <a class="code" href="../../d5/db5/encoding_8c.html#a150a6e3ac22ac3be8f8c2ccc74a28e7b">rb_enc_associate</a>(dest, str_enc);
<a name="l03773"></a>03773     <a class="code" href="../../d5/de3/encoding_8h.html#aefe5772c0116cf7131a5227de7243dbc">ENC_CODERANGE_SET</a>(dest, <a class="code" href="../../d5/de3/encoding_8h.html#a8b18a09a3055d3006c6d5baeaa6e7c72">rb_enc_asciicompat</a>(str_enc) ? <a class="code" href="../../d5/de3/encoding_8h.html#a0a0e73a2d98205044e1ad19432502c5b">ENC_CODERANGE_7BIT</a> : <a class="code" href="../../d5/de3/encoding_8h.html#a0c81a12daaa1e57009d46b9d906957dc">ENC_CODERANGE_VALID</a>);
<a name="l03774"></a>03774 
<a name="l03775"></a>03775     <span class="keywordflow">do</span> {
<a name="l03776"></a>03776         n++;
<a name="l03777"></a>03777         match = <a class="code" href="../../db/d2e/intern_8h.html#a2590f9272c0599ff0d1922bd0fb6efce">rb_backref_get</a>();
<a name="l03778"></a>03778         regs = <a class="code" href="../../db/db6/re_8h.html#ad2abd878cfffefaeb1fc24372e80b4c8">RMATCH_REGS</a>(match);
<a name="l03779"></a>03779         beg0 = <a class="code" href="../../dc/d26/re_8c.html#a84a2ca0496ad2a7c4852c539acb90180">BEG</a>(0);
<a name="l03780"></a>03780         end0 = <a class="code" href="../../d5/d9f/escape_8c.html#a29fd18bed01c4d836c7ebfe73a125c3f">END</a>(0);
<a name="l03781"></a>03781         <span class="keywordflow">if</span> (iter || !<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a4832bad8845a35fc50f7a160901854a1">NIL_P</a>(hash)) {
<a name="l03782"></a>03782             <span class="keywordflow">if</span> (iter) {
<a name="l03783"></a>03783                 val = <a class="code" href="../../db/d2e/intern_8h.html#acae5350f5d539c4654e4e33690256a9f">rb_obj_as_string</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#ae6bd0c4ea4db971ebd569ca8f05c6b4a">rb_yield</a>(<a class="code" href="../../db/d2e/intern_8h.html#ac50ab731365028f5efab69c001fba39d">rb_reg_nth_match</a>(0, match)));
<a name="l03784"></a>03784             }
<a name="l03785"></a>03785             <span class="keywordflow">else</span> {
<a name="l03786"></a>03786                 val = <a class="code" href="../../d1/d04/hash_8c.html#ab7063832c7ed02351e87922a78e35c32">rb_hash_aref</a>(hash, <a class="code" href="../../db/d2e/intern_8h.html#aadf59e7cbba9319e199d85ef2448a970">rb_str_subseq</a>(str, <a class="code" href="../../dc/d26/re_8c.html#a84a2ca0496ad2a7c4852c539acb90180">BEG</a>(0), <a class="code" href="../../d5/d9f/escape_8c.html#a29fd18bed01c4d836c7ebfe73a125c3f">END</a>(0) - <a class="code" href="../../dc/d26/re_8c.html#a84a2ca0496ad2a7c4852c539acb90180">BEG</a>(0)));
<a name="l03787"></a>03787                 val = <a class="code" href="../../db/d2e/intern_8h.html#acae5350f5d539c4654e4e33690256a9f">rb_obj_as_string</a>(val);
<a name="l03788"></a>03788             }
<a name="l03789"></a>03789             <a class="code" href="../../d1/db0/string_8c.html#ad2935afc9682c838023639ae7332edad">str_mod_check</a>(str, sp, slen);
<a name="l03790"></a>03790             <span class="keywordflow">if</span> (val == dest) {  <span class="comment">/* paranoid check [ruby-dev:24827] */</span>
<a name="l03791"></a>03791                 <a class="code" href="../../db/dcc/error_8c.html#a0f771a2840561f1838169b3d7d4616f3">rb_raise</a>(<a class="code" href="../../db/dcc/error_8c.html#a95ad3953d535707e2cf2b1d837f5e253">rb_eRuntimeError</a>, <span class="stringliteral">&quot;block should not cheat&quot;</span>);
<a name="l03792"></a>03792             }
<a name="l03793"></a>03793         }
<a name="l03794"></a>03794         <span class="keywordflow">else</span> {
<a name="l03795"></a>03795             val = <a class="code" href="../../db/db6/re_8h.html#a91720053cc149eee23f27597e88df25c">rb_reg_regsub</a>(repl, str, regs, pat);
<a name="l03796"></a>03796         }
<a name="l03797"></a>03797 
<a name="l03798"></a>03798         <span class="keywordflow">if</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a621bc62b1fd82640c1078daf90e1c061">OBJ_TAINTED</a>(val)) tainted = 1;
<a name="l03799"></a>03799 
<a name="l03800"></a>03800         len = beg - offset;     <span class="comment">/* copy pre-match substr */</span>
<a name="l03801"></a>03801         <span class="keywordflow">if</span> (len) {
<a name="l03802"></a>03802             <a class="code" href="../../d5/de3/encoding_8h.html#a850cba00e6c7c1137d5224d4348c7fca">rb_enc_str_buf_cat</a>(dest, cp, len, str_enc);
<a name="l03803"></a>03803         }
<a name="l03804"></a>03804 
<a name="l03805"></a>03805         <a class="code" href="../../db/d2e/intern_8h.html#abea58f4d2559060d5821ff7d3d35a496">rb_str_buf_append</a>(dest, val);
<a name="l03806"></a>03806 
<a name="l03807"></a>03807         last = offset;
<a name="l03808"></a>03808         offset = end0;
<a name="l03809"></a>03809         <span class="keywordflow">if</span> (beg0 == end0) {
<a name="l03810"></a>03810             <span class="comment">/*</span>
<a name="l03811"></a>03811 <span class="comment">             * Always consume at least one character of the input string</span>
<a name="l03812"></a>03812 <span class="comment">             * in order to prevent infinite loops.</span>
<a name="l03813"></a>03813 <span class="comment">             */</span>
<a name="l03814"></a>03814             <span class="keywordflow">if</span> (<a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(str) &lt;= end0) <span class="keywordflow">break</span>;
<a name="l03815"></a>03815             len = <a class="code" href="../../d5/db5/encoding_8c.html#a405ec52962866fac46a16f02f3f92832">rb_enc_fast_mbclen</a>(<a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(str)+end0, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a35bfa2635774977edad0a16b9fdebbaf">RSTRING_END</a>(str), str_enc);
<a name="l03816"></a>03816             <a class="code" href="../../d5/de3/encoding_8h.html#a850cba00e6c7c1137d5224d4348c7fca">rb_enc_str_buf_cat</a>(dest, <a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(str)+end0, len, str_enc);
<a name="l03817"></a>03817             offset = end0 + len;
<a name="l03818"></a>03818         }
<a name="l03819"></a>03819         cp = <a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(str) + offset;
<a name="l03820"></a>03820         <span class="keywordflow">if</span> (offset &gt; <a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(str)) <span class="keywordflow">break</span>;
<a name="l03821"></a>03821         beg = <a class="code" href="../../db/db6/re_8h.html#afdf554fa234aebc803c8a4fc98c9936f">rb_reg_search</a>(pat, str, offset, 0);
<a name="l03822"></a>03822     } <span class="keywordflow">while</span> (beg &gt;= 0);
<a name="l03823"></a>03823     <span class="keywordflow">if</span> (<a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(str) &gt; offset) {
<a name="l03824"></a>03824         <a class="code" href="../../d5/de3/encoding_8h.html#a850cba00e6c7c1137d5224d4348c7fca">rb_enc_str_buf_cat</a>(dest, cp, <a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(str) - offset, str_enc);
<a name="l03825"></a>03825     }
<a name="l03826"></a>03826     <a class="code" href="../../db/db6/re_8h.html#afdf554fa234aebc803c8a4fc98c9936f">rb_reg_search</a>(pat, str, last, 0);
<a name="l03827"></a>03827     <span class="keywordflow">if</span> (bang) {
<a name="l03828"></a>03828         <a class="code" href="../../db/d2e/intern_8h.html#a284132f9d055bd8adef45b71f26ee6ae">rb_str_shared_replace</a>(str, dest);
<a name="l03829"></a>03829     }
<a name="l03830"></a>03830     <span class="keywordflow">else</span> {
<a name="l03831"></a>03831         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a1d4c05021aacd8cab989ff60f95ebe2d">RBASIC</a>(dest)-&gt;klass = <a class="code" href="../../db/d2e/intern_8h.html#ac2be7243e739fa8f5dce6be0c8ee5f6d">rb_obj_class</a>(str);
<a name="l03832"></a>03832         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3bf9ab455a1e0e3e8cfc6ebabd8f12df">OBJ_INFECT</a>(dest, str);
<a name="l03833"></a>03833         str = dest;
<a name="l03834"></a>03834     }
<a name="l03835"></a>03835 
<a name="l03836"></a>03836     <span class="keywordflow">if</span> (tainted) <a class="code" href="../../de/de6/ruby_2ruby_8h.html#afd75ea0cb81c17e76c73e593d1d8a860">OBJ_TAINT</a>(str);
<a name="l03837"></a>03837     <span class="keywordflow">return</span> str;
<a name="l03838"></a>03838 }
<a name="l03839"></a>03839 
<a name="l03840"></a>03840 
<a name="l03841"></a>03841 <span class="comment">/*</span>
<a name="l03842"></a>03842 <span class="comment"> *  call-seq:</span>
<a name="l03843"></a>03843 <span class="comment"> *     str.gsub!(pattern, replacement)        -&gt; str or nil</span>
<a name="l03844"></a>03844 <span class="comment"> *     str.gsub!(pattern) {|match| block }    -&gt; str or nil</span>
<a name="l03845"></a>03845 <span class="comment"> *     str.gsub!(pattern)                     -&gt; an_enumerator</span>
<a name="l03846"></a>03846 <span class="comment"> *</span>
<a name="l03847"></a>03847 <span class="comment"> *  Performs the substitutions of &lt;code&gt;String#gsub&lt;/code&gt; in place, returning</span>
<a name="l03848"></a>03848 <span class="comment"> *  &lt;i&gt;str&lt;/i&gt;, or &lt;code&gt;nil&lt;/code&gt; if no substitutions were performed.</span>
<a name="l03849"></a>03849 <span class="comment"> *  If no block and no &lt;i&gt;replacement&lt;/i&gt; is given, an enumerator is returned instead.</span>
<a name="l03850"></a>03850 <span class="comment"> */</span>
<a name="l03851"></a>03851 
<a name="l03852"></a>03852 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l03853"></a><a class="code" href="../../d1/db0/string_8c.html#a6a6624a0d853034b871f693a3cef30fc">03853</a> <a class="code" href="../../d1/db0/string_8c.html#a6a6624a0d853034b871f693a3cef30fc">rb_str_gsub_bang</a>(<span class="keywordtype">int</span> <a class="code" href="../../df/d77/ruby_8c.html#ad1447518f4372828b8435ae82e48499e">argc</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> *<a class="code" href="../../df/d77/ruby_8c.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str)
<a name="l03854"></a>03854 {
<a name="l03855"></a>03855     <a class="code" href="../../d1/db0/string_8c.html#a106a1166130a12736cf57bacc164e4a5">str_modify_keep_cr</a>(str);
<a name="l03856"></a>03856     <span class="keywordflow">return</span> <a class="code" href="../../d1/db0/string_8c.html#a4fb451b31e6d39d5d4a9004fbc6bc5f7">str_gsub</a>(argc, argv, str, 1);
<a name="l03857"></a>03857 }
<a name="l03858"></a>03858 
<a name="l03859"></a>03859 
<a name="l03860"></a>03860 <span class="comment">/*</span>
<a name="l03861"></a>03861 <span class="comment"> *  call-seq:</span>
<a name="l03862"></a>03862 <span class="comment"> *     str.gsub(pattern, replacement)       -&gt; new_str</span>
<a name="l03863"></a>03863 <span class="comment"> *     str.gsub(pattern, hash)              -&gt; new_str</span>
<a name="l03864"></a>03864 <span class="comment"> *     str.gsub(pattern) {|match| block }   -&gt; new_str</span>
<a name="l03865"></a>03865 <span class="comment"> *     str.gsub(pattern)                    -&gt; enumerator</span>
<a name="l03866"></a>03866 <span class="comment"> *</span>
<a name="l03867"></a>03867 <span class="comment"> *  Returns a copy of &lt;i&gt;str&lt;/i&gt; with the &lt;em&gt;all&lt;/em&gt; occurrences of</span>
<a name="l03868"></a>03868 <span class="comment"> *  &lt;i&gt;pattern&lt;/i&gt; substituted for the second argument. The &lt;i&gt;pattern&lt;/i&gt; is</span>
<a name="l03869"></a>03869 <span class="comment"> *  typically a &lt;code&gt;Regexp&lt;/code&gt;; if given as a &lt;code&gt;String&lt;/code&gt;, any</span>
<a name="l03870"></a>03870 <span class="comment"> *  regular expression metacharacters it contains will be interpreted</span>
<a name="l03871"></a>03871 <span class="comment"> *  literally, e.g. &lt;code&gt;&apos;\\\d&apos;&lt;/code&gt; will match a backlash followed by &apos;d&apos;,</span>
<a name="l03872"></a>03872 <span class="comment"> *  instead of a digit.</span>
<a name="l03873"></a>03873 <span class="comment"> *</span>
<a name="l03874"></a>03874 <span class="comment"> *  If &lt;i&gt;replacement&lt;/i&gt; is a &lt;code&gt;String&lt;/code&gt; it will be substituted for</span>
<a name="l03875"></a>03875 <span class="comment"> *  the matched text. It may contain back-references to the pattern&apos;s capture</span>
<a name="l03876"></a>03876 <span class="comment"> *  groups of the form &lt;code&gt;\\\d&lt;/code&gt;, where &lt;i&gt;d&lt;/i&gt; is a group number, or</span>
<a name="l03877"></a>03877 <span class="comment"> *  &lt;code&gt;\\\k&lt;n&gt;&lt;/code&gt;, where &lt;i&gt;n&lt;/i&gt; is a group name. If it is a</span>
<a name="l03878"></a>03878 <span class="comment"> *  double-quoted string, both back-references must be preceded by an</span>
<a name="l03879"></a>03879 <span class="comment"> *  additional backslash. However, within &lt;i&gt;replacement&lt;/i&gt; the special match</span>
<a name="l03880"></a>03880 <span class="comment"> *  variables, such as &lt;code&gt;&amp;$&lt;/code&gt;, will not refer to the current match.</span>
<a name="l03881"></a>03881 <span class="comment"> *</span>
<a name="l03882"></a>03882 <span class="comment"> *  If the second argument is a &lt;code&gt;Hash&lt;/code&gt;, and the matched text is one</span>
<a name="l03883"></a>03883 <span class="comment"> *  of its keys, the corresponding value is the replacement string.</span>
<a name="l03884"></a>03884 <span class="comment"> *</span>
<a name="l03885"></a>03885 <span class="comment"> *  In the block form, the current match string is passed in as a parameter,</span>
<a name="l03886"></a>03886 <span class="comment"> *  and variables such as &lt;code&gt;$1&lt;/code&gt;, &lt;code&gt;$2&lt;/code&gt;, &lt;code&gt;$`&lt;/code&gt;,</span>
<a name="l03887"></a>03887 <span class="comment"> *  &lt;code&gt;$&amp;&lt;/code&gt;, and &lt;code&gt;$&apos;&lt;/code&gt; will be set appropriately. The value</span>
<a name="l03888"></a>03888 <span class="comment"> *  returned by the block will be substituted for the match on each call.</span>
<a name="l03889"></a>03889 <span class="comment"> *</span>
<a name="l03890"></a>03890 <span class="comment"> *  The result inherits any tainting in the original string or any supplied</span>
<a name="l03891"></a>03891 <span class="comment"> *  replacement string.</span>
<a name="l03892"></a>03892 <span class="comment"> *</span>
<a name="l03893"></a>03893 <span class="comment"> *  When neither a block nor a second argument is supplied, an</span>
<a name="l03894"></a>03894 <span class="comment"> *  &lt;code&gt;Enumerator&lt;/code&gt; is returned.</span>
<a name="l03895"></a>03895 <span class="comment"> *</span>
<a name="l03896"></a>03896 <span class="comment"> *     &quot;hello&quot;.gsub(/[aeiou]/, &apos;*&apos;)                  #=&gt; &quot;h*ll*&quot;</span>
<a name="l03897"></a>03897 <span class="comment"> *     &quot;hello&quot;.gsub(/([aeiou])/, &apos;&lt;\1&gt;&apos;)             #=&gt; &quot;h&lt;e&gt;ll&lt;o&gt;&quot;</span>
<a name="l03898"></a>03898 <span class="comment"> *     &quot;hello&quot;.gsub(/./) {|s| s.ord.to_s + &apos; &apos;}      #=&gt; &quot;104 101 108 108 111 &quot;</span>
<a name="l03899"></a>03899 <span class="comment"> *     &quot;hello&quot;.gsub(/(?&lt;foo&gt;[aeiou])/, &apos;{\k&lt;foo&gt;}&apos;)  #=&gt; &quot;h{e}ll{o}&quot;</span>
<a name="l03900"></a>03900 <span class="comment"> *     &apos;hello&apos;.gsub(/[eo]/, &apos;e&apos; =&gt; 3, &apos;o&apos; =&gt; &apos;*&apos;)    #=&gt; &quot;h3ll*&quot;</span>
<a name="l03901"></a>03901 <span class="comment"> */</span>
<a name="l03902"></a>03902 
<a name="l03903"></a>03903 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l03904"></a><a class="code" href="../../d1/db0/string_8c.html#ac0dafbe9c9b45d62e448036acb135bea">03904</a> <a class="code" href="../../d1/db0/string_8c.html#ac0dafbe9c9b45d62e448036acb135bea">rb_str_gsub</a>(<span class="keywordtype">int</span> <a class="code" href="../../df/d77/ruby_8c.html#ad1447518f4372828b8435ae82e48499e">argc</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> *<a class="code" href="../../df/d77/ruby_8c.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str)
<a name="l03905"></a>03905 {
<a name="l03906"></a>03906     <span class="keywordflow">return</span> <a class="code" href="../../d1/db0/string_8c.html#a4fb451b31e6d39d5d4a9004fbc6bc5f7">str_gsub</a>(argc, argv, str, 0);
<a name="l03907"></a>03907 }
<a name="l03908"></a>03908 
<a name="l03909"></a>03909 
<a name="l03910"></a>03910 <span class="comment">/*</span>
<a name="l03911"></a>03911 <span class="comment"> *  call-seq:</span>
<a name="l03912"></a>03912 <span class="comment"> *     str.replace(other_str)   -&gt; str</span>
<a name="l03913"></a>03913 <span class="comment"> *</span>
<a name="l03914"></a>03914 <span class="comment"> *  Replaces the contents and taintedness of &lt;i&gt;str&lt;/i&gt; with the corresponding</span>
<a name="l03915"></a>03915 <span class="comment"> *  values in &lt;i&gt;other_str&lt;/i&gt;.</span>
<a name="l03916"></a>03916 <span class="comment"> *</span>
<a name="l03917"></a>03917 <span class="comment"> *     s = &quot;hello&quot;         #=&gt; &quot;hello&quot;</span>
<a name="l03918"></a>03918 <span class="comment"> *     s.replace &quot;world&quot;   #=&gt; &quot;world&quot;</span>
<a name="l03919"></a>03919 <span class="comment"> */</span>
<a name="l03920"></a>03920 
<a name="l03921"></a>03921 <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l03922"></a><a class="code" href="../../d1/db0/string_8c.html#a8ef735a6b86ff7b6e5e1dab0d4dfd95d">03922</a> <a class="code" href="../../db/d2e/intern_8h.html#a5ea7db726948a2669aaa95cff05e050b">rb_str_replace</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str2)
<a name="l03923"></a>03923 {
<a name="l03924"></a>03924     <a class="code" href="../../d1/db0/string_8c.html#a865d4f66b7c8fca1f7fd9afa3298a56e">str_modifiable</a>(str);
<a name="l03925"></a>03925     <span class="keywordflow">if</span> (str == str2) <span class="keywordflow">return</span> str;
<a name="l03926"></a>03926 
<a name="l03927"></a>03927     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a0e80f207eb41e9010ec9f0f5f9419fea">StringValue</a>(str2);
<a name="l03928"></a>03928     <a class="code" href="../../d1/db0/string_8c.html#a9324063c75002bd7b4cc10d80b77fff7">str_discard</a>(str);
<a name="l03929"></a>03929     <span class="keywordflow">return</span> <a class="code" href="../../d1/db0/string_8c.html#a357da4e1cf3dd6b4df807598603187ea">str_replace</a>(str, str2);
<a name="l03930"></a>03930 }
<a name="l03931"></a>03931 
<a name="l03932"></a>03932 <span class="comment">/*</span>
<a name="l03933"></a>03933 <span class="comment"> *  call-seq:</span>
<a name="l03934"></a>03934 <span class="comment"> *     string.clear    -&gt;  string</span>
<a name="l03935"></a>03935 <span class="comment"> *</span>
<a name="l03936"></a>03936 <span class="comment"> *  Makes string empty.</span>
<a name="l03937"></a>03937 <span class="comment"> *</span>
<a name="l03938"></a>03938 <span class="comment"> *     a = &quot;abcde&quot;</span>
<a name="l03939"></a>03939 <span class="comment"> *     a.clear    #=&gt; &quot;&quot;</span>
<a name="l03940"></a>03940 <span class="comment"> */</span>
<a name="l03941"></a>03941 
<a name="l03942"></a>03942 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l03943"></a><a class="code" href="../../d1/db0/string_8c.html#ac5e2b2bfc50705ecea86d699d1a8dc15">03943</a> <a class="code" href="../../d1/db0/string_8c.html#ac5e2b2bfc50705ecea86d699d1a8dc15">rb_str_clear</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str)
<a name="l03944"></a>03944 {
<a name="l03945"></a>03945     <a class="code" href="../../d1/db0/string_8c.html#a9324063c75002bd7b4cc10d80b77fff7">str_discard</a>(str);
<a name="l03946"></a>03946     <a class="code" href="../../d1/db0/string_8c.html#a598a41ca866cde6d9854bf77f48b006d">STR_SET_EMBED</a>(str);
<a name="l03947"></a>03947     <a class="code" href="../../d1/db0/string_8c.html#ac1f52d89a2e4d0dda456490dcfe70993">STR_SET_EMBED_LEN</a>(str, 0);
<a name="l03948"></a>03948     <a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(str)[0] = 0;
<a name="l03949"></a>03949     <span class="keywordflow">if</span> (<a class="code" href="../../d5/de3/encoding_8h.html#a8b18a09a3055d3006c6d5baeaa6e7c72">rb_enc_asciicompat</a>(<a class="code" href="../../d1/db0/string_8c.html#a123891f9f9b0c87d15621d93b4fa9c41">STR_ENC_GET</a>(str)))
<a name="l03950"></a>03950         <a class="code" href="../../d5/de3/encoding_8h.html#aefe5772c0116cf7131a5227de7243dbc">ENC_CODERANGE_SET</a>(str, <a class="code" href="../../d5/de3/encoding_8h.html#a0a0e73a2d98205044e1ad19432502c5b">ENC_CODERANGE_7BIT</a>);
<a name="l03951"></a>03951     <span class="keywordflow">else</span>
<a name="l03952"></a>03952         <a class="code" href="../../d5/de3/encoding_8h.html#aefe5772c0116cf7131a5227de7243dbc">ENC_CODERANGE_SET</a>(str, <a class="code" href="../../d5/de3/encoding_8h.html#a0c81a12daaa1e57009d46b9d906957dc">ENC_CODERANGE_VALID</a>);
<a name="l03953"></a>03953     <span class="keywordflow">return</span> str;
<a name="l03954"></a>03954 }
<a name="l03955"></a>03955 
<a name="l03956"></a>03956 <span class="comment">/*</span>
<a name="l03957"></a>03957 <span class="comment"> *  call-seq:</span>
<a name="l03958"></a>03958 <span class="comment"> *     string.chr    -&gt;  string</span>
<a name="l03959"></a>03959 <span class="comment"> *</span>
<a name="l03960"></a>03960 <span class="comment"> *  Returns a one-character string at the beginning of the string.</span>
<a name="l03961"></a>03961 <span class="comment"> *</span>
<a name="l03962"></a>03962 <span class="comment"> *     a = &quot;abcde&quot;</span>
<a name="l03963"></a>03963 <span class="comment"> *     a.chr    #=&gt; &quot;a&quot;</span>
<a name="l03964"></a>03964 <span class="comment"> */</span>
<a name="l03965"></a>03965 
<a name="l03966"></a>03966 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l03967"></a><a class="code" href="../../d1/db0/string_8c.html#af960db48298648eb048ef73261ec3cd2">03967</a> <a class="code" href="../../d1/db0/string_8c.html#af960db48298648eb048ef73261ec3cd2">rb_str_chr</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str)
<a name="l03968"></a>03968 {
<a name="l03969"></a>03969     <span class="keywordflow">return</span> <a class="code" href="../../db/d2e/intern_8h.html#a61efad31b183f52fe068b4c0daf8fdd9">rb_str_substr</a>(str, 0, 1);
<a name="l03970"></a>03970 }
<a name="l03971"></a>03971 
<a name="l03972"></a>03972 <span class="comment">/*</span>
<a name="l03973"></a>03973 <span class="comment"> *  call-seq:</span>
<a name="l03974"></a>03974 <span class="comment"> *     str.getbyte(index)          -&gt; 0 .. 255</span>
<a name="l03975"></a>03975 <span class="comment"> *</span>
<a name="l03976"></a>03976 <span class="comment"> *  returns the &lt;i&gt;index&lt;/i&gt;th byte as an integer.</span>
<a name="l03977"></a>03977 <span class="comment"> */</span>
<a name="l03978"></a>03978 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l03979"></a><a class="code" href="../../d1/db0/string_8c.html#a777401f2d7d017824f5c2ed1a585e9f0">03979</a> <a class="code" href="../../d1/db0/string_8c.html#a777401f2d7d017824f5c2ed1a585e9f0">rb_str_getbyte</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> index)
<a name="l03980"></a>03980 {
<a name="l03981"></a>03981     <span class="keywordtype">long</span> pos = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a93f154f3dcc08027f475bf0c3cc287bd">NUM2LONG</a>(index);
<a name="l03982"></a>03982 
<a name="l03983"></a>03983     <span class="keywordflow">if</span> (pos &lt; 0)
<a name="l03984"></a>03984         pos += <a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(str);
<a name="l03985"></a>03985     <span class="keywordflow">if</span> (pos &lt; 0 ||  <a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(str) &lt;= pos)
<a name="l03986"></a>03986         <span class="keywordflow">return</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a320970f989dc8294c8203154e3db40c1">Qnil</a>;
<a name="l03987"></a>03987 
<a name="l03988"></a>03988     <span class="keywordflow">return</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>((<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)<a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(str)[pos]);
<a name="l03989"></a>03989 }
<a name="l03990"></a>03990 
<a name="l03991"></a>03991 <span class="comment">/*</span>
<a name="l03992"></a>03992 <span class="comment"> *  call-seq:</span>
<a name="l03993"></a>03993 <span class="comment"> *     str.setbyte(index, int) -&gt; int</span>
<a name="l03994"></a>03994 <span class="comment"> *</span>
<a name="l03995"></a>03995 <span class="comment"> *  modifies the &lt;i&gt;index&lt;/i&gt;th byte as &lt;i&gt;int&lt;/i&gt;.</span>
<a name="l03996"></a>03996 <span class="comment"> */</span>
<a name="l03997"></a>03997 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l03998"></a><a class="code" href="../../d1/db0/string_8c.html#acddb22812eb2b5f5983a7389303ceae6">03998</a> <a class="code" href="../../d1/db0/string_8c.html#acddb22812eb2b5f5983a7389303ceae6">rb_str_setbyte</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> index, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> value)
<a name="l03999"></a>03999 {
<a name="l04000"></a>04000     <span class="keywordtype">long</span> pos = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a93f154f3dcc08027f475bf0c3cc287bd">NUM2LONG</a>(index);
<a name="l04001"></a>04001     <span class="keywordtype">int</span> byte = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a877c38180d23c5447d976c70dda89d69">NUM2INT</a>(value);
<a name="l04002"></a>04002 
<a name="l04003"></a>04003     <a class="code" href="../../db/d2e/intern_8h.html#a63a6d05687cf812131dce11743581b9d">rb_str_modify</a>(str);
<a name="l04004"></a>04004 
<a name="l04005"></a>04005     <span class="keywordflow">if</span> (pos &lt; -<a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(str) || <a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(str) &lt;= pos)
<a name="l04006"></a>04006         <a class="code" href="../../db/dcc/error_8c.html#a0f771a2840561f1838169b3d7d4616f3">rb_raise</a>(<a class="code" href="../../db/dcc/error_8c.html#ac80019ce275be87f28c42761abe460ee">rb_eIndexError</a>, <span class="stringliteral">&quot;index %ld out of string&quot;</span>, pos);
<a name="l04007"></a>04007     <span class="keywordflow">if</span> (pos &lt; 0)
<a name="l04008"></a>04008         pos += <a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(str);
<a name="l04009"></a>04009 
<a name="l04010"></a>04010     <a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(str)[pos] = byte;
<a name="l04011"></a>04011 
<a name="l04012"></a>04012     <span class="keywordflow">return</span> value;
<a name="l04013"></a>04013 }
<a name="l04014"></a>04014 
<a name="l04015"></a>04015 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l04016"></a><a class="code" href="../../d1/db0/string_8c.html#aae2425f624a9539b6586019cfafeead0">04016</a> <a class="code" href="../../d1/db0/string_8c.html#aae2425f624a9539b6586019cfafeead0">str_byte_substr</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str, <span class="keywordtype">long</span> <a class="code" href="../../d6/d14/structre__registers.html#a4eb5968ed5cce3e60715b734f86e0b70">beg</a>, <span class="keywordtype">long</span> len)
<a name="l04017"></a>04017 {
<a name="l04018"></a>04018     <span class="keywordtype">char</span> *p, *s = <a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(str);
<a name="l04019"></a>04019     <span class="keywordtype">long</span> n = <a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(str);
<a name="l04020"></a>04020     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str2;
<a name="l04021"></a>04021 
<a name="l04022"></a>04022     <span class="keywordflow">if</span> (beg &gt; n || len &lt; 0) <span class="keywordflow">return</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a320970f989dc8294c8203154e3db40c1">Qnil</a>;
<a name="l04023"></a>04023     <span class="keywordflow">if</span> (beg &lt; 0) {
<a name="l04024"></a>04024         beg += n;
<a name="l04025"></a>04025         <span class="keywordflow">if</span> (beg &lt; 0) <span class="keywordflow">return</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a320970f989dc8294c8203154e3db40c1">Qnil</a>;
<a name="l04026"></a>04026     }
<a name="l04027"></a>04027     <span class="keywordflow">if</span> (beg + len &gt; n)
<a name="l04028"></a>04028         len = n - beg;
<a name="l04029"></a>04029     <span class="keywordflow">if</span> (len &lt;= 0) {
<a name="l04030"></a>04030         len = 0;
<a name="l04031"></a>04031         p = 0;
<a name="l04032"></a>04032     }
<a name="l04033"></a>04033     <span class="keywordflow">else</span>
<a name="l04034"></a>04034         p = s + beg;
<a name="l04035"></a>04035 
<a name="l04036"></a>04036     <span class="keywordflow">if</span> (len &gt; <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a92657ad1be8a8a323df19648e33b47b5">RSTRING_EMBED_LEN_MAX</a> &amp;&amp; beg + len == n) {
<a name="l04037"></a>04037         str2 = <a class="code" href="../../db/d2e/intern_8h.html#af609add406b0ef084a38f6dd615119d6">rb_str_new4</a>(str);
<a name="l04038"></a>04038         str2 = <a class="code" href="../../d1/db0/string_8c.html#a4d8a594117e1ef7b3ca1b0466b384256">str_new3</a>(<a class="code" href="../../db/d2e/intern_8h.html#ac2be7243e739fa8f5dce6be0c8ee5f6d">rb_obj_class</a>(str2), str2);
<a name="l04039"></a>04039         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac695b0c61b18410ebcf22584fe0a6f6f">RSTRING</a>(str2)-&gt;as.heap.ptr += <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac695b0c61b18410ebcf22584fe0a6f6f">RSTRING</a>(str2)-&gt;as.heap.len - len;
<a name="l04040"></a>04040         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac695b0c61b18410ebcf22584fe0a6f6f">RSTRING</a>(str2)-&gt;as.heap.len = len;
<a name="l04041"></a>04041     }
<a name="l04042"></a>04042     <span class="keywordflow">else</span> {
<a name="l04043"></a>04043         str2 = <a class="code" href="../../db/d2e/intern_8h.html#a70b7301e6960c402803fa81c7a0777d0">rb_str_new5</a>(str, p, len);
<a name="l04044"></a>04044         <a class="code" href="../../d1/db0/string_8c.html#a52e3afb878f939e397b9443c8e082c54">rb_enc_cr_str_copy_for_substr</a>(str2, str);
<a name="l04045"></a>04045         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3bf9ab455a1e0e3e8cfc6ebabd8f12df">OBJ_INFECT</a>(str2, str);
<a name="l04046"></a>04046     }
<a name="l04047"></a>04047 
<a name="l04048"></a>04048     <span class="keywordflow">return</span> str2;
<a name="l04049"></a>04049 }
<a name="l04050"></a>04050 
<a name="l04051"></a>04051 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l04052"></a><a class="code" href="../../d1/db0/string_8c.html#a15fd2dabb18a40416c675e2aebfdf24f">04052</a> <a class="code" href="../../d1/db0/string_8c.html#a15fd2dabb18a40416c675e2aebfdf24f">str_byte_aref</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> indx)
<a name="l04053"></a>04053 {
<a name="l04054"></a>04054     <span class="keywordtype">long</span> idx;
<a name="l04055"></a>04055     <span class="keywordflow">switch</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a394faf7191f18552a20cb17ce14226f0">TYPE</a>(indx)) {
<a name="l04056"></a>04056       <span class="keywordflow">case</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a523855de5546c34061e030f4606db3e9">T_FIXNUM</a>:
<a name="l04057"></a>04057         idx = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ae9390780cd6d04a2e0ac3d6282cdefea">FIX2LONG</a>(indx);
<a name="l04058"></a>04058 
<a name="l04059"></a>04059       num_index:
<a name="l04060"></a>04060         str = <a class="code" href="../../d1/db0/string_8c.html#aae2425f624a9539b6586019cfafeead0">str_byte_substr</a>(str, idx, 1);
<a name="l04061"></a>04061         <span class="keywordflow">if</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a4832bad8845a35fc50f7a160901854a1">NIL_P</a>(str) || <a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(str) == 0) <span class="keywordflow">return</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a320970f989dc8294c8203154e3db40c1">Qnil</a>;
<a name="l04062"></a>04062         <span class="keywordflow">return</span> str;
<a name="l04063"></a>04063 
<a name="l04064"></a>04064       <span class="keywordflow">default</span>:
<a name="l04065"></a>04065         <span class="comment">/* check if indx is Range */</span>
<a name="l04066"></a>04066         {
<a name="l04067"></a>04067             <span class="keywordtype">long</span> <a class="code" href="../../d6/d14/structre__registers.html#a4eb5968ed5cce3e60715b734f86e0b70">beg</a>, len = <a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(str);
<a name="l04068"></a>04068 
<a name="l04069"></a>04069             <span class="keywordflow">switch</span> (<a class="code" href="../../db/d2e/intern_8h.html#a2f31a8c5a891cd7eb0c42ed0b385091b">rb_range_beg_len</a>(indx, &amp;beg, &amp;len, len, 0)) {
<a name="l04070"></a>04070               <span class="keywordflow">case</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aba0717d2689eb68797421a02ab9295c6">Qfalse</a>:
<a name="l04071"></a>04071                 <span class="keywordflow">break</span>;
<a name="l04072"></a>04072               <span class="keywordflow">case</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a320970f989dc8294c8203154e3db40c1">Qnil</a>:
<a name="l04073"></a>04073                 <span class="keywordflow">return</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a320970f989dc8294c8203154e3db40c1">Qnil</a>;
<a name="l04074"></a>04074               <span class="keywordflow">default</span>:
<a name="l04075"></a>04075                 <span class="keywordflow">return</span> <a class="code" href="../../d1/db0/string_8c.html#aae2425f624a9539b6586019cfafeead0">str_byte_substr</a>(str, beg, len);
<a name="l04076"></a>04076             }
<a name="l04077"></a>04077         }
<a name="l04078"></a>04078         idx = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a93f154f3dcc08027f475bf0c3cc287bd">NUM2LONG</a>(indx);
<a name="l04079"></a>04079         <span class="keywordflow">goto</span> num_index;
<a name="l04080"></a>04080     }
<a name="l04081"></a>04081     <span class="keywordflow">return</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a320970f989dc8294c8203154e3db40c1">Qnil</a>;                <span class="comment">/* not reached */</span>
<a name="l04082"></a>04082 }
<a name="l04083"></a>04083 
<a name="l04084"></a>04084 <span class="comment">/*</span>
<a name="l04085"></a>04085 <span class="comment"> *  call-seq:</span>
<a name="l04086"></a>04086 <span class="comment"> *     str.byteslice(fixnum)           -&gt; new_str or nil</span>
<a name="l04087"></a>04087 <span class="comment"> *     str.byteslice(fixnum, fixnum)   -&gt; new_str or nil</span>
<a name="l04088"></a>04088 <span class="comment"> *     str.byteslice(range)            -&gt; new_str or nil</span>
<a name="l04089"></a>04089 <span class="comment"> *</span>
<a name="l04090"></a>04090 <span class="comment"> *  Byte Reference---If passed a single &lt;code&gt;Fixnum&lt;/code&gt;, returns a</span>
<a name="l04091"></a>04091 <span class="comment"> *  substring of one byte at that position. If passed two &lt;code&gt;Fixnum&lt;/code&gt;</span>
<a name="l04092"></a>04092 <span class="comment"> *  objects, returns a substring starting at the offset given by the first, and</span>
<a name="l04093"></a>04093 <span class="comment"> *  a length given by the second. If given a &lt;code&gt;Range&lt;/code&gt;, a substring containing</span>
<a name="l04094"></a>04094 <span class="comment"> *  bytes at offsets given by the range is returned. In all three cases, if</span>
<a name="l04095"></a>04095 <span class="comment"> *  an offset is negative, it is counted from the end of &lt;i&gt;str&lt;/i&gt;. Returns</span>
<a name="l04096"></a>04096 <span class="comment"> *  &lt;code&gt;nil&lt;/code&gt; if the initial offset falls outside the string, the length</span>
<a name="l04097"></a>04097 <span class="comment"> *  is negative, or the beginning of the range is greater than the end.</span>
<a name="l04098"></a>04098 <span class="comment"> *  The encoding of the resulted string keeps original encoding.</span>
<a name="l04099"></a>04099 <span class="comment"> *</span>
<a name="l04100"></a>04100 <span class="comment"> *     &quot;hello&quot;.byteslice(1)     #=&gt; &quot;e&quot;</span>
<a name="l04101"></a>04101 <span class="comment"> *     &quot;hello&quot;.byteslice(-1)    #=&gt; &quot;o&quot;</span>
<a name="l04102"></a>04102 <span class="comment"> *     &quot;hello&quot;.byteslice(1, 2)  #=&gt; &quot;el&quot;</span>
<a name="l04103"></a>04103 <span class="comment"> *     &quot;\x80\u3042&quot;.byteslice(1, 3) #=&gt; &quot;\u3042&quot;</span>
<a name="l04104"></a>04104 <span class="comment"> *     &quot;\x03\u3042\xff&quot;.byteslice(1..3) #=&gt; &quot;\u3942&quot;</span>
<a name="l04105"></a>04105 <span class="comment"> */</span>
<a name="l04106"></a>04106 
<a name="l04107"></a>04107 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l04108"></a><a class="code" href="../../d1/db0/string_8c.html#ab31546946c7e1a879fd3b057f66dcd6a">04108</a> <a class="code" href="../../d1/db0/string_8c.html#ab31546946c7e1a879fd3b057f66dcd6a">rb_str_byteslice</a>(<span class="keywordtype">int</span> <a class="code" href="../../df/d77/ruby_8c.html#ad1447518f4372828b8435ae82e48499e">argc</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> *<a class="code" href="../../df/d77/ruby_8c.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str)
<a name="l04109"></a>04109 {
<a name="l04110"></a>04110     <span class="keywordflow">if</span> (argc == 2) {
<a name="l04111"></a>04111         <span class="keywordflow">return</span> <a class="code" href="../../d1/db0/string_8c.html#aae2425f624a9539b6586019cfafeead0">str_byte_substr</a>(str, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a93f154f3dcc08027f475bf0c3cc287bd">NUM2LONG</a>(argv[0]), <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a93f154f3dcc08027f475bf0c3cc287bd">NUM2LONG</a>(argv[1]));
<a name="l04112"></a>04112     }
<a name="l04113"></a>04113     <span class="keywordflow">if</span> (argc != 1) {
<a name="l04114"></a>04114         <a class="code" href="../../db/dcc/error_8c.html#a0f771a2840561f1838169b3d7d4616f3">rb_raise</a>(<a class="code" href="../../db/dcc/error_8c.html#ab5e2a9fec766c75176fbb262bfe6a596">rb_eArgError</a>, <span class="stringliteral">&quot;wrong number of arguments (%d for 1..2)&quot;</span>, argc);
<a name="l04115"></a>04115     }
<a name="l04116"></a>04116     <span class="keywordflow">return</span> <a class="code" href="../../d1/db0/string_8c.html#a15fd2dabb18a40416c675e2aebfdf24f">str_byte_aref</a>(str, argv[0]);
<a name="l04117"></a>04117 }
<a name="l04118"></a>04118 
<a name="l04119"></a>04119 <span class="comment">/*</span>
<a name="l04120"></a>04120 <span class="comment"> *  call-seq:</span>
<a name="l04121"></a>04121 <span class="comment"> *     str.reverse   -&gt; new_str</span>
<a name="l04122"></a>04122 <span class="comment"> *</span>
<a name="l04123"></a>04123 <span class="comment"> *  Returns a new string with the characters from &lt;i&gt;str&lt;/i&gt; in reverse order.</span>
<a name="l04124"></a>04124 <span class="comment"> *</span>
<a name="l04125"></a>04125 <span class="comment"> *     &quot;stressed&quot;.reverse   #=&gt; &quot;desserts&quot;</span>
<a name="l04126"></a>04126 <span class="comment"> */</span>
<a name="l04127"></a>04127 
<a name="l04128"></a>04128 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l04129"></a><a class="code" href="../../d1/db0/string_8c.html#ac381b14f2caf5dcb210c43d0df62f018">04129</a> <a class="code" href="../../d1/db0/string_8c.html#ac381b14f2caf5dcb210c43d0df62f018">rb_str_reverse</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str)
<a name="l04130"></a>04130 {
<a name="l04131"></a>04131     <a class="code" href="../../d1/d7b/struct_onig_encoding_type_s_t.html">rb_encoding</a> *enc;
<a name="l04132"></a>04132     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> rev;
<a name="l04133"></a>04133     <span class="keywordtype">char</span> *s, *e, *p;
<a name="l04134"></a>04134     <span class="keywordtype">int</span> single = 1;
<a name="l04135"></a>04135 
<a name="l04136"></a>04136     <span class="keywordflow">if</span> (<a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(str) &lt;= 1) <span class="keywordflow">return</span> <a class="code" href="../../db/d2e/intern_8h.html#ae2843c766c24b80116bb127ebf22d5bf">rb_str_dup</a>(str);
<a name="l04137"></a>04137     enc = <a class="code" href="../../d1/db0/string_8c.html#a123891f9f9b0c87d15621d93b4fa9c41">STR_ENC_GET</a>(str);
<a name="l04138"></a>04138     rev = <a class="code" href="../../db/d2e/intern_8h.html#a70b7301e6960c402803fa81c7a0777d0">rb_str_new5</a>(str, 0, <a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(str));
<a name="l04139"></a>04139     s = <a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(str); e = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a35bfa2635774977edad0a16b9fdebbaf">RSTRING_END</a>(str);
<a name="l04140"></a>04140     p = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a35bfa2635774977edad0a16b9fdebbaf">RSTRING_END</a>(rev);
<a name="l04141"></a>04141 
<a name="l04142"></a>04142     <span class="keywordflow">if</span> (<a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(str) &gt; 1) {
<a name="l04143"></a>04143         <span class="keywordflow">if</span> (<a class="code" href="../../d1/db0/string_8c.html#a5ab3c8112c2ec6943bdae8a2036fca02">single_byte_optimizable</a>(str)) {
<a name="l04144"></a>04144             <span class="keywordflow">while</span> (s &lt; e) {
<a name="l04145"></a>04145                 *--p = *s++;
<a name="l04146"></a>04146             }
<a name="l04147"></a>04147         }
<a name="l04148"></a>04148         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d5/de3/encoding_8h.html#a5901233f6f9004aebbdeccdd33cf449f">ENC_CODERANGE</a>(str) == <a class="code" href="../../d5/de3/encoding_8h.html#a0c81a12daaa1e57009d46b9d906957dc">ENC_CODERANGE_VALID</a>) {
<a name="l04149"></a>04149             <span class="keywordflow">while</span> (s &lt; e) {
<a name="l04150"></a>04150                 <span class="keywordtype">int</span> clen = <a class="code" href="../../d5/db5/encoding_8c.html#a405ec52962866fac46a16f02f3f92832">rb_enc_fast_mbclen</a>(s, e, enc);
<a name="l04151"></a>04151 
<a name="l04152"></a>04152                 <span class="keywordflow">if</span> (clen &gt; 1 || (*s &amp; 0x80)) single = 0;
<a name="l04153"></a>04153                 p -= clen;
<a name="l04154"></a>04154                 memcpy(p, s, clen);
<a name="l04155"></a>04155                 s += clen;
<a name="l04156"></a>04156             }
<a name="l04157"></a>04157         }
<a name="l04158"></a>04158         <span class="keywordflow">else</span> {
<a name="l04159"></a>04159             <span class="keywordflow">while</span> (s &lt; e) {
<a name="l04160"></a>04160                 <span class="keywordtype">int</span> clen = <a class="code" href="../../d5/db5/encoding_8c.html#aa91c0fa3dfdfe3c55fcaa6029c35bbb8">rb_enc_mbclen</a>(s, e, enc);
<a name="l04161"></a>04161 
<a name="l04162"></a>04162                 <span class="keywordflow">if</span> (clen &gt; 1 || (*s &amp; 0x80)) single = 0;
<a name="l04163"></a>04163                 p -= clen;
<a name="l04164"></a>04164                 memcpy(p, s, clen);
<a name="l04165"></a>04165                 s += clen;
<a name="l04166"></a>04166             }
<a name="l04167"></a>04167         }
<a name="l04168"></a>04168     }
<a name="l04169"></a>04169     <a class="code" href="../../d1/db0/string_8c.html#a056c7c0a74c83ccdb5a160bbdcbf8c3b">STR_SET_LEN</a>(rev, <a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(str));
<a name="l04170"></a>04170     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3bf9ab455a1e0e3e8cfc6ebabd8f12df">OBJ_INFECT</a>(rev, str);
<a name="l04171"></a>04171     <span class="keywordflow">if</span> (<a class="code" href="../../d5/de3/encoding_8h.html#a5901233f6f9004aebbdeccdd33cf449f">ENC_CODERANGE</a>(str) == <a class="code" href="../../d5/de3/encoding_8h.html#a60de9709709968f9627365a6cd0ff5d1">ENC_CODERANGE_UNKNOWN</a>) {
<a name="l04172"></a>04172         <span class="keywordflow">if</span> (single) {
<a name="l04173"></a>04173             <a class="code" href="../../d5/de3/encoding_8h.html#aefe5772c0116cf7131a5227de7243dbc">ENC_CODERANGE_SET</a>(str, <a class="code" href="../../d5/de3/encoding_8h.html#a0a0e73a2d98205044e1ad19432502c5b">ENC_CODERANGE_7BIT</a>);
<a name="l04174"></a>04174         }
<a name="l04175"></a>04175         <span class="keywordflow">else</span> {
<a name="l04176"></a>04176             <a class="code" href="../../d5/de3/encoding_8h.html#aefe5772c0116cf7131a5227de7243dbc">ENC_CODERANGE_SET</a>(str, <a class="code" href="../../d5/de3/encoding_8h.html#a0c81a12daaa1e57009d46b9d906957dc">ENC_CODERANGE_VALID</a>);
<a name="l04177"></a>04177         }
<a name="l04178"></a>04178     }
<a name="l04179"></a>04179     <a class="code" href="../../d1/db0/string_8c.html#a52e3afb878f939e397b9443c8e082c54">rb_enc_cr_str_copy_for_substr</a>(rev, str);
<a name="l04180"></a>04180 
<a name="l04181"></a>04181     <span class="keywordflow">return</span> rev;
<a name="l04182"></a>04182 }
<a name="l04183"></a>04183 
<a name="l04184"></a>04184 
<a name="l04185"></a>04185 <span class="comment">/*</span>
<a name="l04186"></a>04186 <span class="comment"> *  call-seq:</span>
<a name="l04187"></a>04187 <span class="comment"> *     str.reverse!   -&gt; str</span>
<a name="l04188"></a>04188 <span class="comment"> *</span>
<a name="l04189"></a>04189 <span class="comment"> *  Reverses &lt;i&gt;str&lt;/i&gt; in place.</span>
<a name="l04190"></a>04190 <span class="comment"> */</span>
<a name="l04191"></a>04191 
<a name="l04192"></a>04192 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l04193"></a><a class="code" href="../../d1/db0/string_8c.html#a5a4cac2a310a3e952f374df3aec83e35">04193</a> <a class="code" href="../../d1/db0/string_8c.html#a5a4cac2a310a3e952f374df3aec83e35">rb_str_reverse_bang</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str)
<a name="l04194"></a>04194 {
<a name="l04195"></a>04195     <span class="keywordflow">if</span> (<a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(str) &gt; 1) {
<a name="l04196"></a>04196         <span class="keywordflow">if</span> (<a class="code" href="../../d1/db0/string_8c.html#a5ab3c8112c2ec6943bdae8a2036fca02">single_byte_optimizable</a>(str)) {
<a name="l04197"></a>04197             <span class="keywordtype">char</span> *s, *e, c;
<a name="l04198"></a>04198 
<a name="l04199"></a>04199             <a class="code" href="../../d1/db0/string_8c.html#a106a1166130a12736cf57bacc164e4a5">str_modify_keep_cr</a>(str);
<a name="l04200"></a>04200             s = <a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(str);
<a name="l04201"></a>04201             e = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a35bfa2635774977edad0a16b9fdebbaf">RSTRING_END</a>(str) - 1;
<a name="l04202"></a>04202             <span class="keywordflow">while</span> (s &lt; e) {
<a name="l04203"></a>04203                 c = *s;
<a name="l04204"></a>04204                 *s++ = *e;
<a name="l04205"></a>04205                 *e-- = c;
<a name="l04206"></a>04206             }
<a name="l04207"></a>04207         }
<a name="l04208"></a>04208         <span class="keywordflow">else</span> {
<a name="l04209"></a>04209             <a class="code" href="../../db/d2e/intern_8h.html#a284132f9d055bd8adef45b71f26ee6ae">rb_str_shared_replace</a>(str, <a class="code" href="../../d1/db0/string_8c.html#ac381b14f2caf5dcb210c43d0df62f018">rb_str_reverse</a>(str));
<a name="l04210"></a>04210         }
<a name="l04211"></a>04211     }
<a name="l04212"></a>04212     <span class="keywordflow">else</span> {
<a name="l04213"></a>04213         <a class="code" href="../../d1/db0/string_8c.html#a106a1166130a12736cf57bacc164e4a5">str_modify_keep_cr</a>(str);
<a name="l04214"></a>04214     }
<a name="l04215"></a>04215     <span class="keywordflow">return</span> str;
<a name="l04216"></a>04216 }
<a name="l04217"></a>04217 
<a name="l04218"></a>04218 
<a name="l04219"></a>04219 <span class="comment">/*</span>
<a name="l04220"></a>04220 <span class="comment"> *  call-seq:</span>
<a name="l04221"></a>04221 <span class="comment"> *     str.include? other_str   -&gt; true or false</span>
<a name="l04222"></a>04222 <span class="comment"> *</span>
<a name="l04223"></a>04223 <span class="comment"> *  Returns &lt;code&gt;true&lt;/code&gt; if &lt;i&gt;str&lt;/i&gt; contains the given string or</span>
<a name="l04224"></a>04224 <span class="comment"> *  character.</span>
<a name="l04225"></a>04225 <span class="comment"> *</span>
<a name="l04226"></a>04226 <span class="comment"> *     &quot;hello&quot;.include? &quot;lo&quot;   #=&gt; true</span>
<a name="l04227"></a>04227 <span class="comment"> *     &quot;hello&quot;.include? &quot;ol&quot;   #=&gt; false</span>
<a name="l04228"></a>04228 <span class="comment"> *     &quot;hello&quot;.include? ?h     #=&gt; true</span>
<a name="l04229"></a>04229 <span class="comment"> */</span>
<a name="l04230"></a>04230 
<a name="l04231"></a>04231 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l04232"></a><a class="code" href="../../d1/db0/string_8c.html#a332aee68009134f3f8687e2b54b121ba">04232</a> <a class="code" href="../../d1/db0/string_8c.html#a332aee68009134f3f8687e2b54b121ba">rb_str_include</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> arg)
<a name="l04233"></a>04233 {
<a name="l04234"></a>04234     <span class="keywordtype">long</span> i;
<a name="l04235"></a>04235 
<a name="l04236"></a>04236     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a0e80f207eb41e9010ec9f0f5f9419fea">StringValue</a>(arg);
<a name="l04237"></a>04237     i = <a class="code" href="../../d1/db0/string_8c.html#a44f92eec2a74155cc1bb3445e7cacaf1">rb_str_index</a>(str, arg, 0);
<a name="l04238"></a>04238 
<a name="l04239"></a>04239     <span class="keywordflow">if</span> (i == -1) <span class="keywordflow">return</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aba0717d2689eb68797421a02ab9295c6">Qfalse</a>;
<a name="l04240"></a>04240     <span class="keywordflow">return</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aacea3516b33941ce8149098e223a7466">Qtrue</a>;
<a name="l04241"></a>04241 }
<a name="l04242"></a>04242 
<a name="l04243"></a>04243 
<a name="l04244"></a>04244 <span class="comment">/*</span>
<a name="l04245"></a>04245 <span class="comment"> *  call-seq:</span>
<a name="l04246"></a>04246 <span class="comment"> *     str.to_i(base=10)   -&gt; integer</span>
<a name="l04247"></a>04247 <span class="comment"> *</span>
<a name="l04248"></a>04248 <span class="comment"> *  Returns the result of interpreting leading characters in &lt;i&gt;str&lt;/i&gt; as an</span>
<a name="l04249"></a>04249 <span class="comment"> *  integer base &lt;i&gt;base&lt;/i&gt; (between 2 and 36). Extraneous characters past the</span>
<a name="l04250"></a>04250 <span class="comment"> *  end of a valid number are ignored. If there is not a valid number at the</span>
<a name="l04251"></a>04251 <span class="comment"> *  start of &lt;i&gt;str&lt;/i&gt;, &lt;code&gt;0&lt;/code&gt; is returned. This method never raises an</span>
<a name="l04252"></a>04252 <span class="comment"> *  exception when &lt;i&gt;base&lt;/i&gt; is valid.</span>
<a name="l04253"></a>04253 <span class="comment"> *</span>
<a name="l04254"></a>04254 <span class="comment"> *     &quot;12345&quot;.to_i             #=&gt; 12345</span>
<a name="l04255"></a>04255 <span class="comment"> *     &quot;99 red balloons&quot;.to_i   #=&gt; 99</span>
<a name="l04256"></a>04256 <span class="comment"> *     &quot;0a&quot;.to_i                #=&gt; 0</span>
<a name="l04257"></a>04257 <span class="comment"> *     &quot;0a&quot;.to_i(16)            #=&gt; 10</span>
<a name="l04258"></a>04258 <span class="comment"> *     &quot;hello&quot;.to_i             #=&gt; 0</span>
<a name="l04259"></a>04259 <span class="comment"> *     &quot;1100101&quot;.to_i(2)        #=&gt; 101</span>
<a name="l04260"></a>04260 <span class="comment"> *     &quot;1100101&quot;.to_i(8)        #=&gt; 294977</span>
<a name="l04261"></a>04261 <span class="comment"> *     &quot;1100101&quot;.to_i(10)       #=&gt; 1100101</span>
<a name="l04262"></a>04262 <span class="comment"> *     &quot;1100101&quot;.to_i(16)       #=&gt; 17826049</span>
<a name="l04263"></a>04263 <span class="comment"> */</span>
<a name="l04264"></a>04264 
<a name="l04265"></a>04265 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l04266"></a><a class="code" href="../../d1/db0/string_8c.html#a2fbab16e925d11b5e1d5e55820c24e97">04266</a> <a class="code" href="../../d1/db0/string_8c.html#a2fbab16e925d11b5e1d5e55820c24e97">rb_str_to_i</a>(<span class="keywordtype">int</span> <a class="code" href="../../df/d77/ruby_8c.html#ad1447518f4372828b8435ae82e48499e">argc</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> *<a class="code" href="../../df/d77/ruby_8c.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str)
<a name="l04267"></a>04267 {
<a name="l04268"></a>04268     <span class="keywordtype">int</span> base;
<a name="l04269"></a>04269 
<a name="l04270"></a>04270     <span class="keywordflow">if</span> (argc == 0) base = 10;
<a name="l04271"></a>04271     <span class="keywordflow">else</span> {
<a name="l04272"></a>04272         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> b;
<a name="l04273"></a>04273 
<a name="l04274"></a>04274         <a class="code" href="../../d7/d19/group__defmethod.html#gaa7bed88640f01bee619f85fda09d28d7">rb_scan_args</a>(argc, argv, <span class="stringliteral">&quot;01&quot;</span>, &amp;b);
<a name="l04275"></a>04275         base = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a877c38180d23c5447d976c70dda89d69">NUM2INT</a>(b);
<a name="l04276"></a>04276     }
<a name="l04277"></a>04277     <span class="keywordflow">if</span> (base &lt; 0) {
<a name="l04278"></a>04278         <a class="code" href="../../db/dcc/error_8c.html#a0f771a2840561f1838169b3d7d4616f3">rb_raise</a>(<a class="code" href="../../db/dcc/error_8c.html#ab5e2a9fec766c75176fbb262bfe6a596">rb_eArgError</a>, <span class="stringliteral">&quot;invalid radix %d&quot;</span>, base);
<a name="l04279"></a>04279     }
<a name="l04280"></a>04280     <span class="keywordflow">return</span> <a class="code" href="../../d1/dcc/bignum_8c.html#a3c364897a7c673caf46ccdbf62536a07">rb_str_to_inum</a>(str, base, <a class="code" href="../../d1/d5c/nkf_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>);
<a name="l04281"></a>04281 }
<a name="l04282"></a>04282 
<a name="l04283"></a>04283 
<a name="l04284"></a>04284 <span class="comment">/*</span>
<a name="l04285"></a>04285 <span class="comment"> *  call-seq:</span>
<a name="l04286"></a>04286 <span class="comment"> *     str.to_f   -&gt; float</span>
<a name="l04287"></a>04287 <span class="comment"> *</span>
<a name="l04288"></a>04288 <span class="comment"> *  Returns the result of interpreting leading characters in &lt;i&gt;str&lt;/i&gt; as a</span>
<a name="l04289"></a>04289 <span class="comment"> *  floating point number. Extraneous characters past the end of a valid number</span>
<a name="l04290"></a>04290 <span class="comment"> *  are ignored. If there is not a valid number at the start of &lt;i&gt;str&lt;/i&gt;,</span>
<a name="l04291"></a>04291 <span class="comment"> *  &lt;code&gt;0.0&lt;/code&gt; is returned. This method never raises an exception.</span>
<a name="l04292"></a>04292 <span class="comment"> *</span>
<a name="l04293"></a>04293 <span class="comment"> *     &quot;123.45e1&quot;.to_f        #=&gt; 1234.5</span>
<a name="l04294"></a>04294 <span class="comment"> *     &quot;45.67 degrees&quot;.to_f   #=&gt; 45.67</span>
<a name="l04295"></a>04295 <span class="comment"> *     &quot;thx1138&quot;.to_f         #=&gt; 0.0</span>
<a name="l04296"></a>04296 <span class="comment"> */</span>
<a name="l04297"></a>04297 
<a name="l04298"></a>04298 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l04299"></a><a class="code" href="../../d1/db0/string_8c.html#a446557c6800289507733227f3dd1b50f">04299</a> <a class="code" href="../../d1/db0/string_8c.html#a446557c6800289507733227f3dd1b50f">rb_str_to_f</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str)
<a name="l04300"></a>04300 {
<a name="l04301"></a>04301     <span class="keywordflow">return</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a4affd02e0f0fe17593cd4ecd78cf9064">DBL2NUM</a>(<a class="code" href="../../db/d2e/intern_8h.html#a2815e113b851cdd2ef186d322b9c73aa">rb_str_to_dbl</a>(str, <a class="code" href="../../d1/d5c/nkf_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>));
<a name="l04302"></a>04302 }
<a name="l04303"></a>04303 
<a name="l04304"></a>04304 
<a name="l04305"></a>04305 <span class="comment">/*</span>
<a name="l04306"></a>04306 <span class="comment"> *  call-seq:</span>
<a name="l04307"></a>04307 <span class="comment"> *     str.to_s     -&gt; str</span>
<a name="l04308"></a>04308 <span class="comment"> *     str.to_str   -&gt; str</span>
<a name="l04309"></a>04309 <span class="comment"> *</span>
<a name="l04310"></a>04310 <span class="comment"> *  Returns the receiver.</span>
<a name="l04311"></a>04311 <span class="comment"> */</span>
<a name="l04312"></a>04312 
<a name="l04313"></a>04313 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l04314"></a><a class="code" href="../../d1/db0/string_8c.html#ac4d809210e4dccd6a4dca0a74edb04a2">04314</a> <a class="code" href="../../d1/db0/string_8c.html#ac4d809210e4dccd6a4dca0a74edb04a2">rb_str_to_s</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str)
<a name="l04315"></a>04315 {
<a name="l04316"></a>04316     <span class="keywordflow">if</span> (<a class="code" href="../../db/d2e/intern_8h.html#ac2be7243e739fa8f5dce6be0c8ee5f6d">rb_obj_class</a>(str) != <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a7d36c9c3e9faa34c27eb7f2eb9c874a8">rb_cString</a>) {
<a name="l04317"></a>04317         <span class="keywordflow">return</span> <a class="code" href="../../d1/db0/string_8c.html#af9b5e11f0eeedf21b644d72282953438">str_duplicate</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a7d36c9c3e9faa34c27eb7f2eb9c874a8">rb_cString</a>, str);
<a name="l04318"></a>04318     }
<a name="l04319"></a>04319     <span class="keywordflow">return</span> str;
<a name="l04320"></a>04320 }
<a name="l04321"></a>04321 
<a name="l04322"></a>04322 <span class="preprocessor">#if 0</span>
<a name="l04323"></a>04323 <span class="preprocessor"></span><span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l04324"></a>04324 str_cat_char(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> c, <a class="code" href="../../d1/d7b/struct_onig_encoding_type_s_t.html">rb_encoding</a> *enc)
<a name="l04325"></a>04325 {
<a name="l04326"></a>04326     <span class="keywordtype">char</span> s[<a class="code" href="../../d1/db0/string_8c.html#a4a171b45f691311eb103b8e563b855d7">RUBY_MAX_CHAR_LEN</a>];
<a name="l04327"></a>04327     <span class="keywordtype">int</span> n = <a class="code" href="../../d5/db5/encoding_8c.html#ae47c32c86d8d7d18127c9a1b2eb8c325">rb_enc_codelen</a>(c, enc);
<a name="l04328"></a>04328 
<a name="l04329"></a>04329     <a class="code" href="../../d5/de3/encoding_8h.html#a243639504d867c0a638be91db2d19db1">rb_enc_mbcput</a>(c, s, enc);
<a name="l04330"></a>04330     <a class="code" href="../../d5/de3/encoding_8h.html#a850cba00e6c7c1137d5224d4348c7fca">rb_enc_str_buf_cat</a>(str, s, n, enc);
<a name="l04331"></a>04331 }
<a name="l04332"></a>04332 <span class="preprocessor">#endif</span>
<a name="l04333"></a>04333 <span class="preprocessor"></span>
<a name="l04334"></a><a class="code" href="../../d1/db0/string_8c.html#abf3c913666255ec5005d0b4ff11cc6af">04334</a> <span class="preprocessor">#define CHAR_ESC_LEN 13 </span><span class="comment">/* sizeof(\x{ hex of 32bit unsigned int } \0) */</span>
<a name="l04335"></a>04335 
<a name="l04336"></a>04336 <span class="keywordtype">int</span>
<a name="l04337"></a><a class="code" href="../../d1/db0/string_8c.html#a84cde26e1aa1b2244298dc1db02f2963">04337</a> <a class="code" href="../../d1/db0/string_8c.html#a84cde26e1aa1b2244298dc1db02f2963">rb_str_buf_cat_escaped_char</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <a class="code" href="../../d8/d90/nkf_8c.html#a5ea5ac7abf5cce39283e422add1067d5">result</a>, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> c, <span class="keywordtype">int</span> unicode_p)
<a name="l04338"></a>04338 {
<a name="l04339"></a>04339     <span class="keywordtype">char</span> <a class="code" href="../../d6/da0/nkf-utf8_2nkf_8c.html#ac37f17a60c8b5533aac4840c681f62b8">buf</a>[<a class="code" href="../../d1/db0/string_8c.html#abf3c913666255ec5005d0b4ff11cc6af">CHAR_ESC_LEN</a> + 1];
<a name="l04340"></a>04340     <span class="keywordtype">int</span> l;
<a name="l04341"></a>04341 
<a name="l04342"></a>04342 <span class="preprocessor">#if SIZEOF_INT &gt; 4</span>
<a name="l04343"></a>04343 <span class="preprocessor"></span>    c &amp;= 0xffffffff;
<a name="l04344"></a>04344 <span class="preprocessor">#endif</span>
<a name="l04345"></a>04345 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (unicode_p) {
<a name="l04346"></a>04346         <span class="keywordflow">if</span> (c &lt; 0x7F &amp;&amp; <a class="code" href="../../de/de6/ruby_2ruby_8h.html#af65108a54093e5c7220dfc15f6cd9db1">ISPRINT</a>(c)) {
<a name="l04347"></a>04347             <a class="code" href="../../d7/d72/subst_8h.html#aa367b75c5aed883fef5befbdf04835a4">snprintf</a>(buf, <a class="code" href="../../d1/db0/string_8c.html#abf3c913666255ec5005d0b4ff11cc6af">CHAR_ESC_LEN</a>, <span class="stringliteral">&quot;%c&quot;</span>, c);
<a name="l04348"></a>04348         }
<a name="l04349"></a>04349         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (c &lt; 0x10000) {
<a name="l04350"></a>04350             <a class="code" href="../../d7/d72/subst_8h.html#aa367b75c5aed883fef5befbdf04835a4">snprintf</a>(buf, <a class="code" href="../../d1/db0/string_8c.html#abf3c913666255ec5005d0b4ff11cc6af">CHAR_ESC_LEN</a>, <span class="stringliteral">&quot;\\u%04X&quot;</span>, c);
<a name="l04351"></a>04351         }
<a name="l04352"></a>04352         <span class="keywordflow">else</span> {
<a name="l04353"></a>04353             <a class="code" href="../../d7/d72/subst_8h.html#aa367b75c5aed883fef5befbdf04835a4">snprintf</a>(buf, <a class="code" href="../../d1/db0/string_8c.html#abf3c913666255ec5005d0b4ff11cc6af">CHAR_ESC_LEN</a>, <span class="stringliteral">&quot;\\u{%X}&quot;</span>, c);
<a name="l04354"></a>04354         }
<a name="l04355"></a>04355     }
<a name="l04356"></a>04356     <span class="keywordflow">else</span> {
<a name="l04357"></a>04357         <span class="keywordflow">if</span> (c &lt; 0x100) {
<a name="l04358"></a>04358             <a class="code" href="../../d7/d72/subst_8h.html#aa367b75c5aed883fef5befbdf04835a4">snprintf</a>(buf, <a class="code" href="../../d1/db0/string_8c.html#abf3c913666255ec5005d0b4ff11cc6af">CHAR_ESC_LEN</a>, <span class="stringliteral">&quot;\\x%02X&quot;</span>, c);
<a name="l04359"></a>04359         }
<a name="l04360"></a>04360         <span class="keywordflow">else</span> {
<a name="l04361"></a>04361             <a class="code" href="../../d7/d72/subst_8h.html#aa367b75c5aed883fef5befbdf04835a4">snprintf</a>(buf, <a class="code" href="../../d1/db0/string_8c.html#abf3c913666255ec5005d0b4ff11cc6af">CHAR_ESC_LEN</a>, <span class="stringliteral">&quot;\\x{%X}&quot;</span>, c);
<a name="l04362"></a>04362         }
<a name="l04363"></a>04363     }
<a name="l04364"></a>04364     l = (int)<a class="code" href="../../d6/d7b/strchr_8c.html#a219836f542ce53545052bed5353820ca">strlen</a>(buf);       <span class="comment">/* CHAR_ESC_LEN cannot exceed INT_MAX */</span>
<a name="l04365"></a>04365     <a class="code" href="../../db/d2e/intern_8h.html#a4dff49e6d9aa925fd94fc5100b3c399b">rb_str_buf_cat</a>(result, buf, l);
<a name="l04366"></a>04366     <span class="keywordflow">return</span> l;
<a name="l04367"></a>04367 }
<a name="l04368"></a>04368 
<a name="l04369"></a>04369 <span class="comment">/*</span>
<a name="l04370"></a>04370 <span class="comment"> * call-seq:</span>
<a name="l04371"></a>04371 <span class="comment"> *   str.inspect   -&gt; string</span>
<a name="l04372"></a>04372 <span class="comment"> *</span>
<a name="l04373"></a>04373 <span class="comment"> * Returns a printable version of _str_, surrounded by quote marks,</span>
<a name="l04374"></a>04374 <span class="comment"> * with special characters escaped.</span>
<a name="l04375"></a>04375 <span class="comment"> *</span>
<a name="l04376"></a>04376 <span class="comment"> *    str = &quot;hello&quot;</span>
<a name="l04377"></a>04377 <span class="comment"> *    str[3] = &quot;\b&quot;</span>
<a name="l04378"></a>04378 <span class="comment"> *    str.inspect       #=&gt; &quot;\&quot;hel\\bo\&quot;&quot;</span>
<a name="l04379"></a>04379 <span class="comment"> */</span>
<a name="l04380"></a>04380 
<a name="l04381"></a>04381 <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l04382"></a><a class="code" href="../../d1/db0/string_8c.html#a95ab70e2503d2eb0dc130d1849338769">04382</a> <a class="code" href="../../db/d2e/intern_8h.html#a683d7a310ce87bf1aa5b5b3ea0d93ead">rb_str_inspect</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str)
<a name="l04383"></a>04383 {
<a name="l04384"></a>04384     <a class="code" href="../../d1/d7b/struct_onig_encoding_type_s_t.html">rb_encoding</a> *enc = <a class="code" href="../../d1/db0/string_8c.html#a123891f9f9b0c87d15621d93b4fa9c41">STR_ENC_GET</a>(str);
<a name="l04385"></a>04385     <span class="keyword">const</span> <span class="keywordtype">char</span> *p, *pend, *<a class="code" href="../../d7/dc0/parse_8y.html#a71f8b6ffdc0cc58ffd989c3162fb2bcf">prev</a>;
<a name="l04386"></a>04386     <span class="keywordtype">char</span> <a class="code" href="../../d6/da0/nkf-utf8_2nkf_8c.html#ac37f17a60c8b5533aac4840c681f62b8">buf</a>[<a class="code" href="../../d1/db0/string_8c.html#abf3c913666255ec5005d0b4ff11cc6af">CHAR_ESC_LEN</a> + 1];
<a name="l04387"></a>04387     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <a class="code" href="../../d8/d90/nkf_8c.html#a5ea5ac7abf5cce39283e422add1067d5">result</a> = <a class="code" href="../../db/d2e/intern_8h.html#a65dee742ae2daaab92ac8974cb2fbff2">rb_str_buf_new</a>(0);
<a name="l04388"></a>04388     <a class="code" href="../../d1/d7b/struct_onig_encoding_type_s_t.html">rb_encoding</a> *resenc = <a class="code" href="../../d5/db5/encoding_8c.html#a62b808940b1049f1af6233cbbb828bd6">rb_default_internal_encoding</a>();
<a name="l04389"></a>04389     <span class="keywordtype">int</span> unicode_p = <a class="code" href="../../d5/db5/encoding_8c.html#a5f10eed7d292fc34bf2a4252eb9d3799">rb_enc_unicode_p</a>(enc);
<a name="l04390"></a>04390     <span class="keywordtype">int</span> asciicompat = <a class="code" href="../../d5/de3/encoding_8h.html#a8b18a09a3055d3006c6d5baeaa6e7c72">rb_enc_asciicompat</a>(enc);
<a name="l04391"></a>04391     <span class="keyword">static</span> <a class="code" href="../../d1/d7b/struct_onig_encoding_type_s_t.html">rb_encoding</a> *utf16, *utf32;
<a name="l04392"></a>04392 
<a name="l04393"></a>04393     <span class="keywordflow">if</span> (!utf16) utf16 = <a class="code" href="../../d5/db5/encoding_8c.html#a67638c695b4079ca5f4b6b4cc22ab27a">rb_enc_find</a>(<span class="stringliteral">&quot;UTF-16&quot;</span>);
<a name="l04394"></a>04394     <span class="keywordflow">if</span> (!utf32) utf32 = <a class="code" href="../../d5/db5/encoding_8c.html#a67638c695b4079ca5f4b6b4cc22ab27a">rb_enc_find</a>(<span class="stringliteral">&quot;UTF-32&quot;</span>);
<a name="l04395"></a>04395     <span class="keywordflow">if</span> (resenc == <a class="code" href="../../d3/d09/ripper_8y.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) resenc = <a class="code" href="../../d5/db5/encoding_8c.html#a0724183879562529f7d3365ef5115b6d">rb_default_external_encoding</a>();
<a name="l04396"></a>04396     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/de3/encoding_8h.html#a8b18a09a3055d3006c6d5baeaa6e7c72">rb_enc_asciicompat</a>(resenc)) resenc = <a class="code" href="../../d5/db5/encoding_8c.html#a1e215012f16414c044f6a212973c95a8">rb_usascii_encoding</a>();
<a name="l04397"></a>04397     <a class="code" href="../../d5/db5/encoding_8c.html#a150a6e3ac22ac3be8f8c2ccc74a28e7b">rb_enc_associate</a>(result, resenc);
<a name="l04398"></a>04398     <a class="code" href="../../d1/db0/string_8c.html#aa9f48497a1abe9aebc8a45041be0983d">str_buf_cat2</a>(result, <span class="stringliteral">&quot;\&quot;&quot;</span>);
<a name="l04399"></a>04399 
<a name="l04400"></a>04400     p = <a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(str); pend = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a35bfa2635774977edad0a16b9fdebbaf">RSTRING_END</a>(str);
<a name="l04401"></a>04401     prev = p;
<a name="l04402"></a>04402     <span class="keywordflow">if</span> (enc == utf16) {
<a name="l04403"></a>04403         <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *q = (<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *)p;
<a name="l04404"></a>04404         <span class="keywordflow">if</span> (q[0] == 0xFE &amp;&amp; q[1] == 0xFF)
<a name="l04405"></a>04405             enc = <a class="code" href="../../d5/db5/encoding_8c.html#a67638c695b4079ca5f4b6b4cc22ab27a">rb_enc_find</a>(<span class="stringliteral">&quot;UTF-16BE&quot;</span>);
<a name="l04406"></a>04406         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (q[0] == 0xFF &amp;&amp; q[1] == 0xFE)
<a name="l04407"></a>04407             enc = <a class="code" href="../../d5/db5/encoding_8c.html#a67638c695b4079ca5f4b6b4cc22ab27a">rb_enc_find</a>(<span class="stringliteral">&quot;UTF-16LE&quot;</span>);
<a name="l04408"></a>04408         <span class="keywordflow">else</span>
<a name="l04409"></a>04409             unicode_p = 0;
<a name="l04410"></a>04410     }
<a name="l04411"></a>04411     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (enc == utf32) {
<a name="l04412"></a>04412         <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *q = (<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *)p;
<a name="l04413"></a>04413         <span class="keywordflow">if</span> (q[0] == 0 &amp;&amp; q[1] == 0 &amp;&amp; q[2] == 0xFE &amp;&amp; q[3] == 0xFF)
<a name="l04414"></a>04414             enc = <a class="code" href="../../d5/db5/encoding_8c.html#a67638c695b4079ca5f4b6b4cc22ab27a">rb_enc_find</a>(<span class="stringliteral">&quot;UTF-32BE&quot;</span>);
<a name="l04415"></a>04415         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (q[3] == 0 &amp;&amp; q[2] == 0 &amp;&amp; q[1] == 0xFE &amp;&amp; q[0] == 0xFF)
<a name="l04416"></a>04416             enc = <a class="code" href="../../d5/db5/encoding_8c.html#a67638c695b4079ca5f4b6b4cc22ab27a">rb_enc_find</a>(<span class="stringliteral">&quot;UTF-32LE&quot;</span>);
<a name="l04417"></a>04417         <span class="keywordflow">else</span>
<a name="l04418"></a>04418             unicode_p = 0;
<a name="l04419"></a>04419     }
<a name="l04420"></a>04420     <span class="keywordflow">while</span> (p &lt; pend) {
<a name="l04421"></a>04421         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> c, cc;
<a name="l04422"></a>04422         <span class="keywordtype">int</span> n;
<a name="l04423"></a>04423 
<a name="l04424"></a>04424         n = <a class="code" href="../../d5/db5/encoding_8c.html#a0c6003b6aeaed218d841974b00c95870">rb_enc_precise_mbclen</a>(p, pend, enc);
<a name="l04425"></a>04425         <span class="keywordflow">if</span> (!<a class="code" href="../../d5/de3/encoding_8h.html#ac3dcc15c5ed42d6590e1c1f91b74165c">MBCLEN_CHARFOUND_P</a>(n)) {
<a name="l04426"></a>04426             <span class="keywordflow">if</span> (p &gt; prev) <a class="code" href="../../d1/db0/string_8c.html#a0cd14f2af7846dd4a6405fa3ada431ff">str_buf_cat</a>(result, prev, p - prev);
<a name="l04427"></a>04427             n = <a class="code" href="../../d5/de3/encoding_8h.html#aaffb0395eb9bf0b3ba3175fa5c9c1615">rb_enc_mbminlen</a>(enc);
<a name="l04428"></a>04428             <span class="keywordflow">if</span> (pend &lt; p + n)
<a name="l04429"></a>04429                 n = (int)(pend - p);
<a name="l04430"></a>04430             <span class="keywordflow">while</span> (n--) {
<a name="l04431"></a>04431                 <a class="code" href="../../d7/d72/subst_8h.html#aa367b75c5aed883fef5befbdf04835a4">snprintf</a>(buf, <a class="code" href="../../d1/db0/string_8c.html#abf3c913666255ec5005d0b4ff11cc6af">CHAR_ESC_LEN</a>, <span class="stringliteral">&quot;\\x%02X&quot;</span>, *p &amp; 0377);
<a name="l04432"></a>04432                 <a class="code" href="../../d1/db0/string_8c.html#a0cd14f2af7846dd4a6405fa3ada431ff">str_buf_cat</a>(result, buf, <a class="code" href="../../d6/d7b/strchr_8c.html#a219836f542ce53545052bed5353820ca">strlen</a>(buf));
<a name="l04433"></a>04433                 prev = ++p;
<a name="l04434"></a>04434             }
<a name="l04435"></a>04435             <span class="keywordflow">continue</span>;
<a name="l04436"></a>04436         }
<a name="l04437"></a>04437         n = <a class="code" href="../../d5/de3/encoding_8h.html#a877f84ae22293dae2a8cf1e26ea5b1a6">MBCLEN_CHARFOUND_LEN</a>(n);
<a name="l04438"></a>04438         c = <a class="code" href="../../d5/de3/encoding_8h.html#a7f8372dd0ada95131f8a22a4d8759d39">rb_enc_mbc_to_codepoint</a>(p, pend, enc);
<a name="l04439"></a>04439         p += n;
<a name="l04440"></a>04440         <span class="keywordflow">if</span> ((asciicompat || unicode_p) &amp;&amp;
<a name="l04441"></a>04441           (c == <span class="charliteral">&apos;&quot;&apos;</span>|| c == <span class="charliteral">&apos;\\&apos;</span> ||
<a name="l04442"></a>04442             (c == <span class="charliteral">&apos;#&apos;</span> &amp;&amp;
<a name="l04443"></a>04443              p &lt; pend &amp;&amp;
<a name="l04444"></a>04444              <a class="code" href="../../d5/de3/encoding_8h.html#ac3dcc15c5ed42d6590e1c1f91b74165c">MBCLEN_CHARFOUND_P</a>(<a class="code" href="../../d5/db5/encoding_8c.html#a0c6003b6aeaed218d841974b00c95870">rb_enc_precise_mbclen</a>(p,pend,enc)) &amp;&amp;
<a name="l04445"></a>04445              (cc = <a class="code" href="../../d5/de3/encoding_8h.html#a902fb7e618fcdb1ce1317b09a772af15">rb_enc_codepoint</a>(p,pend,enc),
<a name="l04446"></a>04446               (cc == <span class="charliteral">&apos;$&apos;</span> || cc == <span class="charliteral">&apos;@&apos;</span> || cc == <span class="charliteral">&apos;{&apos;</span>))))) {
<a name="l04447"></a>04447             <span class="keywordflow">if</span> (p - n &gt; prev) <a class="code" href="../../d1/db0/string_8c.html#a0cd14f2af7846dd4a6405fa3ada431ff">str_buf_cat</a>(result, prev, p - n - prev);
<a name="l04448"></a>04448             <a class="code" href="../../d1/db0/string_8c.html#aa9f48497a1abe9aebc8a45041be0983d">str_buf_cat2</a>(result, <span class="stringliteral">&quot;\\&quot;</span>);
<a name="l04449"></a>04449             <span class="keywordflow">if</span> (asciicompat || enc == resenc) {
<a name="l04450"></a>04450                 prev = p - n;
<a name="l04451"></a>04451                 <span class="keywordflow">continue</span>;
<a name="l04452"></a>04452             }
<a name="l04453"></a>04453         }
<a name="l04454"></a>04454         <span class="keywordflow">switch</span> (c) {
<a name="l04455"></a>04455           <span class="keywordflow">case</span> <span class="charliteral">&apos;\n&apos;</span>: cc = <span class="charliteral">&apos;n&apos;</span>; <span class="keywordflow">break</span>;
<a name="l04456"></a>04456           <span class="keywordflow">case</span> <span class="charliteral">&apos;\r&apos;</span>: cc = <span class="charliteral">&apos;r&apos;</span>; <span class="keywordflow">break</span>;
<a name="l04457"></a>04457           <span class="keywordflow">case</span> <span class="charliteral">&apos;\t&apos;</span>: cc = <span class="charliteral">&apos;t&apos;</span>; <span class="keywordflow">break</span>;
<a name="l04458"></a>04458           <span class="keywordflow">case</span> <span class="charliteral">&apos;\f&apos;</span>: cc = <span class="charliteral">&apos;f&apos;</span>; <span class="keywordflow">break</span>;
<a name="l04459"></a>04459           <span class="keywordflow">case</span> <span class="charliteral">&apos;\013&apos;</span>: cc = <span class="charliteral">&apos;v&apos;</span>; <span class="keywordflow">break</span>;
<a name="l04460"></a>04460           <span class="keywordflow">case</span> <span class="charliteral">&apos;\010&apos;</span>: cc = <span class="charliteral">&apos;b&apos;</span>; <span class="keywordflow">break</span>;
<a name="l04461"></a>04461           <span class="keywordflow">case</span> <span class="charliteral">&apos;\007&apos;</span>: cc = <span class="charliteral">&apos;a&apos;</span>; <span class="keywordflow">break</span>;
<a name="l04462"></a>04462           <span class="keywordflow">case</span> 033: cc = <span class="charliteral">&apos;e&apos;</span>; <span class="keywordflow">break</span>;
<a name="l04463"></a>04463           <span class="keywordflow">default</span>: cc = 0; <span class="keywordflow">break</span>;
<a name="l04464"></a>04464         }
<a name="l04465"></a>04465         <span class="keywordflow">if</span> (cc) {
<a name="l04466"></a>04466             <span class="keywordflow">if</span> (p - n &gt; prev) <a class="code" href="../../d1/db0/string_8c.html#a0cd14f2af7846dd4a6405fa3ada431ff">str_buf_cat</a>(result, prev, p - n - prev);
<a name="l04467"></a>04467             buf[0] = <span class="charliteral">&apos;\\&apos;</span>;
<a name="l04468"></a>04468             buf[1] = (char)cc;
<a name="l04469"></a>04469             <a class="code" href="../../d1/db0/string_8c.html#a0cd14f2af7846dd4a6405fa3ada431ff">str_buf_cat</a>(result, buf, 2);
<a name="l04470"></a>04470             prev = p;
<a name="l04471"></a>04471             <span class="keywordflow">continue</span>;
<a name="l04472"></a>04472         }
<a name="l04473"></a>04473         <span class="keywordflow">if</span> ((enc == resenc &amp;&amp; <a class="code" href="../../d5/de3/encoding_8h.html#aa48d3160680fc51c021c3ddba69d0064">rb_enc_isprint</a>(c, enc)) ||
<a name="l04474"></a>04474             (asciicompat &amp;&amp; <a class="code" href="../../d5/de3/encoding_8h.html#a6a45c3c98c745038de6c66a5014e0b35">rb_enc_isascii</a>(c, enc) &amp;&amp; <a class="code" href="../../de/de6/ruby_2ruby_8h.html#af65108a54093e5c7220dfc15f6cd9db1">ISPRINT</a>(c))) {
<a name="l04475"></a>04475             <span class="keywordflow">continue</span>;
<a name="l04476"></a>04476         }
<a name="l04477"></a>04477         <span class="keywordflow">else</span> {
<a name="l04478"></a>04478             <span class="keywordflow">if</span> (p - n &gt; prev) <a class="code" href="../../d1/db0/string_8c.html#a0cd14f2af7846dd4a6405fa3ada431ff">str_buf_cat</a>(result, prev, p - n - prev);
<a name="l04479"></a>04479             <a class="code" href="../../d1/db0/string_8c.html#a84cde26e1aa1b2244298dc1db02f2963">rb_str_buf_cat_escaped_char</a>(result, c, unicode_p);
<a name="l04480"></a>04480             prev = p;
<a name="l04481"></a>04481             <span class="keywordflow">continue</span>;
<a name="l04482"></a>04482         }
<a name="l04483"></a>04483     }
<a name="l04484"></a>04484     <span class="keywordflow">if</span> (p &gt; prev) <a class="code" href="../../d1/db0/string_8c.html#a0cd14f2af7846dd4a6405fa3ada431ff">str_buf_cat</a>(result, prev, p - prev);
<a name="l04485"></a>04485     <a class="code" href="../../d1/db0/string_8c.html#aa9f48497a1abe9aebc8a45041be0983d">str_buf_cat2</a>(result, <span class="stringliteral">&quot;\&quot;&quot;</span>);
<a name="l04486"></a>04486 
<a name="l04487"></a>04487     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3bf9ab455a1e0e3e8cfc6ebabd8f12df">OBJ_INFECT</a>(result, str);
<a name="l04488"></a>04488     <span class="keywordflow">return</span> result;
<a name="l04489"></a>04489 }
<a name="l04490"></a>04490 
<a name="l04491"></a><a class="code" href="../../d1/db0/string_8c.html#a75fb851ec429bbb2b277946ed9ab6436">04491</a> <span class="preprocessor">#define IS_EVSTR(p,e) ((p) &lt; (e) &amp;&amp; (*(p) == &apos;$&apos; || *(p) == &apos;@&apos; || *(p) == &apos;{&apos;))</span>
<a name="l04492"></a>04492 <span class="preprocessor"></span>
<a name="l04493"></a>04493 <span class="comment">/*</span>
<a name="l04494"></a>04494 <span class="comment"> *  call-seq:</span>
<a name="l04495"></a>04495 <span class="comment"> *     str.dump   -&gt; new_str</span>
<a name="l04496"></a>04496 <span class="comment"> *</span>
<a name="l04497"></a>04497 <span class="comment"> *  Produces a version of &lt;i&gt;str&lt;/i&gt; with all nonprinting characters replaced by</span>
<a name="l04498"></a>04498 <span class="comment"> *  &lt;code&gt;\nnn&lt;/code&gt; notation and all special characters escaped.</span>
<a name="l04499"></a>04499 <span class="comment"> */</span>
<a name="l04500"></a>04500 
<a name="l04501"></a>04501 <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l04502"></a><a class="code" href="../../d1/db0/string_8c.html#ae12e8f17c83a0de51d7152ee9589db49">04502</a> <a class="code" href="../../db/d2e/intern_8h.html#ab4fa4ec084128c2a79a73d1989210ea4">rb_str_dump</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str)
<a name="l04503"></a>04503 {
<a name="l04504"></a>04504     <a class="code" href="../../d1/d7b/struct_onig_encoding_type_s_t.html">rb_encoding</a> *enc = <a class="code" href="../../d5/db5/encoding_8c.html#ac21ed764f3b39453b6a848dd64a19585">rb_enc_get</a>(str);
<a name="l04505"></a>04505     <span class="keywordtype">long</span> len;
<a name="l04506"></a>04506     <span class="keyword">const</span> <span class="keywordtype">char</span> *p, *pend;
<a name="l04507"></a>04507     <span class="keywordtype">char</span> *q, *qend;
<a name="l04508"></a>04508     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <a class="code" href="../../d8/d90/nkf_8c.html#a5ea5ac7abf5cce39283e422add1067d5">result</a>;
<a name="l04509"></a>04509     <span class="keywordtype">int</span> u8 = (enc == <a class="code" href="../../d5/db5/encoding_8c.html#a893004271cf8c790ca40c4712261aa8c">rb_utf8_encoding</a>());
<a name="l04510"></a>04510 
<a name="l04511"></a>04511     len = 2;                    <span class="comment">/* &quot;&quot; */</span>
<a name="l04512"></a>04512     p = <a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(str); pend = p + <a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(str);
<a name="l04513"></a>04513     <span class="keywordflow">while</span> (p &lt; pend) {
<a name="l04514"></a>04514         <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> c = *p++;
<a name="l04515"></a>04515         <span class="keywordflow">switch</span> (c) {
<a name="l04516"></a>04516           <span class="keywordflow">case</span> <span class="charliteral">&apos;&quot;&apos;</span>:  <span class="keywordflow">case</span> <span class="charliteral">&apos;\\&apos;</span>:
<a name="l04517"></a>04517           <span class="keywordflow">case</span> <span class="charliteral">&apos;\n&apos;</span>: <span class="keywordflow">case</span> <span class="charliteral">&apos;\r&apos;</span>:
<a name="l04518"></a>04518           <span class="keywordflow">case</span> <span class="charliteral">&apos;\t&apos;</span>: <span class="keywordflow">case</span> <span class="charliteral">&apos;\f&apos;</span>:
<a name="l04519"></a>04519           <span class="keywordflow">case</span> <span class="charliteral">&apos;\013&apos;</span>: <span class="keywordflow">case</span> <span class="charliteral">&apos;\010&apos;</span>: <span class="keywordflow">case</span> <span class="charliteral">&apos;\007&apos;</span>: <span class="keywordflow">case</span> <span class="charliteral">&apos;\033&apos;</span>:
<a name="l04520"></a>04520             len += 2;
<a name="l04521"></a>04521             <span class="keywordflow">break</span>;
<a name="l04522"></a>04522 
<a name="l04523"></a>04523           <span class="keywordflow">case</span> <span class="charliteral">&apos;#&apos;</span>:
<a name="l04524"></a>04524             len += <a class="code" href="../../d1/db0/string_8c.html#a75fb851ec429bbb2b277946ed9ab6436">IS_EVSTR</a>(p, pend) ? 2 : 1;
<a name="l04525"></a>04525             <span class="keywordflow">break</span>;
<a name="l04526"></a>04526 
<a name="l04527"></a>04527           <span class="keywordflow">default</span>:
<a name="l04528"></a>04528             <span class="keywordflow">if</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#af65108a54093e5c7220dfc15f6cd9db1">ISPRINT</a>(c)) {
<a name="l04529"></a>04529                 len++;
<a name="l04530"></a>04530             }
<a name="l04531"></a>04531             <span class="keywordflow">else</span> {
<a name="l04532"></a>04532                 <span class="keywordflow">if</span> (u8) {       <span class="comment">/* \u{NN} */</span>
<a name="l04533"></a>04533                     <span class="keywordtype">int</span> n = <a class="code" href="../../d5/db5/encoding_8c.html#a0c6003b6aeaed218d841974b00c95870">rb_enc_precise_mbclen</a>(p-1, pend, enc);
<a name="l04534"></a>04534                     <span class="keywordflow">if</span> (<a class="code" href="../../d5/de3/encoding_8h.html#ac3dcc15c5ed42d6590e1c1f91b74165c">MBCLEN_CHARFOUND_P</a>(n-1)) {
<a name="l04535"></a>04535                         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cc = <a class="code" href="../../d5/de3/encoding_8h.html#a7f8372dd0ada95131f8a22a4d8759d39">rb_enc_mbc_to_codepoint</a>(p-1, pend, enc);
<a name="l04536"></a>04536                         <span class="keywordflow">while</span> (cc &gt;&gt;= 4) len++;
<a name="l04537"></a>04537                         len += 5;
<a name="l04538"></a>04538                         p += <a class="code" href="../../d5/de3/encoding_8h.html#a877f84ae22293dae2a8cf1e26ea5b1a6">MBCLEN_CHARFOUND_LEN</a>(n)-1;
<a name="l04539"></a>04539                         <span class="keywordflow">break</span>;
<a name="l04540"></a>04540                     }
<a name="l04541"></a>04541                 }
<a name="l04542"></a>04542                 len += 4;       <span class="comment">/* \xNN */</span>
<a name="l04543"></a>04543             }
<a name="l04544"></a>04544             <span class="keywordflow">break</span>;
<a name="l04545"></a>04545         }
<a name="l04546"></a>04546     }
<a name="l04547"></a>04547     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/de3/encoding_8h.html#a8b18a09a3055d3006c6d5baeaa6e7c72">rb_enc_asciicompat</a>(enc)) {
<a name="l04548"></a>04548         len += 19;              <span class="comment">/* &quot;.force_encoding(&apos;&apos;)&quot; */</span>
<a name="l04549"></a>04549         len += <a class="code" href="../../d6/d7b/strchr_8c.html#a219836f542ce53545052bed5353820ca">strlen</a>(enc-&gt;<a class="code" href="../../d1/d7b/struct_onig_encoding_type_s_t.html#a297b454a05f56650dbba59d0109b3f7f">name</a>);
<a name="l04550"></a>04550     }
<a name="l04551"></a>04551 
<a name="l04552"></a>04552     result = <a class="code" href="../../db/d2e/intern_8h.html#a70b7301e6960c402803fa81c7a0777d0">rb_str_new5</a>(str, 0, len);
<a name="l04553"></a>04553     p = <a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(str); pend = p + <a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(str);
<a name="l04554"></a>04554     q = <a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(result); qend = q + len + 1;
<a name="l04555"></a>04555 
<a name="l04556"></a>04556     *q++ = <span class="charliteral">&apos;&quot;&apos;</span>;
<a name="l04557"></a>04557     <span class="keywordflow">while</span> (p &lt; pend) {
<a name="l04558"></a>04558         <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> c = *p++;
<a name="l04559"></a>04559 
<a name="l04560"></a>04560         <span class="keywordflow">if</span> (c == <span class="charliteral">&apos;&quot;&apos;</span> || c == <span class="charliteral">&apos;\\&apos;</span>) {
<a name="l04561"></a>04561             *q++ = <span class="charliteral">&apos;\\&apos;</span>;
<a name="l04562"></a>04562             *q++ = c;
<a name="l04563"></a>04563         }
<a name="l04564"></a>04564         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (c == <span class="charliteral">&apos;#&apos;</span>) {
<a name="l04565"></a>04565             <span class="keywordflow">if</span> (<a class="code" href="../../d1/db0/string_8c.html#a75fb851ec429bbb2b277946ed9ab6436">IS_EVSTR</a>(p, pend)) *q++ = <span class="charliteral">&apos;\\&apos;</span>;
<a name="l04566"></a>04566             *q++ = <span class="charliteral">&apos;#&apos;</span>;
<a name="l04567"></a>04567         }
<a name="l04568"></a>04568         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (c == <span class="charliteral">&apos;\n&apos;</span>) {
<a name="l04569"></a>04569             *q++ = <span class="charliteral">&apos;\\&apos;</span>;
<a name="l04570"></a>04570             *q++ = <span class="charliteral">&apos;n&apos;</span>;
<a name="l04571"></a>04571         }
<a name="l04572"></a>04572         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (c == <span class="charliteral">&apos;\r&apos;</span>) {
<a name="l04573"></a>04573             *q++ = <span class="charliteral">&apos;\\&apos;</span>;
<a name="l04574"></a>04574             *q++ = <span class="charliteral">&apos;r&apos;</span>;
<a name="l04575"></a>04575         }
<a name="l04576"></a>04576         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (c == <span class="charliteral">&apos;\t&apos;</span>) {
<a name="l04577"></a>04577             *q++ = <span class="charliteral">&apos;\\&apos;</span>;
<a name="l04578"></a>04578             *q++ = <span class="charliteral">&apos;t&apos;</span>;
<a name="l04579"></a>04579         }
<a name="l04580"></a>04580         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (c == <span class="charliteral">&apos;\f&apos;</span>) {
<a name="l04581"></a>04581             *q++ = <span class="charliteral">&apos;\\&apos;</span>;
<a name="l04582"></a>04582             *q++ = <span class="charliteral">&apos;f&apos;</span>;
<a name="l04583"></a>04583         }
<a name="l04584"></a>04584         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (c == <span class="charliteral">&apos;\013&apos;</span>) {
<a name="l04585"></a>04585             *q++ = <span class="charliteral">&apos;\\&apos;</span>;
<a name="l04586"></a>04586             *q++ = <span class="charliteral">&apos;v&apos;</span>;
<a name="l04587"></a>04587         }
<a name="l04588"></a>04588         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (c == <span class="charliteral">&apos;\010&apos;</span>) {
<a name="l04589"></a>04589             *q++ = <span class="charliteral">&apos;\\&apos;</span>;
<a name="l04590"></a>04590             *q++ = <span class="charliteral">&apos;b&apos;</span>;
<a name="l04591"></a>04591         }
<a name="l04592"></a>04592         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (c == <span class="charliteral">&apos;\007&apos;</span>) {
<a name="l04593"></a>04593             *q++ = <span class="charliteral">&apos;\\&apos;</span>;
<a name="l04594"></a>04594             *q++ = <span class="charliteral">&apos;a&apos;</span>;
<a name="l04595"></a>04595         }
<a name="l04596"></a>04596         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (c == <span class="charliteral">&apos;\033&apos;</span>) {
<a name="l04597"></a>04597             *q++ = <span class="charliteral">&apos;\\&apos;</span>;
<a name="l04598"></a>04598             *q++ = <span class="charliteral">&apos;e&apos;</span>;
<a name="l04599"></a>04599         }
<a name="l04600"></a>04600         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#af65108a54093e5c7220dfc15f6cd9db1">ISPRINT</a>(c)) {
<a name="l04601"></a>04601             *q++ = c;
<a name="l04602"></a>04602         }
<a name="l04603"></a>04603         <span class="keywordflow">else</span> {
<a name="l04604"></a>04604             *q++ = <span class="charliteral">&apos;\\&apos;</span>;
<a name="l04605"></a>04605             <span class="keywordflow">if</span> (u8) {
<a name="l04606"></a>04606                 <span class="keywordtype">int</span> n = <a class="code" href="../../d5/db5/encoding_8c.html#a0c6003b6aeaed218d841974b00c95870">rb_enc_precise_mbclen</a>(p-1, pend, enc) - 1;
<a name="l04607"></a>04607                 <span class="keywordflow">if</span> (<a class="code" href="../../d5/de3/encoding_8h.html#ac3dcc15c5ed42d6590e1c1f91b74165c">MBCLEN_CHARFOUND_P</a>(n)) {
<a name="l04608"></a>04608                     <span class="keywordtype">int</span> cc = <a class="code" href="../../d5/de3/encoding_8h.html#a7f8372dd0ada95131f8a22a4d8759d39">rb_enc_mbc_to_codepoint</a>(p-1, pend, enc);
<a name="l04609"></a>04609                     p += n;
<a name="l04610"></a>04610                     <a class="code" href="../../d7/d72/subst_8h.html#aa367b75c5aed883fef5befbdf04835a4">snprintf</a>(q, qend-q, <span class="stringliteral">&quot;u{%x}&quot;</span>, cc);
<a name="l04611"></a>04611                     q += <a class="code" href="../../d6/d7b/strchr_8c.html#a219836f542ce53545052bed5353820ca">strlen</a>(q);
<a name="l04612"></a>04612                     <span class="keywordflow">continue</span>;
<a name="l04613"></a>04613                 }
<a name="l04614"></a>04614             }
<a name="l04615"></a>04615             <a class="code" href="../../d7/d72/subst_8h.html#aa367b75c5aed883fef5befbdf04835a4">snprintf</a>(q, qend-q, <span class="stringliteral">&quot;x%02X&quot;</span>, c);
<a name="l04616"></a>04616             q += 3;
<a name="l04617"></a>04617         }
<a name="l04618"></a>04618     }
<a name="l04619"></a>04619     *q++ = <span class="charliteral">&apos;&quot;&apos;</span>;
<a name="l04620"></a>04620     *q = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l04621"></a>04621     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/de3/encoding_8h.html#a8b18a09a3055d3006c6d5baeaa6e7c72">rb_enc_asciicompat</a>(enc)) {
<a name="l04622"></a>04622         <a class="code" href="../../d7/d72/subst_8h.html#aa367b75c5aed883fef5befbdf04835a4">snprintf</a>(q, qend-q, <span class="stringliteral">&quot;.force_encoding(\&quot;%s\&quot;)&quot;</span>, enc-&gt;<a class="code" href="../../d1/d7b/struct_onig_encoding_type_s_t.html#a297b454a05f56650dbba59d0109b3f7f">name</a>);
<a name="l04623"></a>04623         enc = <a class="code" href="../../d5/db5/encoding_8c.html#a767d777810f0d48add93857b52057262">rb_ascii8bit_encoding</a>();
<a name="l04624"></a>04624     }
<a name="l04625"></a>04625     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3bf9ab455a1e0e3e8cfc6ebabd8f12df">OBJ_INFECT</a>(result, str);
<a name="l04626"></a>04626     <span class="comment">/* result from dump is ASCII */</span>
<a name="l04627"></a>04627     <a class="code" href="../../d5/db5/encoding_8c.html#a150a6e3ac22ac3be8f8c2ccc74a28e7b">rb_enc_associate</a>(result, enc);
<a name="l04628"></a>04628     <a class="code" href="../../d5/de3/encoding_8h.html#aefe5772c0116cf7131a5227de7243dbc">ENC_CODERANGE_SET</a>(result, <a class="code" href="../../d5/de3/encoding_8h.html#a0a0e73a2d98205044e1ad19432502c5b">ENC_CODERANGE_7BIT</a>);
<a name="l04629"></a>04629     <span class="keywordflow">return</span> result;
<a name="l04630"></a>04630 }
<a name="l04631"></a>04631 
<a name="l04632"></a>04632 
<a name="l04633"></a>04633 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l04634"></a><a class="code" href="../../d1/db0/string_8c.html#aafaaea3c592858dcd69e637d9a575233">04634</a> <a class="code" href="../../d1/db0/string_8c.html#aafaaea3c592858dcd69e637d9a575233">rb_str_check_dummy_enc</a>(<a class="code" href="../../d1/d7b/struct_onig_encoding_type_s_t.html">rb_encoding</a> *enc)
<a name="l04635"></a>04635 {
<a name="l04636"></a>04636     <span class="keywordflow">if</span> (<a class="code" href="../../d5/de3/encoding_8h.html#a2979c0f6fe1dd9fef0c79db81687c00f">rb_enc_dummy_p</a>(enc)) {
<a name="l04637"></a>04637         <a class="code" href="../../db/dcc/error_8c.html#a0f771a2840561f1838169b3d7d4616f3">rb_raise</a>(<a class="code" href="../../db/dcc/error_8c.html#a71f980ead61a4ac261914ffaaa184e1f">rb_eEncCompatError</a>, <span class="stringliteral">&quot;incompatible encoding with this operation: %s&quot;</span>,
<a name="l04638"></a>04638                  <a class="code" href="../../d5/de3/encoding_8h.html#a69d59d898802726787a168ef2e0dc92c">rb_enc_name</a>(enc));
<a name="l04639"></a>04639     }
<a name="l04640"></a>04640 }
<a name="l04641"></a>04641 
<a name="l04642"></a>04642 <span class="comment">/*</span>
<a name="l04643"></a>04643 <span class="comment"> *  call-seq:</span>
<a name="l04644"></a>04644 <span class="comment"> *     str.upcase!   -&gt; str or nil</span>
<a name="l04645"></a>04645 <span class="comment"> *</span>
<a name="l04646"></a>04646 <span class="comment"> *  Upcases the contents of &lt;i&gt;str&lt;/i&gt;, returning &lt;code&gt;nil&lt;/code&gt; if no changes</span>
<a name="l04647"></a>04647 <span class="comment"> *  were made.</span>
<a name="l04648"></a>04648 <span class="comment"> *  Note: case replacement is effective only in ASCII region.</span>
<a name="l04649"></a>04649 <span class="comment"> */</span>
<a name="l04650"></a>04650 
<a name="l04651"></a>04651 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l04652"></a><a class="code" href="../../d1/db0/string_8c.html#a965bf239c7b44bae4e7d45d98cd6f4c7">04652</a> <a class="code" href="../../d1/db0/string_8c.html#a965bf239c7b44bae4e7d45d98cd6f4c7">rb_str_upcase_bang</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str)
<a name="l04653"></a>04653 {
<a name="l04654"></a>04654     <a class="code" href="../../d1/d7b/struct_onig_encoding_type_s_t.html">rb_encoding</a> *enc;
<a name="l04655"></a>04655     <span class="keywordtype">char</span> *s, *send;
<a name="l04656"></a>04656     <span class="keywordtype">int</span> modify = 0;
<a name="l04657"></a>04657     <span class="keywordtype">int</span> n;
<a name="l04658"></a>04658 
<a name="l04659"></a>04659     <a class="code" href="../../d1/db0/string_8c.html#a106a1166130a12736cf57bacc164e4a5">str_modify_keep_cr</a>(str);
<a name="l04660"></a>04660     enc = <a class="code" href="../../d1/db0/string_8c.html#a123891f9f9b0c87d15621d93b4fa9c41">STR_ENC_GET</a>(str);
<a name="l04661"></a>04661     <a class="code" href="../../d1/db0/string_8c.html#aafaaea3c592858dcd69e637d9a575233">rb_str_check_dummy_enc</a>(enc);
<a name="l04662"></a>04662     s = <a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(str); send = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a35bfa2635774977edad0a16b9fdebbaf">RSTRING_END</a>(str);
<a name="l04663"></a>04663     <span class="keywordflow">if</span> (<a class="code" href="../../d1/db0/string_8c.html#a5ab3c8112c2ec6943bdae8a2036fca02">single_byte_optimizable</a>(str)) {
<a name="l04664"></a>04664         <span class="keywordflow">while</span> (s &lt; send) {
<a name="l04665"></a>04665             <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> c = *(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*)s;
<a name="l04666"></a>04666 
<a name="l04667"></a>04667             <span class="keywordflow">if</span> (<a class="code" href="../../d5/de3/encoding_8h.html#a6a45c3c98c745038de6c66a5014e0b35">rb_enc_isascii</a>(c, enc) &amp;&amp; <span class="charliteral">&apos;a&apos;</span> &lt;= c &amp;&amp; c &lt;= <span class="charliteral">&apos;z&apos;</span>) {
<a name="l04668"></a>04668                 *s = <span class="charliteral">&apos;A&apos;</span> + (c - <span class="charliteral">&apos;a&apos;</span>);
<a name="l04669"></a>04669                 modify = 1;
<a name="l04670"></a>04670             }
<a name="l04671"></a>04671             s++;
<a name="l04672"></a>04672         }
<a name="l04673"></a>04673     }
<a name="l04674"></a>04674     <span class="keywordflow">else</span> {
<a name="l04675"></a>04675         <span class="keywordtype">int</span> ascompat = <a class="code" href="../../d5/de3/encoding_8h.html#a8b18a09a3055d3006c6d5baeaa6e7c72">rb_enc_asciicompat</a>(enc);
<a name="l04676"></a>04676 
<a name="l04677"></a>04677         <span class="keywordflow">while</span> (s &lt; send) {
<a name="l04678"></a>04678             <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> c;
<a name="l04679"></a>04679 
<a name="l04680"></a>04680             <span class="keywordflow">if</span> (ascompat &amp;&amp; (c = *(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*)s) &lt; 0x80) {
<a name="l04681"></a>04681                 <span class="keywordflow">if</span> (<a class="code" href="../../d5/de3/encoding_8h.html#a6a45c3c98c745038de6c66a5014e0b35">rb_enc_isascii</a>(c, enc) &amp;&amp; <span class="charliteral">&apos;a&apos;</span> &lt;= c &amp;&amp; c &lt;= <span class="charliteral">&apos;z&apos;</span>) {
<a name="l04682"></a>04682                     *s = <span class="charliteral">&apos;A&apos;</span> + (c - <span class="charliteral">&apos;a&apos;</span>);
<a name="l04683"></a>04683                     modify = 1;
<a name="l04684"></a>04684                 }
<a name="l04685"></a>04685                 s++;
<a name="l04686"></a>04686             }
<a name="l04687"></a>04687             <span class="keywordflow">else</span> {
<a name="l04688"></a>04688                 c = <a class="code" href="../../d5/db5/encoding_8c.html#a25e1e0b74ee98f47dd26a44bb11b7b3c">rb_enc_codepoint_len</a>(s, send, &amp;n, enc);
<a name="l04689"></a>04689                 <span class="keywordflow">if</span> (<a class="code" href="../../d5/de3/encoding_8h.html#ab0e0426c60fdb75dcd8aa9394e479b91">rb_enc_islower</a>(c, enc)) {
<a name="l04690"></a>04690                     <span class="comment">/* assuming toupper returns codepoint with same size */</span>
<a name="l04691"></a>04691                     <a class="code" href="../../d5/de3/encoding_8h.html#a243639504d867c0a638be91db2d19db1">rb_enc_mbcput</a>(<a class="code" href="../../d5/db5/encoding_8c.html#ad1b6acfefbb864550c71c4b08c68e15f">rb_enc_toupper</a>(c, enc), s, enc);
<a name="l04692"></a>04692                     modify = 1;
<a name="l04693"></a>04693                 }
<a name="l04694"></a>04694                 s += n;
<a name="l04695"></a>04695             }
<a name="l04696"></a>04696         }
<a name="l04697"></a>04697     }
<a name="l04698"></a>04698 
<a name="l04699"></a>04699     <span class="keywordflow">if</span> (modify) <span class="keywordflow">return</span> str;
<a name="l04700"></a>04700     <span class="keywordflow">return</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a320970f989dc8294c8203154e3db40c1">Qnil</a>;
<a name="l04701"></a>04701 }
<a name="l04702"></a>04702 
<a name="l04703"></a>04703 
<a name="l04704"></a>04704 <span class="comment">/*</span>
<a name="l04705"></a>04705 <span class="comment"> *  call-seq:</span>
<a name="l04706"></a>04706 <span class="comment"> *     str.upcase   -&gt; new_str</span>
<a name="l04707"></a>04707 <span class="comment"> *</span>
<a name="l04708"></a>04708 <span class="comment"> *  Returns a copy of &lt;i&gt;str&lt;/i&gt; with all lowercase letters replaced with their</span>
<a name="l04709"></a>04709 <span class="comment"> *  uppercase counterparts. The operation is locale insensitive---only</span>
<a name="l04710"></a>04710 <span class="comment"> *  characters ``a&apos;&apos; to ``z&apos;&apos; are affected.</span>
<a name="l04711"></a>04711 <span class="comment"> *  Note: case replacement is effective only in ASCII region.</span>
<a name="l04712"></a>04712 <span class="comment"> *</span>
<a name="l04713"></a>04713 <span class="comment"> *     &quot;hEllO&quot;.upcase   #=&gt; &quot;HELLO&quot;</span>
<a name="l04714"></a>04714 <span class="comment"> */</span>
<a name="l04715"></a>04715 
<a name="l04716"></a>04716 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l04717"></a><a class="code" href="../../d1/db0/string_8c.html#af6774b0c71b84fef54ac5238d5c7b7e0">04717</a> <a class="code" href="../../d1/db0/string_8c.html#af6774b0c71b84fef54ac5238d5c7b7e0">rb_str_upcase</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str)
<a name="l04718"></a>04718 {
<a name="l04719"></a>04719     str = <a class="code" href="../../db/d2e/intern_8h.html#ae2843c766c24b80116bb127ebf22d5bf">rb_str_dup</a>(str);
<a name="l04720"></a>04720     <a class="code" href="../../d1/db0/string_8c.html#a965bf239c7b44bae4e7d45d98cd6f4c7">rb_str_upcase_bang</a>(str);
<a name="l04721"></a>04721     <span class="keywordflow">return</span> str;
<a name="l04722"></a>04722 }
<a name="l04723"></a>04723 
<a name="l04724"></a>04724 
<a name="l04725"></a>04725 <span class="comment">/*</span>
<a name="l04726"></a>04726 <span class="comment"> *  call-seq:</span>
<a name="l04727"></a>04727 <span class="comment"> *     str.downcase!   -&gt; str or nil</span>
<a name="l04728"></a>04728 <span class="comment"> *</span>
<a name="l04729"></a>04729 <span class="comment"> *  Downcases the contents of &lt;i&gt;str&lt;/i&gt;, returning &lt;code&gt;nil&lt;/code&gt; if no</span>
<a name="l04730"></a>04730 <span class="comment"> *  changes were made.</span>
<a name="l04731"></a>04731 <span class="comment"> *  Note: case replacement is effective only in ASCII region.</span>
<a name="l04732"></a>04732 <span class="comment"> */</span>
<a name="l04733"></a>04733 
<a name="l04734"></a>04734 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l04735"></a><a class="code" href="../../d1/db0/string_8c.html#af6e6dcdac511f77bac2587ae3a599d46">04735</a> <a class="code" href="../../d1/db0/string_8c.html#af6e6dcdac511f77bac2587ae3a599d46">rb_str_downcase_bang</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str)
<a name="l04736"></a>04736 {
<a name="l04737"></a>04737     <a class="code" href="../../d1/d7b/struct_onig_encoding_type_s_t.html">rb_encoding</a> *enc;
<a name="l04738"></a>04738     <span class="keywordtype">char</span> *s, *send;
<a name="l04739"></a>04739     <span class="keywordtype">int</span> modify = 0;
<a name="l04740"></a>04740 
<a name="l04741"></a>04741     <a class="code" href="../../d1/db0/string_8c.html#a106a1166130a12736cf57bacc164e4a5">str_modify_keep_cr</a>(str);
<a name="l04742"></a>04742     enc = <a class="code" href="../../d1/db0/string_8c.html#a123891f9f9b0c87d15621d93b4fa9c41">STR_ENC_GET</a>(str);
<a name="l04743"></a>04743     <a class="code" href="../../d1/db0/string_8c.html#aafaaea3c592858dcd69e637d9a575233">rb_str_check_dummy_enc</a>(enc);
<a name="l04744"></a>04744     s = <a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(str); send = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a35bfa2635774977edad0a16b9fdebbaf">RSTRING_END</a>(str);
<a name="l04745"></a>04745     <span class="keywordflow">if</span> (<a class="code" href="../../d1/db0/string_8c.html#a5ab3c8112c2ec6943bdae8a2036fca02">single_byte_optimizable</a>(str)) {
<a name="l04746"></a>04746         <span class="keywordflow">while</span> (s &lt; send) {
<a name="l04747"></a>04747             <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> c = *(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*)s;
<a name="l04748"></a>04748 
<a name="l04749"></a>04749             <span class="keywordflow">if</span> (<a class="code" href="../../d5/de3/encoding_8h.html#a6a45c3c98c745038de6c66a5014e0b35">rb_enc_isascii</a>(c, enc) &amp;&amp; <span class="charliteral">&apos;A&apos;</span> &lt;= c &amp;&amp; c &lt;= <span class="charliteral">&apos;Z&apos;</span>) {
<a name="l04750"></a>04750                 *s = <span class="charliteral">&apos;a&apos;</span> + (c - <span class="charliteral">&apos;A&apos;</span>);
<a name="l04751"></a>04751                 modify = 1;
<a name="l04752"></a>04752             }
<a name="l04753"></a>04753             s++;
<a name="l04754"></a>04754         }
<a name="l04755"></a>04755     }
<a name="l04756"></a>04756     <span class="keywordflow">else</span> {
<a name="l04757"></a>04757         <span class="keywordtype">int</span> ascompat = <a class="code" href="../../d5/de3/encoding_8h.html#a8b18a09a3055d3006c6d5baeaa6e7c72">rb_enc_asciicompat</a>(enc);
<a name="l04758"></a>04758 
<a name="l04759"></a>04759         <span class="keywordflow">while</span> (s &lt; send) {
<a name="l04760"></a>04760             <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> c;
<a name="l04761"></a>04761             <span class="keywordtype">int</span> n;
<a name="l04762"></a>04762 
<a name="l04763"></a>04763             <span class="keywordflow">if</span> (ascompat &amp;&amp; (c = *(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*)s) &lt; 0x80) {
<a name="l04764"></a>04764                 <span class="keywordflow">if</span> (<a class="code" href="../../d5/de3/encoding_8h.html#a6a45c3c98c745038de6c66a5014e0b35">rb_enc_isascii</a>(c, enc) &amp;&amp; <span class="charliteral">&apos;A&apos;</span> &lt;= c &amp;&amp; c &lt;= <span class="charliteral">&apos;Z&apos;</span>) {
<a name="l04765"></a>04765                     *s = <span class="charliteral">&apos;a&apos;</span> + (c - <span class="charliteral">&apos;A&apos;</span>);
<a name="l04766"></a>04766                     modify = 1;
<a name="l04767"></a>04767                 }
<a name="l04768"></a>04768                 s++;
<a name="l04769"></a>04769             }
<a name="l04770"></a>04770             <span class="keywordflow">else</span> {
<a name="l04771"></a>04771                 c = <a class="code" href="../../d5/db5/encoding_8c.html#a25e1e0b74ee98f47dd26a44bb11b7b3c">rb_enc_codepoint_len</a>(s, send, &amp;n, enc);
<a name="l04772"></a>04772                 <span class="keywordflow">if</span> (<a class="code" href="../../d5/de3/encoding_8h.html#a004214571fa83485ab3eb73690c694c4">rb_enc_isupper</a>(c, enc)) {
<a name="l04773"></a>04773                     <span class="comment">/* assuming toupper returns codepoint with same size */</span>
<a name="l04774"></a>04774                     <a class="code" href="../../d5/de3/encoding_8h.html#a243639504d867c0a638be91db2d19db1">rb_enc_mbcput</a>(<a class="code" href="../../d5/db5/encoding_8c.html#a8a15db006738fdbbe7410bbf1fb466e5">rb_enc_tolower</a>(c, enc), s, enc);
<a name="l04775"></a>04775                     modify = 1;
<a name="l04776"></a>04776                 }
<a name="l04777"></a>04777                 s += n;
<a name="l04778"></a>04778             }
<a name="l04779"></a>04779         }
<a name="l04780"></a>04780     }
<a name="l04781"></a>04781 
<a name="l04782"></a>04782     <span class="keywordflow">if</span> (modify) <span class="keywordflow">return</span> str;
<a name="l04783"></a>04783     <span class="keywordflow">return</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a320970f989dc8294c8203154e3db40c1">Qnil</a>;
<a name="l04784"></a>04784 }
<a name="l04785"></a>04785 
<a name="l04786"></a>04786 
<a name="l04787"></a>04787 <span class="comment">/*</span>
<a name="l04788"></a>04788 <span class="comment"> *  call-seq:</span>
<a name="l04789"></a>04789 <span class="comment"> *     str.downcase   -&gt; new_str</span>
<a name="l04790"></a>04790 <span class="comment"> *</span>
<a name="l04791"></a>04791 <span class="comment"> *  Returns a copy of &lt;i&gt;str&lt;/i&gt; with all uppercase letters replaced with their</span>
<a name="l04792"></a>04792 <span class="comment"> *  lowercase counterparts. The operation is locale insensitive---only</span>
<a name="l04793"></a>04793 <span class="comment"> *  characters ``A&apos;&apos; to ``Z&apos;&apos; are affected.</span>
<a name="l04794"></a>04794 <span class="comment"> *  Note: case replacement is effective only in ASCII region.</span>
<a name="l04795"></a>04795 <span class="comment"> *</span>
<a name="l04796"></a>04796 <span class="comment"> *     &quot;hEllO&quot;.downcase   #=&gt; &quot;hello&quot;</span>
<a name="l04797"></a>04797 <span class="comment"> */</span>
<a name="l04798"></a>04798 
<a name="l04799"></a>04799 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l04800"></a><a class="code" href="../../d1/db0/string_8c.html#a88d852a8e73145f27cf1dfe23a073660">04800</a> <a class="code" href="../../d1/db0/string_8c.html#a88d852a8e73145f27cf1dfe23a073660">rb_str_downcase</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str)
<a name="l04801"></a>04801 {
<a name="l04802"></a>04802     str = <a class="code" href="../../db/d2e/intern_8h.html#ae2843c766c24b80116bb127ebf22d5bf">rb_str_dup</a>(str);
<a name="l04803"></a>04803     <a class="code" href="../../d1/db0/string_8c.html#af6e6dcdac511f77bac2587ae3a599d46">rb_str_downcase_bang</a>(str);
<a name="l04804"></a>04804     <span class="keywordflow">return</span> str;
<a name="l04805"></a>04805 }
<a name="l04806"></a>04806 
<a name="l04807"></a>04807 
<a name="l04808"></a>04808 <span class="comment">/*</span>
<a name="l04809"></a>04809 <span class="comment"> *  call-seq:</span>
<a name="l04810"></a>04810 <span class="comment"> *     str.capitalize!   -&gt; str or nil</span>
<a name="l04811"></a>04811 <span class="comment"> *</span>
<a name="l04812"></a>04812 <span class="comment"> *  Modifies &lt;i&gt;str&lt;/i&gt; by converting the first character to uppercase and the</span>
<a name="l04813"></a>04813 <span class="comment"> *  remainder to lowercase. Returns &lt;code&gt;nil&lt;/code&gt; if no changes are made.</span>
<a name="l04814"></a>04814 <span class="comment"> *  Note: case conversion is effective only in ASCII region.</span>
<a name="l04815"></a>04815 <span class="comment"> *</span>
<a name="l04816"></a>04816 <span class="comment"> *     a = &quot;hello&quot;</span>
<a name="l04817"></a>04817 <span class="comment"> *     a.capitalize!   #=&gt; &quot;Hello&quot;</span>
<a name="l04818"></a>04818 <span class="comment"> *     a               #=&gt; &quot;Hello&quot;</span>
<a name="l04819"></a>04819 <span class="comment"> *     a.capitalize!   #=&gt; nil</span>
<a name="l04820"></a>04820 <span class="comment"> */</span>
<a name="l04821"></a>04821 
<a name="l04822"></a>04822 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l04823"></a><a class="code" href="../../d1/db0/string_8c.html#af51341d4d0caebe7d75c8a9ec26aae9c">04823</a> <a class="code" href="../../d1/db0/string_8c.html#af51341d4d0caebe7d75c8a9ec26aae9c">rb_str_capitalize_bang</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str)
<a name="l04824"></a>04824 {
<a name="l04825"></a>04825     <a class="code" href="../../d1/d7b/struct_onig_encoding_type_s_t.html">rb_encoding</a> *enc;
<a name="l04826"></a>04826     <span class="keywordtype">char</span> *s, *send;
<a name="l04827"></a>04827     <span class="keywordtype">int</span> modify = 0;
<a name="l04828"></a>04828     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> c;
<a name="l04829"></a>04829     <span class="keywordtype">int</span> n;
<a name="l04830"></a>04830 
<a name="l04831"></a>04831     <a class="code" href="../../d1/db0/string_8c.html#a106a1166130a12736cf57bacc164e4a5">str_modify_keep_cr</a>(str);
<a name="l04832"></a>04832     enc = <a class="code" href="../../d1/db0/string_8c.html#a123891f9f9b0c87d15621d93b4fa9c41">STR_ENC_GET</a>(str);
<a name="l04833"></a>04833     <a class="code" href="../../d1/db0/string_8c.html#aafaaea3c592858dcd69e637d9a575233">rb_str_check_dummy_enc</a>(enc);
<a name="l04834"></a>04834     <span class="keywordflow">if</span> (<a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(str) == 0 || !<a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(str)) <span class="keywordflow">return</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a320970f989dc8294c8203154e3db40c1">Qnil</a>;
<a name="l04835"></a>04835     s = <a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(str); send = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a35bfa2635774977edad0a16b9fdebbaf">RSTRING_END</a>(str);
<a name="l04836"></a>04836 
<a name="l04837"></a>04837     c = <a class="code" href="../../d5/db5/encoding_8c.html#a25e1e0b74ee98f47dd26a44bb11b7b3c">rb_enc_codepoint_len</a>(s, send, &amp;n, enc);
<a name="l04838"></a>04838     <span class="keywordflow">if</span> (<a class="code" href="../../d5/de3/encoding_8h.html#ab0e0426c60fdb75dcd8aa9394e479b91">rb_enc_islower</a>(c, enc)) {
<a name="l04839"></a>04839         <a class="code" href="../../d5/de3/encoding_8h.html#a243639504d867c0a638be91db2d19db1">rb_enc_mbcput</a>(<a class="code" href="../../d5/db5/encoding_8c.html#ad1b6acfefbb864550c71c4b08c68e15f">rb_enc_toupper</a>(c, enc), s, enc);
<a name="l04840"></a>04840         modify = 1;
<a name="l04841"></a>04841     }
<a name="l04842"></a>04842     s += n;
<a name="l04843"></a>04843     <span class="keywordflow">while</span> (s &lt; send) {
<a name="l04844"></a>04844         c = <a class="code" href="../../d5/db5/encoding_8c.html#a25e1e0b74ee98f47dd26a44bb11b7b3c">rb_enc_codepoint_len</a>(s, send, &amp;n, enc);
<a name="l04845"></a>04845         <span class="keywordflow">if</span> (<a class="code" href="../../d5/de3/encoding_8h.html#a004214571fa83485ab3eb73690c694c4">rb_enc_isupper</a>(c, enc)) {
<a name="l04846"></a>04846             <a class="code" href="../../d5/de3/encoding_8h.html#a243639504d867c0a638be91db2d19db1">rb_enc_mbcput</a>(<a class="code" href="../../d5/db5/encoding_8c.html#a8a15db006738fdbbe7410bbf1fb466e5">rb_enc_tolower</a>(c, enc), s, enc);
<a name="l04847"></a>04847             modify = 1;
<a name="l04848"></a>04848         }
<a name="l04849"></a>04849         s += n;
<a name="l04850"></a>04850     }
<a name="l04851"></a>04851 
<a name="l04852"></a>04852     <span class="keywordflow">if</span> (modify) <span class="keywordflow">return</span> str;
<a name="l04853"></a>04853     <span class="keywordflow">return</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a320970f989dc8294c8203154e3db40c1">Qnil</a>;
<a name="l04854"></a>04854 }
<a name="l04855"></a>04855 
<a name="l04856"></a>04856 
<a name="l04857"></a>04857 <span class="comment">/*</span>
<a name="l04858"></a>04858 <span class="comment"> *  call-seq:</span>
<a name="l04859"></a>04859 <span class="comment"> *     str.capitalize   -&gt; new_str</span>
<a name="l04860"></a>04860 <span class="comment"> *</span>
<a name="l04861"></a>04861 <span class="comment"> *  Returns a copy of &lt;i&gt;str&lt;/i&gt; with the first character converted to uppercase</span>
<a name="l04862"></a>04862 <span class="comment"> *  and the remainder to lowercase.</span>
<a name="l04863"></a>04863 <span class="comment"> *  Note: case conversion is effective only in ASCII region.</span>
<a name="l04864"></a>04864 <span class="comment"> *</span>
<a name="l04865"></a>04865 <span class="comment"> *     &quot;hello&quot;.capitalize    #=&gt; &quot;Hello&quot;</span>
<a name="l04866"></a>04866 <span class="comment"> *     &quot;HELLO&quot;.capitalize    #=&gt; &quot;Hello&quot;</span>
<a name="l04867"></a>04867 <span class="comment"> *     &quot;123ABC&quot;.capitalize   #=&gt; &quot;123abc&quot;</span>
<a name="l04868"></a>04868 <span class="comment"> */</span>
<a name="l04869"></a>04869 
<a name="l04870"></a>04870 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l04871"></a><a class="code" href="../../d1/db0/string_8c.html#a3cd8b3462399852b1c84165e8853b492">04871</a> <a class="code" href="../../d1/db0/string_8c.html#a3cd8b3462399852b1c84165e8853b492">rb_str_capitalize</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str)
<a name="l04872"></a>04872 {
<a name="l04873"></a>04873     str = <a class="code" href="../../db/d2e/intern_8h.html#ae2843c766c24b80116bb127ebf22d5bf">rb_str_dup</a>(str);
<a name="l04874"></a>04874     <a class="code" href="../../d1/db0/string_8c.html#af51341d4d0caebe7d75c8a9ec26aae9c">rb_str_capitalize_bang</a>(str);
<a name="l04875"></a>04875     <span class="keywordflow">return</span> str;
<a name="l04876"></a>04876 }
<a name="l04877"></a>04877 
<a name="l04878"></a>04878 
<a name="l04879"></a>04879 <span class="comment">/*</span>
<a name="l04880"></a>04880 <span class="comment"> *  call-seq:</span>
<a name="l04881"></a>04881 <span class="comment"> *     str.swapcase!   -&gt; str or nil</span>
<a name="l04882"></a>04882 <span class="comment"> *</span>
<a name="l04883"></a>04883 <span class="comment"> *  Equivalent to &lt;code&gt;String#swapcase&lt;/code&gt;, but modifies the receiver in</span>
<a name="l04884"></a>04884 <span class="comment"> *  place, returning &lt;i&gt;str&lt;/i&gt;, or &lt;code&gt;nil&lt;/code&gt; if no changes were made.</span>
<a name="l04885"></a>04885 <span class="comment"> *  Note: case conversion is effective only in ASCII region.</span>
<a name="l04886"></a>04886 <span class="comment"> */</span>
<a name="l04887"></a>04887 
<a name="l04888"></a>04888 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l04889"></a><a class="code" href="../../d1/db0/string_8c.html#a19c2c715bda09ff61511cd36172b7159">04889</a> <a class="code" href="../../d1/db0/string_8c.html#a19c2c715bda09ff61511cd36172b7159">rb_str_swapcase_bang</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str)
<a name="l04890"></a>04890 {
<a name="l04891"></a>04891     <a class="code" href="../../d1/d7b/struct_onig_encoding_type_s_t.html">rb_encoding</a> *enc;
<a name="l04892"></a>04892     <span class="keywordtype">char</span> *s, *send;
<a name="l04893"></a>04893     <span class="keywordtype">int</span> modify = 0;
<a name="l04894"></a>04894     <span class="keywordtype">int</span> n;
<a name="l04895"></a>04895 
<a name="l04896"></a>04896     <a class="code" href="../../d1/db0/string_8c.html#a106a1166130a12736cf57bacc164e4a5">str_modify_keep_cr</a>(str);
<a name="l04897"></a>04897     enc = <a class="code" href="../../d1/db0/string_8c.html#a123891f9f9b0c87d15621d93b4fa9c41">STR_ENC_GET</a>(str);
<a name="l04898"></a>04898     <a class="code" href="../../d1/db0/string_8c.html#aafaaea3c592858dcd69e637d9a575233">rb_str_check_dummy_enc</a>(enc);
<a name="l04899"></a>04899     s = <a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(str); send = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a35bfa2635774977edad0a16b9fdebbaf">RSTRING_END</a>(str);
<a name="l04900"></a>04900     <span class="keywordflow">while</span> (s &lt; send) {
<a name="l04901"></a>04901         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> c = <a class="code" href="../../d5/db5/encoding_8c.html#a25e1e0b74ee98f47dd26a44bb11b7b3c">rb_enc_codepoint_len</a>(s, send, &amp;n, enc);
<a name="l04902"></a>04902 
<a name="l04903"></a>04903         <span class="keywordflow">if</span> (<a class="code" href="../../d5/de3/encoding_8h.html#a004214571fa83485ab3eb73690c694c4">rb_enc_isupper</a>(c, enc)) {
<a name="l04904"></a>04904             <span class="comment">/* assuming toupper returns codepoint with same size */</span>
<a name="l04905"></a>04905             <a class="code" href="../../d5/de3/encoding_8h.html#a243639504d867c0a638be91db2d19db1">rb_enc_mbcput</a>(<a class="code" href="../../d5/db5/encoding_8c.html#a8a15db006738fdbbe7410bbf1fb466e5">rb_enc_tolower</a>(c, enc), s, enc);
<a name="l04906"></a>04906             modify = 1;
<a name="l04907"></a>04907         }
<a name="l04908"></a>04908         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d5/de3/encoding_8h.html#ab0e0426c60fdb75dcd8aa9394e479b91">rb_enc_islower</a>(c, enc)) {
<a name="l04909"></a>04909             <span class="comment">/* assuming tolower returns codepoint with same size */</span>
<a name="l04910"></a>04910             <a class="code" href="../../d5/de3/encoding_8h.html#a243639504d867c0a638be91db2d19db1">rb_enc_mbcput</a>(<a class="code" href="../../d5/db5/encoding_8c.html#ad1b6acfefbb864550c71c4b08c68e15f">rb_enc_toupper</a>(c, enc), s, enc);
<a name="l04911"></a>04911             modify = 1;
<a name="l04912"></a>04912         }
<a name="l04913"></a>04913         s += n;
<a name="l04914"></a>04914     }
<a name="l04915"></a>04915 
<a name="l04916"></a>04916     <span class="keywordflow">if</span> (modify) <span class="keywordflow">return</span> str;
<a name="l04917"></a>04917     <span class="keywordflow">return</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a320970f989dc8294c8203154e3db40c1">Qnil</a>;
<a name="l04918"></a>04918 }
<a name="l04919"></a>04919 
<a name="l04920"></a>04920 
<a name="l04921"></a>04921 <span class="comment">/*</span>
<a name="l04922"></a>04922 <span class="comment"> *  call-seq:</span>
<a name="l04923"></a>04923 <span class="comment"> *     str.swapcase   -&gt; new_str</span>
<a name="l04924"></a>04924 <span class="comment"> *</span>
<a name="l04925"></a>04925 <span class="comment"> *  Returns a copy of &lt;i&gt;str&lt;/i&gt; with uppercase alphabetic characters converted</span>
<a name="l04926"></a>04926 <span class="comment"> *  to lowercase and lowercase characters converted to uppercase.</span>
<a name="l04927"></a>04927 <span class="comment"> *  Note: case conversion is effective only in ASCII region.</span>
<a name="l04928"></a>04928 <span class="comment"> *</span>
<a name="l04929"></a>04929 <span class="comment"> *     &quot;Hello&quot;.swapcase          #=&gt; &quot;hELLO&quot;</span>
<a name="l04930"></a>04930 <span class="comment"> *     &quot;cYbEr_PuNk11&quot;.swapcase   #=&gt; &quot;CyBeR_pUnK11&quot;</span>
<a name="l04931"></a>04931 <span class="comment"> */</span>
<a name="l04932"></a>04932 
<a name="l04933"></a>04933 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l04934"></a><a class="code" href="../../d1/db0/string_8c.html#a87988a28be9b9aa5115d09128c335bef">04934</a> <a class="code" href="../../d1/db0/string_8c.html#a87988a28be9b9aa5115d09128c335bef">rb_str_swapcase</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str)
<a name="l04935"></a>04935 {
<a name="l04936"></a>04936     str = <a class="code" href="../../db/d2e/intern_8h.html#ae2843c766c24b80116bb127ebf22d5bf">rb_str_dup</a>(str);
<a name="l04937"></a>04937     <a class="code" href="../../d1/db0/string_8c.html#a19c2c715bda09ff61511cd36172b7159">rb_str_swapcase_bang</a>(str);
<a name="l04938"></a>04938     <span class="keywordflow">return</span> str;
<a name="l04939"></a>04939 }
<a name="l04940"></a>04940 
<a name="l04941"></a><a class="code" href="../../d1/db0/string_8c.html#abbb7393b417e7b17248dd5d073c5592c">04941</a> <span class="keyword">typedef</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *<a class="code" href="../../d1/db0/string_8c.html#abbb7393b417e7b17248dd5d073c5592c">USTR</a>;
<a name="l04942"></a>04942 
<a name="l04943"></a><a class="code" href="../../d0/d5c/structtr.html">04943</a> <span class="keyword">struct </span><a class="code" href="../../d0/d5c/structtr.html">tr</a> {
<a name="l04944"></a><a class="code" href="../../d0/d5c/structtr.html#a0bb10a22f9f4851875a27e54efdf15f6">04944</a>     <span class="keywordtype">int</span> <a class="code" href="../../d0/d5c/structtr.html#a0bb10a22f9f4851875a27e54efdf15f6">gen</a>;
<a name="l04945"></a><a class="code" href="../../d0/d5c/structtr.html#a42c2712138348286c7c146aea1783197">04945</a>     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../d0/d5c/structtr.html#a42c2712138348286c7c146aea1783197">now</a>, <a class="code" href="../../d0/d5c/structtr.html#aae084248e06a82cd9d9c9c3a9ddd1407">max</a>;
<a name="l04946"></a><a class="code" href="../../d0/d5c/structtr.html#af81188c6fbc29c6ce46c3f81915e19e6">04946</a>     <span class="keywordtype">char</span> *p, *<a class="code" href="../../d0/d5c/structtr.html#af81188c6fbc29c6ce46c3f81915e19e6">pend</a>;
<a name="l04947"></a>04947 };
<a name="l04948"></a>04948 
<a name="l04949"></a>04949 <span class="keyword">static</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>
<a name="l04950"></a><a class="code" href="../../d1/db0/string_8c.html#aa3d62e8f55c5597988533054147832ee">04950</a> <a class="code" href="../../d1/db0/string_8c.html#aa3d62e8f55c5597988533054147832ee">trnext</a>(<span class="keyword">struct</span> <a class="code" href="../../d0/d5c/structtr.html">tr</a> *t, <a class="code" href="../../d1/d7b/struct_onig_encoding_type_s_t.html">rb_encoding</a> *enc)
<a name="l04951"></a>04951 {
<a name="l04952"></a>04952     <span class="keywordtype">int</span> n;
<a name="l04953"></a>04953 
<a name="l04954"></a>04954     <span class="keywordflow">for</span> (;;) {
<a name="l04955"></a>04955         <span class="keywordflow">if</span> (!t-&gt;<a class="code" href="../../d0/d5c/structtr.html#a0bb10a22f9f4851875a27e54efdf15f6">gen</a>) {
<a name="l04956"></a>04956             <span class="keywordflow">if</span> (t-&gt;<a class="code" href="../../d0/d5c/structtr.html#aef59b4ef766e46586916e3206f655bf3">p</a> == t-&gt;<a class="code" href="../../d0/d5c/structtr.html#af81188c6fbc29c6ce46c3f81915e19e6">pend</a>) <span class="keywordflow">return</span> -1;
<a name="l04957"></a>04957             <span class="keywordflow">if</span> (t-&gt;<a class="code" href="../../d0/d5c/structtr.html#aef59b4ef766e46586916e3206f655bf3">p</a> &lt; t-&gt;<a class="code" href="../../d0/d5c/structtr.html#af81188c6fbc29c6ce46c3f81915e19e6">pend</a> - 1 &amp;&amp; *t-&gt;<a class="code" href="../../d0/d5c/structtr.html#aef59b4ef766e46586916e3206f655bf3">p</a> == <span class="charliteral">&apos;\\&apos;</span>) {
<a name="l04958"></a>04958                 t-&gt;<a class="code" href="../../d0/d5c/structtr.html#aef59b4ef766e46586916e3206f655bf3">p</a>++;
<a name="l04959"></a>04959             }
<a name="l04960"></a>04960             t-&gt;<a class="code" href="../../d0/d5c/structtr.html#a42c2712138348286c7c146aea1783197">now</a> = <a class="code" href="../../d5/db5/encoding_8c.html#a25e1e0b74ee98f47dd26a44bb11b7b3c">rb_enc_codepoint_len</a>(t-&gt;<a class="code" href="../../d0/d5c/structtr.html#aef59b4ef766e46586916e3206f655bf3">p</a>, t-&gt;<a class="code" href="../../d0/d5c/structtr.html#af81188c6fbc29c6ce46c3f81915e19e6">pend</a>, &amp;n, enc);
<a name="l04961"></a>04961             t-&gt;<a class="code" href="../../d0/d5c/structtr.html#aef59b4ef766e46586916e3206f655bf3">p</a> += n;
<a name="l04962"></a>04962             <span class="keywordflow">if</span> (t-&gt;<a class="code" href="../../d0/d5c/structtr.html#aef59b4ef766e46586916e3206f655bf3">p</a> &lt; t-&gt;<a class="code" href="../../d0/d5c/structtr.html#af81188c6fbc29c6ce46c3f81915e19e6">pend</a> - 1 &amp;&amp; *t-&gt;<a class="code" href="../../d0/d5c/structtr.html#aef59b4ef766e46586916e3206f655bf3">p</a> == <span class="charliteral">&apos;-&apos;</span>) {
<a name="l04963"></a>04963                 t-&gt;<a class="code" href="../../d0/d5c/structtr.html#aef59b4ef766e46586916e3206f655bf3">p</a>++;
<a name="l04964"></a>04964                 <span class="keywordflow">if</span> (t-&gt;<a class="code" href="../../d0/d5c/structtr.html#aef59b4ef766e46586916e3206f655bf3">p</a> &lt; t-&gt;<a class="code" href="../../d0/d5c/structtr.html#af81188c6fbc29c6ce46c3f81915e19e6">pend</a>) {
<a name="l04965"></a>04965                     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> c = <a class="code" href="../../d5/db5/encoding_8c.html#a25e1e0b74ee98f47dd26a44bb11b7b3c">rb_enc_codepoint_len</a>(t-&gt;<a class="code" href="../../d0/d5c/structtr.html#aef59b4ef766e46586916e3206f655bf3">p</a>, t-&gt;<a class="code" href="../../d0/d5c/structtr.html#af81188c6fbc29c6ce46c3f81915e19e6">pend</a>, &amp;n, enc);
<a name="l04966"></a>04966                     t-&gt;<a class="code" href="../../d0/d5c/structtr.html#aef59b4ef766e46586916e3206f655bf3">p</a> += n;
<a name="l04967"></a>04967                     <span class="keywordflow">if</span> (t-&gt;<a class="code" href="../../d0/d5c/structtr.html#a42c2712138348286c7c146aea1783197">now</a> &gt; c) {
<a name="l04968"></a>04968                         <span class="keywordflow">if</span> (t-&gt;<a class="code" href="../../d0/d5c/structtr.html#a42c2712138348286c7c146aea1783197">now</a> &lt; 0x80 &amp;&amp; c &lt; 0x80) {
<a name="l04969"></a>04969                             <a class="code" href="../../db/dcc/error_8c.html#a0f771a2840561f1838169b3d7d4616f3">rb_raise</a>(<a class="code" href="../../db/dcc/error_8c.html#ab5e2a9fec766c75176fbb262bfe6a596">rb_eArgError</a>,
<a name="l04970"></a>04970                                      <span class="stringliteral">&quot;invalid range \&quot;%c-%c\&quot; in string transliteration&quot;</span>,
<a name="l04971"></a>04971                                      t-&gt;<a class="code" href="../../d0/d5c/structtr.html#a42c2712138348286c7c146aea1783197">now</a>, c);
<a name="l04972"></a>04972                         }
<a name="l04973"></a>04973                         <span class="keywordflow">else</span> {
<a name="l04974"></a>04974                             <a class="code" href="../../db/dcc/error_8c.html#a0f771a2840561f1838169b3d7d4616f3">rb_raise</a>(<a class="code" href="../../db/dcc/error_8c.html#ab5e2a9fec766c75176fbb262bfe6a596">rb_eArgError</a>, <span class="stringliteral">&quot;invalid range in string transliteration&quot;</span>);
<a name="l04975"></a>04975                         }
<a name="l04976"></a>04976                         <span class="keywordflow">continue</span>; <span class="comment">/* not reached */</span>
<a name="l04977"></a>04977                     }
<a name="l04978"></a>04978                     t-&gt;<a class="code" href="../../d0/d5c/structtr.html#a0bb10a22f9f4851875a27e54efdf15f6">gen</a> = 1;
<a name="l04979"></a>04979                     t-&gt;<a class="code" href="../../d0/d5c/structtr.html#aae084248e06a82cd9d9c9c3a9ddd1407">max</a> = c;
<a name="l04980"></a>04980                 }
<a name="l04981"></a>04981             }
<a name="l04982"></a>04982             <span class="keywordflow">return</span> t-&gt;<a class="code" href="../../d0/d5c/structtr.html#a42c2712138348286c7c146aea1783197">now</a>;
<a name="l04983"></a>04983         }
<a name="l04984"></a>04984         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (++t-&gt;<a class="code" href="../../d0/d5c/structtr.html#a42c2712138348286c7c146aea1783197">now</a> &lt; t-&gt;<a class="code" href="../../d0/d5c/structtr.html#aae084248e06a82cd9d9c9c3a9ddd1407">max</a>) {
<a name="l04985"></a>04985             <span class="keywordflow">return</span> t-&gt;<a class="code" href="../../d0/d5c/structtr.html#a42c2712138348286c7c146aea1783197">now</a>;
<a name="l04986"></a>04986         }
<a name="l04987"></a>04987         <span class="keywordflow">else</span> {
<a name="l04988"></a>04988             t-&gt;<a class="code" href="../../d0/d5c/structtr.html#a0bb10a22f9f4851875a27e54efdf15f6">gen</a> = 0;
<a name="l04989"></a>04989             <span class="keywordflow">return</span> t-&gt;<a class="code" href="../../d0/d5c/structtr.html#aae084248e06a82cd9d9c9c3a9ddd1407">max</a>;
<a name="l04990"></a>04990         }
<a name="l04991"></a>04991     }
<a name="l04992"></a>04992 }
<a name="l04993"></a>04993 
<a name="l04994"></a>04994 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <a class="code" href="../../d1/db0/string_8c.html#aed20ba79732169a36292557bddb335f5">rb_str_delete_bang</a>(<span class="keywordtype">int</span>,<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>*,<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>);
<a name="l04995"></a>04995 
<a name="l04996"></a>04996 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l04997"></a><a class="code" href="../../d1/db0/string_8c.html#a38b8eefe65ec38ea6172d21d2a641e2f">04997</a> <a class="code" href="../../d1/db0/string_8c.html#a38b8eefe65ec38ea6172d21d2a641e2f">tr_trans</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> src, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> repl, <span class="keywordtype">int</span> sflag)
<a name="l04998"></a>04998 {
<a name="l04999"></a>04999     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> errc = -1;
<a name="l05000"></a>05000     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../de/d8f/big5_8c.html#a11a04596d19e18c50f2d29ecbb86533c">trans</a>[256];
<a name="l05001"></a>05001     <a class="code" href="../../d1/d7b/struct_onig_encoding_type_s_t.html">rb_encoding</a> *enc, *e1, *e2;
<a name="l05002"></a>05002     <span class="keyword">struct </span><a class="code" href="../../d0/d5c/structtr.html">tr</a> trsrc, trrepl;
<a name="l05003"></a>05003     <span class="keywordtype">int</span> cflag = 0;
<a name="l05004"></a>05004     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> c, c0, <a class="code" href="../../d6/da0/nkf-utf8_2nkf_8c.html#ab0b853bc4e4e9658036bf7e604f398ad">last</a> = 0;
<a name="l05005"></a>05005     <span class="keywordtype">int</span> modify = 0, i, l;
<a name="l05006"></a>05006     <span class="keywordtype">char</span> *s, *send;
<a name="l05007"></a>05007     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <a class="code" href="../../d3/deb/lex_8c.html#a5541f85ce416df233cce93949f0eeeca">hash</a> = 0;
<a name="l05008"></a>05008     <span class="keywordtype">int</span> singlebyte = <a class="code" href="../../d1/db0/string_8c.html#a5ab3c8112c2ec6943bdae8a2036fca02">single_byte_optimizable</a>(str);
<a name="l05009"></a>05009     <span class="keywordtype">int</span> cr;
<a name="l05010"></a>05010 
<a name="l05011"></a>05011 <span class="preprocessor">#define CHECK_IF_ASCII(c) \</span>
<a name="l05012"></a>05012 <span class="preprocessor">    (void)((cr == ENC_CODERANGE_7BIT &amp;&amp; !rb_isascii(c)) ? \</span>
<a name="l05013"></a>05013 <span class="preprocessor">           (cr = ENC_CODERANGE_VALID) : 0)</span>
<a name="l05014"></a>05014 <span class="preprocessor"></span>
<a name="l05015"></a>05015     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a0e80f207eb41e9010ec9f0f5f9419fea">StringValue</a>(src);
<a name="l05016"></a>05016     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a0e80f207eb41e9010ec9f0f5f9419fea">StringValue</a>(repl);
<a name="l05017"></a>05017     <span class="keywordflow">if</span> (<a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(str) == 0 || !<a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(str)) <span class="keywordflow">return</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a320970f989dc8294c8203154e3db40c1">Qnil</a>;
<a name="l05018"></a>05018     <span class="keywordflow">if</span> (<a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(repl) == 0) {
<a name="l05019"></a>05019         <span class="keywordflow">return</span> <a class="code" href="../../d1/db0/string_8c.html#aed20ba79732169a36292557bddb335f5">rb_str_delete_bang</a>(1, &amp;src, str);
<a name="l05020"></a>05020     }
<a name="l05021"></a>05021 
<a name="l05022"></a>05022     cr = <a class="code" href="../../d5/de3/encoding_8h.html#a5901233f6f9004aebbdeccdd33cf449f">ENC_CODERANGE</a>(str);
<a name="l05023"></a>05023     e1 = <a class="code" href="../../d5/db5/encoding_8c.html#a7d17d602fae27de649f9310511c03db0">rb_enc_check</a>(str, src);
<a name="l05024"></a>05024     e2 = <a class="code" href="../../d5/db5/encoding_8c.html#a7d17d602fae27de649f9310511c03db0">rb_enc_check</a>(str, repl);
<a name="l05025"></a>05025     <span class="keywordflow">if</span> (e1 == e2) {
<a name="l05026"></a>05026         enc = e1;
<a name="l05027"></a>05027     }
<a name="l05028"></a>05028     <span class="keywordflow">else</span> {
<a name="l05029"></a>05029         enc = <a class="code" href="../../d5/db5/encoding_8c.html#a7d17d602fae27de649f9310511c03db0">rb_enc_check</a>(src, repl);
<a name="l05030"></a>05030     }
<a name="l05031"></a>05031     trsrc.<a class="code" href="../../d0/d5c/structtr.html#aef59b4ef766e46586916e3206f655bf3">p</a> = <a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(src); trsrc.<a class="code" href="../../d0/d5c/structtr.html#af81188c6fbc29c6ce46c3f81915e19e6">pend</a> = trsrc.<a class="code" href="../../d0/d5c/structtr.html#aef59b4ef766e46586916e3206f655bf3">p</a> + <a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(src);
<a name="l05032"></a>05032     <span class="keywordflow">if</span> (<a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(src) &gt; 1 &amp;&amp;
<a name="l05033"></a>05033         <a class="code" href="../../d5/db5/encoding_8c.html#af6663b51ce857cfe600a8bc48434d6f2">rb_enc_ascget</a>(trsrc.<a class="code" href="../../d0/d5c/structtr.html#aef59b4ef766e46586916e3206f655bf3">p</a>, trsrc.<a class="code" href="../../d0/d5c/structtr.html#af81188c6fbc29c6ce46c3f81915e19e6">pend</a>, &amp;l, enc) == <span class="charliteral">&apos;^&apos;</span> &amp;&amp;
<a name="l05034"></a>05034         trsrc.<a class="code" href="../../d0/d5c/structtr.html#aef59b4ef766e46586916e3206f655bf3">p</a> + l &lt; trsrc.<a class="code" href="../../d0/d5c/structtr.html#af81188c6fbc29c6ce46c3f81915e19e6">pend</a>) {
<a name="l05035"></a>05035         cflag = 1;
<a name="l05036"></a>05036         trsrc.<a class="code" href="../../d0/d5c/structtr.html#aef59b4ef766e46586916e3206f655bf3">p</a> += l;
<a name="l05037"></a>05037     }
<a name="l05038"></a>05038     trrepl.<a class="code" href="../../d0/d5c/structtr.html#aef59b4ef766e46586916e3206f655bf3">p</a> = <a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(repl);
<a name="l05039"></a>05039     trrepl.<a class="code" href="../../d0/d5c/structtr.html#af81188c6fbc29c6ce46c3f81915e19e6">pend</a> = trrepl.<a class="code" href="../../d0/d5c/structtr.html#aef59b4ef766e46586916e3206f655bf3">p</a> + <a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(repl);
<a name="l05040"></a>05040     trsrc.<a class="code" href="../../d0/d5c/structtr.html#a0bb10a22f9f4851875a27e54efdf15f6">gen</a> = trrepl.<a class="code" href="../../d0/d5c/structtr.html#a0bb10a22f9f4851875a27e54efdf15f6">gen</a> = 0;
<a name="l05041"></a>05041     trsrc.<a class="code" href="../../d0/d5c/structtr.html#a42c2712138348286c7c146aea1783197">now</a> = trrepl.<a class="code" href="../../d0/d5c/structtr.html#a42c2712138348286c7c146aea1783197">now</a> = 0;
<a name="l05042"></a>05042     trsrc.<a class="code" href="../../d0/d5c/structtr.html#aae084248e06a82cd9d9c9c3a9ddd1407">max</a> = trrepl.<a class="code" href="../../d0/d5c/structtr.html#aae084248e06a82cd9d9c9c3a9ddd1407">max</a> = 0;
<a name="l05043"></a>05043 
<a name="l05044"></a>05044     <span class="keywordflow">if</span> (cflag) {
<a name="l05045"></a>05045         <span class="keywordflow">for</span> (i=0; i&lt;256; i++) {
<a name="l05046"></a>05046             trans[i] = 1;
<a name="l05047"></a>05047         }
<a name="l05048"></a>05048         <span class="keywordflow">while</span> ((c = <a class="code" href="../../d1/db0/string_8c.html#aa3d62e8f55c5597988533054147832ee">trnext</a>(&amp;trsrc, enc)) != errc) {
<a name="l05049"></a>05049             <span class="keywordflow">if</span> (c &lt; 256) {
<a name="l05050"></a>05050                 trans[c] = errc;
<a name="l05051"></a>05051             }
<a name="l05052"></a>05052             <span class="keywordflow">else</span> {
<a name="l05053"></a>05053                 <span class="keywordflow">if</span> (!hash) hash = <a class="code" href="../../d1/d04/hash_8c.html#af1da586524a3a1739fd5b91272037815">rb_hash_new</a>();
<a name="l05054"></a>05054                 <a class="code" href="../../d1/d04/hash_8c.html#ac477edf136d86a33bc06d1fbea67bb9a">rb_hash_aset</a>(hash, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a6eb3054f7a740d26c133d34ae6afdf2c">UINT2NUM</a>(c), <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aacea3516b33941ce8149098e223a7466">Qtrue</a>);
<a name="l05055"></a>05055             }
<a name="l05056"></a>05056         }
<a name="l05057"></a>05057         <span class="keywordflow">while</span> ((c = <a class="code" href="../../d1/db0/string_8c.html#aa3d62e8f55c5597988533054147832ee">trnext</a>(&amp;trrepl, enc)) != errc)
<a name="l05058"></a>05058             <span class="comment">/* retrieve last replacer */</span>;
<a name="l05059"></a>05059         last = trrepl.<a class="code" href="../../d0/d5c/structtr.html#a42c2712138348286c7c146aea1783197">now</a>;
<a name="l05060"></a>05060         <span class="keywordflow">for</span> (i=0; i&lt;256; i++) {
<a name="l05061"></a>05061             <span class="keywordflow">if</span> (trans[i] != errc) {
<a name="l05062"></a>05062                 trans[i] = last;
<a name="l05063"></a>05063             }
<a name="l05064"></a>05064         }
<a name="l05065"></a>05065     }
<a name="l05066"></a>05066     <span class="keywordflow">else</span> {
<a name="l05067"></a>05067         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> r;
<a name="l05068"></a>05068 
<a name="l05069"></a>05069         <span class="keywordflow">for</span> (i=0; i&lt;256; i++) {
<a name="l05070"></a>05070             trans[i] = errc;
<a name="l05071"></a>05071         }
<a name="l05072"></a>05072         <span class="keywordflow">while</span> ((c = <a class="code" href="../../d1/db0/string_8c.html#aa3d62e8f55c5597988533054147832ee">trnext</a>(&amp;trsrc, enc)) != errc) {
<a name="l05073"></a>05073             r = <a class="code" href="../../d1/db0/string_8c.html#aa3d62e8f55c5597988533054147832ee">trnext</a>(&amp;trrepl, enc);
<a name="l05074"></a>05074             <span class="keywordflow">if</span> (r == errc) r = trrepl.<a class="code" href="../../d0/d5c/structtr.html#a42c2712138348286c7c146aea1783197">now</a>;
<a name="l05075"></a>05075             <span class="keywordflow">if</span> (c &lt; 256) {
<a name="l05076"></a>05076                 trans[c] = r;
<a name="l05077"></a>05077                 <span class="keywordflow">if</span> (<a class="code" href="../../d5/db5/encoding_8c.html#ae47c32c86d8d7d18127c9a1b2eb8c325">rb_enc_codelen</a>(r, enc) != 1) singlebyte = 0;
<a name="l05078"></a>05078             }
<a name="l05079"></a>05079             <span class="keywordflow">else</span> {
<a name="l05080"></a>05080                 <span class="keywordflow">if</span> (!hash) hash = <a class="code" href="../../d1/d04/hash_8c.html#af1da586524a3a1739fd5b91272037815">rb_hash_new</a>();
<a name="l05081"></a>05081                 <a class="code" href="../../d1/d04/hash_8c.html#ac477edf136d86a33bc06d1fbea67bb9a">rb_hash_aset</a>(hash, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a6eb3054f7a740d26c133d34ae6afdf2c">UINT2NUM</a>(c), <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a6eb3054f7a740d26c133d34ae6afdf2c">UINT2NUM</a>(r));
<a name="l05082"></a>05082             }
<a name="l05083"></a>05083         }
<a name="l05084"></a>05084     }
<a name="l05085"></a>05085 
<a name="l05086"></a>05086     <span class="keywordflow">if</span> (cr == <a class="code" href="../../d5/de3/encoding_8h.html#a0c81a12daaa1e57009d46b9d906957dc">ENC_CODERANGE_VALID</a>)
<a name="l05087"></a>05087         cr = <a class="code" href="../../d5/de3/encoding_8h.html#a0a0e73a2d98205044e1ad19432502c5b">ENC_CODERANGE_7BIT</a>;
<a name="l05088"></a>05088     <a class="code" href="../../d1/db0/string_8c.html#a106a1166130a12736cf57bacc164e4a5">str_modify_keep_cr</a>(str);
<a name="l05089"></a>05089     s = <a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(str); send = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a35bfa2635774977edad0a16b9fdebbaf">RSTRING_END</a>(str);
<a name="l05090"></a>05090     <span class="keywordflow">if</span> (sflag) {
<a name="l05091"></a>05091         <span class="keywordtype">int</span> clen, tlen;
<a name="l05092"></a>05092         <span class="keywordtype">long</span> offset, <a class="code" href="../../d1/d6f/date__strftime_8c.html#aa5d960354774dc177393b360c0f90aa9">max</a> = <a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(str);
<a name="l05093"></a>05093         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> save = -1;
<a name="l05094"></a>05094         <span class="keywordtype">char</span> *<a class="code" href="../../d6/da0/nkf-utf8_2nkf_8c.html#ac37f17a60c8b5533aac4840c681f62b8">buf</a> = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a79041aa2bc7439c11906a86f82a52eb6">ALLOC_N</a>(<span class="keywordtype">char</span>, max), *t = buf;
<a name="l05095"></a>05095 
<a name="l05096"></a>05096         <span class="keywordflow">while</span> (s &lt; send) {
<a name="l05097"></a>05097             <span class="keywordtype">int</span> may_modify = 0;
<a name="l05098"></a>05098 
<a name="l05099"></a>05099             c0 = c = <a class="code" href="../../d5/db5/encoding_8c.html#a25e1e0b74ee98f47dd26a44bb11b7b3c">rb_enc_codepoint_len</a>(s, send, &amp;clen, e1);
<a name="l05100"></a>05100             tlen = enc == e1 ? clen : <a class="code" href="../../d5/db5/encoding_8c.html#ae47c32c86d8d7d18127c9a1b2eb8c325">rb_enc_codelen</a>(c, enc);
<a name="l05101"></a>05101 
<a name="l05102"></a>05102             s += clen;
<a name="l05103"></a>05103             <span class="keywordflow">if</span> (c &lt; 256) {
<a name="l05104"></a>05104                 c = trans[c];
<a name="l05105"></a>05105             }
<a name="l05106"></a>05106             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (hash) {
<a name="l05107"></a>05107                 <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> tmp = <a class="code" href="../../d5/d9d/tcltklib_8c.html#aa6896905f9ab15ac1ea4ce9aec1df54b">rb_hash_lookup</a>(hash, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a6eb3054f7a740d26c133d34ae6afdf2c">UINT2NUM</a>(c));
<a name="l05108"></a>05108                 <span class="keywordflow">if</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a4832bad8845a35fc50f7a160901854a1">NIL_P</a>(tmp)) {
<a name="l05109"></a>05109                     <span class="keywordflow">if</span> (cflag) c = last;
<a name="l05110"></a>05110                     <span class="keywordflow">else</span> c = errc;
<a name="l05111"></a>05111                 }
<a name="l05112"></a>05112                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (cflag) c = errc;
<a name="l05113"></a>05113                 <span class="keywordflow">else</span> c = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a877c38180d23c5447d976c70dda89d69">NUM2INT</a>(tmp);
<a name="l05114"></a>05114             }
<a name="l05115"></a>05115             <span class="keywordflow">else</span> {
<a name="l05116"></a>05116                 c = errc;
<a name="l05117"></a>05117             }
<a name="l05118"></a>05118             <span class="keywordflow">if</span> (c != (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)-1) {
<a name="l05119"></a>05119                 <span class="keywordflow">if</span> (save == c) {
<a name="l05120"></a>05120                     <a class="code" href="../../d1/db0/string_8c.html#aa3b16affe2ad885fdd37993da1d855b6">CHECK_IF_ASCII</a>(c);
<a name="l05121"></a>05121                     <span class="keywordflow">continue</span>;
<a name="l05122"></a>05122                 }
<a name="l05123"></a>05123                 save = c;
<a name="l05124"></a>05124                 tlen = <a class="code" href="../../d5/db5/encoding_8c.html#ae47c32c86d8d7d18127c9a1b2eb8c325">rb_enc_codelen</a>(c, enc);
<a name="l05125"></a>05125                 modify = 1;
<a name="l05126"></a>05126             }
<a name="l05127"></a>05127             <span class="keywordflow">else</span> {
<a name="l05128"></a>05128                 save = -1;
<a name="l05129"></a>05129                 c = c0;
<a name="l05130"></a>05130                 <span class="keywordflow">if</span> (enc != e1) may_modify = 1;
<a name="l05131"></a>05131             }
<a name="l05132"></a>05132             <span class="keywordflow">while</span> (t - buf + tlen &gt;= max) {
<a name="l05133"></a>05133                 offset = t - buf;
<a name="l05134"></a>05134                 max *= 2;
<a name="l05135"></a>05135                 <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a5160cad2d7d090e4d2e8803f1ba5ee3c">REALLOC_N</a>(buf, <span class="keywordtype">char</span>, max);
<a name="l05136"></a>05136                 t = buf + offset;
<a name="l05137"></a>05137             }
<a name="l05138"></a>05138             <a class="code" href="../../d5/de3/encoding_8h.html#a243639504d867c0a638be91db2d19db1">rb_enc_mbcput</a>(c, t, enc);
<a name="l05139"></a>05139             <span class="keywordflow">if</span> (may_modify &amp;&amp; <a class="code" href="../../d5/d21/memcmp_8c.html#a1499ab2d0a3da86cbc3e688294f60a48">memcmp</a>(s, t, tlen) != 0) {
<a name="l05140"></a>05140                 modify = 1;
<a name="l05141"></a>05141             }
<a name="l05142"></a>05142             <a class="code" href="../../d1/db0/string_8c.html#aa3b16affe2ad885fdd37993da1d855b6">CHECK_IF_ASCII</a>(c);
<a name="l05143"></a>05143             t += tlen;
<a name="l05144"></a>05144         }
<a name="l05145"></a>05145         <span class="keywordflow">if</span> (!<a class="code" href="../../d1/db0/string_8c.html#a0823acc422a6a849b53cf3ae0465b543">STR_EMBED_P</a>(str)) {
<a name="l05146"></a>05146             <a class="code" href="../../d8/db0/defines_8h.html#a2c3897f7c46ca54a2e0dd7b24a40c7cb">xfree</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac695b0c61b18410ebcf22584fe0a6f6f">RSTRING</a>(str)-&gt;as.heap.ptr);
<a name="l05147"></a>05147         }
<a name="l05148"></a>05148         *t = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l05149"></a>05149         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac695b0c61b18410ebcf22584fe0a6f6f">RSTRING</a>(str)-&gt;as.heap.ptr = buf;
<a name="l05150"></a>05150         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac695b0c61b18410ebcf22584fe0a6f6f">RSTRING</a>(str)-&gt;as.heap.len = t - buf;
<a name="l05151"></a>05151         <a class="code" href="../../d1/db0/string_8c.html#a220a3ea405f8427a2b119e8cda01524e">STR_SET_NOEMBED</a>(str);
<a name="l05152"></a>05152         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac695b0c61b18410ebcf22584fe0a6f6f">RSTRING</a>(str)-&gt;as.heap.aux.capa = max;
<a name="l05153"></a>05153     }
<a name="l05154"></a>05154     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d5/de3/encoding_8h.html#a6b942f8457214c49fcf8541c60a38306">rb_enc_mbmaxlen</a>(enc) == 1 || (singlebyte &amp;&amp; !hash)) {
<a name="l05155"></a>05155         <span class="keywordflow">while</span> (s &lt; send) {
<a name="l05156"></a>05156             c = (<span class="keywordtype">unsigned</span> char)*s;
<a name="l05157"></a>05157             <span class="keywordflow">if</span> (trans[c] != errc) {
<a name="l05158"></a>05158                 <span class="keywordflow">if</span> (!cflag) {
<a name="l05159"></a>05159                     c = trans[c];
<a name="l05160"></a>05160                     *s = c;
<a name="l05161"></a>05161                     modify = 1;
<a name="l05162"></a>05162                 }
<a name="l05163"></a>05163                 <span class="keywordflow">else</span> {
<a name="l05164"></a>05164                     *s = last;
<a name="l05165"></a>05165                     modify = 1;
<a name="l05166"></a>05166                 }
<a name="l05167"></a>05167             }
<a name="l05168"></a>05168             <a class="code" href="../../d1/db0/string_8c.html#aa3b16affe2ad885fdd37993da1d855b6">CHECK_IF_ASCII</a>(c);
<a name="l05169"></a>05169             s++;
<a name="l05170"></a>05170         }
<a name="l05171"></a>05171     }
<a name="l05172"></a>05172     <span class="keywordflow">else</span> {
<a name="l05173"></a>05173         <span class="keywordtype">int</span> clen, tlen, <a class="code" href="../../d1/d6f/date__strftime_8c.html#aa5d960354774dc177393b360c0f90aa9">max</a> = (int)(<a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(str) * 1.2);
<a name="l05174"></a>05174         <span class="keywordtype">long</span> offset;
<a name="l05175"></a>05175         <span class="keywordtype">char</span> *<a class="code" href="../../d6/da0/nkf-utf8_2nkf_8c.html#ac37f17a60c8b5533aac4840c681f62b8">buf</a> = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a79041aa2bc7439c11906a86f82a52eb6">ALLOC_N</a>(<span class="keywordtype">char</span>, max), *t = buf;
<a name="l05176"></a>05176 
<a name="l05177"></a>05177         <span class="keywordflow">while</span> (s &lt; send) {
<a name="l05178"></a>05178             <span class="keywordtype">int</span> may_modify = 0;
<a name="l05179"></a>05179             c0 = c = <a class="code" href="../../d5/db5/encoding_8c.html#a25e1e0b74ee98f47dd26a44bb11b7b3c">rb_enc_codepoint_len</a>(s, send, &amp;clen, e1);
<a name="l05180"></a>05180             tlen = enc == e1 ? clen : <a class="code" href="../../d5/db5/encoding_8c.html#ae47c32c86d8d7d18127c9a1b2eb8c325">rb_enc_codelen</a>(c, enc);
<a name="l05181"></a>05181 
<a name="l05182"></a>05182             <span class="keywordflow">if</span> (c &lt; 256) {
<a name="l05183"></a>05183                 c = trans[c];
<a name="l05184"></a>05184             }
<a name="l05185"></a>05185             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (hash) {
<a name="l05186"></a>05186                 <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> tmp = <a class="code" href="../../d5/d9d/tcltklib_8c.html#aa6896905f9ab15ac1ea4ce9aec1df54b">rb_hash_lookup</a>(hash, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a6eb3054f7a740d26c133d34ae6afdf2c">UINT2NUM</a>(c));
<a name="l05187"></a>05187                 <span class="keywordflow">if</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a4832bad8845a35fc50f7a160901854a1">NIL_P</a>(tmp)) {
<a name="l05188"></a>05188                     <span class="keywordflow">if</span> (cflag) c = last;
<a name="l05189"></a>05189                     <span class="keywordflow">else</span> c = errc;
<a name="l05190"></a>05190                 }
<a name="l05191"></a>05191                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (cflag) c = errc;
<a name="l05192"></a>05192                 <span class="keywordflow">else</span> c = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a877c38180d23c5447d976c70dda89d69">NUM2INT</a>(tmp);
<a name="l05193"></a>05193             }
<a name="l05194"></a>05194             <span class="keywordflow">else</span> {
<a name="l05195"></a>05195                 c = cflag ? last : errc;
<a name="l05196"></a>05196             }
<a name="l05197"></a>05197             <span class="keywordflow">if</span> (c != errc) {
<a name="l05198"></a>05198                 tlen = <a class="code" href="../../d5/db5/encoding_8c.html#ae47c32c86d8d7d18127c9a1b2eb8c325">rb_enc_codelen</a>(c, enc);
<a name="l05199"></a>05199                 modify = 1;
<a name="l05200"></a>05200             }
<a name="l05201"></a>05201             <span class="keywordflow">else</span> {
<a name="l05202"></a>05202                 c = c0;
<a name="l05203"></a>05203                 <span class="keywordflow">if</span> (enc != e1) may_modify = 1;
<a name="l05204"></a>05204             }
<a name="l05205"></a>05205             <span class="keywordflow">while</span> (t - buf + tlen &gt;= max) {
<a name="l05206"></a>05206                 offset = t - buf;
<a name="l05207"></a>05207                 max *= 2;
<a name="l05208"></a>05208                 <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a5160cad2d7d090e4d2e8803f1ba5ee3c">REALLOC_N</a>(buf, <span class="keywordtype">char</span>, max);
<a name="l05209"></a>05209                 t = buf + offset;
<a name="l05210"></a>05210             }
<a name="l05211"></a>05211             <span class="keywordflow">if</span> (s != t) {
<a name="l05212"></a>05212                 <a class="code" href="../../d5/de3/encoding_8h.html#a243639504d867c0a638be91db2d19db1">rb_enc_mbcput</a>(c, t, enc);
<a name="l05213"></a>05213                 <span class="keywordflow">if</span> (may_modify &amp;&amp; <a class="code" href="../../d5/d21/memcmp_8c.html#a1499ab2d0a3da86cbc3e688294f60a48">memcmp</a>(s, t, tlen) != 0) {
<a name="l05214"></a>05214                     modify = 1;
<a name="l05215"></a>05215                 }
<a name="l05216"></a>05216             }
<a name="l05217"></a>05217             <a class="code" href="../../d1/db0/string_8c.html#aa3b16affe2ad885fdd37993da1d855b6">CHECK_IF_ASCII</a>(c);
<a name="l05218"></a>05218             s += clen;
<a name="l05219"></a>05219             t += tlen;
<a name="l05220"></a>05220         }
<a name="l05221"></a>05221         <span class="keywordflow">if</span> (!<a class="code" href="../../d1/db0/string_8c.html#a0823acc422a6a849b53cf3ae0465b543">STR_EMBED_P</a>(str)) {
<a name="l05222"></a>05222             <a class="code" href="../../d8/db0/defines_8h.html#a2c3897f7c46ca54a2e0dd7b24a40c7cb">xfree</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac695b0c61b18410ebcf22584fe0a6f6f">RSTRING</a>(str)-&gt;as.heap.ptr);
<a name="l05223"></a>05223         }
<a name="l05224"></a>05224         *t = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l05225"></a>05225         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac695b0c61b18410ebcf22584fe0a6f6f">RSTRING</a>(str)-&gt;as.heap.ptr = buf;
<a name="l05226"></a>05226         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac695b0c61b18410ebcf22584fe0a6f6f">RSTRING</a>(str)-&gt;as.heap.len = t - buf;
<a name="l05227"></a>05227         <a class="code" href="../../d1/db0/string_8c.html#a220a3ea405f8427a2b119e8cda01524e">STR_SET_NOEMBED</a>(str);
<a name="l05228"></a>05228         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac695b0c61b18410ebcf22584fe0a6f6f">RSTRING</a>(str)-&gt;as.heap.aux.capa = max;
<a name="l05229"></a>05229     }
<a name="l05230"></a>05230 
<a name="l05231"></a>05231     <span class="keywordflow">if</span> (modify) {
<a name="l05232"></a>05232         <span class="keywordflow">if</span> (cr != <a class="code" href="../../d5/de3/encoding_8h.html#abb86fbc02fc2b78d928825ea6d6922f9">ENC_CODERANGE_BROKEN</a>)
<a name="l05233"></a>05233             <a class="code" href="../../d5/de3/encoding_8h.html#aefe5772c0116cf7131a5227de7243dbc">ENC_CODERANGE_SET</a>(str, cr);
<a name="l05234"></a>05234         <a class="code" href="../../d5/db5/encoding_8c.html#a150a6e3ac22ac3be8f8c2ccc74a28e7b">rb_enc_associate</a>(str, enc);
<a name="l05235"></a>05235         <span class="keywordflow">return</span> str;
<a name="l05236"></a>05236     }
<a name="l05237"></a>05237     <span class="keywordflow">return</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a320970f989dc8294c8203154e3db40c1">Qnil</a>;
<a name="l05238"></a>05238 }
<a name="l05239"></a>05239 
<a name="l05240"></a>05240 
<a name="l05241"></a>05241 <span class="comment">/*</span>
<a name="l05242"></a>05242 <span class="comment"> *  call-seq:</span>
<a name="l05243"></a>05243 <span class="comment"> *     str.tr!(from_str, to_str)   -&gt; str or nil</span>
<a name="l05244"></a>05244 <span class="comment"> *</span>
<a name="l05245"></a>05245 <span class="comment"> *  Translates &lt;i&gt;str&lt;/i&gt; in place, using the same rules as</span>
<a name="l05246"></a>05246 <span class="comment"> *  &lt;code&gt;String#tr&lt;/code&gt;. Returns &lt;i&gt;str&lt;/i&gt;, or &lt;code&gt;nil&lt;/code&gt; if no</span>
<a name="l05247"></a>05247 <span class="comment"> *  changes were made.</span>
<a name="l05248"></a>05248 <span class="comment"> */</span>
<a name="l05249"></a>05249 
<a name="l05250"></a>05250 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l05251"></a><a class="code" href="../../d1/db0/string_8c.html#a69086844bb46807638ddf451827bbe0d">05251</a> <a class="code" href="../../d1/db0/string_8c.html#a69086844bb46807638ddf451827bbe0d">rb_str_tr_bang</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> src, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> repl)
<a name="l05252"></a>05252 {
<a name="l05253"></a>05253     <span class="keywordflow">return</span> <a class="code" href="../../d1/db0/string_8c.html#a38b8eefe65ec38ea6172d21d2a641e2f">tr_trans</a>(str, src, repl, 0);
<a name="l05254"></a>05254 }
<a name="l05255"></a>05255 
<a name="l05256"></a>05256 
<a name="l05257"></a>05257 <span class="comment">/*</span>
<a name="l05258"></a>05258 <span class="comment"> *  call-seq:</span>
<a name="l05259"></a>05259 <span class="comment"> *     str.tr(from_str, to_str)   =&gt; new_str</span>
<a name="l05260"></a>05260 <span class="comment"> *</span>
<a name="l05261"></a>05261 <span class="comment"> *  Returns a copy of &lt;i&gt;str&lt;/i&gt; with the characters in &lt;i&gt;from_str&lt;/i&gt;</span>
<a name="l05262"></a>05262 <span class="comment"> *  replaced by the corresponding characters in &lt;i&gt;to_str&lt;/i&gt;. If</span>
<a name="l05263"></a>05263 <span class="comment"> *  &lt;i&gt;to_str&lt;/i&gt; is shorter than &lt;i&gt;from_str&lt;/i&gt;, it is padded with its last</span>
<a name="l05264"></a>05264 <span class="comment"> *  character in order to maintain the correspondence.</span>
<a name="l05265"></a>05265 <span class="comment"> *</span>
<a name="l05266"></a>05266 <span class="comment"> *     &quot;hello&quot;.tr(&apos;el&apos;, &apos;ip&apos;)      #=&gt; &quot;hippo&quot;</span>
<a name="l05267"></a>05267 <span class="comment"> *     &quot;hello&quot;.tr(&apos;aeiou&apos;, &apos;*&apos;)    #=&gt; &quot;h*ll*&quot;</span>
<a name="l05268"></a>05268 <span class="comment"> *</span>
<a name="l05269"></a>05269 <span class="comment"> *  Both strings may use the c1-c2 notation to denote ranges of characters,</span>
<a name="l05270"></a>05270 <span class="comment"> *  and &lt;i&gt;from_str&lt;/i&gt; may start with a &lt;code&gt;^&lt;/code&gt;, which denotes all</span>
<a name="l05271"></a>05271 <span class="comment"> *  characters except those listed.</span>
<a name="l05272"></a>05272 <span class="comment"> *</span>
<a name="l05273"></a>05273 <span class="comment"> *     &quot;hello&quot;.tr(&apos;a-y&apos;, &apos;b-z&apos;)    #=&gt; &quot;ifmmp&quot;</span>
<a name="l05274"></a>05274 <span class="comment"> *     &quot;hello&quot;.tr(&apos;^aeiou&apos;, &apos;*&apos;)   #=&gt; &quot;*e**o&quot;</span>
<a name="l05275"></a>05275 <span class="comment"> */</span>
<a name="l05276"></a>05276 
<a name="l05277"></a>05277 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l05278"></a><a class="code" href="../../d1/db0/string_8c.html#a1e035aa384a422037d6d0ad85704e413">05278</a> <a class="code" href="../../d1/db0/string_8c.html#a1e035aa384a422037d6d0ad85704e413">rb_str_tr</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> src, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> repl)
<a name="l05279"></a>05279 {
<a name="l05280"></a>05280     str = <a class="code" href="../../db/d2e/intern_8h.html#ae2843c766c24b80116bb127ebf22d5bf">rb_str_dup</a>(str);
<a name="l05281"></a>05281     <a class="code" href="../../d1/db0/string_8c.html#a38b8eefe65ec38ea6172d21d2a641e2f">tr_trans</a>(str, src, repl, 0);
<a name="l05282"></a>05282     <span class="keywordflow">return</span> str;
<a name="l05283"></a>05283 }
<a name="l05284"></a>05284 
<a name="l05285"></a><a class="code" href="../../d1/db0/string_8c.html#a1aed439b6d96085fbace0329113536c0">05285</a> <span class="preprocessor">#define TR_TABLE_SIZE 257</span>
<a name="l05286"></a>05286 <span class="preprocessor"></span><span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l05287"></a><a class="code" href="../../d1/db0/string_8c.html#adc8eed0834f0f63a2e8a9cfe7517df20">05287</a> <a class="code" href="../../d1/db0/string_8c.html#adc8eed0834f0f63a2e8a9cfe7517df20">tr_setup_table</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str, <span class="keywordtype">char</span> stable[<a class="code" href="../../d1/db0/string_8c.html#a1aed439b6d96085fbace0329113536c0">TR_TABLE_SIZE</a>], <span class="keywordtype">int</span> first,
<a name="l05288"></a>05288                <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> *tablep, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> *ctablep, <a class="code" href="../../d1/d7b/struct_onig_encoding_type_s_t.html">rb_encoding</a> *enc)
<a name="l05289"></a>05289 {
<a name="l05290"></a>05290     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> errc = -1;
<a name="l05291"></a>05291     <span class="keywordtype">char</span> <a class="code" href="../../d6/da0/nkf-utf8_2nkf_8c.html#ac37f17a60c8b5533aac4840c681f62b8">buf</a>[256];
<a name="l05292"></a>05292     <span class="keyword">struct </span><a class="code" href="../../d0/d5c/structtr.html">tr</a> tr;
<a name="l05293"></a>05293     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> c;
<a name="l05294"></a>05294     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> table = 0, ptable = 0;
<a name="l05295"></a>05295     <span class="keywordtype">int</span> i, l, cflag = 0;
<a name="l05296"></a>05296 
<a name="l05297"></a>05297     tr.<a class="code" href="../../d0/d5c/structtr.html#aef59b4ef766e46586916e3206f655bf3">p</a> = <a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(str); tr.<a class="code" href="../../d0/d5c/structtr.html#af81188c6fbc29c6ce46c3f81915e19e6">pend</a> = tr.<a class="code" href="../../d0/d5c/structtr.html#aef59b4ef766e46586916e3206f655bf3">p</a> + <a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(str);
<a name="l05298"></a>05298     tr.<a class="code" href="../../d0/d5c/structtr.html#a0bb10a22f9f4851875a27e54efdf15f6">gen</a> = tr.<a class="code" href="../../d0/d5c/structtr.html#a42c2712138348286c7c146aea1783197">now</a> = tr.<a class="code" href="../../d0/d5c/structtr.html#aae084248e06a82cd9d9c9c3a9ddd1407">max</a> = 0;
<a name="l05299"></a>05299 
<a name="l05300"></a>05300     <span class="keywordflow">if</span> (<a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(str) &gt; 1 &amp;&amp; <a class="code" href="../../d5/db5/encoding_8c.html#af6663b51ce857cfe600a8bc48434d6f2">rb_enc_ascget</a>(tr.<a class="code" href="../../d0/d5c/structtr.html#aef59b4ef766e46586916e3206f655bf3">p</a>, tr.<a class="code" href="../../d0/d5c/structtr.html#af81188c6fbc29c6ce46c3f81915e19e6">pend</a>, &amp;l, enc) == <span class="charliteral">&apos;^&apos;</span>) {
<a name="l05301"></a>05301         cflag = 1;
<a name="l05302"></a>05302         tr.<a class="code" href="../../d0/d5c/structtr.html#aef59b4ef766e46586916e3206f655bf3">p</a> += l;
<a name="l05303"></a>05303     }
<a name="l05304"></a>05304     <span class="keywordflow">if</span> (first) {
<a name="l05305"></a>05305         <span class="keywordflow">for</span> (i=0; i&lt;256; i++) {
<a name="l05306"></a>05306             stable[i] = 1;
<a name="l05307"></a>05307         }
<a name="l05308"></a>05308         stable[256] = cflag;
<a name="l05309"></a>05309     }
<a name="l05310"></a>05310     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (stable[256] &amp;&amp; !cflag) {
<a name="l05311"></a>05311         stable[256] = 0;
<a name="l05312"></a>05312     }
<a name="l05313"></a>05313     <span class="keywordflow">for</span> (i=0; i&lt;256; i++) {
<a name="l05314"></a>05314         buf[i] = cflag;
<a name="l05315"></a>05315     }
<a name="l05316"></a>05316 
<a name="l05317"></a>05317     <span class="keywordflow">while</span> ((c = <a class="code" href="../../d1/db0/string_8c.html#aa3d62e8f55c5597988533054147832ee">trnext</a>(&amp;tr, enc)) != errc) {
<a name="l05318"></a>05318         <span class="keywordflow">if</span> (c &lt; 256) {
<a name="l05319"></a>05319             buf[c &amp; 0xff] = !cflag;
<a name="l05320"></a>05320         }
<a name="l05321"></a>05321         <span class="keywordflow">else</span> {
<a name="l05322"></a>05322             <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <a class="code" href="../../dc/de5/random_8c.html#a742229490b6759a90ece7ba82ba129d5">key</a> = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a6eb3054f7a740d26c133d34ae6afdf2c">UINT2NUM</a>(c);
<a name="l05323"></a>05323 
<a name="l05324"></a>05324             <span class="keywordflow">if</span> (!table) {
<a name="l05325"></a>05325                 table = <a class="code" href="../../d1/d04/hash_8c.html#af1da586524a3a1739fd5b91272037815">rb_hash_new</a>();
<a name="l05326"></a>05326                 <span class="keywordflow">if</span> (cflag) {
<a name="l05327"></a>05327                     ptable = *ctablep;
<a name="l05328"></a>05328                     *ctablep = table;
<a name="l05329"></a>05329                 }
<a name="l05330"></a>05330                 <span class="keywordflow">else</span> {
<a name="l05331"></a>05331                     ptable = *tablep;
<a name="l05332"></a>05332                     *tablep = table;
<a name="l05333"></a>05333                 }
<a name="l05334"></a>05334             }
<a name="l05335"></a>05335             <span class="keywordflow">if</span> (!ptable || !<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a4832bad8845a35fc50f7a160901854a1">NIL_P</a>(<a class="code" href="../../d1/d04/hash_8c.html#ab7063832c7ed02351e87922a78e35c32">rb_hash_aref</a>(ptable, key))) {
<a name="l05336"></a>05336                 <a class="code" href="../../d1/d04/hash_8c.html#ac477edf136d86a33bc06d1fbea67bb9a">rb_hash_aset</a>(table, key, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aacea3516b33941ce8149098e223a7466">Qtrue</a>);
<a name="l05337"></a>05337             }
<a name="l05338"></a>05338         }
<a name="l05339"></a>05339     }
<a name="l05340"></a>05340     <span class="keywordflow">for</span> (i=0; i&lt;256; i++) {
<a name="l05341"></a>05341         stable[i] = stable[i] &amp;&amp; buf[i];
<a name="l05342"></a>05342     }
<a name="l05343"></a>05343 }
<a name="l05344"></a>05344 
<a name="l05345"></a>05345 
<a name="l05346"></a>05346 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l05347"></a><a class="code" href="../../d1/db0/string_8c.html#adc72507a607b076ed99abade51e3184e">05347</a> <a class="code" href="../../d1/db0/string_8c.html#adc72507a607b076ed99abade51e3184e">tr_find</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> c, <span class="keywordtype">char</span> table[<a class="code" href="../../d1/db0/string_8c.html#a1aed439b6d96085fbace0329113536c0">TR_TABLE_SIZE</a>], <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> del, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> nodel)
<a name="l05348"></a>05348 {
<a name="l05349"></a>05349     <span class="keywordflow">if</span> (c &lt; 256) {
<a name="l05350"></a>05350         <span class="keywordflow">return</span> table[c] != 0;
<a name="l05351"></a>05351     }
<a name="l05352"></a>05352     <span class="keywordflow">else</span> {
<a name="l05353"></a>05353         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> v = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a6eb3054f7a740d26c133d34ae6afdf2c">UINT2NUM</a>(c);
<a name="l05354"></a>05354 
<a name="l05355"></a>05355         <span class="keywordflow">if</span> (del) {
<a name="l05356"></a>05356             <span class="keywordflow">if</span> (!<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a4832bad8845a35fc50f7a160901854a1">NIL_P</a>(<a class="code" href="../../d5/d9d/tcltklib_8c.html#aa6896905f9ab15ac1ea4ce9aec1df54b">rb_hash_lookup</a>(del, v)) &amp;&amp;
<a name="l05357"></a>05357                     (!nodel || <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a4832bad8845a35fc50f7a160901854a1">NIL_P</a>(<a class="code" href="../../d5/d9d/tcltklib_8c.html#aa6896905f9ab15ac1ea4ce9aec1df54b">rb_hash_lookup</a>(nodel, v)))) {
<a name="l05358"></a>05358                 <span class="keywordflow">return</span> <a class="code" href="../../d1/d5c/nkf_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l05359"></a>05359             }
<a name="l05360"></a>05360         }
<a name="l05361"></a>05361         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (nodel &amp;&amp; !<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a4832bad8845a35fc50f7a160901854a1">NIL_P</a>(<a class="code" href="../../d5/d9d/tcltklib_8c.html#aa6896905f9ab15ac1ea4ce9aec1df54b">rb_hash_lookup</a>(nodel, v))) {
<a name="l05362"></a>05362             <span class="keywordflow">return</span> <a class="code" href="../../d1/d5c/nkf_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l05363"></a>05363         }
<a name="l05364"></a>05364         <span class="keywordflow">return</span> table[256] ? <a class="code" href="../../d1/d5c/nkf_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a> : <a class="code" href="../../d1/d5c/nkf_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l05365"></a>05365     }
<a name="l05366"></a>05366 }
<a name="l05367"></a>05367 
<a name="l05368"></a>05368 <span class="comment">/*</span>
<a name="l05369"></a>05369 <span class="comment"> *  call-seq:</span>
<a name="l05370"></a>05370 <span class="comment"> *     str.delete!([other_str]+)   -&gt; str or nil</span>
<a name="l05371"></a>05371 <span class="comment"> *</span>
<a name="l05372"></a>05372 <span class="comment"> *  Performs a &lt;code&gt;delete&lt;/code&gt; operation in place, returning &lt;i&gt;str&lt;/i&gt;, or</span>
<a name="l05373"></a>05373 <span class="comment"> *  &lt;code&gt;nil&lt;/code&gt; if &lt;i&gt;str&lt;/i&gt; was not modified.</span>
<a name="l05374"></a>05374 <span class="comment"> */</span>
<a name="l05375"></a>05375 
<a name="l05376"></a>05376 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l05377"></a><a class="code" href="../../d1/db0/string_8c.html#aed20ba79732169a36292557bddb335f5">05377</a> <a class="code" href="../../d1/db0/string_8c.html#aed20ba79732169a36292557bddb335f5">rb_str_delete_bang</a>(<span class="keywordtype">int</span> <a class="code" href="../../df/d77/ruby_8c.html#ad1447518f4372828b8435ae82e48499e">argc</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> *<a class="code" href="../../df/d77/ruby_8c.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str)
<a name="l05378"></a>05378 {
<a name="l05379"></a>05379     <span class="keywordtype">char</span> squeez[<a class="code" href="../../d1/db0/string_8c.html#a1aed439b6d96085fbace0329113536c0">TR_TABLE_SIZE</a>];
<a name="l05380"></a>05380     <a class="code" href="../../d1/d7b/struct_onig_encoding_type_s_t.html">rb_encoding</a> *enc = 0;
<a name="l05381"></a>05381     <span class="keywordtype">char</span> *s, *send, *t;
<a name="l05382"></a>05382     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> del = 0, nodel = 0;
<a name="l05383"></a>05383     <span class="keywordtype">int</span> modify = 0;
<a name="l05384"></a>05384     <span class="keywordtype">int</span> i, ascompat, cr;
<a name="l05385"></a>05385 
<a name="l05386"></a>05386     <span class="keywordflow">if</span> (<a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(str) == 0 || !<a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(str)) <span class="keywordflow">return</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a320970f989dc8294c8203154e3db40c1">Qnil</a>;
<a name="l05387"></a>05387     <span class="keywordflow">if</span> (argc &lt; 1) {
<a name="l05388"></a>05388         <a class="code" href="../../db/dcc/error_8c.html#a0f771a2840561f1838169b3d7d4616f3">rb_raise</a>(<a class="code" href="../../db/dcc/error_8c.html#ab5e2a9fec766c75176fbb262bfe6a596">rb_eArgError</a>, <span class="stringliteral">&quot;wrong number of arguments (at least 1)&quot;</span>);
<a name="l05389"></a>05389     }
<a name="l05390"></a>05390     <span class="keywordflow">for</span> (i=0; i&lt;argc; i++) {
<a name="l05391"></a>05391         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> s = argv[i];
<a name="l05392"></a>05392 
<a name="l05393"></a>05393         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a0e80f207eb41e9010ec9f0f5f9419fea">StringValue</a>(s);
<a name="l05394"></a>05394         enc = <a class="code" href="../../d5/db5/encoding_8c.html#a7d17d602fae27de649f9310511c03db0">rb_enc_check</a>(str, s);
<a name="l05395"></a>05395         <a class="code" href="../../d1/db0/string_8c.html#adc8eed0834f0f63a2e8a9cfe7517df20">tr_setup_table</a>(s, squeez, i==0, &amp;del, &amp;nodel, enc);
<a name="l05396"></a>05396     }
<a name="l05397"></a>05397 
<a name="l05398"></a>05398     <a class="code" href="../../d1/db0/string_8c.html#a106a1166130a12736cf57bacc164e4a5">str_modify_keep_cr</a>(str);
<a name="l05399"></a>05399     ascompat = <a class="code" href="../../d5/de3/encoding_8h.html#a8b18a09a3055d3006c6d5baeaa6e7c72">rb_enc_asciicompat</a>(enc);
<a name="l05400"></a>05400     s = t = <a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(str);
<a name="l05401"></a>05401     send = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a35bfa2635774977edad0a16b9fdebbaf">RSTRING_END</a>(str);
<a name="l05402"></a>05402     cr = ascompat ? <a class="code" href="../../d5/de3/encoding_8h.html#a0a0e73a2d98205044e1ad19432502c5b">ENC_CODERANGE_7BIT</a> : <a class="code" href="../../d5/de3/encoding_8h.html#a0c81a12daaa1e57009d46b9d906957dc">ENC_CODERANGE_VALID</a>;
<a name="l05403"></a>05403     <span class="keywordflow">while</span> (s &lt; send) {
<a name="l05404"></a>05404         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> c;
<a name="l05405"></a>05405         <span class="keywordtype">int</span> clen;
<a name="l05406"></a>05406 
<a name="l05407"></a>05407         <span class="keywordflow">if</span> (ascompat &amp;&amp; (c = *(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*)s) &lt; 0x80) {
<a name="l05408"></a>05408             <span class="keywordflow">if</span> (squeez[c]) {
<a name="l05409"></a>05409                 modify = 1;
<a name="l05410"></a>05410             }
<a name="l05411"></a>05411             <span class="keywordflow">else</span> {
<a name="l05412"></a>05412                 <span class="keywordflow">if</span> (t != s) *t = c;
<a name="l05413"></a>05413                 t++;
<a name="l05414"></a>05414             }
<a name="l05415"></a>05415             s++;
<a name="l05416"></a>05416         }
<a name="l05417"></a>05417         <span class="keywordflow">else</span> {
<a name="l05418"></a>05418             c = <a class="code" href="../../d5/db5/encoding_8c.html#a25e1e0b74ee98f47dd26a44bb11b7b3c">rb_enc_codepoint_len</a>(s, send, &amp;clen, enc);
<a name="l05419"></a>05419 
<a name="l05420"></a>05420             <span class="keywordflow">if</span> (<a class="code" href="../../d1/db0/string_8c.html#adc72507a607b076ed99abade51e3184e">tr_find</a>(c, squeez, del, nodel)) {
<a name="l05421"></a>05421                 modify = 1;
<a name="l05422"></a>05422             }
<a name="l05423"></a>05423             <span class="keywordflow">else</span> {
<a name="l05424"></a>05424                 <span class="keywordflow">if</span> (t != s) <a class="code" href="../../d5/de3/encoding_8h.html#a243639504d867c0a638be91db2d19db1">rb_enc_mbcput</a>(c, t, enc);
<a name="l05425"></a>05425                 t += clen;
<a name="l05426"></a>05426                 <span class="keywordflow">if</span> (cr == <a class="code" href="../../d5/de3/encoding_8h.html#a0a0e73a2d98205044e1ad19432502c5b">ENC_CODERANGE_7BIT</a>) cr = <a class="code" href="../../d5/de3/encoding_8h.html#a0c81a12daaa1e57009d46b9d906957dc">ENC_CODERANGE_VALID</a>;
<a name="l05427"></a>05427             }
<a name="l05428"></a>05428             s += clen;
<a name="l05429"></a>05429         }
<a name="l05430"></a>05430     }
<a name="l05431"></a>05431     *t = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l05432"></a>05432     <a class="code" href="../../d1/db0/string_8c.html#a056c7c0a74c83ccdb5a160bbdcbf8c3b">STR_SET_LEN</a>(str, t - <a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(str));
<a name="l05433"></a>05433     <a class="code" href="../../d5/de3/encoding_8h.html#aefe5772c0116cf7131a5227de7243dbc">ENC_CODERANGE_SET</a>(str, cr);
<a name="l05434"></a>05434 
<a name="l05435"></a>05435     <span class="keywordflow">if</span> (modify) <span class="keywordflow">return</span> str;
<a name="l05436"></a>05436     <span class="keywordflow">return</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a320970f989dc8294c8203154e3db40c1">Qnil</a>;
<a name="l05437"></a>05437 }
<a name="l05438"></a>05438 
<a name="l05439"></a>05439 
<a name="l05440"></a>05440 <span class="comment">/*</span>
<a name="l05441"></a>05441 <span class="comment"> *  call-seq:</span>
<a name="l05442"></a>05442 <span class="comment"> *     str.delete([other_str]+)   -&gt; new_str</span>
<a name="l05443"></a>05443 <span class="comment"> *</span>
<a name="l05444"></a>05444 <span class="comment"> *  Returns a copy of &lt;i&gt;str&lt;/i&gt; with all characters in the intersection of its</span>
<a name="l05445"></a>05445 <span class="comment"> *  arguments deleted. Uses the same rules for building the set of characters as</span>
<a name="l05446"></a>05446 <span class="comment"> *  &lt;code&gt;String#count&lt;/code&gt;.</span>
<a name="l05447"></a>05447 <span class="comment"> *</span>
<a name="l05448"></a>05448 <span class="comment"> *     &quot;hello&quot;.delete &quot;l&quot;,&quot;lo&quot;        #=&gt; &quot;heo&quot;</span>
<a name="l05449"></a>05449 <span class="comment"> *     &quot;hello&quot;.delete &quot;lo&quot;            #=&gt; &quot;he&quot;</span>
<a name="l05450"></a>05450 <span class="comment"> *     &quot;hello&quot;.delete &quot;aeiou&quot;, &quot;^e&quot;   #=&gt; &quot;hell&quot;</span>
<a name="l05451"></a>05451 <span class="comment"> *     &quot;hello&quot;.delete &quot;ej-m&quot;          #=&gt; &quot;ho&quot;</span>
<a name="l05452"></a>05452 <span class="comment"> */</span>
<a name="l05453"></a>05453 
<a name="l05454"></a>05454 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l05455"></a><a class="code" href="../../d1/db0/string_8c.html#aac5b90aeedd723cef3f7a86a0d733238">05455</a> <a class="code" href="../../d1/db0/string_8c.html#aac5b90aeedd723cef3f7a86a0d733238">rb_str_delete</a>(<span class="keywordtype">int</span> <a class="code" href="../../df/d77/ruby_8c.html#ad1447518f4372828b8435ae82e48499e">argc</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> *<a class="code" href="../../df/d77/ruby_8c.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str)
<a name="l05456"></a>05456 {
<a name="l05457"></a>05457     str = <a class="code" href="../../db/d2e/intern_8h.html#ae2843c766c24b80116bb127ebf22d5bf">rb_str_dup</a>(str);
<a name="l05458"></a>05458     <a class="code" href="../../d1/db0/string_8c.html#aed20ba79732169a36292557bddb335f5">rb_str_delete_bang</a>(argc, argv, str);
<a name="l05459"></a>05459     <span class="keywordflow">return</span> str;
<a name="l05460"></a>05460 }
<a name="l05461"></a>05461 
<a name="l05462"></a>05462 
<a name="l05463"></a>05463 <span class="comment">/*</span>
<a name="l05464"></a>05464 <span class="comment"> *  call-seq:</span>
<a name="l05465"></a>05465 <span class="comment"> *     str.squeeze!([other_str]*)   -&gt; str or nil</span>
<a name="l05466"></a>05466 <span class="comment"> *</span>
<a name="l05467"></a>05467 <span class="comment"> *  Squeezes &lt;i&gt;str&lt;/i&gt; in place, returning either &lt;i&gt;str&lt;/i&gt;, or</span>
<a name="l05468"></a>05468 <span class="comment"> *  &lt;code&gt;nil&lt;/code&gt; if no changes were made.</span>
<a name="l05469"></a>05469 <span class="comment"> */</span>
<a name="l05470"></a>05470 
<a name="l05471"></a>05471 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l05472"></a><a class="code" href="../../d1/db0/string_8c.html#a7c54529ef3c752ebf58c5c48fc545348">05472</a> <a class="code" href="../../d1/db0/string_8c.html#a7c54529ef3c752ebf58c5c48fc545348">rb_str_squeeze_bang</a>(<span class="keywordtype">int</span> <a class="code" href="../../df/d77/ruby_8c.html#ad1447518f4372828b8435ae82e48499e">argc</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> *<a class="code" href="../../df/d77/ruby_8c.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str)
<a name="l05473"></a>05473 {
<a name="l05474"></a>05474     <span class="keywordtype">char</span> squeez[<a class="code" href="../../d1/db0/string_8c.html#a1aed439b6d96085fbace0329113536c0">TR_TABLE_SIZE</a>];
<a name="l05475"></a>05475     <a class="code" href="../../d1/d7b/struct_onig_encoding_type_s_t.html">rb_encoding</a> *enc = 0;
<a name="l05476"></a>05476     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> del = 0, nodel = 0;
<a name="l05477"></a>05477     <span class="keywordtype">char</span> *s, *send, *t;
<a name="l05478"></a>05478     <span class="keywordtype">int</span> i, modify = 0;
<a name="l05479"></a>05479     <span class="keywordtype">int</span> ascompat, singlebyte = <a class="code" href="../../d1/db0/string_8c.html#a5ab3c8112c2ec6943bdae8a2036fca02">single_byte_optimizable</a>(str);
<a name="l05480"></a>05480     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> save;
<a name="l05481"></a>05481 
<a name="l05482"></a>05482     <span class="keywordflow">if</span> (argc == 0) {
<a name="l05483"></a>05483         enc = <a class="code" href="../../d1/db0/string_8c.html#a123891f9f9b0c87d15621d93b4fa9c41">STR_ENC_GET</a>(str);
<a name="l05484"></a>05484     }
<a name="l05485"></a>05485     <span class="keywordflow">else</span> {
<a name="l05486"></a>05486         <span class="keywordflow">for</span> (i=0; i&lt;argc; i++) {
<a name="l05487"></a>05487             <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> s = argv[i];
<a name="l05488"></a>05488 
<a name="l05489"></a>05489             <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a0e80f207eb41e9010ec9f0f5f9419fea">StringValue</a>(s);
<a name="l05490"></a>05490             enc = <a class="code" href="../../d5/db5/encoding_8c.html#a7d17d602fae27de649f9310511c03db0">rb_enc_check</a>(str, s);
<a name="l05491"></a>05491             <span class="keywordflow">if</span> (singlebyte &amp;&amp; !<a class="code" href="../../d1/db0/string_8c.html#a5ab3c8112c2ec6943bdae8a2036fca02">single_byte_optimizable</a>(s))
<a name="l05492"></a>05492                 singlebyte = 0;
<a name="l05493"></a>05493             <a class="code" href="../../d1/db0/string_8c.html#adc8eed0834f0f63a2e8a9cfe7517df20">tr_setup_table</a>(s, squeez, i==0, &amp;del, &amp;nodel, enc);
<a name="l05494"></a>05494         }
<a name="l05495"></a>05495     }
<a name="l05496"></a>05496 
<a name="l05497"></a>05497     <a class="code" href="../../d1/db0/string_8c.html#a106a1166130a12736cf57bacc164e4a5">str_modify_keep_cr</a>(str);
<a name="l05498"></a>05498     s = t = <a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(str);
<a name="l05499"></a>05499     <span class="keywordflow">if</span> (!s || <a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(str) == 0) <span class="keywordflow">return</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a320970f989dc8294c8203154e3db40c1">Qnil</a>;
<a name="l05500"></a>05500     send = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a35bfa2635774977edad0a16b9fdebbaf">RSTRING_END</a>(str);
<a name="l05501"></a>05501     save = -1;
<a name="l05502"></a>05502     ascompat = <a class="code" href="../../d5/de3/encoding_8h.html#a8b18a09a3055d3006c6d5baeaa6e7c72">rb_enc_asciicompat</a>(enc);
<a name="l05503"></a>05503 
<a name="l05504"></a>05504     <span class="keywordflow">if</span> (singlebyte) {
<a name="l05505"></a>05505         <span class="keywordflow">while</span> (s &lt; send) {
<a name="l05506"></a>05506             <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> c = *(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*)s++;
<a name="l05507"></a>05507             <span class="keywordflow">if</span> (c != save || (argc &gt; 0 &amp;&amp; !squeez[c])) {
<a name="l05508"></a>05508                 *t++ = save = c;
<a name="l05509"></a>05509             }
<a name="l05510"></a>05510         }
<a name="l05511"></a>05511     } <span class="keywordflow">else</span> {
<a name="l05512"></a>05512         <span class="keywordflow">while</span> (s &lt; send) {
<a name="l05513"></a>05513             <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> c;
<a name="l05514"></a>05514             <span class="keywordtype">int</span> clen;
<a name="l05515"></a>05515 
<a name="l05516"></a>05516             <span class="keywordflow">if</span> (ascompat &amp;&amp; (c = *(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*)s) &lt; 0x80) {
<a name="l05517"></a>05517                 <span class="keywordflow">if</span> (c != save || (argc &gt; 0 &amp;&amp; !squeez[c])) {
<a name="l05518"></a>05518                     *t++ = save = c;
<a name="l05519"></a>05519                 }
<a name="l05520"></a>05520                 s++;
<a name="l05521"></a>05521             }
<a name="l05522"></a>05522             <span class="keywordflow">else</span> {
<a name="l05523"></a>05523                 c = <a class="code" href="../../d5/db5/encoding_8c.html#a25e1e0b74ee98f47dd26a44bb11b7b3c">rb_enc_codepoint_len</a>(s, send, &amp;clen, enc);
<a name="l05524"></a>05524 
<a name="l05525"></a>05525                 <span class="keywordflow">if</span> (c != save || (argc &gt; 0 &amp;&amp; !<a class="code" href="../../d1/db0/string_8c.html#adc72507a607b076ed99abade51e3184e">tr_find</a>(c, squeez, del, nodel))) {
<a name="l05526"></a>05526                     <span class="keywordflow">if</span> (t != s) <a class="code" href="../../d5/de3/encoding_8h.html#a243639504d867c0a638be91db2d19db1">rb_enc_mbcput</a>(c, t, enc);
<a name="l05527"></a>05527                     save = c;
<a name="l05528"></a>05528                     t += clen;
<a name="l05529"></a>05529                 }
<a name="l05530"></a>05530                 s += clen;
<a name="l05531"></a>05531             }
<a name="l05532"></a>05532         }
<a name="l05533"></a>05533     }
<a name="l05534"></a>05534 
<a name="l05535"></a>05535     *t = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l05536"></a>05536     <span class="keywordflow">if</span> (t - <a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(str) != <a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(str)) {
<a name="l05537"></a>05537         <a class="code" href="../../d1/db0/string_8c.html#a056c7c0a74c83ccdb5a160bbdcbf8c3b">STR_SET_LEN</a>(str, t - <a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(str));
<a name="l05538"></a>05538         modify = 1;
<a name="l05539"></a>05539     }
<a name="l05540"></a>05540 
<a name="l05541"></a>05541     <span class="keywordflow">if</span> (modify) <span class="keywordflow">return</span> str;
<a name="l05542"></a>05542     <span class="keywordflow">return</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a320970f989dc8294c8203154e3db40c1">Qnil</a>;
<a name="l05543"></a>05543 }
<a name="l05544"></a>05544 
<a name="l05545"></a>05545 
<a name="l05546"></a>05546 <span class="comment">/*</span>
<a name="l05547"></a>05547 <span class="comment"> *  call-seq:</span>
<a name="l05548"></a>05548 <span class="comment"> *     str.squeeze([other_str]*)    -&gt; new_str</span>
<a name="l05549"></a>05549 <span class="comment"> *</span>
<a name="l05550"></a>05550 <span class="comment"> *  Builds a set of characters from the &lt;i&gt;other_str&lt;/i&gt; parameter(s) using the</span>
<a name="l05551"></a>05551 <span class="comment"> *  procedure described for &lt;code&gt;String#count&lt;/code&gt;. Returns a new string</span>
<a name="l05552"></a>05552 <span class="comment"> *  where runs of the same character that occur in this set are replaced by a</span>
<a name="l05553"></a>05553 <span class="comment"> *  single character. If no arguments are given, all runs of identical</span>
<a name="l05554"></a>05554 <span class="comment"> *  characters are replaced by a single character.</span>
<a name="l05555"></a>05555 <span class="comment"> *</span>
<a name="l05556"></a>05556 <span class="comment"> *     &quot;yellow moon&quot;.squeeze                  #=&gt; &quot;yelow mon&quot;</span>
<a name="l05557"></a>05557 <span class="comment"> *     &quot;  now   is  the&quot;.squeeze(&quot; &quot;)         #=&gt; &quot; now is the&quot;</span>
<a name="l05558"></a>05558 <span class="comment"> *     &quot;putters shoot balls&quot;.squeeze(&quot;m-z&quot;)   #=&gt; &quot;puters shot balls&quot;</span>
<a name="l05559"></a>05559 <span class="comment"> */</span>
<a name="l05560"></a>05560 
<a name="l05561"></a>05561 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l05562"></a><a class="code" href="../../d1/db0/string_8c.html#aeca9264256736889e939458bd9644bb2">05562</a> <a class="code" href="../../d1/db0/string_8c.html#aeca9264256736889e939458bd9644bb2">rb_str_squeeze</a>(<span class="keywordtype">int</span> <a class="code" href="../../df/d77/ruby_8c.html#ad1447518f4372828b8435ae82e48499e">argc</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> *<a class="code" href="../../df/d77/ruby_8c.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str)
<a name="l05563"></a>05563 {
<a name="l05564"></a>05564     str = <a class="code" href="../../db/d2e/intern_8h.html#ae2843c766c24b80116bb127ebf22d5bf">rb_str_dup</a>(str);
<a name="l05565"></a>05565     <a class="code" href="../../d1/db0/string_8c.html#a7c54529ef3c752ebf58c5c48fc545348">rb_str_squeeze_bang</a>(argc, argv, str);
<a name="l05566"></a>05566     <span class="keywordflow">return</span> str;
<a name="l05567"></a>05567 }
<a name="l05568"></a>05568 
<a name="l05569"></a>05569 
<a name="l05570"></a>05570 <span class="comment">/*</span>
<a name="l05571"></a>05571 <span class="comment"> *  call-seq:</span>
<a name="l05572"></a>05572 <span class="comment"> *     str.tr_s!(from_str, to_str)   -&gt; str or nil</span>
<a name="l05573"></a>05573 <span class="comment"> *</span>
<a name="l05574"></a>05574 <span class="comment"> *  Performs &lt;code&gt;String#tr_s&lt;/code&gt; processing on &lt;i&gt;str&lt;/i&gt; in place,</span>
<a name="l05575"></a>05575 <span class="comment"> *  returning &lt;i&gt;str&lt;/i&gt;, or &lt;code&gt;nil&lt;/code&gt; if no changes were made.</span>
<a name="l05576"></a>05576 <span class="comment"> */</span>
<a name="l05577"></a>05577 
<a name="l05578"></a>05578 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l05579"></a><a class="code" href="../../d1/db0/string_8c.html#a1d9111a6978e1672fddcae19537154e9">05579</a> <a class="code" href="../../d1/db0/string_8c.html#a1d9111a6978e1672fddcae19537154e9">rb_str_tr_s_bang</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> src, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> repl)
<a name="l05580"></a>05580 {
<a name="l05581"></a>05581     <span class="keywordflow">return</span> <a class="code" href="../../d1/db0/string_8c.html#a38b8eefe65ec38ea6172d21d2a641e2f">tr_trans</a>(str, src, repl, 1);
<a name="l05582"></a>05582 }
<a name="l05583"></a>05583 
<a name="l05584"></a>05584 
<a name="l05585"></a>05585 <span class="comment">/*</span>
<a name="l05586"></a>05586 <span class="comment"> *  call-seq:</span>
<a name="l05587"></a>05587 <span class="comment"> *     str.tr_s(from_str, to_str)   -&gt; new_str</span>
<a name="l05588"></a>05588 <span class="comment"> *</span>
<a name="l05589"></a>05589 <span class="comment"> *  Processes a copy of &lt;i&gt;str&lt;/i&gt; as described under &lt;code&gt;String#tr&lt;/code&gt;,</span>
<a name="l05590"></a>05590 <span class="comment"> *  then removes duplicate characters in regions that were affected by the</span>
<a name="l05591"></a>05591 <span class="comment"> *  translation.</span>
<a name="l05592"></a>05592 <span class="comment"> *</span>
<a name="l05593"></a>05593 <span class="comment"> *     &quot;hello&quot;.tr_s(&apos;l&apos;, &apos;r&apos;)     #=&gt; &quot;hero&quot;</span>
<a name="l05594"></a>05594 <span class="comment"> *     &quot;hello&quot;.tr_s(&apos;el&apos;, &apos;*&apos;)    #=&gt; &quot;h*o&quot;</span>
<a name="l05595"></a>05595 <span class="comment"> *     &quot;hello&quot;.tr_s(&apos;el&apos;, &apos;hx&apos;)   #=&gt; &quot;hhxo&quot;</span>
<a name="l05596"></a>05596 <span class="comment"> */</span>
<a name="l05597"></a>05597 
<a name="l05598"></a>05598 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l05599"></a><a class="code" href="../../d1/db0/string_8c.html#ae29bb5266292a0cd296816eda5aa0a04">05599</a> <a class="code" href="../../d1/db0/string_8c.html#ae29bb5266292a0cd296816eda5aa0a04">rb_str_tr_s</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> src, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> repl)
<a name="l05600"></a>05600 {
<a name="l05601"></a>05601     str = <a class="code" href="../../db/d2e/intern_8h.html#ae2843c766c24b80116bb127ebf22d5bf">rb_str_dup</a>(str);
<a name="l05602"></a>05602     <a class="code" href="../../d1/db0/string_8c.html#a38b8eefe65ec38ea6172d21d2a641e2f">tr_trans</a>(str, src, repl, 1);
<a name="l05603"></a>05603     <span class="keywordflow">return</span> str;
<a name="l05604"></a>05604 }
<a name="l05605"></a>05605 
<a name="l05606"></a>05606 
<a name="l05607"></a>05607 <span class="comment">/*</span>
<a name="l05608"></a>05608 <span class="comment"> *  call-seq:</span>
<a name="l05609"></a>05609 <span class="comment"> *     str.count([other_str]+)   -&gt; fixnum</span>
<a name="l05610"></a>05610 <span class="comment"> *</span>
<a name="l05611"></a>05611 <span class="comment"> *  Each &lt;i&gt;other_str&lt;/i&gt; parameter defines a set of characters to count.  The</span>
<a name="l05612"></a>05612 <span class="comment"> *  intersection of these sets defines the characters to count in</span>
<a name="l05613"></a>05613 <span class="comment"> *  &lt;i&gt;str&lt;/i&gt;. Any &lt;i&gt;other_str&lt;/i&gt; that starts with a caret (^) is</span>
<a name="l05614"></a>05614 <span class="comment"> *  negated. The sequence c1--c2 means all characters between c1 and c2.</span>
<a name="l05615"></a>05615 <span class="comment"> *</span>
<a name="l05616"></a>05616 <span class="comment"> *     a = &quot;hello world&quot;</span>
<a name="l05617"></a>05617 <span class="comment"> *     a.count &quot;lo&quot;            #=&gt; 5</span>
<a name="l05618"></a>05618 <span class="comment"> *     a.count &quot;lo&quot;, &quot;o&quot;       #=&gt; 2</span>
<a name="l05619"></a>05619 <span class="comment"> *     a.count &quot;hello&quot;, &quot;^l&quot;   #=&gt; 4</span>
<a name="l05620"></a>05620 <span class="comment"> *     a.count &quot;ej-m&quot;          #=&gt; 4</span>
<a name="l05621"></a>05621 <span class="comment"> */</span>
<a name="l05622"></a>05622 
<a name="l05623"></a>05623 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l05624"></a><a class="code" href="../../d1/db0/string_8c.html#ab7b6998c4baa50e2b12565422f463272">05624</a> <a class="code" href="../../d1/db0/string_8c.html#ab7b6998c4baa50e2b12565422f463272">rb_str_count</a>(<span class="keywordtype">int</span> <a class="code" href="../../df/d77/ruby_8c.html#ad1447518f4372828b8435ae82e48499e">argc</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> *<a class="code" href="../../df/d77/ruby_8c.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str)
<a name="l05625"></a>05625 {
<a name="l05626"></a>05626     <span class="keywordtype">char</span> table[<a class="code" href="../../d1/db0/string_8c.html#a1aed439b6d96085fbace0329113536c0">TR_TABLE_SIZE</a>];
<a name="l05627"></a>05627     <a class="code" href="../../d1/d7b/struct_onig_encoding_type_s_t.html">rb_encoding</a> *enc = 0;
<a name="l05628"></a>05628     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> del = 0, nodel = 0;
<a name="l05629"></a>05629     <span class="keywordtype">char</span> *s, *send;
<a name="l05630"></a>05630     <span class="keywordtype">int</span> i;
<a name="l05631"></a>05631     <span class="keywordtype">int</span> ascompat;
<a name="l05632"></a>05632 
<a name="l05633"></a>05633     <span class="keywordflow">if</span> (argc &lt; 1) {
<a name="l05634"></a>05634         <a class="code" href="../../db/dcc/error_8c.html#a0f771a2840561f1838169b3d7d4616f3">rb_raise</a>(<a class="code" href="../../db/dcc/error_8c.html#ab5e2a9fec766c75176fbb262bfe6a596">rb_eArgError</a>, <span class="stringliteral">&quot;wrong number of arguments (at least 1)&quot;</span>);
<a name="l05635"></a>05635     }
<a name="l05636"></a>05636     <span class="keywordflow">for</span> (i=0; i&lt;argc; i++) {
<a name="l05637"></a>05637         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> tstr = argv[i];
<a name="l05638"></a>05638         <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> c;
<a name="l05639"></a>05639 
<a name="l05640"></a>05640         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a0e80f207eb41e9010ec9f0f5f9419fea">StringValue</a>(tstr);
<a name="l05641"></a>05641         enc = <a class="code" href="../../d5/db5/encoding_8c.html#a7d17d602fae27de649f9310511c03db0">rb_enc_check</a>(str, tstr);
<a name="l05642"></a>05642         <span class="keywordflow">if</span> (argc == 1 &amp;&amp; <a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(tstr) == 1 &amp;&amp; <a class="code" href="../../d5/de3/encoding_8h.html#a8b18a09a3055d3006c6d5baeaa6e7c72">rb_enc_asciicompat</a>(enc) &amp;&amp;
<a name="l05643"></a>05643             (c = <a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(tstr)[0]) &lt; 0x80 &amp;&amp; !<a class="code" href="../../d1/db0/string_8c.html#a8de8d2f6479866e76eeb56f5044fa583">is_broken_string</a>(str)) {
<a name="l05644"></a>05644             <span class="keywordtype">int</span> n = 0;
<a name="l05645"></a>05645 
<a name="l05646"></a>05646             s = <a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(str);
<a name="l05647"></a>05647             <span class="keywordflow">if</span> (!s || <a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(str) == 0) <span class="keywordflow">return</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(0);
<a name="l05648"></a>05648             send = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a35bfa2635774977edad0a16b9fdebbaf">RSTRING_END</a>(str);
<a name="l05649"></a>05649             <span class="keywordflow">while</span> (s &lt; send) {
<a name="l05650"></a>05650                 <span class="keywordflow">if</span> (*(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*)s++ == c) n++;
<a name="l05651"></a>05651             }
<a name="l05652"></a>05652             <span class="keywordflow">return</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aca9f83a35416ed9d6e0b860afa5eaf0f">INT2NUM</a>(n);
<a name="l05653"></a>05653         }
<a name="l05654"></a>05654         <a class="code" href="../../d1/db0/string_8c.html#adc8eed0834f0f63a2e8a9cfe7517df20">tr_setup_table</a>(tstr, table, i==0, &amp;del, &amp;nodel, enc);
<a name="l05655"></a>05655     }
<a name="l05656"></a>05656 
<a name="l05657"></a>05657     s = <a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(str);
<a name="l05658"></a>05658     <span class="keywordflow">if</span> (!s || <a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(str) == 0) <span class="keywordflow">return</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(0);
<a name="l05659"></a>05659     send = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a35bfa2635774977edad0a16b9fdebbaf">RSTRING_END</a>(str);
<a name="l05660"></a>05660     ascompat = <a class="code" href="../../d5/de3/encoding_8h.html#a8b18a09a3055d3006c6d5baeaa6e7c72">rb_enc_asciicompat</a>(enc);
<a name="l05661"></a>05661     i = 0;
<a name="l05662"></a>05662     <span class="keywordflow">while</span> (s &lt; send) {
<a name="l05663"></a>05663         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> c;
<a name="l05664"></a>05664 
<a name="l05665"></a>05665         <span class="keywordflow">if</span> (ascompat &amp;&amp; (c = *(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*)s) &lt; 0x80) {
<a name="l05666"></a>05666             <span class="keywordflow">if</span> (table[c]) {
<a name="l05667"></a>05667                 i++;
<a name="l05668"></a>05668             }
<a name="l05669"></a>05669             s++;
<a name="l05670"></a>05670         }
<a name="l05671"></a>05671         <span class="keywordflow">else</span> {
<a name="l05672"></a>05672             <span class="keywordtype">int</span> clen;
<a name="l05673"></a>05673             c = <a class="code" href="../../d5/db5/encoding_8c.html#a25e1e0b74ee98f47dd26a44bb11b7b3c">rb_enc_codepoint_len</a>(s, send, &amp;clen, enc);
<a name="l05674"></a>05674             <span class="keywordflow">if</span> (<a class="code" href="../../d1/db0/string_8c.html#adc72507a607b076ed99abade51e3184e">tr_find</a>(c, table, del, nodel)) {
<a name="l05675"></a>05675                 i++;
<a name="l05676"></a>05676             }
<a name="l05677"></a>05677             s += clen;
<a name="l05678"></a>05678         }
<a name="l05679"></a>05679     }
<a name="l05680"></a>05680 
<a name="l05681"></a>05681     <span class="keywordflow">return</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aca9f83a35416ed9d6e0b860afa5eaf0f">INT2NUM</a>(i);
<a name="l05682"></a>05682 }
<a name="l05683"></a>05683 
<a name="l05684"></a><a class="code" href="../../d1/db0/string_8c.html#a2e88d3e2007c4822b136b273963e21dc">05684</a> <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> <a class="code" href="../../d1/db0/string_8c.html#a2e88d3e2007c4822b136b273963e21dc">isspacetable</a>[256] = {
<a name="l05685"></a>05685     0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 0, 0,
<a name="l05686"></a>05686     0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
<a name="l05687"></a>05687     1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
<a name="l05688"></a>05688     0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
<a name="l05689"></a>05689     0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
<a name="l05690"></a>05690     0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
<a name="l05691"></a>05691     0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
<a name="l05692"></a>05692     0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
<a name="l05693"></a>05693     0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
<a name="l05694"></a>05694     0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
<a name="l05695"></a>05695     0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
<a name="l05696"></a>05696     0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
<a name="l05697"></a>05697     0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
<a name="l05698"></a>05698     0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
<a name="l05699"></a>05699     0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
<a name="l05700"></a>05700     0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
<a name="l05701"></a>05701 };
<a name="l05702"></a>05702 
<a name="l05703"></a><a class="code" href="../../d1/db0/string_8c.html#a791bdba5e287dd4527ed38f210c96ba2">05703</a> <span class="preprocessor">#define ascii_isspace(c) isspacetable[(unsigned char)(c)]</span>
<a name="l05704"></a>05704 <span class="preprocessor"></span>
<a name="l05705"></a>05705 <span class="comment">/*</span>
<a name="l05706"></a>05706 <span class="comment"> *  call-seq:</span>
<a name="l05707"></a>05707 <span class="comment"> *     str.split(pattern=$;, [limit])   -&gt; anArray</span>
<a name="l05708"></a>05708 <span class="comment"> *</span>
<a name="l05709"></a>05709 <span class="comment"> *  Divides &lt;i&gt;str&lt;/i&gt; into substrings based on a delimiter, returning an array</span>
<a name="l05710"></a>05710 <span class="comment"> *  of these substrings.</span>
<a name="l05711"></a>05711 <span class="comment"> *</span>
<a name="l05712"></a>05712 <span class="comment"> *  If &lt;i&gt;pattern&lt;/i&gt; is a &lt;code&gt;String&lt;/code&gt;, then its contents are used as</span>
<a name="l05713"></a>05713 <span class="comment"> *  the delimiter when splitting &lt;i&gt;str&lt;/i&gt;. If &lt;i&gt;pattern&lt;/i&gt; is a single</span>
<a name="l05714"></a>05714 <span class="comment"> *  space, &lt;i&gt;str&lt;/i&gt; is split on whitespace, with leading whitespace and runs</span>
<a name="l05715"></a>05715 <span class="comment"> *  of contiguous whitespace characters ignored.</span>
<a name="l05716"></a>05716 <span class="comment"> *</span>
<a name="l05717"></a>05717 <span class="comment"> *  If &lt;i&gt;pattern&lt;/i&gt; is a &lt;code&gt;Regexp&lt;/code&gt;, &lt;i&gt;str&lt;/i&gt; is divided where the</span>
<a name="l05718"></a>05718 <span class="comment"> *  pattern matches. Whenever the pattern matches a zero-length string,</span>
<a name="l05719"></a>05719 <span class="comment"> *  &lt;i&gt;str&lt;/i&gt; is split into individual characters. If &lt;i&gt;pattern&lt;/i&gt; contains</span>
<a name="l05720"></a>05720 <span class="comment"> *  groups, the respective matches will be returned in the array as well.</span>
<a name="l05721"></a>05721 <span class="comment"> *</span>
<a name="l05722"></a>05722 <span class="comment"> *  If &lt;i&gt;pattern&lt;/i&gt; is omitted, the value of &lt;code&gt;$;&lt;/code&gt; is used.  If</span>
<a name="l05723"></a>05723 <span class="comment"> *  &lt;code&gt;$;&lt;/code&gt; is &lt;code&gt;nil&lt;/code&gt; (which is the default), &lt;i&gt;str&lt;/i&gt; is</span>
<a name="l05724"></a>05724 <span class="comment"> *  split on whitespace as if ` &apos; were specified.</span>
<a name="l05725"></a>05725 <span class="comment"> *</span>
<a name="l05726"></a>05726 <span class="comment"> *  If the &lt;i&gt;limit&lt;/i&gt; parameter is omitted, trailing null fields are</span>
<a name="l05727"></a>05727 <span class="comment"> *  suppressed. If &lt;i&gt;limit&lt;/i&gt; is a positive number, at most that number of</span>
<a name="l05728"></a>05728 <span class="comment"> *  fields will be returned (if &lt;i&gt;limit&lt;/i&gt; is &lt;code&gt;1&lt;/code&gt;, the entire</span>
<a name="l05729"></a>05729 <span class="comment"> *  string is returned as the only entry in an array). If negative, there is no</span>
<a name="l05730"></a>05730 <span class="comment"> *  limit to the number of fields returned, and trailing null fields are not</span>
<a name="l05731"></a>05731 <span class="comment"> *  suppressed.</span>
<a name="l05732"></a>05732 <span class="comment"> *</span>
<a name="l05733"></a>05733 <span class="comment"> *     &quot; now&apos;s  the time&quot;.split        #=&gt; [&quot;now&apos;s&quot;, &quot;the&quot;, &quot;time&quot;]</span>
<a name="l05734"></a>05734 <span class="comment"> *     &quot; now&apos;s  the time&quot;.split(&apos; &apos;)   #=&gt; [&quot;now&apos;s&quot;, &quot;the&quot;, &quot;time&quot;]</span>
<a name="l05735"></a>05735 <span class="comment"> *     &quot; now&apos;s  the time&quot;.split(/ /)   #=&gt; [&quot;&quot;, &quot;now&apos;s&quot;, &quot;&quot;, &quot;the&quot;, &quot;time&quot;]</span>
<a name="l05736"></a>05736 <span class="comment"> *     &quot;1, 2.34,56, 7&quot;.split(%r{,\s*}) #=&gt; [&quot;1&quot;, &quot;2.34&quot;, &quot;56&quot;, &quot;7&quot;]</span>
<a name="l05737"></a>05737 <span class="comment"> *     &quot;hello&quot;.split(//)               #=&gt; [&quot;h&quot;, &quot;e&quot;, &quot;l&quot;, &quot;l&quot;, &quot;o&quot;]</span>
<a name="l05738"></a>05738 <span class="comment"> *     &quot;hello&quot;.split(//, 3)            #=&gt; [&quot;h&quot;, &quot;e&quot;, &quot;llo&quot;]</span>
<a name="l05739"></a>05739 <span class="comment"> *     &quot;hi mom&quot;.split(%r{\s*})         #=&gt; [&quot;h&quot;, &quot;i&quot;, &quot;m&quot;, &quot;o&quot;, &quot;m&quot;]</span>
<a name="l05740"></a>05740 <span class="comment"> *</span>
<a name="l05741"></a>05741 <span class="comment"> *     &quot;mellow yellow&quot;.split(&quot;ello&quot;)   #=&gt; [&quot;m&quot;, &quot;w y&quot;, &quot;w&quot;]</span>
<a name="l05742"></a>05742 <span class="comment"> *     &quot;1,2,,3,4,,&quot;.split(&apos;,&apos;)         #=&gt; [&quot;1&quot;, &quot;2&quot;, &quot;&quot;, &quot;3&quot;, &quot;4&quot;]</span>
<a name="l05743"></a>05743 <span class="comment"> *     &quot;1,2,,3,4,,&quot;.split(&apos;,&apos;, 4)      #=&gt; [&quot;1&quot;, &quot;2&quot;, &quot;&quot;, &quot;3,4,,&quot;]</span>
<a name="l05744"></a>05744 <span class="comment"> *     &quot;1,2,,3,4,,&quot;.split(&apos;,&apos;, -4)     #=&gt; [&quot;1&quot;, &quot;2&quot;, &quot;&quot;, &quot;3&quot;, &quot;4&quot;, &quot;&quot;, &quot;&quot;]</span>
<a name="l05745"></a>05745 <span class="comment"> */</span>
<a name="l05746"></a>05746 
<a name="l05747"></a>05747 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l05748"></a><a class="code" href="../../d1/db0/string_8c.html#a007e56ccd20ef00c209fd4b0373aa198">05748</a> <a class="code" href="../../d1/db0/string_8c.html#a007e56ccd20ef00c209fd4b0373aa198">rb_str_split_m</a>(<span class="keywordtype">int</span> <a class="code" href="../../df/d77/ruby_8c.html#ad1447518f4372828b8435ae82e48499e">argc</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> *<a class="code" href="../../df/d77/ruby_8c.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str)
<a name="l05749"></a>05749 {
<a name="l05750"></a>05750     <a class="code" href="../../d1/d7b/struct_onig_encoding_type_s_t.html">rb_encoding</a> *enc;
<a name="l05751"></a>05751     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> spat;
<a name="l05752"></a>05752     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> limit;
<a name="l05753"></a>05753     <span class="keyword">enum</span> {awk, string, <a class="code" href="../../d3/d09/ripper_8y.html#a91a8792a60d26aa3a547451afe30e002">regexp</a>} split_type;
<a name="l05754"></a>05754     <span class="keywordtype">long</span> beg, end, i = 0;
<a name="l05755"></a>05755     <span class="keywordtype">int</span> lim = 0;
<a name="l05756"></a>05756     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <a class="code" href="../../d8/d90/nkf_8c.html#a5ea5ac7abf5cce39283e422add1067d5">result</a>, tmp;
<a name="l05757"></a>05757 
<a name="l05758"></a>05758     <span class="keywordflow">if</span> (<a class="code" href="../../d7/d19/group__defmethod.html#gaa7bed88640f01bee619f85fda09d28d7">rb_scan_args</a>(argc, argv, <span class="stringliteral">&quot;02&quot;</span>, &amp;spat, &amp;limit) == 2) {
<a name="l05759"></a>05759         lim = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a877c38180d23c5447d976c70dda89d69">NUM2INT</a>(limit);
<a name="l05760"></a>05760         <span class="keywordflow">if</span> (lim &lt;= 0) limit = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a320970f989dc8294c8203154e3db40c1">Qnil</a>;
<a name="l05761"></a>05761         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (lim == 1) {
<a name="l05762"></a>05762             <span class="keywordflow">if</span> (<a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(str) == 0)
<a name="l05763"></a>05763                 <span class="keywordflow">return</span> <a class="code" href="../../dc/dcc/array_8c.html#a43a7bd246935ab63c233b4ae34d61d75">rb_ary_new2</a>(0);
<a name="l05764"></a>05764             <span class="keywordflow">return</span> <a class="code" href="../../dc/dcc/array_8c.html#a8317ecd6a0abb5ad08c50c732f30059b">rb_ary_new3</a>(1, str);
<a name="l05765"></a>05765         }
<a name="l05766"></a>05766         i = 1;
<a name="l05767"></a>05767     }
<a name="l05768"></a>05768 
<a name="l05769"></a>05769     enc = <a class="code" href="../../d1/db0/string_8c.html#a123891f9f9b0c87d15621d93b4fa9c41">STR_ENC_GET</a>(str);
<a name="l05770"></a>05770     <span class="keywordflow">if</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a4832bad8845a35fc50f7a160901854a1">NIL_P</a>(spat)) {
<a name="l05771"></a>05771         <span class="keywordflow">if</span> (!<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a4832bad8845a35fc50f7a160901854a1">NIL_P</a>(<a class="code" href="../../db/d2e/intern_8h.html#ade300b3f8270fc26be5821ad806615ff">rb_fs</a>)) {
<a name="l05772"></a>05772             spat = <a class="code" href="../../db/d2e/intern_8h.html#ade300b3f8270fc26be5821ad806615ff">rb_fs</a>;
<a name="l05773"></a>05773             <span class="keywordflow">goto</span> fs_set;
<a name="l05774"></a>05774         }
<a name="l05775"></a>05775         split_type = awk;
<a name="l05776"></a>05776     }
<a name="l05777"></a>05777     <span class="keywordflow">else</span> {
<a name="l05778"></a>05778       fs_set:
<a name="l05779"></a>05779         <span class="keywordflow">if</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a394faf7191f18552a20cb17ce14226f0">TYPE</a>(spat) == <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a22a8c2a4bbaae9b68f65c9bb92fd4e39">T_STRING</a>) {
<a name="l05780"></a>05780             <a class="code" href="../../d1/d7b/struct_onig_encoding_type_s_t.html">rb_encoding</a> *enc2 = <a class="code" href="../../d1/db0/string_8c.html#a123891f9f9b0c87d15621d93b4fa9c41">STR_ENC_GET</a>(spat);
<a name="l05781"></a>05781 
<a name="l05782"></a>05782             split_type = string;
<a name="l05783"></a>05783             <span class="keywordflow">if</span> (<a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(spat) == 0) {
<a name="l05784"></a>05784                 <span class="comment">/* Special case - split into chars */</span>
<a name="l05785"></a>05785                 spat = <a class="code" href="../../db/db6/re_8h.html#a8f481f1d87ea2ae333883087cabcacd5">rb_reg_regcomp</a>(spat);
<a name="l05786"></a>05786                 split_type = <a class="code" href="../../d3/d09/ripper_8y.html#a91a8792a60d26aa3a547451afe30e002">regexp</a>;
<a name="l05787"></a>05787             }
<a name="l05788"></a>05788             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d5/de3/encoding_8h.html#a8b18a09a3055d3006c6d5baeaa6e7c72">rb_enc_asciicompat</a>(enc2) == 1) {
<a name="l05789"></a>05789                 <span class="keywordflow">if</span> (<a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(spat) == 1 &amp;&amp; <a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(spat)[0] == <span class="charliteral">&apos; &apos;</span>){
<a name="l05790"></a>05790                     split_type = awk;
<a name="l05791"></a>05791                 }
<a name="l05792"></a>05792             }
<a name="l05793"></a>05793             <span class="keywordflow">else</span> {
<a name="l05794"></a>05794                 <span class="keywordtype">int</span> l;
<a name="l05795"></a>05795                 <span class="keywordflow">if</span> (<a class="code" href="../../d5/db5/encoding_8c.html#af6663b51ce857cfe600a8bc48434d6f2">rb_enc_ascget</a>(<a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(spat), <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a35bfa2635774977edad0a16b9fdebbaf">RSTRING_END</a>(spat), &amp;l, enc2) == <span class="charliteral">&apos; &apos;</span> &amp;&amp;
<a name="l05796"></a>05796                     <a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(spat) == l) {
<a name="l05797"></a>05797                     split_type = awk;
<a name="l05798"></a>05798                 }
<a name="l05799"></a>05799             }
<a name="l05800"></a>05800         }
<a name="l05801"></a>05801         <span class="keywordflow">else</span> {
<a name="l05802"></a>05802             spat = <a class="code" href="../../d1/db0/string_8c.html#a105b63dc9f6f07c8c6403302757e9c96">get_pat</a>(spat, 1);
<a name="l05803"></a>05803             split_type = <a class="code" href="../../d3/d09/ripper_8y.html#a91a8792a60d26aa3a547451afe30e002">regexp</a>;
<a name="l05804"></a>05804         }
<a name="l05805"></a>05805     }
<a name="l05806"></a>05806 
<a name="l05807"></a>05807     result = <a class="code" href="../../dc/dcc/array_8c.html#a9518114fd36cb4ef4656ec1dc63348c9">rb_ary_new</a>();
<a name="l05808"></a>05808     beg = 0;
<a name="l05809"></a>05809     <span class="keywordflow">if</span> (split_type == awk) {
<a name="l05810"></a>05810         <span class="keywordtype">char</span> *ptr = <a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(str);
<a name="l05811"></a>05811         <span class="keywordtype">char</span> *eptr = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a35bfa2635774977edad0a16b9fdebbaf">RSTRING_END</a>(str);
<a name="l05812"></a>05812         <span class="keywordtype">char</span> *bptr = ptr;
<a name="l05813"></a>05813         <span class="keywordtype">int</span> skip = 1;
<a name="l05814"></a>05814         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> c;
<a name="l05815"></a>05815 
<a name="l05816"></a>05816         end = beg;
<a name="l05817"></a>05817         <span class="keywordflow">if</span> (<a class="code" href="../../d1/db0/string_8c.html#a053ebe2487386654339f4de623e5d3a2">is_ascii_string</a>(str)) {
<a name="l05818"></a>05818             <span class="keywordflow">while</span> (ptr &lt; eptr) {
<a name="l05819"></a>05819                 c = (<span class="keywordtype">unsigned</span> char)*ptr++;
<a name="l05820"></a>05820                 <span class="keywordflow">if</span> (skip) {
<a name="l05821"></a>05821                     <span class="keywordflow">if</span> (<a class="code" href="../../d1/db0/string_8c.html#a791bdba5e287dd4527ed38f210c96ba2">ascii_isspace</a>(c)) {
<a name="l05822"></a>05822                         beg = ptr - bptr;
<a name="l05823"></a>05823                     }
<a name="l05824"></a>05824                     <span class="keywordflow">else</span> {
<a name="l05825"></a>05825                         end = ptr - bptr;
<a name="l05826"></a>05826                         skip = 0;
<a name="l05827"></a>05827                         <span class="keywordflow">if</span> (!<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a4832bad8845a35fc50f7a160901854a1">NIL_P</a>(limit) &amp;&amp; lim &lt;= i) <span class="keywordflow">break</span>;
<a name="l05828"></a>05828                     }
<a name="l05829"></a>05829                 }
<a name="l05830"></a>05830                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d1/db0/string_8c.html#a791bdba5e287dd4527ed38f210c96ba2">ascii_isspace</a>(c)) {
<a name="l05831"></a>05831                     <a class="code" href="../../dc/dcc/array_8c.html#a59d553a8cd781364b8bcb0deae25cca2">rb_ary_push</a>(result, <a class="code" href="../../db/d2e/intern_8h.html#aadf59e7cbba9319e199d85ef2448a970">rb_str_subseq</a>(str, beg, end-beg));
<a name="l05832"></a>05832                     skip = 1;
<a name="l05833"></a>05833                     beg = ptr - bptr;
<a name="l05834"></a>05834                     <span class="keywordflow">if</span> (!<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a4832bad8845a35fc50f7a160901854a1">NIL_P</a>(limit)) ++i;
<a name="l05835"></a>05835                 }
<a name="l05836"></a>05836                 <span class="keywordflow">else</span> {
<a name="l05837"></a>05837                     end = ptr - bptr;
<a name="l05838"></a>05838                 }
<a name="l05839"></a>05839             }
<a name="l05840"></a>05840         }
<a name="l05841"></a>05841         <span class="keywordflow">else</span> {
<a name="l05842"></a>05842             <span class="keywordflow">while</span> (ptr &lt; eptr) {
<a name="l05843"></a>05843                 <span class="keywordtype">int</span> n;
<a name="l05844"></a>05844 
<a name="l05845"></a>05845                 c = <a class="code" href="../../d5/db5/encoding_8c.html#a25e1e0b74ee98f47dd26a44bb11b7b3c">rb_enc_codepoint_len</a>(ptr, eptr, &amp;n, enc);
<a name="l05846"></a>05846                 ptr += n;
<a name="l05847"></a>05847                 <span class="keywordflow">if</span> (skip) {
<a name="l05848"></a>05848                     <span class="keywordflow">if</span> (<a class="code" href="../../d5/db5/encoding_8c.html#a89eaa268f33c65143f581dc2bcf50f22">rb_isspace</a>(c)) {
<a name="l05849"></a>05849                         beg = ptr - bptr;
<a name="l05850"></a>05850                     }
<a name="l05851"></a>05851                     <span class="keywordflow">else</span> {
<a name="l05852"></a>05852                         end = ptr - bptr;
<a name="l05853"></a>05853                         skip = 0;
<a name="l05854"></a>05854                         <span class="keywordflow">if</span> (!<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a4832bad8845a35fc50f7a160901854a1">NIL_P</a>(limit) &amp;&amp; lim &lt;= i) <span class="keywordflow">break</span>;
<a name="l05855"></a>05855                     }
<a name="l05856"></a>05856                 }
<a name="l05857"></a>05857                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d5/db5/encoding_8c.html#a89eaa268f33c65143f581dc2bcf50f22">rb_isspace</a>(c)) {
<a name="l05858"></a>05858                     <a class="code" href="../../dc/dcc/array_8c.html#a59d553a8cd781364b8bcb0deae25cca2">rb_ary_push</a>(result, <a class="code" href="../../db/d2e/intern_8h.html#aadf59e7cbba9319e199d85ef2448a970">rb_str_subseq</a>(str, beg, end-beg));
<a name="l05859"></a>05859                     skip = 1;
<a name="l05860"></a>05860                     beg = ptr - bptr;
<a name="l05861"></a>05861                     <span class="keywordflow">if</span> (!<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a4832bad8845a35fc50f7a160901854a1">NIL_P</a>(limit)) ++i;
<a name="l05862"></a>05862                 }
<a name="l05863"></a>05863                 <span class="keywordflow">else</span> {
<a name="l05864"></a>05864                     end = ptr - bptr;
<a name="l05865"></a>05865                 }
<a name="l05866"></a>05866             }
<a name="l05867"></a>05867         }
<a name="l05868"></a>05868     }
<a name="l05869"></a>05869     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (split_type == <span class="keywordtype">string</span>) {
<a name="l05870"></a>05870         <span class="keywordtype">char</span> *ptr = <a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(str);
<a name="l05871"></a>05871         <span class="keywordtype">char</span> *temp = ptr;
<a name="l05872"></a>05872         <span class="keywordtype">char</span> *eptr = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a35bfa2635774977edad0a16b9fdebbaf">RSTRING_END</a>(str);
<a name="l05873"></a>05873         <span class="keywordtype">char</span> *sptr = <a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(spat);
<a name="l05874"></a>05874         <span class="keywordtype">long</span> slen = <a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(spat);
<a name="l05875"></a>05875 
<a name="l05876"></a>05876         <span class="keywordflow">if</span> (<a class="code" href="../../d1/db0/string_8c.html#a8de8d2f6479866e76eeb56f5044fa583">is_broken_string</a>(str)) {
<a name="l05877"></a>05877             <a class="code" href="../../db/dcc/error_8c.html#a0f771a2840561f1838169b3d7d4616f3">rb_raise</a>(<a class="code" href="../../db/dcc/error_8c.html#ab5e2a9fec766c75176fbb262bfe6a596">rb_eArgError</a>, <span class="stringliteral">&quot;invalid byte sequence in %s&quot;</span>, <a class="code" href="../../d5/de3/encoding_8h.html#a69d59d898802726787a168ef2e0dc92c">rb_enc_name</a>(<a class="code" href="../../d1/db0/string_8c.html#a123891f9f9b0c87d15621d93b4fa9c41">STR_ENC_GET</a>(str)));
<a name="l05878"></a>05878         }
<a name="l05879"></a>05879         <span class="keywordflow">if</span> (<a class="code" href="../../d1/db0/string_8c.html#a8de8d2f6479866e76eeb56f5044fa583">is_broken_string</a>(spat)) {
<a name="l05880"></a>05880             <a class="code" href="../../db/dcc/error_8c.html#a0f771a2840561f1838169b3d7d4616f3">rb_raise</a>(<a class="code" href="../../db/dcc/error_8c.html#ab5e2a9fec766c75176fbb262bfe6a596">rb_eArgError</a>, <span class="stringliteral">&quot;invalid byte sequence in %s&quot;</span>, <a class="code" href="../../d5/de3/encoding_8h.html#a69d59d898802726787a168ef2e0dc92c">rb_enc_name</a>(<a class="code" href="../../d1/db0/string_8c.html#a123891f9f9b0c87d15621d93b4fa9c41">STR_ENC_GET</a>(spat)));
<a name="l05881"></a>05881         }
<a name="l05882"></a>05882         enc = <a class="code" href="../../d5/db5/encoding_8c.html#a7d17d602fae27de649f9310511c03db0">rb_enc_check</a>(str, spat);
<a name="l05883"></a>05883         <span class="keywordflow">while</span> (ptr &lt; eptr &amp;&amp;
<a name="l05884"></a>05884                (end = <a class="code" href="../../d5/de3/encoding_8h.html#a45cc3b058c7f36990e8733292c118047">rb_memsearch</a>(sptr, slen, ptr, eptr - ptr, enc)) &gt;= 0) {
<a name="l05885"></a>05885             <span class="comment">/* Check we are at the start of a char */</span>
<a name="l05886"></a>05886             <span class="keywordtype">char</span> *t = <a class="code" href="../../d5/de3/encoding_8h.html#adb27dfc4f0710833a6d7b179fdef9c70">rb_enc_right_char_head</a>(ptr, ptr + end, eptr, enc);
<a name="l05887"></a>05887             <span class="keywordflow">if</span> (t != ptr + end) {
<a name="l05888"></a>05888                 ptr = t;
<a name="l05889"></a>05889                 <span class="keywordflow">continue</span>;
<a name="l05890"></a>05890             }
<a name="l05891"></a>05891             <a class="code" href="../../dc/dcc/array_8c.html#a59d553a8cd781364b8bcb0deae25cca2">rb_ary_push</a>(result, <a class="code" href="../../db/d2e/intern_8h.html#aadf59e7cbba9319e199d85ef2448a970">rb_str_subseq</a>(str, ptr - temp, end));
<a name="l05892"></a>05892             ptr += end + slen;
<a name="l05893"></a>05893             <span class="keywordflow">if</span> (!<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a4832bad8845a35fc50f7a160901854a1">NIL_P</a>(limit) &amp;&amp; lim &lt;= ++i) <span class="keywordflow">break</span>;
<a name="l05894"></a>05894         }
<a name="l05895"></a>05895         beg = ptr - temp;
<a name="l05896"></a>05896     }
<a name="l05897"></a>05897     <span class="keywordflow">else</span> {
<a name="l05898"></a>05898         <span class="keywordtype">char</span> *ptr = <a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(str);
<a name="l05899"></a>05899         <span class="keywordtype">long</span> len = <a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(str);
<a name="l05900"></a>05900         <span class="keywordtype">long</span> start = beg;
<a name="l05901"></a>05901         <span class="keywordtype">long</span> idx;
<a name="l05902"></a>05902         <span class="keywordtype">int</span> last_null = 0;
<a name="l05903"></a>05903         <span class="keyword">struct </span><a class="code" href="../../d6/d14/structre__registers.html">re_registers</a> *regs;
<a name="l05904"></a>05904 
<a name="l05905"></a>05905         <span class="keywordflow">while</span> ((end = <a class="code" href="../../db/db6/re_8h.html#afdf554fa234aebc803c8a4fc98c9936f">rb_reg_search</a>(spat, str, start, 0)) &gt;= 0) {
<a name="l05906"></a>05906             regs = <a class="code" href="../../db/db6/re_8h.html#ad2abd878cfffefaeb1fc24372e80b4c8">RMATCH_REGS</a>(<a class="code" href="../../db/d2e/intern_8h.html#a2590f9272c0599ff0d1922bd0fb6efce">rb_backref_get</a>());
<a name="l05907"></a>05907             <span class="keywordflow">if</span> (start == end &amp;&amp; <a class="code" href="../../dc/d26/re_8c.html#a84a2ca0496ad2a7c4852c539acb90180">BEG</a>(0) == <a class="code" href="../../d5/d9f/escape_8c.html#a29fd18bed01c4d836c7ebfe73a125c3f">END</a>(0)) {
<a name="l05908"></a>05908                 <span class="keywordflow">if</span> (!ptr) {
<a name="l05909"></a>05909                     <a class="code" href="../../dc/dcc/array_8c.html#a59d553a8cd781364b8bcb0deae25cca2">rb_ary_push</a>(result, str_new_empty(str));
<a name="l05910"></a>05910                     <span class="keywordflow">break</span>;
<a name="l05911"></a>05911                 }
<a name="l05912"></a>05912                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (last_null == 1) {
<a name="l05913"></a>05913                     <a class="code" href="../../dc/dcc/array_8c.html#a59d553a8cd781364b8bcb0deae25cca2">rb_ary_push</a>(result, <a class="code" href="../../db/d2e/intern_8h.html#aadf59e7cbba9319e199d85ef2448a970">rb_str_subseq</a>(str, beg,
<a name="l05914"></a>05914                                                       <a class="code" href="../../d5/db5/encoding_8c.html#a405ec52962866fac46a16f02f3f92832">rb_enc_fast_mbclen</a>(ptr+beg,
<a name="l05915"></a>05915                                                                          ptr+len,
<a name="l05916"></a>05916                                                                          enc)));
<a name="l05917"></a>05917                     beg = start;
<a name="l05918"></a>05918                 }
<a name="l05919"></a>05919                 <span class="keywordflow">else</span> {
<a name="l05920"></a>05920                     <span class="keywordflow">if</span> (ptr+start == ptr+len)
<a name="l05921"></a>05921                         start++;
<a name="l05922"></a>05922                     <span class="keywordflow">else</span>
<a name="l05923"></a>05923                         start += <a class="code" href="../../d5/db5/encoding_8c.html#a405ec52962866fac46a16f02f3f92832">rb_enc_fast_mbclen</a>(ptr+start,ptr+len,enc);
<a name="l05924"></a>05924                     last_null = 1;
<a name="l05925"></a>05925                     <span class="keywordflow">continue</span>;
<a name="l05926"></a>05926                 }
<a name="l05927"></a>05927             }
<a name="l05928"></a>05928             <span class="keywordflow">else</span> {
<a name="l05929"></a>05929                 <a class="code" href="../../dc/dcc/array_8c.html#a59d553a8cd781364b8bcb0deae25cca2">rb_ary_push</a>(result, <a class="code" href="../../db/d2e/intern_8h.html#aadf59e7cbba9319e199d85ef2448a970">rb_str_subseq</a>(str, beg, end-beg));
<a name="l05930"></a>05930                 beg = start = <a class="code" href="../../d5/d9f/escape_8c.html#a29fd18bed01c4d836c7ebfe73a125c3f">END</a>(0);
<a name="l05931"></a>05931             }
<a name="l05932"></a>05932             last_null = 0;
<a name="l05933"></a>05933 
<a name="l05934"></a>05934             <span class="keywordflow">for</span> (idx=1; idx &lt; regs-&gt;<a class="code" href="../../d6/d14/structre__registers.html#a5e03bc44d6e9761f707cc1ba4cb4d023">num_regs</a>; idx++) {
<a name="l05935"></a>05935                 <span class="keywordflow">if</span> (<a class="code" href="../../dc/d26/re_8c.html#a84a2ca0496ad2a7c4852c539acb90180">BEG</a>(idx) == -1) <span class="keywordflow">continue</span>;
<a name="l05936"></a>05936                 <span class="keywordflow">if</span> (<a class="code" href="../../dc/d26/re_8c.html#a84a2ca0496ad2a7c4852c539acb90180">BEG</a>(idx) == <a class="code" href="../../d5/d9f/escape_8c.html#a29fd18bed01c4d836c7ebfe73a125c3f">END</a>(idx))
<a name="l05937"></a>05937                     tmp = str_new_empty(str);
<a name="l05938"></a>05938                 <span class="keywordflow">else</span>
<a name="l05939"></a>05939                     tmp = <a class="code" href="../../db/d2e/intern_8h.html#aadf59e7cbba9319e199d85ef2448a970">rb_str_subseq</a>(str, <a class="code" href="../../dc/d26/re_8c.html#a84a2ca0496ad2a7c4852c539acb90180">BEG</a>(idx), <a class="code" href="../../d5/d9f/escape_8c.html#a29fd18bed01c4d836c7ebfe73a125c3f">END</a>(idx)-<a class="code" href="../../dc/d26/re_8c.html#a84a2ca0496ad2a7c4852c539acb90180">BEG</a>(idx));
<a name="l05940"></a>05940                 <a class="code" href="../../dc/dcc/array_8c.html#a59d553a8cd781364b8bcb0deae25cca2">rb_ary_push</a>(result, tmp);
<a name="l05941"></a>05941             }
<a name="l05942"></a>05942             <span class="keywordflow">if</span> (!<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a4832bad8845a35fc50f7a160901854a1">NIL_P</a>(limit) &amp;&amp; lim &lt;= ++i) <span class="keywordflow">break</span>;
<a name="l05943"></a>05943         }
<a name="l05944"></a>05944     }
<a name="l05945"></a>05945     <span class="keywordflow">if</span> (<a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(str) &gt; 0 &amp;&amp; (!<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a4832bad8845a35fc50f7a160901854a1">NIL_P</a>(limit) || <a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(str) &gt; beg || lim &lt; 0)) {
<a name="l05946"></a>05946         <span class="keywordflow">if</span> (<a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(str) == beg)
<a name="l05947"></a>05947             tmp = str_new_empty(str);
<a name="l05948"></a>05948         <span class="keywordflow">else</span>
<a name="l05949"></a>05949             tmp = <a class="code" href="../../db/d2e/intern_8h.html#aadf59e7cbba9319e199d85ef2448a970">rb_str_subseq</a>(str, beg, <a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(str)-beg);
<a name="l05950"></a>05950         <a class="code" href="../../dc/dcc/array_8c.html#a59d553a8cd781364b8bcb0deae25cca2">rb_ary_push</a>(result, tmp);
<a name="l05951"></a>05951     }
<a name="l05952"></a>05952     <span class="keywordflow">if</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a4832bad8845a35fc50f7a160901854a1">NIL_P</a>(limit) &amp;&amp; lim == 0) {
<a name="l05953"></a>05953         <span class="keywordtype">long</span> len;
<a name="l05954"></a>05954         <span class="keywordflow">while</span> ((len = <a class="code" href="../../d8/df4/generator_8h.html#ae988773ed219452578f881fc7189c486">RARRAY_LEN</a>(result)) &gt; 0 &amp;&amp;
<a name="l05955"></a>05955                (tmp = <a class="code" href="../../d8/df4/generator_8h.html#abb794fe2d7c73eea87e7ba2273939a8e">RARRAY_PTR</a>(result)[len-1], <a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(tmp) == 0))
<a name="l05956"></a>05956             <a class="code" href="../../dc/dcc/array_8c.html#aacb1ec2239256ca2e537588fc534e7b8">rb_ary_pop</a>(result);
<a name="l05957"></a>05957     }
<a name="l05958"></a>05958 
<a name="l05959"></a>05959     <span class="keywordflow">return</span> result;
<a name="l05960"></a>05960 }
<a name="l05961"></a>05961 
<a name="l05962"></a>05962 <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l05963"></a><a class="code" href="../../d1/db0/string_8c.html#ade9c904a71b1fd7381f0fb7099e0d40f">05963</a> <a class="code" href="../../db/d2e/intern_8h.html#a8e4d9d5766f302cb9bb7153a6e525b6c">rb_str_split</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str, <span class="keyword">const</span> <span class="keywordtype">char</span> *sep0)
<a name="l05964"></a>05964 {
<a name="l05965"></a>05965     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> sep;
<a name="l05966"></a>05966 
<a name="l05967"></a>05967     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a0e80f207eb41e9010ec9f0f5f9419fea">StringValue</a>(str);
<a name="l05968"></a>05968     sep = <a class="code" href="../../db/d2e/intern_8h.html#a03acd62c0b1edebbe1d61f957c19b7ac">rb_str_new2</a>(sep0);
<a name="l05969"></a>05969     <span class="keywordflow">return</span> <a class="code" href="../../d1/db0/string_8c.html#a007e56ccd20ef00c209fd4b0373aa198">rb_str_split_m</a>(1, &amp;sep, str);
<a name="l05970"></a>05970 }
<a name="l05971"></a>05971 
<a name="l05972"></a>05972 
<a name="l05973"></a>05973 <span class="comment">/*</span>
<a name="l05974"></a>05974 <span class="comment"> *  call-seq:</span>
<a name="l05975"></a>05975 <span class="comment"> *     str.each_line(separator=$/) {|substr| block }   -&gt; str</span>
<a name="l05976"></a>05976 <span class="comment"> *     str.each_line(separator=$/)                     -&gt; an_enumerator</span>
<a name="l05977"></a>05977 <span class="comment"> *</span>
<a name="l05978"></a>05978 <span class="comment"> *     str.lines(separator=$/) {|substr| block }       -&gt; str</span>
<a name="l05979"></a>05979 <span class="comment"> *     str.lines(separator=$/)                         -&gt; an_enumerator</span>
<a name="l05980"></a>05980 <span class="comment"> *</span>
<a name="l05981"></a>05981 <span class="comment"> *  Splits &lt;i&gt;str&lt;/i&gt; using the supplied parameter as the record separator</span>
<a name="l05982"></a>05982 <span class="comment"> *  (&lt;code&gt;$/&lt;/code&gt; by default), passing each substring in turn to the supplied</span>
<a name="l05983"></a>05983 <span class="comment"> *  block. If a zero-length record separator is supplied, the string is split</span>
<a name="l05984"></a>05984 <span class="comment"> *  into paragraphs delimited by multiple successive newlines.</span>
<a name="l05985"></a>05985 <span class="comment"> *</span>
<a name="l05986"></a>05986 <span class="comment"> *  If no block is given, an enumerator is returned instead.</span>
<a name="l05987"></a>05987 <span class="comment"> *</span>
<a name="l05988"></a>05988 <span class="comment"> *     print &quot;Example one\n&quot;</span>
<a name="l05989"></a>05989 <span class="comment"> *     &quot;hello\nworld&quot;.each_line {|s| p s}</span>
<a name="l05990"></a>05990 <span class="comment"> *     print &quot;Example two\n&quot;</span>
<a name="l05991"></a>05991 <span class="comment"> *     &quot;hello\nworld&quot;.each_line(&apos;l&apos;) {|s| p s}</span>
<a name="l05992"></a>05992 <span class="comment"> *     print &quot;Example three\n&quot;</span>
<a name="l05993"></a>05993 <span class="comment"> *     &quot;hello\n\n\nworld&quot;.each_line(&apos;&apos;) {|s| p s}</span>
<a name="l05994"></a>05994 <span class="comment"> *</span>
<a name="l05995"></a>05995 <span class="comment"> *  &lt;em&gt;produces:&lt;/em&gt;</span>
<a name="l05996"></a>05996 <span class="comment"> *</span>
<a name="l05997"></a>05997 <span class="comment"> *     Example one</span>
<a name="l05998"></a>05998 <span class="comment"> *     &quot;hello\n&quot;</span>
<a name="l05999"></a>05999 <span class="comment"> *     &quot;world&quot;</span>
<a name="l06000"></a>06000 <span class="comment"> *     Example two</span>
<a name="l06001"></a>06001 <span class="comment"> *     &quot;hel&quot;</span>
<a name="l06002"></a>06002 <span class="comment"> *     &quot;l&quot;</span>
<a name="l06003"></a>06003 <span class="comment"> *     &quot;o\nworl&quot;</span>
<a name="l06004"></a>06004 <span class="comment"> *     &quot;d&quot;</span>
<a name="l06005"></a>06005 <span class="comment"> *     Example three</span>
<a name="l06006"></a>06006 <span class="comment"> *     &quot;hello\n\n\n&quot;</span>
<a name="l06007"></a>06007 <span class="comment"> *     &quot;world&quot;</span>
<a name="l06008"></a>06008 <span class="comment"> */</span>
<a name="l06009"></a>06009 
<a name="l06010"></a>06010 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l06011"></a><a class="code" href="../../d1/db0/string_8c.html#af6391c6025ae46647b8af97350de1fa8">06011</a> <a class="code" href="../../d1/db0/string_8c.html#af6391c6025ae46647b8af97350de1fa8">rb_str_each_line</a>(<span class="keywordtype">int</span> <a class="code" href="../../df/d77/ruby_8c.html#ad1447518f4372828b8435ae82e48499e">argc</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> *<a class="code" href="../../df/d77/ruby_8c.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str)
<a name="l06012"></a>06012 {
<a name="l06013"></a>06013     <a class="code" href="../../d1/d7b/struct_onig_encoding_type_s_t.html">rb_encoding</a> *enc;
<a name="l06014"></a>06014     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> rs;
<a name="l06015"></a>06015     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> newline;
<a name="l06016"></a>06016     <span class="keyword">const</span> <span class="keywordtype">char</span> *p, *pend, *s, *ptr;
<a name="l06017"></a>06017     <span class="keywordtype">long</span> len, rslen;
<a name="l06018"></a>06018     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> line;
<a name="l06019"></a>06019     <span class="keywordtype">int</span> n;
<a name="l06020"></a>06020     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> orig = str;
<a name="l06021"></a>06021 
<a name="l06022"></a>06022     <span class="keywordflow">if</span> (argc == 0) {
<a name="l06023"></a>06023         rs = <a class="code" href="../../db/d2e/intern_8h.html#a6d19bb99247117d9d8b880ab14ad8d25">rb_rs</a>;
<a name="l06024"></a>06024     }
<a name="l06025"></a>06025     <span class="keywordflow">else</span> {
<a name="l06026"></a>06026         <a class="code" href="../../d7/d19/group__defmethod.html#gaa7bed88640f01bee619f85fda09d28d7">rb_scan_args</a>(argc, argv, <span class="stringliteral">&quot;01&quot;</span>, &amp;rs);
<a name="l06027"></a>06027     }
<a name="l06028"></a>06028     <a class="code" href="../../db/d2e/intern_8h.html#ad174dd963d99ac27a67c8ef9cfa1eb58">RETURN_ENUMERATOR</a>(str, argc, argv);
<a name="l06029"></a>06029     <span class="keywordflow">if</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a4832bad8845a35fc50f7a160901854a1">NIL_P</a>(rs)) {
<a name="l06030"></a>06030         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ae6bd0c4ea4db971ebd569ca8f05c6b4a">rb_yield</a>(str);
<a name="l06031"></a>06031         <span class="keywordflow">return</span> orig;
<a name="l06032"></a>06032     }
<a name="l06033"></a>06033     str = <a class="code" href="../../db/d2e/intern_8h.html#af609add406b0ef084a38f6dd615119d6">rb_str_new4</a>(str);
<a name="l06034"></a>06034     ptr = p = s = <a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(str);
<a name="l06035"></a>06035     pend = p + <a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(str);
<a name="l06036"></a>06036     len = <a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(str);
<a name="l06037"></a>06037     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a0e80f207eb41e9010ec9f0f5f9419fea">StringValue</a>(rs);
<a name="l06038"></a>06038     <span class="keywordflow">if</span> (rs == <a class="code" href="../../db/d2e/intern_8h.html#ab707a74e9c34626c05d20431ad137570">rb_default_rs</a>) {
<a name="l06039"></a>06039         enc = <a class="code" href="../../d5/db5/encoding_8c.html#ac21ed764f3b39453b6a848dd64a19585">rb_enc_get</a>(str);
<a name="l06040"></a>06040         <span class="keywordflow">while</span> (p &lt; pend) {
<a name="l06041"></a>06041             <span class="keywordtype">char</span> *p0;
<a name="l06042"></a>06042 
<a name="l06043"></a>06043             p = memchr(p, <span class="charliteral">&apos;\n&apos;</span>, pend - p);
<a name="l06044"></a>06044             <span class="keywordflow">if</span> (!p) <span class="keywordflow">break</span>;
<a name="l06045"></a>06045             p0 = <a class="code" href="../../d5/de3/encoding_8h.html#a2282b636d8d5c4c0e73d313cf97a4365">rb_enc_left_char_head</a>(s, p, pend, enc);
<a name="l06046"></a>06046             <span class="keywordflow">if</span> (!<a class="code" href="../../d5/de3/encoding_8h.html#afc1ced031c2423ff649955813776833d">rb_enc_is_newline</a>(p0, pend, enc)) {
<a name="l06047"></a>06047                 p++;
<a name="l06048"></a>06048                 <span class="keywordflow">continue</span>;
<a name="l06049"></a>06049             }
<a name="l06050"></a>06050             p = p0 + <a class="code" href="../../d5/db5/encoding_8c.html#aa91c0fa3dfdfe3c55fcaa6029c35bbb8">rb_enc_mbclen</a>(p0, pend, enc);
<a name="l06051"></a>06051             line = <a class="code" href="../../db/d2e/intern_8h.html#a70b7301e6960c402803fa81c7a0777d0">rb_str_new5</a>(str, s, p - s);
<a name="l06052"></a>06052             <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3bf9ab455a1e0e3e8cfc6ebabd8f12df">OBJ_INFECT</a>(line, str);
<a name="l06053"></a>06053             <a class="code" href="../../d1/db0/string_8c.html#a52e3afb878f939e397b9443c8e082c54">rb_enc_cr_str_copy_for_substr</a>(line, str);
<a name="l06054"></a>06054             <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ae6bd0c4ea4db971ebd569ca8f05c6b4a">rb_yield</a>(line);
<a name="l06055"></a>06055             <a class="code" href="../../d1/db0/string_8c.html#ad2935afc9682c838023639ae7332edad">str_mod_check</a>(str, ptr, len);
<a name="l06056"></a>06056             s = p;
<a name="l06057"></a>06057         }
<a name="l06058"></a>06058         <span class="keywordflow">goto</span> finish;
<a name="l06059"></a>06059     }
<a name="l06060"></a>06060 
<a name="l06061"></a>06061     enc = <a class="code" href="../../d5/db5/encoding_8c.html#a7d17d602fae27de649f9310511c03db0">rb_enc_check</a>(str, rs);
<a name="l06062"></a>06062     rslen = <a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(rs);
<a name="l06063"></a>06063     <span class="keywordflow">if</span> (rslen == 0) {
<a name="l06064"></a>06064         newline = <span class="charliteral">&apos;\n&apos;</span>;
<a name="l06065"></a>06065     }
<a name="l06066"></a>06066     <span class="keywordflow">else</span> {
<a name="l06067"></a>06067         newline = <a class="code" href="../../d5/de3/encoding_8h.html#a902fb7e618fcdb1ce1317b09a772af15">rb_enc_codepoint</a>(<a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(rs), <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a35bfa2635774977edad0a16b9fdebbaf">RSTRING_END</a>(rs), enc);
<a name="l06068"></a>06068     }
<a name="l06069"></a>06069 
<a name="l06070"></a>06070     <span class="keywordflow">while</span> (p &lt; pend) {
<a name="l06071"></a>06071         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> c = <a class="code" href="../../d5/db5/encoding_8c.html#a25e1e0b74ee98f47dd26a44bb11b7b3c">rb_enc_codepoint_len</a>(p, pend, &amp;n, enc);
<a name="l06072"></a>06072 
<a name="l06073"></a>06073       again:
<a name="l06074"></a>06074         <span class="keywordflow">if</span> (rslen == 0 &amp;&amp; c == newline) {
<a name="l06075"></a>06075             p += n;
<a name="l06076"></a>06076             <span class="keywordflow">if</span> (p &lt; pend &amp;&amp; (c = <a class="code" href="../../d5/db5/encoding_8c.html#a25e1e0b74ee98f47dd26a44bb11b7b3c">rb_enc_codepoint_len</a>(p, pend, &amp;n, enc)) != newline) {
<a name="l06077"></a>06077                 <span class="keywordflow">goto</span> again;
<a name="l06078"></a>06078             }
<a name="l06079"></a>06079             <span class="keywordflow">while</span> (p &lt; pend &amp;&amp; <a class="code" href="../../d5/de3/encoding_8h.html#a902fb7e618fcdb1ce1317b09a772af15">rb_enc_codepoint</a>(p, pend, enc) == newline) {
<a name="l06080"></a>06080                 p += n;
<a name="l06081"></a>06081             }
<a name="l06082"></a>06082             p -= n;
<a name="l06083"></a>06083         }
<a name="l06084"></a>06084         <span class="keywordflow">if</span> (c == newline &amp;&amp;
<a name="l06085"></a>06085             (rslen &lt;= 1 ||
<a name="l06086"></a>06086              (pend - p &gt;= rslen &amp;&amp; <a class="code" href="../../d5/d21/memcmp_8c.html#a1499ab2d0a3da86cbc3e688294f60a48">memcmp</a>(<a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(rs), p, rslen) == 0))) {
<a name="l06087"></a>06087             line = <a class="code" href="../../db/d2e/intern_8h.html#a70b7301e6960c402803fa81c7a0777d0">rb_str_new5</a>(str, s, p - s + (rslen ? rslen : n));
<a name="l06088"></a>06088             <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3bf9ab455a1e0e3e8cfc6ebabd8f12df">OBJ_INFECT</a>(line, str);
<a name="l06089"></a>06089             <a class="code" href="../../d1/db0/string_8c.html#a52e3afb878f939e397b9443c8e082c54">rb_enc_cr_str_copy_for_substr</a>(line, str);
<a name="l06090"></a>06090             <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ae6bd0c4ea4db971ebd569ca8f05c6b4a">rb_yield</a>(line);
<a name="l06091"></a>06091             <a class="code" href="../../d1/db0/string_8c.html#ad2935afc9682c838023639ae7332edad">str_mod_check</a>(str, ptr, len);
<a name="l06092"></a>06092             s = p + (rslen ? rslen : n);
<a name="l06093"></a>06093         }
<a name="l06094"></a>06094         p += n;
<a name="l06095"></a>06095     }
<a name="l06096"></a>06096 
<a name="l06097"></a>06097   finish:
<a name="l06098"></a>06098     <span class="keywordflow">if</span> (s != pend) {
<a name="l06099"></a>06099         line = <a class="code" href="../../db/d2e/intern_8h.html#a70b7301e6960c402803fa81c7a0777d0">rb_str_new5</a>(str, s, pend - s);
<a name="l06100"></a>06100         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3bf9ab455a1e0e3e8cfc6ebabd8f12df">OBJ_INFECT</a>(line, str);
<a name="l06101"></a>06101         <a class="code" href="../../d1/db0/string_8c.html#a52e3afb878f939e397b9443c8e082c54">rb_enc_cr_str_copy_for_substr</a>(line, str);
<a name="l06102"></a>06102         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ae6bd0c4ea4db971ebd569ca8f05c6b4a">rb_yield</a>(line);
<a name="l06103"></a>06103     }
<a name="l06104"></a>06104 
<a name="l06105"></a>06105     <span class="keywordflow">return</span> orig;
<a name="l06106"></a>06106 }
<a name="l06107"></a>06107 
<a name="l06108"></a>06108 
<a name="l06109"></a>06109 <span class="comment">/*</span>
<a name="l06110"></a>06110 <span class="comment"> *  call-seq:</span>
<a name="l06111"></a>06111 <span class="comment"> *     str.bytes {|fixnum| block }        -&gt; str</span>
<a name="l06112"></a>06112 <span class="comment"> *     str.bytes                          -&gt; an_enumerator</span>
<a name="l06113"></a>06113 <span class="comment"> *</span>
<a name="l06114"></a>06114 <span class="comment"> *     str.each_byte {|fixnum| block }    -&gt; str</span>
<a name="l06115"></a>06115 <span class="comment"> *     str.each_byte                      -&gt; an_enumerator</span>
<a name="l06116"></a>06116 <span class="comment"> *</span>
<a name="l06117"></a>06117 <span class="comment"> *  Passes each byte in &lt;i&gt;str&lt;/i&gt; to the given block, or returns</span>
<a name="l06118"></a>06118 <span class="comment"> *  an enumerator if no block is given.</span>
<a name="l06119"></a>06119 <span class="comment"> *</span>
<a name="l06120"></a>06120 <span class="comment"> *     &quot;hello&quot;.each_byte {|c| print c, &apos; &apos; }</span>
<a name="l06121"></a>06121 <span class="comment"> *</span>
<a name="l06122"></a>06122 <span class="comment"> *  &lt;em&gt;produces:&lt;/em&gt;</span>
<a name="l06123"></a>06123 <span class="comment"> *</span>
<a name="l06124"></a>06124 <span class="comment"> *     104 101 108 108 111</span>
<a name="l06125"></a>06125 <span class="comment"> */</span>
<a name="l06126"></a>06126 
<a name="l06127"></a>06127 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l06128"></a><a class="code" href="../../d1/db0/string_8c.html#af2d0acfc38b3478aee46c6941d5e1f94">06128</a> <a class="code" href="../../d1/db0/string_8c.html#af2d0acfc38b3478aee46c6941d5e1f94">rb_str_each_byte</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str)
<a name="l06129"></a>06129 {
<a name="l06130"></a>06130     <span class="keywordtype">long</span> i;
<a name="l06131"></a>06131 
<a name="l06132"></a>06132     <a class="code" href="../../db/d2e/intern_8h.html#ad174dd963d99ac27a67c8ef9cfa1eb58">RETURN_ENUMERATOR</a>(str, 0, 0);
<a name="l06133"></a>06133     <span class="keywordflow">for</span> (i=0; i&lt;<a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(str); i++) {
<a name="l06134"></a>06134         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ae6bd0c4ea4db971ebd569ca8f05c6b4a">rb_yield</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(<a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(str)[i] &amp; 0xff));
<a name="l06135"></a>06135     }
<a name="l06136"></a>06136     <span class="keywordflow">return</span> str;
<a name="l06137"></a>06137 }
<a name="l06138"></a>06138 
<a name="l06139"></a>06139 
<a name="l06140"></a>06140 <span class="comment">/*</span>
<a name="l06141"></a>06141 <span class="comment"> *  call-seq:</span>
<a name="l06142"></a>06142 <span class="comment"> *     str.chars {|cstr| block }        -&gt; str</span>
<a name="l06143"></a>06143 <span class="comment"> *     str.chars                        -&gt; an_enumerator</span>
<a name="l06144"></a>06144 <span class="comment"> *</span>
<a name="l06145"></a>06145 <span class="comment"> *     str.each_char {|cstr| block }    -&gt; str</span>
<a name="l06146"></a>06146 <span class="comment"> *     str.each_char                    -&gt; an_enumerator</span>
<a name="l06147"></a>06147 <span class="comment"> *</span>
<a name="l06148"></a>06148 <span class="comment"> *  Passes each character in &lt;i&gt;str&lt;/i&gt; to the given block, or returns</span>
<a name="l06149"></a>06149 <span class="comment"> *  an enumerator if no block is given.</span>
<a name="l06150"></a>06150 <span class="comment"> *</span>
<a name="l06151"></a>06151 <span class="comment"> *     &quot;hello&quot;.each_char {|c| print c, &apos; &apos; }</span>
<a name="l06152"></a>06152 <span class="comment"> *</span>
<a name="l06153"></a>06153 <span class="comment"> *  &lt;em&gt;produces:&lt;/em&gt;</span>
<a name="l06154"></a>06154 <span class="comment"> *</span>
<a name="l06155"></a>06155 <span class="comment"> *     h e l l o</span>
<a name="l06156"></a>06156 <span class="comment"> */</span>
<a name="l06157"></a>06157 
<a name="l06158"></a>06158 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l06159"></a><a class="code" href="../../d1/db0/string_8c.html#ac8df61f5e35fc360e2bc4b80007ccd3a">06159</a> <a class="code" href="../../d1/db0/string_8c.html#ac8df61f5e35fc360e2bc4b80007ccd3a">rb_str_each_char</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str)
<a name="l06160"></a>06160 {
<a name="l06161"></a>06161     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> orig = str;
<a name="l06162"></a>06162     <span class="keywordtype">long</span> i, len, n;
<a name="l06163"></a>06163     <span class="keyword">const</span> <span class="keywordtype">char</span> *ptr;
<a name="l06164"></a>06164     <a class="code" href="../../d1/d7b/struct_onig_encoding_type_s_t.html">rb_encoding</a> *enc;
<a name="l06165"></a>06165 
<a name="l06166"></a>06166     <a class="code" href="../../db/d2e/intern_8h.html#ad174dd963d99ac27a67c8ef9cfa1eb58">RETURN_ENUMERATOR</a>(str, 0, 0);
<a name="l06167"></a>06167     str = <a class="code" href="../../db/d2e/intern_8h.html#af609add406b0ef084a38f6dd615119d6">rb_str_new4</a>(str);
<a name="l06168"></a>06168     ptr = <a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(str);
<a name="l06169"></a>06169     len = <a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(str);
<a name="l06170"></a>06170     enc = <a class="code" href="../../d5/db5/encoding_8c.html#ac21ed764f3b39453b6a848dd64a19585">rb_enc_get</a>(str);
<a name="l06171"></a>06171     <span class="keywordflow">switch</span> (<a class="code" href="../../d5/de3/encoding_8h.html#a5901233f6f9004aebbdeccdd33cf449f">ENC_CODERANGE</a>(str)) {
<a name="l06172"></a>06172       <span class="keywordflow">case</span> <a class="code" href="../../d5/de3/encoding_8h.html#a0c81a12daaa1e57009d46b9d906957dc">ENC_CODERANGE_VALID</a>:
<a name="l06173"></a>06173       <span class="keywordflow">case</span> <a class="code" href="../../d5/de3/encoding_8h.html#a0a0e73a2d98205044e1ad19432502c5b">ENC_CODERANGE_7BIT</a>:
<a name="l06174"></a>06174         <span class="keywordflow">for</span> (i = 0; i &lt; len; i += n) {
<a name="l06175"></a>06175             n = <a class="code" href="../../d5/db5/encoding_8c.html#a405ec52962866fac46a16f02f3f92832">rb_enc_fast_mbclen</a>(ptr + i, ptr + len, enc);
<a name="l06176"></a>06176             <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ae6bd0c4ea4db971ebd569ca8f05c6b4a">rb_yield</a>(<a class="code" href="../../db/d2e/intern_8h.html#aadf59e7cbba9319e199d85ef2448a970">rb_str_subseq</a>(str, i, n));
<a name="l06177"></a>06177         }
<a name="l06178"></a>06178         <span class="keywordflow">break</span>;
<a name="l06179"></a>06179       <span class="keywordflow">default</span>:
<a name="l06180"></a>06180         <span class="keywordflow">for</span> (i = 0; i &lt; len; i += n) {
<a name="l06181"></a>06181             n = <a class="code" href="../../d5/db5/encoding_8c.html#aa91c0fa3dfdfe3c55fcaa6029c35bbb8">rb_enc_mbclen</a>(ptr + i, ptr + len, enc);
<a name="l06182"></a>06182             <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ae6bd0c4ea4db971ebd569ca8f05c6b4a">rb_yield</a>(<a class="code" href="../../db/d2e/intern_8h.html#aadf59e7cbba9319e199d85ef2448a970">rb_str_subseq</a>(str, i, n));
<a name="l06183"></a>06183         }
<a name="l06184"></a>06184     }
<a name="l06185"></a>06185     <span class="keywordflow">return</span> orig;
<a name="l06186"></a>06186 }
<a name="l06187"></a>06187 
<a name="l06188"></a>06188 <span class="comment">/*</span>
<a name="l06189"></a>06189 <span class="comment"> *  call-seq:</span>
<a name="l06190"></a>06190 <span class="comment"> *     str.codepoints {|integer| block }        -&gt; str</span>
<a name="l06191"></a>06191 <span class="comment"> *     str.codepoints                           -&gt; an_enumerator</span>
<a name="l06192"></a>06192 <span class="comment"> *</span>
<a name="l06193"></a>06193 <span class="comment"> *     str.each_codepoint {|integer| block }    -&gt; str</span>
<a name="l06194"></a>06194 <span class="comment"> *     str.each_codepoint                       -&gt; an_enumerator</span>
<a name="l06195"></a>06195 <span class="comment"> *</span>
<a name="l06196"></a>06196 <span class="comment"> *  Passes the &lt;code&gt;Integer&lt;/code&gt; ordinal of each character in &lt;i&gt;str&lt;/i&gt;,</span>
<a name="l06197"></a>06197 <span class="comment"> *  also known as a &lt;i&gt;codepoint&lt;/i&gt; when applied to Unicode strings to the</span>
<a name="l06198"></a>06198 <span class="comment"> *  given block.</span>
<a name="l06199"></a>06199 <span class="comment"> *</span>
<a name="l06200"></a>06200 <span class="comment"> *  If no block is given, an enumerator is returned instead.</span>
<a name="l06201"></a>06201 <span class="comment"> *</span>
<a name="l06202"></a>06202 <span class="comment"> *     &quot;hello\u0639&quot;.each_codepoint {|c| print c, &apos; &apos; }</span>
<a name="l06203"></a>06203 <span class="comment"> *</span>
<a name="l06204"></a>06204 <span class="comment"> *  &lt;em&gt;produces:&lt;/em&gt;</span>
<a name="l06205"></a>06205 <span class="comment"> *</span>
<a name="l06206"></a>06206 <span class="comment"> *     104 101 108 108 111 1593</span>
<a name="l06207"></a>06207 <span class="comment"> */</span>
<a name="l06208"></a>06208 
<a name="l06209"></a>06209 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l06210"></a><a class="code" href="../../d1/db0/string_8c.html#ad9bb96f603d7c8600ad6eff7ac668cb9">06210</a> <a class="code" href="../../d1/db0/string_8c.html#ad9bb96f603d7c8600ad6eff7ac668cb9">rb_str_each_codepoint</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str)
<a name="l06211"></a>06211 {
<a name="l06212"></a>06212     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> orig = str;
<a name="l06213"></a>06213     <span class="keywordtype">int</span> n;
<a name="l06214"></a>06214     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> c;
<a name="l06215"></a>06215     <span class="keyword">const</span> <span class="keywordtype">char</span> *ptr, *<a class="code" href="../../d6/d14/structre__registers.html#a1a42f8a5bcd4ac744e00132e2b80f8f0">end</a>;
<a name="l06216"></a>06216     <a class="code" href="../../d1/d7b/struct_onig_encoding_type_s_t.html">rb_encoding</a> *enc;
<a name="l06217"></a>06217 
<a name="l06218"></a>06218     <span class="keywordflow">if</span> (<a class="code" href="../../d1/db0/string_8c.html#a5ab3c8112c2ec6943bdae8a2036fca02">single_byte_optimizable</a>(str)) <span class="keywordflow">return</span> <a class="code" href="../../d1/db0/string_8c.html#af2d0acfc38b3478aee46c6941d5e1f94">rb_str_each_byte</a>(str);
<a name="l06219"></a>06219     <a class="code" href="../../db/d2e/intern_8h.html#ad174dd963d99ac27a67c8ef9cfa1eb58">RETURN_ENUMERATOR</a>(str, 0, 0);
<a name="l06220"></a>06220     str = <a class="code" href="../../db/d2e/intern_8h.html#af609add406b0ef084a38f6dd615119d6">rb_str_new4</a>(str);
<a name="l06221"></a>06221     ptr = <a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(str);
<a name="l06222"></a>06222     end = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a35bfa2635774977edad0a16b9fdebbaf">RSTRING_END</a>(str);
<a name="l06223"></a>06223     enc = <a class="code" href="../../d1/db0/string_8c.html#a123891f9f9b0c87d15621d93b4fa9c41">STR_ENC_GET</a>(str);
<a name="l06224"></a>06224     <span class="keywordflow">while</span> (ptr &lt; end) {
<a name="l06225"></a>06225         c = <a class="code" href="../../d5/db5/encoding_8c.html#a25e1e0b74ee98f47dd26a44bb11b7b3c">rb_enc_codepoint_len</a>(ptr, end, &amp;n, enc);
<a name="l06226"></a>06226         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ae6bd0c4ea4db971ebd569ca8f05c6b4a">rb_yield</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a6eb3054f7a740d26c133d34ae6afdf2c">UINT2NUM</a>(c));
<a name="l06227"></a>06227         ptr += n;
<a name="l06228"></a>06228     }
<a name="l06229"></a>06229     <span class="keywordflow">return</span> orig;
<a name="l06230"></a>06230 }
<a name="l06231"></a>06231 
<a name="l06232"></a>06232 <span class="keyword">static</span> <span class="keywordtype">long</span>
<a name="l06233"></a><a class="code" href="../../d1/db0/string_8c.html#a717a124db71ebb5ca18f638241dd2882">06233</a> <a class="code" href="../../d1/db0/string_8c.html#a717a124db71ebb5ca18f638241dd2882">chopped_length</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str)
<a name="l06234"></a>06234 {
<a name="l06235"></a>06235     <a class="code" href="../../d1/d7b/struct_onig_encoding_type_s_t.html">rb_encoding</a> *enc = <a class="code" href="../../d1/db0/string_8c.html#a123891f9f9b0c87d15621d93b4fa9c41">STR_ENC_GET</a>(str);
<a name="l06236"></a>06236     <span class="keyword">const</span> <span class="keywordtype">char</span> *p, *p2, *<a class="code" href="../../d6/d14/structre__registers.html#a4eb5968ed5cce3e60715b734f86e0b70">beg</a>, *<a class="code" href="../../d6/d14/structre__registers.html#a1a42f8a5bcd4ac744e00132e2b80f8f0">end</a>;
<a name="l06237"></a>06237 
<a name="l06238"></a>06238     beg = <a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(str);
<a name="l06239"></a>06239     end = beg + <a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(str);
<a name="l06240"></a>06240     <span class="keywordflow">if</span> (beg &gt; end) <span class="keywordflow">return</span> 0;
<a name="l06241"></a>06241     p = <a class="code" href="../../d5/de3/encoding_8h.html#a48a3264058189cf218f8e9dad6513c54">rb_enc_prev_char</a>(beg, end, end, enc);
<a name="l06242"></a>06242     <span class="keywordflow">if</span> (!p) <span class="keywordflow">return</span> 0;
<a name="l06243"></a>06243     <span class="keywordflow">if</span> (p &gt; beg &amp;&amp; <a class="code" href="../../d5/db5/encoding_8c.html#af6663b51ce857cfe600a8bc48434d6f2">rb_enc_ascget</a>(p, end, 0, enc) == <span class="charliteral">&apos;\n&apos;</span>) {
<a name="l06244"></a>06244         p2 = <a class="code" href="../../d5/de3/encoding_8h.html#a48a3264058189cf218f8e9dad6513c54">rb_enc_prev_char</a>(beg, p, end, enc);
<a name="l06245"></a>06245         <span class="keywordflow">if</span> (p2 &amp;&amp; <a class="code" href="../../d5/db5/encoding_8c.html#af6663b51ce857cfe600a8bc48434d6f2">rb_enc_ascget</a>(p2, end, 0, enc) == <span class="charliteral">&apos;\r&apos;</span>) p = p2;
<a name="l06246"></a>06246     }
<a name="l06247"></a>06247     <span class="keywordflow">return</span> p - beg;
<a name="l06248"></a>06248 }
<a name="l06249"></a>06249 
<a name="l06250"></a>06250 <span class="comment">/*</span>
<a name="l06251"></a>06251 <span class="comment"> *  call-seq:</span>
<a name="l06252"></a>06252 <span class="comment"> *     str.chop!   -&gt; str or nil</span>
<a name="l06253"></a>06253 <span class="comment"> *</span>
<a name="l06254"></a>06254 <span class="comment"> *  Processes &lt;i&gt;str&lt;/i&gt; as for &lt;code&gt;String#chop&lt;/code&gt;, returning &lt;i&gt;str&lt;/i&gt;,</span>
<a name="l06255"></a>06255 <span class="comment"> *  or &lt;code&gt;nil&lt;/code&gt; if &lt;i&gt;str&lt;/i&gt; is the empty string.  See also</span>
<a name="l06256"></a>06256 <span class="comment"> *  &lt;code&gt;String#chomp!&lt;/code&gt;.</span>
<a name="l06257"></a>06257 <span class="comment"> */</span>
<a name="l06258"></a>06258 
<a name="l06259"></a>06259 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l06260"></a><a class="code" href="../../d1/db0/string_8c.html#aa76de394f038c61cab30412163c34b0d">06260</a> <a class="code" href="../../d1/db0/string_8c.html#aa76de394f038c61cab30412163c34b0d">rb_str_chop_bang</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str)
<a name="l06261"></a>06261 {
<a name="l06262"></a>06262     <a class="code" href="../../d1/db0/string_8c.html#a106a1166130a12736cf57bacc164e4a5">str_modify_keep_cr</a>(str);
<a name="l06263"></a>06263     <span class="keywordflow">if</span> (<a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(str) &gt; 0) {
<a name="l06264"></a>06264         <span class="keywordtype">long</span> len;
<a name="l06265"></a>06265         len = <a class="code" href="../../d1/db0/string_8c.html#a717a124db71ebb5ca18f638241dd2882">chopped_length</a>(str);
<a name="l06266"></a>06266         <a class="code" href="../../d1/db0/string_8c.html#a056c7c0a74c83ccdb5a160bbdcbf8c3b">STR_SET_LEN</a>(str, len);
<a name="l06267"></a>06267         <a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(str)[len] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l06268"></a>06268         <span class="keywordflow">if</span> (<a class="code" href="../../d5/de3/encoding_8h.html#a5901233f6f9004aebbdeccdd33cf449f">ENC_CODERANGE</a>(str) != <a class="code" href="../../d5/de3/encoding_8h.html#a0a0e73a2d98205044e1ad19432502c5b">ENC_CODERANGE_7BIT</a>) {
<a name="l06269"></a>06269             <a class="code" href="../../d5/de3/encoding_8h.html#ae0d61803f8b4b76dab41851f686c6a19">ENC_CODERANGE_CLEAR</a>(str);
<a name="l06270"></a>06270         }
<a name="l06271"></a>06271         <span class="keywordflow">return</span> str;
<a name="l06272"></a>06272     }
<a name="l06273"></a>06273     <span class="keywordflow">return</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a320970f989dc8294c8203154e3db40c1">Qnil</a>;
<a name="l06274"></a>06274 }
<a name="l06275"></a>06275 
<a name="l06276"></a>06276 
<a name="l06277"></a>06277 <span class="comment">/*</span>
<a name="l06278"></a>06278 <span class="comment"> *  call-seq:</span>
<a name="l06279"></a>06279 <span class="comment"> *     str.chop   -&gt; new_str</span>
<a name="l06280"></a>06280 <span class="comment"> *</span>
<a name="l06281"></a>06281 <span class="comment"> *  Returns a new &lt;code&gt;String&lt;/code&gt; with the last character removed.  If the</span>
<a name="l06282"></a>06282 <span class="comment"> *  string ends with &lt;code&gt;\r\n&lt;/code&gt;, both characters are removed. Applying</span>
<a name="l06283"></a>06283 <span class="comment"> *  &lt;code&gt;chop&lt;/code&gt; to an empty string returns an empty</span>
<a name="l06284"></a>06284 <span class="comment"> *  string. &lt;code&gt;String#chomp&lt;/code&gt; is often a safer alternative, as it leaves</span>
<a name="l06285"></a>06285 <span class="comment"> *  the string unchanged if it doesn&apos;t end in a record separator.</span>
<a name="l06286"></a>06286 <span class="comment"> *</span>
<a name="l06287"></a>06287 <span class="comment"> *     &quot;string\r\n&quot;.chop   #=&gt; &quot;string&quot;</span>
<a name="l06288"></a>06288 <span class="comment"> *     &quot;string\n\r&quot;.chop   #=&gt; &quot;string\n&quot;</span>
<a name="l06289"></a>06289 <span class="comment"> *     &quot;string\n&quot;.chop     #=&gt; &quot;string&quot;</span>
<a name="l06290"></a>06290 <span class="comment"> *     &quot;string&quot;.chop       #=&gt; &quot;strin&quot;</span>
<a name="l06291"></a>06291 <span class="comment"> *     &quot;x&quot;.chop.chop       #=&gt; &quot;&quot;</span>
<a name="l06292"></a>06292 <span class="comment"> */</span>
<a name="l06293"></a>06293 
<a name="l06294"></a>06294 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l06295"></a><a class="code" href="../../d1/db0/string_8c.html#a8adfd665f61f583530b0798205bcd583">06295</a> <a class="code" href="../../d1/db0/string_8c.html#a8adfd665f61f583530b0798205bcd583">rb_str_chop</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str)
<a name="l06296"></a>06296 {
<a name="l06297"></a>06297     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str2 = <a class="code" href="../../db/d2e/intern_8h.html#a70b7301e6960c402803fa81c7a0777d0">rb_str_new5</a>(str, <a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(str), <a class="code" href="../../d1/db0/string_8c.html#a717a124db71ebb5ca18f638241dd2882">chopped_length</a>(str));
<a name="l06298"></a>06298     <a class="code" href="../../d1/db0/string_8c.html#a52e3afb878f939e397b9443c8e082c54">rb_enc_cr_str_copy_for_substr</a>(str2, str);
<a name="l06299"></a>06299     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3bf9ab455a1e0e3e8cfc6ebabd8f12df">OBJ_INFECT</a>(str2, str);
<a name="l06300"></a>06300     <span class="keywordflow">return</span> str2;
<a name="l06301"></a>06301 }
<a name="l06302"></a>06302 
<a name="l06303"></a>06303 
<a name="l06304"></a>06304 <span class="comment">/*</span>
<a name="l06305"></a>06305 <span class="comment"> *  call-seq:</span>
<a name="l06306"></a>06306 <span class="comment"> *     str.chomp!(separator=$/)   -&gt; str or nil</span>
<a name="l06307"></a>06307 <span class="comment"> *</span>
<a name="l06308"></a>06308 <span class="comment"> *  Modifies &lt;i&gt;str&lt;/i&gt; in place as described for &lt;code&gt;String#chomp&lt;/code&gt;,</span>
<a name="l06309"></a>06309 <span class="comment"> *  returning &lt;i&gt;str&lt;/i&gt;, or &lt;code&gt;nil&lt;/code&gt; if no modifications were made.</span>
<a name="l06310"></a>06310 <span class="comment"> */</span>
<a name="l06311"></a>06311 
<a name="l06312"></a>06312 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l06313"></a><a class="code" href="../../d1/db0/string_8c.html#a3a3fe1c668344e4284c237cecbc02231">06313</a> <a class="code" href="../../d1/db0/string_8c.html#a3a3fe1c668344e4284c237cecbc02231">rb_str_chomp_bang</a>(<span class="keywordtype">int</span> <a class="code" href="../../df/d77/ruby_8c.html#ad1447518f4372828b8435ae82e48499e">argc</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> *<a class="code" href="../../df/d77/ruby_8c.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str)
<a name="l06314"></a>06314 {
<a name="l06315"></a>06315     <a class="code" href="../../d1/d7b/struct_onig_encoding_type_s_t.html">rb_encoding</a> *enc;
<a name="l06316"></a>06316     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> rs;
<a name="l06317"></a>06317     <span class="keywordtype">int</span> newline;
<a name="l06318"></a>06318     <span class="keywordtype">char</span> *p, *pp, *e;
<a name="l06319"></a>06319     <span class="keywordtype">long</span> len, rslen;
<a name="l06320"></a>06320 
<a name="l06321"></a>06321     <a class="code" href="../../d1/db0/string_8c.html#a106a1166130a12736cf57bacc164e4a5">str_modify_keep_cr</a>(str);
<a name="l06322"></a>06322     len = <a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(str);
<a name="l06323"></a>06323     <span class="keywordflow">if</span> (len == 0) <span class="keywordflow">return</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a320970f989dc8294c8203154e3db40c1">Qnil</a>;
<a name="l06324"></a>06324     p = <a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(str);
<a name="l06325"></a>06325     e = p + len;
<a name="l06326"></a>06326     <span class="keywordflow">if</span> (argc == 0) {
<a name="l06327"></a>06327         rs = <a class="code" href="../../db/d2e/intern_8h.html#a6d19bb99247117d9d8b880ab14ad8d25">rb_rs</a>;
<a name="l06328"></a>06328         <span class="keywordflow">if</span> (rs == <a class="code" href="../../db/d2e/intern_8h.html#ab707a74e9c34626c05d20431ad137570">rb_default_rs</a>) {
<a name="l06329"></a>06329           smart_chomp:
<a name="l06330"></a>06330             enc = <a class="code" href="../../d5/db5/encoding_8c.html#ac21ed764f3b39453b6a848dd64a19585">rb_enc_get</a>(str);
<a name="l06331"></a>06331             <span class="keywordflow">if</span> (<a class="code" href="../../d5/de3/encoding_8h.html#aaffb0395eb9bf0b3ba3175fa5c9c1615">rb_enc_mbminlen</a>(enc) &gt; 1) {
<a name="l06332"></a>06332                 pp = <a class="code" href="../../d5/de3/encoding_8h.html#a2282b636d8d5c4c0e73d313cf97a4365">rb_enc_left_char_head</a>(p, e-<a class="code" href="../../d5/de3/encoding_8h.html#aaffb0395eb9bf0b3ba3175fa5c9c1615">rb_enc_mbminlen</a>(enc), e, enc);
<a name="l06333"></a>06333                 <span class="keywordflow">if</span> (<a class="code" href="../../d5/de3/encoding_8h.html#afc1ced031c2423ff649955813776833d">rb_enc_is_newline</a>(pp, e, enc)) {
<a name="l06334"></a>06334                     e = pp;
<a name="l06335"></a>06335                 }
<a name="l06336"></a>06336                 pp = e - <a class="code" href="../../d5/de3/encoding_8h.html#aaffb0395eb9bf0b3ba3175fa5c9c1615">rb_enc_mbminlen</a>(enc);
<a name="l06337"></a>06337                 <span class="keywordflow">if</span> (pp &gt;= p) {
<a name="l06338"></a>06338                     pp = <a class="code" href="../../d5/de3/encoding_8h.html#a2282b636d8d5c4c0e73d313cf97a4365">rb_enc_left_char_head</a>(p, pp, e, enc);
<a name="l06339"></a>06339                     <span class="keywordflow">if</span> (<a class="code" href="../../d5/db5/encoding_8c.html#af6663b51ce857cfe600a8bc48434d6f2">rb_enc_ascget</a>(pp, e, 0, enc) == <span class="charliteral">&apos;\r&apos;</span>) {
<a name="l06340"></a>06340                         e = pp;
<a name="l06341"></a>06341                     }
<a name="l06342"></a>06342                 }
<a name="l06343"></a>06343                 <span class="keywordflow">if</span> (e == <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a35bfa2635774977edad0a16b9fdebbaf">RSTRING_END</a>(str)) {
<a name="l06344"></a>06344                     <span class="keywordflow">return</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a320970f989dc8294c8203154e3db40c1">Qnil</a>;
<a name="l06345"></a>06345                 }
<a name="l06346"></a>06346                 len = e - <a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(str);
<a name="l06347"></a>06347                 <a class="code" href="../../d1/db0/string_8c.html#a056c7c0a74c83ccdb5a160bbdcbf8c3b">STR_SET_LEN</a>(str, len);
<a name="l06348"></a>06348             }
<a name="l06349"></a>06349             <span class="keywordflow">else</span> {
<a name="l06350"></a>06350                 <span class="keywordflow">if</span> (<a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(str)[len-1] == <span class="charliteral">&apos;\n&apos;</span>) {
<a name="l06351"></a>06351                     <a class="code" href="../../d1/db0/string_8c.html#ad6f5ad03ae5244b7ac7cab569eac3e65">STR_DEC_LEN</a>(str);
<a name="l06352"></a>06352                     <span class="keywordflow">if</span> (<a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(str) &gt; 0 &amp;&amp;
<a name="l06353"></a>06353                         <a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(str)[<a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(str)-1] == <span class="charliteral">&apos;\r&apos;</span>) {
<a name="l06354"></a>06354                         <a class="code" href="../../d1/db0/string_8c.html#ad6f5ad03ae5244b7ac7cab569eac3e65">STR_DEC_LEN</a>(str);
<a name="l06355"></a>06355                     }
<a name="l06356"></a>06356                 }
<a name="l06357"></a>06357                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(str)[len-1] == <span class="charliteral">&apos;\r&apos;</span>) {
<a name="l06358"></a>06358                     <a class="code" href="../../d1/db0/string_8c.html#ad6f5ad03ae5244b7ac7cab569eac3e65">STR_DEC_LEN</a>(str);
<a name="l06359"></a>06359                 }
<a name="l06360"></a>06360                 <span class="keywordflow">else</span> {
<a name="l06361"></a>06361                     <span class="keywordflow">return</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a320970f989dc8294c8203154e3db40c1">Qnil</a>;
<a name="l06362"></a>06362                 }
<a name="l06363"></a>06363             }
<a name="l06364"></a>06364             <a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(str)[<a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(str)] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l06365"></a>06365             <span class="keywordflow">return</span> str;
<a name="l06366"></a>06366         }
<a name="l06367"></a>06367     }
<a name="l06368"></a>06368     <span class="keywordflow">else</span> {
<a name="l06369"></a>06369         <a class="code" href="../../d7/d19/group__defmethod.html#gaa7bed88640f01bee619f85fda09d28d7">rb_scan_args</a>(argc, argv, <span class="stringliteral">&quot;01&quot;</span>, &amp;rs);
<a name="l06370"></a>06370     }
<a name="l06371"></a>06371     <span class="keywordflow">if</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a4832bad8845a35fc50f7a160901854a1">NIL_P</a>(rs)) <span class="keywordflow">return</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a320970f989dc8294c8203154e3db40c1">Qnil</a>;
<a name="l06372"></a>06372     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a0e80f207eb41e9010ec9f0f5f9419fea">StringValue</a>(rs);
<a name="l06373"></a>06373     rslen = <a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(rs);
<a name="l06374"></a>06374     <span class="keywordflow">if</span> (rslen == 0) {
<a name="l06375"></a>06375         <span class="keywordflow">while</span> (len&gt;0 &amp;&amp; p[len-1] == <span class="charliteral">&apos;\n&apos;</span>) {
<a name="l06376"></a>06376             len--;
<a name="l06377"></a>06377             <span class="keywordflow">if</span> (len&gt;0 &amp;&amp; p[len-1] == <span class="charliteral">&apos;\r&apos;</span>)
<a name="l06378"></a>06378                 len--;
<a name="l06379"></a>06379         }
<a name="l06380"></a>06380         <span class="keywordflow">if</span> (len &lt; <a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(str)) {
<a name="l06381"></a>06381             <a class="code" href="../../d1/db0/string_8c.html#a056c7c0a74c83ccdb5a160bbdcbf8c3b">STR_SET_LEN</a>(str, len);
<a name="l06382"></a>06382             <a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(str)[len] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l06383"></a>06383             <span class="keywordflow">return</span> str;
<a name="l06384"></a>06384         }
<a name="l06385"></a>06385         <span class="keywordflow">return</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a320970f989dc8294c8203154e3db40c1">Qnil</a>;
<a name="l06386"></a>06386     }
<a name="l06387"></a>06387     <span class="keywordflow">if</span> (rslen &gt; len) <span class="keywordflow">return</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a320970f989dc8294c8203154e3db40c1">Qnil</a>;
<a name="l06388"></a>06388     newline = <a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(rs)[rslen-1];
<a name="l06389"></a>06389     <span class="keywordflow">if</span> (rslen == 1 &amp;&amp; newline == <span class="charliteral">&apos;\n&apos;</span>)
<a name="l06390"></a>06390         <span class="keywordflow">goto</span> smart_chomp;
<a name="l06391"></a>06391 
<a name="l06392"></a>06392     enc = <a class="code" href="../../d5/db5/encoding_8c.html#a7d17d602fae27de649f9310511c03db0">rb_enc_check</a>(str, rs);
<a name="l06393"></a>06393     <span class="keywordflow">if</span> (<a class="code" href="../../d1/db0/string_8c.html#a8de8d2f6479866e76eeb56f5044fa583">is_broken_string</a>(rs)) {
<a name="l06394"></a>06394         <span class="keywordflow">return</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a320970f989dc8294c8203154e3db40c1">Qnil</a>;
<a name="l06395"></a>06395     }
<a name="l06396"></a>06396     pp = e - rslen;
<a name="l06397"></a>06397     <span class="keywordflow">if</span> (p[len-1] == newline &amp;&amp;
<a name="l06398"></a>06398         (rslen &lt;= 1 ||
<a name="l06399"></a>06399          <a class="code" href="../../d5/d21/memcmp_8c.html#a1499ab2d0a3da86cbc3e688294f60a48">memcmp</a>(<a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(rs), pp, rslen) == 0)) {
<a name="l06400"></a>06400         <span class="keywordflow">if</span> (<a class="code" href="../../d5/de3/encoding_8h.html#a2282b636d8d5c4c0e73d313cf97a4365">rb_enc_left_char_head</a>(p, pp, e, enc) != pp)
<a name="l06401"></a>06401             <span class="keywordflow">return</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a320970f989dc8294c8203154e3db40c1">Qnil</a>;
<a name="l06402"></a>06402         <span class="keywordflow">if</span> (<a class="code" href="../../d5/de3/encoding_8h.html#a5901233f6f9004aebbdeccdd33cf449f">ENC_CODERANGE</a>(str) != <a class="code" href="../../d5/de3/encoding_8h.html#a0a0e73a2d98205044e1ad19432502c5b">ENC_CODERANGE_7BIT</a>) {
<a name="l06403"></a>06403             <a class="code" href="../../d5/de3/encoding_8h.html#ae0d61803f8b4b76dab41851f686c6a19">ENC_CODERANGE_CLEAR</a>(str);
<a name="l06404"></a>06404         }
<a name="l06405"></a>06405         <a class="code" href="../../d1/db0/string_8c.html#a056c7c0a74c83ccdb5a160bbdcbf8c3b">STR_SET_LEN</a>(str, <a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(str) - rslen);
<a name="l06406"></a>06406         <a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(str)[<a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(str)] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l06407"></a>06407         <span class="keywordflow">return</span> str;
<a name="l06408"></a>06408     }
<a name="l06409"></a>06409     <span class="keywordflow">return</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a320970f989dc8294c8203154e3db40c1">Qnil</a>;
<a name="l06410"></a>06410 }
<a name="l06411"></a>06411 
<a name="l06412"></a>06412 
<a name="l06413"></a>06413 <span class="comment">/*</span>
<a name="l06414"></a>06414 <span class="comment"> *  call-seq:</span>
<a name="l06415"></a>06415 <span class="comment"> *     str.chomp(separator=$/)   -&gt; new_str</span>
<a name="l06416"></a>06416 <span class="comment"> *</span>
<a name="l06417"></a>06417 <span class="comment"> *  Returns a new &lt;code&gt;String&lt;/code&gt; with the given record separator removed</span>
<a name="l06418"></a>06418 <span class="comment"> *  from the end of &lt;i&gt;str&lt;/i&gt; (if present). If &lt;code&gt;$/&lt;/code&gt; has not been</span>
<a name="l06419"></a>06419 <span class="comment"> *  changed from the default Ruby record separator, then &lt;code&gt;chomp&lt;/code&gt; also</span>
<a name="l06420"></a>06420 <span class="comment"> *  removes carriage return characters (that is it will remove &lt;code&gt;\n&lt;/code&gt;,</span>
<a name="l06421"></a>06421 <span class="comment"> *  &lt;code&gt;\r&lt;/code&gt;, and &lt;code&gt;\r\n&lt;/code&gt;).</span>
<a name="l06422"></a>06422 <span class="comment"> *</span>
<a name="l06423"></a>06423 <span class="comment"> *     &quot;hello&quot;.chomp            #=&gt; &quot;hello&quot;</span>
<a name="l06424"></a>06424 <span class="comment"> *     &quot;hello\n&quot;.chomp          #=&gt; &quot;hello&quot;</span>
<a name="l06425"></a>06425 <span class="comment"> *     &quot;hello\r\n&quot;.chomp        #=&gt; &quot;hello&quot;</span>
<a name="l06426"></a>06426 <span class="comment"> *     &quot;hello\n\r&quot;.chomp        #=&gt; &quot;hello\n&quot;</span>
<a name="l06427"></a>06427 <span class="comment"> *     &quot;hello\r&quot;.chomp          #=&gt; &quot;hello&quot;</span>
<a name="l06428"></a>06428 <span class="comment"> *     &quot;hello \n there&quot;.chomp   #=&gt; &quot;hello \n there&quot;</span>
<a name="l06429"></a>06429 <span class="comment"> *     &quot;hello&quot;.chomp(&quot;llo&quot;)     #=&gt; &quot;he&quot;</span>
<a name="l06430"></a>06430 <span class="comment"> */</span>
<a name="l06431"></a>06431 
<a name="l06432"></a>06432 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l06433"></a><a class="code" href="../../d1/db0/string_8c.html#aa040b801e706ed502b364a71a8e1016b">06433</a> <a class="code" href="../../d1/db0/string_8c.html#aa040b801e706ed502b364a71a8e1016b">rb_str_chomp</a>(<span class="keywordtype">int</span> <a class="code" href="../../df/d77/ruby_8c.html#ad1447518f4372828b8435ae82e48499e">argc</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> *<a class="code" href="../../df/d77/ruby_8c.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str)
<a name="l06434"></a>06434 {
<a name="l06435"></a>06435     str = <a class="code" href="../../db/d2e/intern_8h.html#ae2843c766c24b80116bb127ebf22d5bf">rb_str_dup</a>(str);
<a name="l06436"></a>06436     <a class="code" href="../../d1/db0/string_8c.html#a3a3fe1c668344e4284c237cecbc02231">rb_str_chomp_bang</a>(argc, argv, str);
<a name="l06437"></a>06437     <span class="keywordflow">return</span> str;
<a name="l06438"></a>06438 }
<a name="l06439"></a>06439 
<a name="l06440"></a>06440 <span class="comment">/*</span>
<a name="l06441"></a>06441 <span class="comment"> *  call-seq:</span>
<a name="l06442"></a>06442 <span class="comment"> *     str.lstrip!   -&gt; self or nil</span>
<a name="l06443"></a>06443 <span class="comment"> *</span>
<a name="l06444"></a>06444 <span class="comment"> *  Removes leading whitespace from &lt;i&gt;str&lt;/i&gt;, returning &lt;code&gt;nil&lt;/code&gt; if no</span>
<a name="l06445"></a>06445 <span class="comment"> *  change was made. See also &lt;code&gt;String#rstrip!&lt;/code&gt; and</span>
<a name="l06446"></a>06446 <span class="comment"> *  &lt;code&gt;String#strip!&lt;/code&gt;.</span>
<a name="l06447"></a>06447 <span class="comment"> *</span>
<a name="l06448"></a>06448 <span class="comment"> *     &quot;  hello  &quot;.lstrip   #=&gt; &quot;hello  &quot;</span>
<a name="l06449"></a>06449 <span class="comment"> *     &quot;hello&quot;.lstrip!      #=&gt; nil</span>
<a name="l06450"></a>06450 <span class="comment"> */</span>
<a name="l06451"></a>06451 
<a name="l06452"></a>06452 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l06453"></a><a class="code" href="../../d1/db0/string_8c.html#a64c9a1c890b80072e995a69c54ae3260">06453</a> <a class="code" href="../../d1/db0/string_8c.html#a64c9a1c890b80072e995a69c54ae3260">rb_str_lstrip_bang</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str)
<a name="l06454"></a>06454 {
<a name="l06455"></a>06455     <a class="code" href="../../d1/d7b/struct_onig_encoding_type_s_t.html">rb_encoding</a> *enc;
<a name="l06456"></a>06456     <span class="keywordtype">char</span> *s, *t, *e;
<a name="l06457"></a>06457 
<a name="l06458"></a>06458     <a class="code" href="../../d1/db0/string_8c.html#a106a1166130a12736cf57bacc164e4a5">str_modify_keep_cr</a>(str);
<a name="l06459"></a>06459     enc = <a class="code" href="../../d1/db0/string_8c.html#a123891f9f9b0c87d15621d93b4fa9c41">STR_ENC_GET</a>(str);
<a name="l06460"></a>06460     s = <a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(str);
<a name="l06461"></a>06461     <span class="keywordflow">if</span> (!s || <a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(str) == 0) <span class="keywordflow">return</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a320970f989dc8294c8203154e3db40c1">Qnil</a>;
<a name="l06462"></a>06462     e = t = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a35bfa2635774977edad0a16b9fdebbaf">RSTRING_END</a>(str);
<a name="l06463"></a>06463     <span class="comment">/* remove spaces at head */</span>
<a name="l06464"></a>06464     <span class="keywordflow">while</span> (s &lt; e) {
<a name="l06465"></a>06465         <span class="keywordtype">int</span> n;
<a name="l06466"></a>06466         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cc = <a class="code" href="../../d5/db5/encoding_8c.html#a25e1e0b74ee98f47dd26a44bb11b7b3c">rb_enc_codepoint_len</a>(s, e, &amp;n, enc);
<a name="l06467"></a>06467 
<a name="l06468"></a>06468         <span class="keywordflow">if</span> (!<a class="code" href="../../d5/db5/encoding_8c.html#a89eaa268f33c65143f581dc2bcf50f22">rb_isspace</a>(cc)) <span class="keywordflow">break</span>;
<a name="l06469"></a>06469         s += n;
<a name="l06470"></a>06470     }
<a name="l06471"></a>06471 
<a name="l06472"></a>06472     <span class="keywordflow">if</span> (s &gt; <a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(str)) {
<a name="l06473"></a>06473         <a class="code" href="../../d1/db0/string_8c.html#a056c7c0a74c83ccdb5a160bbdcbf8c3b">STR_SET_LEN</a>(str, t-s);
<a name="l06474"></a>06474         <a class="code" href="../../d3/d90/missing_8h.html#a809a3e9326a0d3e5aa549b17085b057d">memmove</a>(<a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(str), s, <a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(str));
<a name="l06475"></a>06475         <a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(str)[<a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(str)] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l06476"></a>06476         <span class="keywordflow">return</span> str;
<a name="l06477"></a>06477     }
<a name="l06478"></a>06478     <span class="keywordflow">return</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a320970f989dc8294c8203154e3db40c1">Qnil</a>;
<a name="l06479"></a>06479 }
<a name="l06480"></a>06480 
<a name="l06481"></a>06481 
<a name="l06482"></a>06482 <span class="comment">/*</span>
<a name="l06483"></a>06483 <span class="comment"> *  call-seq:</span>
<a name="l06484"></a>06484 <span class="comment"> *     str.lstrip   -&gt; new_str</span>
<a name="l06485"></a>06485 <span class="comment"> *</span>
<a name="l06486"></a>06486 <span class="comment"> *  Returns a copy of &lt;i&gt;str&lt;/i&gt; with leading whitespace removed. See also</span>
<a name="l06487"></a>06487 <span class="comment"> *  &lt;code&gt;String#rstrip&lt;/code&gt; and &lt;code&gt;String#strip&lt;/code&gt;.</span>
<a name="l06488"></a>06488 <span class="comment"> *</span>
<a name="l06489"></a>06489 <span class="comment"> *     &quot;  hello  &quot;.lstrip   #=&gt; &quot;hello  &quot;</span>
<a name="l06490"></a>06490 <span class="comment"> *     &quot;hello&quot;.lstrip       #=&gt; &quot;hello&quot;</span>
<a name="l06491"></a>06491 <span class="comment"> */</span>
<a name="l06492"></a>06492 
<a name="l06493"></a>06493 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l06494"></a><a class="code" href="../../d1/db0/string_8c.html#a0568d895dea57af16af4c08a1e356d4d">06494</a> <a class="code" href="../../d1/db0/string_8c.html#a0568d895dea57af16af4c08a1e356d4d">rb_str_lstrip</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str)
<a name="l06495"></a>06495 {
<a name="l06496"></a>06496     str = <a class="code" href="../../db/d2e/intern_8h.html#ae2843c766c24b80116bb127ebf22d5bf">rb_str_dup</a>(str);
<a name="l06497"></a>06497     <a class="code" href="../../d1/db0/string_8c.html#a64c9a1c890b80072e995a69c54ae3260">rb_str_lstrip_bang</a>(str);
<a name="l06498"></a>06498     <span class="keywordflow">return</span> str;
<a name="l06499"></a>06499 }
<a name="l06500"></a>06500 
<a name="l06501"></a>06501 
<a name="l06502"></a>06502 <span class="comment">/*</span>
<a name="l06503"></a>06503 <span class="comment"> *  call-seq:</span>
<a name="l06504"></a>06504 <span class="comment"> *     str.rstrip!   -&gt; self or nil</span>
<a name="l06505"></a>06505 <span class="comment"> *</span>
<a name="l06506"></a>06506 <span class="comment"> *  Removes trailing whitespace from &lt;i&gt;str&lt;/i&gt;, returning &lt;code&gt;nil&lt;/code&gt; if</span>
<a name="l06507"></a>06507 <span class="comment"> *  no change was made. See also &lt;code&gt;String#lstrip!&lt;/code&gt; and</span>
<a name="l06508"></a>06508 <span class="comment"> *  &lt;code&gt;String#strip!&lt;/code&gt;.</span>
<a name="l06509"></a>06509 <span class="comment"> *</span>
<a name="l06510"></a>06510 <span class="comment"> *     &quot;  hello  &quot;.rstrip   #=&gt; &quot;  hello&quot;</span>
<a name="l06511"></a>06511 <span class="comment"> *     &quot;hello&quot;.rstrip!      #=&gt; nil</span>
<a name="l06512"></a>06512 <span class="comment"> */</span>
<a name="l06513"></a>06513 
<a name="l06514"></a>06514 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l06515"></a><a class="code" href="../../d1/db0/string_8c.html#a65ffd12d67cff340b77f4488d47af4d6">06515</a> <a class="code" href="../../d1/db0/string_8c.html#a65ffd12d67cff340b77f4488d47af4d6">rb_str_rstrip_bang</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str)
<a name="l06516"></a>06516 {
<a name="l06517"></a>06517     <a class="code" href="../../d1/d7b/struct_onig_encoding_type_s_t.html">rb_encoding</a> *enc;
<a name="l06518"></a>06518     <span class="keywordtype">char</span> *s, *t, *e;
<a name="l06519"></a>06519 
<a name="l06520"></a>06520     <a class="code" href="../../d1/db0/string_8c.html#a106a1166130a12736cf57bacc164e4a5">str_modify_keep_cr</a>(str);
<a name="l06521"></a>06521     enc = <a class="code" href="../../d1/db0/string_8c.html#a123891f9f9b0c87d15621d93b4fa9c41">STR_ENC_GET</a>(str);
<a name="l06522"></a>06522     <a class="code" href="../../d1/db0/string_8c.html#aafaaea3c592858dcd69e637d9a575233">rb_str_check_dummy_enc</a>(enc);
<a name="l06523"></a>06523     s = <a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(str);
<a name="l06524"></a>06524     <span class="keywordflow">if</span> (!s || <a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(str) == 0) <span class="keywordflow">return</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a320970f989dc8294c8203154e3db40c1">Qnil</a>;
<a name="l06525"></a>06525     t = e = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a35bfa2635774977edad0a16b9fdebbaf">RSTRING_END</a>(str);
<a name="l06526"></a>06526 
<a name="l06527"></a>06527     <span class="comment">/* remove trailing spaces or &apos;\0&apos;s */</span>
<a name="l06528"></a>06528     <span class="keywordflow">if</span> (<a class="code" href="../../d1/db0/string_8c.html#a5ab3c8112c2ec6943bdae8a2036fca02">single_byte_optimizable</a>(str)) {
<a name="l06529"></a>06529         <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> c;
<a name="l06530"></a>06530         <span class="keywordflow">while</span> (s &lt; t &amp;&amp; ((c = *(t-1)) == <span class="charliteral">&apos;\0&apos;</span> || <a class="code" href="../../d1/db0/string_8c.html#a791bdba5e287dd4527ed38f210c96ba2">ascii_isspace</a>(c))) t--;
<a name="l06531"></a>06531     }
<a name="l06532"></a>06532     <span class="keywordflow">else</span> {
<a name="l06533"></a>06533         <span class="keywordtype">char</span> *tp;
<a name="l06534"></a>06534 
<a name="l06535"></a>06535         <span class="keywordflow">while</span> ((tp = <a class="code" href="../../d5/de3/encoding_8h.html#a48a3264058189cf218f8e9dad6513c54">rb_enc_prev_char</a>(s, t, e, enc)) != <a class="code" href="../../d3/d09/ripper_8y.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l06536"></a>06536             <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> c = <a class="code" href="../../d5/de3/encoding_8h.html#a902fb7e618fcdb1ce1317b09a772af15">rb_enc_codepoint</a>(tp, e, enc);
<a name="l06537"></a>06537             <span class="keywordflow">if</span> (c &amp;&amp; !<a class="code" href="../../d5/db5/encoding_8c.html#a89eaa268f33c65143f581dc2bcf50f22">rb_isspace</a>(c)) <span class="keywordflow">break</span>;
<a name="l06538"></a>06538             t = tp;
<a name="l06539"></a>06539         }
<a name="l06540"></a>06540     }
<a name="l06541"></a>06541     <span class="keywordflow">if</span> (t &lt; e) {
<a name="l06542"></a>06542         <span class="keywordtype">long</span> len = t-<a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(str);
<a name="l06543"></a>06543 
<a name="l06544"></a>06544         <a class="code" href="../../d1/db0/string_8c.html#a056c7c0a74c83ccdb5a160bbdcbf8c3b">STR_SET_LEN</a>(str, len);
<a name="l06545"></a>06545         <a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(str)[len] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l06546"></a>06546         <span class="keywordflow">return</span> str;
<a name="l06547"></a>06547     }
<a name="l06548"></a>06548     <span class="keywordflow">return</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a320970f989dc8294c8203154e3db40c1">Qnil</a>;
<a name="l06549"></a>06549 }
<a name="l06550"></a>06550 
<a name="l06551"></a>06551 
<a name="l06552"></a>06552 <span class="comment">/*</span>
<a name="l06553"></a>06553 <span class="comment"> *  call-seq:</span>
<a name="l06554"></a>06554 <span class="comment"> *     str.rstrip   -&gt; new_str</span>
<a name="l06555"></a>06555 <span class="comment"> *</span>
<a name="l06556"></a>06556 <span class="comment"> *  Returns a copy of &lt;i&gt;str&lt;/i&gt; with trailing whitespace removed. See also</span>
<a name="l06557"></a>06557 <span class="comment"> *  &lt;code&gt;String#lstrip&lt;/code&gt; and &lt;code&gt;String#strip&lt;/code&gt;.</span>
<a name="l06558"></a>06558 <span class="comment"> *</span>
<a name="l06559"></a>06559 <span class="comment"> *     &quot;  hello  &quot;.rstrip   #=&gt; &quot;  hello&quot;</span>
<a name="l06560"></a>06560 <span class="comment"> *     &quot;hello&quot;.rstrip       #=&gt; &quot;hello&quot;</span>
<a name="l06561"></a>06561 <span class="comment"> */</span>
<a name="l06562"></a>06562 
<a name="l06563"></a>06563 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l06564"></a><a class="code" href="../../d1/db0/string_8c.html#a322ea113ef588fd97996abb27cf6ec0f">06564</a> <a class="code" href="../../d1/db0/string_8c.html#a322ea113ef588fd97996abb27cf6ec0f">rb_str_rstrip</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str)
<a name="l06565"></a>06565 {
<a name="l06566"></a>06566     str = <a class="code" href="../../db/d2e/intern_8h.html#ae2843c766c24b80116bb127ebf22d5bf">rb_str_dup</a>(str);
<a name="l06567"></a>06567     <a class="code" href="../../d1/db0/string_8c.html#a65ffd12d67cff340b77f4488d47af4d6">rb_str_rstrip_bang</a>(str);
<a name="l06568"></a>06568     <span class="keywordflow">return</span> str;
<a name="l06569"></a>06569 }
<a name="l06570"></a>06570 
<a name="l06571"></a>06571 
<a name="l06572"></a>06572 <span class="comment">/*</span>
<a name="l06573"></a>06573 <span class="comment"> *  call-seq:</span>
<a name="l06574"></a>06574 <span class="comment"> *     str.strip!   -&gt; str or nil</span>
<a name="l06575"></a>06575 <span class="comment"> *</span>
<a name="l06576"></a>06576 <span class="comment"> *  Removes leading and trailing whitespace from &lt;i&gt;str&lt;/i&gt;. Returns</span>
<a name="l06577"></a>06577 <span class="comment"> *  &lt;code&gt;nil&lt;/code&gt; if &lt;i&gt;str&lt;/i&gt; was not altered.</span>
<a name="l06578"></a>06578 <span class="comment"> */</span>
<a name="l06579"></a>06579 
<a name="l06580"></a>06580 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l06581"></a><a class="code" href="../../d1/db0/string_8c.html#a3f281ac7d159446c04331fe417c238f2">06581</a> <a class="code" href="../../d1/db0/string_8c.html#a3f281ac7d159446c04331fe417c238f2">rb_str_strip_bang</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str)
<a name="l06582"></a>06582 {
<a name="l06583"></a>06583     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> l = <a class="code" href="../../d1/db0/string_8c.html#a64c9a1c890b80072e995a69c54ae3260">rb_str_lstrip_bang</a>(str);
<a name="l06584"></a>06584     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> r = <a class="code" href="../../d1/db0/string_8c.html#a65ffd12d67cff340b77f4488d47af4d6">rb_str_rstrip_bang</a>(str);
<a name="l06585"></a>06585 
<a name="l06586"></a>06586     <span class="keywordflow">if</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a4832bad8845a35fc50f7a160901854a1">NIL_P</a>(l) &amp;&amp; <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a4832bad8845a35fc50f7a160901854a1">NIL_P</a>(r)) <span class="keywordflow">return</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a320970f989dc8294c8203154e3db40c1">Qnil</a>;
<a name="l06587"></a>06587     <span class="keywordflow">return</span> str;
<a name="l06588"></a>06588 }
<a name="l06589"></a>06589 
<a name="l06590"></a>06590 
<a name="l06591"></a>06591 <span class="comment">/*</span>
<a name="l06592"></a>06592 <span class="comment"> *  call-seq:</span>
<a name="l06593"></a>06593 <span class="comment"> *     str.strip   -&gt; new_str</span>
<a name="l06594"></a>06594 <span class="comment"> *</span>
<a name="l06595"></a>06595 <span class="comment"> *  Returns a copy of &lt;i&gt;str&lt;/i&gt; with leading and trailing whitespace removed.</span>
<a name="l06596"></a>06596 <span class="comment"> *</span>
<a name="l06597"></a>06597 <span class="comment"> *     &quot;    hello    &quot;.strip   #=&gt; &quot;hello&quot;</span>
<a name="l06598"></a>06598 <span class="comment"> *     &quot;\tgoodbye\r\n&quot;.strip   #=&gt; &quot;goodbye&quot;</span>
<a name="l06599"></a>06599 <span class="comment"> */</span>
<a name="l06600"></a>06600 
<a name="l06601"></a>06601 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l06602"></a><a class="code" href="../../d1/db0/string_8c.html#a551a85a75ef5bf6af00a5c82a4c159f4">06602</a> <a class="code" href="../../d1/db0/string_8c.html#a551a85a75ef5bf6af00a5c82a4c159f4">rb_str_strip</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str)
<a name="l06603"></a>06603 {
<a name="l06604"></a>06604     str = <a class="code" href="../../db/d2e/intern_8h.html#ae2843c766c24b80116bb127ebf22d5bf">rb_str_dup</a>(str);
<a name="l06605"></a>06605     <a class="code" href="../../d1/db0/string_8c.html#a3f281ac7d159446c04331fe417c238f2">rb_str_strip_bang</a>(str);
<a name="l06606"></a>06606     <span class="keywordflow">return</span> str;
<a name="l06607"></a>06607 }
<a name="l06608"></a>06608 
<a name="l06609"></a>06609 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l06610"></a><a class="code" href="../../d1/db0/string_8c.html#ae26280e3f7262763e181dea4b870ac70">06610</a> <a class="code" href="../../d1/db0/string_8c.html#ae26280e3f7262763e181dea4b870ac70">scan_once</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> pat, <span class="keywordtype">long</span> *start)
<a name="l06611"></a>06611 {
<a name="l06612"></a>06612     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <a class="code" href="../../d8/d90/nkf_8c.html#a5ea5ac7abf5cce39283e422add1067d5">result</a>, <a class="code" href="../../dd/d9f/date__parse_8c.html#aafe6a0803e756e59e5af70fdb2dcc912">match</a>;
<a name="l06613"></a>06613     <span class="keyword">struct </span><a class="code" href="../../d6/d14/structre__registers.html">re_registers</a> *regs;
<a name="l06614"></a>06614     <span class="keywordtype">int</span> i;
<a name="l06615"></a>06615 
<a name="l06616"></a>06616     <span class="keywordflow">if</span> (<a class="code" href="../../db/db6/re_8h.html#afdf554fa234aebc803c8a4fc98c9936f">rb_reg_search</a>(pat, str, *start, 0) &gt;= 0) {
<a name="l06617"></a>06617         match = <a class="code" href="../../db/d2e/intern_8h.html#a2590f9272c0599ff0d1922bd0fb6efce">rb_backref_get</a>();
<a name="l06618"></a>06618         regs = <a class="code" href="../../db/db6/re_8h.html#ad2abd878cfffefaeb1fc24372e80b4c8">RMATCH_REGS</a>(match);
<a name="l06619"></a>06619         <span class="keywordflow">if</span> (<a class="code" href="../../dc/d26/re_8c.html#a84a2ca0496ad2a7c4852c539acb90180">BEG</a>(0) == <a class="code" href="../../d5/d9f/escape_8c.html#a29fd18bed01c4d836c7ebfe73a125c3f">END</a>(0)) {
<a name="l06620"></a>06620             <a class="code" href="../../d1/d7b/struct_onig_encoding_type_s_t.html">rb_encoding</a> *enc = <a class="code" href="../../d1/db0/string_8c.html#a123891f9f9b0c87d15621d93b4fa9c41">STR_ENC_GET</a>(str);
<a name="l06621"></a>06621             <span class="comment">/*</span>
<a name="l06622"></a>06622 <span class="comment">             * Always consume at least one character of the input string</span>
<a name="l06623"></a>06623 <span class="comment">             */</span>
<a name="l06624"></a>06624             <span class="keywordflow">if</span> (<a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(str) &gt; <a class="code" href="../../d5/d9f/escape_8c.html#a29fd18bed01c4d836c7ebfe73a125c3f">END</a>(0))
<a name="l06625"></a>06625                 *start = <a class="code" href="../../d5/d9f/escape_8c.html#a29fd18bed01c4d836c7ebfe73a125c3f">END</a>(0)+<a class="code" href="../../d5/db5/encoding_8c.html#a405ec52962866fac46a16f02f3f92832">rb_enc_fast_mbclen</a>(<a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(str)+<a class="code" href="../../d5/d9f/escape_8c.html#a29fd18bed01c4d836c7ebfe73a125c3f">END</a>(0),
<a name="l06626"></a>06626                                                    <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a35bfa2635774977edad0a16b9fdebbaf">RSTRING_END</a>(str), enc);
<a name="l06627"></a>06627             <span class="keywordflow">else</span>
<a name="l06628"></a>06628                 *start = <a class="code" href="../../d5/d9f/escape_8c.html#a29fd18bed01c4d836c7ebfe73a125c3f">END</a>(0)+1;
<a name="l06629"></a>06629         }
<a name="l06630"></a>06630         <span class="keywordflow">else</span> {
<a name="l06631"></a>06631             *start = <a class="code" href="../../d5/d9f/escape_8c.html#a29fd18bed01c4d836c7ebfe73a125c3f">END</a>(0);
<a name="l06632"></a>06632         }
<a name="l06633"></a>06633         <span class="keywordflow">if</span> (regs-&gt;<a class="code" href="../../d6/d14/structre__registers.html#a5e03bc44d6e9761f707cc1ba4cb4d023">num_regs</a> == 1) {
<a name="l06634"></a>06634             <span class="keywordflow">return</span> <a class="code" href="../../db/d2e/intern_8h.html#ac50ab731365028f5efab69c001fba39d">rb_reg_nth_match</a>(0, match);
<a name="l06635"></a>06635         }
<a name="l06636"></a>06636         result = <a class="code" href="../../dc/dcc/array_8c.html#a43a7bd246935ab63c233b4ae34d61d75">rb_ary_new2</a>(regs-&gt;<a class="code" href="../../d6/d14/structre__registers.html#a5e03bc44d6e9761f707cc1ba4cb4d023">num_regs</a>);
<a name="l06637"></a>06637         <span class="keywordflow">for</span> (i=1; i &lt; regs-&gt;<a class="code" href="../../d6/d14/structre__registers.html#a5e03bc44d6e9761f707cc1ba4cb4d023">num_regs</a>; i++) {
<a name="l06638"></a>06638             <a class="code" href="../../dc/dcc/array_8c.html#a59d553a8cd781364b8bcb0deae25cca2">rb_ary_push</a>(result, <a class="code" href="../../db/d2e/intern_8h.html#ac50ab731365028f5efab69c001fba39d">rb_reg_nth_match</a>(i, match));
<a name="l06639"></a>06639         }
<a name="l06640"></a>06640 
<a name="l06641"></a>06641         <span class="keywordflow">return</span> result;
<a name="l06642"></a>06642     }
<a name="l06643"></a>06643     <span class="keywordflow">return</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a320970f989dc8294c8203154e3db40c1">Qnil</a>;
<a name="l06644"></a>06644 }
<a name="l06645"></a>06645 
<a name="l06646"></a>06646 
<a name="l06647"></a>06647 <span class="comment">/*</span>
<a name="l06648"></a>06648 <span class="comment"> *  call-seq:</span>
<a name="l06649"></a>06649 <span class="comment"> *     str.scan(pattern)                         -&gt; array</span>
<a name="l06650"></a>06650 <span class="comment"> *     str.scan(pattern) {|match, ...| block }   -&gt; str</span>
<a name="l06651"></a>06651 <span class="comment"> *</span>
<a name="l06652"></a>06652 <span class="comment"> *  Both forms iterate through &lt;i&gt;str&lt;/i&gt;, matching the pattern (which may be a</span>
<a name="l06653"></a>06653 <span class="comment"> *  &lt;code&gt;Regexp&lt;/code&gt; or a &lt;code&gt;String&lt;/code&gt;). For each match, a result is</span>
<a name="l06654"></a>06654 <span class="comment"> *  generated and either added to the result array or passed to the block. If</span>
<a name="l06655"></a>06655 <span class="comment"> *  the pattern contains no groups, each individual result consists of the</span>
<a name="l06656"></a>06656 <span class="comment"> *  matched string, &lt;code&gt;$&amp;&lt;/code&gt;.  If the pattern contains groups, each</span>
<a name="l06657"></a>06657 <span class="comment"> *  individual result is itself an array containing one entry per group.</span>
<a name="l06658"></a>06658 <span class="comment"> *</span>
<a name="l06659"></a>06659 <span class="comment"> *     a = &quot;cruel world&quot;</span>
<a name="l06660"></a>06660 <span class="comment"> *     a.scan(/\w+/)        #=&gt; [&quot;cruel&quot;, &quot;world&quot;]</span>
<a name="l06661"></a>06661 <span class="comment"> *     a.scan(/.../)        #=&gt; [&quot;cru&quot;, &quot;el &quot;, &quot;wor&quot;]</span>
<a name="l06662"></a>06662 <span class="comment"> *     a.scan(/(...)/)      #=&gt; [[&quot;cru&quot;], [&quot;el &quot;], [&quot;wor&quot;]]</span>
<a name="l06663"></a>06663 <span class="comment"> *     a.scan(/(..)(..)/)   #=&gt; [[&quot;cr&quot;, &quot;ue&quot;], [&quot;l &quot;, &quot;wo&quot;]]</span>
<a name="l06664"></a>06664 <span class="comment"> *</span>
<a name="l06665"></a>06665 <span class="comment"> *  And the block form:</span>
<a name="l06666"></a>06666 <span class="comment"> *</span>
<a name="l06667"></a>06667 <span class="comment"> *     a.scan(/\w+/) {|w| print &quot;&lt;&lt;#{w}&gt;&gt; &quot; }</span>
<a name="l06668"></a>06668 <span class="comment"> *     print &quot;\n&quot;</span>
<a name="l06669"></a>06669 <span class="comment"> *     a.scan(/(.)(.)/) {|x,y| print y, x }</span>
<a name="l06670"></a>06670 <span class="comment"> *     print &quot;\n&quot;</span>
<a name="l06671"></a>06671 <span class="comment"> *</span>
<a name="l06672"></a>06672 <span class="comment"> *  &lt;em&gt;produces:&lt;/em&gt;</span>
<a name="l06673"></a>06673 <span class="comment"> *</span>
<a name="l06674"></a>06674 <span class="comment"> *     &lt;&lt;cruel&gt;&gt; &lt;&lt;world&gt;&gt;</span>
<a name="l06675"></a>06675 <span class="comment"> *     rceu lowlr</span>
<a name="l06676"></a>06676 <span class="comment"> */</span>
<a name="l06677"></a>06677 
<a name="l06678"></a>06678 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l06679"></a><a class="code" href="../../d1/db0/string_8c.html#a134d836dfe048f50fce0b50d073f9d1f">06679</a> <a class="code" href="../../d1/db0/string_8c.html#a134d836dfe048f50fce0b50d073f9d1f">rb_str_scan</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> pat)
<a name="l06680"></a>06680 {
<a name="l06681"></a>06681     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <a class="code" href="../../d8/d90/nkf_8c.html#a5ea5ac7abf5cce39283e422add1067d5">result</a>;
<a name="l06682"></a>06682     <span class="keywordtype">long</span> start = 0;
<a name="l06683"></a>06683     <span class="keywordtype">long</span> <a class="code" href="../../d6/da0/nkf-utf8_2nkf_8c.html#ab0b853bc4e4e9658036bf7e604f398ad">last</a> = -1, <a class="code" href="../../d7/dc0/parse_8y.html#a71f8b6ffdc0cc58ffd989c3162fb2bcf">prev</a> = 0;
<a name="l06684"></a>06684     <span class="keywordtype">char</span> *p = <a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(str); <span class="keywordtype">long</span> len = <a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(str);
<a name="l06685"></a>06685 
<a name="l06686"></a>06686     pat = <a class="code" href="../../d1/db0/string_8c.html#a105b63dc9f6f07c8c6403302757e9c96">get_pat</a>(pat, 1);
<a name="l06687"></a>06687     <span class="keywordflow">if</span> (!<a class="code" href="../../d3/d57/eval_8c.html#aea346c4eb8bc06df88422e956bb05fec">rb_block_given_p</a>()) {
<a name="l06688"></a>06688         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> ary = <a class="code" href="../../dc/dcc/array_8c.html#a9518114fd36cb4ef4656ec1dc63348c9">rb_ary_new</a>();
<a name="l06689"></a>06689 
<a name="l06690"></a>06690         <span class="keywordflow">while</span> (!<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a4832bad8845a35fc50f7a160901854a1">NIL_P</a>(result = <a class="code" href="../../d1/db0/string_8c.html#ae26280e3f7262763e181dea4b870ac70">scan_once</a>(str, pat, &amp;start))) {
<a name="l06691"></a>06691             last = <a class="code" href="../../d7/dc0/parse_8y.html#a71f8b6ffdc0cc58ffd989c3162fb2bcf">prev</a>;
<a name="l06692"></a>06692             <a class="code" href="../../d7/dc0/parse_8y.html#a71f8b6ffdc0cc58ffd989c3162fb2bcf">prev</a> = start;
<a name="l06693"></a>06693             <a class="code" href="../../dc/dcc/array_8c.html#a59d553a8cd781364b8bcb0deae25cca2">rb_ary_push</a>(ary, result);
<a name="l06694"></a>06694         }
<a name="l06695"></a>06695         <span class="keywordflow">if</span> (last &gt;= 0) <a class="code" href="../../db/db6/re_8h.html#afdf554fa234aebc803c8a4fc98c9936f">rb_reg_search</a>(pat, str, last, 0);
<a name="l06696"></a>06696         <span class="keywordflow">return</span> ary;
<a name="l06697"></a>06697     }
<a name="l06698"></a>06698 
<a name="l06699"></a>06699     <span class="keywordflow">while</span> (!<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a4832bad8845a35fc50f7a160901854a1">NIL_P</a>(result = <a class="code" href="../../d1/db0/string_8c.html#ae26280e3f7262763e181dea4b870ac70">scan_once</a>(str, pat, &amp;start))) {
<a name="l06700"></a>06700         last = <a class="code" href="../../d7/dc0/parse_8y.html#a71f8b6ffdc0cc58ffd989c3162fb2bcf">prev</a>;
<a name="l06701"></a>06701         <a class="code" href="../../d7/dc0/parse_8y.html#a71f8b6ffdc0cc58ffd989c3162fb2bcf">prev</a> = start;
<a name="l06702"></a>06702         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ae6bd0c4ea4db971ebd569ca8f05c6b4a">rb_yield</a>(result);
<a name="l06703"></a>06703         <a class="code" href="../../d1/db0/string_8c.html#ad2935afc9682c838023639ae7332edad">str_mod_check</a>(str, p, len);
<a name="l06704"></a>06704     }
<a name="l06705"></a>06705     <span class="keywordflow">if</span> (last &gt;= 0) <a class="code" href="../../db/db6/re_8h.html#afdf554fa234aebc803c8a4fc98c9936f">rb_reg_search</a>(pat, str, last, 0);
<a name="l06706"></a>06706     <span class="keywordflow">return</span> str;
<a name="l06707"></a>06707 }
<a name="l06708"></a>06708 
<a name="l06709"></a>06709 
<a name="l06710"></a>06710 <span class="comment">/*</span>
<a name="l06711"></a>06711 <span class="comment"> *  call-seq:</span>
<a name="l06712"></a>06712 <span class="comment"> *     str.hex   -&gt; integer</span>
<a name="l06713"></a>06713 <span class="comment"> *</span>
<a name="l06714"></a>06714 <span class="comment"> *  Treats leading characters from &lt;i&gt;str&lt;/i&gt; as a string of hexadecimal digits</span>
<a name="l06715"></a>06715 <span class="comment"> *  (with an optional sign and an optional &lt;code&gt;0x&lt;/code&gt;) and returns the</span>
<a name="l06716"></a>06716 <span class="comment"> *  corresponding number. Zero is returned on error.</span>
<a name="l06717"></a>06717 <span class="comment"> *</span>
<a name="l06718"></a>06718 <span class="comment"> *     &quot;0x0a&quot;.hex     #=&gt; 10</span>
<a name="l06719"></a>06719 <span class="comment"> *     &quot;-1234&quot;.hex    #=&gt; -4660</span>
<a name="l06720"></a>06720 <span class="comment"> *     &quot;0&quot;.hex        #=&gt; 0</span>
<a name="l06721"></a>06721 <span class="comment"> *     &quot;wombat&quot;.hex   #=&gt; 0</span>
<a name="l06722"></a>06722 <span class="comment"> */</span>
<a name="l06723"></a>06723 
<a name="l06724"></a>06724 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l06725"></a><a class="code" href="../../d1/db0/string_8c.html#a4c46372c755eec9a64dd23b3a508a435">06725</a> <a class="code" href="../../d1/db0/string_8c.html#a4c46372c755eec9a64dd23b3a508a435">rb_str_hex</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str)
<a name="l06726"></a>06726 {
<a name="l06727"></a>06727     <a class="code" href="../../d1/d7b/struct_onig_encoding_type_s_t.html">rb_encoding</a> *enc = <a class="code" href="../../d5/db5/encoding_8c.html#ac21ed764f3b39453b6a848dd64a19585">rb_enc_get</a>(str);
<a name="l06728"></a>06728 
<a name="l06729"></a>06729     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/de3/encoding_8h.html#a8b18a09a3055d3006c6d5baeaa6e7c72">rb_enc_asciicompat</a>(enc)) {
<a name="l06730"></a>06730         <a class="code" href="../../db/dcc/error_8c.html#a0f771a2840561f1838169b3d7d4616f3">rb_raise</a>(<a class="code" href="../../db/dcc/error_8c.html#a71f980ead61a4ac261914ffaaa184e1f">rb_eEncCompatError</a>, <span class="stringliteral">&quot;ASCII incompatible encoding: %s&quot;</span>, <a class="code" href="../../d5/de3/encoding_8h.html#a69d59d898802726787a168ef2e0dc92c">rb_enc_name</a>(enc));
<a name="l06731"></a>06731     }
<a name="l06732"></a>06732     <span class="keywordflow">return</span> <a class="code" href="../../d1/dcc/bignum_8c.html#a3c364897a7c673caf46ccdbf62536a07">rb_str_to_inum</a>(str, 16, <a class="code" href="../../d1/d5c/nkf_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>);
<a name="l06733"></a>06733 }
<a name="l06734"></a>06734 
<a name="l06735"></a>06735 
<a name="l06736"></a>06736 <span class="comment">/*</span>
<a name="l06737"></a>06737 <span class="comment"> *  call-seq:</span>
<a name="l06738"></a>06738 <span class="comment"> *     str.oct   -&gt; integer</span>
<a name="l06739"></a>06739 <span class="comment"> *</span>
<a name="l06740"></a>06740 <span class="comment"> *  Treats leading characters of &lt;i&gt;str&lt;/i&gt; as a string of octal digits (with an</span>
<a name="l06741"></a>06741 <span class="comment"> *  optional sign) and returns the corresponding number.  Returns 0 if the</span>
<a name="l06742"></a>06742 <span class="comment"> *  conversion fails.</span>
<a name="l06743"></a>06743 <span class="comment"> *</span>
<a name="l06744"></a>06744 <span class="comment"> *     &quot;123&quot;.oct       #=&gt; 83</span>
<a name="l06745"></a>06745 <span class="comment"> *     &quot;-377&quot;.oct      #=&gt; -255</span>
<a name="l06746"></a>06746 <span class="comment"> *     &quot;bad&quot;.oct       #=&gt; 0</span>
<a name="l06747"></a>06747 <span class="comment"> *     &quot;0377bad&quot;.oct   #=&gt; 255</span>
<a name="l06748"></a>06748 <span class="comment"> */</span>
<a name="l06749"></a>06749 
<a name="l06750"></a>06750 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l06751"></a><a class="code" href="../../d1/db0/string_8c.html#a4940bad3235261b1dc9ae0549241f987">06751</a> <a class="code" href="../../d1/db0/string_8c.html#a4940bad3235261b1dc9ae0549241f987">rb_str_oct</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str)
<a name="l06752"></a>06752 {
<a name="l06753"></a>06753     <a class="code" href="../../d1/d7b/struct_onig_encoding_type_s_t.html">rb_encoding</a> *enc = <a class="code" href="../../d5/db5/encoding_8c.html#ac21ed764f3b39453b6a848dd64a19585">rb_enc_get</a>(str);
<a name="l06754"></a>06754 
<a name="l06755"></a>06755     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/de3/encoding_8h.html#a8b18a09a3055d3006c6d5baeaa6e7c72">rb_enc_asciicompat</a>(enc)) {
<a name="l06756"></a>06756         <a class="code" href="../../db/dcc/error_8c.html#a0f771a2840561f1838169b3d7d4616f3">rb_raise</a>(<a class="code" href="../../db/dcc/error_8c.html#a71f980ead61a4ac261914ffaaa184e1f">rb_eEncCompatError</a>, <span class="stringliteral">&quot;ASCII incompatible encoding: %s&quot;</span>, <a class="code" href="../../d5/de3/encoding_8h.html#a69d59d898802726787a168ef2e0dc92c">rb_enc_name</a>(enc));
<a name="l06757"></a>06757     }
<a name="l06758"></a>06758     <span class="keywordflow">return</span> <a class="code" href="../../d1/dcc/bignum_8c.html#a3c364897a7c673caf46ccdbf62536a07">rb_str_to_inum</a>(str, -8, <a class="code" href="../../d1/d5c/nkf_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>);
<a name="l06759"></a>06759 }
<a name="l06760"></a>06760 
<a name="l06761"></a>06761 
<a name="l06762"></a>06762 <span class="comment">/*</span>
<a name="l06763"></a>06763 <span class="comment"> *  call-seq:</span>
<a name="l06764"></a>06764 <span class="comment"> *     str.crypt(other_str)   -&gt; new_str</span>
<a name="l06765"></a>06765 <span class="comment"> *</span>
<a name="l06766"></a>06766 <span class="comment"> *  Applies a one-way cryptographic hash to &lt;i&gt;str&lt;/i&gt; by invoking the standard</span>
<a name="l06767"></a>06767 <span class="comment"> *  library function &lt;code&gt;crypt&lt;/code&gt;. The argument is the salt string, which</span>
<a name="l06768"></a>06768 <span class="comment"> *  should be two characters long, each character drawn from</span>
<a name="l06769"></a>06769 <span class="comment"> *  &lt;code&gt;[a-zA-Z0-9./]&lt;/code&gt;.</span>
<a name="l06770"></a>06770 <span class="comment"> */</span>
<a name="l06771"></a>06771 
<a name="l06772"></a>06772 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l06773"></a><a class="code" href="../../d1/db0/string_8c.html#a45dacd15f0efb82411dd2c84e6b08542">06773</a> <a class="code" href="../../d1/db0/string_8c.html#a45dacd15f0efb82411dd2c84e6b08542">rb_str_crypt</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> salt)
<a name="l06774"></a>06774 {
<a name="l06775"></a>06775     <span class="keyword">extern</span> <span class="keywordtype">char</span> *<a class="code" href="../../d3/d90/missing_8h.html#a47fa3eb2086507cf2eb232be5379841c">crypt</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *, <span class="keyword">const</span> <span class="keywordtype">char</span> *);
<a name="l06776"></a>06776     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <a class="code" href="../../d8/d90/nkf_8c.html#a5ea5ac7abf5cce39283e422add1067d5">result</a>;
<a name="l06777"></a>06777     <span class="keyword">const</span> <span class="keywordtype">char</span> *s, *saltp;
<a name="l06778"></a>06778 <span class="preprocessor">#ifdef BROKEN_CRYPT</span>
<a name="l06779"></a>06779 <span class="preprocessor"></span>    <span class="keywordtype">char</span> salt_8bit_clean[3];
<a name="l06780"></a>06780 <span class="preprocessor">#endif</span>
<a name="l06781"></a>06781 <span class="preprocessor"></span>
<a name="l06782"></a>06782     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a0e80f207eb41e9010ec9f0f5f9419fea">StringValue</a>(salt);
<a name="l06783"></a>06783     <span class="keywordflow">if</span> (<a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(salt) &lt; 2)
<a name="l06784"></a>06784         <a class="code" href="../../db/dcc/error_8c.html#a0f771a2840561f1838169b3d7d4616f3">rb_raise</a>(<a class="code" href="../../db/dcc/error_8c.html#ab5e2a9fec766c75176fbb262bfe6a596">rb_eArgError</a>, <span class="stringliteral">&quot;salt too short (need &gt;=2 bytes)&quot;</span>);
<a name="l06785"></a>06785 
<a name="l06786"></a>06786     s = <a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(str);
<a name="l06787"></a>06787     <span class="keywordflow">if</span> (!s) s = <span class="stringliteral">&quot;&quot;</span>;
<a name="l06788"></a>06788     saltp = <a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(salt);
<a name="l06789"></a>06789 <span class="preprocessor">#ifdef BROKEN_CRYPT</span>
<a name="l06790"></a>06790 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (!<a class="code" href="../../de/de6/ruby_2ruby_8h.html#af96ff81718c3c27b342b5958fac6cb7e">ISASCII</a>((<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)saltp[0]) || !<a class="code" href="../../de/de6/ruby_2ruby_8h.html#af96ff81718c3c27b342b5958fac6cb7e">ISASCII</a>((<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)saltp[1])) {
<a name="l06791"></a>06791         salt_8bit_clean[0] = saltp[0] &amp; 0x7f;
<a name="l06792"></a>06792         salt_8bit_clean[1] = saltp[1] &amp; 0x7f;
<a name="l06793"></a>06793         salt_8bit_clean[2] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l06794"></a>06794         saltp = salt_8bit_clean;
<a name="l06795"></a>06795     }
<a name="l06796"></a>06796 <span class="preprocessor">#endif</span>
<a name="l06797"></a>06797 <span class="preprocessor"></span>    result = <a class="code" href="../../db/d2e/intern_8h.html#a03acd62c0b1edebbe1d61f957c19b7ac">rb_str_new2</a>(<a class="code" href="../../d3/d90/missing_8h.html#a47fa3eb2086507cf2eb232be5379841c">crypt</a>(s, saltp));
<a name="l06798"></a>06798     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3bf9ab455a1e0e3e8cfc6ebabd8f12df">OBJ_INFECT</a>(result, str);
<a name="l06799"></a>06799     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3bf9ab455a1e0e3e8cfc6ebabd8f12df">OBJ_INFECT</a>(result, salt);
<a name="l06800"></a>06800     <span class="keywordflow">return</span> result;
<a name="l06801"></a>06801 }
<a name="l06802"></a>06802 
<a name="l06803"></a>06803 
<a name="l06804"></a>06804 <span class="comment">/*</span>
<a name="l06805"></a>06805 <span class="comment"> *  call-seq:</span>
<a name="l06806"></a>06806 <span class="comment"> *     str.intern   -&gt; symbol</span>
<a name="l06807"></a>06807 <span class="comment"> *     str.to_sym   -&gt; symbol</span>
<a name="l06808"></a>06808 <span class="comment"> *</span>
<a name="l06809"></a>06809 <span class="comment"> *  Returns the &lt;code&gt;Symbol&lt;/code&gt; corresponding to &lt;i&gt;str&lt;/i&gt;, creating the</span>
<a name="l06810"></a>06810 <span class="comment"> *  symbol if it did not previously exist. See &lt;code&gt;Symbol#id2name&lt;/code&gt;.</span>
<a name="l06811"></a>06811 <span class="comment"> *</span>
<a name="l06812"></a>06812 <span class="comment"> *     &quot;Koala&quot;.intern         #=&gt; :Koala</span>
<a name="l06813"></a>06813 <span class="comment"> *     s = &apos;cat&apos;.to_sym       #=&gt; :cat</span>
<a name="l06814"></a>06814 <span class="comment"> *     s == :cat              #=&gt; true</span>
<a name="l06815"></a>06815 <span class="comment"> *     s = &apos;@cat&apos;.to_sym      #=&gt; :@cat</span>
<a name="l06816"></a>06816 <span class="comment"> *     s == :@cat             #=&gt; true</span>
<a name="l06817"></a>06817 <span class="comment"> *</span>
<a name="l06818"></a>06818 <span class="comment"> *  This can also be used to create symbols that cannot be represented using the</span>
<a name="l06819"></a>06819 <span class="comment"> *  &lt;code&gt;:xxx&lt;/code&gt; notation.</span>
<a name="l06820"></a>06820 <span class="comment"> *</span>
<a name="l06821"></a>06821 <span class="comment"> *     &apos;cat and dog&apos;.to_sym   #=&gt; :&quot;cat and dog&quot;</span>
<a name="l06822"></a>06822 <span class="comment"> */</span>
<a name="l06823"></a>06823 
<a name="l06824"></a>06824 <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l06825"></a><a class="code" href="../../d1/db0/string_8c.html#a4fd91bb1d8786a1c99cb7d4e74acf1d9">06825</a> <a class="code" href="../../db/d2e/intern_8h.html#abee4398ccf077c9cab2d51c5d2d25c22">rb_str_intern</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> s)
<a name="l06826"></a>06826 {
<a name="l06827"></a>06827     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str = <a class="code" href="../../d8/df4/generator_8h.html#ad2bf389f3fddea7bd3befa162c70561a">RB_GC_GUARD</a>(s);
<a name="l06828"></a>06828     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#afa5b9137f051ac26d7ccc8824f178233">ID</a> <a class="code" href="../../d6/da0/nkf-utf8_2nkf_8c.html#a64ae40793ade89d800a8c5646d2980fc">id</a>;
<a name="l06829"></a>06829 
<a name="l06830"></a>06830     <span class="keywordtype">id</span> = <a class="code" href="../../d5/d11/ripper_8c.html#aebb6b3345ade11073c43fd418ec67b87">rb_intern_str</a>(str);
<a name="l06831"></a>06831     <span class="keywordflow">return</span> <a class="code" href="../../dc/d0c/cparse_8c.html#a48bfb6519a45249fb2ec0193ea3b6e1c">ID2SYM</a>(<span class="keywordtype">id</span>);
<a name="l06832"></a>06832 }
<a name="l06833"></a>06833 
<a name="l06834"></a>06834 
<a name="l06835"></a>06835 <span class="comment">/*</span>
<a name="l06836"></a>06836 <span class="comment"> *  call-seq:</span>
<a name="l06837"></a>06837 <span class="comment"> *     str.ord   -&gt; integer</span>
<a name="l06838"></a>06838 <span class="comment"> *</span>
<a name="l06839"></a>06839 <span class="comment"> *  Return the &lt;code&gt;Integer&lt;/code&gt; ordinal of a one-character string.</span>
<a name="l06840"></a>06840 <span class="comment"> *</span>
<a name="l06841"></a>06841 <span class="comment"> *     &quot;a&quot;.ord         #=&gt; 97</span>
<a name="l06842"></a>06842 <span class="comment"> */</span>
<a name="l06843"></a>06843 
<a name="l06844"></a>06844 <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l06845"></a><a class="code" href="../../d1/db0/string_8c.html#a52f9d0d0e7f596972c2331d26ec34978">06845</a> <a class="code" href="../../d1/db0/string_8c.html#a52f9d0d0e7f596972c2331d26ec34978">rb_str_ord</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> s)
<a name="l06846"></a>06846 {
<a name="l06847"></a>06847     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> c;
<a name="l06848"></a>06848 
<a name="l06849"></a>06849     c = <a class="code" href="../../d5/de3/encoding_8h.html#a902fb7e618fcdb1ce1317b09a772af15">rb_enc_codepoint</a>(<a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(s), <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a35bfa2635774977edad0a16b9fdebbaf">RSTRING_END</a>(s), <a class="code" href="../../d1/db0/string_8c.html#a123891f9f9b0c87d15621d93b4fa9c41">STR_ENC_GET</a>(s));
<a name="l06850"></a>06850     <span class="keywordflow">return</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a6eb3054f7a740d26c133d34ae6afdf2c">UINT2NUM</a>(c);
<a name="l06851"></a>06851 }
<a name="l06852"></a>06852 <span class="comment">/*</span>
<a name="l06853"></a>06853 <span class="comment"> *  call-seq:</span>
<a name="l06854"></a>06854 <span class="comment"> *     str.sum(n=16)   -&gt; integer</span>
<a name="l06855"></a>06855 <span class="comment"> *</span>
<a name="l06856"></a>06856 <span class="comment"> *  Returns a basic &lt;em&gt;n&lt;/em&gt;-bit checksum of the characters in &lt;i&gt;str&lt;/i&gt;,</span>
<a name="l06857"></a>06857 <span class="comment"> *  where &lt;em&gt;n&lt;/em&gt; is the optional &lt;code&gt;Fixnum&lt;/code&gt; parameter, defaulting</span>
<a name="l06858"></a>06858 <span class="comment"> *  to 16. The result is simply the sum of the binary value of each character in</span>
<a name="l06859"></a>06859 <span class="comment"> *  &lt;i&gt;str&lt;/i&gt; modulo &lt;code&gt;2**n - 1&lt;/code&gt;. This is not a particularly good</span>
<a name="l06860"></a>06860 <span class="comment"> *  checksum.</span>
<a name="l06861"></a>06861 <span class="comment"> */</span>
<a name="l06862"></a>06862 
<a name="l06863"></a>06863 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l06864"></a><a class="code" href="../../d1/db0/string_8c.html#a13c5d72bb3670c5abcafb887a5e88597">06864</a> <a class="code" href="../../d1/db0/string_8c.html#a13c5d72bb3670c5abcafb887a5e88597">rb_str_sum</a>(<span class="keywordtype">int</span> <a class="code" href="../../df/d77/ruby_8c.html#ad1447518f4372828b8435ae82e48499e">argc</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> *<a class="code" href="../../df/d77/ruby_8c.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str)
<a name="l06865"></a>06865 {
<a name="l06866"></a>06866     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> vbits;
<a name="l06867"></a>06867     <span class="keywordtype">int</span> bits;
<a name="l06868"></a>06868     <span class="keywordtype">char</span> *ptr, *p, *pend;
<a name="l06869"></a>06869     <span class="keywordtype">long</span> len;
<a name="l06870"></a>06870     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> sum = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(0);
<a name="l06871"></a>06871     <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> sum0 = 0;
<a name="l06872"></a>06872 
<a name="l06873"></a>06873     <span class="keywordflow">if</span> (argc == 0) {
<a name="l06874"></a>06874         bits = 16;
<a name="l06875"></a>06875     }
<a name="l06876"></a>06876     <span class="keywordflow">else</span> {
<a name="l06877"></a>06877         <a class="code" href="../../d7/d19/group__defmethod.html#gaa7bed88640f01bee619f85fda09d28d7">rb_scan_args</a>(argc, argv, <span class="stringliteral">&quot;01&quot;</span>, &amp;vbits);
<a name="l06878"></a>06878         bits = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a877c38180d23c5447d976c70dda89d69">NUM2INT</a>(vbits);
<a name="l06879"></a>06879     }
<a name="l06880"></a>06880     ptr = p = <a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(str);
<a name="l06881"></a>06881     len = <a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(str);
<a name="l06882"></a>06882     pend = p + len;
<a name="l06883"></a>06883 
<a name="l06884"></a>06884     <span class="keywordflow">while</span> (p &lt; pend) {
<a name="l06885"></a>06885         <span class="keywordflow">if</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#ab1040c5fdcb7a88dca4c25222bf43454">FIXNUM_MAX</a> - UCHAR_MAX &lt; sum0) {
<a name="l06886"></a>06886             sum = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a6a973fe624aa9aa9ba0cdeb6792d3187" title="Calls a method.">rb_funcall</a>(sum, <span class="charliteral">&apos;+&apos;</span>, 1, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a2ead2f64c81efed352e79e89f29b8fc8">LONG2FIX</a>(sum0));
<a name="l06887"></a>06887             <a class="code" href="../../d1/db0/string_8c.html#ad2935afc9682c838023639ae7332edad">str_mod_check</a>(str, ptr, len);
<a name="l06888"></a>06888             sum0 = 0;
<a name="l06889"></a>06889         }
<a name="l06890"></a>06890         sum0 += (<span class="keywordtype">unsigned</span> char)*p;
<a name="l06891"></a>06891         p++;
<a name="l06892"></a>06892     }
<a name="l06893"></a>06893 
<a name="l06894"></a>06894     <span class="keywordflow">if</span> (bits == 0) {
<a name="l06895"></a>06895         <span class="keywordflow">if</span> (sum0) {
<a name="l06896"></a>06896             sum = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a6a973fe624aa9aa9ba0cdeb6792d3187" title="Calls a method.">rb_funcall</a>(sum, <span class="charliteral">&apos;+&apos;</span>, 1, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a2ead2f64c81efed352e79e89f29b8fc8">LONG2FIX</a>(sum0));
<a name="l06897"></a>06897         }
<a name="l06898"></a>06898     }
<a name="l06899"></a>06899     <span class="keywordflow">else</span> {
<a name="l06900"></a>06900         <span class="keywordflow">if</span> (sum == <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(0)) {
<a name="l06901"></a>06901             <span class="keywordflow">if</span> (bits &lt; (<span class="keywordtype">int</span>)<span class="keyword">sizeof</span>(<span class="keywordtype">long</span>)*<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a308d9dd2c0028ddb184b455bbd7865de">CHAR_BIT</a>) {
<a name="l06902"></a>06902                 sum0 &amp;= (((<span class="keywordtype">unsigned</span> <a class="code" href="../../d3/d15/name2ctype_8h.html#a86f2415763322050063a5502f87c9422">long</a>)1)&lt;&lt;bits)-1;
<a name="l06903"></a>06903             }
<a name="l06904"></a>06904             sum = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a2ead2f64c81efed352e79e89f29b8fc8">LONG2FIX</a>(sum0);
<a name="l06905"></a>06905         }
<a name="l06906"></a>06906         <span class="keywordflow">else</span> {
<a name="l06907"></a>06907             <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <a class="code" href="../../d1/d6f/date__strftime_8c.html#aa84d960185b18347956518e4d00766b4">mod</a>;
<a name="l06908"></a>06908 
<a name="l06909"></a>06909             <span class="keywordflow">if</span> (sum0) {
<a name="l06910"></a>06910                 sum = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a6a973fe624aa9aa9ba0cdeb6792d3187" title="Calls a method.">rb_funcall</a>(sum, <span class="charliteral">&apos;+&apos;</span>, 1, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a2ead2f64c81efed352e79e89f29b8fc8">LONG2FIX</a>(sum0));
<a name="l06911"></a>06911             }
<a name="l06912"></a>06912 
<a name="l06913"></a>06913             mod = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a6a973fe624aa9aa9ba0cdeb6792d3187" title="Calls a method.">rb_funcall</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(1), <a class="code" href="../../dc/dcc/array_8c.html#a9cfa42d4b79c89d68c53be8b2150a503">rb_intern</a>(<span class="stringliteral">&quot;&lt;&lt;&quot;</span>), 1, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(bits));
<a name="l06914"></a>06914             mod = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a6a973fe624aa9aa9ba0cdeb6792d3187" title="Calls a method.">rb_funcall</a>(mod, <span class="charliteral">&apos;-&apos;</span>, 1, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(1));
<a name="l06915"></a>06915             sum = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a6a973fe624aa9aa9ba0cdeb6792d3187" title="Calls a method.">rb_funcall</a>(sum, <span class="charliteral">&apos;&amp;&apos;</span>, 1, mod);
<a name="l06916"></a>06916         }
<a name="l06917"></a>06917     }
<a name="l06918"></a>06918     <span class="keywordflow">return</span> sum;
<a name="l06919"></a>06919 }
<a name="l06920"></a>06920 
<a name="l06921"></a>06921 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l06922"></a><a class="code" href="../../d1/db0/string_8c.html#ab580cc475bf997287619247c89c05a93">06922</a> <a class="code" href="../../d1/db0/string_8c.html#ab580cc475bf997287619247c89c05a93">rb_str_justify</a>(<span class="keywordtype">int</span> <a class="code" href="../../df/d77/ruby_8c.html#ad1447518f4372828b8435ae82e48499e">argc</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> *<a class="code" href="../../df/d77/ruby_8c.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str, <span class="keywordtype">char</span> jflag)
<a name="l06923"></a>06923 {
<a name="l06924"></a>06924     <a class="code" href="../../d1/d7b/struct_onig_encoding_type_s_t.html">rb_encoding</a> *enc;
<a name="l06925"></a>06925     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> w;
<a name="l06926"></a>06926     <span class="keywordtype">long</span> width, len, flen = 1, fclen = 1;
<a name="l06927"></a>06927     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> res;
<a name="l06928"></a>06928     <span class="keywordtype">char</span> *p;
<a name="l06929"></a>06929     <span class="keyword">const</span> <span class="keywordtype">char</span> *f = <span class="stringliteral">&quot; &quot;</span>;
<a name="l06930"></a>06930     <span class="keywordtype">long</span> n, <a class="code" href="../../d5/db5/encoding_8c.html#a439227feff9d7f55384e8780cfc2eb82">size</a>, llen, rlen, llen2 = 0, rlen2 = 0;
<a name="l06931"></a>06931     <span class="keyword">volatile</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> pad;
<a name="l06932"></a>06932     <span class="keywordtype">int</span> singlebyte = 1, cr;
<a name="l06933"></a>06933 
<a name="l06934"></a>06934     <a class="code" href="../../d7/d19/group__defmethod.html#gaa7bed88640f01bee619f85fda09d28d7">rb_scan_args</a>(argc, argv, <span class="stringliteral">&quot;11&quot;</span>, &amp;w, &amp;pad);
<a name="l06935"></a>06935     enc = <a class="code" href="../../d1/db0/string_8c.html#a123891f9f9b0c87d15621d93b4fa9c41">STR_ENC_GET</a>(str);
<a name="l06936"></a>06936     width = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a93f154f3dcc08027f475bf0c3cc287bd">NUM2LONG</a>(w);
<a name="l06937"></a>06937     <span class="keywordflow">if</span> (argc == 2) {
<a name="l06938"></a>06938         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a0e80f207eb41e9010ec9f0f5f9419fea">StringValue</a>(pad);
<a name="l06939"></a>06939         enc = <a class="code" href="../../d5/db5/encoding_8c.html#a7d17d602fae27de649f9310511c03db0">rb_enc_check</a>(str, pad);
<a name="l06940"></a>06940         f = <a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(pad);
<a name="l06941"></a>06941         flen = <a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(pad);
<a name="l06942"></a>06942         fclen = <a class="code" href="../../d1/db0/string_8c.html#abe68504f1d38108a10f267f4358c53db">str_strlen</a>(pad, enc);
<a name="l06943"></a>06943         singlebyte = <a class="code" href="../../d1/db0/string_8c.html#a5ab3c8112c2ec6943bdae8a2036fca02">single_byte_optimizable</a>(pad);
<a name="l06944"></a>06944         <span class="keywordflow">if</span> (flen == 0 || fclen == 0) {
<a name="l06945"></a>06945             <a class="code" href="../../db/dcc/error_8c.html#a0f771a2840561f1838169b3d7d4616f3">rb_raise</a>(<a class="code" href="../../db/dcc/error_8c.html#ab5e2a9fec766c75176fbb262bfe6a596">rb_eArgError</a>, <span class="stringliteral">&quot;zero width padding&quot;</span>);
<a name="l06946"></a>06946         }
<a name="l06947"></a>06947     }
<a name="l06948"></a>06948     len = <a class="code" href="../../d1/db0/string_8c.html#abe68504f1d38108a10f267f4358c53db">str_strlen</a>(str, enc);
<a name="l06949"></a>06949     <span class="keywordflow">if</span> (width &lt; 0 || len &gt;= width) <span class="keywordflow">return</span> <a class="code" href="../../db/d2e/intern_8h.html#ae2843c766c24b80116bb127ebf22d5bf">rb_str_dup</a>(str);
<a name="l06950"></a>06950     n = width - len;
<a name="l06951"></a>06951     llen = (jflag == <span class="charliteral">&apos;l&apos;</span>) ? 0 : ((jflag == <span class="charliteral">&apos;r&apos;</span>) ? n : n/2);
<a name="l06952"></a>06952     rlen = n - llen;
<a name="l06953"></a>06953     cr = <a class="code" href="../../d5/de3/encoding_8h.html#a5901233f6f9004aebbdeccdd33cf449f">ENC_CODERANGE</a>(str);
<a name="l06954"></a>06954     <span class="keywordflow">if</span> (flen &gt; 1) {
<a name="l06955"></a>06955        llen2 = <a class="code" href="../../d1/db0/string_8c.html#a0e1c768ca3baf15d6a4ec3581ba3297c">str_offset</a>(f, f + flen, llen % fclen, enc, singlebyte);
<a name="l06956"></a>06956        rlen2 = <a class="code" href="../../d1/db0/string_8c.html#a0e1c768ca3baf15d6a4ec3581ba3297c">str_offset</a>(f, f + flen, rlen % fclen, enc, singlebyte);
<a name="l06957"></a>06957     }
<a name="l06958"></a>06958     size = <a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(str);
<a name="l06959"></a>06959     <span class="keywordflow">if</span> ((len = llen / fclen + rlen / fclen) &gt;= <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a50fece4db74f09568b2938db583c5655">LONG_MAX</a> / flen ||
<a name="l06960"></a>06960        (len *= flen) &gt;= <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a50fece4db74f09568b2938db583c5655">LONG_MAX</a> - llen2 - rlen2 ||
<a name="l06961"></a>06961        (len += llen2 + rlen2) &gt;= <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a50fece4db74f09568b2938db583c5655">LONG_MAX</a> - size) {
<a name="l06962"></a>06962        <a class="code" href="../../db/dcc/error_8c.html#a0f771a2840561f1838169b3d7d4616f3">rb_raise</a>(<a class="code" href="../../db/dcc/error_8c.html#ab5e2a9fec766c75176fbb262bfe6a596">rb_eArgError</a>, <span class="stringliteral">&quot;argument too big&quot;</span>);
<a name="l06963"></a>06963     }
<a name="l06964"></a>06964     len += size;
<a name="l06965"></a>06965     res = <a class="code" href="../../db/d2e/intern_8h.html#a70b7301e6960c402803fa81c7a0777d0">rb_str_new5</a>(str, 0, len);
<a name="l06966"></a>06966     p = <a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(res);
<a name="l06967"></a>06967     <span class="keywordflow">if</span> (flen &lt;= 1) {
<a name="l06968"></a>06968        memset(p, *f, llen);
<a name="l06969"></a>06969        p += llen;
<a name="l06970"></a>06970     }
<a name="l06971"></a>06971     <span class="keywordflow">else</span> {
<a name="l06972"></a>06972        <span class="keywordflow">while</span> (llen &gt;= fclen) {
<a name="l06973"></a>06973             memcpy(p,f,flen);
<a name="l06974"></a>06974             p += flen;
<a name="l06975"></a>06975             llen -= fclen;
<a name="l06976"></a>06976         }
<a name="l06977"></a>06977        <span class="keywordflow">if</span> (llen &gt; 0) {
<a name="l06978"></a>06978            memcpy(p, f, llen2);
<a name="l06979"></a>06979            p += llen2;
<a name="l06980"></a>06980         }
<a name="l06981"></a>06981     }
<a name="l06982"></a>06982     memcpy(p, <a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(str), size);
<a name="l06983"></a>06983     p += size;
<a name="l06984"></a>06984     <span class="keywordflow">if</span> (flen &lt;= 1) {
<a name="l06985"></a>06985        memset(p, *f, rlen);
<a name="l06986"></a>06986        p += rlen;
<a name="l06987"></a>06987     }
<a name="l06988"></a>06988     <span class="keywordflow">else</span> {
<a name="l06989"></a>06989        <span class="keywordflow">while</span> (rlen &gt;= fclen) {
<a name="l06990"></a>06990             memcpy(p,f,flen);
<a name="l06991"></a>06991             p += flen;
<a name="l06992"></a>06992             rlen -= fclen;
<a name="l06993"></a>06993         }
<a name="l06994"></a>06994        <span class="keywordflow">if</span> (rlen &gt; 0) {
<a name="l06995"></a>06995            memcpy(p, f, rlen2);
<a name="l06996"></a>06996            p += rlen2;
<a name="l06997"></a>06997         }
<a name="l06998"></a>06998     }
<a name="l06999"></a>06999     *p = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l07000"></a>07000     <a class="code" href="../../d1/db0/string_8c.html#a056c7c0a74c83ccdb5a160bbdcbf8c3b">STR_SET_LEN</a>(res, p-<a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(res));
<a name="l07001"></a>07001     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3bf9ab455a1e0e3e8cfc6ebabd8f12df">OBJ_INFECT</a>(res, str);
<a name="l07002"></a>07002     <span class="keywordflow">if</span> (!<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a4832bad8845a35fc50f7a160901854a1">NIL_P</a>(pad)) <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3bf9ab455a1e0e3e8cfc6ebabd8f12df">OBJ_INFECT</a>(res, pad);
<a name="l07003"></a>07003     <a class="code" href="../../d5/db5/encoding_8c.html#a150a6e3ac22ac3be8f8c2ccc74a28e7b">rb_enc_associate</a>(res, enc);
<a name="l07004"></a>07004     <span class="keywordflow">if</span> (argc == 2)
<a name="l07005"></a>07005         cr = <a class="code" href="../../d5/de3/encoding_8h.html#a2a80e28ae5e44f3be150d5b24b65edf6">ENC_CODERANGE_AND</a>(cr, <a class="code" href="../../d5/de3/encoding_8h.html#a5901233f6f9004aebbdeccdd33cf449f">ENC_CODERANGE</a>(pad));
<a name="l07006"></a>07006     <span class="keywordflow">if</span> (cr != <a class="code" href="../../d5/de3/encoding_8h.html#abb86fbc02fc2b78d928825ea6d6922f9">ENC_CODERANGE_BROKEN</a>)
<a name="l07007"></a>07007         <a class="code" href="../../d5/de3/encoding_8h.html#aefe5772c0116cf7131a5227de7243dbc">ENC_CODERANGE_SET</a>(res, cr);
<a name="l07008"></a>07008     <span class="keywordflow">return</span> res;
<a name="l07009"></a>07009 }
<a name="l07010"></a>07010 
<a name="l07011"></a>07011 
<a name="l07012"></a>07012 <span class="comment">/*</span>
<a name="l07013"></a>07013 <span class="comment"> *  call-seq:</span>
<a name="l07014"></a>07014 <span class="comment"> *     str.ljust(integer, padstr=&apos; &apos;)   -&gt; new_str</span>
<a name="l07015"></a>07015 <span class="comment"> *</span>
<a name="l07016"></a>07016 <span class="comment"> *  If &lt;i&gt;integer&lt;/i&gt; is greater than the length of &lt;i&gt;str&lt;/i&gt;, returns a new</span>
<a name="l07017"></a>07017 <span class="comment"> *  &lt;code&gt;String&lt;/code&gt; of length &lt;i&gt;integer&lt;/i&gt; with &lt;i&gt;str&lt;/i&gt; left justified</span>
<a name="l07018"></a>07018 <span class="comment"> *  and padded with &lt;i&gt;padstr&lt;/i&gt;; otherwise, returns &lt;i&gt;str&lt;/i&gt;.</span>
<a name="l07019"></a>07019 <span class="comment"> *</span>
<a name="l07020"></a>07020 <span class="comment"> *     &quot;hello&quot;.ljust(4)            #=&gt; &quot;hello&quot;</span>
<a name="l07021"></a>07021 <span class="comment"> *     &quot;hello&quot;.ljust(20)           #=&gt; &quot;hello               &quot;</span>
<a name="l07022"></a>07022 <span class="comment"> *     &quot;hello&quot;.ljust(20, &apos;1234&apos;)   #=&gt; &quot;hello123412341234123&quot;</span>
<a name="l07023"></a>07023 <span class="comment"> */</span>
<a name="l07024"></a>07024 
<a name="l07025"></a>07025 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l07026"></a><a class="code" href="../../d1/db0/string_8c.html#a86556f3fb43aa17cac2897deb002e143">07026</a> <a class="code" href="../../d1/db0/string_8c.html#a86556f3fb43aa17cac2897deb002e143">rb_str_ljust</a>(<span class="keywordtype">int</span> <a class="code" href="../../df/d77/ruby_8c.html#ad1447518f4372828b8435ae82e48499e">argc</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> *<a class="code" href="../../df/d77/ruby_8c.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str)
<a name="l07027"></a>07027 {
<a name="l07028"></a>07028     <span class="keywordflow">return</span> <a class="code" href="../../d1/db0/string_8c.html#ab580cc475bf997287619247c89c05a93">rb_str_justify</a>(argc, argv, str, <span class="charliteral">&apos;l&apos;</span>);
<a name="l07029"></a>07029 }
<a name="l07030"></a>07030 
<a name="l07031"></a>07031 
<a name="l07032"></a>07032 <span class="comment">/*</span>
<a name="l07033"></a>07033 <span class="comment"> *  call-seq:</span>
<a name="l07034"></a>07034 <span class="comment"> *     str.rjust(integer, padstr=&apos; &apos;)   -&gt; new_str</span>
<a name="l07035"></a>07035 <span class="comment"> *</span>
<a name="l07036"></a>07036 <span class="comment"> *  If &lt;i&gt;integer&lt;/i&gt; is greater than the length of &lt;i&gt;str&lt;/i&gt;, returns a new</span>
<a name="l07037"></a>07037 <span class="comment"> *  &lt;code&gt;String&lt;/code&gt; of length &lt;i&gt;integer&lt;/i&gt; with &lt;i&gt;str&lt;/i&gt; right justified</span>
<a name="l07038"></a>07038 <span class="comment"> *  and padded with &lt;i&gt;padstr&lt;/i&gt;; otherwise, returns &lt;i&gt;str&lt;/i&gt;.</span>
<a name="l07039"></a>07039 <span class="comment"> *</span>
<a name="l07040"></a>07040 <span class="comment"> *     &quot;hello&quot;.rjust(4)            #=&gt; &quot;hello&quot;</span>
<a name="l07041"></a>07041 <span class="comment"> *     &quot;hello&quot;.rjust(20)           #=&gt; &quot;               hello&quot;</span>
<a name="l07042"></a>07042 <span class="comment"> *     &quot;hello&quot;.rjust(20, &apos;1234&apos;)   #=&gt; &quot;123412341234123hello&quot;</span>
<a name="l07043"></a>07043 <span class="comment"> */</span>
<a name="l07044"></a>07044 
<a name="l07045"></a>07045 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l07046"></a><a class="code" href="../../d1/db0/string_8c.html#aa0236999f2f646803abbb4e61b5fd017">07046</a> <a class="code" href="../../d1/db0/string_8c.html#aa0236999f2f646803abbb4e61b5fd017">rb_str_rjust</a>(<span class="keywordtype">int</span> <a class="code" href="../../df/d77/ruby_8c.html#ad1447518f4372828b8435ae82e48499e">argc</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> *<a class="code" href="../../df/d77/ruby_8c.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str)
<a name="l07047"></a>07047 {
<a name="l07048"></a>07048     <span class="keywordflow">return</span> <a class="code" href="../../d1/db0/string_8c.html#ab580cc475bf997287619247c89c05a93">rb_str_justify</a>(argc, argv, str, <span class="charliteral">&apos;r&apos;</span>);
<a name="l07049"></a>07049 }
<a name="l07050"></a>07050 
<a name="l07051"></a>07051 
<a name="l07052"></a>07052 <span class="comment">/*</span>
<a name="l07053"></a>07053 <span class="comment"> *  call-seq:</span>
<a name="l07054"></a>07054 <span class="comment"> *     str.center(integer, padstr)   -&gt; new_str</span>
<a name="l07055"></a>07055 <span class="comment"> *</span>
<a name="l07056"></a>07056 <span class="comment"> *  If &lt;i&gt;integer&lt;/i&gt; is greater than the length of &lt;i&gt;str&lt;/i&gt;, returns a new</span>
<a name="l07057"></a>07057 <span class="comment"> *  &lt;code&gt;String&lt;/code&gt; of length &lt;i&gt;integer&lt;/i&gt; with &lt;i&gt;str&lt;/i&gt; centered and</span>
<a name="l07058"></a>07058 <span class="comment"> *  padded with &lt;i&gt;padstr&lt;/i&gt;; otherwise, returns &lt;i&gt;str&lt;/i&gt;.</span>
<a name="l07059"></a>07059 <span class="comment"> *</span>
<a name="l07060"></a>07060 <span class="comment"> *     &quot;hello&quot;.center(4)         #=&gt; &quot;hello&quot;</span>
<a name="l07061"></a>07061 <span class="comment"> *     &quot;hello&quot;.center(20)        #=&gt; &quot;       hello        &quot;</span>
<a name="l07062"></a>07062 <span class="comment"> *     &quot;hello&quot;.center(20, &apos;123&apos;) #=&gt; &quot;1231231hello12312312&quot;</span>
<a name="l07063"></a>07063 <span class="comment"> */</span>
<a name="l07064"></a>07064 
<a name="l07065"></a>07065 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l07066"></a><a class="code" href="../../d1/db0/string_8c.html#a2935f3513949ad91ad8c65c9208866c7">07066</a> <a class="code" href="../../d1/db0/string_8c.html#a2935f3513949ad91ad8c65c9208866c7">rb_str_center</a>(<span class="keywordtype">int</span> <a class="code" href="../../df/d77/ruby_8c.html#ad1447518f4372828b8435ae82e48499e">argc</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> *<a class="code" href="../../df/d77/ruby_8c.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str)
<a name="l07067"></a>07067 {
<a name="l07068"></a>07068     <span class="keywordflow">return</span> <a class="code" href="../../d1/db0/string_8c.html#ab580cc475bf997287619247c89c05a93">rb_str_justify</a>(argc, argv, str, <span class="charliteral">&apos;c&apos;</span>);
<a name="l07069"></a>07069 }
<a name="l07070"></a>07070 
<a name="l07071"></a>07071 <span class="comment">/*</span>
<a name="l07072"></a>07072 <span class="comment"> *  call-seq:</span>
<a name="l07073"></a>07073 <span class="comment"> *     str.partition(sep)              -&gt; [head, sep, tail]</span>
<a name="l07074"></a>07074 <span class="comment"> *     str.partition(regexp)           -&gt; [head, match, tail]</span>
<a name="l07075"></a>07075 <span class="comment"> *</span>
<a name="l07076"></a>07076 <span class="comment"> *  Searches &lt;i&gt;sep&lt;/i&gt; or pattern (&lt;i&gt;regexp&lt;/i&gt;) in the string</span>
<a name="l07077"></a>07077 <span class="comment"> *  and returns the part before it, the match, and the part</span>
<a name="l07078"></a>07078 <span class="comment"> *  after it.</span>
<a name="l07079"></a>07079 <span class="comment"> *  If it is not found, returns two empty strings and &lt;i&gt;str&lt;/i&gt;.</span>
<a name="l07080"></a>07080 <span class="comment"> *</span>
<a name="l07081"></a>07081 <span class="comment"> *     &quot;hello&quot;.partition(&quot;l&quot;)         #=&gt; [&quot;he&quot;, &quot;l&quot;, &quot;lo&quot;]</span>
<a name="l07082"></a>07082 <span class="comment"> *     &quot;hello&quot;.partition(&quot;x&quot;)         #=&gt; [&quot;hello&quot;, &quot;&quot;, &quot;&quot;]</span>
<a name="l07083"></a>07083 <span class="comment"> *     &quot;hello&quot;.partition(/.l/)        #=&gt; [&quot;h&quot;, &quot;el&quot;, &quot;lo&quot;]</span>
<a name="l07084"></a>07084 <span class="comment"> */</span>
<a name="l07085"></a>07085 
<a name="l07086"></a>07086 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l07087"></a><a class="code" href="../../d1/db0/string_8c.html#afbde2f531c277eaaea33f2b85e9063f1">07087</a> <a class="code" href="../../d1/db0/string_8c.html#afbde2f531c277eaaea33f2b85e9063f1">rb_str_partition</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> sep)
<a name="l07088"></a>07088 {
<a name="l07089"></a>07089     <span class="keywordtype">long</span> pos;
<a name="l07090"></a>07090     <span class="keywordtype">int</span> regex = <a class="code" href="../../d1/d5c/nkf_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l07091"></a>07091 
<a name="l07092"></a>07092     <span class="keywordflow">if</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a394faf7191f18552a20cb17ce14226f0">TYPE</a>(sep) == <a class="code" href="../../de/de6/ruby_2ruby_8h.html#afd5c1e36d171ecc04514332e8dcf6388">T_REGEXP</a>) {
<a name="l07093"></a>07093         pos = <a class="code" href="../../db/db6/re_8h.html#afdf554fa234aebc803c8a4fc98c9936f">rb_reg_search</a>(sep, str, 0, 0);
<a name="l07094"></a>07094         regex = <a class="code" href="../../d1/d5c/nkf_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l07095"></a>07095     }
<a name="l07096"></a>07096     <span class="keywordflow">else</span> {
<a name="l07097"></a>07097         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> tmp;
<a name="l07098"></a>07098 
<a name="l07099"></a>07099         tmp = <a class="code" href="../../db/d2e/intern_8h.html#a669b6063704b2d304844bd1553217cf0">rb_check_string_type</a>(sep);
<a name="l07100"></a>07100         <span class="keywordflow">if</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a4832bad8845a35fc50f7a160901854a1">NIL_P</a>(tmp)) {
<a name="l07101"></a>07101             <a class="code" href="../../db/dcc/error_8c.html#a0f771a2840561f1838169b3d7d4616f3">rb_raise</a>(<a class="code" href="../../db/dcc/error_8c.html#a565ed9d70f4089e1b4a36e9b3381b8c6">rb_eTypeError</a>, <span class="stringliteral">&quot;type mismatch: %s given&quot;</span>,
<a name="l07102"></a>07102                      <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a9b4f42ada717bfbe7a78830639476aed">rb_obj_classname</a>(sep));
<a name="l07103"></a>07103         }
<a name="l07104"></a>07104         sep = tmp;
<a name="l07105"></a>07105         pos = <a class="code" href="../../d1/db0/string_8c.html#a44f92eec2a74155cc1bb3445e7cacaf1">rb_str_index</a>(str, sep, 0);
<a name="l07106"></a>07106     }
<a name="l07107"></a>07107     <span class="keywordflow">if</span> (pos &lt; 0) {
<a name="l07108"></a>07108       failed:
<a name="l07109"></a>07109         <span class="keywordflow">return</span> <a class="code" href="../../dc/dcc/array_8c.html#a8317ecd6a0abb5ad08c50c732f30059b">rb_ary_new3</a>(3, str, str_new_empty(str), str_new_empty(str));
<a name="l07110"></a>07110     }
<a name="l07111"></a>07111     <span class="keywordflow">if</span> (regex) {
<a name="l07112"></a>07112         sep = <a class="code" href="../../d1/db0/string_8c.html#ac0339e2068ff0835aa73f8739841dba8">rb_str_subpat</a>(str, sep, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(0));
<a name="l07113"></a>07113         <span class="keywordflow">if</span> (pos == 0 &amp;&amp; <a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(sep) == 0) <span class="keywordflow">goto</span> failed;
<a name="l07114"></a>07114     }
<a name="l07115"></a>07115     <span class="keywordflow">return</span> <a class="code" href="../../dc/dcc/array_8c.html#a8317ecd6a0abb5ad08c50c732f30059b">rb_ary_new3</a>(3, <a class="code" href="../../db/d2e/intern_8h.html#aadf59e7cbba9319e199d85ef2448a970">rb_str_subseq</a>(str, 0, pos),
<a name="l07116"></a>07116                           sep,
<a name="l07117"></a>07117                           <a class="code" href="../../db/d2e/intern_8h.html#aadf59e7cbba9319e199d85ef2448a970">rb_str_subseq</a>(str, pos+<a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(sep),
<a name="l07118"></a>07118                                              <a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(str)-pos-<a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(sep)));
<a name="l07119"></a>07119 }
<a name="l07120"></a>07120 
<a name="l07121"></a>07121 <span class="comment">/*</span>
<a name="l07122"></a>07122 <span class="comment"> *  call-seq:</span>
<a name="l07123"></a>07123 <span class="comment"> *     str.rpartition(sep)             -&gt; [head, sep, tail]</span>
<a name="l07124"></a>07124 <span class="comment"> *     str.rpartition(regexp)          -&gt; [head, match, tail]</span>
<a name="l07125"></a>07125 <span class="comment"> *</span>
<a name="l07126"></a>07126 <span class="comment"> *  Searches &lt;i&gt;sep&lt;/i&gt; or pattern (&lt;i&gt;regexp&lt;/i&gt;) in the string from the end</span>
<a name="l07127"></a>07127 <span class="comment"> *  of the string, and returns the part before it, the match, and the part</span>
<a name="l07128"></a>07128 <span class="comment"> *  after it.</span>
<a name="l07129"></a>07129 <span class="comment"> *  If it is not found, returns two empty strings and &lt;i&gt;str&lt;/i&gt;.</span>
<a name="l07130"></a>07130 <span class="comment"> *</span>
<a name="l07131"></a>07131 <span class="comment"> *     &quot;hello&quot;.rpartition(&quot;l&quot;)         #=&gt; [&quot;hel&quot;, &quot;l&quot;, &quot;o&quot;]</span>
<a name="l07132"></a>07132 <span class="comment"> *     &quot;hello&quot;.rpartition(&quot;x&quot;)         #=&gt; [&quot;&quot;, &quot;&quot;, &quot;hello&quot;]</span>
<a name="l07133"></a>07133 <span class="comment"> *     &quot;hello&quot;.rpartition(/.l/)        #=&gt; [&quot;he&quot;, &quot;ll&quot;, &quot;o&quot;]</span>
<a name="l07134"></a>07134 <span class="comment"> */</span>
<a name="l07135"></a>07135 
<a name="l07136"></a>07136 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l07137"></a><a class="code" href="../../d1/db0/string_8c.html#a7ab1c8befd748fbbe4bf01d57c5a6fa0">07137</a> <a class="code" href="../../d1/db0/string_8c.html#a7ab1c8befd748fbbe4bf01d57c5a6fa0">rb_str_rpartition</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> sep)
<a name="l07138"></a>07138 {
<a name="l07139"></a>07139     <span class="keywordtype">long</span> pos = <a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(str);
<a name="l07140"></a>07140     <span class="keywordtype">int</span> regex = <a class="code" href="../../d1/d5c/nkf_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l07141"></a>07141 
<a name="l07142"></a>07142     <span class="keywordflow">if</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a394faf7191f18552a20cb17ce14226f0">TYPE</a>(sep) == <a class="code" href="../../de/de6/ruby_2ruby_8h.html#afd5c1e36d171ecc04514332e8dcf6388">T_REGEXP</a>) {
<a name="l07143"></a>07143         pos = <a class="code" href="../../db/db6/re_8h.html#afdf554fa234aebc803c8a4fc98c9936f">rb_reg_search</a>(sep, str, pos, 1);
<a name="l07144"></a>07144         regex = <a class="code" href="../../d1/d5c/nkf_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l07145"></a>07145     }
<a name="l07146"></a>07146     <span class="keywordflow">else</span> {
<a name="l07147"></a>07147         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> tmp;
<a name="l07148"></a>07148 
<a name="l07149"></a>07149         tmp = <a class="code" href="../../db/d2e/intern_8h.html#a669b6063704b2d304844bd1553217cf0">rb_check_string_type</a>(sep);
<a name="l07150"></a>07150         <span class="keywordflow">if</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a4832bad8845a35fc50f7a160901854a1">NIL_P</a>(tmp)) {
<a name="l07151"></a>07151             <a class="code" href="../../db/dcc/error_8c.html#a0f771a2840561f1838169b3d7d4616f3">rb_raise</a>(<a class="code" href="../../db/dcc/error_8c.html#a565ed9d70f4089e1b4a36e9b3381b8c6">rb_eTypeError</a>, <span class="stringliteral">&quot;type mismatch: %s given&quot;</span>,
<a name="l07152"></a>07152                      <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a9b4f42ada717bfbe7a78830639476aed">rb_obj_classname</a>(sep));
<a name="l07153"></a>07153         }
<a name="l07154"></a>07154         sep = tmp;
<a name="l07155"></a>07155         pos = <a class="code" href="../../db/d2e/intern_8h.html#ad9828818c61258f1ddf03369fbcfee61">rb_str_sublen</a>(str, pos);
<a name="l07156"></a>07156         pos = <a class="code" href="../../d1/db0/string_8c.html#ad358453dbd4e7dc51510fd4fe8c6ae83">rb_str_rindex</a>(str, sep, pos);
<a name="l07157"></a>07157     }
<a name="l07158"></a>07158     <span class="keywordflow">if</span> (pos &lt; 0) {
<a name="l07159"></a>07159         <span class="keywordflow">return</span> <a class="code" href="../../dc/dcc/array_8c.html#a8317ecd6a0abb5ad08c50c732f30059b">rb_ary_new3</a>(3, str_new_empty(str), str_new_empty(str), str);
<a name="l07160"></a>07160     }
<a name="l07161"></a>07161     <span class="keywordflow">if</span> (regex) {
<a name="l07162"></a>07162         sep = <a class="code" href="../../db/d2e/intern_8h.html#ac50ab731365028f5efab69c001fba39d">rb_reg_nth_match</a>(0, <a class="code" href="../../db/d2e/intern_8h.html#a2590f9272c0599ff0d1922bd0fb6efce">rb_backref_get</a>());
<a name="l07163"></a>07163     }
<a name="l07164"></a>07164     <span class="keywordflow">return</span> <a class="code" href="../../dc/dcc/array_8c.html#a8317ecd6a0abb5ad08c50c732f30059b">rb_ary_new3</a>(3, <a class="code" href="../../db/d2e/intern_8h.html#a61efad31b183f52fe068b4c0daf8fdd9">rb_str_substr</a>(str, 0, pos),
<a name="l07165"></a>07165                           sep,
<a name="l07166"></a>07166                           <a class="code" href="../../db/d2e/intern_8h.html#a61efad31b183f52fe068b4c0daf8fdd9">rb_str_substr</a>(str,pos+<a class="code" href="../../d1/db0/string_8c.html#abe68504f1d38108a10f267f4358c53db">str_strlen</a>(sep,<a class="code" href="../../d1/db0/string_8c.html#a123891f9f9b0c87d15621d93b4fa9c41">STR_ENC_GET</a>(sep)),<a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(str)));
<a name="l07167"></a>07167 }
<a name="l07168"></a>07168 
<a name="l07169"></a>07169 <span class="comment">/*</span>
<a name="l07170"></a>07170 <span class="comment"> *  call-seq:</span>
<a name="l07171"></a>07171 <span class="comment"> *     str.start_with?([prefix]+)   -&gt; true or false</span>
<a name="l07172"></a>07172 <span class="comment"> *</span>
<a name="l07173"></a>07173 <span class="comment"> *  Returns true if &lt;i&gt;str&lt;/i&gt; starts with one of the prefixes given.</span>
<a name="l07174"></a>07174 <span class="comment"> *</span>
<a name="l07175"></a>07175 <span class="comment"> *    p &quot;hello&quot;.start_with?(&quot;hell&quot;)               #=&gt; true</span>
<a name="l07176"></a>07176 <span class="comment"> *</span>
<a name="l07177"></a>07177 <span class="comment"> *    # returns true if one of the prefixes matches.</span>
<a name="l07178"></a>07178 <span class="comment"> *    p &quot;hello&quot;.start_with?(&quot;heaven&quot;, &quot;hell&quot;)     #=&gt; true</span>
<a name="l07179"></a>07179 <span class="comment"> *    p &quot;hello&quot;.start_with?(&quot;heaven&quot;, &quot;paradise&quot;) #=&gt; false</span>
<a name="l07180"></a>07180 <span class="comment"> *</span>
<a name="l07181"></a>07181 <span class="comment"> *</span>
<a name="l07182"></a>07182 <span class="comment"> *</span>
<a name="l07183"></a>07183 <span class="comment"> */</span>
<a name="l07184"></a>07184 
<a name="l07185"></a>07185 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l07186"></a><a class="code" href="../../d1/db0/string_8c.html#a0731fc293d6e302e73ae12eee71cba03">07186</a> <a class="code" href="../../d1/db0/string_8c.html#a0731fc293d6e302e73ae12eee71cba03">rb_str_start_with</a>(<span class="keywordtype">int</span> <a class="code" href="../../df/d77/ruby_8c.html#ad1447518f4372828b8435ae82e48499e">argc</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> *<a class="code" href="../../df/d77/ruby_8c.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str)
<a name="l07187"></a>07187 {
<a name="l07188"></a>07188     <span class="keywordtype">int</span> i;
<a name="l07189"></a>07189 
<a name="l07190"></a>07190     <span class="keywordflow">for</span> (i=0; i&lt;argc; i++) {
<a name="l07191"></a>07191         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> tmp = <a class="code" href="../../db/d2e/intern_8h.html#a669b6063704b2d304844bd1553217cf0">rb_check_string_type</a>(argv[i]);
<a name="l07192"></a>07192         <span class="keywordflow">if</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a4832bad8845a35fc50f7a160901854a1">NIL_P</a>(tmp)) <span class="keywordflow">continue</span>;
<a name="l07193"></a>07193         <a class="code" href="../../d5/db5/encoding_8c.html#a7d17d602fae27de649f9310511c03db0">rb_enc_check</a>(str, tmp);
<a name="l07194"></a>07194         <span class="keywordflow">if</span> (<a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(str) &lt; <a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(tmp)) <span class="keywordflow">continue</span>;
<a name="l07195"></a>07195         <span class="keywordflow">if</span> (<a class="code" href="../../d5/d21/memcmp_8c.html#a1499ab2d0a3da86cbc3e688294f60a48">memcmp</a>(<a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(str), <a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(tmp), <a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(tmp)) == 0)
<a name="l07196"></a>07196             <span class="keywordflow">return</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aacea3516b33941ce8149098e223a7466">Qtrue</a>;
<a name="l07197"></a>07197     }
<a name="l07198"></a>07198     <span class="keywordflow">return</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aba0717d2689eb68797421a02ab9295c6">Qfalse</a>;
<a name="l07199"></a>07199 }
<a name="l07200"></a>07200 
<a name="l07201"></a>07201 <span class="comment">/*</span>
<a name="l07202"></a>07202 <span class="comment"> *  call-seq:</span>
<a name="l07203"></a>07203 <span class="comment"> *     str.end_with?([suffix]+)   -&gt; true or false</span>
<a name="l07204"></a>07204 <span class="comment"> *</span>
<a name="l07205"></a>07205 <span class="comment"> *  Returns true if &lt;i&gt;str&lt;/i&gt; ends with one of the suffixes given.</span>
<a name="l07206"></a>07206 <span class="comment"> */</span>
<a name="l07207"></a>07207 
<a name="l07208"></a>07208 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l07209"></a><a class="code" href="../../d1/db0/string_8c.html#aa3b97c9649347df60a4abac30687a964">07209</a> <a class="code" href="../../d1/db0/string_8c.html#aa3b97c9649347df60a4abac30687a964">rb_str_end_with</a>(<span class="keywordtype">int</span> <a class="code" href="../../df/d77/ruby_8c.html#ad1447518f4372828b8435ae82e48499e">argc</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> *<a class="code" href="../../df/d77/ruby_8c.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str)
<a name="l07210"></a>07210 {
<a name="l07211"></a>07211     <span class="keywordtype">int</span> i;
<a name="l07212"></a>07212     <span class="keywordtype">char</span> *p, *s, *e;
<a name="l07213"></a>07213     <a class="code" href="../../d1/d7b/struct_onig_encoding_type_s_t.html">rb_encoding</a> *enc;
<a name="l07214"></a>07214 
<a name="l07215"></a>07215     <span class="keywordflow">for</span> (i=0; i&lt;argc; i++) {
<a name="l07216"></a>07216         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> tmp = <a class="code" href="../../db/d2e/intern_8h.html#a669b6063704b2d304844bd1553217cf0">rb_check_string_type</a>(argv[i]);
<a name="l07217"></a>07217         <span class="keywordflow">if</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a4832bad8845a35fc50f7a160901854a1">NIL_P</a>(tmp)) <span class="keywordflow">continue</span>;
<a name="l07218"></a>07218         enc = <a class="code" href="../../d5/db5/encoding_8c.html#a7d17d602fae27de649f9310511c03db0">rb_enc_check</a>(str, tmp);
<a name="l07219"></a>07219         <span class="keywordflow">if</span> (<a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(str) &lt; <a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(tmp)) <span class="keywordflow">continue</span>;
<a name="l07220"></a>07220         p = <a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(str);
<a name="l07221"></a>07221         e = p + <a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(str);
<a name="l07222"></a>07222         s = e - <a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(tmp);
<a name="l07223"></a>07223         <span class="keywordflow">if</span> (<a class="code" href="../../d5/de3/encoding_8h.html#a2282b636d8d5c4c0e73d313cf97a4365">rb_enc_left_char_head</a>(p, s, e, enc) != s)
<a name="l07224"></a>07224             <span class="keywordflow">continue</span>;
<a name="l07225"></a>07225         <span class="keywordflow">if</span> (<a class="code" href="../../d5/d21/memcmp_8c.html#a1499ab2d0a3da86cbc3e688294f60a48">memcmp</a>(s, <a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(tmp), <a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(tmp)) == 0)
<a name="l07226"></a>07226             <span class="keywordflow">return</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aacea3516b33941ce8149098e223a7466">Qtrue</a>;
<a name="l07227"></a>07227     }
<a name="l07228"></a>07228     <span class="keywordflow">return</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aba0717d2689eb68797421a02ab9295c6">Qfalse</a>;
<a name="l07229"></a>07229 }
<a name="l07230"></a>07230 
<a name="l07231"></a>07231 <span class="keywordtype">void</span>
<a name="l07232"></a><a class="code" href="../../d1/db0/string_8c.html#aa60746c422d39791d60ff1dc87528212">07232</a> <a class="code" href="../../db/d2e/intern_8h.html#a7fa2184f1d911ae1342228f818cf376f">rb_str_setter</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> val, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#afa5b9137f051ac26d7ccc8824f178233">ID</a> <span class="keywordtype">id</span>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> *var)
<a name="l07233"></a>07233 {
<a name="l07234"></a>07234     <span class="keywordflow">if</span> (!<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a4832bad8845a35fc50f7a160901854a1">NIL_P</a>(val) &amp;&amp; <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a394faf7191f18552a20cb17ce14226f0">TYPE</a>(val) != <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a22a8c2a4bbaae9b68f65c9bb92fd4e39">T_STRING</a>) {
<a name="l07235"></a>07235         <a class="code" href="../../db/dcc/error_8c.html#a0f771a2840561f1838169b3d7d4616f3">rb_raise</a>(<a class="code" href="../../db/dcc/error_8c.html#a565ed9d70f4089e1b4a36e9b3381b8c6">rb_eTypeError</a>, <span class="stringliteral">&quot;value of %s must be String&quot;</span>, <a class="code" href="../../d5/d11/ripper_8c.html#a877bc58c495643fcf49dc64c44631e72">rb_id2name</a>(<span class="keywordtype">id</span>));
<a name="l07236"></a>07236     }
<a name="l07237"></a>07237     *var = val;
<a name="l07238"></a>07238 }
<a name="l07239"></a>07239 
<a name="l07240"></a>07240 
<a name="l07241"></a>07241 <span class="comment">/*</span>
<a name="l07242"></a>07242 <span class="comment"> *  call-seq:</span>
<a name="l07243"></a>07243 <span class="comment"> *     str.force_encoding(encoding)   -&gt; str</span>
<a name="l07244"></a>07244 <span class="comment"> *</span>
<a name="l07245"></a>07245 <span class="comment"> *  Changes the encoding to +encoding+ and returns self.</span>
<a name="l07246"></a>07246 <span class="comment"> */</span>
<a name="l07247"></a>07247 
<a name="l07248"></a>07248 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l07249"></a><a class="code" href="../../d1/db0/string_8c.html#a16a814b1c310e8a3dcf49a49dd474cbe">07249</a> <a class="code" href="../../d1/db0/string_8c.html#a16a814b1c310e8a3dcf49a49dd474cbe">rb_str_force_encoding</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> enc)
<a name="l07250"></a>07250 {
<a name="l07251"></a>07251     <a class="code" href="../../d1/db0/string_8c.html#a865d4f66b7c8fca1f7fd9afa3298a56e">str_modifiable</a>(str);
<a name="l07252"></a>07252     <a class="code" href="../../d5/db5/encoding_8c.html#a150a6e3ac22ac3be8f8c2ccc74a28e7b">rb_enc_associate</a>(str, <a class="code" href="../../d5/db5/encoding_8c.html#a73a17b842b857bdaf2062107fe898304">rb_to_encoding</a>(enc));
<a name="l07253"></a>07253     <a class="code" href="../../d5/de3/encoding_8h.html#ae0d61803f8b4b76dab41851f686c6a19">ENC_CODERANGE_CLEAR</a>(str);
<a name="l07254"></a>07254     <span class="keywordflow">return</span> str;
<a name="l07255"></a>07255 }
<a name="l07256"></a>07256 
<a name="l07257"></a>07257 <span class="comment">/*</span>
<a name="l07258"></a>07258 <span class="comment"> *  call-seq:</span>
<a name="l07259"></a>07259 <span class="comment"> *     str.valid_encoding?  -&gt; true or false</span>
<a name="l07260"></a>07260 <span class="comment"> *</span>
<a name="l07261"></a>07261 <span class="comment"> *  Returns true for a string which encoded correctly.</span>
<a name="l07262"></a>07262 <span class="comment"> *</span>
<a name="l07263"></a>07263 <span class="comment"> *    &quot;\xc2\xa1&quot;.force_encoding(&quot;UTF-8&quot;).valid_encoding?  #=&gt; true</span>
<a name="l07264"></a>07264 <span class="comment"> *    &quot;\xc2&quot;.force_encoding(&quot;UTF-8&quot;).valid_encoding?      #=&gt; false</span>
<a name="l07265"></a>07265 <span class="comment"> *    &quot;\x80&quot;.force_encoding(&quot;UTF-8&quot;).valid_encoding?      #=&gt; false</span>
<a name="l07266"></a>07266 <span class="comment"> */</span>
<a name="l07267"></a>07267 
<a name="l07268"></a>07268 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l07269"></a><a class="code" href="../../d1/db0/string_8c.html#a2ed7edea8a9bde6cafa7c316a05922db">07269</a> <a class="code" href="../../d1/db0/string_8c.html#a2ed7edea8a9bde6cafa7c316a05922db">rb_str_valid_encoding_p</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str)
<a name="l07270"></a>07270 {
<a name="l07271"></a>07271     <span class="keywordtype">int</span> cr = <a class="code" href="../../d5/de3/encoding_8h.html#a5282c41e11a68fe310f45c9a326ae2b8">rb_enc_str_coderange</a>(str);
<a name="l07272"></a>07272 
<a name="l07273"></a>07273     <span class="keywordflow">return</span> cr == <a class="code" href="../../d5/de3/encoding_8h.html#abb86fbc02fc2b78d928825ea6d6922f9">ENC_CODERANGE_BROKEN</a> ? <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aba0717d2689eb68797421a02ab9295c6">Qfalse</a> : <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aacea3516b33941ce8149098e223a7466">Qtrue</a>;
<a name="l07274"></a>07274 }
<a name="l07275"></a>07275 
<a name="l07276"></a>07276 <span class="comment">/*</span>
<a name="l07277"></a>07277 <span class="comment"> *  call-seq:</span>
<a name="l07278"></a>07278 <span class="comment"> *     str.ascii_only?  -&gt; true or false</span>
<a name="l07279"></a>07279 <span class="comment"> *</span>
<a name="l07280"></a>07280 <span class="comment"> *  Returns true for a string which has only ASCII characters.</span>
<a name="l07281"></a>07281 <span class="comment"> *</span>
<a name="l07282"></a>07282 <span class="comment"> *    &quot;abc&quot;.force_encoding(&quot;UTF-8&quot;).ascii_only?          #=&gt; true</span>
<a name="l07283"></a>07283 <span class="comment"> *    &quot;abc\u{6666}&quot;.force_encoding(&quot;UTF-8&quot;).ascii_only?  #=&gt; false</span>
<a name="l07284"></a>07284 <span class="comment"> */</span>
<a name="l07285"></a>07285 
<a name="l07286"></a>07286 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l07287"></a><a class="code" href="../../d1/db0/string_8c.html#a7517b84343eb5fed8370e95fe2fbc834">07287</a> <a class="code" href="../../d1/db0/string_8c.html#a7517b84343eb5fed8370e95fe2fbc834">rb_str_is_ascii_only_p</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str)
<a name="l07288"></a>07288 {
<a name="l07289"></a>07289     <span class="keywordtype">int</span> cr = <a class="code" href="../../d5/de3/encoding_8h.html#a5282c41e11a68fe310f45c9a326ae2b8">rb_enc_str_coderange</a>(str);
<a name="l07290"></a>07290 
<a name="l07291"></a>07291     <span class="keywordflow">return</span> cr == <a class="code" href="../../d5/de3/encoding_8h.html#a0a0e73a2d98205044e1ad19432502c5b">ENC_CODERANGE_7BIT</a> ? <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aacea3516b33941ce8149098e223a7466">Qtrue</a> : <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aba0717d2689eb68797421a02ab9295c6">Qfalse</a>;
<a name="l07292"></a>07292 }
<a name="l07293"></a>07293 
<a name="l07308"></a>07308 <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l07309"></a><a class="code" href="../../d1/db0/string_8c.html#a459cc90a234ff03491ab74fd0e12fa48">07309</a> <a class="code" href="../../db/d2e/intern_8h.html#aa9eab88a823ad9f5fb71eac803753e2a" title="Shortens _str_ and adds three dots, an ellipsis, if it is longer than _len_ characters...">rb_str_ellipsize</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str, <span class="keywordtype">long</span> len)
<a name="l07310"></a>07310 {
<a name="l07311"></a>07311     <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> ellipsis[] = <span class="stringliteral">&quot;...&quot;</span>;
<a name="l07312"></a>07312     <span class="keyword">const</span> <span class="keywordtype">long</span> ellipsislen = <span class="keyword">sizeof</span>(ellipsis) - 1;
<a name="l07313"></a>07313     <a class="code" href="../../d1/d7b/struct_onig_encoding_type_s_t.html">rb_encoding</a> *<span class="keyword">const</span> enc = <a class="code" href="../../d5/db5/encoding_8c.html#ac21ed764f3b39453b6a848dd64a19585">rb_enc_get</a>(str);
<a name="l07314"></a>07314     <span class="keyword">const</span> <span class="keywordtype">long</span> blen = <a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(str);
<a name="l07315"></a>07315     <span class="keyword">const</span> <span class="keywordtype">char</span> *<span class="keyword">const</span> p = <a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(str), *e = p + blen;
<a name="l07316"></a>07316     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> estr, ret = 0;
<a name="l07317"></a>07317 
<a name="l07318"></a>07318     <span class="keywordflow">if</span> (len &lt; 0) <a class="code" href="../../db/dcc/error_8c.html#a0f771a2840561f1838169b3d7d4616f3">rb_raise</a>(<a class="code" href="../../db/dcc/error_8c.html#ac80019ce275be87f28c42761abe460ee">rb_eIndexError</a>, <span class="stringliteral">&quot;negative length %ld&quot;</span>, len);
<a name="l07319"></a>07319     <span class="keywordflow">if</span> (len * <a class="code" href="../../d5/de3/encoding_8h.html#aaffb0395eb9bf0b3ba3175fa5c9c1615">rb_enc_mbminlen</a>(enc) &gt;= blen ||
<a name="l07320"></a>07320         (e = <a class="code" href="../../d5/de3/encoding_8h.html#a06cebaeb473530e4c2dc6b3151d88832">rb_enc_nth</a>(p, e, len, enc)) - p == blen) {
<a name="l07321"></a>07321         ret = str;
<a name="l07322"></a>07322     }
<a name="l07323"></a>07323     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (len &lt;= ellipsislen ||
<a name="l07324"></a>07324              !(e = <a class="code" href="../../d5/de3/encoding_8h.html#a4421634b913795181a60e06778978fb7">rb_enc_step_back</a>(p, e, e, len = ellipsislen, enc))) {
<a name="l07325"></a>07325         <span class="keywordflow">if</span> (<a class="code" href="../../d5/de3/encoding_8h.html#a8b18a09a3055d3006c6d5baeaa6e7c72">rb_enc_asciicompat</a>(enc)) {
<a name="l07326"></a>07326             ret = <a class="code" href="../../db/d2e/intern_8h.html#a861351a1cb7ae75a5d8b1a0bcec057da">rb_str_new_with_class</a>(str, ellipsis, len);
<a name="l07327"></a>07327             <a class="code" href="../../d5/db5/encoding_8c.html#a150a6e3ac22ac3be8f8c2ccc74a28e7b">rb_enc_associate</a>(ret, enc);
<a name="l07328"></a>07328         }
<a name="l07329"></a>07329         <span class="keywordflow">else</span> {
<a name="l07330"></a>07330             estr = <a class="code" href="../../db/d2e/intern_8h.html#aed107a4eacd5f626b554d2d341b58bd5">rb_usascii_str_new</a>(ellipsis, len);
<a name="l07331"></a>07331             ret = <a class="code" href="../../d5/de3/encoding_8h.html#a92c4c79471eb00ba915287505a118401">rb_str_encode</a>(estr, <a class="code" href="../../d5/db5/encoding_8c.html#ad4918664be7424ab9f961165eecb6c18">rb_enc_from_encoding</a>(enc), 0, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a320970f989dc8294c8203154e3db40c1">Qnil</a>);
<a name="l07332"></a>07332         }
<a name="l07333"></a>07333     }
<a name="l07334"></a>07334     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ret = <a class="code" href="../../db/d2e/intern_8h.html#aadf59e7cbba9319e199d85ef2448a970">rb_str_subseq</a>(str, 0, e - p), <a class="code" href="../../d5/de3/encoding_8h.html#a8b18a09a3055d3006c6d5baeaa6e7c72">rb_enc_asciicompat</a>(enc)) {
<a name="l07335"></a>07335         <a class="code" href="../../db/d2e/intern_8h.html#a4e3e3ccf959b5db6c125a68e1e1db0a3">rb_str_cat</a>(ret, ellipsis, ellipsislen);
<a name="l07336"></a>07336     }
<a name="l07337"></a>07337     <span class="keywordflow">else</span> {
<a name="l07338"></a>07338         estr = <a class="code" href="../../d5/de3/encoding_8h.html#a92c4c79471eb00ba915287505a118401">rb_str_encode</a>(<a class="code" href="../../db/d2e/intern_8h.html#aed107a4eacd5f626b554d2d341b58bd5">rb_usascii_str_new</a>(ellipsis, ellipsislen),
<a name="l07339"></a>07339                              <a class="code" href="../../d5/db5/encoding_8c.html#ad4918664be7424ab9f961165eecb6c18">rb_enc_from_encoding</a>(enc), 0, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a320970f989dc8294c8203154e3db40c1">Qnil</a>);
<a name="l07340"></a>07340         <a class="code" href="../../db/d2e/intern_8h.html#ab592dcd9e193dea76fb0ff58b5d907e4">rb_str_append</a>(ret, estr);
<a name="l07341"></a>07341     }
<a name="l07342"></a>07342     <span class="keywordflow">return</span> ret;
<a name="l07343"></a>07343 }
<a name="l07344"></a>07344 
<a name="l07345"></a>07345 <span class="comment">/**********************************************************************</span>
<a name="l07346"></a>07346 <span class="comment"> * Document-class: Symbol</span>
<a name="l07347"></a>07347 <span class="comment"> *</span>
<a name="l07348"></a>07348 <span class="comment"> *  &lt;code&gt;Symbol&lt;/code&gt; objects represent names and some strings</span>
<a name="l07349"></a>07349 <span class="comment"> *  inside the Ruby</span>
<a name="l07350"></a>07350 <span class="comment"> *  interpreter. They are generated using the &lt;code&gt;:name&lt;/code&gt; and</span>
<a name="l07351"></a>07351 <span class="comment"> *  &lt;code&gt;:&quot;string&quot;&lt;/code&gt; literals</span>
<a name="l07352"></a>07352 <span class="comment"> *  syntax, and by the various &lt;code&gt;to_sym&lt;/code&gt; methods. The same</span>
<a name="l07353"></a>07353 <span class="comment"> *  &lt;code&gt;Symbol&lt;/code&gt; object will be created for a given name or string</span>
<a name="l07354"></a>07354 <span class="comment"> *  for the duration of a program&apos;s execution, regardless of the context</span>
<a name="l07355"></a>07355 <span class="comment"> *  or meaning of that name. Thus if &lt;code&gt;Fred&lt;/code&gt; is a constant in</span>
<a name="l07356"></a>07356 <span class="comment"> *  one context, a method in another, and a class in a third, the</span>
<a name="l07357"></a>07357 <span class="comment"> *  &lt;code&gt;Symbol&lt;/code&gt; &lt;code&gt;:Fred&lt;/code&gt; will be the same object in</span>
<a name="l07358"></a>07358 <span class="comment"> *  all three contexts.</span>
<a name="l07359"></a>07359 <span class="comment"> *</span>
<a name="l07360"></a>07360 <span class="comment"> *     module One</span>
<a name="l07361"></a>07361 <span class="comment"> *       class Fred</span>
<a name="l07362"></a>07362 <span class="comment"> *       end</span>
<a name="l07363"></a>07363 <span class="comment"> *       $f1 = :Fred</span>
<a name="l07364"></a>07364 <span class="comment"> *     end</span>
<a name="l07365"></a>07365 <span class="comment"> *     module Two</span>
<a name="l07366"></a>07366 <span class="comment"> *       Fred = 1</span>
<a name="l07367"></a>07367 <span class="comment"> *       $f2 = :Fred</span>
<a name="l07368"></a>07368 <span class="comment"> *     end</span>
<a name="l07369"></a>07369 <span class="comment"> *     def Fred()</span>
<a name="l07370"></a>07370 <span class="comment"> *     end</span>
<a name="l07371"></a>07371 <span class="comment"> *     $f3 = :Fred</span>
<a name="l07372"></a>07372 <span class="comment"> *     $f1.object_id   #=&gt; 2514190</span>
<a name="l07373"></a>07373 <span class="comment"> *     $f2.object_id   #=&gt; 2514190</span>
<a name="l07374"></a>07374 <span class="comment"> *     $f3.object_id   #=&gt; 2514190</span>
<a name="l07375"></a>07375 <span class="comment"> *</span>
<a name="l07376"></a>07376 <span class="comment"> */</span>
<a name="l07377"></a>07377 
<a name="l07378"></a>07378 
<a name="l07379"></a>07379 <span class="comment">/*</span>
<a name="l07380"></a>07380 <span class="comment"> *  call-seq:</span>
<a name="l07381"></a>07381 <span class="comment"> *     sym == obj   -&gt; true or false</span>
<a name="l07382"></a>07382 <span class="comment"> *</span>
<a name="l07383"></a>07383 <span class="comment"> *  Equality---If &lt;i&gt;sym&lt;/i&gt; and &lt;i&gt;obj&lt;/i&gt; are exactly the same</span>
<a name="l07384"></a>07384 <span class="comment"> *  symbol, returns &lt;code&gt;true&lt;/code&gt;.</span>
<a name="l07385"></a>07385 <span class="comment"> */</span>
<a name="l07386"></a>07386 
<a name="l07387"></a>07387 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l07388"></a><a class="code" href="../../d1/db0/string_8c.html#a480b75ffec5563f1d35627dc3abab4a1">07388</a> <a class="code" href="../../d1/db0/string_8c.html#a480b75ffec5563f1d35627dc3abab4a1">sym_equal</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> sym1, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> sym2)
<a name="l07389"></a>07389 {
<a name="l07390"></a>07390     <span class="keywordflow">if</span> (sym1 == sym2) <span class="keywordflow">return</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aacea3516b33941ce8149098e223a7466">Qtrue</a>;
<a name="l07391"></a>07391     <span class="keywordflow">return</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aba0717d2689eb68797421a02ab9295c6">Qfalse</a>;
<a name="l07392"></a>07392 }
<a name="l07393"></a>07393 
<a name="l07394"></a>07394 
<a name="l07395"></a>07395 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l07396"></a><a class="code" href="../../d1/db0/string_8c.html#afb9d4fb805470a9933698467d3ef6abc">07396</a> <a class="code" href="../../d1/db0/string_8c.html#afb9d4fb805470a9933698467d3ef6abc">sym_printable</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *s, <span class="keyword">const</span> <span class="keywordtype">char</span> *send, <a class="code" href="../../d1/d7b/struct_onig_encoding_type_s_t.html">rb_encoding</a> *enc)
<a name="l07397"></a>07397 {
<a name="l07398"></a>07398     <span class="keywordflow">while</span> (s &lt; send) {
<a name="l07399"></a>07399         <span class="keywordtype">int</span> n;
<a name="l07400"></a>07400         <span class="keywordtype">int</span> c = <a class="code" href="../../d5/db5/encoding_8c.html#a25e1e0b74ee98f47dd26a44bb11b7b3c">rb_enc_codepoint_len</a>(s, send, &amp;n, enc);
<a name="l07401"></a>07401 
<a name="l07402"></a>07402         <span class="keywordflow">if</span> (!<a class="code" href="../../d5/de3/encoding_8h.html#aa48d3160680fc51c021c3ddba69d0064">rb_enc_isprint</a>(c, enc)) <span class="keywordflow">return</span> <a class="code" href="../../d1/d5c/nkf_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l07403"></a>07403         s += n;
<a name="l07404"></a>07404     }
<a name="l07405"></a>07405     <span class="keywordflow">return</span> <a class="code" href="../../d1/d5c/nkf_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l07406"></a>07406 }
<a name="l07407"></a>07407 
<a name="l07408"></a>07408 <span class="comment">/*</span>
<a name="l07409"></a>07409 <span class="comment"> *  call-seq:</span>
<a name="l07410"></a>07410 <span class="comment"> *     sym.inspect    -&gt; string</span>
<a name="l07411"></a>07411 <span class="comment"> *</span>
<a name="l07412"></a>07412 <span class="comment"> *  Returns the representation of &lt;i&gt;sym&lt;/i&gt; as a symbol literal.</span>
<a name="l07413"></a>07413 <span class="comment"> *</span>
<a name="l07414"></a>07414 <span class="comment"> *     :fred.inspect   #=&gt; &quot;:fred&quot;</span>
<a name="l07415"></a>07415 <span class="comment"> */</span>
<a name="l07416"></a>07416 
<a name="l07417"></a>07417 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l07418"></a><a class="code" href="../../d1/db0/string_8c.html#a3f69a8436d382625437ad9b542b2c53c">07418</a> <a class="code" href="../../d1/db0/string_8c.html#a3f69a8436d382625437ad9b542b2c53c">sym_inspect</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <a class="code" href="../../dd/dc0/date__core_8c.html#a8157485e687f56a6ae2f3ee0a8cb1580">sym</a>)
<a name="l07419"></a>07419 {
<a name="l07420"></a>07420     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str;
<a name="l07421"></a>07421     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#afa5b9137f051ac26d7ccc8824f178233">ID</a> <span class="keywordtype">id</span> = <a class="code" href="../../dc/d0c/cparse_8c.html#a73ce5202e6172d3ad0bab7d1e0df9dae">SYM2ID</a>(sym);
<a name="l07422"></a>07422     <a class="code" href="../../d1/d7b/struct_onig_encoding_type_s_t.html">rb_encoding</a> *enc;
<a name="l07423"></a>07423     <span class="keyword">const</span> <span class="keywordtype">char</span> *ptr;
<a name="l07424"></a>07424     <span class="keywordtype">long</span> len;
<a name="l07425"></a>07425     <span class="keywordtype">char</span> *dest;
<a name="l07426"></a>07426     <a class="code" href="../../d1/d7b/struct_onig_encoding_type_s_t.html">rb_encoding</a> *resenc = <a class="code" href="../../d5/db5/encoding_8c.html#a62b808940b1049f1af6233cbbb828bd6">rb_default_internal_encoding</a>();
<a name="l07427"></a>07427 
<a name="l07428"></a>07428     <span class="keywordflow">if</span> (resenc == <a class="code" href="../../d3/d09/ripper_8y.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) resenc = <a class="code" href="../../d5/db5/encoding_8c.html#a0724183879562529f7d3365ef5115b6d">rb_default_external_encoding</a>();
<a name="l07429"></a>07429     sym = <a class="code" href="../../d5/d11/ripper_8c.html#aec42ef320e57234e789bdda6d655716f">rb_id2str</a>(<span class="keywordtype">id</span>);
<a name="l07430"></a>07430     enc = <a class="code" href="../../d1/db0/string_8c.html#a123891f9f9b0c87d15621d93b4fa9c41">STR_ENC_GET</a>(sym);
<a name="l07431"></a>07431     ptr = <a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(sym);
<a name="l07432"></a>07432     len = <a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(sym);
<a name="l07433"></a>07433     <span class="keywordflow">if</span> ((resenc != enc &amp;&amp; !<a class="code" href="../../d1/db0/string_8c.html#a7517b84343eb5fed8370e95fe2fbc834">rb_str_is_ascii_only_p</a>(sym)) || len != (<span class="keywordtype">long</span>)<a class="code" href="../../d6/d7b/strchr_8c.html#a219836f542ce53545052bed5353820ca">strlen</a>(ptr) ||
<a name="l07434"></a>07434         !<a class="code" href="../../d5/d11/ripper_8c.html#a376c00a06426d1d4e1bdb82f937a8784">rb_enc_symname_p</a>(ptr, enc) || !<a class="code" href="../../d1/db0/string_8c.html#afb9d4fb805470a9933698467d3ef6abc">sym_printable</a>(ptr, ptr + len, enc)) {
<a name="l07435"></a>07435         str = <a class="code" href="../../db/d2e/intern_8h.html#a683d7a310ce87bf1aa5b5b3ea0d93ead">rb_str_inspect</a>(sym);
<a name="l07436"></a>07436         len = <a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(str);
<a name="l07437"></a>07437         <a class="code" href="../../db/d2e/intern_8h.html#a0a133856edb99f69eae3cb5a9e275ac9">rb_str_resize</a>(str, len + 1);
<a name="l07438"></a>07438         dest = <a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(str);
<a name="l07439"></a>07439         <a class="code" href="../../d3/d90/missing_8h.html#a809a3e9326a0d3e5aa549b17085b057d">memmove</a>(dest + 1, dest, len);
<a name="l07440"></a>07440         dest[0] = <span class="charliteral">&apos;:&apos;</span>;
<a name="l07441"></a>07441     }
<a name="l07442"></a>07442     <span class="keywordflow">else</span> {
<a name="l07443"></a>07443         <span class="keywordtype">char</span> *dest;
<a name="l07444"></a>07444         str = <a class="code" href="../../d5/de3/encoding_8h.html#a6707b730597e0e614213beb11670aca2">rb_enc_str_new</a>(0, len + 1, enc);
<a name="l07445"></a>07445         dest = <a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(str);
<a name="l07446"></a>07446         dest[0] = <span class="charliteral">&apos;:&apos;</span>;
<a name="l07447"></a>07447         memcpy(dest + 1, ptr, len);
<a name="l07448"></a>07448     }
<a name="l07449"></a>07449     <span class="keywordflow">return</span> str;
<a name="l07450"></a>07450 }
<a name="l07451"></a>07451 
<a name="l07452"></a>07452 
<a name="l07453"></a>07453 <span class="comment">/*</span>
<a name="l07454"></a>07454 <span class="comment"> *  call-seq:</span>
<a name="l07455"></a>07455 <span class="comment"> *     sym.id2name   -&gt; string</span>
<a name="l07456"></a>07456 <span class="comment"> *     sym.to_s      -&gt; string</span>
<a name="l07457"></a>07457 <span class="comment"> *</span>
<a name="l07458"></a>07458 <span class="comment"> *  Returns the name or string corresponding to &lt;i&gt;sym&lt;/i&gt;.</span>
<a name="l07459"></a>07459 <span class="comment"> *</span>
<a name="l07460"></a>07460 <span class="comment"> *     :fred.id2name   #=&gt; &quot;fred&quot;</span>
<a name="l07461"></a>07461 <span class="comment"> */</span>
<a name="l07462"></a>07462 
<a name="l07463"></a>07463 
<a name="l07464"></a>07464 <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l07465"></a><a class="code" href="../../d1/db0/string_8c.html#a2fc02b2705e845e456f4cc6006365a9f">07465</a> <a class="code" href="../../db/d2e/intern_8h.html#a6b530fce35a344ec394c08c6643cdd8a">rb_sym_to_s</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <a class="code" href="../../dd/dc0/date__core_8c.html#a8157485e687f56a6ae2f3ee0a8cb1580">sym</a>)
<a name="l07466"></a>07466 {
<a name="l07467"></a>07467     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#afa5b9137f051ac26d7ccc8824f178233">ID</a> <span class="keywordtype">id</span> = <a class="code" href="../../dc/d0c/cparse_8c.html#a73ce5202e6172d3ad0bab7d1e0df9dae">SYM2ID</a>(sym);
<a name="l07468"></a>07468 
<a name="l07469"></a>07469     <span class="keywordflow">return</span> <a class="code" href="../../d1/db0/string_8c.html#a4d8a594117e1ef7b3ca1b0466b384256">str_new3</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a7d36c9c3e9faa34c27eb7f2eb9c874a8">rb_cString</a>, <a class="code" href="../../d5/d11/ripper_8c.html#aec42ef320e57234e789bdda6d655716f">rb_id2str</a>(<span class="keywordtype">id</span>));
<a name="l07470"></a>07470 }
<a name="l07471"></a>07471 
<a name="l07472"></a>07472 
<a name="l07473"></a>07473 <span class="comment">/*</span>
<a name="l07474"></a>07474 <span class="comment"> * call-seq:</span>
<a name="l07475"></a>07475 <span class="comment"> *   sym.to_sym   -&gt; sym</span>
<a name="l07476"></a>07476 <span class="comment"> *   sym.intern   -&gt; sym</span>
<a name="l07477"></a>07477 <span class="comment"> *</span>
<a name="l07478"></a>07478 <span class="comment"> * In general, &lt;code&gt;to_sym&lt;/code&gt; returns the &lt;code&gt;Symbol&lt;/code&gt; corresponding</span>
<a name="l07479"></a>07479 <span class="comment"> * to an object. As &lt;i&gt;sym&lt;/i&gt; is already a symbol, &lt;code&gt;self&lt;/code&gt; is returned</span>
<a name="l07480"></a>07480 <span class="comment"> * in this case.</span>
<a name="l07481"></a>07481 <span class="comment"> */</span>
<a name="l07482"></a>07482 
<a name="l07483"></a>07483 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l07484"></a><a class="code" href="../../d1/db0/string_8c.html#a5e49903726679a5a5b2e8e0400b70da2">07484</a> <a class="code" href="../../d1/db0/string_8c.html#a5e49903726679a5a5b2e8e0400b70da2">sym_to_sym</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <a class="code" href="../../dd/dc0/date__core_8c.html#a8157485e687f56a6ae2f3ee0a8cb1580">sym</a>)
<a name="l07485"></a>07485 {
<a name="l07486"></a>07486     <span class="keywordflow">return</span> sym;
<a name="l07487"></a>07487 }
<a name="l07488"></a>07488 
<a name="l07489"></a>07489 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l07490"></a><a class="code" href="../../d1/db0/string_8c.html#a2859b3027a70570643023b8e1e168725">07490</a> <a class="code" href="../../d1/db0/string_8c.html#a2859b3027a70570643023b8e1e168725">sym_call</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <a class="code" href="../../d3/d09/ripper_8y.html#a8187411843a6284ffb964ef3fb9fcab3">args</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <a class="code" href="../../dd/dc0/date__core_8c.html#a8157485e687f56a6ae2f3ee0a8cb1580">sym</a>, <span class="keywordtype">int</span> <a class="code" href="../../df/d77/ruby_8c.html#ad1447518f4372828b8435ae82e48499e">argc</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> *<a class="code" href="../../df/d77/ruby_8c.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>)
<a name="l07491"></a>07491 {
<a name="l07492"></a>07492     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> obj;
<a name="l07493"></a>07493 
<a name="l07494"></a>07494     <span class="keywordflow">if</span> (argc &lt; 1) {
<a name="l07495"></a>07495         <a class="code" href="../../db/dcc/error_8c.html#a0f771a2840561f1838169b3d7d4616f3">rb_raise</a>(<a class="code" href="../../db/dcc/error_8c.html#ab5e2a9fec766c75176fbb262bfe6a596">rb_eArgError</a>, <span class="stringliteral">&quot;no receiver given&quot;</span>);
<a name="l07496"></a>07496     }
<a name="l07497"></a>07497     obj = argv[0];
<a name="l07498"></a>07498     <span class="keywordflow">return</span> <a class="code" href="../../dd/de7/passing__block_8c.html#a6d8090fb4b1b60f648b2d63a0c6b40d1">rb_funcall_passing_block</a>(obj, (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#afa5b9137f051ac26d7ccc8824f178233">ID</a>)sym, argc - 1, argv + 1);
<a name="l07499"></a>07499 }
<a name="l07500"></a>07500 
<a name="l07501"></a>07501 <span class="comment">/*</span>
<a name="l07502"></a>07502 <span class="comment"> * call-seq:</span>
<a name="l07503"></a>07503 <span class="comment"> *   sym.to_proc</span>
<a name="l07504"></a>07504 <span class="comment"> *</span>
<a name="l07505"></a>07505 <span class="comment"> * Returns a _Proc_ object which respond to the given method by _sym_.</span>
<a name="l07506"></a>07506 <span class="comment"> *</span>
<a name="l07507"></a>07507 <span class="comment"> *   (1..3).collect(&amp;:to_s)  #=&gt; [&quot;1&quot;, &quot;2&quot;, &quot;3&quot;]</span>
<a name="l07508"></a>07508 <span class="comment"> */</span>
<a name="l07509"></a>07509 
<a name="l07510"></a>07510 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l07511"></a><a class="code" href="../../d1/db0/string_8c.html#a7919b8fd2d92bda5aa70ca89b1675a57">07511</a> <a class="code" href="../../d1/db0/string_8c.html#a7919b8fd2d92bda5aa70ca89b1675a57">sym_to_proc</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <a class="code" href="../../dd/dc0/date__core_8c.html#a8157485e687f56a6ae2f3ee0a8cb1580">sym</a>)
<a name="l07512"></a>07512 {
<a name="l07513"></a>07513     <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> sym_proc_cache = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aba0717d2689eb68797421a02ab9295c6">Qfalse</a>;
<a name="l07514"></a>07514     <span class="keyword">enum</span> {SYM_PROC_CACHE_SIZE = 67};
<a name="l07515"></a>07515     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> proc;
<a name="l07516"></a>07516     <span class="keywordtype">long</span> <a class="code" href="../../d6/da0/nkf-utf8_2nkf_8c.html#a64ae40793ade89d800a8c5646d2980fc">id</a>, index;
<a name="l07517"></a>07517     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> *aryp;
<a name="l07518"></a>07518 
<a name="l07519"></a>07519     <span class="keywordflow">if</span> (!sym_proc_cache) {
<a name="l07520"></a>07520         sym_proc_cache = <a class="code" href="../../dc/dcc/array_8c.html#aaf7e3ca42191580b60f398d5ec466766">rb_ary_tmp_new</a>(SYM_PROC_CACHE_SIZE * 2);
<a name="l07521"></a>07521         <a class="code" href="../../d8/d16/gc_8c.html#adc7efe8997f04b5c275d7e7aed9169e3">rb_gc_register_mark_object</a>(sym_proc_cache);
<a name="l07522"></a>07522         <a class="code" href="../../dc/dcc/array_8c.html#a1d7683de2cd34217808092d90ffd0869">rb_ary_store</a>(sym_proc_cache, SYM_PROC_CACHE_SIZE*2 - 1, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a320970f989dc8294c8203154e3db40c1">Qnil</a>);
<a name="l07523"></a>07523     }
<a name="l07524"></a>07524 
<a name="l07525"></a>07525     <span class="keywordtype">id</span> = <a class="code" href="../../dc/d0c/cparse_8c.html#a73ce5202e6172d3ad0bab7d1e0df9dae">SYM2ID</a>(sym);
<a name="l07526"></a>07526     index = (<span class="keywordtype">id</span> % SYM_PROC_CACHE_SIZE) &lt;&lt; 1;
<a name="l07527"></a>07527 
<a name="l07528"></a>07528     aryp = <a class="code" href="../../d8/df4/generator_8h.html#abb794fe2d7c73eea87e7ba2273939a8e">RARRAY_PTR</a>(sym_proc_cache);
<a name="l07529"></a>07529     <span class="keywordflow">if</span> (aryp[index] == sym) {
<a name="l07530"></a>07530         <span class="keywordflow">return</span> aryp[index + 1];
<a name="l07531"></a>07531     }
<a name="l07532"></a>07532     <span class="keywordflow">else</span> {
<a name="l07533"></a>07533         proc = <a class="code" href="../../db/d2e/intern_8h.html#a8a4a55d3f2ed6d9ece055553e48755d5">rb_proc_new</a>(<a class="code" href="../../d1/db0/string_8c.html#a2859b3027a70570643023b8e1e168725">sym_call</a>, (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>)<span class="keywordtype">id</span>);
<a name="l07534"></a>07534         aryp[index] = sym;
<a name="l07535"></a>07535         aryp[index + 1] = proc;
<a name="l07536"></a>07536         <span class="keywordflow">return</span> proc;
<a name="l07537"></a>07537     }
<a name="l07538"></a>07538 }
<a name="l07539"></a>07539 
<a name="l07540"></a>07540 <span class="comment">/*</span>
<a name="l07541"></a>07541 <span class="comment"> * call-seq:</span>
<a name="l07542"></a>07542 <span class="comment"> *</span>
<a name="l07543"></a>07543 <span class="comment"> *   sym.succ</span>
<a name="l07544"></a>07544 <span class="comment"> *</span>
<a name="l07545"></a>07545 <span class="comment"> * Same as &lt;code&gt;sym.to_s.succ.intern&lt;/code&gt;.</span>
<a name="l07546"></a>07546 <span class="comment"> */</span>
<a name="l07547"></a>07547 
<a name="l07548"></a>07548 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l07549"></a><a class="code" href="../../d1/db0/string_8c.html#ad70e56e026df956840d67c9bedda0834">07549</a> <a class="code" href="../../d1/db0/string_8c.html#ad70e56e026df956840d67c9bedda0834">sym_succ</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <a class="code" href="../../dd/dc0/date__core_8c.html#a8157485e687f56a6ae2f3ee0a8cb1580">sym</a>)
<a name="l07550"></a>07550 {
<a name="l07551"></a>07551     <span class="keywordflow">return</span> <a class="code" href="../../db/d2e/intern_8h.html#abee4398ccf077c9cab2d51c5d2d25c22">rb_str_intern</a>(<a class="code" href="../../db/d2e/intern_8h.html#af513b28149fbaaa7fecd52e514a679c2">rb_str_succ</a>(<a class="code" href="../../db/d2e/intern_8h.html#a6b530fce35a344ec394c08c6643cdd8a">rb_sym_to_s</a>(sym)));
<a name="l07552"></a>07552 }
<a name="l07553"></a>07553 
<a name="l07554"></a>07554 <span class="comment">/*</span>
<a name="l07555"></a>07555 <span class="comment"> * call-seq:</span>
<a name="l07556"></a>07556 <span class="comment"> *</span>
<a name="l07557"></a>07557 <span class="comment"> *   str &lt;=&gt; other       -&gt; -1, 0, +1 or nil</span>
<a name="l07558"></a>07558 <span class="comment"> *</span>
<a name="l07559"></a>07559 <span class="comment"> * Compares _sym_ with _other_ in string form.</span>
<a name="l07560"></a>07560 <span class="comment"> */</span>
<a name="l07561"></a>07561 
<a name="l07562"></a>07562 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l07563"></a><a class="code" href="../../d1/db0/string_8c.html#a89bcccd871024584794f70d51a690a40">07563</a> <a class="code" href="../../d1/db0/string_8c.html#a89bcccd871024584794f70d51a690a40">sym_cmp</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <a class="code" href="../../dd/dc0/date__core_8c.html#a8157485e687f56a6ae2f3ee0a8cb1580">sym</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> other)
<a name="l07564"></a>07564 {
<a name="l07565"></a>07565     <span class="keywordflow">if</span> (!<a class="code" href="../../dc/d0c/cparse_8c.html#a637bc5a232034ee3fd411f8bef091566">SYMBOL_P</a>(other)) {
<a name="l07566"></a>07566         <span class="keywordflow">return</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a320970f989dc8294c8203154e3db40c1">Qnil</a>;
<a name="l07567"></a>07567     }
<a name="l07568"></a>07568     <span class="keywordflow">return</span> <a class="code" href="../../d1/db0/string_8c.html#acd850d5463cfc6fe6381214f156b7e4d">rb_str_cmp_m</a>(<a class="code" href="../../db/d2e/intern_8h.html#a6b530fce35a344ec394c08c6643cdd8a">rb_sym_to_s</a>(sym), <a class="code" href="../../db/d2e/intern_8h.html#a6b530fce35a344ec394c08c6643cdd8a">rb_sym_to_s</a>(other));
<a name="l07569"></a>07569 }
<a name="l07570"></a>07570 
<a name="l07571"></a>07571 <span class="comment">/*</span>
<a name="l07572"></a>07572 <span class="comment"> * call-seq:</span>
<a name="l07573"></a>07573 <span class="comment"> *</span>
<a name="l07574"></a>07574 <span class="comment"> *   sym.casecmp(other)  -&gt; -1, 0, +1 or nil</span>
<a name="l07575"></a>07575 <span class="comment"> *</span>
<a name="l07576"></a>07576 <span class="comment"> * Case-insensitive version of &lt;code&gt;Symbol#&lt;=&gt;&lt;/code&gt;.</span>
<a name="l07577"></a>07577 <span class="comment"> */</span>
<a name="l07578"></a>07578 
<a name="l07579"></a>07579 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l07580"></a><a class="code" href="../../d1/db0/string_8c.html#aff940dabdc26baa745c8c92f2a144a9c">07580</a> <a class="code" href="../../d1/db0/string_8c.html#aff940dabdc26baa745c8c92f2a144a9c">sym_casecmp</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <a class="code" href="../../dd/dc0/date__core_8c.html#a8157485e687f56a6ae2f3ee0a8cb1580">sym</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> other)
<a name="l07581"></a>07581 {
<a name="l07582"></a>07582     <span class="keywordflow">if</span> (!<a class="code" href="../../dc/d0c/cparse_8c.html#a637bc5a232034ee3fd411f8bef091566">SYMBOL_P</a>(other)) {
<a name="l07583"></a>07583         <span class="keywordflow">return</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a320970f989dc8294c8203154e3db40c1">Qnil</a>;
<a name="l07584"></a>07584     }
<a name="l07585"></a>07585     <span class="keywordflow">return</span> <a class="code" href="../../d1/db0/string_8c.html#ada0bd9e6e4de059fed412adf1649fc09">rb_str_casecmp</a>(<a class="code" href="../../db/d2e/intern_8h.html#a6b530fce35a344ec394c08c6643cdd8a">rb_sym_to_s</a>(sym), <a class="code" href="../../db/d2e/intern_8h.html#a6b530fce35a344ec394c08c6643cdd8a">rb_sym_to_s</a>(other));
<a name="l07586"></a>07586 }
<a name="l07587"></a>07587 
<a name="l07588"></a>07588 <span class="comment">/*</span>
<a name="l07589"></a>07589 <span class="comment"> * call-seq:</span>
<a name="l07590"></a>07590 <span class="comment"> *   sym =~ obj   -&gt; fixnum or nil</span>
<a name="l07591"></a>07591 <span class="comment"> *</span>
<a name="l07592"></a>07592 <span class="comment"> * Returns &lt;code&gt;sym.to_s =~ obj&lt;/code&gt;.</span>
<a name="l07593"></a>07593 <span class="comment"> */</span>
<a name="l07594"></a>07594 
<a name="l07595"></a>07595 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l07596"></a><a class="code" href="../../d1/db0/string_8c.html#abef17c9e8f1e5e809800842c297ebaf2">07596</a> <a class="code" href="../../d1/db0/string_8c.html#abef17c9e8f1e5e809800842c297ebaf2">sym_match</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <a class="code" href="../../dd/dc0/date__core_8c.html#a8157485e687f56a6ae2f3ee0a8cb1580">sym</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> other)
<a name="l07597"></a>07597 {
<a name="l07598"></a>07598     <span class="keywordflow">return</span> <a class="code" href="../../d1/db0/string_8c.html#a2715777ab2236ea2aaae11365122b861">rb_str_match</a>(<a class="code" href="../../db/d2e/intern_8h.html#a6b530fce35a344ec394c08c6643cdd8a">rb_sym_to_s</a>(sym), other);
<a name="l07599"></a>07599 }
<a name="l07600"></a>07600 
<a name="l07601"></a>07601 <span class="comment">/*</span>
<a name="l07602"></a>07602 <span class="comment"> * call-seq:</span>
<a name="l07603"></a>07603 <span class="comment"> *   sym[idx]      -&gt; char</span>
<a name="l07604"></a>07604 <span class="comment"> *   sym[b, n]     -&gt; char</span>
<a name="l07605"></a>07605 <span class="comment"> *</span>
<a name="l07606"></a>07606 <span class="comment"> * Returns &lt;code&gt;sym.to_s[]&lt;/code&gt;.</span>
<a name="l07607"></a>07607 <span class="comment"> */</span>
<a name="l07608"></a>07608 
<a name="l07609"></a>07609 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l07610"></a><a class="code" href="../../d1/db0/string_8c.html#ae2e5ebd749fdd7d0e5ea715cab2ed56a">07610</a> <a class="code" href="../../d1/db0/string_8c.html#ae2e5ebd749fdd7d0e5ea715cab2ed56a">sym_aref</a>(<span class="keywordtype">int</span> <a class="code" href="../../df/d77/ruby_8c.html#ad1447518f4372828b8435ae82e48499e">argc</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> *<a class="code" href="../../df/d77/ruby_8c.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <a class="code" href="../../dd/dc0/date__core_8c.html#a8157485e687f56a6ae2f3ee0a8cb1580">sym</a>)
<a name="l07611"></a>07611 {
<a name="l07612"></a>07612     <span class="keywordflow">return</span> <a class="code" href="../../d1/db0/string_8c.html#aa5327105773f1bfb1799f4a6b04587e7">rb_str_aref_m</a>(argc, argv, <a class="code" href="../../db/d2e/intern_8h.html#a6b530fce35a344ec394c08c6643cdd8a">rb_sym_to_s</a>(sym));
<a name="l07613"></a>07613 }
<a name="l07614"></a>07614 
<a name="l07615"></a>07615 <span class="comment">/*</span>
<a name="l07616"></a>07616 <span class="comment"> * call-seq:</span>
<a name="l07617"></a>07617 <span class="comment"> *   sym.length    -&gt; integer</span>
<a name="l07618"></a>07618 <span class="comment"> *</span>
<a name="l07619"></a>07619 <span class="comment"> * Same as &lt;code&gt;sym.to_s.length&lt;/code&gt;.</span>
<a name="l07620"></a>07620 <span class="comment"> */</span>
<a name="l07621"></a>07621 
<a name="l07622"></a>07622 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l07623"></a><a class="code" href="../../d1/db0/string_8c.html#ad655c23c89a24a8d8159ddb7ec3b248d">07623</a> <a class="code" href="../../d1/db0/string_8c.html#ad655c23c89a24a8d8159ddb7ec3b248d">sym_length</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <a class="code" href="../../dd/dc0/date__core_8c.html#a8157485e687f56a6ae2f3ee0a8cb1580">sym</a>)
<a name="l07624"></a>07624 {
<a name="l07625"></a>07625     <span class="keywordflow">return</span> <a class="code" href="../../db/d2e/intern_8h.html#aed0efe9b6a433458fbc9736a9c57d410">rb_str_length</a>(<a class="code" href="../../d5/d11/ripper_8c.html#aec42ef320e57234e789bdda6d655716f">rb_id2str</a>(<a class="code" href="../../dc/d0c/cparse_8c.html#a73ce5202e6172d3ad0bab7d1e0df9dae">SYM2ID</a>(sym)));
<a name="l07626"></a>07626 }
<a name="l07627"></a>07627 
<a name="l07628"></a>07628 <span class="comment">/*</span>
<a name="l07629"></a>07629 <span class="comment"> * call-seq:</span>
<a name="l07630"></a>07630 <span class="comment"> *   sym.empty?   -&gt; true or false</span>
<a name="l07631"></a>07631 <span class="comment"> *</span>
<a name="l07632"></a>07632 <span class="comment"> * Returns that _sym_ is :&quot;&quot; or not.</span>
<a name="l07633"></a>07633 <span class="comment"> */</span>
<a name="l07634"></a>07634 
<a name="l07635"></a>07635 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l07636"></a><a class="code" href="../../d1/db0/string_8c.html#ac7ff00e7fceb3767513041d0afa9b259">07636</a> <a class="code" href="../../d1/db0/string_8c.html#ac7ff00e7fceb3767513041d0afa9b259">sym_empty</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <a class="code" href="../../dd/dc0/date__core_8c.html#a8157485e687f56a6ae2f3ee0a8cb1580">sym</a>)
<a name="l07637"></a>07637 {
<a name="l07638"></a>07638     <span class="keywordflow">return</span> <a class="code" href="../../d1/db0/string_8c.html#a4bc8e61d2eeff246e06747471df0bab0">rb_str_empty</a>(<a class="code" href="../../d5/d11/ripper_8c.html#aec42ef320e57234e789bdda6d655716f">rb_id2str</a>(<a class="code" href="../../dc/d0c/cparse_8c.html#a73ce5202e6172d3ad0bab7d1e0df9dae">SYM2ID</a>(sym)));
<a name="l07639"></a>07639 }
<a name="l07640"></a>07640 
<a name="l07641"></a>07641 <span class="comment">/*</span>
<a name="l07642"></a>07642 <span class="comment"> * call-seq:</span>
<a name="l07643"></a>07643 <span class="comment"> *   sym.upcase    -&gt; symbol</span>
<a name="l07644"></a>07644 <span class="comment"> *</span>
<a name="l07645"></a>07645 <span class="comment"> * Same as &lt;code&gt;sym.to_s.upcase.intern&lt;/code&gt;.</span>
<a name="l07646"></a>07646 <span class="comment"> */</span>
<a name="l07647"></a>07647 
<a name="l07648"></a>07648 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l07649"></a><a class="code" href="../../d1/db0/string_8c.html#adf107da3454f990cf7262d9daad52334">07649</a> <a class="code" href="../../d1/db0/string_8c.html#adf107da3454f990cf7262d9daad52334">sym_upcase</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <a class="code" href="../../dd/dc0/date__core_8c.html#a8157485e687f56a6ae2f3ee0a8cb1580">sym</a>)
<a name="l07650"></a>07650 {
<a name="l07651"></a>07651     <span class="keywordflow">return</span> <a class="code" href="../../db/d2e/intern_8h.html#abee4398ccf077c9cab2d51c5d2d25c22">rb_str_intern</a>(<a class="code" href="../../d1/db0/string_8c.html#af6774b0c71b84fef54ac5238d5c7b7e0">rb_str_upcase</a>(<a class="code" href="../../d5/d11/ripper_8c.html#aec42ef320e57234e789bdda6d655716f">rb_id2str</a>(<a class="code" href="../../dc/d0c/cparse_8c.html#a73ce5202e6172d3ad0bab7d1e0df9dae">SYM2ID</a>(sym))));
<a name="l07652"></a>07652 }
<a name="l07653"></a>07653 
<a name="l07654"></a>07654 <span class="comment">/*</span>
<a name="l07655"></a>07655 <span class="comment"> * call-seq:</span>
<a name="l07656"></a>07656 <span class="comment"> *   sym.downcase  -&gt; symbol</span>
<a name="l07657"></a>07657 <span class="comment"> *</span>
<a name="l07658"></a>07658 <span class="comment"> * Same as &lt;code&gt;sym.to_s.downcase.intern&lt;/code&gt;.</span>
<a name="l07659"></a>07659 <span class="comment"> */</span>
<a name="l07660"></a>07660 
<a name="l07661"></a>07661 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l07662"></a><a class="code" href="../../d1/db0/string_8c.html#a36da5dbb9042eb95667397b7e6e3c48b">07662</a> <a class="code" href="../../d1/db0/string_8c.html#a36da5dbb9042eb95667397b7e6e3c48b">sym_downcase</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <a class="code" href="../../dd/dc0/date__core_8c.html#a8157485e687f56a6ae2f3ee0a8cb1580">sym</a>)
<a name="l07663"></a>07663 {
<a name="l07664"></a>07664     <span class="keywordflow">return</span> <a class="code" href="../../db/d2e/intern_8h.html#abee4398ccf077c9cab2d51c5d2d25c22">rb_str_intern</a>(<a class="code" href="../../d1/db0/string_8c.html#a88d852a8e73145f27cf1dfe23a073660">rb_str_downcase</a>(<a class="code" href="../../d5/d11/ripper_8c.html#aec42ef320e57234e789bdda6d655716f">rb_id2str</a>(<a class="code" href="../../dc/d0c/cparse_8c.html#a73ce5202e6172d3ad0bab7d1e0df9dae">SYM2ID</a>(sym))));
<a name="l07665"></a>07665 }
<a name="l07666"></a>07666 
<a name="l07667"></a>07667 <span class="comment">/*</span>
<a name="l07668"></a>07668 <span class="comment"> * call-seq:</span>
<a name="l07669"></a>07669 <span class="comment"> *   sym.capitalize  -&gt; symbol</span>
<a name="l07670"></a>07670 <span class="comment"> *</span>
<a name="l07671"></a>07671 <span class="comment"> * Same as &lt;code&gt;sym.to_s.capitalize.intern&lt;/code&gt;.</span>
<a name="l07672"></a>07672 <span class="comment"> */</span>
<a name="l07673"></a>07673 
<a name="l07674"></a>07674 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l07675"></a><a class="code" href="../../d1/db0/string_8c.html#a7420ed8c1bcd570840cb3403eee0ca13">07675</a> <a class="code" href="../../d1/db0/string_8c.html#a7420ed8c1bcd570840cb3403eee0ca13">sym_capitalize</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <a class="code" href="../../dd/dc0/date__core_8c.html#a8157485e687f56a6ae2f3ee0a8cb1580">sym</a>)
<a name="l07676"></a>07676 {
<a name="l07677"></a>07677     <span class="keywordflow">return</span> <a class="code" href="../../db/d2e/intern_8h.html#abee4398ccf077c9cab2d51c5d2d25c22">rb_str_intern</a>(<a class="code" href="../../d1/db0/string_8c.html#a3cd8b3462399852b1c84165e8853b492">rb_str_capitalize</a>(<a class="code" href="../../d5/d11/ripper_8c.html#aec42ef320e57234e789bdda6d655716f">rb_id2str</a>(<a class="code" href="../../dc/d0c/cparse_8c.html#a73ce5202e6172d3ad0bab7d1e0df9dae">SYM2ID</a>(sym))));
<a name="l07678"></a>07678 }
<a name="l07679"></a>07679 
<a name="l07680"></a>07680 <span class="comment">/*</span>
<a name="l07681"></a>07681 <span class="comment"> * call-seq:</span>
<a name="l07682"></a>07682 <span class="comment"> *   sym.swapcase  -&gt; symbol</span>
<a name="l07683"></a>07683 <span class="comment"> *</span>
<a name="l07684"></a>07684 <span class="comment"> * Same as &lt;code&gt;sym.to_s.swapcase.intern&lt;/code&gt;.</span>
<a name="l07685"></a>07685 <span class="comment"> */</span>
<a name="l07686"></a>07686 
<a name="l07687"></a>07687 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l07688"></a><a class="code" href="../../d1/db0/string_8c.html#a5c7ae228d1150ff6fbc771575418c8fc">07688</a> <a class="code" href="../../d1/db0/string_8c.html#a5c7ae228d1150ff6fbc771575418c8fc">sym_swapcase</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <a class="code" href="../../dd/dc0/date__core_8c.html#a8157485e687f56a6ae2f3ee0a8cb1580">sym</a>)
<a name="l07689"></a>07689 {
<a name="l07690"></a>07690     <span class="keywordflow">return</span> <a class="code" href="../../db/d2e/intern_8h.html#abee4398ccf077c9cab2d51c5d2d25c22">rb_str_intern</a>(<a class="code" href="../../d1/db0/string_8c.html#a87988a28be9b9aa5115d09128c335bef">rb_str_swapcase</a>(<a class="code" href="../../d5/d11/ripper_8c.html#aec42ef320e57234e789bdda6d655716f">rb_id2str</a>(<a class="code" href="../../dc/d0c/cparse_8c.html#a73ce5202e6172d3ad0bab7d1e0df9dae">SYM2ID</a>(sym))));
<a name="l07691"></a>07691 }
<a name="l07692"></a>07692 
<a name="l07693"></a>07693 <span class="comment">/*</span>
<a name="l07694"></a>07694 <span class="comment"> * call-seq:</span>
<a name="l07695"></a>07695 <span class="comment"> *   sym.encoding   -&gt; encoding</span>
<a name="l07696"></a>07696 <span class="comment"> *</span>
<a name="l07697"></a>07697 <span class="comment"> * Returns the Encoding object that represents the encoding of _sym_.</span>
<a name="l07698"></a>07698 <span class="comment"> */</span>
<a name="l07699"></a>07699 
<a name="l07700"></a>07700 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l07701"></a><a class="code" href="../../d1/db0/string_8c.html#ad6e456f9cc1d0959611fc5e214451bb9">07701</a> <a class="code" href="../../d1/db0/string_8c.html#ad6e456f9cc1d0959611fc5e214451bb9">sym_encoding</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <a class="code" href="../../dd/dc0/date__core_8c.html#a8157485e687f56a6ae2f3ee0a8cb1580">sym</a>)
<a name="l07702"></a>07702 {
<a name="l07703"></a>07703     <span class="keywordflow">return</span> <a class="code" href="../../d5/db5/encoding_8c.html#aca4947a16b0f9c7ae2db67a72e52b6ca">rb_obj_encoding</a>(<a class="code" href="../../d5/d11/ripper_8c.html#aec42ef320e57234e789bdda6d655716f">rb_id2str</a>(<a class="code" href="../../dc/d0c/cparse_8c.html#a73ce5202e6172d3ad0bab7d1e0df9dae">SYM2ID</a>(sym)));
<a name="l07704"></a>07704 }
<a name="l07705"></a>07705 
<a name="l07706"></a>07706 <a class="code" href="../../de/de6/ruby_2ruby_8h.html#afa5b9137f051ac26d7ccc8824f178233">ID</a>
<a name="l07707"></a><a class="code" href="../../d1/db0/string_8c.html#acd831a0e29a5dbc3655c2a63b9f68ecb">07707</a> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#afe85fbdbbfefb46b9c12e725c9a04970">rb_to_id</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <a class="code" href="../../d6/da0/nkf-utf8_2nkf_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>)
<a name="l07708"></a>07708 {
<a name="l07709"></a>07709     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> tmp;
<a name="l07710"></a>07710 
<a name="l07711"></a>07711     <span class="keywordflow">switch</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a394faf7191f18552a20cb17ce14226f0">TYPE</a>(name)) {
<a name="l07712"></a>07712       <span class="keywordflow">default</span>:
<a name="l07713"></a>07713         tmp = <a class="code" href="../../db/d2e/intern_8h.html#a669b6063704b2d304844bd1553217cf0">rb_check_string_type</a>(name);
<a name="l07714"></a>07714         <span class="keywordflow">if</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a4832bad8845a35fc50f7a160901854a1">NIL_P</a>(tmp)) {
<a name="l07715"></a>07715             tmp = <a class="code" href="../../db/d2e/intern_8h.html#acbb281bacf6b80f460143348e26142e9">rb_inspect</a>(name);
<a name="l07716"></a>07716             <a class="code" href="../../db/dcc/error_8c.html#a0f771a2840561f1838169b3d7d4616f3">rb_raise</a>(<a class="code" href="../../db/dcc/error_8c.html#a565ed9d70f4089e1b4a36e9b3381b8c6">rb_eTypeError</a>, <span class="stringliteral">&quot;%s is not a symbol&quot;</span>,
<a name="l07717"></a>07717                      <a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(tmp));
<a name="l07718"></a>07718         }
<a name="l07719"></a>07719         name = tmp;
<a name="l07720"></a>07720         <span class="comment">/* fall through */</span>
<a name="l07721"></a>07721       <span class="keywordflow">case</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a22a8c2a4bbaae9b68f65c9bb92fd4e39">T_STRING</a>:
<a name="l07722"></a>07722         name = <a class="code" href="../../db/d2e/intern_8h.html#abee4398ccf077c9cab2d51c5d2d25c22">rb_str_intern</a>(name);
<a name="l07723"></a>07723         <span class="comment">/* fall through */</span>
<a name="l07724"></a>07724       <span class="keywordflow">case</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac9aadbc1e9c456506a4d7eef5cdc787e">T_SYMBOL</a>:
<a name="l07725"></a>07725         <span class="keywordflow">return</span> <a class="code" href="../../dc/d0c/cparse_8c.html#a73ce5202e6172d3ad0bab7d1e0df9dae">SYM2ID</a>(name);
<a name="l07726"></a>07726     }
<a name="l07727"></a>07727     <span class="keywordflow">return</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a320970f989dc8294c8203154e3db40c1">Qnil</a>; <span class="comment">/* not reached */</span>
<a name="l07728"></a>07728 }
<a name="l07729"></a>07729 
<a name="l07730"></a>07730 <span class="comment">/*</span>
<a name="l07731"></a>07731 <span class="comment"> *  A &lt;code&gt;String&lt;/code&gt; object holds and manipulates an arbitrary sequence of</span>
<a name="l07732"></a>07732 <span class="comment"> *  bytes, typically representing characters. String objects may be created</span>
<a name="l07733"></a>07733 <span class="comment"> *  using &lt;code&gt;String::new&lt;/code&gt; or as literals.</span>
<a name="l07734"></a>07734 <span class="comment"> *</span>
<a name="l07735"></a>07735 <span class="comment"> *  Because of aliasing issues, users of strings should be aware of the methods</span>
<a name="l07736"></a>07736 <span class="comment"> *  that modify the contents of a &lt;code&gt;String&lt;/code&gt; object.  Typically,</span>
<a name="l07737"></a>07737 <span class="comment"> *  methods with names ending in ``!&apos;&apos; modify their receiver, while those</span>
<a name="l07738"></a>07738 <span class="comment"> *  without a ``!&apos;&apos; return a new &lt;code&gt;String&lt;/code&gt;.  However, there are</span>
<a name="l07739"></a>07739 <span class="comment"> *  exceptions, such as &lt;code&gt;String#[]=&lt;/code&gt;.</span>
<a name="l07740"></a>07740 <span class="comment"> *</span>
<a name="l07741"></a>07741 <span class="comment"> */</span>
<a name="l07742"></a>07742 
<a name="l07743"></a>07743 <span class="keywordtype">void</span>
<a name="l07744"></a><a class="code" href="../../d1/db0/string_8c.html#a5d342b6a6cb00293601401f4a6d679ad">07744</a> <a class="code" href="../../d1/db0/string_8c.html#a5d342b6a6cb00293601401f4a6d679ad">Init_String</a>(<span class="keywordtype">void</span>)
<a name="l07745"></a>07745 {
<a name="l07746"></a>07746 <span class="preprocessor">#undef rb_intern</span>
<a name="l07747"></a>07747 <span class="preprocessor"></span><span class="preprocessor">#define rb_intern(str) rb_intern_const(str)</span>
<a name="l07748"></a>07748 <span class="preprocessor"></span>
<a name="l07749"></a>07749     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a7d36c9c3e9faa34c27eb7f2eb9c874a8">rb_cString</a>  = <a class="code" href="../../de/ddf/group__class.html#ga15d068dbe88a3bab3700b03bebb7fbac" title="Defines a top-level class.">rb_define_class</a>(<span class="stringliteral">&quot;String&quot;</span>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a57c96ead3ef230b4838e65fe037c346e">rb_cObject</a>);
<a name="l07750"></a>07750     <a class="code" href="../../de/ddf/group__class.html#ga1301940bb86315055d67464ed2cee477">rb_include_module</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a7d36c9c3e9faa34c27eb7f2eb9c874a8">rb_cString</a>, <a class="code" href="../../de/d6d/compar_8c.html#ad8e98e5d1395d6a879bc0a2131916fd4">rb_mComparable</a>);
<a name="l07751"></a>07751     <a class="code" href="../../db/d2e/intern_8h.html#a6c99ed7f070458b961026d43d27d0642">rb_define_alloc_func</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a7d36c9c3e9faa34c27eb7f2eb9c874a8">rb_cString</a>, <a class="code" href="../../d1/db0/string_8c.html#a185714a3c1bc25c1a0df991fe6b44204">str_alloc</a>);
<a name="l07752"></a>07752     <a class="code" href="../../d7/d19/group__defmethod.html#gaacfe6a2ec444bdc7f573afb75ea251fe" title="Defines a singleton method for obj.">rb_define_singleton_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a7d36c9c3e9faa34c27eb7f2eb9c874a8">rb_cString</a>, <span class="stringliteral">&quot;try_convert&quot;</span>, <a class="code" href="../../d1/db0/string_8c.html#a10b57f1b7b311793950e70e762811a80">rb_str_s_try_convert</a>, 1);
<a name="l07753"></a>07753     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a7d36c9c3e9faa34c27eb7f2eb9c874a8">rb_cString</a>, <span class="stringliteral">&quot;initialize&quot;</span>, <a class="code" href="../../d1/db0/string_8c.html#a7d557e0b93d4162d80daac2ccc494b1c">rb_str_init</a>, -1);
<a name="l07754"></a>07754     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a7d36c9c3e9faa34c27eb7f2eb9c874a8">rb_cString</a>, <span class="stringliteral">&quot;initialize_copy&quot;</span>, <a class="code" href="../../db/d2e/intern_8h.html#a5ea7db726948a2669aaa95cff05e050b">rb_str_replace</a>, 1);
<a name="l07755"></a>07755     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a7d36c9c3e9faa34c27eb7f2eb9c874a8">rb_cString</a>, <span class="stringliteral">&quot;&lt;=&gt;&quot;</span>, <a class="code" href="../../d1/db0/string_8c.html#acd850d5463cfc6fe6381214f156b7e4d">rb_str_cmp_m</a>, 1);
<a name="l07756"></a>07756     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a7d36c9c3e9faa34c27eb7f2eb9c874a8">rb_cString</a>, <span class="stringliteral">&quot;==&quot;</span>, <a class="code" href="../../db/d2e/intern_8h.html#a879d55791d2df05df7f63943ae7ff276">rb_str_equal</a>, 1);
<a name="l07757"></a>07757     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a7d36c9c3e9faa34c27eb7f2eb9c874a8">rb_cString</a>, <span class="stringliteral">&quot;===&quot;</span>, <a class="code" href="../../db/d2e/intern_8h.html#a879d55791d2df05df7f63943ae7ff276">rb_str_equal</a>, 1);
<a name="l07758"></a>07758     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a7d36c9c3e9faa34c27eb7f2eb9c874a8">rb_cString</a>, <span class="stringliteral">&quot;eql?&quot;</span>, <a class="code" href="../../d1/db0/string_8c.html#a5ba5cf8c1d2606520ab15a3a733db4f5">rb_str_eql</a>, 1);
<a name="l07759"></a>07759     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a7d36c9c3e9faa34c27eb7f2eb9c874a8">rb_cString</a>, <span class="stringliteral">&quot;hash&quot;</span>, <a class="code" href="../../d1/db0/string_8c.html#a6c69766306e90d2f603892a0c282dd8a">rb_str_hash_m</a>, 0);
<a name="l07760"></a>07760     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a7d36c9c3e9faa34c27eb7f2eb9c874a8">rb_cString</a>, <span class="stringliteral">&quot;casecmp&quot;</span>, <a class="code" href="../../d1/db0/string_8c.html#ada0bd9e6e4de059fed412adf1649fc09">rb_str_casecmp</a>, 1);
<a name="l07761"></a>07761     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a7d36c9c3e9faa34c27eb7f2eb9c874a8">rb_cString</a>, <span class="stringliteral">&quot;+&quot;</span>, <a class="code" href="../../db/d2e/intern_8h.html#a42253a059c9b3ebacd49f9fcc3fb1b91">rb_str_plus</a>, 1);
<a name="l07762"></a>07762     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a7d36c9c3e9faa34c27eb7f2eb9c874a8">rb_cString</a>, <span class="stringliteral">&quot;*&quot;</span>, <a class="code" href="../../db/d2e/intern_8h.html#a8efad513e7493bcd2ada03102f2371c3">rb_str_times</a>, 1);
<a name="l07763"></a>07763     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a7d36c9c3e9faa34c27eb7f2eb9c874a8">rb_cString</a>, <span class="stringliteral">&quot;%&quot;</span>, <a class="code" href="../../d1/db0/string_8c.html#aa68d7dce95042a9ef479b32e4695e53c">rb_str_format_m</a>, 1);
<a name="l07764"></a>07764     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a7d36c9c3e9faa34c27eb7f2eb9c874a8">rb_cString</a>, <span class="stringliteral">&quot;[]&quot;</span>, <a class="code" href="../../d1/db0/string_8c.html#aa5327105773f1bfb1799f4a6b04587e7">rb_str_aref_m</a>, -1);
<a name="l07765"></a>07765     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a7d36c9c3e9faa34c27eb7f2eb9c874a8">rb_cString</a>, <span class="stringliteral">&quot;[]=&quot;</span>, <a class="code" href="../../d1/db0/string_8c.html#a254a613e67e7bc35f521d1701ed95d1c">rb_str_aset_m</a>, -1);
<a name="l07766"></a>07766     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a7d36c9c3e9faa34c27eb7f2eb9c874a8">rb_cString</a>, <span class="stringliteral">&quot;insert&quot;</span>, <a class="code" href="../../d1/db0/string_8c.html#acdca0120090d0bc8f32d17824e6dbb8b">rb_str_insert</a>, 2);
<a name="l07767"></a>07767     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a7d36c9c3e9faa34c27eb7f2eb9c874a8">rb_cString</a>, <span class="stringliteral">&quot;length&quot;</span>, <a class="code" href="../../db/d2e/intern_8h.html#aed0efe9b6a433458fbc9736a9c57d410">rb_str_length</a>, 0);
<a name="l07768"></a>07768     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a7d36c9c3e9faa34c27eb7f2eb9c874a8">rb_cString</a>, <span class="stringliteral">&quot;size&quot;</span>, <a class="code" href="../../db/d2e/intern_8h.html#aed0efe9b6a433458fbc9736a9c57d410">rb_str_length</a>, 0);
<a name="l07769"></a>07769     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a7d36c9c3e9faa34c27eb7f2eb9c874a8">rb_cString</a>, <span class="stringliteral">&quot;bytesize&quot;</span>, <a class="code" href="../../d1/db0/string_8c.html#aa786c324384e11597f0dd72a8d2075fa">rb_str_bytesize</a>, 0);
<a name="l07770"></a>07770     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a7d36c9c3e9faa34c27eb7f2eb9c874a8">rb_cString</a>, <span class="stringliteral">&quot;empty?&quot;</span>, <a class="code" href="../../d1/db0/string_8c.html#a4bc8e61d2eeff246e06747471df0bab0">rb_str_empty</a>, 0);
<a name="l07771"></a>07771     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a7d36c9c3e9faa34c27eb7f2eb9c874a8">rb_cString</a>, <span class="stringliteral">&quot;=~&quot;</span>, <a class="code" href="../../d1/db0/string_8c.html#a2715777ab2236ea2aaae11365122b861">rb_str_match</a>, 1);
<a name="l07772"></a>07772     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a7d36c9c3e9faa34c27eb7f2eb9c874a8">rb_cString</a>, <span class="stringliteral">&quot;match&quot;</span>, <a class="code" href="../../d1/db0/string_8c.html#a0c71a042338f6b2faf10aa3aafd9e943">rb_str_match_m</a>, -1);
<a name="l07773"></a>07773     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a7d36c9c3e9faa34c27eb7f2eb9c874a8">rb_cString</a>, <span class="stringliteral">&quot;succ&quot;</span>, <a class="code" href="../../db/d2e/intern_8h.html#af513b28149fbaaa7fecd52e514a679c2">rb_str_succ</a>, 0);
<a name="l07774"></a>07774     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a7d36c9c3e9faa34c27eb7f2eb9c874a8">rb_cString</a>, <span class="stringliteral">&quot;succ!&quot;</span>, <a class="code" href="../../d1/db0/string_8c.html#a54c29f795d752d9ee0ec36e97ae523b8">rb_str_succ_bang</a>, 0);
<a name="l07775"></a>07775     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a7d36c9c3e9faa34c27eb7f2eb9c874a8">rb_cString</a>, <span class="stringliteral">&quot;next&quot;</span>, <a class="code" href="../../db/d2e/intern_8h.html#af513b28149fbaaa7fecd52e514a679c2">rb_str_succ</a>, 0);
<a name="l07776"></a>07776     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a7d36c9c3e9faa34c27eb7f2eb9c874a8">rb_cString</a>, <span class="stringliteral">&quot;next!&quot;</span>, <a class="code" href="../../d1/db0/string_8c.html#a54c29f795d752d9ee0ec36e97ae523b8">rb_str_succ_bang</a>, 0);
<a name="l07777"></a>07777     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a7d36c9c3e9faa34c27eb7f2eb9c874a8">rb_cString</a>, <span class="stringliteral">&quot;upto&quot;</span>, <a class="code" href="../../d1/db0/string_8c.html#ad375ec53c02941aa740b1915bc0767be">rb_str_upto</a>, -1);
<a name="l07778"></a>07778     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a7d36c9c3e9faa34c27eb7f2eb9c874a8">rb_cString</a>, <span class="stringliteral">&quot;index&quot;</span>, <a class="code" href="../../d1/db0/string_8c.html#ad67c1477dff8216dff6a1a77f5e6b7f2">rb_str_index_m</a>, -1);
<a name="l07779"></a>07779     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a7d36c9c3e9faa34c27eb7f2eb9c874a8">rb_cString</a>, <span class="stringliteral">&quot;rindex&quot;</span>, <a class="code" href="../../d1/db0/string_8c.html#a767d103897e02f1d2c0e21a34f727fa2">rb_str_rindex_m</a>, -1);
<a name="l07780"></a>07780     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a7d36c9c3e9faa34c27eb7f2eb9c874a8">rb_cString</a>, <span class="stringliteral">&quot;replace&quot;</span>, <a class="code" href="../../db/d2e/intern_8h.html#a5ea7db726948a2669aaa95cff05e050b">rb_str_replace</a>, 1);
<a name="l07781"></a>07781     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a7d36c9c3e9faa34c27eb7f2eb9c874a8">rb_cString</a>, <span class="stringliteral">&quot;clear&quot;</span>, <a class="code" href="../../d1/db0/string_8c.html#ac5e2b2bfc50705ecea86d699d1a8dc15">rb_str_clear</a>, 0);
<a name="l07782"></a>07782     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a7d36c9c3e9faa34c27eb7f2eb9c874a8">rb_cString</a>, <span class="stringliteral">&quot;chr&quot;</span>, <a class="code" href="../../d1/db0/string_8c.html#af960db48298648eb048ef73261ec3cd2">rb_str_chr</a>, 0);
<a name="l07783"></a>07783     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a7d36c9c3e9faa34c27eb7f2eb9c874a8">rb_cString</a>, <span class="stringliteral">&quot;getbyte&quot;</span>, <a class="code" href="../../d1/db0/string_8c.html#a777401f2d7d017824f5c2ed1a585e9f0">rb_str_getbyte</a>, 1);
<a name="l07784"></a>07784     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a7d36c9c3e9faa34c27eb7f2eb9c874a8">rb_cString</a>, <span class="stringliteral">&quot;setbyte&quot;</span>, <a class="code" href="../../d1/db0/string_8c.html#acddb22812eb2b5f5983a7389303ceae6">rb_str_setbyte</a>, 2);
<a name="l07785"></a>07785     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a7d36c9c3e9faa34c27eb7f2eb9c874a8">rb_cString</a>, <span class="stringliteral">&quot;byteslice&quot;</span>, <a class="code" href="../../d1/db0/string_8c.html#ab31546946c7e1a879fd3b057f66dcd6a">rb_str_byteslice</a>, -1);
<a name="l07786"></a>07786 
<a name="l07787"></a>07787     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a7d36c9c3e9faa34c27eb7f2eb9c874a8">rb_cString</a>, <span class="stringliteral">&quot;to_i&quot;</span>, <a class="code" href="../../d1/db0/string_8c.html#a2fbab16e925d11b5e1d5e55820c24e97">rb_str_to_i</a>, -1);
<a name="l07788"></a>07788     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a7d36c9c3e9faa34c27eb7f2eb9c874a8">rb_cString</a>, <span class="stringliteral">&quot;to_f&quot;</span>, <a class="code" href="../../d1/db0/string_8c.html#a446557c6800289507733227f3dd1b50f">rb_str_to_f</a>, 0);
<a name="l07789"></a>07789     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a7d36c9c3e9faa34c27eb7f2eb9c874a8">rb_cString</a>, <span class="stringliteral">&quot;to_s&quot;</span>, <a class="code" href="../../d1/db0/string_8c.html#ac4d809210e4dccd6a4dca0a74edb04a2">rb_str_to_s</a>, 0);
<a name="l07790"></a>07790     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a7d36c9c3e9faa34c27eb7f2eb9c874a8">rb_cString</a>, <span class="stringliteral">&quot;to_str&quot;</span>, <a class="code" href="../../d1/db0/string_8c.html#ac4d809210e4dccd6a4dca0a74edb04a2">rb_str_to_s</a>, 0);
<a name="l07791"></a>07791     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a7d36c9c3e9faa34c27eb7f2eb9c874a8">rb_cString</a>, <span class="stringliteral">&quot;inspect&quot;</span>, <a class="code" href="../../db/d2e/intern_8h.html#a683d7a310ce87bf1aa5b5b3ea0d93ead">rb_str_inspect</a>, 0);
<a name="l07792"></a>07792     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a7d36c9c3e9faa34c27eb7f2eb9c874a8">rb_cString</a>, <span class="stringliteral">&quot;dump&quot;</span>, <a class="code" href="../../db/d2e/intern_8h.html#ab4fa4ec084128c2a79a73d1989210ea4">rb_str_dump</a>, 0);
<a name="l07793"></a>07793 
<a name="l07794"></a>07794     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a7d36c9c3e9faa34c27eb7f2eb9c874a8">rb_cString</a>, <span class="stringliteral">&quot;upcase&quot;</span>, <a class="code" href="../../d1/db0/string_8c.html#af6774b0c71b84fef54ac5238d5c7b7e0">rb_str_upcase</a>, 0);
<a name="l07795"></a>07795     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a7d36c9c3e9faa34c27eb7f2eb9c874a8">rb_cString</a>, <span class="stringliteral">&quot;downcase&quot;</span>, <a class="code" href="../../d1/db0/string_8c.html#a88d852a8e73145f27cf1dfe23a073660">rb_str_downcase</a>, 0);
<a name="l07796"></a>07796     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a7d36c9c3e9faa34c27eb7f2eb9c874a8">rb_cString</a>, <span class="stringliteral">&quot;capitalize&quot;</span>, <a class="code" href="../../d1/db0/string_8c.html#a3cd8b3462399852b1c84165e8853b492">rb_str_capitalize</a>, 0);
<a name="l07797"></a>07797     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a7d36c9c3e9faa34c27eb7f2eb9c874a8">rb_cString</a>, <span class="stringliteral">&quot;swapcase&quot;</span>, <a class="code" href="../../d1/db0/string_8c.html#a87988a28be9b9aa5115d09128c335bef">rb_str_swapcase</a>, 0);
<a name="l07798"></a>07798 
<a name="l07799"></a>07799     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a7d36c9c3e9faa34c27eb7f2eb9c874a8">rb_cString</a>, <span class="stringliteral">&quot;upcase!&quot;</span>, <a class="code" href="../../d1/db0/string_8c.html#a965bf239c7b44bae4e7d45d98cd6f4c7">rb_str_upcase_bang</a>, 0);
<a name="l07800"></a>07800     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a7d36c9c3e9faa34c27eb7f2eb9c874a8">rb_cString</a>, <span class="stringliteral">&quot;downcase!&quot;</span>, <a class="code" href="../../d1/db0/string_8c.html#af6e6dcdac511f77bac2587ae3a599d46">rb_str_downcase_bang</a>, 0);
<a name="l07801"></a>07801     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a7d36c9c3e9faa34c27eb7f2eb9c874a8">rb_cString</a>, <span class="stringliteral">&quot;capitalize!&quot;</span>, <a class="code" href="../../d1/db0/string_8c.html#af51341d4d0caebe7d75c8a9ec26aae9c">rb_str_capitalize_bang</a>, 0);
<a name="l07802"></a>07802     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a7d36c9c3e9faa34c27eb7f2eb9c874a8">rb_cString</a>, <span class="stringliteral">&quot;swapcase!&quot;</span>, <a class="code" href="../../d1/db0/string_8c.html#a19c2c715bda09ff61511cd36172b7159">rb_str_swapcase_bang</a>, 0);
<a name="l07803"></a>07803 
<a name="l07804"></a>07804     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a7d36c9c3e9faa34c27eb7f2eb9c874a8">rb_cString</a>, <span class="stringliteral">&quot;hex&quot;</span>, <a class="code" href="../../d1/db0/string_8c.html#a4c46372c755eec9a64dd23b3a508a435">rb_str_hex</a>, 0);
<a name="l07805"></a>07805     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a7d36c9c3e9faa34c27eb7f2eb9c874a8">rb_cString</a>, <span class="stringliteral">&quot;oct&quot;</span>, <a class="code" href="../../d1/db0/string_8c.html#a4940bad3235261b1dc9ae0549241f987">rb_str_oct</a>, 0);
<a name="l07806"></a>07806     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a7d36c9c3e9faa34c27eb7f2eb9c874a8">rb_cString</a>, <span class="stringliteral">&quot;split&quot;</span>, <a class="code" href="../../d1/db0/string_8c.html#a007e56ccd20ef00c209fd4b0373aa198">rb_str_split_m</a>, -1);
<a name="l07807"></a>07807     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a7d36c9c3e9faa34c27eb7f2eb9c874a8">rb_cString</a>, <span class="stringliteral">&quot;lines&quot;</span>, <a class="code" href="../../d1/db0/string_8c.html#af6391c6025ae46647b8af97350de1fa8">rb_str_each_line</a>, -1);
<a name="l07808"></a>07808     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a7d36c9c3e9faa34c27eb7f2eb9c874a8">rb_cString</a>, <span class="stringliteral">&quot;bytes&quot;</span>, <a class="code" href="../../d1/db0/string_8c.html#af2d0acfc38b3478aee46c6941d5e1f94">rb_str_each_byte</a>, 0);
<a name="l07809"></a>07809     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a7d36c9c3e9faa34c27eb7f2eb9c874a8">rb_cString</a>, <span class="stringliteral">&quot;chars&quot;</span>, <a class="code" href="../../d1/db0/string_8c.html#ac8df61f5e35fc360e2bc4b80007ccd3a">rb_str_each_char</a>, 0);
<a name="l07810"></a>07810     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a7d36c9c3e9faa34c27eb7f2eb9c874a8">rb_cString</a>, <span class="stringliteral">&quot;codepoints&quot;</span>, <a class="code" href="../../d1/db0/string_8c.html#ad9bb96f603d7c8600ad6eff7ac668cb9">rb_str_each_codepoint</a>, 0);
<a name="l07811"></a>07811     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a7d36c9c3e9faa34c27eb7f2eb9c874a8">rb_cString</a>, <span class="stringliteral">&quot;reverse&quot;</span>, <a class="code" href="../../d1/db0/string_8c.html#ac381b14f2caf5dcb210c43d0df62f018">rb_str_reverse</a>, 0);
<a name="l07812"></a>07812     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a7d36c9c3e9faa34c27eb7f2eb9c874a8">rb_cString</a>, <span class="stringliteral">&quot;reverse!&quot;</span>, <a class="code" href="../../d1/db0/string_8c.html#a5a4cac2a310a3e952f374df3aec83e35">rb_str_reverse_bang</a>, 0);
<a name="l07813"></a>07813     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a7d36c9c3e9faa34c27eb7f2eb9c874a8">rb_cString</a>, <span class="stringliteral">&quot;concat&quot;</span>, <a class="code" href="../../db/d2e/intern_8h.html#a2f12f7ad949fa2e6abb64f2311c6e2c5">rb_str_concat</a>, 1);
<a name="l07814"></a>07814     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a7d36c9c3e9faa34c27eb7f2eb9c874a8">rb_cString</a>, <span class="stringliteral">&quot;&lt;&lt;&quot;</span>, <a class="code" href="../../db/d2e/intern_8h.html#a2f12f7ad949fa2e6abb64f2311c6e2c5">rb_str_concat</a>, 1);
<a name="l07815"></a>07815     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a7d36c9c3e9faa34c27eb7f2eb9c874a8">rb_cString</a>, <span class="stringliteral">&quot;prepend&quot;</span>, <a class="code" href="../../d1/db0/string_8c.html#af58f66d19dd7dd3179b30e47a7a71743">rb_str_prepend</a>, 1);
<a name="l07816"></a>07816     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a7d36c9c3e9faa34c27eb7f2eb9c874a8">rb_cString</a>, <span class="stringliteral">&quot;crypt&quot;</span>, <a class="code" href="../../d1/db0/string_8c.html#a45dacd15f0efb82411dd2c84e6b08542">rb_str_crypt</a>, 1);
<a name="l07817"></a>07817     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a7d36c9c3e9faa34c27eb7f2eb9c874a8">rb_cString</a>, <span class="stringliteral">&quot;intern&quot;</span>, <a class="code" href="../../db/d2e/intern_8h.html#abee4398ccf077c9cab2d51c5d2d25c22">rb_str_intern</a>, 0);
<a name="l07818"></a>07818     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a7d36c9c3e9faa34c27eb7f2eb9c874a8">rb_cString</a>, <span class="stringliteral">&quot;to_sym&quot;</span>, <a class="code" href="../../db/d2e/intern_8h.html#abee4398ccf077c9cab2d51c5d2d25c22">rb_str_intern</a>, 0);
<a name="l07819"></a>07819     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a7d36c9c3e9faa34c27eb7f2eb9c874a8">rb_cString</a>, <span class="stringliteral">&quot;ord&quot;</span>, <a class="code" href="../../d1/db0/string_8c.html#a52f9d0d0e7f596972c2331d26ec34978">rb_str_ord</a>, 0);
<a name="l07820"></a>07820 
<a name="l07821"></a>07821     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a7d36c9c3e9faa34c27eb7f2eb9c874a8">rb_cString</a>, <span class="stringliteral">&quot;include?&quot;</span>, <a class="code" href="../../d1/db0/string_8c.html#a332aee68009134f3f8687e2b54b121ba">rb_str_include</a>, 1);
<a name="l07822"></a>07822     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a7d36c9c3e9faa34c27eb7f2eb9c874a8">rb_cString</a>, <span class="stringliteral">&quot;start_with?&quot;</span>, <a class="code" href="../../d1/db0/string_8c.html#a0731fc293d6e302e73ae12eee71cba03">rb_str_start_with</a>, -1);
<a name="l07823"></a>07823     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a7d36c9c3e9faa34c27eb7f2eb9c874a8">rb_cString</a>, <span class="stringliteral">&quot;end_with?&quot;</span>, <a class="code" href="../../d1/db0/string_8c.html#aa3b97c9649347df60a4abac30687a964">rb_str_end_with</a>, -1);
<a name="l07824"></a>07824 
<a name="l07825"></a>07825     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a7d36c9c3e9faa34c27eb7f2eb9c874a8">rb_cString</a>, <span class="stringliteral">&quot;scan&quot;</span>, <a class="code" href="../../d1/db0/string_8c.html#a134d836dfe048f50fce0b50d073f9d1f">rb_str_scan</a>, 1);
<a name="l07826"></a>07826 
<a name="l07827"></a>07827     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a7d36c9c3e9faa34c27eb7f2eb9c874a8">rb_cString</a>, <span class="stringliteral">&quot;ljust&quot;</span>, <a class="code" href="../../d1/db0/string_8c.html#a86556f3fb43aa17cac2897deb002e143">rb_str_ljust</a>, -1);
<a name="l07828"></a>07828     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a7d36c9c3e9faa34c27eb7f2eb9c874a8">rb_cString</a>, <span class="stringliteral">&quot;rjust&quot;</span>, <a class="code" href="../../d1/db0/string_8c.html#aa0236999f2f646803abbb4e61b5fd017">rb_str_rjust</a>, -1);
<a name="l07829"></a>07829     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a7d36c9c3e9faa34c27eb7f2eb9c874a8">rb_cString</a>, <span class="stringliteral">&quot;center&quot;</span>, <a class="code" href="../../d1/db0/string_8c.html#a2935f3513949ad91ad8c65c9208866c7">rb_str_center</a>, -1);
<a name="l07830"></a>07830 
<a name="l07831"></a>07831     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a7d36c9c3e9faa34c27eb7f2eb9c874a8">rb_cString</a>, <span class="stringliteral">&quot;sub&quot;</span>, <a class="code" href="../../d1/db0/string_8c.html#a162d7fb7bca6ad41fa999d3baf455e70">rb_str_sub</a>, -1);
<a name="l07832"></a>07832     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a7d36c9c3e9faa34c27eb7f2eb9c874a8">rb_cString</a>, <span class="stringliteral">&quot;gsub&quot;</span>, <a class="code" href="../../d1/db0/string_8c.html#ac0dafbe9c9b45d62e448036acb135bea">rb_str_gsub</a>, -1);
<a name="l07833"></a>07833     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a7d36c9c3e9faa34c27eb7f2eb9c874a8">rb_cString</a>, <span class="stringliteral">&quot;chop&quot;</span>, <a class="code" href="../../d1/db0/string_8c.html#a8adfd665f61f583530b0798205bcd583">rb_str_chop</a>, 0);
<a name="l07834"></a>07834     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a7d36c9c3e9faa34c27eb7f2eb9c874a8">rb_cString</a>, <span class="stringliteral">&quot;chomp&quot;</span>, <a class="code" href="../../d1/db0/string_8c.html#aa040b801e706ed502b364a71a8e1016b">rb_str_chomp</a>, -1);
<a name="l07835"></a>07835     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a7d36c9c3e9faa34c27eb7f2eb9c874a8">rb_cString</a>, <span class="stringliteral">&quot;strip&quot;</span>, <a class="code" href="../../d1/db0/string_8c.html#a551a85a75ef5bf6af00a5c82a4c159f4">rb_str_strip</a>, 0);
<a name="l07836"></a>07836     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a7d36c9c3e9faa34c27eb7f2eb9c874a8">rb_cString</a>, <span class="stringliteral">&quot;lstrip&quot;</span>, <a class="code" href="../../d1/db0/string_8c.html#a0568d895dea57af16af4c08a1e356d4d">rb_str_lstrip</a>, 0);
<a name="l07837"></a>07837     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a7d36c9c3e9faa34c27eb7f2eb9c874a8">rb_cString</a>, <span class="stringliteral">&quot;rstrip&quot;</span>, <a class="code" href="../../d1/db0/string_8c.html#a322ea113ef588fd97996abb27cf6ec0f">rb_str_rstrip</a>, 0);
<a name="l07838"></a>07838 
<a name="l07839"></a>07839     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a7d36c9c3e9faa34c27eb7f2eb9c874a8">rb_cString</a>, <span class="stringliteral">&quot;sub!&quot;</span>, <a class="code" href="../../d1/db0/string_8c.html#ae69f21015b4902fd3dcfc39ab7d0cfbc">rb_str_sub_bang</a>, -1);
<a name="l07840"></a>07840     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a7d36c9c3e9faa34c27eb7f2eb9c874a8">rb_cString</a>, <span class="stringliteral">&quot;gsub!&quot;</span>, <a class="code" href="../../d1/db0/string_8c.html#a6a6624a0d853034b871f693a3cef30fc">rb_str_gsub_bang</a>, -1);
<a name="l07841"></a>07841     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a7d36c9c3e9faa34c27eb7f2eb9c874a8">rb_cString</a>, <span class="stringliteral">&quot;chop!&quot;</span>, <a class="code" href="../../d1/db0/string_8c.html#aa76de394f038c61cab30412163c34b0d">rb_str_chop_bang</a>, 0);
<a name="l07842"></a>07842     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a7d36c9c3e9faa34c27eb7f2eb9c874a8">rb_cString</a>, <span class="stringliteral">&quot;chomp!&quot;</span>, <a class="code" href="../../d1/db0/string_8c.html#a3a3fe1c668344e4284c237cecbc02231">rb_str_chomp_bang</a>, -1);
<a name="l07843"></a>07843     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a7d36c9c3e9faa34c27eb7f2eb9c874a8">rb_cString</a>, <span class="stringliteral">&quot;strip!&quot;</span>, <a class="code" href="../../d1/db0/string_8c.html#a3f281ac7d159446c04331fe417c238f2">rb_str_strip_bang</a>, 0);
<a name="l07844"></a>07844     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a7d36c9c3e9faa34c27eb7f2eb9c874a8">rb_cString</a>, <span class="stringliteral">&quot;lstrip!&quot;</span>, <a class="code" href="../../d1/db0/string_8c.html#a64c9a1c890b80072e995a69c54ae3260">rb_str_lstrip_bang</a>, 0);
<a name="l07845"></a>07845     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a7d36c9c3e9faa34c27eb7f2eb9c874a8">rb_cString</a>, <span class="stringliteral">&quot;rstrip!&quot;</span>, <a class="code" href="../../d1/db0/string_8c.html#a65ffd12d67cff340b77f4488d47af4d6">rb_str_rstrip_bang</a>, 0);
<a name="l07846"></a>07846 
<a name="l07847"></a>07847     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a7d36c9c3e9faa34c27eb7f2eb9c874a8">rb_cString</a>, <span class="stringliteral">&quot;tr&quot;</span>, <a class="code" href="../../d1/db0/string_8c.html#a1e035aa384a422037d6d0ad85704e413">rb_str_tr</a>, 2);
<a name="l07848"></a>07848     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a7d36c9c3e9faa34c27eb7f2eb9c874a8">rb_cString</a>, <span class="stringliteral">&quot;tr_s&quot;</span>, <a class="code" href="../../d1/db0/string_8c.html#ae29bb5266292a0cd296816eda5aa0a04">rb_str_tr_s</a>, 2);
<a name="l07849"></a>07849     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a7d36c9c3e9faa34c27eb7f2eb9c874a8">rb_cString</a>, <span class="stringliteral">&quot;delete&quot;</span>, <a class="code" href="../../d1/db0/string_8c.html#aac5b90aeedd723cef3f7a86a0d733238">rb_str_delete</a>, -1);
<a name="l07850"></a>07850     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a7d36c9c3e9faa34c27eb7f2eb9c874a8">rb_cString</a>, <span class="stringliteral">&quot;squeeze&quot;</span>, <a class="code" href="../../d1/db0/string_8c.html#aeca9264256736889e939458bd9644bb2">rb_str_squeeze</a>, -1);
<a name="l07851"></a>07851     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a7d36c9c3e9faa34c27eb7f2eb9c874a8">rb_cString</a>, <span class="stringliteral">&quot;count&quot;</span>, <a class="code" href="../../d1/db0/string_8c.html#ab7b6998c4baa50e2b12565422f463272">rb_str_count</a>, -1);
<a name="l07852"></a>07852 
<a name="l07853"></a>07853     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a7d36c9c3e9faa34c27eb7f2eb9c874a8">rb_cString</a>, <span class="stringliteral">&quot;tr!&quot;</span>, <a class="code" href="../../d1/db0/string_8c.html#a69086844bb46807638ddf451827bbe0d">rb_str_tr_bang</a>, 2);
<a name="l07854"></a>07854     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a7d36c9c3e9faa34c27eb7f2eb9c874a8">rb_cString</a>, <span class="stringliteral">&quot;tr_s!&quot;</span>, <a class="code" href="../../d1/db0/string_8c.html#a1d9111a6978e1672fddcae19537154e9">rb_str_tr_s_bang</a>, 2);
<a name="l07855"></a>07855     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a7d36c9c3e9faa34c27eb7f2eb9c874a8">rb_cString</a>, <span class="stringliteral">&quot;delete!&quot;</span>, <a class="code" href="../../d1/db0/string_8c.html#aed20ba79732169a36292557bddb335f5">rb_str_delete_bang</a>, -1);
<a name="l07856"></a>07856     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a7d36c9c3e9faa34c27eb7f2eb9c874a8">rb_cString</a>, <span class="stringliteral">&quot;squeeze!&quot;</span>, <a class="code" href="../../d1/db0/string_8c.html#a7c54529ef3c752ebf58c5c48fc545348">rb_str_squeeze_bang</a>, -1);
<a name="l07857"></a>07857 
<a name="l07858"></a>07858     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a7d36c9c3e9faa34c27eb7f2eb9c874a8">rb_cString</a>, <span class="stringliteral">&quot;each_line&quot;</span>, <a class="code" href="../../d1/db0/string_8c.html#af6391c6025ae46647b8af97350de1fa8">rb_str_each_line</a>, -1);
<a name="l07859"></a>07859     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a7d36c9c3e9faa34c27eb7f2eb9c874a8">rb_cString</a>, <span class="stringliteral">&quot;each_byte&quot;</span>, <a class="code" href="../../d1/db0/string_8c.html#af2d0acfc38b3478aee46c6941d5e1f94">rb_str_each_byte</a>, 0);
<a name="l07860"></a>07860     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a7d36c9c3e9faa34c27eb7f2eb9c874a8">rb_cString</a>, <span class="stringliteral">&quot;each_char&quot;</span>, <a class="code" href="../../d1/db0/string_8c.html#ac8df61f5e35fc360e2bc4b80007ccd3a">rb_str_each_char</a>, 0);
<a name="l07861"></a>07861     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a7d36c9c3e9faa34c27eb7f2eb9c874a8">rb_cString</a>, <span class="stringliteral">&quot;each_codepoint&quot;</span>, <a class="code" href="../../d1/db0/string_8c.html#ad9bb96f603d7c8600ad6eff7ac668cb9">rb_str_each_codepoint</a>, 0);
<a name="l07862"></a>07862 
<a name="l07863"></a>07863     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a7d36c9c3e9faa34c27eb7f2eb9c874a8">rb_cString</a>, <span class="stringliteral">&quot;sum&quot;</span>, <a class="code" href="../../d1/db0/string_8c.html#a13c5d72bb3670c5abcafb887a5e88597">rb_str_sum</a>, -1);
<a name="l07864"></a>07864 
<a name="l07865"></a>07865     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a7d36c9c3e9faa34c27eb7f2eb9c874a8">rb_cString</a>, <span class="stringliteral">&quot;slice&quot;</span>, <a class="code" href="../../d1/db0/string_8c.html#aa5327105773f1bfb1799f4a6b04587e7">rb_str_aref_m</a>, -1);
<a name="l07866"></a>07866     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a7d36c9c3e9faa34c27eb7f2eb9c874a8">rb_cString</a>, <span class="stringliteral">&quot;slice!&quot;</span>, <a class="code" href="../../d1/db0/string_8c.html#aa207d9e576d960b94fd7c1c3ff8cd745">rb_str_slice_bang</a>, -1);
<a name="l07867"></a>07867 
<a name="l07868"></a>07868     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a7d36c9c3e9faa34c27eb7f2eb9c874a8">rb_cString</a>, <span class="stringliteral">&quot;partition&quot;</span>, <a class="code" href="../../d1/db0/string_8c.html#afbde2f531c277eaaea33f2b85e9063f1">rb_str_partition</a>, 1);
<a name="l07869"></a>07869     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a7d36c9c3e9faa34c27eb7f2eb9c874a8">rb_cString</a>, <span class="stringliteral">&quot;rpartition&quot;</span>, <a class="code" href="../../d1/db0/string_8c.html#a7ab1c8befd748fbbe4bf01d57c5a6fa0">rb_str_rpartition</a>, 1);
<a name="l07870"></a>07870 
<a name="l07871"></a>07871     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a7d36c9c3e9faa34c27eb7f2eb9c874a8">rb_cString</a>, <span class="stringliteral">&quot;encoding&quot;</span>, <a class="code" href="../../d5/db5/encoding_8c.html#aca4947a16b0f9c7ae2db67a72e52b6ca">rb_obj_encoding</a>, 0); <span class="comment">/* in encoding.c */</span>
<a name="l07872"></a>07872     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a7d36c9c3e9faa34c27eb7f2eb9c874a8">rb_cString</a>, <span class="stringliteral">&quot;force_encoding&quot;</span>, <a class="code" href="../../d1/db0/string_8c.html#a16a814b1c310e8a3dcf49a49dd474cbe">rb_str_force_encoding</a>, 1);
<a name="l07873"></a>07873     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a7d36c9c3e9faa34c27eb7f2eb9c874a8">rb_cString</a>, <span class="stringliteral">&quot;valid_encoding?&quot;</span>, <a class="code" href="../../d1/db0/string_8c.html#a2ed7edea8a9bde6cafa7c316a05922db">rb_str_valid_encoding_p</a>, 0);
<a name="l07874"></a>07874     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a7d36c9c3e9faa34c27eb7f2eb9c874a8">rb_cString</a>, <span class="stringliteral">&quot;ascii_only?&quot;</span>, <a class="code" href="../../d1/db0/string_8c.html#a7517b84343eb5fed8370e95fe2fbc834">rb_str_is_ascii_only_p</a>, 0);
<a name="l07875"></a>07875 
<a name="l07876"></a>07876     id_to_s = <a class="code" href="../../dc/dcc/array_8c.html#a9cfa42d4b79c89d68c53be8b2150a503">rb_intern</a>(<span class="stringliteral">&quot;to_s&quot;</span>);
<a name="l07877"></a>07877 
<a name="l07878"></a>07878     <a class="code" href="../../db/d2e/intern_8h.html#ade300b3f8270fc26be5821ad806615ff">rb_fs</a> = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a320970f989dc8294c8203154e3db40c1">Qnil</a>;
<a name="l07879"></a>07879     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a57dd061565d9e4115ba7a19838b0f0f4">rb_define_variable</a>(<span class="stringliteral">&quot;$;&quot;</span>, &amp;<a class="code" href="../../db/d2e/intern_8h.html#ade300b3f8270fc26be5821ad806615ff">rb_fs</a>);
<a name="l07880"></a>07880     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a57dd061565d9e4115ba7a19838b0f0f4">rb_define_variable</a>(<span class="stringliteral">&quot;$-F&quot;</span>, &amp;<a class="code" href="../../db/d2e/intern_8h.html#ade300b3f8270fc26be5821ad806615ff">rb_fs</a>);
<a name="l07881"></a>07881 
<a name="l07882"></a>07882     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a9bb99c1fc98bd5e0da36ac70200081b6">rb_cSymbol</a> = <a class="code" href="../../de/ddf/group__class.html#ga15d068dbe88a3bab3700b03bebb7fbac" title="Defines a top-level class.">rb_define_class</a>(<span class="stringliteral">&quot;Symbol&quot;</span>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a57c96ead3ef230b4838e65fe037c346e">rb_cObject</a>);
<a name="l07883"></a>07883     <a class="code" href="../../de/ddf/group__class.html#ga1301940bb86315055d67464ed2cee477">rb_include_module</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a9bb99c1fc98bd5e0da36ac70200081b6">rb_cSymbol</a>, <a class="code" href="../../de/d6d/compar_8c.html#ad8e98e5d1395d6a879bc0a2131916fd4">rb_mComparable</a>);
<a name="l07884"></a>07884     <a class="code" href="../../db/d2e/intern_8h.html#ad38ee02dc6ba34e3d05a60bac4a900f8">rb_undef_alloc_func</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a9bb99c1fc98bd5e0da36ac70200081b6">rb_cSymbol</a>);
<a name="l07885"></a>07885     <a class="code" href="../../d7/d19/group__defmethod.html#ga879be4a71b806afb2854833fc1c45981">rb_undef_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#ad07df58de9895cbc33c10f02540d2d4d">CLASS_OF</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a9bb99c1fc98bd5e0da36ac70200081b6">rb_cSymbol</a>), <span class="stringliteral">&quot;new&quot;</span>);
<a name="l07886"></a>07886     <a class="code" href="../../d7/d19/group__defmethod.html#gaacfe6a2ec444bdc7f573afb75ea251fe" title="Defines a singleton method for obj.">rb_define_singleton_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a9bb99c1fc98bd5e0da36ac70200081b6">rb_cSymbol</a>, <span class="stringliteral">&quot;all_symbols&quot;</span>, <a class="code" href="../../d5/d11/ripper_8c.html#a564559c7653938771a7c75f054e4eeaf">rb_sym_all_symbols</a>, 0); <span class="comment">/* in parse.y */</span>
<a name="l07887"></a>07887 
<a name="l07888"></a>07888     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a9bb99c1fc98bd5e0da36ac70200081b6">rb_cSymbol</a>, <span class="stringliteral">&quot;==&quot;</span>, <a class="code" href="../../d1/db0/string_8c.html#a480b75ffec5563f1d35627dc3abab4a1">sym_equal</a>, 1);
<a name="l07889"></a>07889     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a9bb99c1fc98bd5e0da36ac70200081b6">rb_cSymbol</a>, <span class="stringliteral">&quot;===&quot;</span>, <a class="code" href="../../d1/db0/string_8c.html#a480b75ffec5563f1d35627dc3abab4a1">sym_equal</a>, 1);
<a name="l07890"></a>07890     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a9bb99c1fc98bd5e0da36ac70200081b6">rb_cSymbol</a>, <span class="stringliteral">&quot;inspect&quot;</span>, <a class="code" href="../../d1/db0/string_8c.html#a3f69a8436d382625437ad9b542b2c53c">sym_inspect</a>, 0);
<a name="l07891"></a>07891     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a9bb99c1fc98bd5e0da36ac70200081b6">rb_cSymbol</a>, <span class="stringliteral">&quot;to_s&quot;</span>, <a class="code" href="../../db/d2e/intern_8h.html#a6b530fce35a344ec394c08c6643cdd8a">rb_sym_to_s</a>, 0);
<a name="l07892"></a>07892     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a9bb99c1fc98bd5e0da36ac70200081b6">rb_cSymbol</a>, <span class="stringliteral">&quot;id2name&quot;</span>, <a class="code" href="../../db/d2e/intern_8h.html#a6b530fce35a344ec394c08c6643cdd8a">rb_sym_to_s</a>, 0);
<a name="l07893"></a>07893     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a9bb99c1fc98bd5e0da36ac70200081b6">rb_cSymbol</a>, <span class="stringliteral">&quot;intern&quot;</span>, <a class="code" href="../../d1/db0/string_8c.html#a5e49903726679a5a5b2e8e0400b70da2">sym_to_sym</a>, 0);
<a name="l07894"></a>07894     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a9bb99c1fc98bd5e0da36ac70200081b6">rb_cSymbol</a>, <span class="stringliteral">&quot;to_sym&quot;</span>, <a class="code" href="../../d1/db0/string_8c.html#a5e49903726679a5a5b2e8e0400b70da2">sym_to_sym</a>, 0);
<a name="l07895"></a>07895     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a9bb99c1fc98bd5e0da36ac70200081b6">rb_cSymbol</a>, <span class="stringliteral">&quot;to_proc&quot;</span>, <a class="code" href="../../d1/db0/string_8c.html#a7919b8fd2d92bda5aa70ca89b1675a57">sym_to_proc</a>, 0);
<a name="l07896"></a>07896     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a9bb99c1fc98bd5e0da36ac70200081b6">rb_cSymbol</a>, <span class="stringliteral">&quot;succ&quot;</span>, <a class="code" href="../../d1/db0/string_8c.html#ad70e56e026df956840d67c9bedda0834">sym_succ</a>, 0);
<a name="l07897"></a>07897     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a9bb99c1fc98bd5e0da36ac70200081b6">rb_cSymbol</a>, <span class="stringliteral">&quot;next&quot;</span>, <a class="code" href="../../d1/db0/string_8c.html#ad70e56e026df956840d67c9bedda0834">sym_succ</a>, 0);
<a name="l07898"></a>07898 
<a name="l07899"></a>07899     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a9bb99c1fc98bd5e0da36ac70200081b6">rb_cSymbol</a>, <span class="stringliteral">&quot;&lt;=&gt;&quot;</span>, <a class="code" href="../../d1/db0/string_8c.html#a89bcccd871024584794f70d51a690a40">sym_cmp</a>, 1);
<a name="l07900"></a>07900     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a9bb99c1fc98bd5e0da36ac70200081b6">rb_cSymbol</a>, <span class="stringliteral">&quot;casecmp&quot;</span>, <a class="code" href="../../d1/db0/string_8c.html#aff940dabdc26baa745c8c92f2a144a9c">sym_casecmp</a>, 1);
<a name="l07901"></a>07901     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a9bb99c1fc98bd5e0da36ac70200081b6">rb_cSymbol</a>, <span class="stringliteral">&quot;=~&quot;</span>, <a class="code" href="../../d1/db0/string_8c.html#abef17c9e8f1e5e809800842c297ebaf2">sym_match</a>, 1);
<a name="l07902"></a>07902 
<a name="l07903"></a>07903     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a9bb99c1fc98bd5e0da36ac70200081b6">rb_cSymbol</a>, <span class="stringliteral">&quot;[]&quot;</span>, <a class="code" href="../../d1/db0/string_8c.html#ae2e5ebd749fdd7d0e5ea715cab2ed56a">sym_aref</a>, -1);
<a name="l07904"></a>07904     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a9bb99c1fc98bd5e0da36ac70200081b6">rb_cSymbol</a>, <span class="stringliteral">&quot;slice&quot;</span>, <a class="code" href="../../d1/db0/string_8c.html#ae2e5ebd749fdd7d0e5ea715cab2ed56a">sym_aref</a>, -1);
<a name="l07905"></a>07905     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a9bb99c1fc98bd5e0da36ac70200081b6">rb_cSymbol</a>, <span class="stringliteral">&quot;length&quot;</span>, <a class="code" href="../../d1/db0/string_8c.html#ad655c23c89a24a8d8159ddb7ec3b248d">sym_length</a>, 0);
<a name="l07906"></a>07906     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a9bb99c1fc98bd5e0da36ac70200081b6">rb_cSymbol</a>, <span class="stringliteral">&quot;size&quot;</span>, <a class="code" href="../../d1/db0/string_8c.html#ad655c23c89a24a8d8159ddb7ec3b248d">sym_length</a>, 0);
<a name="l07907"></a>07907     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a9bb99c1fc98bd5e0da36ac70200081b6">rb_cSymbol</a>, <span class="stringliteral">&quot;empty?&quot;</span>, <a class="code" href="../../d1/db0/string_8c.html#ac7ff00e7fceb3767513041d0afa9b259">sym_empty</a>, 0);
<a name="l07908"></a>07908     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a9bb99c1fc98bd5e0da36ac70200081b6">rb_cSymbol</a>, <span class="stringliteral">&quot;match&quot;</span>, <a class="code" href="../../d1/db0/string_8c.html#abef17c9e8f1e5e809800842c297ebaf2">sym_match</a>, 1);
<a name="l07909"></a>07909 
<a name="l07910"></a>07910     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a9bb99c1fc98bd5e0da36ac70200081b6">rb_cSymbol</a>, <span class="stringliteral">&quot;upcase&quot;</span>, <a class="code" href="../../d1/db0/string_8c.html#adf107da3454f990cf7262d9daad52334">sym_upcase</a>, 0);
<a name="l07911"></a>07911     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a9bb99c1fc98bd5e0da36ac70200081b6">rb_cSymbol</a>, <span class="stringliteral">&quot;downcase&quot;</span>, <a class="code" href="../../d1/db0/string_8c.html#a36da5dbb9042eb95667397b7e6e3c48b">sym_downcase</a>, 0);
<a name="l07912"></a>07912     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a9bb99c1fc98bd5e0da36ac70200081b6">rb_cSymbol</a>, <span class="stringliteral">&quot;capitalize&quot;</span>, <a class="code" href="../../d1/db0/string_8c.html#a7420ed8c1bcd570840cb3403eee0ca13">sym_capitalize</a>, 0);
<a name="l07913"></a>07913     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a9bb99c1fc98bd5e0da36ac70200081b6">rb_cSymbol</a>, <span class="stringliteral">&quot;swapcase&quot;</span>, <a class="code" href="../../d1/db0/string_8c.html#a5c7ae228d1150ff6fbc771575418c8fc">sym_swapcase</a>, 0);
<a name="l07914"></a>07914 
<a name="l07915"></a>07915     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a9bb99c1fc98bd5e0da36ac70200081b6">rb_cSymbol</a>, <span class="stringliteral">&quot;encoding&quot;</span>, <a class="code" href="../../d1/db0/string_8c.html#ad6e456f9cc1d0959611fc5e214451bb9">sym_encoding</a>, 0);
<a name="l07916"></a>07916 }
<a name="l07917"></a>07917 
</pre></div></div>
<hr size="1"/><address style="text-align: right;"><small>Generated on 1 Mar 2013 for Ruby by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
