<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Ruby: class.c Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="../../index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="../../files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="../../globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<h1>class.c</h1><a href="../../d9/d0c/class_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/**********************************************************************</span>
<a name="l00002"></a>00002 <span class="comment"></span>
<a name="l00003"></a>00003 <span class="comment">  class.c -</span>
<a name="l00004"></a>00004 <span class="comment"></span>
<a name="l00005"></a>00005 <span class="comment">  $Author: yugui $</span>
<a name="l00006"></a>00006 <span class="comment">  created at: Tue Aug 10 15:05:44 JST 1993</span>
<a name="l00007"></a>00007 <span class="comment"></span>
<a name="l00008"></a>00008 <span class="comment">  Copyright (C) 1993-2007 Yukihiro Matsumoto</span>
<a name="l00009"></a>00009 <span class="comment"></span>
<a name="l00010"></a>00010 <span class="comment">**********************************************************************/</span>
<a name="l00011"></a>00011 
<a name="l00026"></a>00026 <span class="preprocessor">#include &quot;<a class="code" href="../../de/de6/ruby_2ruby_8h.html">ruby/ruby.h</a>&quot;</span>
<a name="l00027"></a>00027 <span class="preprocessor">#include &quot;<a class="code" href="../../dd/d24/st_8h.html">ruby/st.h</a>&quot;</span>
<a name="l00028"></a>00028 <span class="preprocessor">#include &quot;<a class="code" href="../../db/d0a/method_8h.html">method.h</a>&quot;</span>
<a name="l00029"></a>00029 <span class="preprocessor">#include &quot;<a class="code" href="../../dd/d17/constant_8h.html">constant.h</a>&quot;</span>
<a name="l00030"></a>00030 <span class="preprocessor">#include &quot;<a class="code" href="../../d8/d32/vm__core_8h.html">vm_core.h</a>&quot;</span>
<a name="l00031"></a>00031 <span class="preprocessor">#include &quot;<a class="code" href="../../db/dde/internal_8h.html">internal.h</a>&quot;</span>
<a name="l00032"></a>00032 <span class="preprocessor">#include &lt;ctype.h&gt;</span>
<a name="l00033"></a>00033 
<a name="l00034"></a>00034 <span class="keyword">extern</span> <a class="code" href="../../d0/ddd/structst__table.html">st_table</a> *<a class="code" href="../../de/ddf/group__class.html#gaff0db6a05b2bd3b173b91c804ed0b552">rb_class_tbl</a>;
<a name="l00035"></a><a class="code" href="../../de/ddf/group__class.html#gafd0c71501c641400fa9d557bd5cca7dd">00035</a> <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#afa5b9137f051ac26d7ccc8824f178233">ID</a> <a class="code" href="../../de/ddf/group__class.html#gafd0c71501c641400fa9d557bd5cca7dd">id_attached</a>;
<a name="l00036"></a>00036 
<a name="l00049"></a>00049 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l00050"></a><a class="code" href="../../de/ddf/group__class.html#gab3375e6e7d925cb966d8c1f808c44595">00050</a> <a class="code" href="../../de/ddf/group__class.html#gab3375e6e7d925cb966d8c1f808c44595" title="Allocates a struct RClass for a new class.">class_alloc</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> flags, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> klass)
<a name="l00051"></a>00051 {
<a name="l00052"></a>00052     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aa4eb92f5ea053e6d6cfddb46f40d6c80">rb_classext_t</a> *ext = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac8df5a8a8961bd9e16be385fef28c2f2">ALLOC</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#aa4eb92f5ea053e6d6cfddb46f40d6c80">rb_classext_t</a>);
<a name="l00053"></a>00053     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ab8e75ef1f427d9b009705ebd577bee92">NEWOBJ</a>(obj, <span class="keyword">struct</span> <a class="code" href="../../d5/d14/struct_r_class.html">RClass</a>);
<a name="l00054"></a>00054     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a607a9da5249e026d1c4a0826dc840143">OBJSETUP</a>(obj, klass, flags);
<a name="l00055"></a>00055     obj-&gt;ptr = ext;
<a name="l00056"></a>00056     <a class="code" href="../../d3/d09/ripper_8y.html#a7f7f2dbf958976d9bf317167396992d4">RCLASS_IV_TBL</a>(obj) = 0;
<a name="l00057"></a>00057     <a class="code" href="../../d3/d09/ripper_8y.html#a9dfcc3730f2a2a5ef643c2b6c3e606d1">RCLASS_CONST_TBL</a>(obj) = 0;
<a name="l00058"></a>00058     <a class="code" href="../../d3/d09/ripper_8y.html#ab59ea80cdf15f3f19bbae0346314c9ad">RCLASS_M_TBL</a>(obj) = 0;
<a name="l00059"></a>00059     <a class="code" href="../../d3/d09/ripper_8y.html#a19d17315b6b34045cdffec9912342b91">RCLASS_SUPER</a>(obj) = 0;
<a name="l00060"></a>00060     <a class="code" href="../../d3/d09/ripper_8y.html#ae5267dcfc60a00436251a80cbee8455f">RCLASS_IV_INDEX_TBL</a>(obj) = 0;
<a name="l00061"></a>00061     <span class="keywordflow">return</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>)obj;
<a name="l00062"></a>00062 }
<a name="l00063"></a>00063 
<a name="l00064"></a>00064 
<a name="l00074"></a>00074 <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l00075"></a><a class="code" href="../../de/ddf/group__class.html#ga8f7544343ddabc50fa64ab912ed9e7f8">00075</a> <a class="code" href="../../de/ddf/group__class.html#ga8f7544343ddabc50fa64ab912ed9e7f8" title="A utility function that wraps class_alloc.">rb_class_boot</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> super)
<a name="l00076"></a>00076 {
<a name="l00077"></a>00077     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> klass = <a class="code" href="../../de/ddf/group__class.html#gab3375e6e7d925cb966d8c1f808c44595" title="Allocates a struct RClass for a new class.">class_alloc</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#ad04c63d175774c6d6e7dfaf0f0a982c9">T_CLASS</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a39a2be92a95d7219204ab58d8f40533d">rb_cClass</a>);
<a name="l00078"></a>00078 
<a name="l00079"></a>00079     <a class="code" href="../../d3/d09/ripper_8y.html#a19d17315b6b34045cdffec9912342b91">RCLASS_SUPER</a>(klass) = super;
<a name="l00080"></a>00080     <a class="code" href="../../d3/d09/ripper_8y.html#ab59ea80cdf15f3f19bbae0346314c9ad">RCLASS_M_TBL</a>(klass) = <a class="code" href="../../dd/d24/st_8h.html#a955c6e936b9681649ab9ffa4aa741949">st_init_numtable</a>();
<a name="l00081"></a>00081 
<a name="l00082"></a>00082     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3bf9ab455a1e0e3e8cfc6ebabd8f12df">OBJ_INFECT</a>(klass, super);
<a name="l00083"></a>00083     <span class="keywordflow">return</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>)klass;
<a name="l00084"></a>00084 }
<a name="l00085"></a>00085 
<a name="l00086"></a>00086 
<a name="l00093"></a>00093 <span class="keywordtype">void</span>
<a name="l00094"></a><a class="code" href="../../de/ddf/group__class.html#ga7d90ea6e5ecdb6ddede8a8d00610cdf9">00094</a> <a class="code" href="../../de/ddf/group__class.html#ga7d90ea6e5ecdb6ddede8a8d00610cdf9" title="Ensures a class can be derived from super.">rb_check_inheritable</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> super)
<a name="l00095"></a>00095 {
<a name="l00096"></a>00096     <span class="keywordflow">if</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a394faf7191f18552a20cb17ce14226f0">TYPE</a>(super) != <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ad04c63d175774c6d6e7dfaf0f0a982c9">T_CLASS</a>) {
<a name="l00097"></a>00097         <a class="code" href="../../db/dcc/error_8c.html#a0f771a2840561f1838169b3d7d4616f3">rb_raise</a>(<a class="code" href="../../db/dcc/error_8c.html#a565ed9d70f4089e1b4a36e9b3381b8c6">rb_eTypeError</a>, <span class="stringliteral">&quot;superclass must be a Class (%s given)&quot;</span>,
<a name="l00098"></a>00098                  <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a9b4f42ada717bfbe7a78830639476aed">rb_obj_classname</a>(super));
<a name="l00099"></a>00099     }
<a name="l00100"></a>00100     <span class="keywordflow">if</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a1d4c05021aacd8cab989ff60f95ebe2d">RBASIC</a>(super)-&gt;flags &amp; <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a081b5172ef37829bb3a258cd1ad393bc">FL_SINGLETON</a>) {
<a name="l00101"></a>00101         <a class="code" href="../../db/dcc/error_8c.html#a0f771a2840561f1838169b3d7d4616f3">rb_raise</a>(<a class="code" href="../../db/dcc/error_8c.html#a565ed9d70f4089e1b4a36e9b3381b8c6">rb_eTypeError</a>, <span class="stringliteral">&quot;can&apos;t make subclass of singleton class&quot;</span>);
<a name="l00102"></a>00102     }
<a name="l00103"></a>00103     <span class="keywordflow">if</span> (super == <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a39a2be92a95d7219204ab58d8f40533d">rb_cClass</a>) {
<a name="l00104"></a>00104         <a class="code" href="../../db/dcc/error_8c.html#a0f771a2840561f1838169b3d7d4616f3">rb_raise</a>(<a class="code" href="../../db/dcc/error_8c.html#a565ed9d70f4089e1b4a36e9b3381b8c6">rb_eTypeError</a>, <span class="stringliteral">&quot;can&apos;t make subclass of Class&quot;</span>);
<a name="l00105"></a>00105     }
<a name="l00106"></a>00106 }
<a name="l00107"></a>00107 
<a name="l00108"></a>00108 
<a name="l00115"></a>00115 <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l00116"></a><a class="code" href="../../de/ddf/group__class.html#ga164285b5b5225740d582d4c3773f9179">00116</a> <a class="code" href="../../de/ddf/group__class.html#ga164285b5b5225740d582d4c3773f9179" title="Creates a new class.">rb_class_new</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> super)
<a name="l00117"></a>00117 {
<a name="l00118"></a>00118     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ad5a1e03b0a66824f95f6aaf07b4a4052">Check_Type</a>(super, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ad04c63d175774c6d6e7dfaf0f0a982c9">T_CLASS</a>);
<a name="l00119"></a>00119     <a class="code" href="../../de/ddf/group__class.html#ga7d90ea6e5ecdb6ddede8a8d00610cdf9" title="Ensures a class can be derived from super.">rb_check_inheritable</a>(super);
<a name="l00120"></a>00120     <span class="keywordflow">return</span> <a class="code" href="../../de/ddf/group__class.html#ga8f7544343ddabc50fa64ab912ed9e7f8" title="A utility function that wraps class_alloc.">rb_class_boot</a>(super);
<a name="l00121"></a>00121 }
<a name="l00122"></a>00122 
<a name="l00123"></a><a class="code" href="../../d7/d63/structclone__method__data.html">00123</a> <span class="keyword">struct </span><a class="code" href="../../d7/d63/structclone__method__data.html">clone_method_data</a> {
<a name="l00124"></a><a class="code" href="../../d7/d63/structclone__method__data.html#afafc32961ee391271ca6747d75249052">00124</a>     <a class="code" href="../../d0/ddd/structst__table.html">st_table</a> *<a class="code" href="../../d7/d63/structclone__method__data.html#afafc32961ee391271ca6747d75249052">tbl</a>;
<a name="l00125"></a><a class="code" href="../../d7/d63/structclone__method__data.html#a26a88a08390ac4ea5b8a727e0595e960">00125</a>     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <a class="code" href="../../d7/d63/structclone__method__data.html#a26a88a08390ac4ea5b8a727e0595e960">klass</a>;
<a name="l00126"></a>00126 };
<a name="l00127"></a>00127 
<a name="l00128"></a>00128 <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <a class="code" href="../../de/ddf/group__class.html#gad44e50d3f03c58fa8d5e4e50558df898">rb_iseq_clone</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> iseqval, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> newcbase);
<a name="l00129"></a>00129 
<a name="l00130"></a>00130 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l00131"></a><a class="code" href="../../de/ddf/group__class.html#gab97b1972dbd9a2fcb6bcc4758d43517e">00131</a> <a class="code" href="../../de/ddf/group__class.html#gab97b1972dbd9a2fcb6bcc4758d43517e">clone_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#afa5b9137f051ac26d7ccc8824f178233">ID</a> mid, <span class="keyword">const</span> <a class="code" href="../../d7/db7/structrb__method__entry__struct.html">rb_method_entry_t</a> *me, <span class="keyword">struct</span> <a class="code" href="../../d7/d63/structclone__method__data.html">clone_method_data</a> *data)
<a name="l00132"></a>00132 {
<a name="l00133"></a>00133     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> newiseqval;
<a name="l00134"></a>00134     <span class="keywordflow">if</span> (me-&gt;<a class="code" href="../../d7/db7/structrb__method__entry__struct.html#a6c868c50e67b757c6324dfef0f3184dc">def</a> &amp;&amp; me-&gt;<a class="code" href="../../d7/db7/structrb__method__entry__struct.html#a6c868c50e67b757c6324dfef0f3184dc">def</a>-&gt;<a class="code" href="../../d6/dab/structrb__method__definition__struct.html#a60ad63aa9037403df6e773853973c41b">type</a> == <a class="code" href="../../db/d0a/method_8h.html#a88a981f6cc69187ed9c2de2630a1687aa09fd70c8c3426502348b7df7c121e505">VM_METHOD_TYPE_ISEQ</a>) {
<a name="l00135"></a>00135         <a class="code" href="../../d6/de3/structrb__iseq__struct.html">rb_iseq_t</a> *iseq;
<a name="l00136"></a>00136         newiseqval = <a class="code" href="../../de/ddf/group__class.html#gad44e50d3f03c58fa8d5e4e50558df898">rb_iseq_clone</a>(me-&gt;<a class="code" href="../../d7/db7/structrb__method__entry__struct.html#a6c868c50e67b757c6324dfef0f3184dc">def</a>-&gt;<a class="code" href="../../d6/dab/structrb__method__definition__struct.html#a83806aa27bac8990f4f9ce83377c76e7">body</a>.<a class="code" href="../../d6/dab/structrb__method__definition__struct.html#aadf9737964ff683c467dfc1b820b1016">iseq</a>-&gt;<a class="code" href="../../d6/de3/structrb__iseq__struct.html#a46d5fb5c3de970a9540ab85d4b060957">self</a>, data-&gt;<a class="code" href="../../d7/d63/structclone__method__data.html#a26a88a08390ac4ea5b8a727e0595e960">klass</a>);
<a name="l00137"></a>00137         <a class="code" href="../../d8/d32/vm__core_8h.html#a5e6a3515e0ad9b9d6a4c0ab577dc50b6">GetISeqPtr</a>(newiseqval, iseq);
<a name="l00138"></a>00138         <a class="code" href="../../db/d0a/method_8h.html#af24b4bc2104eeb955b312d41bb492c5c">rb_add_method</a>(data-&gt;<a class="code" href="../../d7/d63/structclone__method__data.html#a26a88a08390ac4ea5b8a727e0595e960">klass</a>, mid, <a class="code" href="../../db/d0a/method_8h.html#a88a981f6cc69187ed9c2de2630a1687aa09fd70c8c3426502348b7df7c121e505">VM_METHOD_TYPE_ISEQ</a>, iseq, me-&gt;<a class="code" href="../../d7/db7/structrb__method__entry__struct.html#acd723fa7190ed8785ef776bfd3b0d1f4">flag</a>);
<a name="l00139"></a>00139         <a class="code" href="../../d8/df4/generator_8h.html#ad2bf389f3fddea7bd3befa162c70561a">RB_GC_GUARD</a>(newiseqval);
<a name="l00140"></a>00140     }
<a name="l00141"></a>00141     <span class="keywordflow">else</span> {
<a name="l00142"></a>00142         <a class="code" href="../../db/d0a/method_8h.html#a1b4e7cbe648b25d7ce1c4351e5fa764f">rb_method_entry_set</a>(data-&gt;<a class="code" href="../../d7/d63/structclone__method__data.html#a26a88a08390ac4ea5b8a727e0595e960">klass</a>, mid, me, me-&gt;<a class="code" href="../../d7/db7/structrb__method__entry__struct.html#acd723fa7190ed8785ef776bfd3b0d1f4">flag</a>);
<a name="l00143"></a>00143     }
<a name="l00144"></a>00144     <span class="keywordflow">return</span> <a class="code" href="../../dd/d24/st_8h.html#a0c6a172fd99de7928916e65034ed8b1fac99fc55c7f355bf9071739a4bc2ea139">ST_CONTINUE</a>;
<a name="l00145"></a>00145 }
<a name="l00146"></a>00146 
<a name="l00147"></a>00147 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l00148"></a><a class="code" href="../../de/ddf/group__class.html#gab83d0d4629dc9b43adfad59590ec7916">00148</a> <a class="code" href="../../de/ddf/group__class.html#gab83d0d4629dc9b43adfad59590ec7916">clone_const</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#afa5b9137f051ac26d7ccc8824f178233">ID</a> <a class="code" href="../../dc/de5/random_8c.html#a742229490b6759a90ece7ba82ba129d5">key</a>, <span class="keyword">const</span> <a class="code" href="../../d1/df3/structrb__const__entry__struct.html">rb_const_entry_t</a> *ce, <a class="code" href="../../d0/ddd/structst__table.html">st_table</a> *tbl)
<a name="l00149"></a>00149 {
<a name="l00150"></a>00150     <a class="code" href="../../d1/df3/structrb__const__entry__struct.html">rb_const_entry_t</a> *nce = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac8df5a8a8961bd9e16be385fef28c2f2">ALLOC</a>(<a class="code" href="../../d1/df3/structrb__const__entry__struct.html">rb_const_entry_t</a>);
<a name="l00151"></a>00151     *nce = *ce;
<a name="l00152"></a>00152     <a class="code" href="../../dd/d24/st_8h.html#acdc42c01229b7537ea5a4c6965c7e47a">st_insert</a>(tbl, key, (<a class="code" href="../../de/dce/syck_8h.html#a8a45dfe133c1fd041e1b902bda9e43e8">st_data_t</a>)nce);
<a name="l00153"></a>00153     <span class="keywordflow">return</span> <a class="code" href="../../dd/d24/st_8h.html#a0c6a172fd99de7928916e65034ed8b1fac99fc55c7f355bf9071739a4bc2ea139">ST_CONTINUE</a>;
<a name="l00154"></a>00154 }
<a name="l00155"></a>00155 
<a name="l00156"></a>00156 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l00157"></a><a class="code" href="../../de/ddf/group__class.html#gaf6d3b9b8afb5de4b165710c0b479c693">00157</a> <a class="code" href="../../de/ddf/group__class.html#gaf6d3b9b8afb5de4b165710c0b479c693">clone_const_i</a>(<a class="code" href="../../de/dce/syck_8h.html#a8a45dfe133c1fd041e1b902bda9e43e8">st_data_t</a> <a class="code" href="../../dc/de5/random_8c.html#a742229490b6759a90ece7ba82ba129d5">key</a>, <a class="code" href="../../de/dce/syck_8h.html#a8a45dfe133c1fd041e1b902bda9e43e8">st_data_t</a> value, <a class="code" href="../../de/dce/syck_8h.html#a8a45dfe133c1fd041e1b902bda9e43e8">st_data_t</a> data)
<a name="l00158"></a>00158 {
<a name="l00159"></a>00159     <span class="keywordflow">return</span> <a class="code" href="../../de/ddf/group__class.html#gab83d0d4629dc9b43adfad59590ec7916">clone_const</a>((<a class="code" href="../../de/de6/ruby_2ruby_8h.html#afa5b9137f051ac26d7ccc8824f178233">ID</a>)key, (<span class="keyword">const</span> <a class="code" href="../../d1/df3/structrb__const__entry__struct.html">rb_const_entry_t</a> *)value, (<a class="code" href="../../d0/ddd/structst__table.html">st_table</a> *)data);
<a name="l00160"></a>00160 }
<a name="l00161"></a>00161 
<a name="l00162"></a>00162 <span class="comment">/* :nodoc: */</span>
<a name="l00163"></a>00163 <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l00164"></a><a class="code" href="../../de/ddf/group__class.html#gad07c6e5c16119f126bcdc68e8227853d">00164</a> <a class="code" href="../../de/ddf/group__class.html#gad07c6e5c16119f126bcdc68e8227853d">rb_mod_init_copy</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> clone, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> orig)
<a name="l00165"></a>00165 {
<a name="l00166"></a>00166     <a class="code" href="../../db/d2e/intern_8h.html#a4d288ecd1aa624a3f59d3984a8a4376f">rb_obj_init_copy</a>(clone, orig);
<a name="l00167"></a>00167     <span class="keywordflow">if</span> (!<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a1ae918b6cc84188a9dc6ab545f732e4d">FL_TEST</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#ad07df58de9895cbc33c10f02540d2d4d">CLASS_OF</a>(clone), <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a081b5172ef37829bb3a258cd1ad393bc">FL_SINGLETON</a>)) {
<a name="l00168"></a>00168         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a1d4c05021aacd8cab989ff60f95ebe2d">RBASIC</a>(clone)-&gt;klass = <a class="code" href="../../de/ddf/group__class.html#ga1ee97616fa7c3a3a8a672218a0386ad7">rb_singleton_class_clone</a>(orig);
<a name="l00169"></a>00169         <a class="code" href="../../de/ddf/group__class.html#gaa588a0a6fe110249bf64f1e6dba99543" title="Attach a object to a singleton class.">rb_singleton_class_attached</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a1d4c05021aacd8cab989ff60f95ebe2d">RBASIC</a>(clone)-&gt;klass, (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>)clone);
<a name="l00170"></a>00170     }
<a name="l00171"></a>00171     <a class="code" href="../../d3/d09/ripper_8y.html#a19d17315b6b34045cdffec9912342b91">RCLASS_SUPER</a>(clone) = <a class="code" href="../../d3/d09/ripper_8y.html#a19d17315b6b34045cdffec9912342b91">RCLASS_SUPER</a>(orig);
<a name="l00172"></a>00172     <span class="keywordflow">if</span> (<a class="code" href="../../d3/d09/ripper_8y.html#a7f7f2dbf958976d9bf317167396992d4">RCLASS_IV_TBL</a>(orig)) {
<a name="l00173"></a>00173         <a class="code" href="../../de/dce/syck_8h.html#a8a45dfe133c1fd041e1b902bda9e43e8">st_data_t</a> <a class="code" href="../../d6/da0/nkf-utf8_2nkf_8c.html#a64ae40793ade89d800a8c5646d2980fc">id</a>;
<a name="l00174"></a>00174 
<a name="l00175"></a>00175         <span class="keywordflow">if</span> (<a class="code" href="../../d3/d09/ripper_8y.html#a7f7f2dbf958976d9bf317167396992d4">RCLASS_IV_TBL</a>(clone)) {
<a name="l00176"></a>00176             <a class="code" href="../../dd/d24/st_8h.html#acb004847ef312373d65bfb0d1a21c5b3">st_free_table</a>(<a class="code" href="../../d3/d09/ripper_8y.html#a7f7f2dbf958976d9bf317167396992d4">RCLASS_IV_TBL</a>(clone));
<a name="l00177"></a>00177         }
<a name="l00178"></a>00178         <a class="code" href="../../d3/d09/ripper_8y.html#a7f7f2dbf958976d9bf317167396992d4">RCLASS_IV_TBL</a>(clone) = <a class="code" href="../../dd/d24/st_8h.html#a7dbfd8e3a251a09c8543b301bcef0cb5">st_copy</a>(<a class="code" href="../../d3/d09/ripper_8y.html#a7f7f2dbf958976d9bf317167396992d4">RCLASS_IV_TBL</a>(orig));
<a name="l00179"></a>00179         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aa50b9d5bc665eb5545f6857c89232161">CONST_ID</a>(<span class="keywordtype">id</span>, <span class="stringliteral">&quot;__classpath__&quot;</span>);
<a name="l00180"></a>00180         <a class="code" href="../../dd/d24/st_8h.html#aa04e4ee0a6e1f19e64f3be4668f41234">st_delete</a>(<a class="code" href="../../d3/d09/ripper_8y.html#a7f7f2dbf958976d9bf317167396992d4">RCLASS_IV_TBL</a>(clone), &amp;<span class="keywordtype">id</span>, 0);
<a name="l00181"></a>00181         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aa50b9d5bc665eb5545f6857c89232161">CONST_ID</a>(<span class="keywordtype">id</span>, <span class="stringliteral">&quot;__classid__&quot;</span>);
<a name="l00182"></a>00182         <a class="code" href="../../dd/d24/st_8h.html#aa04e4ee0a6e1f19e64f3be4668f41234">st_delete</a>(<a class="code" href="../../d3/d09/ripper_8y.html#a7f7f2dbf958976d9bf317167396992d4">RCLASS_IV_TBL</a>(clone), &amp;<span class="keywordtype">id</span>, 0);
<a name="l00183"></a>00183     }
<a name="l00184"></a>00184     <span class="keywordflow">if</span> (<a class="code" href="../../d3/d09/ripper_8y.html#a9dfcc3730f2a2a5ef643c2b6c3e606d1">RCLASS_CONST_TBL</a>(orig)) {
<a name="l00185"></a>00185         <span class="keywordflow">if</span> (<a class="code" href="../../d3/d09/ripper_8y.html#a9dfcc3730f2a2a5ef643c2b6c3e606d1">RCLASS_CONST_TBL</a>(clone)) {
<a name="l00186"></a>00186             <a class="code" href="../../dd/d17/constant_8h.html#ac0930709fa9ea2985f4513b9ea1631eb">rb_free_const_table</a>(<a class="code" href="../../d3/d09/ripper_8y.html#a9dfcc3730f2a2a5ef643c2b6c3e606d1">RCLASS_CONST_TBL</a>(clone));
<a name="l00187"></a>00187         }
<a name="l00188"></a>00188         <a class="code" href="../../d3/d09/ripper_8y.html#a9dfcc3730f2a2a5ef643c2b6c3e606d1">RCLASS_CONST_TBL</a>(clone) = <a class="code" href="../../dd/d24/st_8h.html#a955c6e936b9681649ab9ffa4aa741949">st_init_numtable</a>();
<a name="l00189"></a>00189         <a class="code" href="../../dd/d24/st_8h.html#ace5a79870d2800659a653fceeca55262">st_foreach</a>(<a class="code" href="../../d3/d09/ripper_8y.html#a9dfcc3730f2a2a5ef643c2b6c3e606d1">RCLASS_CONST_TBL</a>(orig), <a class="code" href="../../de/ddf/group__class.html#gaf6d3b9b8afb5de4b165710c0b479c693">clone_const_i</a>, (<a class="code" href="../../de/dce/syck_8h.html#a8a45dfe133c1fd041e1b902bda9e43e8">st_data_t</a>)<a class="code" href="../../d3/d09/ripper_8y.html#a9dfcc3730f2a2a5ef643c2b6c3e606d1">RCLASS_CONST_TBL</a>(clone));
<a name="l00190"></a>00190     }
<a name="l00191"></a>00191     <span class="keywordflow">if</span> (<a class="code" href="../../d3/d09/ripper_8y.html#ab59ea80cdf15f3f19bbae0346314c9ad">RCLASS_M_TBL</a>(orig)) {
<a name="l00192"></a>00192         <span class="keyword">struct </span><a class="code" href="../../d7/d63/structclone__method__data.html">clone_method_data</a> data;
<a name="l00193"></a>00193 
<a name="l00194"></a>00194         <span class="keywordflow">if</span> (<a class="code" href="../../d3/d09/ripper_8y.html#ab59ea80cdf15f3f19bbae0346314c9ad">RCLASS_M_TBL</a>(clone)) {
<a name="l00195"></a>00195             <a class="code" href="../../d8/d16/gc_8c.html#ab38e8b9b35211acb88ff3f8d2070be9f">rb_free_m_table</a>(<a class="code" href="../../d3/d09/ripper_8y.html#ab59ea80cdf15f3f19bbae0346314c9ad">RCLASS_M_TBL</a>(clone));
<a name="l00196"></a>00196         }
<a name="l00197"></a>00197         data.<a class="code" href="../../d7/d63/structclone__method__data.html#afafc32961ee391271ca6747d75249052">tbl</a> = <a class="code" href="../../d3/d09/ripper_8y.html#ab59ea80cdf15f3f19bbae0346314c9ad">RCLASS_M_TBL</a>(clone) = <a class="code" href="../../dd/d24/st_8h.html#a955c6e936b9681649ab9ffa4aa741949">st_init_numtable</a>();
<a name="l00198"></a>00198         data.<a class="code" href="../../d7/d63/structclone__method__data.html#a26a88a08390ac4ea5b8a727e0595e960">klass</a> = clone;
<a name="l00199"></a>00199         <a class="code" href="../../dd/d24/st_8h.html#ace5a79870d2800659a653fceeca55262">st_foreach</a>(<a class="code" href="../../d3/d09/ripper_8y.html#ab59ea80cdf15f3f19bbae0346314c9ad">RCLASS_M_TBL</a>(orig), <a class="code" href="../../de/ddf/group__class.html#gab97b1972dbd9a2fcb6bcc4758d43517e">clone_method</a>,
<a name="l00200"></a>00200                    (<a class="code" href="../../de/dce/syck_8h.html#a8a45dfe133c1fd041e1b902bda9e43e8">st_data_t</a>)&amp;data);
<a name="l00201"></a>00201     }
<a name="l00202"></a>00202 
<a name="l00203"></a>00203     <span class="keywordflow">return</span> clone;
<a name="l00204"></a>00204 }
<a name="l00205"></a>00205 
<a name="l00206"></a>00206 <span class="comment">/* :nodoc: */</span>
<a name="l00207"></a>00207 <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l00208"></a><a class="code" href="../../de/ddf/group__class.html#ga5c76335cdbaf55e22901428cd87e9979">00208</a> <a class="code" href="../../de/ddf/group__class.html#ga5c76335cdbaf55e22901428cd87e9979">rb_class_init_copy</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> clone, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> orig)
<a name="l00209"></a>00209 {
<a name="l00210"></a>00210     <span class="keywordflow">if</span> (orig == <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a56629236cdaf6ddac6d05cd5ae21a2b4">rb_cBasicObject</a>) {
<a name="l00211"></a>00211         <a class="code" href="../../db/dcc/error_8c.html#a0f771a2840561f1838169b3d7d4616f3">rb_raise</a>(<a class="code" href="../../db/dcc/error_8c.html#a565ed9d70f4089e1b4a36e9b3381b8c6">rb_eTypeError</a>, <span class="stringliteral">&quot;can&apos;t copy the root class&quot;</span>);
<a name="l00212"></a>00212     }
<a name="l00213"></a>00213     <span class="keywordflow">if</span> (<a class="code" href="../../d3/d09/ripper_8y.html#a19d17315b6b34045cdffec9912342b91">RCLASS_SUPER</a>(clone) != 0 || clone == <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a56629236cdaf6ddac6d05cd5ae21a2b4">rb_cBasicObject</a>) {
<a name="l00214"></a>00214         <a class="code" href="../../db/dcc/error_8c.html#a0f771a2840561f1838169b3d7d4616f3">rb_raise</a>(<a class="code" href="../../db/dcc/error_8c.html#a565ed9d70f4089e1b4a36e9b3381b8c6">rb_eTypeError</a>, <span class="stringliteral">&quot;already initialized class&quot;</span>);
<a name="l00215"></a>00215     }
<a name="l00216"></a>00216     <span class="keywordflow">if</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a1ae918b6cc84188a9dc6ab545f732e4d">FL_TEST</a>(orig, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a081b5172ef37829bb3a258cd1ad393bc">FL_SINGLETON</a>)) {
<a name="l00217"></a>00217         <a class="code" href="../../db/dcc/error_8c.html#a0f771a2840561f1838169b3d7d4616f3">rb_raise</a>(<a class="code" href="../../db/dcc/error_8c.html#a565ed9d70f4089e1b4a36e9b3381b8c6">rb_eTypeError</a>, <span class="stringliteral">&quot;can&apos;t copy singleton class&quot;</span>);
<a name="l00218"></a>00218     }
<a name="l00219"></a>00219     <span class="keywordflow">return</span> <a class="code" href="../../de/ddf/group__class.html#gad07c6e5c16119f126bcdc68e8227853d">rb_mod_init_copy</a>(clone, orig);
<a name="l00220"></a>00220 }
<a name="l00221"></a>00221 
<a name="l00222"></a>00222 <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l00223"></a><a class="code" href="../../de/ddf/group__class.html#ga1ee97616fa7c3a3a8a672218a0386ad7">00223</a> <a class="code" href="../../de/ddf/group__class.html#ga1ee97616fa7c3a3a8a672218a0386ad7">rb_singleton_class_clone</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> obj)
<a name="l00224"></a>00224 {
<a name="l00225"></a>00225     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <a class="code" href="../../d7/d63/structclone__method__data.html#a26a88a08390ac4ea5b8a727e0595e960">klass</a> = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a1d4c05021aacd8cab989ff60f95ebe2d">RBASIC</a>(obj)-&gt;klass;
<a name="l00226"></a>00226 
<a name="l00227"></a>00227     <span class="keywordflow">if</span> (!<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a1ae918b6cc84188a9dc6ab545f732e4d">FL_TEST</a>(klass, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a081b5172ef37829bb3a258cd1ad393bc">FL_SINGLETON</a>))
<a name="l00228"></a>00228         <span class="keywordflow">return</span> klass;
<a name="l00229"></a>00229     <span class="keywordflow">else</span> {
<a name="l00230"></a>00230         <span class="keyword">struct </span><a class="code" href="../../d7/d63/structclone__method__data.html">clone_method_data</a> data;
<a name="l00231"></a>00231         <span class="comment">/* copy singleton(unnamed) class */</span>
<a name="l00232"></a>00232         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> clone = <a class="code" href="../../de/ddf/group__class.html#gab3375e6e7d925cb966d8c1f808c44595" title="Allocates a struct RClass for a new class.">class_alloc</a>((<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a1d4c05021aacd8cab989ff60f95ebe2d">RBASIC</a>(klass)-&gt;flags &amp; ~(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a39ebc82a159cc4776f6ca7037cbd2e26">FL_MARK</a>)), 0);
<a name="l00233"></a>00233 
<a name="l00234"></a>00234         <span class="keywordflow">if</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#aee74f540353cd2d77d1cb37a3714bd7d">BUILTIN_TYPE</a>(obj) == <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ad04c63d175774c6d6e7dfaf0f0a982c9">T_CLASS</a>) {
<a name="l00235"></a>00235             <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a1d4c05021aacd8cab989ff60f95ebe2d">RBASIC</a>(clone)-&gt;klass = (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>)clone;
<a name="l00236"></a>00236         }
<a name="l00237"></a>00237         <span class="keywordflow">else</span> {
<a name="l00238"></a>00238             <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a1d4c05021aacd8cab989ff60f95ebe2d">RBASIC</a>(clone)-&gt;klass = <a class="code" href="../../de/ddf/group__class.html#ga1ee97616fa7c3a3a8a672218a0386ad7">rb_singleton_class_clone</a>(klass);
<a name="l00239"></a>00239         }
<a name="l00240"></a>00240 
<a name="l00241"></a>00241         <a class="code" href="../../d3/d09/ripper_8y.html#a19d17315b6b34045cdffec9912342b91">RCLASS_SUPER</a>(clone) = <a class="code" href="../../d3/d09/ripper_8y.html#a19d17315b6b34045cdffec9912342b91">RCLASS_SUPER</a>(klass);
<a name="l00242"></a>00242         <span class="keywordflow">if</span> (<a class="code" href="../../d3/d09/ripper_8y.html#a7f7f2dbf958976d9bf317167396992d4">RCLASS_IV_TBL</a>(klass)) {
<a name="l00243"></a>00243             <a class="code" href="../../d3/d09/ripper_8y.html#a7f7f2dbf958976d9bf317167396992d4">RCLASS_IV_TBL</a>(clone) = <a class="code" href="../../dd/d24/st_8h.html#a7dbfd8e3a251a09c8543b301bcef0cb5">st_copy</a>(<a class="code" href="../../d3/d09/ripper_8y.html#a7f7f2dbf958976d9bf317167396992d4">RCLASS_IV_TBL</a>(klass));
<a name="l00244"></a>00244         }
<a name="l00245"></a>00245         <span class="keywordflow">if</span> (<a class="code" href="../../d3/d09/ripper_8y.html#a9dfcc3730f2a2a5ef643c2b6c3e606d1">RCLASS_CONST_TBL</a>(klass)) {
<a name="l00246"></a>00246             <a class="code" href="../../d3/d09/ripper_8y.html#a9dfcc3730f2a2a5ef643c2b6c3e606d1">RCLASS_CONST_TBL</a>(clone) = <a class="code" href="../../dd/d24/st_8h.html#a955c6e936b9681649ab9ffa4aa741949">st_init_numtable</a>();
<a name="l00247"></a>00247             <a class="code" href="../../dd/d24/st_8h.html#ace5a79870d2800659a653fceeca55262">st_foreach</a>(<a class="code" href="../../d3/d09/ripper_8y.html#a9dfcc3730f2a2a5ef643c2b6c3e606d1">RCLASS_CONST_TBL</a>(klass), <a class="code" href="../../de/ddf/group__class.html#gaf6d3b9b8afb5de4b165710c0b479c693">clone_const_i</a>, (<a class="code" href="../../de/dce/syck_8h.html#a8a45dfe133c1fd041e1b902bda9e43e8">st_data_t</a>)<a class="code" href="../../d3/d09/ripper_8y.html#a9dfcc3730f2a2a5ef643c2b6c3e606d1">RCLASS_CONST_TBL</a>(clone));
<a name="l00248"></a>00248         }
<a name="l00249"></a>00249         <a class="code" href="../../d3/d09/ripper_8y.html#ab59ea80cdf15f3f19bbae0346314c9ad">RCLASS_M_TBL</a>(clone) = <a class="code" href="../../dd/d24/st_8h.html#a955c6e936b9681649ab9ffa4aa741949">st_init_numtable</a>();
<a name="l00250"></a>00250         data.<a class="code" href="../../d7/d63/structclone__method__data.html#afafc32961ee391271ca6747d75249052">tbl</a> = <a class="code" href="../../d3/d09/ripper_8y.html#ab59ea80cdf15f3f19bbae0346314c9ad">RCLASS_M_TBL</a>(clone);
<a name="l00251"></a>00251         data.<a class="code" href="../../d7/d63/structclone__method__data.html#a26a88a08390ac4ea5b8a727e0595e960">klass</a> = (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>)clone;
<a name="l00252"></a>00252         <a class="code" href="../../dd/d24/st_8h.html#ace5a79870d2800659a653fceeca55262">st_foreach</a>(<a class="code" href="../../d3/d09/ripper_8y.html#ab59ea80cdf15f3f19bbae0346314c9ad">RCLASS_M_TBL</a>(klass), <a class="code" href="../../de/ddf/group__class.html#gab97b1972dbd9a2fcb6bcc4758d43517e">clone_method</a>,
<a name="l00253"></a>00253                    (<a class="code" href="../../de/dce/syck_8h.html#a8a45dfe133c1fd041e1b902bda9e43e8">st_data_t</a>)&amp;data);
<a name="l00254"></a>00254         <a class="code" href="../../de/ddf/group__class.html#gaa588a0a6fe110249bf64f1e6dba99543" title="Attach a object to a singleton class.">rb_singleton_class_attached</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a1d4c05021aacd8cab989ff60f95ebe2d">RBASIC</a>(clone)-&gt;klass, (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>)clone);
<a name="l00255"></a>00255         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a38d7199dc0d1dc7f7207a9b3091c8d0d">FL_SET</a>(clone, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a081b5172ef37829bb3a258cd1ad393bc">FL_SINGLETON</a>);
<a name="l00256"></a>00256         <span class="keywordflow">return</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>)clone;
<a name="l00257"></a>00257     }
<a name="l00258"></a>00258 }
<a name="l00259"></a>00259 
<a name="l00264"></a>00264 <span class="keywordtype">void</span>
<a name="l00265"></a><a class="code" href="../../de/ddf/group__class.html#gaa588a0a6fe110249bf64f1e6dba99543">00265</a> <a class="code" href="../../de/ddf/group__class.html#gaa588a0a6fe110249bf64f1e6dba99543" title="Attach a object to a singleton class.">rb_singleton_class_attached</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <a class="code" href="../../d7/d63/structclone__method__data.html#a26a88a08390ac4ea5b8a727e0595e960">klass</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> obj)
<a name="l00266"></a>00266 {
<a name="l00267"></a>00267     <span class="keywordflow">if</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a1ae918b6cc84188a9dc6ab545f732e4d">FL_TEST</a>(klass, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a081b5172ef37829bb3a258cd1ad393bc">FL_SINGLETON</a>)) {
<a name="l00268"></a>00268         <span class="keywordflow">if</span> (!<a class="code" href="../../d3/d09/ripper_8y.html#a7f7f2dbf958976d9bf317167396992d4">RCLASS_IV_TBL</a>(klass)) {
<a name="l00269"></a>00269             <a class="code" href="../../d3/d09/ripper_8y.html#a7f7f2dbf958976d9bf317167396992d4">RCLASS_IV_TBL</a>(klass) = <a class="code" href="../../dd/d24/st_8h.html#a955c6e936b9681649ab9ffa4aa741949">st_init_numtable</a>();
<a name="l00270"></a>00270         }
<a name="l00271"></a>00271         <a class="code" href="../../dd/d24/st_8h.html#acdc42c01229b7537ea5a4c6965c7e47a">st_insert</a>(<a class="code" href="../../d3/d09/ripper_8y.html#a7f7f2dbf958976d9bf317167396992d4">RCLASS_IV_TBL</a>(klass), <a class="code" href="../../de/ddf/group__class.html#gafd0c71501c641400fa9d557bd5cca7dd">id_attached</a>, obj);
<a name="l00272"></a>00272     }
<a name="l00273"></a>00273 }
<a name="l00274"></a>00274 
<a name="l00275"></a>00275 
<a name="l00276"></a>00276 
<a name="l00277"></a><a class="code" href="../../de/ddf/group__class.html#ga55ff2cbac60068e34c85976e1293e50d">00277</a> <span class="preprocessor">#define METACLASS_OF(k) RBASIC(k)-&gt;klass</span>
<a name="l00278"></a>00278 <span class="preprocessor"></span>
<a name="l00284"></a><a class="code" href="../../de/ddf/group__class.html#ga664bbd6e369634b551c2f70417af0664">00284</a> <span class="preprocessor">#define META_CLASS_OF_CLASS_CLASS_P(k)  (METACLASS_OF(k) == (k))</span>
<a name="l00285"></a>00285 <span class="preprocessor"></span>
<a name="l00286"></a>00286 
<a name="l00294"></a><a class="code" href="../../de/ddf/group__class.html#gacabc51ae26600f1bfeeba323e2bb734a">00294</a> <span class="preprocessor">#define ENSURE_EIGENCLASS(klass) \</span>
<a name="l00295"></a>00295 <span class="preprocessor"> (rb_ivar_get(METACLASS_OF(klass), id_attached) == (klass) ? METACLASS_OF(klass) : make_metaclass(klass))</span>
<a name="l00296"></a>00296 <span class="preprocessor"></span>
<a name="l00297"></a>00297 
<a name="l00307"></a>00307 <span class="keyword">static</span> <span class="keyword">inline</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l00308"></a><a class="code" href="../../de/ddf/group__class.html#gaaf679dec02c22eddf75373d7772910d9">00308</a> <a class="code" href="../../de/ddf/group__class.html#gaaf679dec02c22eddf75373d7772910d9" title="Creates a metaclass of klass.">make_metaclass</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <a class="code" href="../../d7/d63/structclone__method__data.html#a26a88a08390ac4ea5b8a727e0595e960">klass</a>)
<a name="l00309"></a>00309 {
<a name="l00310"></a>00310     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> super;
<a name="l00311"></a>00311     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> metaclass = <a class="code" href="../../de/ddf/group__class.html#ga8f7544343ddabc50fa64ab912ed9e7f8" title="A utility function that wraps class_alloc.">rb_class_boot</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a2edf6990280eb2637623ccd421dee4f0">Qundef</a>);
<a name="l00312"></a>00312 
<a name="l00313"></a>00313     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a38d7199dc0d1dc7f7207a9b3091c8d0d">FL_SET</a>(metaclass, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a081b5172ef37829bb3a258cd1ad393bc">FL_SINGLETON</a>);
<a name="l00314"></a>00314     <a class="code" href="../../de/ddf/group__class.html#gaa588a0a6fe110249bf64f1e6dba99543" title="Attach a object to a singleton class.">rb_singleton_class_attached</a>(metaclass, klass);
<a name="l00315"></a>00315 
<a name="l00316"></a>00316     <span class="keywordflow">if</span> (<a class="code" href="../../de/ddf/group__class.html#ga664bbd6e369634b551c2f70417af0664" title="whether k is a meta^(n)-class of Class class">META_CLASS_OF_CLASS_CLASS_P</a>(klass)) {
<a name="l00317"></a>00317         <a class="code" href="../../de/ddf/group__class.html#ga55ff2cbac60068e34c85976e1293e50d">METACLASS_OF</a>(klass) = <a class="code" href="../../de/ddf/group__class.html#ga55ff2cbac60068e34c85976e1293e50d">METACLASS_OF</a>(metaclass) = metaclass;
<a name="l00318"></a>00318     }
<a name="l00319"></a>00319     <span class="keywordflow">else</span> {
<a name="l00320"></a>00320         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> tmp = <a class="code" href="../../de/ddf/group__class.html#ga55ff2cbac60068e34c85976e1293e50d">METACLASS_OF</a>(klass); <span class="comment">/* for a meta^(n)-class klass, tmp is meta^(n)-class of Class class */</span>
<a name="l00321"></a>00321         <a class="code" href="../../de/ddf/group__class.html#ga55ff2cbac60068e34c85976e1293e50d">METACLASS_OF</a>(klass) = metaclass;
<a name="l00322"></a>00322         <a class="code" href="../../de/ddf/group__class.html#ga55ff2cbac60068e34c85976e1293e50d">METACLASS_OF</a>(metaclass) = <a class="code" href="../../de/ddf/group__class.html#gacabc51ae26600f1bfeeba323e2bb734a" title="ensures klass belongs to its own eigenclass.">ENSURE_EIGENCLASS</a>(tmp);
<a name="l00323"></a>00323     }
<a name="l00324"></a>00324 
<a name="l00325"></a>00325     super = <a class="code" href="../../d3/d09/ripper_8y.html#a19d17315b6b34045cdffec9912342b91">RCLASS_SUPER</a>(klass);
<a name="l00326"></a>00326     <span class="keywordflow">while</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac4f895997656c2abd27a29a8b8e982ca">RB_TYPE_P</a>(super, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a82c8c4569748b9645c958b9eaeaabb81">T_ICLASS</a>)) super = <a class="code" href="../../d3/d09/ripper_8y.html#a19d17315b6b34045cdffec9912342b91">RCLASS_SUPER</a>(super);
<a name="l00327"></a>00327     <a class="code" href="../../d3/d09/ripper_8y.html#a19d17315b6b34045cdffec9912342b91">RCLASS_SUPER</a>(metaclass) = super ? <a class="code" href="../../de/ddf/group__class.html#gacabc51ae26600f1bfeeba323e2bb734a" title="ensures klass belongs to its own eigenclass.">ENSURE_EIGENCLASS</a>(super) : <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a39a2be92a95d7219204ab58d8f40533d">rb_cClass</a>;
<a name="l00328"></a>00328 
<a name="l00329"></a>00329     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3bf9ab455a1e0e3e8cfc6ebabd8f12df">OBJ_INFECT</a>(metaclass, <a class="code" href="../../d3/d09/ripper_8y.html#a19d17315b6b34045cdffec9912342b91">RCLASS_SUPER</a>(metaclass));
<a name="l00330"></a>00330 
<a name="l00331"></a>00331     <span class="keywordflow">return</span> metaclass;
<a name="l00332"></a>00332 }
<a name="l00333"></a>00333 
<a name="l00340"></a>00340 <span class="keyword">static</span> <span class="keyword">inline</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l00341"></a><a class="code" href="../../de/ddf/group__class.html#ga19f788e8f350c37b17b6d3c44e690446">00341</a> <a class="code" href="../../de/ddf/group__class.html#ga19f788e8f350c37b17b6d3c44e690446" title="Creates a singleton class for obj.">make_singleton_class</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> obj)
<a name="l00342"></a>00342 {
<a name="l00343"></a>00343     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> orig_class = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a1d4c05021aacd8cab989ff60f95ebe2d">RBASIC</a>(obj)-&gt;klass;
<a name="l00344"></a>00344     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <a class="code" href="../../d7/d63/structclone__method__data.html#a26a88a08390ac4ea5b8a727e0595e960">klass</a> = <a class="code" href="../../de/ddf/group__class.html#ga8f7544343ddabc50fa64ab912ed9e7f8" title="A utility function that wraps class_alloc.">rb_class_boot</a>(orig_class);
<a name="l00345"></a>00345 
<a name="l00346"></a>00346     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a38d7199dc0d1dc7f7207a9b3091c8d0d">FL_SET</a>(klass, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a081b5172ef37829bb3a258cd1ad393bc">FL_SINGLETON</a>);
<a name="l00347"></a>00347     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a1d4c05021aacd8cab989ff60f95ebe2d">RBASIC</a>(obj)-&gt;klass = klass;
<a name="l00348"></a>00348     <a class="code" href="../../de/ddf/group__class.html#gaa588a0a6fe110249bf64f1e6dba99543" title="Attach a object to a singleton class.">rb_singleton_class_attached</a>(klass, obj);
<a name="l00349"></a>00349 
<a name="l00350"></a>00350     <a class="code" href="../../de/ddf/group__class.html#ga55ff2cbac60068e34c85976e1293e50d">METACLASS_OF</a>(klass) = <a class="code" href="../../de/ddf/group__class.html#ga55ff2cbac60068e34c85976e1293e50d">METACLASS_OF</a>(<a class="code" href="../../db/d2e/intern_8h.html#ab4b2dc0dd79654335ec8fc99ed9880d6">rb_class_real</a>(orig_class));
<a name="l00351"></a>00351     <span class="keywordflow">return</span> klass;
<a name="l00352"></a>00352 }
<a name="l00353"></a>00353 
<a name="l00354"></a>00354 
<a name="l00355"></a>00355 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l00356"></a><a class="code" href="../../de/ddf/group__class.html#ga4e9d36dd527e7b3a368aef49289a0b21">00356</a> <a class="code" href="../../de/ddf/group__class.html#ga4e9d36dd527e7b3a368aef49289a0b21">boot_defclass</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d6/da0/nkf-utf8_2nkf_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> super)
<a name="l00357"></a>00357 {
<a name="l00358"></a>00358     <span class="keyword">extern</span> <a class="code" href="../../d0/ddd/structst__table.html">st_table</a> *rb_class_tbl;
<a name="l00359"></a>00359     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> obj = <a class="code" href="../../de/ddf/group__class.html#ga8f7544343ddabc50fa64ab912ed9e7f8" title="A utility function that wraps class_alloc.">rb_class_boot</a>(super);
<a name="l00360"></a>00360     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#afa5b9137f051ac26d7ccc8824f178233">ID</a> <span class="keywordtype">id</span> = <a class="code" href="../../dc/dcc/array_8c.html#a9cfa42d4b79c89d68c53be8b2150a503">rb_intern</a>(name);
<a name="l00361"></a>00361 
<a name="l00362"></a>00362     <a class="code" href="../../db/d2e/intern_8h.html#a53e6d39dcb7118f8360db8cd2ae61c2e">rb_name_class</a>(obj, <span class="keywordtype">id</span>);
<a name="l00363"></a>00363     <a class="code" href="../../dd/d24/st_8h.html#aee4e16ae99cd543ddf851107d5ea5408">st_add_direct</a>(rb_class_tbl, <span class="keywordtype">id</span>, obj);
<a name="l00364"></a>00364     <a class="code" href="../../db/d2e/intern_8h.html#aaa03be2caf9a365acc44c307dfda6430">rb_const_set</a>((<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a57c96ead3ef230b4838e65fe037c346e">rb_cObject</a> ? <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a57c96ead3ef230b4838e65fe037c346e">rb_cObject</a> : obj), <span class="keywordtype">id</span>, obj);
<a name="l00365"></a>00365     <span class="keywordflow">return</span> obj;
<a name="l00366"></a>00366 }
<a name="l00367"></a>00367 
<a name="l00368"></a>00368 <span class="keywordtype">void</span>
<a name="l00369"></a><a class="code" href="../../de/ddf/group__class.html#ga4c892581fb7649feda7e92202dfc7943">00369</a> <a class="code" href="../../de/ddf/group__class.html#ga4c892581fb7649feda7e92202dfc7943">Init_class_hierarchy</a>(<span class="keywordtype">void</span>)
<a name="l00370"></a>00370 {
<a name="l00371"></a>00371     <a class="code" href="../../de/ddf/group__class.html#gafd0c71501c641400fa9d557bd5cca7dd">id_attached</a> = <a class="code" href="../../dc/dcc/array_8c.html#a9cfa42d4b79c89d68c53be8b2150a503">rb_intern</a>(<span class="stringliteral">&quot;__attached__&quot;</span>);
<a name="l00372"></a>00372 
<a name="l00373"></a>00373     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a56629236cdaf6ddac6d05cd5ae21a2b4">rb_cBasicObject</a> = <a class="code" href="../../de/ddf/group__class.html#ga4e9d36dd527e7b3a368aef49289a0b21">boot_defclass</a>(<span class="stringliteral">&quot;BasicObject&quot;</span>, 0);
<a name="l00374"></a>00374     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a57c96ead3ef230b4838e65fe037c346e">rb_cObject</a> = <a class="code" href="../../de/ddf/group__class.html#ga4e9d36dd527e7b3a368aef49289a0b21">boot_defclass</a>(<span class="stringliteral">&quot;Object&quot;</span>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a56629236cdaf6ddac6d05cd5ae21a2b4">rb_cBasicObject</a>);
<a name="l00375"></a>00375     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ad35b93cf98ae9c41f3394fd51383f774">rb_cModule</a> = <a class="code" href="../../de/ddf/group__class.html#ga4e9d36dd527e7b3a368aef49289a0b21">boot_defclass</a>(<span class="stringliteral">&quot;Module&quot;</span>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a57c96ead3ef230b4838e65fe037c346e">rb_cObject</a>);
<a name="l00376"></a>00376     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a39a2be92a95d7219204ab58d8f40533d">rb_cClass</a> =  <a class="code" href="../../de/ddf/group__class.html#ga4e9d36dd527e7b3a368aef49289a0b21">boot_defclass</a>(<span class="stringliteral">&quot;Class&quot;</span>,  <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ad35b93cf98ae9c41f3394fd51383f774">rb_cModule</a>);
<a name="l00377"></a>00377 
<a name="l00378"></a>00378     <a class="code" href="../../db/d2e/intern_8h.html#aaa03be2caf9a365acc44c307dfda6430">rb_const_set</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a57c96ead3ef230b4838e65fe037c346e">rb_cObject</a>, <a class="code" href="../../dc/dcc/array_8c.html#a9cfa42d4b79c89d68c53be8b2150a503">rb_intern</a>(<span class="stringliteral">&quot;BasicObject&quot;</span>), <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a56629236cdaf6ddac6d05cd5ae21a2b4">rb_cBasicObject</a>);
<a name="l00379"></a>00379     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a1d4c05021aacd8cab989ff60f95ebe2d">RBASIC</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a39a2be92a95d7219204ab58d8f40533d">rb_cClass</a>)-&gt;klass
<a name="l00380"></a>00380         = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a1d4c05021aacd8cab989ff60f95ebe2d">RBASIC</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#ad35b93cf98ae9c41f3394fd51383f774">rb_cModule</a>)-&gt;klass
<a name="l00381"></a>00381         = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a1d4c05021aacd8cab989ff60f95ebe2d">RBASIC</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a57c96ead3ef230b4838e65fe037c346e">rb_cObject</a>)-&gt;klass
<a name="l00382"></a>00382         = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a1d4c05021aacd8cab989ff60f95ebe2d">RBASIC</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a56629236cdaf6ddac6d05cd5ae21a2b4">rb_cBasicObject</a>)-&gt;klass
<a name="l00383"></a>00383         = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a39a2be92a95d7219204ab58d8f40533d">rb_cClass</a>;
<a name="l00384"></a>00384 }
<a name="l00385"></a>00385 
<a name="l00386"></a>00386 
<a name="l00397"></a>00397 <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l00398"></a><a class="code" href="../../de/ddf/group__class.html#gaef068643bdd141d298acf0a0041d871a">00398</a> <a class="code" href="../../de/ddf/group__class.html#gaef068643bdd141d298acf0a0041d871a">rb_make_metaclass</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> obj, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> unused)
<a name="l00399"></a>00399 {
<a name="l00400"></a>00400     <span class="keywordflow">if</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#aee74f540353cd2d77d1cb37a3714bd7d">BUILTIN_TYPE</a>(obj) == <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ad04c63d175774c6d6e7dfaf0f0a982c9">T_CLASS</a>) {
<a name="l00401"></a>00401         <span class="keywordflow">return</span> <a class="code" href="../../de/ddf/group__class.html#gaaf679dec02c22eddf75373d7772910d9" title="Creates a metaclass of klass.">make_metaclass</a>(obj);
<a name="l00402"></a>00402     }
<a name="l00403"></a>00403     <span class="keywordflow">else</span> {
<a name="l00404"></a>00404         <span class="keywordflow">return</span> <a class="code" href="../../de/ddf/group__class.html#ga19f788e8f350c37b17b6d3c44e690446" title="Creates a singleton class for obj.">make_singleton_class</a>(obj);
<a name="l00405"></a>00405     }
<a name="l00406"></a>00406 }
<a name="l00407"></a>00407 
<a name="l00408"></a>00408 
<a name="l00419"></a>00419 <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l00420"></a><a class="code" href="../../de/ddf/group__class.html#gafb70e095689b3ca94ab6e27c352b1565">00420</a> <a class="code" href="../../de/ddf/group__class.html#gafb70e095689b3ca94ab6e27c352b1565" title="Defines a new class.">rb_define_class_id</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#afa5b9137f051ac26d7ccc8824f178233">ID</a> <span class="keywordtype">id</span>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> super)
<a name="l00421"></a>00421 {
<a name="l00422"></a>00422     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <a class="code" href="../../d7/d63/structclone__method__data.html#a26a88a08390ac4ea5b8a727e0595e960">klass</a>;
<a name="l00423"></a>00423 
<a name="l00424"></a>00424     <span class="keywordflow">if</span> (!super) super = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a57c96ead3ef230b4838e65fe037c346e">rb_cObject</a>;
<a name="l00425"></a>00425     klass = <a class="code" href="../../de/ddf/group__class.html#ga164285b5b5225740d582d4c3773f9179" title="Creates a new class.">rb_class_new</a>(super);
<a name="l00426"></a>00426     <a class="code" href="../../de/ddf/group__class.html#gaef068643bdd141d298acf0a0041d871a">rb_make_metaclass</a>(klass, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a1d4c05021aacd8cab989ff60f95ebe2d">RBASIC</a>(super)-&gt;klass);
<a name="l00427"></a>00427 
<a name="l00428"></a>00428     <span class="keywordflow">return</span> klass;
<a name="l00429"></a>00429 }
<a name="l00430"></a>00430 
<a name="l00431"></a>00431 
<a name="l00440"></a>00440 <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l00441"></a><a class="code" href="../../de/ddf/group__class.html#gab503b359ce09591ed8d2521d802f22d0">00441</a> <a class="code" href="../../de/ddf/group__class.html#gab503b359ce09591ed8d2521d802f22d0" title="Calls Class::inherited.">rb_class_inherited</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> super, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <a class="code" href="../../d7/d63/structclone__method__data.html#a26a88a08390ac4ea5b8a727e0595e960">klass</a>)
<a name="l00442"></a>00442 {
<a name="l00443"></a>00443     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#afa5b9137f051ac26d7ccc8824f178233">ID</a> inherited;
<a name="l00444"></a>00444     <span class="keywordflow">if</span> (!super) super = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a57c96ead3ef230b4838e65fe037c346e">rb_cObject</a>;
<a name="l00445"></a>00445     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aa50b9d5bc665eb5545f6857c89232161">CONST_ID</a>(inherited, <span class="stringliteral">&quot;inherited&quot;</span>);
<a name="l00446"></a>00446     <span class="keywordflow">return</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a6a973fe624aa9aa9ba0cdeb6792d3187" title="Calls a method.">rb_funcall</a>(super, inherited, 1, klass);
<a name="l00447"></a>00447 }
<a name="l00448"></a>00448 
<a name="l00449"></a>00449 
<a name="l00450"></a>00450 
<a name="l00466"></a>00466 <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l00467"></a><a class="code" href="../../de/ddf/group__class.html#ga15d068dbe88a3bab3700b03bebb7fbac">00467</a> <a class="code" href="../../de/ddf/group__class.html#ga15d068dbe88a3bab3700b03bebb7fbac" title="Defines a top-level class.">rb_define_class</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d6/da0/nkf-utf8_2nkf_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> super)
<a name="l00468"></a>00468 {
<a name="l00469"></a>00469     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <a class="code" href="../../d7/d63/structclone__method__data.html#a26a88a08390ac4ea5b8a727e0595e960">klass</a>;
<a name="l00470"></a>00470     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#afa5b9137f051ac26d7ccc8824f178233">ID</a> <a class="code" href="../../d6/da0/nkf-utf8_2nkf_8c.html#a64ae40793ade89d800a8c5646d2980fc">id</a>;
<a name="l00471"></a>00471 
<a name="l00472"></a>00472     <span class="keywordtype">id</span> = <a class="code" href="../../dc/dcc/array_8c.html#a9cfa42d4b79c89d68c53be8b2150a503">rb_intern</a>(name);
<a name="l00473"></a>00473     <span class="keywordflow">if</span> (<a class="code" href="../../db/d2e/intern_8h.html#afaaee0b4c292ab56ca8acee9fad1242b">rb_const_defined</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a57c96ead3ef230b4838e65fe037c346e">rb_cObject</a>, <span class="keywordtype">id</span>)) {
<a name="l00474"></a>00474         klass = <a class="code" href="../../db/d2e/intern_8h.html#a17a81c1a7d754e5ab49fc4b4369b6c8c">rb_const_get</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a57c96ead3ef230b4838e65fe037c346e">rb_cObject</a>, <span class="keywordtype">id</span>);
<a name="l00475"></a>00475         <span class="keywordflow">if</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a394faf7191f18552a20cb17ce14226f0">TYPE</a>(klass) != <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ad04c63d175774c6d6e7dfaf0f0a982c9">T_CLASS</a>) {
<a name="l00476"></a>00476             <a class="code" href="../../db/dcc/error_8c.html#a0f771a2840561f1838169b3d7d4616f3">rb_raise</a>(<a class="code" href="../../db/dcc/error_8c.html#a565ed9d70f4089e1b4a36e9b3381b8c6">rb_eTypeError</a>, <span class="stringliteral">&quot;%s is not a class&quot;</span>, name);
<a name="l00477"></a>00477         }
<a name="l00478"></a>00478         <span class="keywordflow">if</span> (<a class="code" href="../../db/d2e/intern_8h.html#ab4b2dc0dd79654335ec8fc99ed9880d6">rb_class_real</a>(<a class="code" href="../../d3/d09/ripper_8y.html#a19d17315b6b34045cdffec9912342b91">RCLASS_SUPER</a>(klass)) != super) {
<a name="l00479"></a>00479             <a class="code" href="../../db/dcc/error_8c.html#a0f771a2840561f1838169b3d7d4616f3">rb_raise</a>(<a class="code" href="../../db/dcc/error_8c.html#a565ed9d70f4089e1b4a36e9b3381b8c6">rb_eTypeError</a>, <span class="stringliteral">&quot;superclass mismatch for class %s&quot;</span>, name);
<a name="l00480"></a>00480         }
<a name="l00481"></a>00481         <span class="keywordflow">return</span> klass;
<a name="l00482"></a>00482     }
<a name="l00483"></a>00483     <span class="keywordflow">if</span> (!super) {
<a name="l00484"></a>00484         <a class="code" href="../../db/dcc/error_8c.html#aa5b1972d475e9a090c8ef607ce033008">rb_warn</a>(<span class="stringliteral">&quot;no super class for `%s&apos;, Object assumed&quot;</span>, name);
<a name="l00485"></a>00485     }
<a name="l00486"></a>00486     klass = <a class="code" href="../../de/ddf/group__class.html#gafb70e095689b3ca94ab6e27c352b1565" title="Defines a new class.">rb_define_class_id</a>(<span class="keywordtype">id</span>, super);
<a name="l00487"></a>00487     <a class="code" href="../../dd/d24/st_8h.html#aee4e16ae99cd543ddf851107d5ea5408">st_add_direct</a>(rb_class_tbl, <span class="keywordtype">id</span>, klass);
<a name="l00488"></a>00488     <a class="code" href="../../db/d2e/intern_8h.html#a53e6d39dcb7118f8360db8cd2ae61c2e">rb_name_class</a>(klass, <span class="keywordtype">id</span>);
<a name="l00489"></a>00489     <a class="code" href="../../db/d2e/intern_8h.html#aaa03be2caf9a365acc44c307dfda6430">rb_const_set</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a57c96ead3ef230b4838e65fe037c346e">rb_cObject</a>, <span class="keywordtype">id</span>, klass);
<a name="l00490"></a>00490     <a class="code" href="../../de/ddf/group__class.html#gab503b359ce09591ed8d2521d802f22d0" title="Calls Class::inherited.">rb_class_inherited</a>(super, klass);
<a name="l00491"></a>00491 
<a name="l00492"></a>00492     <span class="keywordflow">return</span> klass;
<a name="l00493"></a>00493 }
<a name="l00494"></a>00494 
<a name="l00495"></a>00495 
<a name="l00512"></a>00512 <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l00513"></a><a class="code" href="../../de/ddf/group__class.html#ga5266deadce0318d830a1e63c0933b898">00513</a> <a class="code" href="../../de/ddf/group__class.html#ga5266deadce0318d830a1e63c0933b898" title="Defines a class under the namespace of outer.">rb_define_class_under</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> outer, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d6/da0/nkf-utf8_2nkf_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> super)
<a name="l00514"></a>00514 {
<a name="l00515"></a>00515     <span class="keywordflow">return</span> <a class="code" href="../../de/ddf/group__class.html#gaac55151955a876724825ca492367fd43" title="Defines a class under the namespace of outer.">rb_define_class_id_under</a>(outer, <a class="code" href="../../dc/dcc/array_8c.html#a9cfa42d4b79c89d68c53be8b2150a503">rb_intern</a>(name), super);
<a name="l00516"></a>00516 }
<a name="l00517"></a>00517 
<a name="l00518"></a>00518 
<a name="l00535"></a>00535 <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l00536"></a><a class="code" href="../../de/ddf/group__class.html#gaac55151955a876724825ca492367fd43">00536</a> <a class="code" href="../../de/ddf/group__class.html#gaac55151955a876724825ca492367fd43" title="Defines a class under the namespace of outer.">rb_define_class_id_under</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> outer, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#afa5b9137f051ac26d7ccc8824f178233">ID</a> <span class="keywordtype">id</span>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> super)
<a name="l00537"></a>00537 {
<a name="l00538"></a>00538     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <a class="code" href="../../d7/d63/structclone__method__data.html#a26a88a08390ac4ea5b8a727e0595e960">klass</a>;
<a name="l00539"></a>00539 
<a name="l00540"></a>00540     <span class="keywordflow">if</span> (<a class="code" href="../../db/d2e/intern_8h.html#a6aa5b85eacf47a565659b4e32594f388">rb_const_defined_at</a>(outer, <span class="keywordtype">id</span>)) {
<a name="l00541"></a>00541         klass = <a class="code" href="../../db/d2e/intern_8h.html#a8265931c0ae8ab5c2e40702295049439">rb_const_get_at</a>(outer, <span class="keywordtype">id</span>);
<a name="l00542"></a>00542         <span class="keywordflow">if</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a394faf7191f18552a20cb17ce14226f0">TYPE</a>(klass) != <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ad04c63d175774c6d6e7dfaf0f0a982c9">T_CLASS</a>) {
<a name="l00543"></a>00543             <a class="code" href="../../db/dcc/error_8c.html#a0f771a2840561f1838169b3d7d4616f3">rb_raise</a>(<a class="code" href="../../db/dcc/error_8c.html#a565ed9d70f4089e1b4a36e9b3381b8c6">rb_eTypeError</a>, <span class="stringliteral">&quot;%s is not a class&quot;</span>, <a class="code" href="../../d5/d11/ripper_8c.html#a877bc58c495643fcf49dc64c44631e72">rb_id2name</a>(<span class="keywordtype">id</span>));
<a name="l00544"></a>00544         }
<a name="l00545"></a>00545         <span class="keywordflow">if</span> (<a class="code" href="../../db/d2e/intern_8h.html#ab4b2dc0dd79654335ec8fc99ed9880d6">rb_class_real</a>(<a class="code" href="../../d3/d09/ripper_8y.html#a19d17315b6b34045cdffec9912342b91">RCLASS_SUPER</a>(klass)) != super) {
<a name="l00546"></a>00546             <a class="code" href="../../db/dcc/error_8c.html#a362a64d927d726ab487a66d265187cab">rb_name_error</a>(<span class="keywordtype">id</span>, <span class="stringliteral">&quot;%s is already defined&quot;</span>, <a class="code" href="../../d5/d11/ripper_8c.html#a877bc58c495643fcf49dc64c44631e72">rb_id2name</a>(<span class="keywordtype">id</span>));
<a name="l00547"></a>00547         }
<a name="l00548"></a>00548         <span class="keywordflow">return</span> klass;
<a name="l00549"></a>00549     }
<a name="l00550"></a>00550     <span class="keywordflow">if</span> (!super) {
<a name="l00551"></a>00551         <a class="code" href="../../db/dcc/error_8c.html#aa5b1972d475e9a090c8ef607ce033008">rb_warn</a>(<span class="stringliteral">&quot;no super class for `%s::%s&apos;, Object assumed&quot;</span>,
<a name="l00552"></a>00552                 <a class="code" href="../../de/de6/ruby_2ruby_8h.html#afd98e957d0d96017f7a07dd83772fadc">rb_class2name</a>(outer), <a class="code" href="../../d5/d11/ripper_8c.html#a877bc58c495643fcf49dc64c44631e72">rb_id2name</a>(<span class="keywordtype">id</span>));
<a name="l00553"></a>00553     }
<a name="l00554"></a>00554     klass = <a class="code" href="../../de/ddf/group__class.html#gafb70e095689b3ca94ab6e27c352b1565" title="Defines a new class.">rb_define_class_id</a>(<span class="keywordtype">id</span>, super);
<a name="l00555"></a>00555     <a class="code" href="../../db/d2e/intern_8h.html#a166aaf3f44de09139ba3a355cd1586c0">rb_set_class_path_string</a>(klass, outer, <a class="code" href="../../d5/d11/ripper_8c.html#aec42ef320e57234e789bdda6d655716f">rb_id2str</a>(<span class="keywordtype">id</span>));
<a name="l00556"></a>00556     <a class="code" href="../../db/d2e/intern_8h.html#aaa03be2caf9a365acc44c307dfda6430">rb_const_set</a>(outer, <span class="keywordtype">id</span>, klass);
<a name="l00557"></a>00557     <a class="code" href="../../de/ddf/group__class.html#gab503b359ce09591ed8d2521d802f22d0" title="Calls Class::inherited.">rb_class_inherited</a>(super, klass);
<a name="l00558"></a>00558     <a class="code" href="../../d8/d16/gc_8c.html#adc7efe8997f04b5c275d7e7aed9169e3">rb_gc_register_mark_object</a>(klass);
<a name="l00559"></a>00559 
<a name="l00560"></a>00560     <span class="keywordflow">return</span> klass;
<a name="l00561"></a>00561 }
<a name="l00562"></a>00562 
<a name="l00563"></a>00563 <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l00564"></a><a class="code" href="../../de/ddf/group__class.html#ga6502d3277ed36b7fd0ce6afab5f14d51">00564</a> <a class="code" href="../../de/ddf/group__class.html#ga6502d3277ed36b7fd0ce6afab5f14d51">rb_module_new</a>(<span class="keywordtype">void</span>)
<a name="l00565"></a>00565 {
<a name="l00566"></a>00566     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> mdl = <a class="code" href="../../de/ddf/group__class.html#gab3375e6e7d925cb966d8c1f808c44595" title="Allocates a struct RClass for a new class.">class_alloc</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a6cdc7dfe8f84777325da08a96ae5f795">T_MODULE</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ad35b93cf98ae9c41f3394fd51383f774">rb_cModule</a>);
<a name="l00567"></a>00567 
<a name="l00568"></a>00568     <a class="code" href="../../d3/d09/ripper_8y.html#ab59ea80cdf15f3f19bbae0346314c9ad">RCLASS_M_TBL</a>(mdl) = <a class="code" href="../../dd/d24/st_8h.html#a955c6e936b9681649ab9ffa4aa741949">st_init_numtable</a>();
<a name="l00569"></a>00569 
<a name="l00570"></a>00570     <span class="keywordflow">return</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>)mdl;
<a name="l00571"></a>00571 }
<a name="l00572"></a>00572 
<a name="l00573"></a>00573 <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l00574"></a><a class="code" href="../../de/ddf/group__class.html#gaf730070ab29bc9821f974631abe79a60">00574</a> <a class="code" href="../../de/ddf/group__class.html#gaf730070ab29bc9821f974631abe79a60">rb_define_module_id</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#afa5b9137f051ac26d7ccc8824f178233">ID</a> <span class="keywordtype">id</span>)
<a name="l00575"></a>00575 {
<a name="l00576"></a>00576     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> mdl;
<a name="l00577"></a>00577 
<a name="l00578"></a>00578     mdl = <a class="code" href="../../de/ddf/group__class.html#ga6502d3277ed36b7fd0ce6afab5f14d51">rb_module_new</a>();
<a name="l00579"></a>00579     <a class="code" href="../../db/d2e/intern_8h.html#a53e6d39dcb7118f8360db8cd2ae61c2e">rb_name_class</a>(mdl, <span class="keywordtype">id</span>);
<a name="l00580"></a>00580 
<a name="l00581"></a>00581     <span class="keywordflow">return</span> mdl;
<a name="l00582"></a>00582 }
<a name="l00583"></a>00583 
<a name="l00584"></a>00584 <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l00585"></a><a class="code" href="../../de/ddf/group__class.html#ga911071d40f9312e49a774ea0e1b12869">00585</a> <a class="code" href="../../de/ddf/group__class.html#ga911071d40f9312e49a774ea0e1b12869">rb_define_module</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d6/da0/nkf-utf8_2nkf_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>)
<a name="l00586"></a>00586 {
<a name="l00587"></a>00587     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> module;
<a name="l00588"></a>00588     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#afa5b9137f051ac26d7ccc8824f178233">ID</a> <a class="code" href="../../d6/da0/nkf-utf8_2nkf_8c.html#a64ae40793ade89d800a8c5646d2980fc">id</a>;
<a name="l00589"></a>00589 
<a name="l00590"></a>00590     <span class="keywordtype">id</span> = <a class="code" href="../../dc/dcc/array_8c.html#a9cfa42d4b79c89d68c53be8b2150a503">rb_intern</a>(name);
<a name="l00591"></a>00591     <span class="keywordflow">if</span> (<a class="code" href="../../db/d2e/intern_8h.html#afaaee0b4c292ab56ca8acee9fad1242b">rb_const_defined</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a57c96ead3ef230b4838e65fe037c346e">rb_cObject</a>, <span class="keywordtype">id</span>)) {
<a name="l00592"></a>00592         module = <a class="code" href="../../db/d2e/intern_8h.html#a17a81c1a7d754e5ab49fc4b4369b6c8c">rb_const_get</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a57c96ead3ef230b4838e65fe037c346e">rb_cObject</a>, <span class="keywordtype">id</span>);
<a name="l00593"></a>00593         <span class="keywordflow">if</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a394faf7191f18552a20cb17ce14226f0">TYPE</a>(module) == <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a6cdc7dfe8f84777325da08a96ae5f795">T_MODULE</a>)
<a name="l00594"></a>00594             <span class="keywordflow">return</span> module;
<a name="l00595"></a>00595         <a class="code" href="../../db/dcc/error_8c.html#a0f771a2840561f1838169b3d7d4616f3">rb_raise</a>(<a class="code" href="../../db/dcc/error_8c.html#a565ed9d70f4089e1b4a36e9b3381b8c6">rb_eTypeError</a>, <span class="stringliteral">&quot;%s is not a module&quot;</span>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a9b4f42ada717bfbe7a78830639476aed">rb_obj_classname</a>(module));
<a name="l00596"></a>00596     }
<a name="l00597"></a>00597     module = <a class="code" href="../../de/ddf/group__class.html#gaf730070ab29bc9821f974631abe79a60">rb_define_module_id</a>(<span class="keywordtype">id</span>);
<a name="l00598"></a>00598     <a class="code" href="../../dd/d24/st_8h.html#aee4e16ae99cd543ddf851107d5ea5408">st_add_direct</a>(rb_class_tbl, <span class="keywordtype">id</span>, module);
<a name="l00599"></a>00599     <a class="code" href="../../db/d2e/intern_8h.html#aaa03be2caf9a365acc44c307dfda6430">rb_const_set</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a57c96ead3ef230b4838e65fe037c346e">rb_cObject</a>, <span class="keywordtype">id</span>, module);
<a name="l00600"></a>00600 
<a name="l00601"></a>00601     <span class="keywordflow">return</span> module;
<a name="l00602"></a>00602 }
<a name="l00603"></a>00603 
<a name="l00604"></a>00604 <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l00605"></a><a class="code" href="../../de/ddf/group__class.html#gad0eeed44f413060a2417852168747388">00605</a> <a class="code" href="../../de/ddf/group__class.html#gad0eeed44f413060a2417852168747388">rb_define_module_under</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> outer, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d6/da0/nkf-utf8_2nkf_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>)
<a name="l00606"></a>00606 {
<a name="l00607"></a>00607     <span class="keywordflow">return</span> <a class="code" href="../../de/ddf/group__class.html#ga9f36add0ed2122d900c0eef4a5a1fb22">rb_define_module_id_under</a>(outer, <a class="code" href="../../dc/dcc/array_8c.html#a9cfa42d4b79c89d68c53be8b2150a503">rb_intern</a>(name));
<a name="l00608"></a>00608 }
<a name="l00609"></a>00609 
<a name="l00610"></a>00610 <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l00611"></a><a class="code" href="../../de/ddf/group__class.html#ga9f36add0ed2122d900c0eef4a5a1fb22">00611</a> <a class="code" href="../../de/ddf/group__class.html#ga9f36add0ed2122d900c0eef4a5a1fb22">rb_define_module_id_under</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> outer, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#afa5b9137f051ac26d7ccc8824f178233">ID</a> <span class="keywordtype">id</span>)
<a name="l00612"></a>00612 {
<a name="l00613"></a>00613     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> module;
<a name="l00614"></a>00614 
<a name="l00615"></a>00615     <span class="keywordflow">if</span> (<a class="code" href="../../db/d2e/intern_8h.html#a6aa5b85eacf47a565659b4e32594f388">rb_const_defined_at</a>(outer, <span class="keywordtype">id</span>)) {
<a name="l00616"></a>00616         module = <a class="code" href="../../db/d2e/intern_8h.html#a8265931c0ae8ab5c2e40702295049439">rb_const_get_at</a>(outer, <span class="keywordtype">id</span>);
<a name="l00617"></a>00617         <span class="keywordflow">if</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a394faf7191f18552a20cb17ce14226f0">TYPE</a>(module) == <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a6cdc7dfe8f84777325da08a96ae5f795">T_MODULE</a>)
<a name="l00618"></a>00618             <span class="keywordflow">return</span> module;
<a name="l00619"></a>00619         <a class="code" href="../../db/dcc/error_8c.html#a0f771a2840561f1838169b3d7d4616f3">rb_raise</a>(<a class="code" href="../../db/dcc/error_8c.html#a565ed9d70f4089e1b4a36e9b3381b8c6">rb_eTypeError</a>, <span class="stringliteral">&quot;%s::%s is not a module&quot;</span>,
<a name="l00620"></a>00620                  <a class="code" href="../../de/de6/ruby_2ruby_8h.html#afd98e957d0d96017f7a07dd83772fadc">rb_class2name</a>(outer), <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a9b4f42ada717bfbe7a78830639476aed">rb_obj_classname</a>(module));
<a name="l00621"></a>00621     }
<a name="l00622"></a>00622     module = <a class="code" href="../../de/ddf/group__class.html#gaf730070ab29bc9821f974631abe79a60">rb_define_module_id</a>(<span class="keywordtype">id</span>);
<a name="l00623"></a>00623     <a class="code" href="../../db/d2e/intern_8h.html#aaa03be2caf9a365acc44c307dfda6430">rb_const_set</a>(outer, <span class="keywordtype">id</span>, module);
<a name="l00624"></a>00624     <a class="code" href="../../db/d2e/intern_8h.html#a166aaf3f44de09139ba3a355cd1586c0">rb_set_class_path_string</a>(module, outer, <a class="code" href="../../d5/d11/ripper_8c.html#aec42ef320e57234e789bdda6d655716f">rb_id2str</a>(<span class="keywordtype">id</span>));
<a name="l00625"></a>00625     <a class="code" href="../../d8/d16/gc_8c.html#adc7efe8997f04b5c275d7e7aed9169e3">rb_gc_register_mark_object</a>(module);
<a name="l00626"></a>00626 
<a name="l00627"></a>00627     <span class="keywordflow">return</span> module;
<a name="l00628"></a>00628 }
<a name="l00629"></a>00629 
<a name="l00630"></a>00630 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l00631"></a><a class="code" href="../../de/ddf/group__class.html#ga10e575446d1343255b36541eb5dd9845">00631</a> <a class="code" href="../../de/ddf/group__class.html#ga10e575446d1343255b36541eb5dd9845">include_class_new</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> module, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> super)
<a name="l00632"></a>00632 {
<a name="l00633"></a>00633     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <a class="code" href="../../d7/d63/structclone__method__data.html#a26a88a08390ac4ea5b8a727e0595e960">klass</a> = <a class="code" href="../../de/ddf/group__class.html#gab3375e6e7d925cb966d8c1f808c44595" title="Allocates a struct RClass for a new class.">class_alloc</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a82c8c4569748b9645c958b9eaeaabb81">T_ICLASS</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a39a2be92a95d7219204ab58d8f40533d">rb_cClass</a>);
<a name="l00634"></a>00634 
<a name="l00635"></a>00635     <span class="keywordflow">if</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#aee74f540353cd2d77d1cb37a3714bd7d">BUILTIN_TYPE</a>(module) == <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a82c8c4569748b9645c958b9eaeaabb81">T_ICLASS</a>) {
<a name="l00636"></a>00636         module = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a1d4c05021aacd8cab989ff60f95ebe2d">RBASIC</a>(module)-&gt;klass;
<a name="l00637"></a>00637     }
<a name="l00638"></a>00638     <span class="keywordflow">if</span> (!<a class="code" href="../../d3/d09/ripper_8y.html#a7f7f2dbf958976d9bf317167396992d4">RCLASS_IV_TBL</a>(module)) {
<a name="l00639"></a>00639         <a class="code" href="../../d3/d09/ripper_8y.html#a7f7f2dbf958976d9bf317167396992d4">RCLASS_IV_TBL</a>(module) = <a class="code" href="../../dd/d24/st_8h.html#a955c6e936b9681649ab9ffa4aa741949">st_init_numtable</a>();
<a name="l00640"></a>00640     }
<a name="l00641"></a>00641     <span class="keywordflow">if</span> (!<a class="code" href="../../d3/d09/ripper_8y.html#a9dfcc3730f2a2a5ef643c2b6c3e606d1">RCLASS_CONST_TBL</a>(module)) {
<a name="l00642"></a>00642         <a class="code" href="../../d3/d09/ripper_8y.html#a9dfcc3730f2a2a5ef643c2b6c3e606d1">RCLASS_CONST_TBL</a>(module) = <a class="code" href="../../dd/d24/st_8h.html#a955c6e936b9681649ab9ffa4aa741949">st_init_numtable</a>();
<a name="l00643"></a>00643     }
<a name="l00644"></a>00644     <a class="code" href="../../d3/d09/ripper_8y.html#a7f7f2dbf958976d9bf317167396992d4">RCLASS_IV_TBL</a>(klass) = <a class="code" href="../../d3/d09/ripper_8y.html#a7f7f2dbf958976d9bf317167396992d4">RCLASS_IV_TBL</a>(module);
<a name="l00645"></a>00645     <a class="code" href="../../d3/d09/ripper_8y.html#a9dfcc3730f2a2a5ef643c2b6c3e606d1">RCLASS_CONST_TBL</a>(klass) = <a class="code" href="../../d3/d09/ripper_8y.html#a9dfcc3730f2a2a5ef643c2b6c3e606d1">RCLASS_CONST_TBL</a>(module);
<a name="l00646"></a>00646     <a class="code" href="../../d3/d09/ripper_8y.html#ab59ea80cdf15f3f19bbae0346314c9ad">RCLASS_M_TBL</a>(klass) = <a class="code" href="../../d3/d09/ripper_8y.html#ab59ea80cdf15f3f19bbae0346314c9ad">RCLASS_M_TBL</a>(module);
<a name="l00647"></a>00647     <a class="code" href="../../d3/d09/ripper_8y.html#a19d17315b6b34045cdffec9912342b91">RCLASS_SUPER</a>(klass) = super;
<a name="l00648"></a>00648     <span class="keywordflow">if</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a394faf7191f18552a20cb17ce14226f0">TYPE</a>(module) == <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a82c8c4569748b9645c958b9eaeaabb81">T_ICLASS</a>) {
<a name="l00649"></a>00649         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a1d4c05021aacd8cab989ff60f95ebe2d">RBASIC</a>(klass)-&gt;klass = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a1d4c05021aacd8cab989ff60f95ebe2d">RBASIC</a>(module)-&gt;klass;
<a name="l00650"></a>00650     }
<a name="l00651"></a>00651     <span class="keywordflow">else</span> {
<a name="l00652"></a>00652         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a1d4c05021aacd8cab989ff60f95ebe2d">RBASIC</a>(klass)-&gt;klass = module;
<a name="l00653"></a>00653     }
<a name="l00654"></a>00654     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3bf9ab455a1e0e3e8cfc6ebabd8f12df">OBJ_INFECT</a>(klass, module);
<a name="l00655"></a>00655     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3bf9ab455a1e0e3e8cfc6ebabd8f12df">OBJ_INFECT</a>(klass, super);
<a name="l00656"></a>00656 
<a name="l00657"></a>00657     <span class="keywordflow">return</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>)klass;
<a name="l00658"></a>00658 }
<a name="l00659"></a>00659 
<a name="l00660"></a>00660 <span class="keywordtype">void</span>
<a name="l00661"></a><a class="code" href="../../de/ddf/group__class.html#ga1301940bb86315055d67464ed2cee477">00661</a> <a class="code" href="../../de/ddf/group__class.html#ga1301940bb86315055d67464ed2cee477">rb_include_module</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <a class="code" href="../../d7/d63/structclone__method__data.html#a26a88a08390ac4ea5b8a727e0595e960">klass</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> module)
<a name="l00662"></a>00662 {
<a name="l00663"></a>00663     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> p, c;
<a name="l00664"></a>00664     <span class="keywordtype">int</span> changed = 0;
<a name="l00665"></a>00665 
<a name="l00666"></a>00666     <a class="code" href="../../d3/d57/eval_8c.html#ab67dfbc570c0707224ff634290846a54">rb_frozen_class_p</a>(klass);
<a name="l00667"></a>00667     <span class="keywordflow">if</span> (!<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a981ef70b505df85f89fba2b5c2d8b462">OBJ_UNTRUSTED</a>(klass)) {
<a name="l00668"></a>00668         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a98b91af598acb64fe8497413ce498766">rb_secure</a>(4);
<a name="l00669"></a>00669     }
<a name="l00670"></a>00670 
<a name="l00671"></a>00671     <span class="keywordflow">if</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a394faf7191f18552a20cb17ce14226f0">TYPE</a>(module) != <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a6cdc7dfe8f84777325da08a96ae5f795">T_MODULE</a>) {
<a name="l00672"></a>00672         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ad5a1e03b0a66824f95f6aaf07b4a4052">Check_Type</a>(module, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a6cdc7dfe8f84777325da08a96ae5f795">T_MODULE</a>);
<a name="l00673"></a>00673     }
<a name="l00674"></a>00674 
<a name="l00675"></a>00675     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3bf9ab455a1e0e3e8cfc6ebabd8f12df">OBJ_INFECT</a>(klass, module);
<a name="l00676"></a>00676     c = klass;
<a name="l00677"></a>00677     <span class="keywordflow">while</span> (module) {
<a name="l00678"></a>00678         <span class="keywordtype">int</span> superclass_seen = <a class="code" href="../../d1/d5c/nkf_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00679"></a>00679 
<a name="l00680"></a>00680         <span class="keywordflow">if</span> (<a class="code" href="../../d3/d09/ripper_8y.html#ab59ea80cdf15f3f19bbae0346314c9ad">RCLASS_M_TBL</a>(klass) == <a class="code" href="../../d3/d09/ripper_8y.html#ab59ea80cdf15f3f19bbae0346314c9ad">RCLASS_M_TBL</a>(module))
<a name="l00681"></a>00681             <a class="code" href="../../db/dcc/error_8c.html#a0f771a2840561f1838169b3d7d4616f3">rb_raise</a>(<a class="code" href="../../db/dcc/error_8c.html#ab5e2a9fec766c75176fbb262bfe6a596">rb_eArgError</a>, <span class="stringliteral">&quot;cyclic include detected&quot;</span>);
<a name="l00682"></a>00682         <span class="comment">/* ignore if the module included already in superclasses */</span>
<a name="l00683"></a>00683         <span class="keywordflow">for</span> (p = <a class="code" href="../../d3/d09/ripper_8y.html#a19d17315b6b34045cdffec9912342b91">RCLASS_SUPER</a>(klass); p; p = <a class="code" href="../../d3/d09/ripper_8y.html#a19d17315b6b34045cdffec9912342b91">RCLASS_SUPER</a>(p)) {
<a name="l00684"></a>00684             <span class="keywordflow">switch</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#aee74f540353cd2d77d1cb37a3714bd7d">BUILTIN_TYPE</a>(p)) {
<a name="l00685"></a>00685               <span class="keywordflow">case</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a82c8c4569748b9645c958b9eaeaabb81">T_ICLASS</a>:
<a name="l00686"></a>00686                 <span class="keywordflow">if</span> (<a class="code" href="../../d3/d09/ripper_8y.html#ab59ea80cdf15f3f19bbae0346314c9ad">RCLASS_M_TBL</a>(p) == <a class="code" href="../../d3/d09/ripper_8y.html#ab59ea80cdf15f3f19bbae0346314c9ad">RCLASS_M_TBL</a>(module)) {
<a name="l00687"></a>00687                     <span class="keywordflow">if</span> (!superclass_seen) {
<a name="l00688"></a>00688                         c = p;  <span class="comment">/* move insertion point */</span>
<a name="l00689"></a>00689                     }
<a name="l00690"></a>00690                     <span class="keywordflow">goto</span> skip;
<a name="l00691"></a>00691                 }
<a name="l00692"></a>00692                 <span class="keywordflow">break</span>;
<a name="l00693"></a>00693               <span class="keywordflow">case</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ad04c63d175774c6d6e7dfaf0f0a982c9">T_CLASS</a>:
<a name="l00694"></a>00694                 superclass_seen = <a class="code" href="../../d1/d5c/nkf_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00695"></a>00695                 <span class="keywordflow">break</span>;
<a name="l00696"></a>00696             }
<a name="l00697"></a>00697         }
<a name="l00698"></a>00698         c = <a class="code" href="../../d3/d09/ripper_8y.html#a19d17315b6b34045cdffec9912342b91">RCLASS_SUPER</a>(c) = <a class="code" href="../../de/ddf/group__class.html#ga10e575446d1343255b36541eb5dd9845">include_class_new</a>(module, <a class="code" href="../../d3/d09/ripper_8y.html#a19d17315b6b34045cdffec9912342b91">RCLASS_SUPER</a>(c));
<a name="l00699"></a>00699         <span class="keywordflow">if</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#af00dc4df207b6aff12df365f9606b74c">RMODULE_M_TBL</a>(module) &amp;&amp; <a class="code" href="../../de/de6/ruby_2ruby_8h.html#af00dc4df207b6aff12df365f9606b74c">RMODULE_M_TBL</a>(module)-&gt;num_entries)
<a name="l00700"></a>00700             changed = 1;
<a name="l00701"></a>00701       skip:
<a name="l00702"></a>00702         module = <a class="code" href="../../d3/d09/ripper_8y.html#a19d17315b6b34045cdffec9912342b91">RCLASS_SUPER</a>(module);
<a name="l00703"></a>00703     }
<a name="l00704"></a>00704     <span class="keywordflow">if</span> (changed) <a class="code" href="../../db/d2e/intern_8h.html#aae488bf866fa621a10855d39b3f5efb1">rb_clear_cache</a>();
<a name="l00705"></a>00705 }
<a name="l00706"></a>00706 
<a name="l00707"></a>00707 <span class="comment">/*</span>
<a name="l00708"></a>00708 <span class="comment"> *  call-seq:</span>
<a name="l00709"></a>00709 <span class="comment"> *     mod.included_modules -&gt; array</span>
<a name="l00710"></a>00710 <span class="comment"> *</span>
<a name="l00711"></a>00711 <span class="comment"> *  Returns the list of modules included in &lt;i&gt;mod&lt;/i&gt;.</span>
<a name="l00712"></a>00712 <span class="comment"> *</span>
<a name="l00713"></a>00713 <span class="comment"> *     module Mixin</span>
<a name="l00714"></a>00714 <span class="comment"> *     end</span>
<a name="l00715"></a>00715 <span class="comment"> *</span>
<a name="l00716"></a>00716 <span class="comment"> *     module Outer</span>
<a name="l00717"></a>00717 <span class="comment"> *       include Mixin</span>
<a name="l00718"></a>00718 <span class="comment"> *     end</span>
<a name="l00719"></a>00719 <span class="comment"> *</span>
<a name="l00720"></a>00720 <span class="comment"> *     Mixin.included_modules   #=&gt; []</span>
<a name="l00721"></a>00721 <span class="comment"> *     Outer.included_modules   #=&gt; [Mixin]</span>
<a name="l00722"></a>00722 <span class="comment"> */</span>
<a name="l00723"></a>00723 
<a name="l00724"></a>00724 <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l00725"></a><a class="code" href="../../de/ddf/group__class.html#gaa731c1557119b0a89ece0c4946a354f3">00725</a> <a class="code" href="../../de/ddf/group__class.html#gaa731c1557119b0a89ece0c4946a354f3">rb_mod_included_modules</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <a class="code" href="../../d1/d6f/date__strftime_8c.html#aa84d960185b18347956518e4d00766b4">mod</a>)
<a name="l00726"></a>00726 {
<a name="l00727"></a>00727     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> ary = <a class="code" href="../../dc/dcc/array_8c.html#a9518114fd36cb4ef4656ec1dc63348c9">rb_ary_new</a>();
<a name="l00728"></a>00728     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> p;
<a name="l00729"></a>00729 
<a name="l00730"></a>00730     <span class="keywordflow">for</span> (p = <a class="code" href="../../d3/d09/ripper_8y.html#a19d17315b6b34045cdffec9912342b91">RCLASS_SUPER</a>(mod); p; p = <a class="code" href="../../d3/d09/ripper_8y.html#a19d17315b6b34045cdffec9912342b91">RCLASS_SUPER</a>(p)) {
<a name="l00731"></a>00731         <span class="keywordflow">if</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#aee74f540353cd2d77d1cb37a3714bd7d">BUILTIN_TYPE</a>(p) == <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a82c8c4569748b9645c958b9eaeaabb81">T_ICLASS</a>) {
<a name="l00732"></a>00732             <a class="code" href="../../dc/dcc/array_8c.html#a59d553a8cd781364b8bcb0deae25cca2">rb_ary_push</a>(ary, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a1d4c05021aacd8cab989ff60f95ebe2d">RBASIC</a>(p)-&gt;<a class="code" href="../../d7/d63/structclone__method__data.html#a26a88a08390ac4ea5b8a727e0595e960">klass</a>);
<a name="l00733"></a>00733         }
<a name="l00734"></a>00734     }
<a name="l00735"></a>00735     <span class="keywordflow">return</span> ary;
<a name="l00736"></a>00736 }
<a name="l00737"></a>00737 
<a name="l00738"></a>00738 <span class="comment">/*</span>
<a name="l00739"></a>00739 <span class="comment"> *  call-seq:</span>
<a name="l00740"></a>00740 <span class="comment"> *     mod.include?(module)    -&gt; true or false</span>
<a name="l00741"></a>00741 <span class="comment"> *</span>
<a name="l00742"></a>00742 <span class="comment"> *  Returns &lt;code&gt;true&lt;/code&gt; if &lt;i&gt;module&lt;/i&gt; is included in</span>
<a name="l00743"></a>00743 <span class="comment"> *  &lt;i&gt;mod&lt;/i&gt; or one of &lt;i&gt;mod&lt;/i&gt;&apos;s ancestors.</span>
<a name="l00744"></a>00744 <span class="comment"> *</span>
<a name="l00745"></a>00745 <span class="comment"> *     module A</span>
<a name="l00746"></a>00746 <span class="comment"> *     end</span>
<a name="l00747"></a>00747 <span class="comment"> *     class B</span>
<a name="l00748"></a>00748 <span class="comment"> *       include A</span>
<a name="l00749"></a>00749 <span class="comment"> *     end</span>
<a name="l00750"></a>00750 <span class="comment"> *     class C &lt; B</span>
<a name="l00751"></a>00751 <span class="comment"> *     end</span>
<a name="l00752"></a>00752 <span class="comment"> *     B.include?(A)   #=&gt; true</span>
<a name="l00753"></a>00753 <span class="comment"> *     C.include?(A)   #=&gt; true</span>
<a name="l00754"></a>00754 <span class="comment"> *     A.include?(A)   #=&gt; false</span>
<a name="l00755"></a>00755 <span class="comment"> */</span>
<a name="l00756"></a>00756 
<a name="l00757"></a>00757 <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l00758"></a><a class="code" href="../../de/ddf/group__class.html#gab9dc91e1520a0d6ce629731b63f689ce">00758</a> <a class="code" href="../../de/ddf/group__class.html#gab9dc91e1520a0d6ce629731b63f689ce">rb_mod_include_p</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <a class="code" href="../../d1/d6f/date__strftime_8c.html#aa84d960185b18347956518e4d00766b4">mod</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> mod2)
<a name="l00759"></a>00759 {
<a name="l00760"></a>00760     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> p;
<a name="l00761"></a>00761 
<a name="l00762"></a>00762     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ad5a1e03b0a66824f95f6aaf07b4a4052">Check_Type</a>(mod2, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a6cdc7dfe8f84777325da08a96ae5f795">T_MODULE</a>);
<a name="l00763"></a>00763     <span class="keywordflow">for</span> (p = <a class="code" href="../../d3/d09/ripper_8y.html#a19d17315b6b34045cdffec9912342b91">RCLASS_SUPER</a>(mod); p; p = <a class="code" href="../../d3/d09/ripper_8y.html#a19d17315b6b34045cdffec9912342b91">RCLASS_SUPER</a>(p)) {
<a name="l00764"></a>00764         <span class="keywordflow">if</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#aee74f540353cd2d77d1cb37a3714bd7d">BUILTIN_TYPE</a>(p) == <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a82c8c4569748b9645c958b9eaeaabb81">T_ICLASS</a>) {
<a name="l00765"></a>00765             <span class="keywordflow">if</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a1d4c05021aacd8cab989ff60f95ebe2d">RBASIC</a>(p)-&gt;klass == mod2) <span class="keywordflow">return</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aacea3516b33941ce8149098e223a7466">Qtrue</a>;
<a name="l00766"></a>00766         }
<a name="l00767"></a>00767     }
<a name="l00768"></a>00768     <span class="keywordflow">return</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aba0717d2689eb68797421a02ab9295c6">Qfalse</a>;
<a name="l00769"></a>00769 }
<a name="l00770"></a>00770 
<a name="l00771"></a>00771 <span class="comment">/*</span>
<a name="l00772"></a>00772 <span class="comment"> *  call-seq:</span>
<a name="l00773"></a>00773 <span class="comment"> *     mod.ancestors -&gt; array</span>
<a name="l00774"></a>00774 <span class="comment"> *</span>
<a name="l00775"></a>00775 <span class="comment"> *  Returns a list of modules included in &lt;i&gt;mod&lt;/i&gt; (including</span>
<a name="l00776"></a>00776 <span class="comment"> *  &lt;i&gt;mod&lt;/i&gt; itself).</span>
<a name="l00777"></a>00777 <span class="comment"> *</span>
<a name="l00778"></a>00778 <span class="comment"> *     module Mod</span>
<a name="l00779"></a>00779 <span class="comment"> *       include Math</span>
<a name="l00780"></a>00780 <span class="comment"> *       include Comparable</span>
<a name="l00781"></a>00781 <span class="comment"> *     end</span>
<a name="l00782"></a>00782 <span class="comment"> *</span>
<a name="l00783"></a>00783 <span class="comment"> *     Mod.ancestors    #=&gt; [Mod, Comparable, Math]</span>
<a name="l00784"></a>00784 <span class="comment"> *     Math.ancestors   #=&gt; [Math]</span>
<a name="l00785"></a>00785 <span class="comment"> */</span>
<a name="l00786"></a>00786 
<a name="l00787"></a>00787 <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l00788"></a><a class="code" href="../../de/ddf/group__class.html#gaae912ecff5a981a9052f2d001a22cc00">00788</a> <a class="code" href="../../de/ddf/group__class.html#gaae912ecff5a981a9052f2d001a22cc00">rb_mod_ancestors</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <a class="code" href="../../d1/d6f/date__strftime_8c.html#aa84d960185b18347956518e4d00766b4">mod</a>)
<a name="l00789"></a>00789 {
<a name="l00790"></a>00790     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> p, ary = <a class="code" href="../../dc/dcc/array_8c.html#a9518114fd36cb4ef4656ec1dc63348c9">rb_ary_new</a>();
<a name="l00791"></a>00791 
<a name="l00792"></a>00792     <span class="keywordflow">for</span> (p = mod; p; p = <a class="code" href="../../d3/d09/ripper_8y.html#a19d17315b6b34045cdffec9912342b91">RCLASS_SUPER</a>(p)) {
<a name="l00793"></a>00793         <span class="keywordflow">if</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a1ae918b6cc84188a9dc6ab545f732e4d">FL_TEST</a>(p, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a081b5172ef37829bb3a258cd1ad393bc">FL_SINGLETON</a>))
<a name="l00794"></a>00794             <span class="keywordflow">continue</span>;
<a name="l00795"></a>00795         <span class="keywordflow">if</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#aee74f540353cd2d77d1cb37a3714bd7d">BUILTIN_TYPE</a>(p) == <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a82c8c4569748b9645c958b9eaeaabb81">T_ICLASS</a>) {
<a name="l00796"></a>00796             <a class="code" href="../../dc/dcc/array_8c.html#a59d553a8cd781364b8bcb0deae25cca2">rb_ary_push</a>(ary, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a1d4c05021aacd8cab989ff60f95ebe2d">RBASIC</a>(p)-&gt;<a class="code" href="../../d7/d63/structclone__method__data.html#a26a88a08390ac4ea5b8a727e0595e960">klass</a>);
<a name="l00797"></a>00797         }
<a name="l00798"></a>00798         <span class="keywordflow">else</span> {
<a name="l00799"></a>00799             <a class="code" href="../../dc/dcc/array_8c.html#a59d553a8cd781364b8bcb0deae25cca2">rb_ary_push</a>(ary, p);
<a name="l00800"></a>00800         }
<a name="l00801"></a>00801     }
<a name="l00802"></a>00802     <span class="keywordflow">return</span> ary;
<a name="l00803"></a>00803 }
<a name="l00804"></a>00804 
<a name="l00805"></a><a class="code" href="../../de/ddf/group__class.html#ga45cf717dd221a8b788919837adcacaac">00805</a> <span class="preprocessor">#define VISI(x) ((x)&amp;NOEX_MASK)</span>
<a name="l00806"></a><a class="code" href="../../de/ddf/group__class.html#gadb07cefbca8dce34a3d7442eb3427fd4">00806</a> <span class="preprocessor"></span><span class="preprocessor">#define VISI_CHECK(x,f) (VISI(x) == (f))</span>
<a name="l00807"></a>00807 <span class="preprocessor"></span>
<a name="l00808"></a>00808 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l00809"></a><a class="code" href="../../de/ddf/group__class.html#ga405f12b8aae08d769fd0d2036c90b838">00809</a> <a class="code" href="../../de/ddf/group__class.html#ga405f12b8aae08d769fd0d2036c90b838">ins_methods_push</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#afa5b9137f051ac26d7ccc8824f178233">ID</a> <a class="code" href="../../d6/da0/nkf-utf8_2nkf_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="keywordtype">long</span> <a class="code" href="../../d5/d9d/tcltklib_8c.html#ac765329451135abec74c45e1897abf26">type</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> ary, <span class="keywordtype">long</span> visi)
<a name="l00810"></a>00810 {
<a name="l00811"></a>00811     <span class="keywordflow">if</span> (type == -1) <span class="keywordflow">return</span> <a class="code" href="../../dd/d24/st_8h.html#a0c6a172fd99de7928916e65034ed8b1fac99fc55c7f355bf9071739a4bc2ea139">ST_CONTINUE</a>;
<a name="l00812"></a>00812 
<a name="l00813"></a>00813     <span class="keywordflow">switch</span> (visi) {
<a name="l00814"></a>00814       <span class="keywordflow">case</span> <a class="code" href="../../db/d0a/method_8h.html#a1e54ff32a6191e40451e1523c61ca439a155818970b18d63d59c83d22bc61803d">NOEX_PRIVATE</a>:
<a name="l00815"></a>00815       <span class="keywordflow">case</span> <a class="code" href="../../db/d0a/method_8h.html#a1e54ff32a6191e40451e1523c61ca439a0854498e40d4e26dd716a0ceba556439">NOEX_PROTECTED</a>:
<a name="l00816"></a>00816       <span class="keywordflow">case</span> <a class="code" href="../../db/d0a/method_8h.html#a1e54ff32a6191e40451e1523c61ca439acbaffd02a49dab8af6ca3bcde9336f30">NOEX_PUBLIC</a>:
<a name="l00817"></a>00817         visi = (type == visi);
<a name="l00818"></a>00818         <span class="keywordflow">break</span>;
<a name="l00819"></a>00819       <span class="keywordflow">default</span>:
<a name="l00820"></a>00820         visi = (type != <a class="code" href="../../db/d0a/method_8h.html#a1e54ff32a6191e40451e1523c61ca439a155818970b18d63d59c83d22bc61803d">NOEX_PRIVATE</a>);
<a name="l00821"></a>00821         <span class="keywordflow">break</span>;
<a name="l00822"></a>00822     }
<a name="l00823"></a>00823     <span class="keywordflow">if</span> (visi) {
<a name="l00824"></a>00824         <a class="code" href="../../dc/dcc/array_8c.html#a59d553a8cd781364b8bcb0deae25cca2">rb_ary_push</a>(ary, <a class="code" href="../../dc/d0c/cparse_8c.html#a48bfb6519a45249fb2ec0193ea3b6e1c">ID2SYM</a>(name));
<a name="l00825"></a>00825     }
<a name="l00826"></a>00826     <span class="keywordflow">return</span> <a class="code" href="../../dd/d24/st_8h.html#a0c6a172fd99de7928916e65034ed8b1fac99fc55c7f355bf9071739a4bc2ea139">ST_CONTINUE</a>;
<a name="l00827"></a>00827 }
<a name="l00828"></a>00828 
<a name="l00829"></a>00829 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l00830"></a><a class="code" href="../../de/ddf/group__class.html#gaecc749aa764bdcaa308a4df85151b990">00830</a> <a class="code" href="../../de/ddf/group__class.html#gaecc749aa764bdcaa308a4df85151b990">ins_methods_i</a>(<a class="code" href="../../de/dce/syck_8h.html#a8a45dfe133c1fd041e1b902bda9e43e8">st_data_t</a> <a class="code" href="../../d6/da0/nkf-utf8_2nkf_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <a class="code" href="../../de/dce/syck_8h.html#a8a45dfe133c1fd041e1b902bda9e43e8">st_data_t</a> <a class="code" href="../../d5/d9d/tcltklib_8c.html#ac765329451135abec74c45e1897abf26">type</a>, <a class="code" href="../../de/dce/syck_8h.html#a8a45dfe133c1fd041e1b902bda9e43e8">st_data_t</a> ary)
<a name="l00831"></a>00831 {
<a name="l00832"></a>00832     <span class="keywordflow">return</span> <a class="code" href="../../de/ddf/group__class.html#ga405f12b8aae08d769fd0d2036c90b838">ins_methods_push</a>((<a class="code" href="../../de/de6/ruby_2ruby_8h.html#afa5b9137f051ac26d7ccc8824f178233">ID</a>)name, (<span class="keywordtype">long</span>)type, (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>)ary, -1); <span class="comment">/* everything but private */</span>
<a name="l00833"></a>00833 }
<a name="l00834"></a>00834 
<a name="l00835"></a>00835 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l00836"></a><a class="code" href="../../de/ddf/group__class.html#ga7ae22908c55e4fc16e78df73d43d6442">00836</a> <a class="code" href="../../de/ddf/group__class.html#ga7ae22908c55e4fc16e78df73d43d6442">ins_methods_prot_i</a>(<a class="code" href="../../de/dce/syck_8h.html#a8a45dfe133c1fd041e1b902bda9e43e8">st_data_t</a> <a class="code" href="../../d6/da0/nkf-utf8_2nkf_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <a class="code" href="../../de/dce/syck_8h.html#a8a45dfe133c1fd041e1b902bda9e43e8">st_data_t</a> <a class="code" href="../../d5/d9d/tcltklib_8c.html#ac765329451135abec74c45e1897abf26">type</a>, <a class="code" href="../../de/dce/syck_8h.html#a8a45dfe133c1fd041e1b902bda9e43e8">st_data_t</a> ary)
<a name="l00837"></a>00837 {
<a name="l00838"></a>00838     <span class="keywordflow">return</span> <a class="code" href="../../de/ddf/group__class.html#ga405f12b8aae08d769fd0d2036c90b838">ins_methods_push</a>((<a class="code" href="../../de/de6/ruby_2ruby_8h.html#afa5b9137f051ac26d7ccc8824f178233">ID</a>)name, (<span class="keywordtype">long</span>)type, (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>)ary, <a class="code" href="../../db/d0a/method_8h.html#a1e54ff32a6191e40451e1523c61ca439a0854498e40d4e26dd716a0ceba556439">NOEX_PROTECTED</a>);
<a name="l00839"></a>00839 }
<a name="l00840"></a>00840 
<a name="l00841"></a>00841 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l00842"></a><a class="code" href="../../de/ddf/group__class.html#ga37cd27db6348757543e351d9a394416f">00842</a> <a class="code" href="../../de/ddf/group__class.html#ga37cd27db6348757543e351d9a394416f">ins_methods_priv_i</a>(<a class="code" href="../../de/dce/syck_8h.html#a8a45dfe133c1fd041e1b902bda9e43e8">st_data_t</a> <a class="code" href="../../d6/da0/nkf-utf8_2nkf_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <a class="code" href="../../de/dce/syck_8h.html#a8a45dfe133c1fd041e1b902bda9e43e8">st_data_t</a> <a class="code" href="../../d5/d9d/tcltklib_8c.html#ac765329451135abec74c45e1897abf26">type</a>, <a class="code" href="../../de/dce/syck_8h.html#a8a45dfe133c1fd041e1b902bda9e43e8">st_data_t</a> ary)
<a name="l00843"></a>00843 {
<a name="l00844"></a>00844     <span class="keywordflow">return</span> <a class="code" href="../../de/ddf/group__class.html#ga405f12b8aae08d769fd0d2036c90b838">ins_methods_push</a>((<a class="code" href="../../de/de6/ruby_2ruby_8h.html#afa5b9137f051ac26d7ccc8824f178233">ID</a>)name, (<span class="keywordtype">long</span>)type, (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>)ary, <a class="code" href="../../db/d0a/method_8h.html#a1e54ff32a6191e40451e1523c61ca439a155818970b18d63d59c83d22bc61803d">NOEX_PRIVATE</a>);
<a name="l00845"></a>00845 }
<a name="l00846"></a>00846 
<a name="l00847"></a>00847 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l00848"></a><a class="code" href="../../de/ddf/group__class.html#gadb8af7f8a310fa48dc2c6954704d96aa">00848</a> <a class="code" href="../../de/ddf/group__class.html#gadb8af7f8a310fa48dc2c6954704d96aa">ins_methods_pub_i</a>(<a class="code" href="../../de/dce/syck_8h.html#a8a45dfe133c1fd041e1b902bda9e43e8">st_data_t</a> <a class="code" href="../../d6/da0/nkf-utf8_2nkf_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <a class="code" href="../../de/dce/syck_8h.html#a8a45dfe133c1fd041e1b902bda9e43e8">st_data_t</a> <a class="code" href="../../d5/d9d/tcltklib_8c.html#ac765329451135abec74c45e1897abf26">type</a>, <a class="code" href="../../de/dce/syck_8h.html#a8a45dfe133c1fd041e1b902bda9e43e8">st_data_t</a> ary)
<a name="l00849"></a>00849 {
<a name="l00850"></a>00850     <span class="keywordflow">return</span> <a class="code" href="../../de/ddf/group__class.html#ga405f12b8aae08d769fd0d2036c90b838">ins_methods_push</a>((<a class="code" href="../../de/de6/ruby_2ruby_8h.html#afa5b9137f051ac26d7ccc8824f178233">ID</a>)name, (<span class="keywordtype">long</span>)type, (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>)ary, <a class="code" href="../../db/d0a/method_8h.html#a1e54ff32a6191e40451e1523c61ca439acbaffd02a49dab8af6ca3bcde9336f30">NOEX_PUBLIC</a>);
<a name="l00851"></a>00851 }
<a name="l00852"></a>00852 
<a name="l00853"></a>00853 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l00854"></a><a class="code" href="../../de/ddf/group__class.html#ga9d766b8e4c2e07af5c6cf8d5016d1a11">00854</a> <a class="code" href="../../de/ddf/group__class.html#ga9d766b8e4c2e07af5c6cf8d5016d1a11">method_entry_i</a>(<a class="code" href="../../de/dce/syck_8h.html#a8a45dfe133c1fd041e1b902bda9e43e8">st_data_t</a> <a class="code" href="../../dc/de5/random_8c.html#a742229490b6759a90ece7ba82ba129d5">key</a>, <a class="code" href="../../de/dce/syck_8h.html#a8a45dfe133c1fd041e1b902bda9e43e8">st_data_t</a> value, <a class="code" href="../../de/dce/syck_8h.html#a8a45dfe133c1fd041e1b902bda9e43e8">st_data_t</a> data)
<a name="l00855"></a>00855 {
<a name="l00856"></a>00856     <span class="keyword">const</span> <a class="code" href="../../d7/db7/structrb__method__entry__struct.html">rb_method_entry_t</a> *me = (<span class="keyword">const</span> <a class="code" href="../../d7/db7/structrb__method__entry__struct.html">rb_method_entry_t</a> *)value;
<a name="l00857"></a>00857     <a class="code" href="../../d0/ddd/structst__table.html">st_table</a> *<a class="code" href="../../d5/db5/encoding_8c.html#a05f70dacbe595d27364e1e014efb0c8e">list</a> = (<a class="code" href="../../d0/ddd/structst__table.html">st_table</a> *)data;
<a name="l00858"></a>00858     <span class="keywordtype">long</span> <a class="code" href="../../d5/d9d/tcltklib_8c.html#ac765329451135abec74c45e1897abf26">type</a>;
<a name="l00859"></a>00859 
<a name="l00860"></a>00860     <span class="keywordflow">if</span> ((<a class="code" href="../../de/de6/ruby_2ruby_8h.html#afa5b9137f051ac26d7ccc8824f178233">ID</a>)key == <a class="code" href="../../db/d2e/intern_8h.html#aae711a904c63bacc1664e9ee240fc9b3">ID_ALLOCATOR</a>) {
<a name="l00861"></a>00861         <span class="keywordflow">return</span> <a class="code" href="../../dd/d24/st_8h.html#a0c6a172fd99de7928916e65034ed8b1fac99fc55c7f355bf9071739a4bc2ea139">ST_CONTINUE</a>;
<a name="l00862"></a>00862     }
<a name="l00863"></a>00863 
<a name="l00864"></a>00864     <span class="keywordflow">if</span> (!<a class="code" href="../../dd/d24/st_8h.html#a2d85287fbdaf7dcbc22d45e925c29fea">st_lookup</a>(list, key, 0)) {
<a name="l00865"></a>00865         <span class="keywordflow">if</span> (<a class="code" href="../../db/d0a/method_8h.html#aaa8e7bfb9a59a81763a11e426287f124">UNDEFINED_METHOD_ENTRY_P</a>(me)) {
<a name="l00866"></a>00866             type = -1; <span class="comment">/* none */</span>
<a name="l00867"></a>00867         }
<a name="l00868"></a>00868         <span class="keywordflow">else</span> {
<a name="l00869"></a>00869             type = <a class="code" href="../../de/ddf/group__class.html#ga45cf717dd221a8b788919837adcacaac">VISI</a>(me-&gt;<a class="code" href="../../d7/db7/structrb__method__entry__struct.html#acd723fa7190ed8785ef776bfd3b0d1f4">flag</a>);
<a name="l00870"></a>00870         }
<a name="l00871"></a>00871         <a class="code" href="../../dd/d24/st_8h.html#aee4e16ae99cd543ddf851107d5ea5408">st_add_direct</a>(list, key, type);
<a name="l00872"></a>00872     }
<a name="l00873"></a>00873     <span class="keywordflow">return</span> <a class="code" href="../../dd/d24/st_8h.html#a0c6a172fd99de7928916e65034ed8b1fac99fc55c7f355bf9071739a4bc2ea139">ST_CONTINUE</a>;
<a name="l00874"></a>00874 }
<a name="l00875"></a>00875 
<a name="l00876"></a>00876 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l00877"></a><a class="code" href="../../de/ddf/group__class.html#ga505dbc5f9943db07a748357c7946389b">00877</a> <a class="code" href="../../de/ddf/group__class.html#ga505dbc5f9943db07a748357c7946389b">class_instance_method_list</a>(<span class="keywordtype">int</span> <a class="code" href="../../df/d77/ruby_8c.html#ad1447518f4372828b8435ae82e48499e">argc</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> *<a class="code" href="../../df/d77/ruby_8c.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <a class="code" href="../../d1/d6f/date__strftime_8c.html#aa84d960185b18347956518e4d00766b4">mod</a>, <span class="keywordtype">int</span> obj, <span class="keywordtype">int</span> (*<a class="code" href="../../dc/dd1/ossl__ssl_8c.html#a131c09b7f9c9a0b52e6f79f651cfd574">func</a>) (<a class="code" href="../../de/dce/syck_8h.html#a8a45dfe133c1fd041e1b902bda9e43e8">st_data_t</a>, <a class="code" href="../../de/dce/syck_8h.html#a8a45dfe133c1fd041e1b902bda9e43e8">st_data_t</a>, <a class="code" href="../../de/dce/syck_8h.html#a8a45dfe133c1fd041e1b902bda9e43e8">st_data_t</a>))
<a name="l00878"></a>00878 {
<a name="l00879"></a>00879     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> ary;
<a name="l00880"></a>00880     <span class="keywordtype">int</span> <a class="code" href="../../d9/df5/date__strptime_8c.html#a554631207e429ff3f75bc8bacf3806d4">recur</a>;
<a name="l00881"></a>00881     <a class="code" href="../../d0/ddd/structst__table.html">st_table</a> *<a class="code" href="../../d5/db5/encoding_8c.html#a05f70dacbe595d27364e1e014efb0c8e">list</a>;
<a name="l00882"></a>00882 
<a name="l00883"></a>00883     <span class="keywordflow">if</span> (argc == 0) {
<a name="l00884"></a>00884         recur = <a class="code" href="../../d1/d5c/nkf_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00885"></a>00885     }
<a name="l00886"></a>00886     <span class="keywordflow">else</span> {
<a name="l00887"></a>00887         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> r;
<a name="l00888"></a>00888         <a class="code" href="../../d7/d19/group__defmethod.html#gaa7bed88640f01bee619f85fda09d28d7">rb_scan_args</a>(argc, argv, <span class="stringliteral">&quot;01&quot;</span>, &amp;r);
<a name="l00889"></a>00889         recur = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a117741045763c090b26e30a85bd0e0a6">RTEST</a>(r);
<a name="l00890"></a>00890     }
<a name="l00891"></a>00891 
<a name="l00892"></a>00892     list = <a class="code" href="../../dd/d24/st_8h.html#a955c6e936b9681649ab9ffa4aa741949">st_init_numtable</a>();
<a name="l00893"></a>00893     <span class="keywordflow">for</span> (; mod; mod = <a class="code" href="../../d3/d09/ripper_8y.html#a19d17315b6b34045cdffec9912342b91">RCLASS_SUPER</a>(mod)) {
<a name="l00894"></a>00894         <a class="code" href="../../dd/d24/st_8h.html#ace5a79870d2800659a653fceeca55262">st_foreach</a>(<a class="code" href="../../d3/d09/ripper_8y.html#ab59ea80cdf15f3f19bbae0346314c9ad">RCLASS_M_TBL</a>(mod), <a class="code" href="../../de/ddf/group__class.html#ga9d766b8e4c2e07af5c6cf8d5016d1a11">method_entry_i</a>, (<a class="code" href="../../de/dce/syck_8h.html#a8a45dfe133c1fd041e1b902bda9e43e8">st_data_t</a>)list);
<a name="l00895"></a>00895         <span class="keywordflow">if</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#aee74f540353cd2d77d1cb37a3714bd7d">BUILTIN_TYPE</a>(mod) == <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a82c8c4569748b9645c958b9eaeaabb81">T_ICLASS</a>) <span class="keywordflow">continue</span>;
<a name="l00896"></a>00896         <span class="keywordflow">if</span> (obj &amp;&amp; <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a1ae918b6cc84188a9dc6ab545f732e4d">FL_TEST</a>(mod, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a081b5172ef37829bb3a258cd1ad393bc">FL_SINGLETON</a>)) <span class="keywordflow">continue</span>;
<a name="l00897"></a>00897         <span class="keywordflow">if</span> (!recur) <span class="keywordflow">break</span>;
<a name="l00898"></a>00898     }
<a name="l00899"></a>00899     ary = <a class="code" href="../../dc/dcc/array_8c.html#a9518114fd36cb4ef4656ec1dc63348c9">rb_ary_new</a>();
<a name="l00900"></a>00900     <a class="code" href="../../dd/d24/st_8h.html#ace5a79870d2800659a653fceeca55262">st_foreach</a>(list, <a class="code" href="../../dc/dd1/ossl__ssl_8c.html#a131c09b7f9c9a0b52e6f79f651cfd574">func</a>, ary);
<a name="l00901"></a>00901     <a class="code" href="../../dd/d24/st_8h.html#acb004847ef312373d65bfb0d1a21c5b3">st_free_table</a>(list);
<a name="l00902"></a>00902 
<a name="l00903"></a>00903     <span class="keywordflow">return</span> ary;
<a name="l00904"></a>00904 }
<a name="l00905"></a>00905 
<a name="l00906"></a>00906 <span class="comment">/*</span>
<a name="l00907"></a>00907 <span class="comment"> *  call-seq:</span>
<a name="l00908"></a>00908 <span class="comment"> *     mod.instance_methods(include_super=true)   -&gt; array</span>
<a name="l00909"></a>00909 <span class="comment"> *</span>
<a name="l00910"></a>00910 <span class="comment"> *  Returns an array containing the names of the public and protected instance</span>
<a name="l00911"></a>00911 <span class="comment"> *  methods in the receiver. For a module, these are the public and protected methods;</span>
<a name="l00912"></a>00912 <span class="comment"> *  for a class, they are the instance (not singleton) methods. With no</span>
<a name="l00913"></a>00913 <span class="comment"> *  argument, or with an argument that is &lt;code&gt;false&lt;/code&gt;, the</span>
<a name="l00914"></a>00914 <span class="comment"> *  instance methods in &lt;i&gt;mod&lt;/i&gt; are returned, otherwise the methods</span>
<a name="l00915"></a>00915 <span class="comment"> *  in &lt;i&gt;mod&lt;/i&gt; and &lt;i&gt;mod&lt;/i&gt;&apos;s superclasses are returned.</span>
<a name="l00916"></a>00916 <span class="comment"> *</span>
<a name="l00917"></a>00917 <span class="comment"> *     module A</span>
<a name="l00918"></a>00918 <span class="comment"> *       def method1()  end</span>
<a name="l00919"></a>00919 <span class="comment"> *     end</span>
<a name="l00920"></a>00920 <span class="comment"> *     class B</span>
<a name="l00921"></a>00921 <span class="comment"> *       def method2()  end</span>
<a name="l00922"></a>00922 <span class="comment"> *     end</span>
<a name="l00923"></a>00923 <span class="comment"> *     class C &lt; B</span>
<a name="l00924"></a>00924 <span class="comment"> *       def method3()  end</span>
<a name="l00925"></a>00925 <span class="comment"> *     end</span>
<a name="l00926"></a>00926 <span class="comment"> *</span>
<a name="l00927"></a>00927 <span class="comment"> *     A.instance_methods                #=&gt; [:method1]</span>
<a name="l00928"></a>00928 <span class="comment"> *     B.instance_methods(false)         #=&gt; [:method2]</span>
<a name="l00929"></a>00929 <span class="comment"> *     C.instance_methods(false)         #=&gt; [:method3]</span>
<a name="l00930"></a>00930 <span class="comment"> *     C.instance_methods(true).length   #=&gt; 43</span>
<a name="l00931"></a>00931 <span class="comment"> */</span>
<a name="l00932"></a>00932 
<a name="l00933"></a>00933 <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l00934"></a><a class="code" href="../../de/ddf/group__class.html#ga8fdd2de221e1de23ff11d8327d26ea81">00934</a> <a class="code" href="../../de/ddf/group__class.html#ga8fdd2de221e1de23ff11d8327d26ea81">rb_class_instance_methods</a>(<span class="keywordtype">int</span> argc, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> *argv, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> mod)
<a name="l00935"></a>00935 {
<a name="l00936"></a>00936     <span class="keywordflow">return</span> <a class="code" href="../../de/ddf/group__class.html#ga505dbc5f9943db07a748357c7946389b">class_instance_method_list</a>(argc, argv, mod, 0, <a class="code" href="../../de/ddf/group__class.html#gaecc749aa764bdcaa308a4df85151b990">ins_methods_i</a>);
<a name="l00937"></a>00937 }
<a name="l00938"></a>00938 
<a name="l00939"></a>00939 <span class="comment">/*</span>
<a name="l00940"></a>00940 <span class="comment"> *  call-seq:</span>
<a name="l00941"></a>00941 <span class="comment"> *     mod.protected_instance_methods(include_super=true)   -&gt; array</span>
<a name="l00942"></a>00942 <span class="comment"> *</span>
<a name="l00943"></a>00943 <span class="comment"> *  Returns a list of the protected instance methods defined in</span>
<a name="l00944"></a>00944 <span class="comment"> *  &lt;i&gt;mod&lt;/i&gt;. If the optional parameter is not &lt;code&gt;false&lt;/code&gt;, the</span>
<a name="l00945"></a>00945 <span class="comment"> *  methods of any ancestors are included.</span>
<a name="l00946"></a>00946 <span class="comment"> */</span>
<a name="l00947"></a>00947 
<a name="l00948"></a>00948 <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l00949"></a><a class="code" href="../../de/ddf/group__class.html#gaff34253faabe29fddcb843b74561b7c5">00949</a> <a class="code" href="../../de/ddf/group__class.html#gaff34253faabe29fddcb843b74561b7c5">rb_class_protected_instance_methods</a>(<span class="keywordtype">int</span> argc, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> *argv, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> mod)
<a name="l00950"></a>00950 {
<a name="l00951"></a>00951     <span class="keywordflow">return</span> <a class="code" href="../../de/ddf/group__class.html#ga505dbc5f9943db07a748357c7946389b">class_instance_method_list</a>(argc, argv, mod, 0, <a class="code" href="../../de/ddf/group__class.html#ga7ae22908c55e4fc16e78df73d43d6442">ins_methods_prot_i</a>);
<a name="l00952"></a>00952 }
<a name="l00953"></a>00953 
<a name="l00954"></a>00954 <span class="comment">/*</span>
<a name="l00955"></a>00955 <span class="comment"> *  call-seq:</span>
<a name="l00956"></a>00956 <span class="comment"> *     mod.private_instance_methods(include_super=true)    -&gt; array</span>
<a name="l00957"></a>00957 <span class="comment"> *</span>
<a name="l00958"></a>00958 <span class="comment"> *  Returns a list of the private instance methods defined in</span>
<a name="l00959"></a>00959 <span class="comment"> *  &lt;i&gt;mod&lt;/i&gt;. If the optional parameter is not &lt;code&gt;false&lt;/code&gt;, the</span>
<a name="l00960"></a>00960 <span class="comment"> *  methods of any ancestors are included.</span>
<a name="l00961"></a>00961 <span class="comment"> *</span>
<a name="l00962"></a>00962 <span class="comment"> *     module Mod</span>
<a name="l00963"></a>00963 <span class="comment"> *       def method1()  end</span>
<a name="l00964"></a>00964 <span class="comment"> *       private :method1</span>
<a name="l00965"></a>00965 <span class="comment"> *       def method2()  end</span>
<a name="l00966"></a>00966 <span class="comment"> *     end</span>
<a name="l00967"></a>00967 <span class="comment"> *     Mod.instance_methods           #=&gt; [:method2]</span>
<a name="l00968"></a>00968 <span class="comment"> *     Mod.private_instance_methods   #=&gt; [:method1]</span>
<a name="l00969"></a>00969 <span class="comment"> */</span>
<a name="l00970"></a>00970 
<a name="l00971"></a>00971 <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l00972"></a><a class="code" href="../../de/ddf/group__class.html#ga01b1e94fa5f697de4886c24e806af2cc">00972</a> <a class="code" href="../../de/ddf/group__class.html#ga01b1e94fa5f697de4886c24e806af2cc">rb_class_private_instance_methods</a>(<span class="keywordtype">int</span> argc, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> *argv, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> mod)
<a name="l00973"></a>00973 {
<a name="l00974"></a>00974     <span class="keywordflow">return</span> <a class="code" href="../../de/ddf/group__class.html#ga505dbc5f9943db07a748357c7946389b">class_instance_method_list</a>(argc, argv, mod, 0, <a class="code" href="../../de/ddf/group__class.html#ga37cd27db6348757543e351d9a394416f">ins_methods_priv_i</a>);
<a name="l00975"></a>00975 }
<a name="l00976"></a>00976 
<a name="l00977"></a>00977 <span class="comment">/*</span>
<a name="l00978"></a>00978 <span class="comment"> *  call-seq:</span>
<a name="l00979"></a>00979 <span class="comment"> *     mod.public_instance_methods(include_super=true)   -&gt; array</span>
<a name="l00980"></a>00980 <span class="comment"> *</span>
<a name="l00981"></a>00981 <span class="comment"> *  Returns a list of the public instance methods defined in &lt;i&gt;mod&lt;/i&gt;.</span>
<a name="l00982"></a>00982 <span class="comment"> *  If the optional parameter is not &lt;code&gt;false&lt;/code&gt;, the methods of</span>
<a name="l00983"></a>00983 <span class="comment"> *  any ancestors are included.</span>
<a name="l00984"></a>00984 <span class="comment"> */</span>
<a name="l00985"></a>00985 
<a name="l00986"></a>00986 <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l00987"></a><a class="code" href="../../de/ddf/group__class.html#ga25147da324e08d069454651d93ebd597">00987</a> <a class="code" href="../../de/ddf/group__class.html#ga25147da324e08d069454651d93ebd597">rb_class_public_instance_methods</a>(<span class="keywordtype">int</span> argc, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> *argv, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> mod)
<a name="l00988"></a>00988 {
<a name="l00989"></a>00989     <span class="keywordflow">return</span> <a class="code" href="../../de/ddf/group__class.html#ga505dbc5f9943db07a748357c7946389b">class_instance_method_list</a>(argc, argv, mod, 0, <a class="code" href="../../de/ddf/group__class.html#gadb8af7f8a310fa48dc2c6954704d96aa">ins_methods_pub_i</a>);
<a name="l00990"></a>00990 }
<a name="l00991"></a>00991 
<a name="l00992"></a>00992 <span class="comment">/*</span>
<a name="l00993"></a>00993 <span class="comment"> *  call-seq:</span>
<a name="l00994"></a>00994 <span class="comment"> *     obj.methods    -&gt; array</span>
<a name="l00995"></a>00995 <span class="comment"> *</span>
<a name="l00996"></a>00996 <span class="comment"> *  Returns a list of the names of public and protected methods of</span>
<a name="l00997"></a>00997 <span class="comment"> *  &lt;i&gt;obj&lt;/i&gt;. This will include all the methods accessible in</span>
<a name="l00998"></a>00998 <span class="comment"> *  &lt;i&gt;obj&lt;/i&gt;&apos;s ancestors.</span>
<a name="l00999"></a>00999 <span class="comment"> *</span>
<a name="l01000"></a>01000 <span class="comment"> *     class Klass</span>
<a name="l01001"></a>01001 <span class="comment"> *       def klass_method()</span>
<a name="l01002"></a>01002 <span class="comment"> *       end</span>
<a name="l01003"></a>01003 <span class="comment"> *     end</span>
<a name="l01004"></a>01004 <span class="comment"> *     k = Klass.new</span>
<a name="l01005"></a>01005 <span class="comment"> *     k.methods[0..9]    #=&gt; [:klass_method, :nil?, :===,</span>
<a name="l01006"></a>01006 <span class="comment"> *                        #    :==~, :!, :eql?</span>
<a name="l01007"></a>01007 <span class="comment"> *                        #    :hash, :&lt;=&gt;, :class, :singleton_class]</span>
<a name="l01008"></a>01008 <span class="comment"> *     k.methods.length   #=&gt; 57</span>
<a name="l01009"></a>01009 <span class="comment"> */</span>
<a name="l01010"></a>01010 
<a name="l01011"></a>01011 <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l01012"></a><a class="code" href="../../de/ddf/group__class.html#gab4d9ce389bd8a89ad8aadb46211a65ff">01012</a> <a class="code" href="../../de/ddf/group__class.html#gab4d9ce389bd8a89ad8aadb46211a65ff">rb_obj_methods</a>(<span class="keywordtype">int</span> argc, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> *argv, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> obj)
<a name="l01013"></a>01013 {
<a name="l01014"></a>01014   retry:
<a name="l01015"></a>01015     <span class="keywordflow">if</span> (argc == 0) {
<a name="l01016"></a>01016         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <a class="code" href="../../d3/d09/ripper_8y.html#a8187411843a6284ffb964ef3fb9fcab3">args</a>[1];
<a name="l01017"></a>01017 
<a name="l01018"></a>01018         args[0] = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aacea3516b33941ce8149098e223a7466">Qtrue</a>;
<a name="l01019"></a>01019         <span class="keywordflow">return</span> <a class="code" href="../../de/ddf/group__class.html#ga505dbc5f9943db07a748357c7946389b">class_instance_method_list</a>(argc, argv, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ad07df58de9895cbc33c10f02540d2d4d">CLASS_OF</a>(obj), 1, <a class="code" href="../../de/ddf/group__class.html#gaecc749aa764bdcaa308a4df85151b990">ins_methods_i</a>);
<a name="l01020"></a>01020     }
<a name="l01021"></a>01021     <span class="keywordflow">else</span> {
<a name="l01022"></a>01022         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <a class="code" href="../../d9/df5/date__strptime_8c.html#a554631207e429ff3f75bc8bacf3806d4">recur</a>;
<a name="l01023"></a>01023 
<a name="l01024"></a>01024         <a class="code" href="../../d7/d19/group__defmethod.html#gaa7bed88640f01bee619f85fda09d28d7">rb_scan_args</a>(argc, argv, <span class="stringliteral">&quot;1&quot;</span>, &amp;recur);
<a name="l01025"></a>01025         <span class="keywordflow">if</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a117741045763c090b26e30a85bd0e0a6">RTEST</a>(recur)) {
<a name="l01026"></a>01026             argc = 0;
<a name="l01027"></a>01027             <span class="keywordflow">goto</span> retry;
<a name="l01028"></a>01028         }
<a name="l01029"></a>01029         <span class="keywordflow">return</span> <a class="code" href="../../de/ddf/group__class.html#ga9d6b13fbaa0911a60bcc30a98435957f">rb_obj_singleton_methods</a>(argc, argv, obj);
<a name="l01030"></a>01030     }
<a name="l01031"></a>01031 }
<a name="l01032"></a>01032 
<a name="l01033"></a>01033 <span class="comment">/*</span>
<a name="l01034"></a>01034 <span class="comment"> *  call-seq:</span>
<a name="l01035"></a>01035 <span class="comment"> *     obj.protected_methods(all=true)   -&gt; array</span>
<a name="l01036"></a>01036 <span class="comment"> *</span>
<a name="l01037"></a>01037 <span class="comment"> *  Returns the list of protected methods accessible to &lt;i&gt;obj&lt;/i&gt;. If</span>
<a name="l01038"></a>01038 <span class="comment"> *  the &lt;i&gt;all&lt;/i&gt; parameter is set to &lt;code&gt;false&lt;/code&gt;, only those methods</span>
<a name="l01039"></a>01039 <span class="comment"> *  in the receiver will be listed.</span>
<a name="l01040"></a>01040 <span class="comment"> */</span>
<a name="l01041"></a>01041 
<a name="l01042"></a>01042 <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l01043"></a><a class="code" href="../../de/ddf/group__class.html#gae99439d4c2b7c81b49809db642c3b743">01043</a> <a class="code" href="../../de/ddf/group__class.html#gae99439d4c2b7c81b49809db642c3b743">rb_obj_protected_methods</a>(<span class="keywordtype">int</span> argc, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> *argv, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> obj)
<a name="l01044"></a>01044 {
<a name="l01045"></a>01045     <span class="keywordflow">return</span> <a class="code" href="../../de/ddf/group__class.html#ga505dbc5f9943db07a748357c7946389b">class_instance_method_list</a>(argc, argv, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ad07df58de9895cbc33c10f02540d2d4d">CLASS_OF</a>(obj), 1, <a class="code" href="../../de/ddf/group__class.html#ga7ae22908c55e4fc16e78df73d43d6442">ins_methods_prot_i</a>);
<a name="l01046"></a>01046 }
<a name="l01047"></a>01047 
<a name="l01048"></a>01048 <span class="comment">/*</span>
<a name="l01049"></a>01049 <span class="comment"> *  call-seq:</span>
<a name="l01050"></a>01050 <span class="comment"> *     obj.private_methods(all=true)   -&gt; array</span>
<a name="l01051"></a>01051 <span class="comment"> *</span>
<a name="l01052"></a>01052 <span class="comment"> *  Returns the list of private methods accessible to &lt;i&gt;obj&lt;/i&gt;. If</span>
<a name="l01053"></a>01053 <span class="comment"> *  the &lt;i&gt;all&lt;/i&gt; parameter is set to &lt;code&gt;false&lt;/code&gt;, only those methods</span>
<a name="l01054"></a>01054 <span class="comment"> *  in the receiver will be listed.</span>
<a name="l01055"></a>01055 <span class="comment"> */</span>
<a name="l01056"></a>01056 
<a name="l01057"></a>01057 <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l01058"></a><a class="code" href="../../de/ddf/group__class.html#gad1542b990c985542d40a41044bd39f9e">01058</a> <a class="code" href="../../de/ddf/group__class.html#gad1542b990c985542d40a41044bd39f9e">rb_obj_private_methods</a>(<span class="keywordtype">int</span> argc, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> *argv, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> obj)
<a name="l01059"></a>01059 {
<a name="l01060"></a>01060     <span class="keywordflow">return</span> <a class="code" href="../../de/ddf/group__class.html#ga505dbc5f9943db07a748357c7946389b">class_instance_method_list</a>(argc, argv, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ad07df58de9895cbc33c10f02540d2d4d">CLASS_OF</a>(obj), 1, <a class="code" href="../../de/ddf/group__class.html#ga37cd27db6348757543e351d9a394416f">ins_methods_priv_i</a>);
<a name="l01061"></a>01061 }
<a name="l01062"></a>01062 
<a name="l01063"></a>01063 <span class="comment">/*</span>
<a name="l01064"></a>01064 <span class="comment"> *  call-seq:</span>
<a name="l01065"></a>01065 <span class="comment"> *     obj.public_methods(all=true)   -&gt; array</span>
<a name="l01066"></a>01066 <span class="comment"> *</span>
<a name="l01067"></a>01067 <span class="comment"> *  Returns the list of public methods accessible to &lt;i&gt;obj&lt;/i&gt;. If</span>
<a name="l01068"></a>01068 <span class="comment"> *  the &lt;i&gt;all&lt;/i&gt; parameter is set to &lt;code&gt;false&lt;/code&gt;, only those methods</span>
<a name="l01069"></a>01069 <span class="comment"> *  in the receiver will be listed.</span>
<a name="l01070"></a>01070 <span class="comment"> */</span>
<a name="l01071"></a>01071 
<a name="l01072"></a>01072 <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l01073"></a><a class="code" href="../../de/ddf/group__class.html#ga1da999e27b11464902d25aa86e75c399">01073</a> <a class="code" href="../../de/ddf/group__class.html#ga1da999e27b11464902d25aa86e75c399">rb_obj_public_methods</a>(<span class="keywordtype">int</span> argc, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> *argv, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> obj)
<a name="l01074"></a>01074 {
<a name="l01075"></a>01075     <span class="keywordflow">return</span> <a class="code" href="../../de/ddf/group__class.html#ga505dbc5f9943db07a748357c7946389b">class_instance_method_list</a>(argc, argv, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ad07df58de9895cbc33c10f02540d2d4d">CLASS_OF</a>(obj), 1, <a class="code" href="../../de/ddf/group__class.html#gadb8af7f8a310fa48dc2c6954704d96aa">ins_methods_pub_i</a>);
<a name="l01076"></a>01076 }
<a name="l01077"></a>01077 
<a name="l01078"></a>01078 <span class="comment">/*</span>
<a name="l01079"></a>01079 <span class="comment"> *  call-seq:</span>
<a name="l01080"></a>01080 <span class="comment"> *     obj.singleton_methods(all=true)    -&gt; array</span>
<a name="l01081"></a>01081 <span class="comment"> *</span>
<a name="l01082"></a>01082 <span class="comment"> *  Returns an array of the names of singleton methods for &lt;i&gt;obj&lt;/i&gt;.</span>
<a name="l01083"></a>01083 <span class="comment"> *  If the optional &lt;i&gt;all&lt;/i&gt; parameter is true, the list will include</span>
<a name="l01084"></a>01084 <span class="comment"> *  methods in modules included in &lt;i&gt;obj&lt;/i&gt;.</span>
<a name="l01085"></a>01085 <span class="comment"> *  Only public and protected singleton methods are returned.</span>
<a name="l01086"></a>01086 <span class="comment"> *</span>
<a name="l01087"></a>01087 <span class="comment"> *     module Other</span>
<a name="l01088"></a>01088 <span class="comment"> *       def three() end</span>
<a name="l01089"></a>01089 <span class="comment"> *     end</span>
<a name="l01090"></a>01090 <span class="comment"> *</span>
<a name="l01091"></a>01091 <span class="comment"> *     class Single</span>
<a name="l01092"></a>01092 <span class="comment"> *       def Single.four() end</span>
<a name="l01093"></a>01093 <span class="comment"> *     end</span>
<a name="l01094"></a>01094 <span class="comment"> *</span>
<a name="l01095"></a>01095 <span class="comment"> *     a = Single.new</span>
<a name="l01096"></a>01096 <span class="comment"> *</span>
<a name="l01097"></a>01097 <span class="comment"> *     def a.one()</span>
<a name="l01098"></a>01098 <span class="comment"> *     end</span>
<a name="l01099"></a>01099 <span class="comment"> *</span>
<a name="l01100"></a>01100 <span class="comment"> *     class &lt;&lt; a</span>
<a name="l01101"></a>01101 <span class="comment"> *       include Other</span>
<a name="l01102"></a>01102 <span class="comment"> *       def two()</span>
<a name="l01103"></a>01103 <span class="comment"> *       end</span>
<a name="l01104"></a>01104 <span class="comment"> *     end</span>
<a name="l01105"></a>01105 <span class="comment"> *</span>
<a name="l01106"></a>01106 <span class="comment"> *     Single.singleton_methods    #=&gt; [:four]</span>
<a name="l01107"></a>01107 <span class="comment"> *     a.singleton_methods(false)  #=&gt; [:two, :one]</span>
<a name="l01108"></a>01108 <span class="comment"> *     a.singleton_methods         #=&gt; [:two, :one, :three]</span>
<a name="l01109"></a>01109 <span class="comment"> */</span>
<a name="l01110"></a>01110 
<a name="l01111"></a>01111 <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l01112"></a><a class="code" href="../../de/ddf/group__class.html#ga9d6b13fbaa0911a60bcc30a98435957f">01112</a> <a class="code" href="../../de/ddf/group__class.html#ga9d6b13fbaa0911a60bcc30a98435957f">rb_obj_singleton_methods</a>(<span class="keywordtype">int</span> argc, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> *argv, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> obj)
<a name="l01113"></a>01113 {
<a name="l01114"></a>01114     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <a class="code" href="../../d9/df5/date__strptime_8c.html#a554631207e429ff3f75bc8bacf3806d4">recur</a>, ary, <a class="code" href="../../d7/d63/structclone__method__data.html#a26a88a08390ac4ea5b8a727e0595e960">klass</a>;
<a name="l01115"></a>01115     <a class="code" href="../../d0/ddd/structst__table.html">st_table</a> *<a class="code" href="../../d5/db5/encoding_8c.html#a05f70dacbe595d27364e1e014efb0c8e">list</a>;
<a name="l01116"></a>01116 
<a name="l01117"></a>01117     <span class="keywordflow">if</span> (argc == 0) {
<a name="l01118"></a>01118         recur = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aacea3516b33941ce8149098e223a7466">Qtrue</a>;
<a name="l01119"></a>01119     }
<a name="l01120"></a>01120     <span class="keywordflow">else</span> {
<a name="l01121"></a>01121         <a class="code" href="../../d7/d19/group__defmethod.html#gaa7bed88640f01bee619f85fda09d28d7">rb_scan_args</a>(argc, argv, <span class="stringliteral">&quot;01&quot;</span>, &amp;recur);
<a name="l01122"></a>01122     }
<a name="l01123"></a>01123     klass = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ad07df58de9895cbc33c10f02540d2d4d">CLASS_OF</a>(obj);
<a name="l01124"></a>01124     list = <a class="code" href="../../dd/d24/st_8h.html#a955c6e936b9681649ab9ffa4aa741949">st_init_numtable</a>();
<a name="l01125"></a>01125     <span class="keywordflow">if</span> (klass &amp;&amp; <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a1ae918b6cc84188a9dc6ab545f732e4d">FL_TEST</a>(klass, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a081b5172ef37829bb3a258cd1ad393bc">FL_SINGLETON</a>)) {
<a name="l01126"></a>01126         <a class="code" href="../../dd/d24/st_8h.html#ace5a79870d2800659a653fceeca55262">st_foreach</a>(<a class="code" href="../../d3/d09/ripper_8y.html#ab59ea80cdf15f3f19bbae0346314c9ad">RCLASS_M_TBL</a>(klass), <a class="code" href="../../de/ddf/group__class.html#ga9d766b8e4c2e07af5c6cf8d5016d1a11">method_entry_i</a>, (<a class="code" href="../../de/dce/syck_8h.html#a8a45dfe133c1fd041e1b902bda9e43e8">st_data_t</a>)list);
<a name="l01127"></a>01127         klass = <a class="code" href="../../d3/d09/ripper_8y.html#a19d17315b6b34045cdffec9912342b91">RCLASS_SUPER</a>(klass);
<a name="l01128"></a>01128     }
<a name="l01129"></a>01129     <span class="keywordflow">if</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a117741045763c090b26e30a85bd0e0a6">RTEST</a>(recur)) {
<a name="l01130"></a>01130         <span class="keywordflow">while</span> (klass &amp;&amp; (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a1ae918b6cc84188a9dc6ab545f732e4d">FL_TEST</a>(klass, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a081b5172ef37829bb3a258cd1ad393bc">FL_SINGLETON</a>) || <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a394faf7191f18552a20cb17ce14226f0">TYPE</a>(klass) == <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a82c8c4569748b9645c958b9eaeaabb81">T_ICLASS</a>)) {
<a name="l01131"></a>01131             <a class="code" href="../../dd/d24/st_8h.html#ace5a79870d2800659a653fceeca55262">st_foreach</a>(<a class="code" href="../../d3/d09/ripper_8y.html#ab59ea80cdf15f3f19bbae0346314c9ad">RCLASS_M_TBL</a>(klass), <a class="code" href="../../de/ddf/group__class.html#ga9d766b8e4c2e07af5c6cf8d5016d1a11">method_entry_i</a>, (<a class="code" href="../../de/dce/syck_8h.html#a8a45dfe133c1fd041e1b902bda9e43e8">st_data_t</a>)list);
<a name="l01132"></a>01132             klass = <a class="code" href="../../d3/d09/ripper_8y.html#a19d17315b6b34045cdffec9912342b91">RCLASS_SUPER</a>(klass);
<a name="l01133"></a>01133         }
<a name="l01134"></a>01134     }
<a name="l01135"></a>01135     ary = <a class="code" href="../../dc/dcc/array_8c.html#a9518114fd36cb4ef4656ec1dc63348c9">rb_ary_new</a>();
<a name="l01136"></a>01136     <a class="code" href="../../dd/d24/st_8h.html#ace5a79870d2800659a653fceeca55262">st_foreach</a>(list, <a class="code" href="../../de/ddf/group__class.html#gaecc749aa764bdcaa308a4df85151b990">ins_methods_i</a>, ary);
<a name="l01137"></a>01137     <a class="code" href="../../dd/d24/st_8h.html#acb004847ef312373d65bfb0d1a21c5b3">st_free_table</a>(list);
<a name="l01138"></a>01138 
<a name="l01139"></a>01139     <span class="keywordflow">return</span> ary;
<a name="l01140"></a>01140 }
<a name="l01141"></a>01141 
<a name="l01199"></a>01199 <span class="keywordtype">void</span>
<a name="l01200"></a><a class="code" href="../../d7/d19/group__defmethod.html#gaef65cd1b731ec5c27eedd0e7ea73b6ca">01200</a> <a class="code" href="../../d7/d19/group__defmethod.html#gaef65cd1b731ec5c27eedd0e7ea73b6ca">rb_define_method_id</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <a class="code" href="../../d7/d63/structclone__method__data.html#a26a88a08390ac4ea5b8a727e0595e960">klass</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#afa5b9137f051ac26d7ccc8824f178233">ID</a> mid, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> (*<a class="code" href="../../dc/dd1/ossl__ssl_8c.html#a131c09b7f9c9a0b52e6f79f651cfd574">func</a>)(<a class="code" href="../../d8/db0/defines_8h.html#af4fd7cbafda9af704310f78516042dfb">ANYARGS</a>), <span class="keywordtype">int</span> argc)
<a name="l01201"></a>01201 {
<a name="l01202"></a>01202     <a class="code" href="../../db/d0a/method_8h.html#a60ad623f5610ed645f890af8c69be399">rb_add_method_cfunc</a>(klass, mid, <a class="code" href="../../dc/dd1/ossl__ssl_8c.html#a131c09b7f9c9a0b52e6f79f651cfd574">func</a>, argc, <a class="code" href="../../db/d0a/method_8h.html#a1e54ff32a6191e40451e1523c61ca439acbaffd02a49dab8af6ca3bcde9336f30">NOEX_PUBLIC</a>);
<a name="l01203"></a>01203 }
<a name="l01204"></a>01204 
<a name="l01205"></a>01205 <span class="keywordtype">void</span>
<a name="l01206"></a><a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">01206</a> <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> klass, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d6/da0/nkf-utf8_2nkf_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> (*<a class="code" href="../../dc/dd1/ossl__ssl_8c.html#a131c09b7f9c9a0b52e6f79f651cfd574">func</a>)(<a class="code" href="../../d8/db0/defines_8h.html#af4fd7cbafda9af704310f78516042dfb">ANYARGS</a>), <span class="keywordtype">int</span> argc)
<a name="l01207"></a>01207 {
<a name="l01208"></a>01208     <a class="code" href="../../db/d0a/method_8h.html#a60ad623f5610ed645f890af8c69be399">rb_add_method_cfunc</a>(klass, <a class="code" href="../../dc/dcc/array_8c.html#a9cfa42d4b79c89d68c53be8b2150a503">rb_intern</a>(name), <a class="code" href="../../dc/dd1/ossl__ssl_8c.html#a131c09b7f9c9a0b52e6f79f651cfd574">func</a>, argc, <a class="code" href="../../db/d0a/method_8h.html#a1e54ff32a6191e40451e1523c61ca439acbaffd02a49dab8af6ca3bcde9336f30">NOEX_PUBLIC</a>);
<a name="l01209"></a>01209 }
<a name="l01210"></a>01210 
<a name="l01211"></a>01211 <span class="keywordtype">void</span>
<a name="l01212"></a><a class="code" href="../../d7/d19/group__defmethod.html#ga26a899f62b118022b8ccfaba6775bb0f">01212</a> <a class="code" href="../../d7/d19/group__defmethod.html#ga26a899f62b118022b8ccfaba6775bb0f">rb_define_protected_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> klass, <span class="keyword">const</span> <span class="keywordtype">char</span> *name, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> (*<a class="code" href="../../dc/dd1/ossl__ssl_8c.html#a131c09b7f9c9a0b52e6f79f651cfd574">func</a>)(<a class="code" href="../../d8/db0/defines_8h.html#af4fd7cbafda9af704310f78516042dfb">ANYARGS</a>), <span class="keywordtype">int</span> argc)
<a name="l01213"></a>01213 {
<a name="l01214"></a>01214     <a class="code" href="../../db/d0a/method_8h.html#a60ad623f5610ed645f890af8c69be399">rb_add_method_cfunc</a>(klass, <a class="code" href="../../dc/dcc/array_8c.html#a9cfa42d4b79c89d68c53be8b2150a503">rb_intern</a>(name), <a class="code" href="../../dc/dd1/ossl__ssl_8c.html#a131c09b7f9c9a0b52e6f79f651cfd574">func</a>, argc, <a class="code" href="../../db/d0a/method_8h.html#a1e54ff32a6191e40451e1523c61ca439a0854498e40d4e26dd716a0ceba556439">NOEX_PROTECTED</a>);
<a name="l01215"></a>01215 }
<a name="l01216"></a>01216 
<a name="l01217"></a>01217 <span class="keywordtype">void</span>
<a name="l01218"></a><a class="code" href="../../d7/d19/group__defmethod.html#ga69c4f84891831d013e9e64972de90d78">01218</a> <a class="code" href="../../d7/d19/group__defmethod.html#ga69c4f84891831d013e9e64972de90d78">rb_define_private_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> klass, <span class="keyword">const</span> <span class="keywordtype">char</span> *name, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> (*<a class="code" href="../../dc/dd1/ossl__ssl_8c.html#a131c09b7f9c9a0b52e6f79f651cfd574">func</a>)(<a class="code" href="../../d8/db0/defines_8h.html#af4fd7cbafda9af704310f78516042dfb">ANYARGS</a>), <span class="keywordtype">int</span> argc)
<a name="l01219"></a>01219 {
<a name="l01220"></a>01220     <a class="code" href="../../db/d0a/method_8h.html#a60ad623f5610ed645f890af8c69be399">rb_add_method_cfunc</a>(klass, <a class="code" href="../../dc/dcc/array_8c.html#a9cfa42d4b79c89d68c53be8b2150a503">rb_intern</a>(name), <a class="code" href="../../dc/dd1/ossl__ssl_8c.html#a131c09b7f9c9a0b52e6f79f651cfd574">func</a>, argc, <a class="code" href="../../db/d0a/method_8h.html#a1e54ff32a6191e40451e1523c61ca439a155818970b18d63d59c83d22bc61803d">NOEX_PRIVATE</a>);
<a name="l01221"></a>01221 }
<a name="l01222"></a>01222 
<a name="l01223"></a>01223 <span class="keywordtype">void</span>
<a name="l01224"></a><a class="code" href="../../d7/d19/group__defmethod.html#ga879be4a71b806afb2854833fc1c45981">01224</a> <a class="code" href="../../d7/d19/group__defmethod.html#ga879be4a71b806afb2854833fc1c45981">rb_undef_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> klass, <span class="keyword">const</span> <span class="keywordtype">char</span> *name)
<a name="l01225"></a>01225 {
<a name="l01226"></a>01226     <a class="code" href="../../db/d0a/method_8h.html#af24b4bc2104eeb955b312d41bb492c5c">rb_add_method</a>(klass, <a class="code" href="../../dc/dcc/array_8c.html#a9cfa42d4b79c89d68c53be8b2150a503">rb_intern</a>(name), <a class="code" href="../../db/d0a/method_8h.html#a88a981f6cc69187ed9c2de2630a1687aaffd01b8301fa1cc0cbd6a6aca6583153">VM_METHOD_TYPE_UNDEF</a>, 0, <a class="code" href="../../db/d0a/method_8h.html#a1e54ff32a6191e40451e1523c61ca439a67eab9ddcfb8fc376407c923b8e2346d">NOEX_UNDEF</a>);
<a name="l01227"></a>01227 }
<a name="l01228"></a>01228 
<a name="l01237"></a><a class="code" href="../../de/ddf/group__class.html#ga6d96b170f195a70b4e66e8f5fde0639b">01237</a> <span class="preprocessor">#define SPECIAL_SINGLETON(x,c) do {\</span>
<a name="l01238"></a>01238 <span class="preprocessor">    if (obj == (x)) {\</span>
<a name="l01239"></a>01239 <span class="preprocessor">        return (c);\</span>
<a name="l01240"></a>01240 <span class="preprocessor">    }\</span>
<a name="l01241"></a>01241 <span class="preprocessor">} while (0)</span>
<a name="l01242"></a>01242 <span class="preprocessor"></span>
<a name="l01243"></a>01243 
<a name="l01253"></a>01253 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l01254"></a><a class="code" href="../../de/ddf/group__class.html#gae0c1e59b234de5f65b8c06b0ba263444">01254</a> <a class="code" href="../../de/ddf/group__class.html#gae0c1e59b234de5f65b8c06b0ba263444">singleton_class_of</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> obj)
<a name="l01255"></a>01255 {
<a name="l01256"></a>01256     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> klass;
<a name="l01257"></a>01257 
<a name="l01258"></a>01258     <span class="keywordflow">if</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#acf2fcf97dcf9c7c35452730eb3e2aeb2">FIXNUM_P</a>(obj) || <a class="code" href="../../dc/d0c/cparse_8c.html#a637bc5a232034ee3fd411f8bef091566">SYMBOL_P</a>(obj)) {
<a name="l01259"></a>01259         <a class="code" href="../../db/dcc/error_8c.html#a0f771a2840561f1838169b3d7d4616f3">rb_raise</a>(<a class="code" href="../../db/dcc/error_8c.html#a565ed9d70f4089e1b4a36e9b3381b8c6">rb_eTypeError</a>, <span class="stringliteral">&quot;can&apos;t define singleton&quot;</span>);
<a name="l01260"></a>01260     }
<a name="l01261"></a>01261     <span class="keywordflow">if</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a71420fb92a2a1c8a3af58c50dff37ccb">rb_special_const_p</a>(obj)) {
<a name="l01262"></a>01262         <a class="code" href="../../de/ddf/group__class.html#ga6d96b170f195a70b4e66e8f5fde0639b">SPECIAL_SINGLETON</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a320970f989dc8294c8203154e3db40c1">Qnil</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a0f70bd5031641d5e9ae42579b7527085">rb_cNilClass</a>);
<a name="l01263"></a>01263         <a class="code" href="../../de/ddf/group__class.html#ga6d96b170f195a70b4e66e8f5fde0639b">SPECIAL_SINGLETON</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#aba0717d2689eb68797421a02ab9295c6">Qfalse</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a7ef1aa70373f6097524f90851f71d304">rb_cFalseClass</a>);
<a name="l01264"></a>01264         <a class="code" href="../../de/ddf/group__class.html#ga6d96b170f195a70b4e66e8f5fde0639b">SPECIAL_SINGLETON</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#aacea3516b33941ce8149098e223a7466">Qtrue</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a047e3cef3a992aadc362f6a91c505e79">rb_cTrueClass</a>);
<a name="l01265"></a>01265         <a class="code" href="../../db/dcc/error_8c.html#a2d5fb28e54f792e7341b2c45f52f3860">rb_bug</a>(<span class="stringliteral">&quot;unknown immediate %p&quot;</span>, (<span class="keywordtype">void</span> *)obj);
<a name="l01266"></a>01266     }
<a name="l01267"></a>01267 
<a name="l01268"></a>01268     <span class="keywordflow">if</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a1ae918b6cc84188a9dc6ab545f732e4d">FL_TEST</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a1d4c05021aacd8cab989ff60f95ebe2d">RBASIC</a>(obj)-&gt;klass, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a081b5172ef37829bb3a258cd1ad393bc">FL_SINGLETON</a>) &amp;&amp;
<a name="l01269"></a>01269         <a class="code" href="../../db/d2e/intern_8h.html#a35a10b958666c1b330238eea7b7f3a8a">rb_ivar_get</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a1d4c05021aacd8cab989ff60f95ebe2d">RBASIC</a>(obj)-&gt;klass, <a class="code" href="../../de/ddf/group__class.html#gafd0c71501c641400fa9d557bd5cca7dd">id_attached</a>) == obj) {
<a name="l01270"></a>01270         klass = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a1d4c05021aacd8cab989ff60f95ebe2d">RBASIC</a>(obj)-&gt;klass;
<a name="l01271"></a>01271     }
<a name="l01272"></a>01272     <span class="keywordflow">else</span> {
<a name="l01273"></a>01273         klass = <a class="code" href="../../de/ddf/group__class.html#gaef068643bdd141d298acf0a0041d871a">rb_make_metaclass</a>(obj, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a1d4c05021aacd8cab989ff60f95ebe2d">RBASIC</a>(obj)-&gt;klass);
<a name="l01274"></a>01274     }
<a name="l01275"></a>01275 
<a name="l01276"></a>01276     <span class="keywordflow">if</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a621bc62b1fd82640c1078daf90e1c061">OBJ_TAINTED</a>(obj)) {
<a name="l01277"></a>01277         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#afd75ea0cb81c17e76c73e593d1d8a860">OBJ_TAINT</a>(klass);
<a name="l01278"></a>01278     }
<a name="l01279"></a>01279     <span class="keywordflow">else</span> {
<a name="l01280"></a>01280         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a6db7676c6cc4059a7cf021be34f53840">FL_UNSET</a>(klass, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aada6cee56453d224febc8a330e6bafdb">FL_TAINT</a>);
<a name="l01281"></a>01281     }
<a name="l01282"></a>01282     <span class="keywordflow">if</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a981ef70b505df85f89fba2b5c2d8b462">OBJ_UNTRUSTED</a>(obj)) {
<a name="l01283"></a>01283         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a745e96f2caf067a003f10eef662ea161">OBJ_UNTRUST</a>(klass);
<a name="l01284"></a>01284     }
<a name="l01285"></a>01285     <span class="keywordflow">else</span> {
<a name="l01286"></a>01286         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a6db7676c6cc4059a7cf021be34f53840">FL_UNSET</a>(klass, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a286c82e73243296cb52dafb7dae7ea70">FL_UNTRUSTED</a>);
<a name="l01287"></a>01287     }
<a name="l01288"></a>01288     <span class="keywordflow">if</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a73db79f74bad2fb5258a2ae7ee6ef117">OBJ_FROZEN</a>(obj)) <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a7ae8fa209abf837905d53c1c4be7c75d">OBJ_FREEZE</a>(klass);
<a name="l01289"></a>01289 
<a name="l01290"></a>01290     <span class="keywordflow">return</span> klass;
<a name="l01291"></a>01291 }
<a name="l01292"></a>01292 
<a name="l01293"></a>01293 
<a name="l01311"></a>01311 <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l01312"></a><a class="code" href="../../de/ddf/group__class.html#ga3778543a2798adab7bc12ed325c0b5d0">01312</a> <a class="code" href="../../de/ddf/group__class.html#ga3778543a2798adab7bc12ed325c0b5d0" title="Returns the singleton class of obj.">rb_singleton_class</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> obj)
<a name="l01313"></a>01313 {
<a name="l01314"></a>01314     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> klass = <a class="code" href="../../de/ddf/group__class.html#gae0c1e59b234de5f65b8c06b0ba263444">singleton_class_of</a>(obj);
<a name="l01315"></a>01315 
<a name="l01316"></a>01316     <span class="comment">/* ensures an exposed class belongs to its own eigenclass */</span>
<a name="l01317"></a>01317     <span class="keywordflow">if</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a394faf7191f18552a20cb17ce14226f0">TYPE</a>(obj) == <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ad04c63d175774c6d6e7dfaf0f0a982c9">T_CLASS</a>) (void)<a class="code" href="../../de/ddf/group__class.html#gacabc51ae26600f1bfeeba323e2bb734a" title="ensures klass belongs to its own eigenclass.">ENSURE_EIGENCLASS</a>(klass);
<a name="l01318"></a>01318 
<a name="l01319"></a>01319     <span class="keywordflow">return</span> klass;
<a name="l01320"></a>01320 }
<a name="l01321"></a>01321 
<a name="l01338"></a>01338 <span class="keywordtype">void</span>
<a name="l01339"></a><a class="code" href="../../d7/d19/group__defmethod.html#gaacfe6a2ec444bdc7f573afb75ea251fe">01339</a> <a class="code" href="../../d7/d19/group__defmethod.html#gaacfe6a2ec444bdc7f573afb75ea251fe" title="Defines a singleton method for obj.">rb_define_singleton_method</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> obj, <span class="keyword">const</span> <span class="keywordtype">char</span> *name, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> (*<a class="code" href="../../dc/dd1/ossl__ssl_8c.html#a131c09b7f9c9a0b52e6f79f651cfd574">func</a>)(<a class="code" href="../../d8/db0/defines_8h.html#af4fd7cbafda9af704310f78516042dfb">ANYARGS</a>), <span class="keywordtype">int</span> argc)
<a name="l01340"></a>01340 {
<a name="l01341"></a>01341     <a class="code" href="../../d7/d19/group__defmethod.html#ga118dc7abcdb97f56fe35727ac0ff6eb8">rb_define_method</a>(<a class="code" href="../../de/ddf/group__class.html#gae0c1e59b234de5f65b8c06b0ba263444">singleton_class_of</a>(obj), name, <a class="code" href="../../dc/dd1/ossl__ssl_8c.html#a131c09b7f9c9a0b52e6f79f651cfd574">func</a>, argc);
<a name="l01342"></a>01342 }
<a name="l01343"></a>01343 
<a name="l01344"></a>01344 
<a name="l01345"></a>01345 
<a name="l01353"></a>01353 <span class="keywordtype">void</span>
<a name="l01354"></a><a class="code" href="../../d7/d19/group__defmethod.html#gafc7122dde38ecff13de3e9d19a30aaeb">01354</a> <a class="code" href="../../d7/d19/group__defmethod.html#gafc7122dde38ecff13de3e9d19a30aaeb" title="Defines a module function for module.">rb_define_module_function</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> module, <span class="keyword">const</span> <span class="keywordtype">char</span> *name, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> (*<a class="code" href="../../dc/dd1/ossl__ssl_8c.html#a131c09b7f9c9a0b52e6f79f651cfd574">func</a>)(<a class="code" href="../../d8/db0/defines_8h.html#af4fd7cbafda9af704310f78516042dfb">ANYARGS</a>), <span class="keywordtype">int</span> argc)
<a name="l01355"></a>01355 {
<a name="l01356"></a>01356     <a class="code" href="../../d7/d19/group__defmethod.html#ga69c4f84891831d013e9e64972de90d78">rb_define_private_method</a>(module, name, <a class="code" href="../../dc/dd1/ossl__ssl_8c.html#a131c09b7f9c9a0b52e6f79f651cfd574">func</a>, argc);
<a name="l01357"></a>01357     <a class="code" href="../../d7/d19/group__defmethod.html#gaacfe6a2ec444bdc7f573afb75ea251fe" title="Defines a singleton method for obj.">rb_define_singleton_method</a>(module, name, <a class="code" href="../../dc/dd1/ossl__ssl_8c.html#a131c09b7f9c9a0b52e6f79f651cfd574">func</a>, argc);
<a name="l01358"></a>01358 }
<a name="l01359"></a>01359 
<a name="l01360"></a>01360 
<a name="l01367"></a>01367 <span class="keywordtype">void</span>
<a name="l01368"></a><a class="code" href="../../d7/d19/group__defmethod.html#gac08f58e00836e4e2586689e45b781bdd">01368</a> <a class="code" href="../../d7/d19/group__defmethod.html#gac08f58e00836e4e2586689e45b781bdd" title="Defines a global function.">rb_define_global_function</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *name, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> (*<a class="code" href="../../dc/dd1/ossl__ssl_8c.html#a131c09b7f9c9a0b52e6f79f651cfd574">func</a>)(<a class="code" href="../../d8/db0/defines_8h.html#af4fd7cbafda9af704310f78516042dfb">ANYARGS</a>), <span class="keywordtype">int</span> argc)
<a name="l01369"></a>01369 {
<a name="l01370"></a>01370     <a class="code" href="../../d7/d19/group__defmethod.html#gafc7122dde38ecff13de3e9d19a30aaeb" title="Defines a module function for module.">rb_define_module_function</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a2f79a80cd4cd92563255889fdcc303b8">rb_mKernel</a>, name, <a class="code" href="../../dc/dd1/ossl__ssl_8c.html#a131c09b7f9c9a0b52e6f79f651cfd574">func</a>, argc);
<a name="l01371"></a>01371 }
<a name="l01372"></a>01372 
<a name="l01373"></a>01373 
<a name="l01380"></a>01380 <span class="keywordtype">void</span>
<a name="l01381"></a><a class="code" href="../../d7/d19/group__defmethod.html#ga9ee2c97671d010bcb7a27614ab28bba7">01381</a> <a class="code" href="../../d7/d19/group__defmethod.html#ga9ee2c97671d010bcb7a27614ab28bba7" title="Defines an alias of a method.">rb_define_alias</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> klass, <span class="keyword">const</span> <span class="keywordtype">char</span> *name1, <span class="keyword">const</span> <span class="keywordtype">char</span> *name2)
<a name="l01382"></a>01382 {
<a name="l01383"></a>01383     <a class="code" href="../../db/d2e/intern_8h.html#a875565385e4542e217883aa78ede3a67">rb_alias</a>(klass, <a class="code" href="../../dc/dcc/array_8c.html#a9cfa42d4b79c89d68c53be8b2150a503">rb_intern</a>(name1), <a class="code" href="../../dc/dcc/array_8c.html#a9cfa42d4b79c89d68c53be8b2150a503">rb_intern</a>(name2));
<a name="l01384"></a>01384 }
<a name="l01385"></a>01385 
<a name="l01393"></a>01393 <span class="keywordtype">void</span>
<a name="l01394"></a><a class="code" href="../../d7/d19/group__defmethod.html#ga542cce18ec610115ba5b98c77def60d3">01394</a> <a class="code" href="../../d7/d19/group__defmethod.html#ga542cce18ec610115ba5b98c77def60d3" title="Defines (a) public accessor method(s) for an attribute.">rb_define_attr</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> klass, <span class="keyword">const</span> <span class="keywordtype">char</span> *name, <span class="keywordtype">int</span> read, <span class="keywordtype">int</span> write)
<a name="l01395"></a>01395 {
<a name="l01396"></a>01396     <a class="code" href="../../db/d2e/intern_8h.html#a187481b3db6f4bfb253eb0a4a4ee870e">rb_attr</a>(klass, <a class="code" href="../../dc/dcc/array_8c.html#a9cfa42d4b79c89d68c53be8b2150a503">rb_intern</a>(name), read, write, <a class="code" href="../../d1/d5c/nkf_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>);
<a name="l01397"></a>01397 }
<a name="l01398"></a>01398 
<a name="l01399"></a>01399 <span class="keywordtype">int</span>
<a name="l01400"></a><a class="code" href="../../d7/d19/group__defmethod.html#ga07effd5839c844d927a3261412203061">01400</a> <a class="code" href="../../d7/d19/group__defmethod.html#ga07effd5839c844d927a3261412203061">rb_obj_basic_to_s_p</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> obj)
<a name="l01401"></a>01401 {
<a name="l01402"></a>01402     <span class="keyword">const</span> <a class="code" href="../../d7/db7/structrb__method__entry__struct.html">rb_method_entry_t</a> *me = <a class="code" href="../../db/d0a/method_8h.html#af8cbec769b20978aec8c47c2291427cf">rb_method_entry</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#ad07df58de9895cbc33c10f02540d2d4d">CLASS_OF</a>(obj), <a class="code" href="../../dc/dcc/array_8c.html#a9cfa42d4b79c89d68c53be8b2150a503">rb_intern</a>(<span class="stringliteral">&quot;to_s&quot;</span>));
<a name="l01403"></a>01403     <span class="keywordflow">if</span> (me &amp;&amp; me-&gt;<a class="code" href="../../d7/db7/structrb__method__entry__struct.html#a6c868c50e67b757c6324dfef0f3184dc">def</a> &amp;&amp; me-&gt;<a class="code" href="../../d7/db7/structrb__method__entry__struct.html#a6c868c50e67b757c6324dfef0f3184dc">def</a>-&gt;<a class="code" href="../../d6/dab/structrb__method__definition__struct.html#a60ad63aa9037403df6e773853973c41b">type</a> == <a class="code" href="../../db/d0a/method_8h.html#a88a981f6cc69187ed9c2de2630a1687aa1691810af54507b018d2639b60e8057d">VM_METHOD_TYPE_CFUNC</a> &amp;&amp;
<a name="l01404"></a>01404         me-&gt;<a class="code" href="../../d7/db7/structrb__method__entry__struct.html#a6c868c50e67b757c6324dfef0f3184dc">def</a>-&gt;<a class="code" href="../../d6/dab/structrb__method__definition__struct.html#a83806aa27bac8990f4f9ce83377c76e7">body</a>.<a class="code" href="../../d6/dab/structrb__method__definition__struct.html#abd329358f778cc61d4983a63b33c587e">cfunc</a>.<a class="code" href="../../d1/d2e/structrb__method__cfunc__struct.html#abc3c1e8fd99d28baea5a83f749ab2f7a">func</a> == <a class="code" href="../../db/d2e/intern_8h.html#a24afa0db60cabea2fb47545b1ff9edf4">rb_any_to_s</a>)
<a name="l01405"></a>01405         <span class="keywordflow">return</span> 1;
<a name="l01406"></a>01406     <span class="keywordflow">return</span> 0;
<a name="l01407"></a>01407 }
<a name="l01408"></a>01408 
<a name="l01409"></a>01409 <span class="preprocessor">#include &lt;stdarg.h&gt;</span>
<a name="l01410"></a>01410 
<a name="l01411"></a>01411 <span class="keywordtype">int</span>
<a name="l01412"></a><a class="code" href="../../d7/d19/group__defmethod.html#gaa7bed88640f01bee619f85fda09d28d7">01412</a> <a class="code" href="../../d7/d19/group__defmethod.html#gaa7bed88640f01bee619f85fda09d28d7">rb_scan_args</a>(<span class="keywordtype">int</span> argc, <span class="keyword">const</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> *argv, <span class="keyword">const</span> <span class="keywordtype">char</span> *fmt, ...)
<a name="l01413"></a>01413 {
<a name="l01414"></a>01414     <span class="keywordtype">int</span> i;
<a name="l01415"></a>01415     <span class="keyword">const</span> <span class="keywordtype">char</span> *p = fmt;
<a name="l01416"></a>01416     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> *var;
<a name="l01417"></a>01417     va_list vargs;
<a name="l01418"></a>01418     <span class="keywordtype">int</span> f_var = 0, f_hash = 0, f_block = 0;
<a name="l01419"></a>01419     <span class="keywordtype">int</span> n_lead = 0, n_opt = 0, n_trail = 0, n_mand;
<a name="l01420"></a>01420     <span class="keywordtype">int</span> argi = 0;
<a name="l01421"></a>01421     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <a class="code" href="../../d3/deb/lex_8c.html#a5541f85ce416df233cce93949f0eeeca">hash</a> = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a320970f989dc8294c8203154e3db40c1">Qnil</a>;
<a name="l01422"></a>01422 
<a name="l01423"></a>01423     <span class="keywordflow">if</span> (<a class="code" href="../../d1/dcc/bignum_8c.html#ab615ddd0d086b80219cd7e0345d6b5ef">ISDIGIT</a>(*p)) {
<a name="l01424"></a>01424         n_lead = *p - <span class="charliteral">&apos;0&apos;</span>;
<a name="l01425"></a>01425         p++;
<a name="l01426"></a>01426         <span class="keywordflow">if</span> (<a class="code" href="../../d1/dcc/bignum_8c.html#ab615ddd0d086b80219cd7e0345d6b5ef">ISDIGIT</a>(*p)) {
<a name="l01427"></a>01427             n_opt = *p - <span class="charliteral">&apos;0&apos;</span>;
<a name="l01428"></a>01428             p++;
<a name="l01429"></a>01429             <span class="keywordflow">if</span> (<a class="code" href="../../d1/dcc/bignum_8c.html#ab615ddd0d086b80219cd7e0345d6b5ef">ISDIGIT</a>(*p)) {
<a name="l01430"></a>01430                 n_trail = *p - <span class="charliteral">&apos;0&apos;</span>;
<a name="l01431"></a>01431                 p++;
<a name="l01432"></a>01432                 <span class="keywordflow">goto</span> block_arg;
<a name="l01433"></a>01433             }
<a name="l01434"></a>01434         }
<a name="l01435"></a>01435     }
<a name="l01436"></a>01436     <span class="keywordflow">if</span> (*p == <span class="charliteral">&apos;*&apos;</span>) {
<a name="l01437"></a>01437         f_var = 1;
<a name="l01438"></a>01438         p++;
<a name="l01439"></a>01439         <span class="keywordflow">if</span> (<a class="code" href="../../d1/dcc/bignum_8c.html#ab615ddd0d086b80219cd7e0345d6b5ef">ISDIGIT</a>(*p)) {
<a name="l01440"></a>01440             n_trail = *p - <span class="charliteral">&apos;0&apos;</span>;
<a name="l01441"></a>01441             p++;
<a name="l01442"></a>01442         }
<a name="l01443"></a>01443     }
<a name="l01444"></a>01444   block_arg:
<a name="l01445"></a>01445     <span class="keywordflow">if</span> (*p == <span class="charliteral">&apos;:&apos;</span>) {
<a name="l01446"></a>01446         f_hash = 1;
<a name="l01447"></a>01447         p++;
<a name="l01448"></a>01448     }
<a name="l01449"></a>01449     <span class="keywordflow">if</span> (*p == <span class="charliteral">&apos;&amp;&apos;</span>) {
<a name="l01450"></a>01450         f_block = 1;
<a name="l01451"></a>01451         p++;
<a name="l01452"></a>01452     }
<a name="l01453"></a>01453     <span class="keywordflow">if</span> (*p != <span class="charliteral">&apos;\0&apos;</span>) {
<a name="l01454"></a>01454         <a class="code" href="../../db/dcc/error_8c.html#a643ceabe39fa1f8c99066a321397a115">rb_fatal</a>(<span class="stringliteral">&quot;bad scan arg format: %s&quot;</span>, fmt);
<a name="l01455"></a>01455     }
<a name="l01456"></a>01456     n_mand = n_lead + n_trail;
<a name="l01457"></a>01457 
<a name="l01458"></a>01458     <span class="keywordflow">if</span> (argc &lt; n_mand)
<a name="l01459"></a>01459         <span class="keywordflow">goto</span> argc_error;
<a name="l01460"></a>01460 
<a name="l01461"></a>01461     va_start(vargs, fmt);
<a name="l01462"></a>01462 
<a name="l01463"></a>01463     <span class="comment">/* capture an option hash - phase 1: pop */</span>
<a name="l01464"></a>01464     <span class="keywordflow">if</span> (f_hash &amp;&amp; n_mand &lt; argc) {
<a name="l01465"></a>01465         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <a class="code" href="../../d6/da0/nkf-utf8_2nkf_8c.html#ab0b853bc4e4e9658036bf7e604f398ad">last</a> = argv[argc - 1];
<a name="l01466"></a>01466 
<a name="l01467"></a>01467         <span class="keywordflow">if</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a4832bad8845a35fc50f7a160901854a1">NIL_P</a>(last)) {
<a name="l01468"></a>01468             <span class="comment">/* nil is taken as an empty option hash only if it is not</span>
<a name="l01469"></a>01469 <span class="comment">               ambiguous; i.e. &apos;*&apos; is not specified and arguments are</span>
<a name="l01470"></a>01470 <span class="comment">               given more than sufficient */</span>
<a name="l01471"></a>01471             <span class="keywordflow">if</span> (!f_var &amp;&amp; n_mand + n_opt &lt; argc)
<a name="l01472"></a>01472                 argc--;
<a name="l01473"></a>01473         }
<a name="l01474"></a>01474         <span class="keywordflow">else</span> {
<a name="l01475"></a>01475             hash = <a class="code" href="../../db/d2e/intern_8h.html#a16e59d05c8eb1641308bc1018c333cc1">rb_check_convert_type</a>(last, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a8357e81bbb60cb41b0a292a90653a5e5">T_HASH</a>, <span class="stringliteral">&quot;Hash&quot;</span>, <span class="stringliteral">&quot;to_hash&quot;</span>);
<a name="l01476"></a>01476             <span class="keywordflow">if</span> (!<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a4832bad8845a35fc50f7a160901854a1">NIL_P</a>(hash))
<a name="l01477"></a>01477                 argc--;
<a name="l01478"></a>01478         }
<a name="l01479"></a>01479     }
<a name="l01480"></a>01480     <span class="comment">/* capture leading mandatory arguments */</span>
<a name="l01481"></a>01481     <span class="keywordflow">for</span> (i = n_lead; i-- &gt; 0; ) {
<a name="l01482"></a>01482         var = va_arg(vargs, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> *);
<a name="l01483"></a>01483         <span class="keywordflow">if</span> (var) *var = argv[argi];
<a name="l01484"></a>01484         argi++;
<a name="l01485"></a>01485     }
<a name="l01486"></a>01486     <span class="comment">/* capture optional arguments */</span>
<a name="l01487"></a>01487     <span class="keywordflow">for</span> (i = n_opt; i-- &gt; 0; ) {
<a name="l01488"></a>01488         var = va_arg(vargs, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> *);
<a name="l01489"></a>01489         <span class="keywordflow">if</span> (argi &lt; argc - n_trail) {
<a name="l01490"></a>01490             <span class="keywordflow">if</span> (var) *var = argv[argi];
<a name="l01491"></a>01491             argi++;
<a name="l01492"></a>01492         }
<a name="l01493"></a>01493         <span class="keywordflow">else</span> {
<a name="l01494"></a>01494             <span class="keywordflow">if</span> (var) *var = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a320970f989dc8294c8203154e3db40c1">Qnil</a>;
<a name="l01495"></a>01495         }
<a name="l01496"></a>01496     }
<a name="l01497"></a>01497     <span class="comment">/* capture variable length arguments */</span>
<a name="l01498"></a>01498     <span class="keywordflow">if</span> (f_var) {
<a name="l01499"></a>01499         <span class="keywordtype">int</span> n_var = argc - argi - n_trail;
<a name="l01500"></a>01500 
<a name="l01501"></a>01501         var = va_arg(vargs, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> *);
<a name="l01502"></a>01502         <span class="keywordflow">if</span> (0 &lt; n_var) {
<a name="l01503"></a>01503             <span class="keywordflow">if</span> (var) *var = <a class="code" href="../../dc/dcc/array_8c.html#a575a99eebf6ce65893ed83c2b6783d2d">rb_ary_new4</a>(n_var, &amp;argv[argi]);
<a name="l01504"></a>01504             argi += n_var;
<a name="l01505"></a>01505         }
<a name="l01506"></a>01506         <span class="keywordflow">else</span> {
<a name="l01507"></a>01507             <span class="keywordflow">if</span> (var) *var = <a class="code" href="../../dc/dcc/array_8c.html#a9518114fd36cb4ef4656ec1dc63348c9">rb_ary_new</a>();
<a name="l01508"></a>01508         }
<a name="l01509"></a>01509     }
<a name="l01510"></a>01510     <span class="comment">/* capture trailing mandatory arguments */</span>
<a name="l01511"></a>01511     <span class="keywordflow">for</span> (i = n_trail; i-- &gt; 0; ) {
<a name="l01512"></a>01512         var = va_arg(vargs, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> *);
<a name="l01513"></a>01513         <span class="keywordflow">if</span> (var) *var = argv[argi];
<a name="l01514"></a>01514         argi++;
<a name="l01515"></a>01515     }
<a name="l01516"></a>01516     <span class="comment">/* capture an option hash - phase 2: assignment */</span>
<a name="l01517"></a>01517     <span class="keywordflow">if</span> (f_hash) {
<a name="l01518"></a>01518         var = va_arg(vargs, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> *);
<a name="l01519"></a>01519         <span class="keywordflow">if</span> (var) *var = hash;
<a name="l01520"></a>01520     }
<a name="l01521"></a>01521     <span class="comment">/* capture iterator block */</span>
<a name="l01522"></a>01522     <span class="keywordflow">if</span> (f_block) {
<a name="l01523"></a>01523         var = va_arg(vargs, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> *);
<a name="l01524"></a>01524         <span class="keywordflow">if</span> (<a class="code" href="../../d3/d57/eval_8c.html#aea346c4eb8bc06df88422e956bb05fec">rb_block_given_p</a>()) {
<a name="l01525"></a>01525             *var = <a class="code" href="../../db/d2e/intern_8h.html#a7b330d2905c5f0c9a68cef4ebba5c00f">rb_block_proc</a>();
<a name="l01526"></a>01526         }
<a name="l01527"></a>01527         <span class="keywordflow">else</span> {
<a name="l01528"></a>01528             *var = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a320970f989dc8294c8203154e3db40c1">Qnil</a>;
<a name="l01529"></a>01529         }
<a name="l01530"></a>01530     }
<a name="l01531"></a>01531     va_end(vargs);
<a name="l01532"></a>01532 
<a name="l01533"></a>01533     <span class="keywordflow">if</span> (argi &lt; argc)
<a name="l01534"></a>01534         <span class="keywordflow">goto</span> argc_error;
<a name="l01535"></a>01535 
<a name="l01536"></a>01536     <span class="keywordflow">return</span> argc;
<a name="l01537"></a>01537 
<a name="l01538"></a>01538   argc_error:
<a name="l01539"></a>01539     <span class="keywordflow">if</span> (0 &lt; n_opt)
<a name="l01540"></a>01540         <a class="code" href="../../db/dcc/error_8c.html#a0f771a2840561f1838169b3d7d4616f3">rb_raise</a>(<a class="code" href="../../db/dcc/error_8c.html#ab5e2a9fec766c75176fbb262bfe6a596">rb_eArgError</a>, <span class="stringliteral">&quot;wrong number of arguments (%d for %d..%d%s)&quot;</span>,
<a name="l01541"></a>01541                  argc, n_mand, n_mand + n_opt, f_var ? <span class="stringliteral">&quot;+&quot;</span> : <span class="stringliteral">&quot;&quot;</span>);
<a name="l01542"></a>01542     <span class="keywordflow">else</span>
<a name="l01543"></a>01543         <a class="code" href="../../db/dcc/error_8c.html#a0f771a2840561f1838169b3d7d4616f3">rb_raise</a>(<a class="code" href="../../db/dcc/error_8c.html#ab5e2a9fec766c75176fbb262bfe6a596">rb_eArgError</a>, <span class="stringliteral">&quot;wrong number of arguments (%d for %d%s)&quot;</span>,
<a name="l01544"></a>01544                  argc, n_mand, f_var ? <span class="stringliteral">&quot;+&quot;</span> : <span class="stringliteral">&quot;&quot;</span>);
<a name="l01545"></a>01545 }
<a name="l01546"></a>01546 
</pre></div></div>
<hr size="1"/><address style="text-align: right;"><small>Generated on 1 Mar 2013 for Ruby by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
