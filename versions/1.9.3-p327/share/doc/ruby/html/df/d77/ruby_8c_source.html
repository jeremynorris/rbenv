<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Ruby: ruby.c Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="../../index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="../../files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="../../globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<h1>ruby.c</h1><a href="../../df/d77/ruby_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/**********************************************************************</span>
<a name="l00002"></a>00002 <span class="comment"></span>
<a name="l00003"></a>00003 <span class="comment">  ruby.c -</span>
<a name="l00004"></a>00004 <span class="comment"></span>
<a name="l00005"></a>00005 <span class="comment">  $Author: usa $</span>
<a name="l00006"></a>00006 <span class="comment">  created at: Tue Aug 10 12:47:31 JST 1993</span>
<a name="l00007"></a>00007 <span class="comment"></span>
<a name="l00008"></a>00008 <span class="comment">  Copyright (C) 1993-2007 Yukihiro Matsumoto</span>
<a name="l00009"></a>00009 <span class="comment">  Copyright (C) 2000  Network Applied Communication Laboratory, Inc.</span>
<a name="l00010"></a>00010 <span class="comment">  Copyright (C) 2000  Information-technology Promotion Agency, Japan</span>
<a name="l00011"></a>00011 <span class="comment"></span>
<a name="l00012"></a>00012 <span class="comment">**********************************************************************/</span>
<a name="l00013"></a>00013 
<a name="l00014"></a>00014 <span class="preprocessor">#ifdef __CYGWIN__</span>
<a name="l00015"></a>00015 <span class="preprocessor"></span><span class="preprocessor">#include &lt;windows.h&gt;</span>
<a name="l00016"></a>00016 <span class="preprocessor">#include &lt;sys/cygwin.h&gt;</span>
<a name="l00017"></a>00017 <span class="preprocessor">#endif</span>
<a name="l00018"></a>00018 <span class="preprocessor"></span><span class="preprocessor">#include &quot;<a class="code" href="../../de/de6/ruby_2ruby_8h.html">ruby/ruby.h</a>&quot;</span>
<a name="l00019"></a>00019 <span class="preprocessor">#include &quot;<a class="code" href="../../d5/de3/encoding_8h.html">ruby/encoding.h</a>&quot;</span>
<a name="l00020"></a>00020 <span class="preprocessor">#include &quot;<a class="code" href="../../db/dde/internal_8h.html">internal.h</a>&quot;</span>
<a name="l00021"></a>00021 <span class="preprocessor">#include &quot;<a class="code" href="../../dd/dd0/eval__intern_8h.html">eval_intern.h</a>&quot;</span>
<a name="l00022"></a>00022 <span class="preprocessor">#include &quot;<a class="code" href="../../df/da8/dln_8h.html">dln.h</a>&quot;</span>
<a name="l00023"></a>00023 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
<a name="l00024"></a>00024 <span class="preprocessor">#include &lt;sys/types.h&gt;</span>
<a name="l00025"></a>00025 <span class="preprocessor">#include &lt;ctype.h&gt;</span>
<a name="l00026"></a>00026 
<a name="l00027"></a>00027 <span class="preprocessor">#ifdef __hpux</span>
<a name="l00028"></a>00028 <span class="preprocessor"></span><span class="preprocessor">#include &lt;sys/pstat.h&gt;</span>
<a name="l00029"></a>00029 <span class="preprocessor">#endif</span>
<a name="l00030"></a>00030 <span class="preprocessor"></span><span class="preprocessor">#if defined(LOAD_RELATIVE) &amp;&amp; defined(HAVE_DLADDR)</span>
<a name="l00031"></a>00031 <span class="preprocessor"></span><span class="preprocessor">#include &lt;dlfcn.h&gt;</span>
<a name="l00032"></a>00032 <span class="preprocessor">#endif</span>
<a name="l00033"></a>00033 <span class="preprocessor"></span>
<a name="l00034"></a>00034 <span class="preprocessor">#ifdef HAVE_UNISTD_H</span>
<a name="l00035"></a>00035 <span class="preprocessor"></span><span class="preprocessor">#include &lt;unistd.h&gt;</span>
<a name="l00036"></a>00036 <span class="preprocessor">#endif</span>
<a name="l00037"></a>00037 <span class="preprocessor"></span><span class="preprocessor">#if defined(HAVE_FCNTL_H)</span>
<a name="l00038"></a>00038 <span class="preprocessor"></span><span class="preprocessor">#include &lt;fcntl.h&gt;</span>
<a name="l00039"></a>00039 <span class="preprocessor">#elif defined(HAVE_SYS_FCNTL_H)</span>
<a name="l00040"></a>00040 <span class="preprocessor"></span><span class="preprocessor">#include &lt;sys/fcntl.h&gt;</span>
<a name="l00041"></a>00041 <span class="preprocessor">#endif</span>
<a name="l00042"></a>00042 <span class="preprocessor"></span><span class="preprocessor">#ifdef HAVE_SYS_PARAM_H</span>
<a name="l00043"></a>00043 <span class="preprocessor"></span><span class="preprocessor"># include &lt;sys/param.h&gt;</span>
<a name="l00044"></a>00044 <span class="preprocessor">#endif</span>
<a name="l00045"></a>00045 <span class="preprocessor"></span><span class="preprocessor">#ifndef MAXPATHLEN</span>
<a name="l00046"></a>00046 <span class="preprocessor"></span><span class="preprocessor"># define MAXPATHLEN 1024</span>
<a name="l00047"></a>00047 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00048"></a>00048 <span class="preprocessor"></span>
<a name="l00049"></a>00049 <span class="preprocessor">#include &quot;<a class="code" href="../../d8/d3c/util_8h.html">ruby/util.h</a>&quot;</span>
<a name="l00050"></a>00050 
<a name="l00051"></a>00051 <span class="preprocessor">#ifndef HAVE_STDLIB_H</span>
<a name="l00052"></a>00052 <span class="preprocessor"></span><span class="keywordtype">char</span> *<a class="code" href="../../de/d32/dir_8c.html#aee28fd8a0e40b6d958f7d20348e45368">getenv</a>();
<a name="l00053"></a>00053 <span class="preprocessor">#endif</span>
<a name="l00054"></a>00054 <span class="preprocessor"></span>
<a name="l00055"></a><a class="code" href="../../df/d77/ruby_8c.html#aa374558b5c6c7775e039a0b2cf9b4498">00055</a> <span class="preprocessor">#define DISABLE_BIT(bit) (1U &lt;&lt; disable_##bit)</span>
<a name="l00056"></a><a class="code" href="../../df/d77/ruby_8c.html#a4971dc860d1518ef5c14a5e6f5857020">00056</a> <span class="preprocessor"></span><span class="keyword">enum</span> <a class="code" href="../../df/d77/ruby_8c.html#a4971dc860d1518ef5c14a5e6f5857020">disable_flag_bits</a> {
<a name="l00057"></a><a class="code" href="../../df/d77/ruby_8c.html#a4971dc860d1518ef5c14a5e6f5857020a92d6cdddebdf595a439c7289fdc23c36">00057</a>     <a class="code" href="../../df/d77/ruby_8c.html#a4971dc860d1518ef5c14a5e6f5857020a92d6cdddebdf595a439c7289fdc23c36">disable_gems</a>,
<a name="l00058"></a><a class="code" href="../../df/d77/ruby_8c.html#a4971dc860d1518ef5c14a5e6f5857020a4d59beeba9ee3ecb86da44231c57b0c1">00058</a>     <a class="code" href="../../df/d77/ruby_8c.html#a4971dc860d1518ef5c14a5e6f5857020a4d59beeba9ee3ecb86da44231c57b0c1">disable_rubyopt</a>,
<a name="l00059"></a><a class="code" href="../../df/d77/ruby_8c.html#a4971dc860d1518ef5c14a5e6f5857020a6cbfd3f735006bf01a2d5ede6999c5b6">00059</a>     <a class="code" href="../../df/d77/ruby_8c.html#a4971dc860d1518ef5c14a5e6f5857020a6cbfd3f735006bf01a2d5ede6999c5b6">disable_flag_count</a>
<a name="l00060"></a>00060 };
<a name="l00061"></a>00061 
<a name="l00062"></a><a class="code" href="../../df/d77/ruby_8c.html#a407222be54393f7e01842b5d79c25f55">00062</a> <span class="preprocessor">#define DUMP_BIT(bit) (1U &lt;&lt; dump_##bit)</span>
<a name="l00063"></a><a class="code" href="../../df/d77/ruby_8c.html#a868fd61c8683c5e7e7072be6531a4f01">00063</a> <span class="preprocessor"></span><span class="keyword">enum</span> <a class="code" href="../../df/d77/ruby_8c.html#a868fd61c8683c5e7e7072be6531a4f01">dump_flag_bits</a> {
<a name="l00064"></a><a class="code" href="../../df/d77/ruby_8c.html#a868fd61c8683c5e7e7072be6531a4f01a8707219187b21abc6c0e3bfce97dab66">00064</a>     <a class="code" href="../../df/d77/ruby_8c.html#a868fd61c8683c5e7e7072be6531a4f01a8707219187b21abc6c0e3bfce97dab66">dump_version</a>,
<a name="l00065"></a><a class="code" href="../../df/d77/ruby_8c.html#a868fd61c8683c5e7e7072be6531a4f01ac1d121131db41ea732a8a388aadd7d63">00065</a>     <a class="code" href="../../df/d77/ruby_8c.html#a868fd61c8683c5e7e7072be6531a4f01ac1d121131db41ea732a8a388aadd7d63">dump_copyright</a>,
<a name="l00066"></a><a class="code" href="../../df/d77/ruby_8c.html#a868fd61c8683c5e7e7072be6531a4f01ac6e4a05579cba57a69e966e8906b0d28">00066</a>     <a class="code" href="../../df/d77/ruby_8c.html#a868fd61c8683c5e7e7072be6531a4f01ac6e4a05579cba57a69e966e8906b0d28">dump_usage</a>,
<a name="l00067"></a><a class="code" href="../../df/d77/ruby_8c.html#a868fd61c8683c5e7e7072be6531a4f01a72bf158f0cd1a0d3592f2644ad39dfe1">00067</a>     <a class="code" href="../../df/d77/ruby_8c.html#a868fd61c8683c5e7e7072be6531a4f01a72bf158f0cd1a0d3592f2644ad39dfe1">dump_yydebug</a>,
<a name="l00068"></a><a class="code" href="../../df/d77/ruby_8c.html#a868fd61c8683c5e7e7072be6531a4f01ae71fb9fdb311ebf99e089f059ca8f3e4">00068</a>     <a class="code" href="../../df/d77/ruby_8c.html#a868fd61c8683c5e7e7072be6531a4f01ae71fb9fdb311ebf99e089f059ca8f3e4">dump_syntax</a>,
<a name="l00069"></a><a class="code" href="../../df/d77/ruby_8c.html#a868fd61c8683c5e7e7072be6531a4f01a6bc4b6a3273d34bd774a3dd2ad34df8d">00069</a>     <a class="code" href="../../df/d77/ruby_8c.html#a868fd61c8683c5e7e7072be6531a4f01a6bc4b6a3273d34bd774a3dd2ad34df8d">dump_parsetree</a>,
<a name="l00070"></a><a class="code" href="../../df/d77/ruby_8c.html#a868fd61c8683c5e7e7072be6531a4f01a0b26dd7e3d5d8abd1269b53a4e4e3b20">00070</a>     <a class="code" href="../../df/d77/ruby_8c.html#a868fd61c8683c5e7e7072be6531a4f01a0b26dd7e3d5d8abd1269b53a4e4e3b20">dump_parsetree_with_comment</a>,
<a name="l00071"></a><a class="code" href="../../df/d77/ruby_8c.html#a868fd61c8683c5e7e7072be6531a4f01a3d994afa488a4728958c5310ee0a59b6">00071</a>     <a class="code" href="../../df/d77/ruby_8c.html#a868fd61c8683c5e7e7072be6531a4f01a3d994afa488a4728958c5310ee0a59b6">dump_insns</a>,
<a name="l00072"></a><a class="code" href="../../df/d77/ruby_8c.html#a868fd61c8683c5e7e7072be6531a4f01a8a1b57e6c1441d3de0079d47f86feb48">00072</a>     <a class="code" href="../../df/d77/ruby_8c.html#a868fd61c8683c5e7e7072be6531a4f01a8a1b57e6c1441d3de0079d47f86feb48">dump_flag_count</a>
<a name="l00073"></a>00073 };
<a name="l00074"></a>00074 
<a name="l00075"></a><a class="code" href="../../d1/de6/structcmdline__options.html">00075</a> <span class="keyword">struct </span><a class="code" href="../../d1/de6/structcmdline__options.html">cmdline_options</a> {
<a name="l00076"></a><a class="code" href="../../d1/de6/structcmdline__options.html#a7d125fcd6f16d94efa3cf072dda67b15">00076</a>     <span class="keywordtype">int</span> <a class="code" href="../../d1/de6/structcmdline__options.html#a8df7ebabf39c6f8ff518824676ff0395">sflag</a>, <a class="code" href="../../d1/de6/structcmdline__options.html#a7d125fcd6f16d94efa3cf072dda67b15">xflag</a>;
<a name="l00077"></a><a class="code" href="../../d1/de6/structcmdline__options.html#a6993432671b13016c14debd0588a6b9f">00077</a>     <span class="keywordtype">int</span> <a class="code" href="../../d1/de6/structcmdline__options.html#acba68d4bf70d3f90cc93c46b3818ebed">do_loop</a>, <a class="code" href="../../d1/de6/structcmdline__options.html#a6993432671b13016c14debd0588a6b9f">do_print</a>;
<a name="l00078"></a><a class="code" href="../../d1/de6/structcmdline__options.html#abdd2ce8657852f857e0877eb0fc38f6f">00078</a>     <span class="keywordtype">int</span> <a class="code" href="../../d1/de6/structcmdline__options.html#a65f1e5acac44a2b311f6dbe5c24ac802">do_line</a>, <a class="code" href="../../d1/de6/structcmdline__options.html#abdd2ce8657852f857e0877eb0fc38f6f">do_split</a>;
<a name="l00079"></a><a class="code" href="../../d1/de6/structcmdline__options.html#a407d9ebb05e6359600672c47f01b18db">00079</a>     <span class="keywordtype">int</span> <a class="code" href="../../d1/de6/structcmdline__options.html#a407d9ebb05e6359600672c47f01b18db">do_search</a>;
<a name="l00080"></a><a class="code" href="../../d1/de6/structcmdline__options.html#a43a59903d1fda92df5c8bf5fc27c880e">00080</a>     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../d1/de6/structcmdline__options.html#a43a59903d1fda92df5c8bf5fc27c880e">disable</a>;
<a name="l00081"></a><a class="code" href="../../d1/de6/structcmdline__options.html#a473a2d767a06b33c82cf4e5f4d3a41f8">00081</a>     <span class="keywordtype">int</span> <a class="code" href="../../d1/de6/structcmdline__options.html#a473a2d767a06b33c82cf4e5f4d3a41f8">verbose</a>;
<a name="l00082"></a><a class="code" href="../../d1/de6/structcmdline__options.html#a63be2eaa4c22858f34bda26de79a13c0">00082</a>     <span class="keywordtype">int</span> <a class="code" href="../../d1/de6/structcmdline__options.html#a63be2eaa4c22858f34bda26de79a13c0">safe_level</a>;
<a name="l00083"></a><a class="code" href="../../d1/de6/structcmdline__options.html#a1bea9e0943d0781170e1b6cb8c063384">00083</a>     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../d1/de6/structcmdline__options.html#a1bea9e0943d0781170e1b6cb8c063384">setids</a>;
<a name="l00084"></a><a class="code" href="../../d1/de6/structcmdline__options.html#a48863cb6a5e38f32ec34e0cc02aaf3df">00084</a>     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../d1/de6/structcmdline__options.html#a48863cb6a5e38f32ec34e0cc02aaf3df">dump</a>;
<a name="l00085"></a><a class="code" href="../../d1/de6/structcmdline__options.html#a450901fd25d06a98bbf8f6525a95d73f">00085</a>     <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d1/de6/structcmdline__options.html#a450901fd25d06a98bbf8f6525a95d73f">script</a>;
<a name="l00086"></a><a class="code" href="../../d1/de6/structcmdline__options.html#a97c2411913164ff54f0dcd8405c3a574">00086</a>     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <a class="code" href="../../d1/de6/structcmdline__options.html#a97c2411913164ff54f0dcd8405c3a574">script_name</a>;
<a name="l00087"></a><a class="code" href="../../d1/de6/structcmdline__options.html#a2e5ed539082d405a331e96b70283510c">00087</a>     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <a class="code" href="../../d1/de6/structcmdline__options.html#a2e5ed539082d405a331e96b70283510c">e_script</a>;
<a name="l00088"></a>00088     <span class="keyword">struct </span>{
<a name="l00089"></a>00089         <span class="keyword">struct </span>{
<a name="l00090"></a><a class="code" href="../../d1/de6/structcmdline__options.html#a3223277336458096fc1a733ddc07f727">00090</a>             <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <a class="code" href="../../d1/de6/structcmdline__options.html#a3223277336458096fc1a733ddc07f727">name</a>;
<a name="l00091"></a><a class="code" href="../../d1/de6/structcmdline__options.html#a2ab97d29aef2d3ef5379085b2514b1ed">00091</a>             <span class="keywordtype">int</span> <a class="code" href="../../d1/de6/structcmdline__options.html#a2ab97d29aef2d3ef5379085b2514b1ed">index</a>;
<a name="l00092"></a>00092         } <a class="code" href="../../d1/de6/structcmdline__options.html#a89ae067a92ade681a2ba731d8aa7bffc">enc</a>;
<a name="l00093"></a>00093     } <a class="code" href="../../d1/de6/structcmdline__options.html#a13f1f0d4bc385de1d92ac617f5fc8b2a">src</a>, <a class="code" href="../../d1/de6/structcmdline__options.html#ae4fff502bd9884529c1f31ab938a436c">ext</a>, <a class="code" href="../../d1/de6/structcmdline__options.html#acae7690c90303f7a134f0baf1ed8c5ed">intern</a>;
<a name="l00094"></a><a class="code" href="../../d1/de6/structcmdline__options.html#ab403f7b88211076cbc5cdaf54704857e">00094</a>     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <a class="code" href="../../d1/de6/structcmdline__options.html#ab403f7b88211076cbc5cdaf54704857e">req_list</a>;
<a name="l00095"></a>00095 };
<a name="l00096"></a>00096 
<a name="l00097"></a>00097 <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../df/d77/ruby_8c.html#a2feea1db78c18d02434974c51de2de06">init_ids</a>(<span class="keyword">struct</span> <a class="code" href="../../d1/de6/structcmdline__options.html">cmdline_options</a> *);
<a name="l00098"></a>00098 
<a name="l00099"></a><a class="code" href="../../df/d77/ruby_8c.html#a1f4b9ad71556f5bc1fb0ca4d4eab37de">00099</a> <span class="preprocessor">#define src_encoding_index GET_VM()-&gt;src_encoding_index</span>
<a name="l00100"></a>00100 <span class="preprocessor"></span>
<a name="l00101"></a>00101 <span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="../../d1/de6/structcmdline__options.html">cmdline_options</a> *
<a name="l00102"></a><a class="code" href="../../df/d77/ruby_8c.html#a0c4c26a222f55646d38ac62ce6ce6ae4">00102</a> <a class="code" href="../../df/d77/ruby_8c.html#a0c4c26a222f55646d38ac62ce6ce6ae4">cmdline_options_init</a>(<span class="keyword">struct</span> <a class="code" href="../../d1/de6/structcmdline__options.html">cmdline_options</a> *opt)
<a name="l00103"></a>00103 {
<a name="l00104"></a>00104     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a56d620b94b668ed7665d1616b2c54e48">MEMZERO</a>(opt, *opt, 1);
<a name="l00105"></a>00105     <a class="code" href="../../df/d77/ruby_8c.html#a2feea1db78c18d02434974c51de2de06">init_ids</a>(opt);
<a name="l00106"></a>00106     opt-&gt;<a class="code" href="../../d1/de6/structcmdline__options.html#a13f1f0d4bc385de1d92ac617f5fc8b2a">src</a>.<a class="code" href="../../d1/de6/structcmdline__options.html#a89ae067a92ade681a2ba731d8aa7bffc">enc</a>.index = <a class="code" href="../../df/d77/ruby_8c.html#a1f4b9ad71556f5bc1fb0ca4d4eab37de">src_encoding_index</a>;
<a name="l00107"></a>00107     opt-&gt;<a class="code" href="../../d1/de6/structcmdline__options.html#ae4fff502bd9884529c1f31ab938a436c">ext</a>.<a class="code" href="../../d1/de6/structcmdline__options.html#a89ae067a92ade681a2ba731d8aa7bffc">enc</a>.index = -1;
<a name="l00108"></a>00108     opt-&gt;<a class="code" href="../../d1/de6/structcmdline__options.html#acae7690c90303f7a134f0baf1ed8c5ed">intern</a>.<a class="code" href="../../d1/de6/structcmdline__options.html#a89ae067a92ade681a2ba731d8aa7bffc">enc</a>.index = -1;
<a name="l00109"></a>00109 <span class="preprocessor">#if defined DISABLE_RUBYGEMS &amp;&amp; DISABLE_RUBYGEMS</span>
<a name="l00110"></a>00110 <span class="preprocessor"></span>    opt-&gt;<a class="code" href="../../d1/de6/structcmdline__options.html#a43a59903d1fda92df5c8bf5fc27c880e">disable</a> |= <a class="code" href="../../df/d77/ruby_8c.html#aa374558b5c6c7775e039a0b2cf9b4498">DISABLE_BIT</a>(gems);
<a name="l00111"></a>00111 <span class="preprocessor">#endif</span>
<a name="l00112"></a>00112 <span class="preprocessor"></span>    <span class="keywordflow">return</span> opt;
<a name="l00113"></a>00113 }
<a name="l00114"></a>00114 
<a name="l00115"></a>00115 <span class="keyword">static</span> NODE *<a class="code" href="../../df/d77/ruby_8c.html#ab71b0792d7f66a50c862061a655aed6a">load_file</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *, <span class="keywordtype">int</span>, <span class="keyword">struct</span> <a class="code" href="../../d1/de6/structcmdline__options.html">cmdline_options</a> *);
<a name="l00116"></a>00116 <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../df/d77/ruby_8c.html#aefc30916c718aa484a9692900febed5b">forbid_setid</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *, <span class="keyword">struct</span> <a class="code" href="../../d1/de6/structcmdline__options.html">cmdline_options</a> *);
<a name="l00117"></a><a class="code" href="../../df/d77/ruby_8c.html#aefc30916c718aa484a9692900febed5b">00117</a> <span class="preprocessor">#define forbid_setid(s) forbid_setid((s), opt)</span>
<a name="l00118"></a>00118 <span class="preprocessor"></span>
<a name="l00119"></a>00119 <span class="keyword">static</span> <span class="keyword">struct </span>{
<a name="l00120"></a><a class="code" href="../../df/d77/ruby_8c.html#ad1447518f4372828b8435ae82e48499e">00120</a>     <span class="keywordtype">int</span> <a class="code" href="../../df/d77/ruby_8c.html#ad1447518f4372828b8435ae82e48499e">argc</a>;
<a name="l00121"></a><a class="code" href="../../df/d77/ruby_8c.html#af2efa898e9eed6fe6715279cb1ec35b0">00121</a>     <span class="keywordtype">char</span> **<a class="code" href="../../df/d77/ruby_8c.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>;
<a name="l00122"></a>00122 } <a class="code" href="../../df/d77/ruby_8c.html#a6c2ae3c3abc05179cb0a01ec5918b38a">origarg</a>;
<a name="l00123"></a>00123 
<a name="l00124"></a>00124 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00125"></a><a class="code" href="../../df/d77/ruby_8c.html#ab24984492570c9e0e802e45300d2eb82">00125</a> <a class="code" href="../../df/d77/ruby_8c.html#ab24984492570c9e0e802e45300d2eb82">usage</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d6/da0/nkf-utf8_2nkf_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>)
<a name="l00126"></a>00126 {
<a name="l00127"></a>00127     <span class="comment">/* This message really ought to be max 23 lines.</span>
<a name="l00128"></a>00128 <span class="comment">     * Removed -h because the user already knows that option. Others? */</span>
<a name="l00129"></a>00129 
<a name="l00130"></a>00130     <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *<span class="keyword">const</span> usage_msg[] = {
<a name="l00131"></a>00131         <span class="stringliteral">&quot;-0[octal]       specify record separator (\\0, if no argument)&quot;</span>,
<a name="l00132"></a>00132         <span class="stringliteral">&quot;-a              autosplit mode with -n or -p (splits $_ into $F)&quot;</span>,
<a name="l00133"></a>00133         <span class="stringliteral">&quot;-c              check syntax only&quot;</span>,
<a name="l00134"></a>00134         <span class="stringliteral">&quot;-Cdirectory     cd to directory, before executing your script&quot;</span>,
<a name="l00135"></a>00135         <span class="stringliteral">&quot;-d              set debugging flags (set $DEBUG to true)&quot;</span>,
<a name="l00136"></a>00136         <span class="stringliteral">&quot;-e &apos;command&apos;    one line of script. Several -e&apos;s allowed. Omit [programfile]&quot;</span>,
<a name="l00137"></a>00137         <span class="stringliteral">&quot;-Eex[:in]       specify the default external and internal character encodings&quot;</span>,
<a name="l00138"></a>00138         <span class="stringliteral">&quot;-Fpattern       split() pattern for autosplit (-a)&quot;</span>,
<a name="l00139"></a>00139         <span class="stringliteral">&quot;-i[extension]   edit ARGV files in place (make backup if extension supplied)&quot;</span>,
<a name="l00140"></a>00140         <span class="stringliteral">&quot;-Idirectory     specify $LOAD_PATH directory (may be used more than once)&quot;</span>,
<a name="l00141"></a>00141         <span class="stringliteral">&quot;-l              enable line ending processing&quot;</span>,
<a name="l00142"></a>00142         <span class="stringliteral">&quot;-n              assume &apos;while gets(); ... end&apos; loop around your script&quot;</span>,
<a name="l00143"></a>00143         <span class="stringliteral">&quot;-p              assume loop like -n but print line also like sed&quot;</span>,
<a name="l00144"></a>00144         <span class="stringliteral">&quot;-rlibrary       require the library, before executing your script&quot;</span>,
<a name="l00145"></a>00145         <span class="stringliteral">&quot;-s              enable some switch parsing for switches after script name&quot;</span>,
<a name="l00146"></a>00146         <span class="stringliteral">&quot;-S              look for the script using PATH environment variable&quot;</span>,
<a name="l00147"></a>00147         <span class="stringliteral">&quot;-T[level=1]     turn on tainting checks&quot;</span>,
<a name="l00148"></a>00148         <span class="stringliteral">&quot;-v              print version number, then turn on verbose mode&quot;</span>,
<a name="l00149"></a>00149         <span class="stringliteral">&quot;-w              turn warnings on for your script&quot;</span>,
<a name="l00150"></a>00150         <span class="stringliteral">&quot;-W[level=2]     set warning level; 0=silence, 1=medium, 2=verbose&quot;</span>,
<a name="l00151"></a>00151         <span class="stringliteral">&quot;-x[directory]   strip off text before #!ruby line and perhaps cd to directory&quot;</span>,
<a name="l00152"></a>00152         <span class="stringliteral">&quot;--copyright     print the copyright&quot;</span>,
<a name="l00153"></a>00153         <span class="stringliteral">&quot;--version       print the version&quot;</span>,
<a name="l00154"></a>00154         <a class="code" href="../../d3/d09/ripper_8y.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>
<a name="l00155"></a>00155     };
<a name="l00156"></a>00156     <span class="keyword">const</span> <span class="keywordtype">char</span> *<span class="keyword">const</span> *p = usage_msg;
<a name="l00157"></a>00157 
<a name="l00158"></a>00158     printf(<span class="stringliteral">&quot;Usage: %s [switches] [--] [programfile] [arguments]\n&quot;</span>, name);
<a name="l00159"></a>00159     <span class="keywordflow">while</span> (*p)
<a name="l00160"></a>00160         printf(<span class="stringliteral">&quot;  %s\n&quot;</span>, *p++);
<a name="l00161"></a>00161 }
<a name="l00162"></a>00162 
<a name="l00163"></a>00163 <span class="preprocessor">#ifdef MANGLED_PATH</span>
<a name="l00164"></a>00164 <span class="preprocessor"></span><span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l00165"></a>00165 <a class="code" href="../../df/d77/ruby_8c.html#a73161556d9968b27f8dcfd1b07ffbc40">rubylib_mangled_path</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *s, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> l)
<a name="l00166"></a>00166 {
<a name="l00167"></a>00167     <span class="keyword">static</span> <span class="keywordtype">char</span> *newp, *oldp;
<a name="l00168"></a>00168     <span class="keyword">static</span> <span class="keywordtype">int</span> newl, oldl, notfound;
<a name="l00169"></a>00169     <span class="keywordtype">char</span> *ptr;
<a name="l00170"></a>00170     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> ret;
<a name="l00171"></a>00171 
<a name="l00172"></a>00172     <span class="keywordflow">if</span> (!newp &amp;&amp; !notfound) {
<a name="l00173"></a>00173         newp = <a class="code" href="../../de/d32/dir_8c.html#aee28fd8a0e40b6d958f7d20348e45368">getenv</a>(<span class="stringliteral">&quot;RUBYLIB_PREFIX&quot;</span>);
<a name="l00174"></a>00174         <span class="keywordflow">if</span> (newp) {
<a name="l00175"></a>00175             oldp = newp = <a class="code" href="../../d8/d3c/util_8h.html#ad832104a69551cf1e4e347fffa9dc77c">strdup</a>(newp);
<a name="l00176"></a>00176             <span class="keywordflow">while</span> (*newp &amp;&amp; !<a class="code" href="../../de/de6/ruby_2ruby_8h.html#ae8cdc17e44905c826bddf416b7bf621c">ISSPACE</a>(*newp) &amp;&amp; *newp != <span class="charliteral">&apos;;&apos;</span>) {
<a name="l00177"></a>00177                 newp = <a class="code" href="../../dd/dd0/eval__intern_8h.html#a0892c4ab83ee67ec75cad2debdb5ddbb">CharNext</a>(newp);  <span class="comment">/* Skip digits. */</span>
<a name="l00178"></a>00178             }
<a name="l00179"></a>00179             oldl = newp - oldp;
<a name="l00180"></a>00180             <span class="keywordflow">while</span> (*newp &amp;&amp; (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#ae8cdc17e44905c826bddf416b7bf621c">ISSPACE</a>(*newp) || *newp == <span class="charliteral">&apos;;&apos;</span>)) {
<a name="l00181"></a>00181                 newp = <a class="code" href="../../dd/dd0/eval__intern_8h.html#a0892c4ab83ee67ec75cad2debdb5ddbb">CharNext</a>(newp);  <span class="comment">/* Skip whitespace. */</span>
<a name="l00182"></a>00182             }
<a name="l00183"></a>00183             newl = <a class="code" href="../../d6/d7b/strchr_8c.html#a219836f542ce53545052bed5353820ca">strlen</a>(newp);
<a name="l00184"></a>00184             <span class="keywordflow">if</span> (newl == 0 || oldl == 0) {
<a name="l00185"></a>00185                 <a class="code" href="../../db/dcc/error_8c.html#a643ceabe39fa1f8c99066a321397a115">rb_fatal</a>(<span class="stringliteral">&quot;malformed RUBYLIB_PREFIX&quot;</span>);
<a name="l00186"></a>00186             }
<a name="l00187"></a>00187             translit_char(newp, <span class="charliteral">&apos;\\&apos;</span>, <span class="charliteral">&apos;/&apos;</span>);
<a name="l00188"></a>00188         }
<a name="l00189"></a>00189         <span class="keywordflow">else</span> {
<a name="l00190"></a>00190             notfound = 1;
<a name="l00191"></a>00191         }
<a name="l00192"></a>00192     }
<a name="l00193"></a>00193     <span class="keywordflow">if</span> (!newp || l &lt; oldl || <a class="code" href="../../de/de6/ruby_2ruby_8h.html#afcd8c37e32c2bfc294617c5553cd1e3b">STRNCASECMP</a>(oldp, s, oldl) != 0) {
<a name="l00194"></a>00194         <span class="keywordflow">return</span> <a class="code" href="../../db/d2e/intern_8h.html#a48b2b873adb8b6a04254bd631c4b03c5">rb_str_new</a>(s, l);
<a name="l00195"></a>00195     }
<a name="l00196"></a>00196     ret = <a class="code" href="../../db/d2e/intern_8h.html#a48b2b873adb8b6a04254bd631c4b03c5">rb_str_new</a>(0, l + newl - oldl);
<a name="l00197"></a>00197     ptr = <a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(ret);
<a name="l00198"></a>00198     memcpy(ptr, newp, newl);
<a name="l00199"></a>00199     memcpy(ptr + newl, s + oldl, l - oldl);
<a name="l00200"></a>00200     ptr[l + newl - oldl] = 0;
<a name="l00201"></a>00201     <span class="keywordflow">return</span> ret;
<a name="l00202"></a>00202 }
<a name="l00203"></a>00203 <span class="preprocessor">#else</span>
<a name="l00204"></a><a class="code" href="../../df/d77/ruby_8c.html#a73161556d9968b27f8dcfd1b07ffbc40">00204</a> <span class="preprocessor"></span><span class="preprocessor">#define rubylib_mangled_path rb_str_new</span>
<a name="l00205"></a>00205 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00206"></a>00206 <span class="preprocessor"></span>
<a name="l00207"></a>00207 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00208"></a><a class="code" href="../../df/d77/ruby_8c.html#a6ba3081fbac40064f3ef017f71bd167c">00208</a> <a class="code" href="../../df/d77/ruby_8c.html#a6ba3081fbac40064f3ef017f71bd167c">push_include</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *path, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> (*filter)(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>))
<a name="l00209"></a>00209 {
<a name="l00210"></a>00210     <span class="keyword">const</span> <span class="keywordtype">char</span> sep = <a class="code" href="../../d8/db0/defines_8h.html#ab0fc36c269bc641cca53029f80a986a3">PATH_SEP_CHAR</a>;
<a name="l00211"></a>00211     <span class="keyword">const</span> <span class="keywordtype">char</span> *p, *s;
<a name="l00212"></a>00212     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> load_path = <a class="code" href="../../d8/d32/vm__core_8h.html#a6cfcd3997994924c8cd13c3b5c099ec6">GET_VM</a>()-&gt;load_path;
<a name="l00213"></a>00213 
<a name="l00214"></a>00214     p = path;
<a name="l00215"></a>00215     <span class="keywordflow">while</span> (*p) {
<a name="l00216"></a>00216         <span class="keywordflow">while</span> (*p == sep)
<a name="l00217"></a>00217             p++;
<a name="l00218"></a>00218         <span class="keywordflow">if</span> (!*p) <span class="keywordflow">break</span>;
<a name="l00219"></a>00219         <span class="keywordflow">for</span> (s = p; *s &amp;&amp; *s != sep; s = <a class="code" href="../../dd/dd0/eval__intern_8h.html#a0892c4ab83ee67ec75cad2debdb5ddbb">CharNext</a>(s));
<a name="l00220"></a>00220         <a class="code" href="../../dc/dcc/array_8c.html#a59d553a8cd781364b8bcb0deae25cca2">rb_ary_push</a>(load_path, (*filter)(<a class="code" href="../../df/d77/ruby_8c.html#a73161556d9968b27f8dcfd1b07ffbc40">rubylib_mangled_path</a>(p, s - p)));
<a name="l00221"></a>00221         p = s;
<a name="l00222"></a>00222     }
<a name="l00223"></a>00223 }
<a name="l00224"></a>00224 
<a name="l00225"></a>00225 <span class="preprocessor">#ifdef __CYGWIN__</span>
<a name="l00226"></a>00226 <span class="preprocessor"></span><span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00227"></a>00227 push_include_cygwin(<span class="keyword">const</span> <span class="keywordtype">char</span> *path, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> (*filter)(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>))
<a name="l00228"></a>00228 {
<a name="l00229"></a>00229     <span class="keyword">const</span> <span class="keywordtype">char</span> *p, *s;
<a name="l00230"></a>00230     <span class="keywordtype">char</span> rubylib[FILENAME_MAX];
<a name="l00231"></a>00231     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <a class="code" href="../../d6/da0/nkf-utf8_2nkf_8c.html#ac37f17a60c8b5533aac4840c681f62b8">buf</a> = 0;
<a name="l00232"></a>00232 
<a name="l00233"></a>00233     p = path;
<a name="l00234"></a>00234     <span class="keywordflow">while</span> (*p) {
<a name="l00235"></a>00235         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../d3/d15/name2ctype_8h.html#aed1cc4dca5d94cb452f79691f54f7423">len</a>;
<a name="l00236"></a>00236         <span class="keywordflow">while</span> (*p == <span class="charliteral">&apos;;&apos;</span>)
<a name="l00237"></a>00237             p++;
<a name="l00238"></a>00238         <span class="keywordflow">if</span> (!*p) <span class="keywordflow">break</span>;
<a name="l00239"></a>00239         <span class="keywordflow">for</span> (s = p; *s &amp;&amp; *s != <span class="charliteral">&apos;;&apos;</span>; s = <a class="code" href="../../dd/dd0/eval__intern_8h.html#a0892c4ab83ee67ec75cad2debdb5ddbb">CharNext</a>(s));
<a name="l00240"></a>00240         len = s - p;
<a name="l00241"></a>00241         <span class="keywordflow">if</span> (*s) {
<a name="l00242"></a>00242             <span class="keywordflow">if</span> (!buf) {
<a name="l00243"></a>00243                 buf = <a class="code" href="../../db/d2e/intern_8h.html#a48b2b873adb8b6a04254bd631c4b03c5">rb_str_new</a>(p, len);
<a name="l00244"></a>00244                 p = <a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(buf);
<a name="l00245"></a>00245             }
<a name="l00246"></a>00246             <span class="keywordflow">else</span> {
<a name="l00247"></a>00247                 <a class="code" href="../../db/d2e/intern_8h.html#a0a133856edb99f69eae3cb5a9e275ac9">rb_str_resize</a>(buf, len);
<a name="l00248"></a>00248                 p = strncpy(<a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(buf), p, len);
<a name="l00249"></a>00249             }
<a name="l00250"></a>00250         }
<a name="l00251"></a>00251 <span class="preprocessor">#ifdef HAVE_CYGWIN_CONV_PATH</span>
<a name="l00252"></a>00252 <span class="preprocessor"></span><span class="preprocessor">#define CONV_TO_POSIX_PATH(p, lib) \</span>
<a name="l00253"></a>00253 <span class="preprocessor">        cygwin_conv_path(CCP_WIN_A_TO_POSIX|CCP_RELATIVE, (p), (lib), sizeof(lib))</span>
<a name="l00254"></a>00254 <span class="preprocessor"></span><span class="preprocessor">#else</span>
<a name="l00255"></a>00255 <span class="preprocessor"></span><span class="preprocessor">#define CONV_TO_POSIX_PATH(p, lib) \</span>
<a name="l00256"></a>00256 <span class="preprocessor">        cygwin_conv_to_posix_path((p), (lib))</span>
<a name="l00257"></a>00257 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00258"></a>00258 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (CONV_TO_POSIX_PATH(p, rubylib) == 0)
<a name="l00259"></a>00259             p = rubylib;
<a name="l00260"></a>00260         <a class="code" href="../../df/d77/ruby_8c.html#a6ba3081fbac40064f3ef017f71bd167c">push_include</a>(p, filter);
<a name="l00261"></a>00261         <span class="keywordflow">if</span> (!*s) <span class="keywordflow">break</span>;
<a name="l00262"></a>00262         p = s + 1;
<a name="l00263"></a>00263     }
<a name="l00264"></a>00264 }
<a name="l00265"></a>00265 
<a name="l00266"></a>00266 <span class="preprocessor">#define push_include push_include_cygwin</span>
<a name="l00267"></a>00267 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00268"></a>00268 <span class="preprocessor"></span>
<a name="l00269"></a>00269 <span class="keywordtype">void</span>
<a name="l00270"></a><a class="code" href="../../df/d77/ruby_8c.html#ae8829b9dad88370a03681d1d83c1773f">00270</a> <a class="code" href="../../df/d77/ruby_8c.html#ae8829b9dad88370a03681d1d83c1773f">ruby_push_include</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *path, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> (*filter)(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>))
<a name="l00271"></a>00271 {
<a name="l00272"></a>00272     <span class="keywordflow">if</span> (path == 0)
<a name="l00273"></a>00273         <span class="keywordflow">return</span>;
<a name="l00274"></a>00274     <a class="code" href="../../df/d77/ruby_8c.html#a6ba3081fbac40064f3ef017f71bd167c">push_include</a>(path, filter);
<a name="l00275"></a>00275 }
<a name="l00276"></a>00276 
<a name="l00277"></a>00277 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l00278"></a><a class="code" href="../../df/d77/ruby_8c.html#a4509cc496ddb817ec264b66c9e1332e7">00278</a> <a class="code" href="../../df/d77/ruby_8c.html#a4509cc496ddb817ec264b66c9e1332e7">identical_path</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> path)
<a name="l00279"></a>00279 {
<a name="l00280"></a>00280     <span class="keywordflow">return</span> path;
<a name="l00281"></a>00281 }
<a name="l00282"></a>00282 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l00283"></a><a class="code" href="../../df/d77/ruby_8c.html#a63c6adcfa7d3a474a56040c9ddfa8284">00283</a> <a class="code" href="../../df/d77/ruby_8c.html#a63c6adcfa7d3a474a56040c9ddfa8284">locale_path</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> path)
<a name="l00284"></a>00284 {
<a name="l00285"></a>00285     <a class="code" href="../../d5/db5/encoding_8c.html#a150a6e3ac22ac3be8f8c2ccc74a28e7b">rb_enc_associate</a>(path, <a class="code" href="../../d5/db5/encoding_8c.html#a051d22249598e717317cb04798b3d76f">rb_locale_encoding</a>());
<a name="l00286"></a>00286     <span class="keywordflow">return</span> path;
<a name="l00287"></a>00287 }
<a name="l00288"></a>00288 
<a name="l00289"></a>00289 <span class="keywordtype">void</span>
<a name="l00290"></a><a class="code" href="../../df/d77/ruby_8c.html#aecf0e09547e1b869f20b694d1f84635d">00290</a> <a class="code" href="../../db/d2e/intern_8h.html#a396d18f1de73ca9b8f6a3896adb3067a">ruby_incpush</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *path)
<a name="l00291"></a>00291 {
<a name="l00292"></a>00292     <a class="code" href="../../df/d77/ruby_8c.html#ae8829b9dad88370a03681d1d83c1773f">ruby_push_include</a>(path, <a class="code" href="../../df/d77/ruby_8c.html#a63c6adcfa7d3a474a56040c9ddfa8284">locale_path</a>);
<a name="l00293"></a>00293 }
<a name="l00294"></a>00294 
<a name="l00295"></a>00295 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l00296"></a><a class="code" href="../../df/d77/ruby_8c.html#abc57354f8e2a8d8068c6515c5f33af1c">00296</a> <a class="code" href="../../df/d77/ruby_8c.html#abc57354f8e2a8d8068c6515c5f33af1c">expand_include_path</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> path)
<a name="l00297"></a>00297 {
<a name="l00298"></a>00298     <span class="keywordtype">char</span> *p = <a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(path);
<a name="l00299"></a>00299     <span class="keywordflow">if</span> (!p)
<a name="l00300"></a>00300         <span class="keywordflow">return</span> path;
<a name="l00301"></a>00301     <span class="keywordflow">if</span> (*p == <span class="charliteral">&apos;.&apos;</span> &amp;&amp; p[1] == <span class="charliteral">&apos;/&apos;</span>)
<a name="l00302"></a>00302         <span class="keywordflow">return</span> path;
<a name="l00303"></a>00303     <span class="keywordflow">return</span> <a class="code" href="../../d6/d13/file_8c.html#ae200206e89182156785625561ca4ce01">rb_file_expand_path</a>(path, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a320970f989dc8294c8203154e3db40c1">Qnil</a>);
<a name="l00304"></a>00304 }
<a name="l00305"></a>00305 
<a name="l00306"></a>00306 <span class="keywordtype">void</span>
<a name="l00307"></a><a class="code" href="../../df/d77/ruby_8c.html#a26ccecd2da26646a3ed21a57cfee0949">00307</a> <a class="code" href="../../df/d77/ruby_8c.html#a26ccecd2da26646a3ed21a57cfee0949">ruby_incpush_expand</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *path)
<a name="l00308"></a>00308 {
<a name="l00309"></a>00309     <a class="code" href="../../df/d77/ruby_8c.html#ae8829b9dad88370a03681d1d83c1773f">ruby_push_include</a>(path, <a class="code" href="../../df/d77/ruby_8c.html#abc57354f8e2a8d8068c6515c5f33af1c">expand_include_path</a>);
<a name="l00310"></a>00310 }
<a name="l00311"></a>00311 
<a name="l00312"></a>00312 <span class="preprocessor">#if defined _WIN32 || defined __CYGWIN__</span>
<a name="l00313"></a>00313 <span class="preprocessor"></span><span class="keyword">static</span> HMODULE libruby;
<a name="l00314"></a>00314 
<a name="l00315"></a>00315 BOOL WINAPI
<a name="l00316"></a>00316 DllMain(HINSTANCE dll, <a class="code" href="../../d2/d99/win32ole_8c.html#a2ec0aeb209eda20f4bef5d50ce5a7417">DWORD</a> reason, LPVOID reserved)
<a name="l00317"></a>00317 {
<a name="l00318"></a>00318     <span class="keywordflow">if</span> (reason == DLL_PROCESS_ATTACH)
<a name="l00319"></a>00319         libruby = dll;
<a name="l00320"></a>00320     <span class="keywordflow">return</span> <a class="code" href="../../d1/d5c/nkf_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00321"></a>00321 }
<a name="l00322"></a>00322 
<a name="l00323"></a>00323 HANDLE
<a name="l00324"></a>00324 rb_libruby_handle(<span class="keywordtype">void</span>)
<a name="l00325"></a>00325 {
<a name="l00326"></a>00326     <span class="keywordflow">return</span> libruby;
<a name="l00327"></a>00327 }
<a name="l00328"></a>00328 <span class="preprocessor">#endif</span>
<a name="l00329"></a>00329 <span class="preprocessor"></span>
<a name="l00330"></a>00330 <span class="keywordtype">void</span> <a class="code" href="../../df/d77/ruby_8c.html#a19244cb3740f96ae515f9c7d7cb5e9d6">ruby_init_loadpath_safe</a>(<span class="keywordtype">int</span> safe_level);
<a name="l00331"></a>00331 
<a name="l00332"></a>00332 <span class="keywordtype">void</span>
<a name="l00333"></a><a class="code" href="../../df/d77/ruby_8c.html#ab6a5ac6ba25ac697f5aef14f07f0f5d9">00333</a> <a class="code" href="../../db/d2e/intern_8h.html#ab6a5ac6ba25ac697f5aef14f07f0f5d9">ruby_init_loadpath</a>(<span class="keywordtype">void</span>)
<a name="l00334"></a>00334 {
<a name="l00335"></a>00335     <a class="code" href="../../df/d77/ruby_8c.html#a19244cb3740f96ae515f9c7d7cb5e9d6">ruby_init_loadpath_safe</a>(0);
<a name="l00336"></a>00336 }
<a name="l00337"></a>00337 
<a name="l00338"></a>00338 <span class="keywordtype">void</span>
<a name="l00339"></a><a class="code" href="../../df/d77/ruby_8c.html#a19244cb3740f96ae515f9c7d7cb5e9d6">00339</a> <a class="code" href="../../df/d77/ruby_8c.html#a19244cb3740f96ae515f9c7d7cb5e9d6">ruby_init_loadpath_safe</a>(<span class="keywordtype">int</span> safe_level)
<a name="l00340"></a>00340 {
<a name="l00341"></a>00341     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> load_path;
<a name="l00342"></a>00342     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#afa5b9137f051ac26d7ccc8824f178233">ID</a> id_initial_load_path_mark;
<a name="l00343"></a>00343     <span class="keyword">extern</span> <span class="keyword">const</span> <span class="keywordtype">char</span> <a class="code" href="../../d2/d0b/version_8c.html#a9aa977d38f8b8c26dd65feec9bcb2518">ruby_initial_load_paths</a>[];
<a name="l00344"></a>00344     <span class="keyword">const</span> <span class="keywordtype">char</span> *paths = ruby_initial_load_paths;
<a name="l00345"></a>00345 <span class="preprocessor">#if defined LOAD_RELATIVE</span>
<a name="l00346"></a>00346 <span class="preprocessor"></span><span class="preprocessor"># if defined HAVE_DLADDR || defined HAVE_CYGWIN_CONV_PATH</span>
<a name="l00347"></a>00347 <span class="preprocessor"></span><span class="preprocessor">#   define VARIABLE_LIBPATH 1</span>
<a name="l00348"></a>00348 <span class="preprocessor"></span><span class="preprocessor"># else</span>
<a name="l00349"></a>00349 <span class="preprocessor"></span><span class="preprocessor">#   define VARIABLE_LIBPATH 0</span>
<a name="l00350"></a>00350 <span class="preprocessor"></span><span class="preprocessor"># endif</span>
<a name="l00351"></a>00351 <span class="preprocessor"></span><span class="preprocessor"># if VARIABLE_LIBPATH</span>
<a name="l00352"></a>00352 <span class="preprocessor"></span>    <span class="keywordtype">char</span> *libpath;
<a name="l00353"></a>00353     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> sopath;
<a name="l00354"></a>00354 <span class="preprocessor"># else</span>
<a name="l00355"></a>00355 <span class="preprocessor"></span>    <span class="keywordtype">char</span> libpath[<a class="code" href="../../d1/ddc/dln_8c.html#addfa831c1473e710d2b71b72fd7fcfa5">MAXPATHLEN</a> + 1];
<a name="l00356"></a>00356 <span class="preprocessor"># endif</span>
<a name="l00357"></a>00357 <span class="preprocessor"></span>    <span class="keywordtype">size_t</span> baselen;
<a name="l00358"></a>00358     <span class="keywordtype">char</span> *p;
<a name="l00359"></a>00359 
<a name="l00360"></a>00360 <span class="preprocessor">#if defined _WIN32 || defined __CYGWIN__</span>
<a name="l00361"></a>00361 <span class="preprocessor"></span><span class="preprocessor"># if VARIABLE_LIBPATH</span>
<a name="l00362"></a>00362 <span class="preprocessor"></span>    sopath = <a class="code" href="../../db/d2e/intern_8h.html#a48b2b873adb8b6a04254bd631c4b03c5">rb_str_new</a>(0, <a class="code" href="../../d1/ddc/dln_8c.html#addfa831c1473e710d2b71b72fd7fcfa5">MAXPATHLEN</a>);
<a name="l00363"></a>00363     libpath = <a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(sopath);
<a name="l00364"></a>00364     GetModuleFileName(libruby, libpath, <a class="code" href="../../d1/ddc/dln_8c.html#addfa831c1473e710d2b71b72fd7fcfa5">MAXPATHLEN</a>);
<a name="l00365"></a>00365 <span class="preprocessor"># else</span>
<a name="l00366"></a>00366 <span class="preprocessor"></span>    GetModuleFileName(libruby, libpath, <span class="keyword">sizeof</span> libpath);
<a name="l00367"></a>00367 <span class="preprocessor"># endif</span>
<a name="l00368"></a>00368 <span class="preprocessor"></span><span class="preprocessor">#elif defined(__EMX__)</span>
<a name="l00369"></a>00369 <span class="preprocessor"></span>    _execname(libpath, <span class="keyword">sizeof</span>(libpath) - 1);
<a name="l00370"></a>00370 <span class="preprocessor">#elif defined(HAVE_DLADDR)</span>
<a name="l00371"></a>00371 <span class="preprocessor"></span>    Dl_info dli;
<a name="l00372"></a>00372     <span class="keywordflow">if</span> (dladdr((<span class="keywordtype">void</span> *)(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>)<a class="code" href="../../df/d77/ruby_8c.html#abc57354f8e2a8d8068c6515c5f33af1c">expand_include_path</a>, &amp;dli)) {
<a name="l00373"></a>00373         <span class="keywordtype">char</span> <a class="code" href="../../d7/d1e/dln__find_8c.html#ac5db579e4fad392fab4cc5f012c79f5f">fbuf</a>[<a class="code" href="../../d1/ddc/dln_8c.html#addfa831c1473e710d2b71b72fd7fcfa5">MAXPATHLEN</a>];
<a name="l00374"></a>00374         <span class="keywordtype">char</span> *f = <a class="code" href="../../df/da8/dln_8h.html#a3a0735a41dd1dc32a83eb1a3ac8eeb96">dln_find_file_r</a>(dli.dli_fname, <a class="code" href="../../de/d32/dir_8c.html#aee28fd8a0e40b6d958f7d20348e45368">getenv</a>(<a class="code" href="../../d8/db0/defines_8h.html#a1417bb0c04e21bbecda1d6738dbcbea3">PATH_ENV</a>), fbuf, <span class="keyword">sizeof</span>(fbuf));
<a name="l00375"></a>00375         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> fname = <a class="code" href="../../db/d2e/intern_8h.html#a2b9cc485b0aa1dc270744b8b9eb47569">rb_str_new_cstr</a>(f ? f : dli.dli_fname);
<a name="l00376"></a>00376         <a class="code" href="../../db/d2e/intern_8h.html#a086b740785459822cc7ca924430bd6d7">rb_str_freeze</a>(fname);
<a name="l00377"></a>00377         sopath = <a class="code" href="../../d6/d13/file_8c.html#af3eb55e0b3c427751ac2378fb07ad7ad">rb_realpath_internal</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a320970f989dc8294c8203154e3db40c1">Qnil</a>, fname, 1);
<a name="l00378"></a>00378     }
<a name="l00379"></a>00379     <span class="keywordflow">else</span> {
<a name="l00380"></a>00380         sopath = <a class="code" href="../../db/d2e/intern_8h.html#a48b2b873adb8b6a04254bd631c4b03c5">rb_str_new</a>(0, 0);
<a name="l00381"></a>00381     }
<a name="l00382"></a>00382     libpath = <a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(sopath);
<a name="l00383"></a>00383 <span class="preprocessor">#endif</span>
<a name="l00384"></a>00384 <span class="preprocessor"></span>
<a name="l00385"></a>00385 <span class="preprocessor">#if !VARIABLE_LIBPATH</span>
<a name="l00386"></a>00386 <span class="preprocessor"></span>    libpath[<span class="keyword">sizeof</span>(libpath) - 1] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l00387"></a>00387 <span class="preprocessor">#endif</span>
<a name="l00388"></a>00388 <span class="preprocessor"></span><span class="preprocessor">#if defined DOSISH</span>
<a name="l00389"></a>00389 <span class="preprocessor"></span>    translit_char(libpath, <span class="charliteral">&apos;\\&apos;</span>, <span class="charliteral">&apos;/&apos;</span>);
<a name="l00390"></a>00390 <span class="preprocessor">#elif defined __CYGWIN__</span>
<a name="l00391"></a>00391 <span class="preprocessor"></span>    {
<a name="l00392"></a>00392 <span class="preprocessor"># if VARIABLE_LIBPATH</span>
<a name="l00393"></a>00393 <span class="preprocessor"></span>        <span class="keyword">const</span> <span class="keywordtype">int</span> win_to_posix = CCP_WIN_A_TO_POSIX | CCP_RELATIVE;
<a name="l00394"></a>00394         <span class="keywordtype">size_t</span> newsize = cygwin_conv_path(win_to_posix, libpath, 0, 0);
<a name="l00395"></a>00395         <span class="keywordflow">if</span> (newsize &gt; 0) {
<a name="l00396"></a>00396             <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> rubylib = <a class="code" href="../../db/d2e/intern_8h.html#a48b2b873adb8b6a04254bd631c4b03c5">rb_str_new</a>(0, newsize);
<a name="l00397"></a>00397             p = <a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(rubylib);
<a name="l00398"></a>00398             <span class="keywordflow">if</span> (cygwin_conv_path(win_to_posix, libpath, p, newsize) == 0) {
<a name="l00399"></a>00399                 <a class="code" href="../../db/d2e/intern_8h.html#a0a133856edb99f69eae3cb5a9e275ac9">rb_str_resize</a>(sopath, 0);
<a name="l00400"></a>00400                 sopath = rubylib;
<a name="l00401"></a>00401                 libpath = p;
<a name="l00402"></a>00402             }
<a name="l00403"></a>00403         }
<a name="l00404"></a>00404 <span class="preprocessor"># else</span>
<a name="l00405"></a>00405 <span class="preprocessor"></span>        <span class="keywordtype">char</span> rubylib[FILENAME_MAX];
<a name="l00406"></a>00406         cygwin_conv_to_posix_path(libpath, rubylib);
<a name="l00407"></a>00407         strncpy(libpath, rubylib, <span class="keyword">sizeof</span>(libpath));
<a name="l00408"></a>00408 <span class="preprocessor"># endif</span>
<a name="l00409"></a>00409 <span class="preprocessor"></span>    }
<a name="l00410"></a>00410 <span class="preprocessor">#endif</span>
<a name="l00411"></a>00411 <span class="preprocessor"></span>    p = <a class="code" href="../../dd/dd0/eval__intern_8h.html#abe95d128538ae3fa3d09adfc0ef1b206">strrchr</a>(libpath, <span class="charliteral">&apos;/&apos;</span>);
<a name="l00412"></a>00412     <span class="keywordflow">if</span> (p) {
<a name="l00413"></a>00413         <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> bindir[] = <span class="stringliteral">&quot;/bin&quot;</span>;
<a name="l00414"></a>00414 <span class="preprocessor">#ifdef LIBDIR_BASENAME</span>
<a name="l00415"></a>00415 <span class="preprocessor"></span>        <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> libdir[] = <span class="stringliteral">&quot;/&quot;</span>LIBDIR_BASENAME;
<a name="l00416"></a>00416 <span class="preprocessor">#else</span>
<a name="l00417"></a>00417 <span class="preprocessor"></span>        <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> libdir[] = <span class="stringliteral">&quot;/lib&quot;</span>;
<a name="l00418"></a>00418 <span class="preprocessor">#endif</span>
<a name="l00419"></a>00419 <span class="preprocessor"></span>        <span class="keyword">const</span> ptrdiff_t bindir_len = (ptrdiff_t)<span class="keyword">sizeof</span>(bindir) - 1;
<a name="l00420"></a>00420         <span class="keyword">const</span> ptrdiff_t libdir_len = (ptrdiff_t)<span class="keyword">sizeof</span>(libdir) - 1;
<a name="l00421"></a>00421         *p = 0;
<a name="l00422"></a>00422         <span class="keywordflow">if</span> (p - libpath &gt;= bindir_len &amp;&amp; !<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a033ddb8804ee20a82e42e4153e7136f4">STRCASECMP</a>(p - bindir_len, bindir)) {
<a name="l00423"></a>00423             p -= bindir_len;
<a name="l00424"></a>00424             *p = 0;
<a name="l00425"></a>00425         }
<a name="l00426"></a>00426         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (p - libpath &gt;= libdir_len &amp;&amp; !<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a033ddb8804ee20a82e42e4153e7136f4">STRCASECMP</a>(p - libdir_len, libdir)) {
<a name="l00427"></a>00427             p -= libdir_len;
<a name="l00428"></a>00428             *p = 0;
<a name="l00429"></a>00429         }
<a name="l00430"></a>00430     }
<a name="l00431"></a>00431 <span class="preprocessor">#if !VARIABLE_LIBPATH</span>
<a name="l00432"></a>00432 <span class="preprocessor"></span>    <span class="keywordflow">else</span> {
<a name="l00433"></a>00433         <a class="code" href="../../d3/d90/missing_8h.html#ae18161b919a8cf237d27f8aac700d80c">strlcpy</a>(libpath, <span class="stringliteral">&quot;.&quot;</span>, <span class="keyword">sizeof</span>(libpath));
<a name="l00434"></a>00434         p = libpath + 1;
<a name="l00435"></a>00435     }
<a name="l00436"></a>00436     baselen = p - libpath;
<a name="l00437"></a>00437 <span class="preprocessor">#define PREFIX_PATH() rb_str_new(libpath, baselen)</span>
<a name="l00438"></a>00438 <span class="preprocessor"></span><span class="preprocessor">#else</span>
<a name="l00439"></a>00439 <span class="preprocessor"></span>    baselen = p - libpath;
<a name="l00440"></a>00440     <a class="code" href="../../db/d2e/intern_8h.html#a0a133856edb99f69eae3cb5a9e275ac9">rb_str_resize</a>(sopath, baselen);
<a name="l00441"></a>00441     libpath = <a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(sopath);
<a name="l00442"></a>00442 <span class="preprocessor">#define PREFIX_PATH() sopath</span>
<a name="l00443"></a>00443 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00444"></a>00444 <span class="preprocessor"></span>
<a name="l00445"></a>00445 <span class="preprocessor">#define BASEPATH() rb_str_buf_cat(rb_str_buf_new(baselen+len), libpath, baselen)</span>
<a name="l00446"></a>00446 <span class="preprocessor"></span>
<a name="l00447"></a>00447 <span class="preprocessor">#define RUBY_RELATIVE(path, len) rb_str_buf_cat(BASEPATH(), (path), (len))</span>
<a name="l00448"></a>00448 <span class="preprocessor"></span><span class="preprocessor">#else</span>
<a name="l00449"></a>00449 <span class="preprocessor"></span>    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> exec_prefix[] = RUBY_EXEC_PREFIX;
<a name="l00450"></a>00450 <span class="preprocessor">#define RUBY_RELATIVE(path, len) rubylib_mangled_path((path), (len))</span>
<a name="l00451"></a>00451 <span class="preprocessor"></span><span class="preprocessor">#define PREFIX_PATH() RUBY_RELATIVE(exec_prefix, sizeof(exec_prefix)-1)</span>
<a name="l00452"></a>00452 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00453"></a>00453 <span class="preprocessor"></span>    load_path = <a class="code" href="../../d8/d32/vm__core_8h.html#a6cfcd3997994924c8cd13c3b5c099ec6">GET_VM</a>()-&gt;load_path;
<a name="l00454"></a>00454 
<a name="l00455"></a>00455     <span class="keywordflow">if</span> (safe_level == 0) {
<a name="l00456"></a>00456 <span class="preprocessor">#ifdef MANGLED_PATH</span>
<a name="l00457"></a>00457 <span class="preprocessor"></span>        <a class="code" href="../../df/d77/ruby_8c.html#a73161556d9968b27f8dcfd1b07ffbc40">rubylib_mangled_path</a>(<span class="stringliteral">&quot;&quot;</span>, 0);
<a name="l00458"></a>00458 <span class="preprocessor">#endif</span>
<a name="l00459"></a>00459 <span class="preprocessor"></span>        <a class="code" href="../../df/d77/ruby_8c.html#ae8829b9dad88370a03681d1d83c1773f">ruby_push_include</a>(<a class="code" href="../../de/d32/dir_8c.html#aee28fd8a0e40b6d958f7d20348e45368">getenv</a>(<span class="stringliteral">&quot;RUBYLIB&quot;</span>), <a class="code" href="../../df/d77/ruby_8c.html#a4509cc496ddb817ec264b66c9e1332e7">identical_path</a>);
<a name="l00460"></a>00460     }
<a name="l00461"></a>00461 
<a name="l00462"></a>00462     id_initial_load_path_mark = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a5753547d6a21eeb36aa8cb0ae7d6c9ce">rb_intern_const</a>(<span class="stringliteral">&quot;@gem_prelude_index&quot;</span>);
<a name="l00463"></a>00463     <span class="keywordflow">while</span> (*paths) {
<a name="l00464"></a>00464         <span class="keywordtype">size_t</span> len = <a class="code" href="../../d6/d7b/strchr_8c.html#a219836f542ce53545052bed5353820ca">strlen</a>(paths);
<a name="l00465"></a>00465         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> path = <a class="code" href="../../df/d77/ruby_8c.html#a4e657449531edcb899deeb7960efba40">RUBY_RELATIVE</a>(paths, len);
<a name="l00466"></a>00466         <a class="code" href="../../db/d2e/intern_8h.html#acee88ad0375c8a9080e2283db494d257">rb_ivar_set</a>(path, id_initial_load_path_mark, path);
<a name="l00467"></a>00467         <a class="code" href="../../dc/dcc/array_8c.html#a59d553a8cd781364b8bcb0deae25cca2">rb_ary_push</a>(load_path, path);
<a name="l00468"></a>00468         paths += len + 1;
<a name="l00469"></a>00469     }
<a name="l00470"></a>00470 
<a name="l00471"></a>00471     <a class="code" href="../../db/d2e/intern_8h.html#aaa03be2caf9a365acc44c307dfda6430">rb_const_set</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a57c96ead3ef230b4838e65fe037c346e">rb_cObject</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a5753547d6a21eeb36aa8cb0ae7d6c9ce">rb_intern_const</a>(<span class="stringliteral">&quot;TMP_RUBY_PREFIX&quot;</span>), <a class="code" href="../../db/d2e/intern_8h.html#a8ea3742679211f408cb5769de6cf0d46">rb_obj_freeze</a>(<a class="code" href="../../df/d77/ruby_8c.html#af370987ffb93f1e4a7d764239be72a8d">PREFIX_PATH</a>()));
<a name="l00472"></a>00472 }
<a name="l00473"></a>00473 
<a name="l00474"></a>00474 
<a name="l00475"></a>00475 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00476"></a><a class="code" href="../../df/d77/ruby_8c.html#aef0c0e6850555aaaa055f5325d08f0c2">00476</a> <a class="code" href="../../df/d77/ruby_8c.html#aef0c0e6850555aaaa055f5325d08f0c2">add_modules</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> *req_list, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d1/d6f/date__strftime_8c.html#aa84d960185b18347956518e4d00766b4">mod</a>)
<a name="l00477"></a>00477 {
<a name="l00478"></a>00478     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <a class="code" href="../../d5/db5/encoding_8c.html#a05f70dacbe595d27364e1e014efb0c8e">list</a> = *req_list;
<a name="l00479"></a>00479     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> feature;
<a name="l00480"></a>00480 
<a name="l00481"></a>00481     <span class="keywordflow">if</span> (!list) {
<a name="l00482"></a>00482         *req_list = list = <a class="code" href="../../dc/dcc/array_8c.html#a9518114fd36cb4ef4656ec1dc63348c9">rb_ary_new</a>();
<a name="l00483"></a>00483         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a1d4c05021aacd8cab989ff60f95ebe2d">RBASIC</a>(list)-&gt;klass = 0;
<a name="l00484"></a>00484     }
<a name="l00485"></a>00485     feature = <a class="code" href="../../db/d2e/intern_8h.html#a03acd62c0b1edebbe1d61f957c19b7ac">rb_str_new2</a>(mod);
<a name="l00486"></a>00486     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a1d4c05021aacd8cab989ff60f95ebe2d">RBASIC</a>(feature)-&gt;klass = 0;
<a name="l00487"></a>00487     <a class="code" href="../../dc/dcc/array_8c.html#a59d553a8cd781364b8bcb0deae25cca2">rb_ary_push</a>(list, feature);
<a name="l00488"></a>00488 }
<a name="l00489"></a>00489 
<a name="l00490"></a>00490 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00491"></a><a class="code" href="../../df/d77/ruby_8c.html#a8c31193e63460680d46fbde2552c18ff">00491</a> <a class="code" href="../../df/d77/ruby_8c.html#a8c31193e63460680d46fbde2552c18ff">require_libraries</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> *req_list)
<a name="l00492"></a>00492 {
<a name="l00493"></a>00493     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <a class="code" href="../../d5/db5/encoding_8c.html#a05f70dacbe595d27364e1e014efb0c8e">list</a> = *req_list;
<a name="l00494"></a>00494     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <span class="keyword">self</span> = <a class="code" href="../../dd/dd0/eval__intern_8h.html#aa1fe1e87b9459fc45f42b15a0600611a">rb_vm_top_self</a>();
<a name="l00495"></a>00495     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#afa5b9137f051ac26d7ccc8824f178233">ID</a> require;
<a name="l00496"></a>00496     <a class="code" href="../../d2/d66/structrb__thread__struct.html">rb_thread_t</a> *th = <a class="code" href="../../d8/d32/vm__core_8h.html#a8deb84ec6023e3229db88ac2c9da6138">GET_THREAD</a>();
<a name="l00497"></a>00497     <a class="code" href="../../da/dc0/structrb__block__struct.html">rb_block_t</a> *prev_base_block = th-&gt;<a class="code" href="../../d2/d66/structrb__thread__struct.html#aad6cc8c9d9f511c12cca5af8c8aa6e77">base_block</a>;
<a name="l00498"></a>00498     <a class="code" href="../../d1/d7b/struct_onig_encoding_type_s_t.html">rb_encoding</a> *extenc = <a class="code" href="../../d5/db5/encoding_8c.html#a0724183879562529f7d3365ef5115b6d">rb_default_external_encoding</a>();
<a name="l00499"></a>00499     <span class="keywordtype">int</span> prev_parse_in_eval = th-&gt;<a class="code" href="../../d2/d66/structrb__thread__struct.html#aa6e324c4b5cb18a52b2631f190c7436e">parse_in_eval</a>;
<a name="l00500"></a>00500     th-&gt;<a class="code" href="../../d2/d66/structrb__thread__struct.html#aad6cc8c9d9f511c12cca5af8c8aa6e77">base_block</a> = 0;
<a name="l00501"></a>00501     th-&gt;<a class="code" href="../../d2/d66/structrb__thread__struct.html#aa6e324c4b5cb18a52b2631f190c7436e">parse_in_eval</a> = 0;
<a name="l00502"></a>00502 
<a name="l00503"></a>00503     <a class="code" href="../../d3/dfe/dmyext_8c.html#a7950db01edfb5beddf33ef6b78e880c9">Init_ext</a>();         <span class="comment">/* should be called here for some reason :-( */</span>
<a name="l00504"></a>00504     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aa50b9d5bc665eb5545f6857c89232161">CONST_ID</a>(require, <span class="stringliteral">&quot;require&quot;</span>);
<a name="l00505"></a>00505     <span class="keywordflow">while</span> (list &amp;&amp; <a class="code" href="../../d8/df4/generator_8h.html#ae988773ed219452578f881fc7189c486">RARRAY_LEN</a>(list) &gt; 0) {
<a name="l00506"></a>00506         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> feature = <a class="code" href="../../dc/dcc/array_8c.html#a2c4138c37c30471d4724bd8eee255a9d">rb_ary_shift</a>(list);
<a name="l00507"></a>00507         <a class="code" href="../../d5/db5/encoding_8c.html#a150a6e3ac22ac3be8f8c2ccc74a28e7b">rb_enc_associate</a>(feature, extenc);
<a name="l00508"></a>00508         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a1d4c05021aacd8cab989ff60f95ebe2d">RBASIC</a>(feature)-&gt;klass = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a7d36c9c3e9faa34c27eb7f2eb9c874a8">rb_cString</a>;
<a name="l00509"></a>00509         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a7ae8fa209abf837905d53c1c4be7c75d">OBJ_FREEZE</a>(feature);
<a name="l00510"></a>00510         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#adafa8fd17636821445380e7e1881355e" title="Calls a method.">rb_funcall2</a>(<span class="keyword">self</span>, require, 1, &amp;feature);
<a name="l00511"></a>00511     }
<a name="l00512"></a>00512     *req_list = 0;
<a name="l00513"></a>00513 
<a name="l00514"></a>00514     th-&gt;<a class="code" href="../../d2/d66/structrb__thread__struct.html#aa6e324c4b5cb18a52b2631f190c7436e">parse_in_eval</a> = prev_parse_in_eval;
<a name="l00515"></a>00515     th-&gt;<a class="code" href="../../d2/d66/structrb__thread__struct.html#aad6cc8c9d9f511c12cca5af8c8aa6e77">base_block</a> = prev_base_block;
<a name="l00516"></a>00516 }
<a name="l00517"></a>00517 
<a name="l00518"></a>00518 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00519"></a><a class="code" href="../../df/d77/ruby_8c.html#abe32a870ccd68ec109795cb329ddb084">00519</a> <a class="code" href="../../df/d77/ruby_8c.html#abe32a870ccd68ec109795cb329ddb084">process_sflag</a>(<span class="keywordtype">int</span> *sflag)
<a name="l00520"></a>00520 {
<a name="l00521"></a>00521     <span class="keywordflow">if</span> (*sflag &gt; 0) {
<a name="l00522"></a>00522         <span class="keywordtype">long</span> n;
<a name="l00523"></a>00523         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> *<a class="code" href="../../d3/d09/ripper_8y.html#a8187411843a6284ffb964ef3fb9fcab3">args</a>;
<a name="l00524"></a>00524         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <a class="code" href="../../df/d77/ruby_8c.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a> = <a class="code" href="../../db/d2e/intern_8h.html#afe9c34a341643ab37d8505e716e68c2a">rb_argv</a>;
<a name="l00525"></a>00525 
<a name="l00526"></a>00526         n = <a class="code" href="../../d8/df4/generator_8h.html#ae988773ed219452578f881fc7189c486">RARRAY_LEN</a>(argv);
<a name="l00527"></a>00527         args = <a class="code" href="../../d8/df4/generator_8h.html#abb794fe2d7c73eea87e7ba2273939a8e">RARRAY_PTR</a>(argv);
<a name="l00528"></a>00528         <span class="keywordflow">while</span> (n &gt; 0) {
<a name="l00529"></a>00529             <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> v = *args++;
<a name="l00530"></a>00530             <span class="keywordtype">char</span> *s = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a2665a51abbd5b49c15abff3df00fa9db">StringValuePtr</a>(v);
<a name="l00531"></a>00531             <span class="keywordtype">char</span> *p;
<a name="l00532"></a>00532             <span class="keywordtype">int</span> hyphen = <a class="code" href="../../d1/d5c/nkf_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00533"></a>00533 
<a name="l00534"></a>00534             <span class="keywordflow">if</span> (s[0] != <span class="charliteral">&apos;-&apos;</span>)
<a name="l00535"></a>00535                 <span class="keywordflow">break</span>;
<a name="l00536"></a>00536             n--;
<a name="l00537"></a>00537             <span class="keywordflow">if</span> (s[1] == <span class="charliteral">&apos;-&apos;</span> &amp;&amp; s[2] == <span class="charliteral">&apos;\0&apos;</span>)
<a name="l00538"></a>00538                 <span class="keywordflow">break</span>;
<a name="l00539"></a>00539 
<a name="l00540"></a>00540             v = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aacea3516b33941ce8149098e223a7466">Qtrue</a>;
<a name="l00541"></a>00541             <span class="comment">/* check if valid name before replacing - with _ */</span>
<a name="l00542"></a>00542             <span class="keywordflow">for</span> (p = s + 1; *p; p++) {
<a name="l00543"></a>00543                 <span class="keywordflow">if</span> (*p == <span class="charliteral">&apos;=&apos;</span>) {
<a name="l00544"></a>00544                     *p++ = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l00545"></a>00545                     v = <a class="code" href="../../db/d2e/intern_8h.html#a03acd62c0b1edebbe1d61f957c19b7ac">rb_str_new2</a>(p);
<a name="l00546"></a>00546                     <span class="keywordflow">break</span>;
<a name="l00547"></a>00547                 }
<a name="l00548"></a>00548                 <span class="keywordflow">if</span> (*p == <span class="charliteral">&apos;-&apos;</span>) {
<a name="l00549"></a>00549                     hyphen = <a class="code" href="../../d1/d5c/nkf_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00550"></a>00550                 }
<a name="l00551"></a>00551                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (*p != <span class="charliteral">&apos;_&apos;</span> &amp;&amp; !<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a8c0056118f585fa052e0f76e3198db6a">ISALNUM</a>(*p)) {
<a name="l00552"></a>00552                     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> name_error[2];
<a name="l00553"></a>00553                     name_error[0] =
<a name="l00554"></a>00554                         <a class="code" href="../../db/d2e/intern_8h.html#a03acd62c0b1edebbe1d61f957c19b7ac">rb_str_new2</a>(<span class="stringliteral">&quot;invalid name for global variable - &quot;</span>);
<a name="l00555"></a>00555                     <span class="keywordflow">if</span> (!(p = <a class="code" href="../../de/d32/dir_8c.html#a99c0c80536c9a3937814525bb5f8a7ad">strchr</a>(p, <span class="charliteral">&apos;=&apos;</span>))) {
<a name="l00556"></a>00556                         <a class="code" href="../../db/d2e/intern_8h.html#a5bd27db3e38af6131db24321c7cf9ec6">rb_str_cat2</a>(name_error[0], s);
<a name="l00557"></a>00557                     }
<a name="l00558"></a>00558                     <span class="keywordflow">else</span> {
<a name="l00559"></a>00559                         <a class="code" href="../../db/d2e/intern_8h.html#a4e3e3ccf959b5db6c125a68e1e1db0a3">rb_str_cat</a>(name_error[0], s, p - s);
<a name="l00560"></a>00560                     }
<a name="l00561"></a>00561                     name_error[1] = args[-1];
<a name="l00562"></a>00562                     <a class="code" href="../../d3/d57/eval_8c.html#a237939d28c83950b84fb6a45ccca53a0">rb_exc_raise</a>(<a class="code" href="../../db/d2e/intern_8h.html#a4e25a1a5ca0fc372179c4f429600bc2a">rb_class_new_instance</a>(2, name_error, <a class="code" href="../../db/dcc/error_8c.html#a83f38068d329a7f4e8e8687b00aa4062">rb_eNameError</a>));
<a name="l00563"></a>00563                 }
<a name="l00564"></a>00564             }
<a name="l00565"></a>00565             s[0] = <span class="charliteral">&apos;$&apos;</span>;
<a name="l00566"></a>00566             <span class="keywordflow">if</span> (hyphen) {
<a name="l00567"></a>00567                 <span class="keywordflow">for</span> (p = s + 1; *p; ++p) {
<a name="l00568"></a>00568                     <span class="keywordflow">if</span> (*p == <span class="charliteral">&apos;-&apos;</span>)
<a name="l00569"></a>00569                         *p = <span class="charliteral">&apos;_&apos;</span>;
<a name="l00570"></a>00570                 }
<a name="l00571"></a>00571             }
<a name="l00572"></a>00572             <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a35d050d4c8be4c1be5d9dd7df9a406a2">rb_gv_set</a>(s, v);
<a name="l00573"></a>00573         }
<a name="l00574"></a>00574         n = <a class="code" href="../../d8/df4/generator_8h.html#ae988773ed219452578f881fc7189c486">RARRAY_LEN</a>(argv) - n;
<a name="l00575"></a>00575         <span class="keywordflow">while</span> (n--) {
<a name="l00576"></a>00576             <a class="code" href="../../dc/dcc/array_8c.html#a2c4138c37c30471d4724bd8eee255a9d">rb_ary_shift</a>(argv);
<a name="l00577"></a>00577         }
<a name="l00578"></a>00578         *sflag = -1;
<a name="l00579"></a>00579     }
<a name="l00580"></a>00580 }
<a name="l00581"></a>00581 
<a name="l00582"></a>00582 <span class="keyword">static</span> <span class="keywordtype">long</span> <a class="code" href="../../df/d77/ruby_8c.html#ab4952e1c881356feb1c53006c25517b3">proc_options</a>(<span class="keywordtype">long</span> <a class="code" href="../../df/d77/ruby_8c.html#ad1447518f4372828b8435ae82e48499e">argc</a>, <span class="keywordtype">char</span> **<a class="code" href="../../df/d77/ruby_8c.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>, <span class="keyword">struct</span> <a class="code" href="../../d1/de6/structcmdline__options.html">cmdline_options</a> *opt, <span class="keywordtype">int</span> envopt);
<a name="l00583"></a>00583 
<a name="l00584"></a>00584 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00585"></a><a class="code" href="../../df/d77/ruby_8c.html#afa6e13329102453f3e95157a46485847">00585</a> <a class="code" href="../../df/d77/ruby_8c.html#afa6e13329102453f3e95157a46485847">moreswitches</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *s, <span class="keyword">struct</span> <a class="code" href="../../d1/de6/structcmdline__options.html">cmdline_options</a> *opt, <span class="keywordtype">int</span> envopt)
<a name="l00586"></a>00586 {
<a name="l00587"></a>00587     <span class="keywordtype">long</span> <a class="code" href="../../df/d77/ruby_8c.html#ad1447518f4372828b8435ae82e48499e">argc</a>, i, len;
<a name="l00588"></a>00588     <span class="keywordtype">char</span> **<a class="code" href="../../df/d77/ruby_8c.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>, *p;
<a name="l00589"></a>00589     <span class="keyword">const</span> <span class="keywordtype">char</span> *ap = 0;
<a name="l00590"></a>00590     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> argstr, argary;
<a name="l00591"></a>00591 
<a name="l00592"></a>00592     <span class="keywordflow">while</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#ae8cdc17e44905c826bddf416b7bf621c">ISSPACE</a>(*s)) s++;
<a name="l00593"></a>00593     <span class="keywordflow">if</span> (!*s) <span class="keywordflow">return</span>;
<a name="l00594"></a>00594     argstr = <a class="code" href="../../db/d2e/intern_8h.html#a9c93a5402138185ceff87cb1f483c4f5">rb_str_tmp_new</a>((len = <a class="code" href="../../d6/d7b/strchr_8c.html#a219836f542ce53545052bed5353820ca">strlen</a>(s)) + 2);
<a name="l00595"></a>00595     argary = <a class="code" href="../../db/d2e/intern_8h.html#a9c93a5402138185ceff87cb1f483c4f5">rb_str_tmp_new</a>(0);
<a name="l00596"></a>00596 
<a name="l00597"></a>00597     p = <a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(argstr);
<a name="l00598"></a>00598     *p++ = <span class="charliteral">&apos; &apos;</span>;
<a name="l00599"></a>00599     memcpy(p, s, len + 1);
<a name="l00600"></a>00600     ap = 0;
<a name="l00601"></a>00601     <a class="code" href="../../db/d2e/intern_8h.html#a4e3e3ccf959b5db6c125a68e1e1db0a3">rb_str_cat</a>(argary, (<span class="keywordtype">char</span> *)&amp;ap, <span class="keyword">sizeof</span>(ap));
<a name="l00602"></a>00602     <span class="keywordflow">while</span> (*p) {
<a name="l00603"></a>00603         ap = p;
<a name="l00604"></a>00604         <a class="code" href="../../db/d2e/intern_8h.html#a4e3e3ccf959b5db6c125a68e1e1db0a3">rb_str_cat</a>(argary, (<span class="keywordtype">char</span> *)&amp;ap, <span class="keyword">sizeof</span>(ap));
<a name="l00605"></a>00605         <span class="keywordflow">while</span> (*p &amp;&amp; !<a class="code" href="../../de/de6/ruby_2ruby_8h.html#ae8cdc17e44905c826bddf416b7bf621c">ISSPACE</a>(*p)) ++p;
<a name="l00606"></a>00606         <span class="keywordflow">if</span> (!*p) <span class="keywordflow">break</span>;
<a name="l00607"></a>00607         *p++ = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l00608"></a>00608         <span class="keywordflow">while</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#ae8cdc17e44905c826bddf416b7bf621c">ISSPACE</a>(*p)) ++p;
<a name="l00609"></a>00609     }
<a name="l00610"></a>00610     argc = <a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(argary) / <span class="keyword">sizeof</span>(ap);
<a name="l00611"></a>00611     ap = 0;
<a name="l00612"></a>00612     <a class="code" href="../../db/d2e/intern_8h.html#a4e3e3ccf959b5db6c125a68e1e1db0a3">rb_str_cat</a>(argary, (<span class="keywordtype">char</span> *)&amp;ap, <span class="keyword">sizeof</span>(ap));
<a name="l00613"></a>00613     argv = (<span class="keywordtype">char</span> **)<a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(argary);
<a name="l00614"></a>00614 
<a name="l00615"></a>00615     <span class="keywordflow">while</span> ((i = <a class="code" href="../../df/d77/ruby_8c.html#ab4952e1c881356feb1c53006c25517b3">proc_options</a>(argc, argv, opt, envopt)) &gt; 1 &amp;&amp; (argc -= i) &gt; 0) {
<a name="l00616"></a>00616         argv += i;
<a name="l00617"></a>00617         <span class="keywordflow">if</span> (**argv != <span class="charliteral">&apos;-&apos;</span>) {
<a name="l00618"></a>00618             *--*argv = <span class="charliteral">&apos;-&apos;</span>;
<a name="l00619"></a>00619         }
<a name="l00620"></a>00620         <span class="keywordflow">if</span> ((*argv)[1]) {
<a name="l00621"></a>00621             ++argc;
<a name="l00622"></a>00622             --argv;
<a name="l00623"></a>00623         }
<a name="l00624"></a>00624     }
<a name="l00625"></a>00625 
<a name="l00626"></a>00626     <span class="comment">/* get rid of GC */</span>
<a name="l00627"></a>00627     <a class="code" href="../../db/d2e/intern_8h.html#a0a133856edb99f69eae3cb5a9e275ac9">rb_str_resize</a>(argary, 0);
<a name="l00628"></a>00628     <a class="code" href="../../db/d2e/intern_8h.html#a0a133856edb99f69eae3cb5a9e275ac9">rb_str_resize</a>(argstr, 0);
<a name="l00629"></a>00629 }
<a name="l00630"></a>00630 
<a name="l00631"></a><a class="code" href="../../df/d77/ruby_8c.html#a903450f8b3b911602aae0fc8fd9cfbc5">00631</a> <span class="preprocessor">#define NAME_MATCH_P(name, str, len) \</span>
<a name="l00632"></a>00632 <span class="preprocessor">    ((len) &lt; (int)sizeof(name) &amp;&amp; strncmp((str), (name), (len)) == 0)</span>
<a name="l00633"></a>00633 <span class="preprocessor"></span>
<a name="l00634"></a><a class="code" href="../../df/d77/ruby_8c.html#aac4308a63edfea5bcb8be0264b977f03">00634</a> <span class="preprocessor">#define UNSET_WHEN(name, bit, str, len) \</span>
<a name="l00635"></a>00635 <span class="preprocessor">    if (NAME_MATCH_P((name), (str), (len))) { \</span>
<a name="l00636"></a>00636 <span class="preprocessor">        *(unsigned int *)arg &amp;= ~(bit); \</span>
<a name="l00637"></a>00637 <span class="preprocessor">        return;                         \</span>
<a name="l00638"></a>00638 <span class="preprocessor">    }</span>
<a name="l00639"></a>00639 <span class="preprocessor"></span>
<a name="l00640"></a><a class="code" href="../../df/d77/ruby_8c.html#afa56b782a9aa19befc22dcf2ddecdf5e">00640</a> <span class="preprocessor">#define SET_WHEN(name, bit, str, len)   \</span>
<a name="l00641"></a>00641 <span class="preprocessor">    if (NAME_MATCH_P((name), (str), (len))) { \</span>
<a name="l00642"></a>00642 <span class="preprocessor">        *(unsigned int *)arg |= (bit);  \</span>
<a name="l00643"></a>00643 <span class="preprocessor">        return;                         \</span>
<a name="l00644"></a>00644 <span class="preprocessor">    }</span>
<a name="l00645"></a>00645 <span class="preprocessor"></span>
<a name="l00646"></a>00646 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00647"></a><a class="code" href="../../df/d77/ruby_8c.html#a328d0c718cdb3462aabcafd6ffd35be5">00647</a> <a class="code" href="../../df/d77/ruby_8c.html#a328d0c718cdb3462aabcafd6ffd35be5">enable_option</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *str, <span class="keywordtype">int</span> len, <span class="keywordtype">void</span> *arg)
<a name="l00648"></a>00648 {
<a name="l00649"></a>00649 <span class="preprocessor">#define UNSET_WHEN_DISABLE(bit) UNSET_WHEN(#bit, DISABLE_BIT(bit), str, len)</span>
<a name="l00650"></a>00650 <span class="preprocessor"></span>    <a class="code" href="../../df/d77/ruby_8c.html#a8c10f7c42c043ac1cd7fc088e88f4d97">UNSET_WHEN_DISABLE</a>(gems);
<a name="l00651"></a>00651     <a class="code" href="../../df/d77/ruby_8c.html#a8c10f7c42c043ac1cd7fc088e88f4d97">UNSET_WHEN_DISABLE</a>(rubyopt);
<a name="l00652"></a>00652     <span class="keywordflow">if</span> (<a class="code" href="../../df/d77/ruby_8c.html#a903450f8b3b911602aae0fc8fd9cfbc5">NAME_MATCH_P</a>(<span class="stringliteral">&quot;all&quot;</span>, str, len)) {
<a name="l00653"></a>00653         *(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> *)arg = 0<a class="code" href="../../d9/db2/union_u.html">U</a>;
<a name="l00654"></a>00654         <span class="keywordflow">return</span>;
<a name="l00655"></a>00655     }
<a name="l00656"></a>00656     <a class="code" href="../../db/dcc/error_8c.html#aa5b1972d475e9a090c8ef607ce033008">rb_warn</a>(<span class="stringliteral">&quot;unknown argument for --enable: `%.*s&apos;&quot;</span>, len, str);
<a name="l00657"></a>00657 }
<a name="l00658"></a>00658 
<a name="l00659"></a>00659 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00660"></a><a class="code" href="../../df/d77/ruby_8c.html#a0e1fc2982497b434a99d1785b9214fe6">00660</a> <a class="code" href="../../df/d77/ruby_8c.html#a0e1fc2982497b434a99d1785b9214fe6">disable_option</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *str, <span class="keywordtype">int</span> len, <span class="keywordtype">void</span> *arg)
<a name="l00661"></a>00661 {
<a name="l00662"></a>00662 <span class="preprocessor">#define SET_WHEN_DISABLE(bit) SET_WHEN(#bit, DISABLE_BIT(bit), str, len)</span>
<a name="l00663"></a>00663 <span class="preprocessor"></span>    <a class="code" href="../../df/d77/ruby_8c.html#ab55ffa81aaa27faf151d84feaa179974">SET_WHEN_DISABLE</a>(gems);
<a name="l00664"></a>00664     <a class="code" href="../../df/d77/ruby_8c.html#ab55ffa81aaa27faf151d84feaa179974">SET_WHEN_DISABLE</a>(rubyopt);
<a name="l00665"></a>00665     <span class="keywordflow">if</span> (<a class="code" href="../../df/d77/ruby_8c.html#a903450f8b3b911602aae0fc8fd9cfbc5">NAME_MATCH_P</a>(<span class="stringliteral">&quot;all&quot;</span>, str, len)) {
<a name="l00666"></a>00666         *(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> *)arg = ~0<a class="code" href="../../d9/db2/union_u.html">U</a>;
<a name="l00667"></a>00667         <span class="keywordflow">return</span>;
<a name="l00668"></a>00668     }
<a name="l00669"></a>00669     <a class="code" href="../../db/dcc/error_8c.html#aa5b1972d475e9a090c8ef607ce033008">rb_warn</a>(<span class="stringliteral">&quot;unknown argument for --disable: `%.*s&apos;&quot;</span>, len, str);
<a name="l00670"></a>00670 }
<a name="l00671"></a>00671 
<a name="l00672"></a>00672 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00673"></a><a class="code" href="../../df/d77/ruby_8c.html#a81c13867a601b1a9f7e605c8f50f84ac">00673</a> <a class="code" href="../../df/d77/ruby_8c.html#a81c13867a601b1a9f7e605c8f50f84ac">dump_option</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *str, <span class="keywordtype">int</span> len, <span class="keywordtype">void</span> *arg)
<a name="l00674"></a>00674 {
<a name="l00675"></a>00675 <span class="preprocessor">#define SET_WHEN_DUMP(bit) SET_WHEN(#bit, DUMP_BIT(bit), str, len)</span>
<a name="l00676"></a>00676 <span class="preprocessor"></span>    <a class="code" href="../../df/d77/ruby_8c.html#aaa18ffcb502846d6bcc5fb1484309e2e">SET_WHEN_DUMP</a>(<a class="code" href="../../d6/da0/nkf-utf8_2nkf_8c.html#a4fbbbc8d035c85ce83c6f270a2e56012">version</a>);
<a name="l00677"></a>00677     <a class="code" href="../../df/d77/ruby_8c.html#aaa18ffcb502846d6bcc5fb1484309e2e">SET_WHEN_DUMP</a>(copyright);
<a name="l00678"></a>00678     <a class="code" href="../../df/d77/ruby_8c.html#aaa18ffcb502846d6bcc5fb1484309e2e">SET_WHEN_DUMP</a>(<a class="code" href="../../df/d77/ruby_8c.html#ab24984492570c9e0e802e45300d2eb82">usage</a>);
<a name="l00679"></a>00679     <a class="code" href="../../df/d77/ruby_8c.html#aaa18ffcb502846d6bcc5fb1484309e2e">SET_WHEN_DUMP</a>(<a class="code" href="../../d5/d11/ripper_8c.html#a7fde6236fcb0f6e5d1d20ce98d9f0d01">yydebug</a>);
<a name="l00680"></a>00680     <a class="code" href="../../df/d77/ruby_8c.html#aaa18ffcb502846d6bcc5fb1484309e2e">SET_WHEN_DUMP</a>(syntax);
<a name="l00681"></a>00681     <a class="code" href="../../df/d77/ruby_8c.html#aaa18ffcb502846d6bcc5fb1484309e2e">SET_WHEN_DUMP</a>(parsetree);
<a name="l00682"></a>00682     <a class="code" href="../../df/d77/ruby_8c.html#aaa18ffcb502846d6bcc5fb1484309e2e">SET_WHEN_DUMP</a>(parsetree_with_comment);
<a name="l00683"></a>00683     <a class="code" href="../../df/d77/ruby_8c.html#aaa18ffcb502846d6bcc5fb1484309e2e">SET_WHEN_DUMP</a>(insns);
<a name="l00684"></a>00684     <a class="code" href="../../db/dcc/error_8c.html#aa5b1972d475e9a090c8ef607ce033008">rb_warn</a>(<span class="stringliteral">&quot;don&apos;t know how to dump `%.*s&apos;,&quot;</span>, len, str);
<a name="l00685"></a>00685     <a class="code" href="../../db/dcc/error_8c.html#aa5b1972d475e9a090c8ef607ce033008">rb_warn</a>(<span class="stringliteral">&quot;but only [version, copyright, usage, yydebug, syntax, parsetree, parsetree_with_comment, insns].&quot;</span>);
<a name="l00686"></a>00686 }
<a name="l00687"></a>00687 
<a name="l00688"></a>00688 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00689"></a><a class="code" href="../../df/d77/ruby_8c.html#ae84b36e4342370bdd9ee1f6616c01afa">00689</a> <a class="code" href="../../df/d77/ruby_8c.html#ae84b36e4342370bdd9ee1f6616c01afa">set_option_encoding_once</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d5/d9d/tcltklib_8c.html#ac765329451135abec74c45e1897abf26">type</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> *<a class="code" href="../../d6/da0/nkf-utf8_2nkf_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *e, <span class="keywordtype">long</span> elen)
<a name="l00690"></a>00690 {
<a name="l00691"></a>00691     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> ename;
<a name="l00692"></a>00692 
<a name="l00693"></a>00693     <span class="keywordflow">if</span> (!elen) elen = <a class="code" href="../../d6/d7b/strchr_8c.html#a219836f542ce53545052bed5353820ca">strlen</a>(e);
<a name="l00694"></a>00694     ename = <a class="code" href="../../db/d2e/intern_8h.html#a48b2b873adb8b6a04254bd631c4b03c5">rb_str_new</a>(e, elen);
<a name="l00695"></a>00695 
<a name="l00696"></a>00696     <span class="keywordflow">if</span> (*name &amp;&amp;
<a name="l00697"></a>00697         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a6a973fe624aa9aa9ba0cdeb6792d3187" title="Calls a method.">rb_funcall</a>(ename, <a class="code" href="../../dc/dcc/array_8c.html#a9cfa42d4b79c89d68c53be8b2150a503">rb_intern</a>(<span class="stringliteral">&quot;casecmp&quot;</span>), 1, *name) != <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(0)) {
<a name="l00698"></a>00698         <a class="code" href="../../db/dcc/error_8c.html#a0f771a2840561f1838169b3d7d4616f3">rb_raise</a>(<a class="code" href="../../db/dcc/error_8c.html#a95ad3953d535707e2cf2b1d837f5e253">rb_eRuntimeError</a>,
<a name="l00699"></a>00699                  <span class="stringliteral">&quot;%s already set to %s&quot;</span>, type, <a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(*name));
<a name="l00700"></a>00700     }
<a name="l00701"></a>00701     *name = ename;
<a name="l00702"></a>00702 }
<a name="l00703"></a>00703 
<a name="l00704"></a><a class="code" href="../../df/d77/ruby_8c.html#ab7b9b0e7d80b52038a52938a443b1943">00704</a> <span class="preprocessor">#define set_internal_encoding_once(opt, e, elen) \</span>
<a name="l00705"></a>00705 <span class="preprocessor">    set_option_encoding_once(&quot;default_internal&quot;, &amp;(opt)-&gt;intern.enc.name, (e), (elen))</span>
<a name="l00706"></a><a class="code" href="../../df/d77/ruby_8c.html#aee02be42c35b671e153c45359ca683f0">00706</a> <span class="preprocessor"></span><span class="preprocessor">#define set_external_encoding_once(opt, e, elen) \</span>
<a name="l00707"></a>00707 <span class="preprocessor">    set_option_encoding_once(&quot;default_external&quot;, &amp;(opt)-&gt;ext.enc.name, (e), (elen))</span>
<a name="l00708"></a><a class="code" href="../../df/d77/ruby_8c.html#a10cd58bd463ddd39fa627151480d2c2e">00708</a> <span class="preprocessor"></span><span class="preprocessor">#define set_source_encoding_once(opt, e, elen) \</span>
<a name="l00709"></a>00709 <span class="preprocessor">    set_option_encoding_once(&quot;source&quot;, &amp;(opt)-&gt;src.enc.name, (e), (elen))</span>
<a name="l00710"></a>00710 <span class="preprocessor"></span>
<a name="l00711"></a>00711 <span class="keyword">static</span> <span class="keywordtype">long</span>
<a name="l00712"></a><a class="code" href="../../df/d77/ruby_8c.html#ab4952e1c881356feb1c53006c25517b3">00712</a> <a class="code" href="../../df/d77/ruby_8c.html#ab4952e1c881356feb1c53006c25517b3">proc_options</a>(<span class="keywordtype">long</span> <a class="code" href="../../df/d77/ruby_8c.html#ad1447518f4372828b8435ae82e48499e">argc</a>, <span class="keywordtype">char</span> **<a class="code" href="../../df/d77/ruby_8c.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>, <span class="keyword">struct</span> <a class="code" href="../../d1/de6/structcmdline__options.html">cmdline_options</a> *opt, <span class="keywordtype">int</span> envopt)
<a name="l00713"></a>00713 {
<a name="l00714"></a>00714     <span class="keywordtype">long</span> n, argc0 = argc;
<a name="l00715"></a>00715     <span class="keyword">const</span> <span class="keywordtype">char</span> *s;
<a name="l00716"></a>00716 
<a name="l00717"></a>00717     <span class="keywordflow">if</span> (argc == 0)
<a name="l00718"></a>00718         <span class="keywordflow">return</span> 0;
<a name="l00719"></a>00719 
<a name="l00720"></a>00720     <span class="keywordflow">for</span> (argc--, argv++; argc &gt; 0; argc--, argv++) {
<a name="l00721"></a>00721         <span class="keyword">const</span> <span class="keywordtype">char</span> *<span class="keyword">const</span> arg = argv[0];
<a name="l00722"></a>00722         <span class="keywordflow">if</span> (arg[0] != <span class="charliteral">&apos;-&apos;</span> || !arg[1])
<a name="l00723"></a>00723             <span class="keywordflow">break</span>;
<a name="l00724"></a>00724 
<a name="l00725"></a>00725         s = arg + 1;
<a name="l00726"></a>00726       reswitch:
<a name="l00727"></a>00727         <span class="keywordflow">switch</span> (*s) {
<a name="l00728"></a>00728           <span class="keywordflow">case</span> <span class="charliteral">&apos;a&apos;</span>:
<a name="l00729"></a>00729             <span class="keywordflow">if</span> (envopt) <span class="keywordflow">goto</span> noenvopt;
<a name="l00730"></a>00730             opt-&gt;<a class="code" href="../../d1/de6/structcmdline__options.html#abdd2ce8657852f857e0877eb0fc38f6f">do_split</a> = <a class="code" href="../../d1/d5c/nkf_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00731"></a>00731             s++;
<a name="l00732"></a>00732             <span class="keywordflow">goto</span> reswitch;
<a name="l00733"></a>00733 
<a name="l00734"></a>00734           <span class="keywordflow">case</span> <span class="charliteral">&apos;p&apos;</span>:
<a name="l00735"></a>00735             <span class="keywordflow">if</span> (envopt) <span class="keywordflow">goto</span> noenvopt;
<a name="l00736"></a>00736             opt-&gt;<a class="code" href="../../d1/de6/structcmdline__options.html#a6993432671b13016c14debd0588a6b9f">do_print</a> = <a class="code" href="../../d1/d5c/nkf_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00737"></a>00737             <span class="comment">/* through */</span>
<a name="l00738"></a>00738           <span class="keywordflow">case</span> <span class="charliteral">&apos;n&apos;</span>:
<a name="l00739"></a>00739             <span class="keywordflow">if</span> (envopt) <span class="keywordflow">goto</span> noenvopt;
<a name="l00740"></a>00740             opt-&gt;<a class="code" href="../../d1/de6/structcmdline__options.html#acba68d4bf70d3f90cc93c46b3818ebed">do_loop</a> = <a class="code" href="../../d1/d5c/nkf_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00741"></a>00741             s++;
<a name="l00742"></a>00742             <span class="keywordflow">goto</span> reswitch;
<a name="l00743"></a>00743 
<a name="l00744"></a>00744           <span class="keywordflow">case</span> <span class="charliteral">&apos;d&apos;</span>:
<a name="l00745"></a>00745             <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a01ed2eb085103197c53c2b5c63b8f637">ruby_debug</a> = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aacea3516b33941ce8149098e223a7466">Qtrue</a>;
<a name="l00746"></a>00746             <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a56087d5316e4c73027105c023006cb15">ruby_verbose</a> = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aacea3516b33941ce8149098e223a7466">Qtrue</a>;
<a name="l00747"></a>00747             s++;
<a name="l00748"></a>00748             <span class="keywordflow">goto</span> reswitch;
<a name="l00749"></a>00749 
<a name="l00750"></a>00750           <span class="keywordflow">case</span> <span class="charliteral">&apos;y&apos;</span>:
<a name="l00751"></a>00751             <span class="keywordflow">if</span> (envopt) <span class="keywordflow">goto</span> noenvopt;
<a name="l00752"></a>00752             opt-&gt;<a class="code" href="../../d1/de6/structcmdline__options.html#a48863cb6a5e38f32ec34e0cc02aaf3df">dump</a> |= <a class="code" href="../../df/d77/ruby_8c.html#a407222be54393f7e01842b5d79c25f55">DUMP_BIT</a>(<a class="code" href="../../d5/d11/ripper_8c.html#a7fde6236fcb0f6e5d1d20ce98d9f0d01">yydebug</a>);
<a name="l00753"></a>00753             s++;
<a name="l00754"></a>00754             <span class="keywordflow">goto</span> reswitch;
<a name="l00755"></a>00755 
<a name="l00756"></a>00756           <span class="keywordflow">case</span> <span class="charliteral">&apos;v&apos;</span>:
<a name="l00757"></a>00757             <span class="keywordflow">if</span> (opt-&gt;<a class="code" href="../../d1/de6/structcmdline__options.html#a473a2d767a06b33c82cf4e5f4d3a41f8">verbose</a>) {
<a name="l00758"></a>00758                 s++;
<a name="l00759"></a>00759                 <span class="keywordflow">goto</span> reswitch;
<a name="l00760"></a>00760             }
<a name="l00761"></a>00761             <a class="code" href="../../db/d2e/intern_8h.html#af1116bc38b8f93d03a817df80b16f634">ruby_show_version</a>();
<a name="l00762"></a>00762             opt-&gt;<a class="code" href="../../d1/de6/structcmdline__options.html#a473a2d767a06b33c82cf4e5f4d3a41f8">verbose</a> = 1;
<a name="l00763"></a>00763           <span class="keywordflow">case</span> <span class="charliteral">&apos;w&apos;</span>:
<a name="l00764"></a>00764             <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a56087d5316e4c73027105c023006cb15">ruby_verbose</a> = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aacea3516b33941ce8149098e223a7466">Qtrue</a>;
<a name="l00765"></a>00765             s++;
<a name="l00766"></a>00766             <span class="keywordflow">goto</span> reswitch;
<a name="l00767"></a>00767 
<a name="l00768"></a>00768           <span class="keywordflow">case</span> <span class="charliteral">&apos;W&apos;</span>:
<a name="l00769"></a>00769             {
<a name="l00770"></a>00770                 <span class="keywordtype">size_t</span> numlen;
<a name="l00771"></a>00771                 <span class="keywordtype">int</span> v = 2;      <span class="comment">/* -W as -W2 */</span>
<a name="l00772"></a>00772 
<a name="l00773"></a>00773                 <span class="keywordflow">if</span> (*++s) {
<a name="l00774"></a>00774                     v = <a class="code" href="../../d8/d3c/util_8h.html#ae67d4c595940aae807ac889adf3428a1">scan_oct</a>(s, 1, &amp;numlen);
<a name="l00775"></a>00775                     <span class="keywordflow">if</span> (numlen == 0)
<a name="l00776"></a>00776                         v = 1;
<a name="l00777"></a>00777                     s += numlen;
<a name="l00778"></a>00778                 }
<a name="l00779"></a>00779                 <span class="keywordflow">switch</span> (v) {
<a name="l00780"></a>00780                   <span class="keywordflow">case</span> 0:
<a name="l00781"></a>00781                     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a56087d5316e4c73027105c023006cb15">ruby_verbose</a> = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a320970f989dc8294c8203154e3db40c1">Qnil</a>;
<a name="l00782"></a>00782                     <span class="keywordflow">break</span>;
<a name="l00783"></a>00783                   <span class="keywordflow">case</span> 1:
<a name="l00784"></a>00784                     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a56087d5316e4c73027105c023006cb15">ruby_verbose</a> = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aba0717d2689eb68797421a02ab9295c6">Qfalse</a>;
<a name="l00785"></a>00785                     <span class="keywordflow">break</span>;
<a name="l00786"></a>00786                   <span class="keywordflow">default</span>:
<a name="l00787"></a>00787                     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a56087d5316e4c73027105c023006cb15">ruby_verbose</a> = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aacea3516b33941ce8149098e223a7466">Qtrue</a>;
<a name="l00788"></a>00788                     <span class="keywordflow">break</span>;
<a name="l00789"></a>00789                 }
<a name="l00790"></a>00790             }
<a name="l00791"></a>00791             <span class="keywordflow">goto</span> reswitch;
<a name="l00792"></a>00792 
<a name="l00793"></a>00793           <span class="keywordflow">case</span> <span class="charliteral">&apos;c&apos;</span>:
<a name="l00794"></a>00794             <span class="keywordflow">if</span> (envopt) <span class="keywordflow">goto</span> noenvopt;
<a name="l00795"></a>00795             opt-&gt;<a class="code" href="../../d1/de6/structcmdline__options.html#a48863cb6a5e38f32ec34e0cc02aaf3df">dump</a> |= <a class="code" href="../../df/d77/ruby_8c.html#a407222be54393f7e01842b5d79c25f55">DUMP_BIT</a>(syntax);
<a name="l00796"></a>00796             s++;
<a name="l00797"></a>00797             <span class="keywordflow">goto</span> reswitch;
<a name="l00798"></a>00798 
<a name="l00799"></a>00799           <span class="keywordflow">case</span> <span class="charliteral">&apos;s&apos;</span>:
<a name="l00800"></a>00800             <span class="keywordflow">if</span> (envopt) <span class="keywordflow">goto</span> noenvopt;
<a name="l00801"></a>00801             <a class="code" href="../../df/d77/ruby_8c.html#aefc30916c718aa484a9692900febed5b">forbid_setid</a>(<span class="stringliteral">&quot;-s&quot;</span>);
<a name="l00802"></a>00802             <span class="keywordflow">if</span> (!opt-&gt;<a class="code" href="../../d1/de6/structcmdline__options.html#a8df7ebabf39c6f8ff518824676ff0395">sflag</a>) opt-&gt;<a class="code" href="../../d1/de6/structcmdline__options.html#a8df7ebabf39c6f8ff518824676ff0395">sflag</a> = 1;
<a name="l00803"></a>00803             s++;
<a name="l00804"></a>00804             <span class="keywordflow">goto</span> reswitch;
<a name="l00805"></a>00805 
<a name="l00806"></a>00806           <span class="keywordflow">case</span> <span class="charliteral">&apos;h&apos;</span>:
<a name="l00807"></a>00807             <span class="keywordflow">if</span> (envopt) <span class="keywordflow">goto</span> noenvopt;
<a name="l00808"></a>00808             opt-&gt;<a class="code" href="../../d1/de6/structcmdline__options.html#a48863cb6a5e38f32ec34e0cc02aaf3df">dump</a> |= <a class="code" href="../../df/d77/ruby_8c.html#a407222be54393f7e01842b5d79c25f55">DUMP_BIT</a>(<a class="code" href="../../df/d77/ruby_8c.html#ab24984492570c9e0e802e45300d2eb82">usage</a>);
<a name="l00809"></a>00809             <span class="keywordflow">goto</span> switch_end;
<a name="l00810"></a>00810 
<a name="l00811"></a>00811           <span class="keywordflow">case</span> <span class="charliteral">&apos;l&apos;</span>:
<a name="l00812"></a>00812             <span class="keywordflow">if</span> (envopt) <span class="keywordflow">goto</span> noenvopt;
<a name="l00813"></a>00813             opt-&gt;<a class="code" href="../../d1/de6/structcmdline__options.html#a65f1e5acac44a2b311f6dbe5c24ac802">do_line</a> = <a class="code" href="../../d1/d5c/nkf_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00814"></a>00814             <a class="code" href="../../db/d2e/intern_8h.html#aad25f1b1b54e12dcb609374f46cfd0e5">rb_output_rs</a> = <a class="code" href="../../db/d2e/intern_8h.html#a6d19bb99247117d9d8b880ab14ad8d25">rb_rs</a>;
<a name="l00815"></a>00815             s++;
<a name="l00816"></a>00816             <span class="keywordflow">goto</span> reswitch;
<a name="l00817"></a>00817 
<a name="l00818"></a>00818           <span class="keywordflow">case</span> <span class="charliteral">&apos;S&apos;</span>:
<a name="l00819"></a>00819             <span class="keywordflow">if</span> (envopt) <span class="keywordflow">goto</span> noenvopt;
<a name="l00820"></a>00820             <a class="code" href="../../df/d77/ruby_8c.html#aefc30916c718aa484a9692900febed5b">forbid_setid</a>(<span class="stringliteral">&quot;-S&quot;</span>);
<a name="l00821"></a>00821             opt-&gt;<a class="code" href="../../d1/de6/structcmdline__options.html#a407d9ebb05e6359600672c47f01b18db">do_search</a> = <a class="code" href="../../d1/d5c/nkf_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00822"></a>00822             s++;
<a name="l00823"></a>00823             <span class="keywordflow">goto</span> reswitch;
<a name="l00824"></a>00824 
<a name="l00825"></a>00825           <span class="keywordflow">case</span> <span class="charliteral">&apos;e&apos;</span>:
<a name="l00826"></a>00826             <span class="keywordflow">if</span> (envopt) <span class="keywordflow">goto</span> noenvopt;
<a name="l00827"></a>00827             <a class="code" href="../../df/d77/ruby_8c.html#aefc30916c718aa484a9692900febed5b">forbid_setid</a>(<span class="stringliteral">&quot;-e&quot;</span>);
<a name="l00828"></a>00828             <span class="keywordflow">if</span> (!*++s) {
<a name="l00829"></a>00829                 s = argv[1];
<a name="l00830"></a>00830                 argc--, argv++;
<a name="l00831"></a>00831             }
<a name="l00832"></a>00832             <span class="keywordflow">if</span> (!s) {
<a name="l00833"></a>00833                 <a class="code" href="../../db/dcc/error_8c.html#a0f771a2840561f1838169b3d7d4616f3">rb_raise</a>(<a class="code" href="../../db/dcc/error_8c.html#a95ad3953d535707e2cf2b1d837f5e253">rb_eRuntimeError</a>, <span class="stringliteral">&quot;no code specified for -e&quot;</span>);
<a name="l00834"></a>00834             }
<a name="l00835"></a>00835             <span class="keywordflow">if</span> (!opt-&gt;<a class="code" href="../../d1/de6/structcmdline__options.html#a2e5ed539082d405a331e96b70283510c">e_script</a>) {
<a name="l00836"></a>00836                 opt-&gt;<a class="code" href="../../d1/de6/structcmdline__options.html#a2e5ed539082d405a331e96b70283510c">e_script</a> = <a class="code" href="../../db/d2e/intern_8h.html#a48b2b873adb8b6a04254bd631c4b03c5">rb_str_new</a>(0, 0);
<a name="l00837"></a>00837                 <span class="keywordflow">if</span> (opt-&gt;<a class="code" href="../../d1/de6/structcmdline__options.html#a450901fd25d06a98bbf8f6525a95d73f">script</a> == 0)
<a name="l00838"></a>00838                     opt-&gt;<a class="code" href="../../d1/de6/structcmdline__options.html#a450901fd25d06a98bbf8f6525a95d73f">script</a> = <span class="stringliteral">&quot;-e&quot;</span>;
<a name="l00839"></a>00839             }
<a name="l00840"></a>00840             <a class="code" href="../../db/d2e/intern_8h.html#a5bd27db3e38af6131db24321c7cf9ec6">rb_str_cat2</a>(opt-&gt;<a class="code" href="../../d1/de6/structcmdline__options.html#a2e5ed539082d405a331e96b70283510c">e_script</a>, s);
<a name="l00841"></a>00841             <a class="code" href="../../db/d2e/intern_8h.html#a5bd27db3e38af6131db24321c7cf9ec6">rb_str_cat2</a>(opt-&gt;<a class="code" href="../../d1/de6/structcmdline__options.html#a2e5ed539082d405a331e96b70283510c">e_script</a>, <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l00842"></a>00842             <span class="keywordflow">break</span>;
<a name="l00843"></a>00843 
<a name="l00844"></a>00844           <span class="keywordflow">case</span> <span class="charliteral">&apos;r&apos;</span>:
<a name="l00845"></a>00845             <a class="code" href="../../df/d77/ruby_8c.html#aefc30916c718aa484a9692900febed5b">forbid_setid</a>(<span class="stringliteral">&quot;-r&quot;</span>);
<a name="l00846"></a>00846             <span class="keywordflow">if</span> (*++s) {
<a name="l00847"></a>00847                 <a class="code" href="../../df/d77/ruby_8c.html#aef0c0e6850555aaaa055f5325d08f0c2">add_modules</a>(&amp;opt-&gt;<a class="code" href="../../d1/de6/structcmdline__options.html#ab403f7b88211076cbc5cdaf54704857e">req_list</a>, s);
<a name="l00848"></a>00848             }
<a name="l00849"></a>00849             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (argv[1]) {
<a name="l00850"></a>00850                 <a class="code" href="../../df/d77/ruby_8c.html#aef0c0e6850555aaaa055f5325d08f0c2">add_modules</a>(&amp;opt-&gt;<a class="code" href="../../d1/de6/structcmdline__options.html#ab403f7b88211076cbc5cdaf54704857e">req_list</a>, argv[1]);
<a name="l00851"></a>00851                 argc--, argv++;
<a name="l00852"></a>00852             }
<a name="l00853"></a>00853             <span class="keywordflow">break</span>;
<a name="l00854"></a>00854 
<a name="l00855"></a>00855           <span class="keywordflow">case</span> <span class="charliteral">&apos;i&apos;</span>:
<a name="l00856"></a>00856             <span class="keywordflow">if</span> (envopt) <span class="keywordflow">goto</span> noenvopt;
<a name="l00857"></a>00857             <a class="code" href="../../df/d77/ruby_8c.html#aefc30916c718aa484a9692900febed5b">forbid_setid</a>(<span class="stringliteral">&quot;-i&quot;</span>);
<a name="l00858"></a>00858             <a class="code" href="../../df/d0a/io_8c.html#a33e56a1b137ee7df1e73be6c922dbaee">ruby_set_inplace_mode</a>(s + 1);
<a name="l00859"></a>00859             <span class="keywordflow">break</span>;
<a name="l00860"></a>00860 
<a name="l00861"></a>00861           <span class="keywordflow">case</span> <span class="charliteral">&apos;x&apos;</span>:
<a name="l00862"></a>00862             <span class="keywordflow">if</span> (envopt) <span class="keywordflow">goto</span> noenvopt;
<a name="l00863"></a>00863             opt-&gt;<a class="code" href="../../d1/de6/structcmdline__options.html#a7d125fcd6f16d94efa3cf072dda67b15">xflag</a> = <a class="code" href="../../d1/d5c/nkf_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00864"></a>00864             s++;
<a name="l00865"></a>00865             <span class="keywordflow">if</span> (*s &amp;&amp; chdir(s) &lt; 0) {
<a name="l00866"></a>00866                 <a class="code" href="../../db/dcc/error_8c.html#a643ceabe39fa1f8c99066a321397a115">rb_fatal</a>(<span class="stringliteral">&quot;Can&apos;t chdir to %s&quot;</span>, s);
<a name="l00867"></a>00867             }
<a name="l00868"></a>00868             <span class="keywordflow">break</span>;
<a name="l00869"></a>00869 
<a name="l00870"></a>00870           <span class="keywordflow">case</span> <span class="charliteral">&apos;C&apos;</span>:
<a name="l00871"></a>00871           <span class="keywordflow">case</span> <span class="charliteral">&apos;X&apos;</span>:
<a name="l00872"></a>00872             <span class="keywordflow">if</span> (envopt) <span class="keywordflow">goto</span> noenvopt;
<a name="l00873"></a>00873             s++;
<a name="l00874"></a>00874             <span class="keywordflow">if</span> (!*s) {
<a name="l00875"></a>00875                 s = argv[1];
<a name="l00876"></a>00876                 argc--, argv++;
<a name="l00877"></a>00877             }
<a name="l00878"></a>00878             <span class="keywordflow">if</span> (!s || !*s) {
<a name="l00879"></a>00879                 <a class="code" href="../../db/dcc/error_8c.html#a643ceabe39fa1f8c99066a321397a115">rb_fatal</a>(<span class="stringliteral">&quot;Can&apos;t chdir&quot;</span>);
<a name="l00880"></a>00880             }
<a name="l00881"></a>00881             <span class="keywordflow">if</span> (chdir(s) &lt; 0) {
<a name="l00882"></a>00882                 <a class="code" href="../../db/dcc/error_8c.html#a643ceabe39fa1f8c99066a321397a115">rb_fatal</a>(<span class="stringliteral">&quot;Can&apos;t chdir to %s&quot;</span>, s);
<a name="l00883"></a>00883             }
<a name="l00884"></a>00884             <span class="keywordflow">break</span>;
<a name="l00885"></a>00885 
<a name="l00886"></a>00886           <span class="keywordflow">case</span> <span class="charliteral">&apos;F&apos;</span>:
<a name="l00887"></a>00887             <span class="keywordflow">if</span> (envopt) <span class="keywordflow">goto</span> noenvopt;
<a name="l00888"></a>00888             <span class="keywordflow">if</span> (*++s) {
<a name="l00889"></a>00889                 <a class="code" href="../../db/d2e/intern_8h.html#ade300b3f8270fc26be5821ad806615ff">rb_fs</a> = <a class="code" href="../../db/d2e/intern_8h.html#a9de8268f4a0b918cfed87666b7b0f4f2">rb_reg_new</a>(s, <a class="code" href="../../d6/d7b/strchr_8c.html#a219836f542ce53545052bed5353820ca">strlen</a>(s), 0);
<a name="l00890"></a>00890             }
<a name="l00891"></a>00891             <span class="keywordflow">break</span>;
<a name="l00892"></a>00892 
<a name="l00893"></a>00893           <span class="keywordflow">case</span> <span class="charliteral">&apos;E&apos;</span>:
<a name="l00894"></a>00894             <span class="keywordflow">if</span> (!*++s &amp;&amp; (!--argc || !(s = *++argv))) {
<a name="l00895"></a>00895                 <a class="code" href="../../db/dcc/error_8c.html#a0f771a2840561f1838169b3d7d4616f3">rb_raise</a>(<a class="code" href="../../db/dcc/error_8c.html#a95ad3953d535707e2cf2b1d837f5e253">rb_eRuntimeError</a>, <span class="stringliteral">&quot;missing argument for -E&quot;</span>);
<a name="l00896"></a>00896             }
<a name="l00897"></a>00897             <span class="keywordflow">goto</span> encoding;
<a name="l00898"></a>00898 
<a name="l00899"></a>00899           <span class="keywordflow">case</span> <span class="charliteral">&apos;U&apos;</span>:
<a name="l00900"></a>00900             <a class="code" href="../../df/d77/ruby_8c.html#ab7b9b0e7d80b52038a52938a443b1943">set_internal_encoding_once</a>(opt, <span class="stringliteral">&quot;UTF-8&quot;</span>, 0);
<a name="l00901"></a>00901             ++s;
<a name="l00902"></a>00902             <span class="keywordflow">goto</span> reswitch;
<a name="l00903"></a>00903 
<a name="l00904"></a>00904           <span class="keywordflow">case</span> <span class="charliteral">&apos;K&apos;</span>:
<a name="l00905"></a>00905             <span class="keywordflow">if</span> (*++s) {
<a name="l00906"></a>00906                 <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d5/db5/encoding_8c.html#aa020a886cff98ea2edead4231ff72973">enc_name</a> = 0;
<a name="l00907"></a>00907                 <span class="keywordflow">switch</span> (*s) {
<a name="l00908"></a>00908                   <span class="keywordflow">case</span> <span class="charliteral">&apos;E&apos;</span>: <span class="keywordflow">case</span> <span class="charliteral">&apos;e&apos;</span>:
<a name="l00909"></a>00909                     enc_name = <span class="stringliteral">&quot;EUC-JP&quot;</span>;
<a name="l00910"></a>00910                     <span class="keywordflow">break</span>;
<a name="l00911"></a>00911                   <span class="keywordflow">case</span> <span class="charliteral">&apos;S&apos;</span>: <span class="keywordflow">case</span> <span class="charliteral">&apos;s&apos;</span>:
<a name="l00912"></a>00912                     enc_name = <span class="stringliteral">&quot;Windows-31J&quot;</span>;
<a name="l00913"></a>00913                     <span class="keywordflow">break</span>;
<a name="l00914"></a>00914                   <span class="keywordflow">case</span> <span class="charliteral">&apos;U&apos;</span>: <span class="keywordflow">case</span> <span class="charliteral">&apos;u&apos;</span>:
<a name="l00915"></a>00915                     enc_name = <span class="stringliteral">&quot;UTF-8&quot;</span>;
<a name="l00916"></a>00916                     <span class="keywordflow">break</span>;
<a name="l00917"></a>00917                   <span class="keywordflow">case</span> <span class="charliteral">&apos;N&apos;</span>: <span class="keywordflow">case</span> <span class="charliteral">&apos;n&apos;</span>: <span class="keywordflow">case</span> <span class="charliteral">&apos;A&apos;</span>: <span class="keywordflow">case</span> <span class="charliteral">&apos;a&apos;</span>:
<a name="l00918"></a>00918                     enc_name = <span class="stringliteral">&quot;ASCII-8BIT&quot;</span>;
<a name="l00919"></a>00919                     <span class="keywordflow">break</span>;
<a name="l00920"></a>00920                 }
<a name="l00921"></a>00921                 <span class="keywordflow">if</span> (enc_name) {
<a name="l00922"></a>00922                     opt-&gt;<a class="code" href="../../d1/de6/structcmdline__options.html#a13f1f0d4bc385de1d92ac617f5fc8b2a">src</a>.<a class="code" href="../../d1/de6/structcmdline__options.html#a89ae067a92ade681a2ba731d8aa7bffc">enc</a>.name = <a class="code" href="../../db/d2e/intern_8h.html#a03acd62c0b1edebbe1d61f957c19b7ac">rb_str_new2</a>(enc_name);
<a name="l00923"></a>00923                     <span class="keywordflow">if</span> (!opt-&gt;<a class="code" href="../../d1/de6/structcmdline__options.html#ae4fff502bd9884529c1f31ab938a436c">ext</a>.<a class="code" href="../../d1/de6/structcmdline__options.html#a89ae067a92ade681a2ba731d8aa7bffc">enc</a>.name)
<a name="l00924"></a>00924                         opt-&gt;<a class="code" href="../../d1/de6/structcmdline__options.html#ae4fff502bd9884529c1f31ab938a436c">ext</a>.<a class="code" href="../../d1/de6/structcmdline__options.html#a89ae067a92ade681a2ba731d8aa7bffc">enc</a>.name = opt-&gt;<a class="code" href="../../d1/de6/structcmdline__options.html#a13f1f0d4bc385de1d92ac617f5fc8b2a">src</a>.<a class="code" href="../../d1/de6/structcmdline__options.html#a89ae067a92ade681a2ba731d8aa7bffc">enc</a>.name;
<a name="l00925"></a>00925                 }
<a name="l00926"></a>00926                 s++;
<a name="l00927"></a>00927             }
<a name="l00928"></a>00928             <span class="keywordflow">goto</span> reswitch;
<a name="l00929"></a>00929 
<a name="l00930"></a>00930           <span class="keywordflow">case</span> <span class="charliteral">&apos;T&apos;</span>:
<a name="l00931"></a>00931             {
<a name="l00932"></a>00932                 <span class="keywordtype">size_t</span> numlen;
<a name="l00933"></a>00933                 <span class="keywordtype">int</span> v = 1;
<a name="l00934"></a>00934 
<a name="l00935"></a>00935                 <span class="keywordflow">if</span> (*++s) {
<a name="l00936"></a>00936                     v = <a class="code" href="../../d8/d3c/util_8h.html#ae67d4c595940aae807ac889adf3428a1">scan_oct</a>(s, 2, &amp;numlen);
<a name="l00937"></a>00937                     <span class="keywordflow">if</span> (numlen == 0)
<a name="l00938"></a>00938                         v = 1;
<a name="l00939"></a>00939                     s += numlen;
<a name="l00940"></a>00940                 }
<a name="l00941"></a>00941                 <span class="keywordflow">if</span> (v &gt; opt-&gt;<a class="code" href="../../d1/de6/structcmdline__options.html#a63be2eaa4c22858f34bda26de79a13c0">safe_level</a>) opt-&gt;<a class="code" href="../../d1/de6/structcmdline__options.html#a63be2eaa4c22858f34bda26de79a13c0">safe_level</a> = v;
<a name="l00942"></a>00942             }
<a name="l00943"></a>00943             <span class="keywordflow">goto</span> reswitch;
<a name="l00944"></a>00944 
<a name="l00945"></a>00945           <span class="keywordflow">case</span> <span class="charliteral">&apos;I&apos;</span>:
<a name="l00946"></a>00946             <a class="code" href="../../df/d77/ruby_8c.html#aefc30916c718aa484a9692900febed5b">forbid_setid</a>(<span class="stringliteral">&quot;-I&quot;</span>);
<a name="l00947"></a>00947             <span class="keywordflow">if</span> (*++s)
<a name="l00948"></a>00948                 <a class="code" href="../../df/d77/ruby_8c.html#a26ccecd2da26646a3ed21a57cfee0949">ruby_incpush_expand</a>(s);
<a name="l00949"></a>00949             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (argv[1]) {
<a name="l00950"></a>00950                 <a class="code" href="../../df/d77/ruby_8c.html#a26ccecd2da26646a3ed21a57cfee0949">ruby_incpush_expand</a>(argv[1]);
<a name="l00951"></a>00951                 argc--, argv++;
<a name="l00952"></a>00952             }
<a name="l00953"></a>00953             <span class="keywordflow">break</span>;
<a name="l00954"></a>00954 
<a name="l00955"></a>00955           <span class="keywordflow">case</span> <span class="charliteral">&apos;0&apos;</span>:
<a name="l00956"></a>00956             <span class="keywordflow">if</span> (envopt) <span class="keywordflow">goto</span> noenvopt;
<a name="l00957"></a>00957             {
<a name="l00958"></a>00958                 <span class="keywordtype">size_t</span> numlen;
<a name="l00959"></a>00959                 <span class="keywordtype">int</span> v;
<a name="l00960"></a>00960                 <span class="keywordtype">char</span> c;
<a name="l00961"></a>00961 
<a name="l00962"></a>00962                 v = <a class="code" href="../../d8/d3c/util_8h.html#ae67d4c595940aae807ac889adf3428a1">scan_oct</a>(s, 4, &amp;numlen);
<a name="l00963"></a>00963                 s += numlen;
<a name="l00964"></a>00964                 <span class="keywordflow">if</span> (v &gt; 0377)
<a name="l00965"></a>00965                     <a class="code" href="../../db/d2e/intern_8h.html#a6d19bb99247117d9d8b880ab14ad8d25">rb_rs</a> = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a320970f989dc8294c8203154e3db40c1">Qnil</a>;
<a name="l00966"></a>00966                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (v == 0 &amp;&amp; numlen &gt;= 2) {
<a name="l00967"></a>00967                     <a class="code" href="../../db/d2e/intern_8h.html#a6d19bb99247117d9d8b880ab14ad8d25">rb_rs</a> = <a class="code" href="../../db/d2e/intern_8h.html#a03acd62c0b1edebbe1d61f957c19b7ac">rb_str_new2</a>(<span class="stringliteral">&quot;\n\n&quot;</span>);
<a name="l00968"></a>00968                 }
<a name="l00969"></a>00969                 <span class="keywordflow">else</span> {
<a name="l00970"></a>00970                     c = v &amp; 0xff;
<a name="l00971"></a>00971                     <a class="code" href="../../db/d2e/intern_8h.html#a6d19bb99247117d9d8b880ab14ad8d25">rb_rs</a> = <a class="code" href="../../db/d2e/intern_8h.html#a48b2b873adb8b6a04254bd631c4b03c5">rb_str_new</a>(&amp;c, 1);
<a name="l00972"></a>00972                 }
<a name="l00973"></a>00973             }
<a name="l00974"></a>00974             <span class="keywordflow">goto</span> reswitch;
<a name="l00975"></a>00975 
<a name="l00976"></a>00976           <span class="keywordflow">case</span> <span class="charliteral">&apos;-&apos;</span>:
<a name="l00977"></a>00977             <span class="keywordflow">if</span> (!s[1] || (s[1] == <span class="charliteral">&apos;\r&apos;</span> &amp;&amp; !s[2])) {
<a name="l00978"></a>00978                 argc--, argv++;
<a name="l00979"></a>00979                 <span class="keywordflow">goto</span> switch_end;
<a name="l00980"></a>00980             }
<a name="l00981"></a>00981             s++;
<a name="l00982"></a>00982 
<a name="l00983"></a>00983 <span class="preprocessor">#       define is_option_end(c, allow_hyphen) \</span>
<a name="l00984"></a>00984 <span class="preprocessor">            (!(c) || ((allow_hyphen) &amp;&amp; (c) == &apos;-&apos;) || (c) == &apos;=&apos;)</span>
<a name="l00985"></a>00985 <span class="preprocessor"></span><span class="preprocessor">#       define check_envopt(name, allow_envopt) \</span>
<a name="l00986"></a>00986 <span class="preprocessor">            (((allow_envopt) || !envopt) ? (void)0 : \</span>
<a name="l00987"></a>00987 <span class="preprocessor">             rb_raise(rb_eRuntimeError, &quot;invalid switch in RUBYOPT: --&quot; name))</span>
<a name="l00988"></a>00988 <span class="preprocessor"></span><span class="preprocessor">#       define need_argument(name, s) \</span>
<a name="l00989"></a>00989 <span class="preprocessor">            ((*(s)++ ? !*(s) : (!--argc || !((s) = *++argv))) ?         \</span>
<a name="l00990"></a>00990 <span class="preprocessor">             rb_raise(rb_eRuntimeError, &quot;missing argument for --&quot; name) \</span>
<a name="l00991"></a>00991 <span class="preprocessor">             : (void)0)</span>
<a name="l00992"></a>00992 <span class="preprocessor"></span><span class="preprocessor">#       define is_option_with_arg(name, allow_hyphen, allow_envopt) \</span>
<a name="l00993"></a>00993 <span class="preprocessor">            (strncmp((name), s, n = sizeof(name) - 1) == 0 &amp;&amp; is_option_end(s[n], (allow_hyphen)) ? \</span>
<a name="l00994"></a>00994 <span class="preprocessor">             (check_envopt(name, (allow_envopt)), s += n, need_argument(name, s), 1) : 0)</span>
<a name="l00995"></a>00995 <span class="preprocessor"></span>
<a name="l00996"></a>00996             <span class="keywordflow">if</span> (strcmp(<span class="stringliteral">&quot;copyright&quot;</span>, s) == 0) {
<a name="l00997"></a>00997                 <span class="keywordflow">if</span> (envopt) <span class="keywordflow">goto</span> noenvopt_long;
<a name="l00998"></a>00998                 opt-&gt;<a class="code" href="../../d1/de6/structcmdline__options.html#a48863cb6a5e38f32ec34e0cc02aaf3df">dump</a> |= <a class="code" href="../../df/d77/ruby_8c.html#a407222be54393f7e01842b5d79c25f55">DUMP_BIT</a>(copyright);
<a name="l00999"></a>00999             }
<a name="l01000"></a>01000             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(<span class="stringliteral">&quot;debug&quot;</span>, s) == 0) {
<a name="l01001"></a>01001                 <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a01ed2eb085103197c53c2b5c63b8f637">ruby_debug</a> = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aacea3516b33941ce8149098e223a7466">Qtrue</a>;
<a name="l01002"></a>01002                 <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a56087d5316e4c73027105c023006cb15">ruby_verbose</a> = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aacea3516b33941ce8149098e223a7466">Qtrue</a>;
<a name="l01003"></a>01003             }
<a name="l01004"></a>01004             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../df/d77/ruby_8c.html#a2cf1a398ca494cfae30babada04bec07">is_option_with_arg</a>(<span class="stringliteral">&quot;enable&quot;</span>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aacea3516b33941ce8149098e223a7466">Qtrue</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aacea3516b33941ce8149098e223a7466">Qtrue</a>)) {
<a name="l01005"></a>01005                 <a class="code" href="../../d8/d3c/util_8h.html#ada6fc505a58f8b3f24821f94e0e5ec32">ruby_each_words</a>(s, <a class="code" href="../../df/d77/ruby_8c.html#a328d0c718cdb3462aabcafd6ffd35be5">enable_option</a>, &amp;opt-&gt;<a class="code" href="../../d1/de6/structcmdline__options.html#a43a59903d1fda92df5c8bf5fc27c880e">disable</a>);
<a name="l01006"></a>01006             }
<a name="l01007"></a>01007             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../df/d77/ruby_8c.html#a2cf1a398ca494cfae30babada04bec07">is_option_with_arg</a>(<span class="stringliteral">&quot;disable&quot;</span>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aacea3516b33941ce8149098e223a7466">Qtrue</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aacea3516b33941ce8149098e223a7466">Qtrue</a>)) {
<a name="l01008"></a>01008                 <a class="code" href="../../d8/d3c/util_8h.html#ada6fc505a58f8b3f24821f94e0e5ec32">ruby_each_words</a>(s, <a class="code" href="../../df/d77/ruby_8c.html#a0e1fc2982497b434a99d1785b9214fe6">disable_option</a>, &amp;opt-&gt;<a class="code" href="../../d1/de6/structcmdline__options.html#a43a59903d1fda92df5c8bf5fc27c880e">disable</a>);
<a name="l01009"></a>01009             }
<a name="l01010"></a>01010             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../df/d77/ruby_8c.html#a2cf1a398ca494cfae30babada04bec07">is_option_with_arg</a>(<span class="stringliteral">&quot;encoding&quot;</span>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aba0717d2689eb68797421a02ab9295c6">Qfalse</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aacea3516b33941ce8149098e223a7466">Qtrue</a>)) {
<a name="l01011"></a>01011                 <span class="keywordtype">char</span> *p;
<a name="l01012"></a>01012               encoding:
<a name="l01013"></a>01013                 <span class="keywordflow">do</span> {
<a name="l01014"></a>01014 <span class="preprocessor">#       define set_encoding_part(type) \</span>
<a name="l01015"></a>01015 <span class="preprocessor">                    if (!(p = strchr(s, &apos;:&apos;))) { \</span>
<a name="l01016"></a>01016 <span class="preprocessor">                        set_##type##_encoding_once(opt, s, 0); \</span>
<a name="l01017"></a>01017 <span class="preprocessor">                        break; \</span>
<a name="l01018"></a>01018 <span class="preprocessor">                    } \</span>
<a name="l01019"></a>01019 <span class="preprocessor">                    else if (p &gt; s) { \</span>
<a name="l01020"></a>01020 <span class="preprocessor">                        set_##type##_encoding_once(opt, s, p-s); \</span>
<a name="l01021"></a>01021 <span class="preprocessor">                    }</span>
<a name="l01022"></a>01022 <span class="preprocessor"></span>                    <a class="code" href="../../df/d77/ruby_8c.html#ad32ba399d41ba22478755f3348bc3c5d">set_encoding_part</a>(external);
<a name="l01023"></a>01023                     <span class="keywordflow">if</span> (!*(s = ++p)) <span class="keywordflow">break</span>;
<a name="l01024"></a>01024                     <a class="code" href="../../df/d77/ruby_8c.html#ad32ba399d41ba22478755f3348bc3c5d">set_encoding_part</a>(<span class="keyword">internal</span>);
<a name="l01025"></a>01025                     <span class="keywordflow">if</span> (!*(s = ++p)) <span class="keywordflow">break</span>;
<a name="l01026"></a>01026 <span class="preprocessor">#if defined ALLOW_DEFAULT_SOURCE_ENCODING &amp;&amp; ALLOW_DEFAULT_SOURCE_ENCODING</span>
<a name="l01027"></a>01027 <span class="preprocessor"></span>                    <a class="code" href="../../df/d77/ruby_8c.html#ad32ba399d41ba22478755f3348bc3c5d">set_encoding_part</a>(source);
<a name="l01028"></a>01028                     <span class="keywordflow">if</span> (!*(s = ++p)) <span class="keywordflow">break</span>;
<a name="l01029"></a>01029 <span class="preprocessor">#endif</span>
<a name="l01030"></a>01030 <span class="preprocessor"></span>                    <a class="code" href="../../db/dcc/error_8c.html#a0f771a2840561f1838169b3d7d4616f3">rb_raise</a>(<a class="code" href="../../db/dcc/error_8c.html#a95ad3953d535707e2cf2b1d837f5e253">rb_eRuntimeError</a>, <span class="stringliteral">&quot;extra argument for %s: %s&quot;</span>,
<a name="l01031"></a>01031                              (arg[1] == <span class="charliteral">&apos;-&apos;</span> ? <span class="stringliteral">&quot;--encoding&quot;</span> : <span class="stringliteral">&quot;-E&quot;</span>), s);
<a name="l01032"></a>01032 <span class="preprocessor">#       undef set_encoding_part</span>
<a name="l01033"></a>01033 <span class="preprocessor"></span>                } <span class="keywordflow">while</span> (0);
<a name="l01034"></a>01034             }
<a name="l01035"></a>01035             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../df/d77/ruby_8c.html#a2cf1a398ca494cfae30babada04bec07">is_option_with_arg</a>(<span class="stringliteral">&quot;internal-encoding&quot;</span>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aba0717d2689eb68797421a02ab9295c6">Qfalse</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aacea3516b33941ce8149098e223a7466">Qtrue</a>)) {
<a name="l01036"></a>01036                 <a class="code" href="../../df/d77/ruby_8c.html#ab7b9b0e7d80b52038a52938a443b1943">set_internal_encoding_once</a>(opt, s, 0);
<a name="l01037"></a>01037             }
<a name="l01038"></a>01038             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../df/d77/ruby_8c.html#a2cf1a398ca494cfae30babada04bec07">is_option_with_arg</a>(<span class="stringliteral">&quot;external-encoding&quot;</span>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aba0717d2689eb68797421a02ab9295c6">Qfalse</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aacea3516b33941ce8149098e223a7466">Qtrue</a>)) {
<a name="l01039"></a>01039                 <a class="code" href="../../df/d77/ruby_8c.html#aee02be42c35b671e153c45359ca683f0">set_external_encoding_once</a>(opt, s, 0);
<a name="l01040"></a>01040             }
<a name="l01041"></a>01041 <span class="preprocessor">#if defined ALLOW_DEFAULT_SOURCE_ENCODING &amp;&amp; ALLOW_DEFAULT_SOURCE_ENCODING</span>
<a name="l01042"></a>01042 <span class="preprocessor"></span>            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../df/d77/ruby_8c.html#a2cf1a398ca494cfae30babada04bec07">is_option_with_arg</a>(<span class="stringliteral">&quot;source-encoding&quot;</span>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aba0717d2689eb68797421a02ab9295c6">Qfalse</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aacea3516b33941ce8149098e223a7466">Qtrue</a>)) {
<a name="l01043"></a>01043                 <a class="code" href="../../df/d77/ruby_8c.html#a10cd58bd463ddd39fa627151480d2c2e">set_source_encoding_once</a>(opt, s, 0);
<a name="l01044"></a>01044             }
<a name="l01045"></a>01045 <span class="preprocessor">#endif</span>
<a name="l01046"></a>01046 <span class="preprocessor"></span>            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(<span class="stringliteral">&quot;version&quot;</span>, s) == 0) {
<a name="l01047"></a>01047                 <span class="keywordflow">if</span> (envopt) <span class="keywordflow">goto</span> noenvopt_long;
<a name="l01048"></a>01048                 opt-&gt;<a class="code" href="../../d1/de6/structcmdline__options.html#a48863cb6a5e38f32ec34e0cc02aaf3df">dump</a> |= <a class="code" href="../../df/d77/ruby_8c.html#a407222be54393f7e01842b5d79c25f55">DUMP_BIT</a>(<a class="code" href="../../d6/da0/nkf-utf8_2nkf_8c.html#a4fbbbc8d035c85ce83c6f270a2e56012">version</a>);
<a name="l01049"></a>01049             }
<a name="l01050"></a>01050             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(<span class="stringliteral">&quot;verbose&quot;</span>, s) == 0) {
<a name="l01051"></a>01051                 opt-&gt;<a class="code" href="../../d1/de6/structcmdline__options.html#a473a2d767a06b33c82cf4e5f4d3a41f8">verbose</a> = 1;
<a name="l01052"></a>01052                 <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a56087d5316e4c73027105c023006cb15">ruby_verbose</a> = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aacea3516b33941ce8149098e223a7466">Qtrue</a>;
<a name="l01053"></a>01053             }
<a name="l01054"></a>01054             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(<span class="stringliteral">&quot;yydebug&quot;</span>, s) == 0) {
<a name="l01055"></a>01055                 <span class="keywordflow">if</span> (envopt) <span class="keywordflow">goto</span> noenvopt_long;
<a name="l01056"></a>01056                 opt-&gt;<a class="code" href="../../d1/de6/structcmdline__options.html#a48863cb6a5e38f32ec34e0cc02aaf3df">dump</a> |= <a class="code" href="../../df/d77/ruby_8c.html#a407222be54393f7e01842b5d79c25f55">DUMP_BIT</a>(<a class="code" href="../../d5/d11/ripper_8c.html#a7fde6236fcb0f6e5d1d20ce98d9f0d01">yydebug</a>);
<a name="l01057"></a>01057             }
<a name="l01058"></a>01058             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../df/d77/ruby_8c.html#a2cf1a398ca494cfae30babada04bec07">is_option_with_arg</a>(<span class="stringliteral">&quot;dump&quot;</span>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aba0717d2689eb68797421a02ab9295c6">Qfalse</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aba0717d2689eb68797421a02ab9295c6">Qfalse</a>)) {
<a name="l01059"></a>01059                 <a class="code" href="../../d8/d3c/util_8h.html#ada6fc505a58f8b3f24821f94e0e5ec32">ruby_each_words</a>(s, <a class="code" href="../../df/d77/ruby_8c.html#a81c13867a601b1a9f7e605c8f50f84ac">dump_option</a>, &amp;opt-&gt;<a class="code" href="../../d1/de6/structcmdline__options.html#a48863cb6a5e38f32ec34e0cc02aaf3df">dump</a>);
<a name="l01060"></a>01060             }
<a name="l01061"></a>01061             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(<span class="stringliteral">&quot;help&quot;</span>, s) == 0) {
<a name="l01062"></a>01062                 <span class="keywordflow">if</span> (envopt) <span class="keywordflow">goto</span> noenvopt_long;
<a name="l01063"></a>01063                 opt-&gt;<a class="code" href="../../d1/de6/structcmdline__options.html#a48863cb6a5e38f32ec34e0cc02aaf3df">dump</a> |= <a class="code" href="../../df/d77/ruby_8c.html#a407222be54393f7e01842b5d79c25f55">DUMP_BIT</a>(<a class="code" href="../../df/d77/ruby_8c.html#ab24984492570c9e0e802e45300d2eb82">usage</a>);
<a name="l01064"></a>01064                 <span class="keywordflow">goto</span> switch_end;
<a name="l01065"></a>01065             }
<a name="l01066"></a>01066             <span class="keywordflow">else</span> {
<a name="l01067"></a>01067                 <a class="code" href="../../db/dcc/error_8c.html#a0f771a2840561f1838169b3d7d4616f3">rb_raise</a>(<a class="code" href="../../db/dcc/error_8c.html#a95ad3953d535707e2cf2b1d837f5e253">rb_eRuntimeError</a>,
<a name="l01068"></a>01068                          <span class="stringliteral">&quot;invalid option --%s  (-h will show valid options)&quot;</span>, s);
<a name="l01069"></a>01069             }
<a name="l01070"></a>01070             <span class="keywordflow">break</span>;
<a name="l01071"></a>01071 
<a name="l01072"></a>01072           <span class="keywordflow">case</span> <span class="charliteral">&apos;\r&apos;</span>:
<a name="l01073"></a>01073             <span class="keywordflow">if</span> (!s[1])
<a name="l01074"></a>01074                 <span class="keywordflow">break</span>;
<a name="l01075"></a>01075 
<a name="l01076"></a>01076           <span class="keywordflow">default</span>:
<a name="l01077"></a>01077             {
<a name="l01078"></a>01078                 <span class="keywordflow">if</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#af65108a54093e5c7220dfc15f6cd9db1">ISPRINT</a>(*s)) {
<a name="l01079"></a>01079                     <a class="code" href="../../db/dcc/error_8c.html#a0f771a2840561f1838169b3d7d4616f3">rb_raise</a>(<a class="code" href="../../db/dcc/error_8c.html#a95ad3953d535707e2cf2b1d837f5e253">rb_eRuntimeError</a>,
<a name="l01080"></a>01080                         <span class="stringliteral">&quot;invalid option -%c  (-h will show valid options)&quot;</span>,
<a name="l01081"></a>01081                         (<span class="keywordtype">int</span>)(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)*s);
<a name="l01082"></a>01082                 }
<a name="l01083"></a>01083                 <span class="keywordflow">else</span> {
<a name="l01084"></a>01084                     <a class="code" href="../../db/dcc/error_8c.html#a0f771a2840561f1838169b3d7d4616f3">rb_raise</a>(<a class="code" href="../../db/dcc/error_8c.html#a95ad3953d535707e2cf2b1d837f5e253">rb_eRuntimeError</a>,
<a name="l01085"></a>01085                         <span class="stringliteral">&quot;invalid option -\\x%02X  (-h will show valid options)&quot;</span>,
<a name="l01086"></a>01086                         (<span class="keywordtype">int</span>)(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)*s);
<a name="l01087"></a>01087                 }
<a name="l01088"></a>01088             }
<a name="l01089"></a>01089             <span class="keywordflow">goto</span> switch_end;
<a name="l01090"></a>01090 
<a name="l01091"></a>01091           noenvopt:
<a name="l01092"></a>01092             <span class="comment">/* &quot;EIdvwWrKU&quot; only */</span>
<a name="l01093"></a>01093             <a class="code" href="../../db/dcc/error_8c.html#a0f771a2840561f1838169b3d7d4616f3">rb_raise</a>(<a class="code" href="../../db/dcc/error_8c.html#a95ad3953d535707e2cf2b1d837f5e253">rb_eRuntimeError</a>, <span class="stringliteral">&quot;invalid switch in RUBYOPT: -%c&quot;</span>, *s);
<a name="l01094"></a>01094             <span class="keywordflow">break</span>;
<a name="l01095"></a>01095 
<a name="l01096"></a>01096           noenvopt_long:
<a name="l01097"></a>01097             <a class="code" href="../../db/dcc/error_8c.html#a0f771a2840561f1838169b3d7d4616f3">rb_raise</a>(<a class="code" href="../../db/dcc/error_8c.html#a95ad3953d535707e2cf2b1d837f5e253">rb_eRuntimeError</a>, <span class="stringliteral">&quot;invalid switch in RUBYOPT: --%s&quot;</span>, s);
<a name="l01098"></a>01098             <span class="keywordflow">break</span>;
<a name="l01099"></a>01099 
<a name="l01100"></a>01100           <span class="keywordflow">case</span> 0:
<a name="l01101"></a>01101             <span class="keywordflow">break</span>;
<a name="l01102"></a>01102 <span class="preprocessor">#       undef is_option_end</span>
<a name="l01103"></a>01103 <span class="preprocessor"></span><span class="preprocessor">#       undef check_envopt</span>
<a name="l01104"></a>01104 <span class="preprocessor"></span><span class="preprocessor">#       undef need_argument</span>
<a name="l01105"></a>01105 <span class="preprocessor"></span><span class="preprocessor">#       undef is_option_with_arg</span>
<a name="l01106"></a>01106 <span class="preprocessor"></span>        }
<a name="l01107"></a>01107     }
<a name="l01108"></a>01108 
<a name="l01109"></a>01109   switch_end:
<a name="l01110"></a>01110     <span class="keywordflow">return</span> argc0 - argc;
<a name="l01111"></a>01111 }
<a name="l01112"></a>01112 
<a name="l01113"></a>01113 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l01114"></a><a class="code" href="../../df/d77/ruby_8c.html#ad59009a9d3d7a98d4aa4aaab7ed317fd">01114</a> <a class="code" href="../../df/d77/ruby_8c.html#ad59009a9d3d7a98d4aa4aaab7ed317fd">ruby_init_prelude</a>(<span class="keywordtype">void</span>)
<a name="l01115"></a>01115 {
<a name="l01116"></a>01116     <a class="code" href="../../d0/d58/miniprelude_8c.html#a74248dee03008b1e0823f1a4c03af77d">Init_prelude</a>();
<a name="l01117"></a>01117     <a class="code" href="../../db/d2e/intern_8h.html#ad8a328ed07e92080d565e30211941eef">rb_const_remove</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a57c96ead3ef230b4838e65fe037c346e">rb_cObject</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a5753547d6a21eeb36aa8cb0ae7d6c9ce">rb_intern_const</a>(<span class="stringliteral">&quot;TMP_RUBY_PREFIX&quot;</span>));
<a name="l01118"></a>01118 }
<a name="l01119"></a>01119 
<a name="l01120"></a>01120 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l01121"></a><a class="code" href="../../df/d77/ruby_8c.html#a5f0ba26c0b772d799188ca7905c4089a">01121</a> <a class="code" href="../../df/d77/ruby_8c.html#a5f0ba26c0b772d799188ca7905c4089a">opt_enc_index</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <a class="code" href="../../d5/db5/encoding_8c.html#aa020a886cff98ea2edead4231ff72973">enc_name</a>)
<a name="l01122"></a>01122 {
<a name="l01123"></a>01123     <span class="keyword">const</span> <span class="keywordtype">char</span> *s = <a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(enc_name);
<a name="l01124"></a>01124     <span class="keywordtype">int</span> i = <a class="code" href="../../d5/db5/encoding_8c.html#adeb5f5b97ea43528a55d717add8f64c5">rb_enc_find_index</a>(s);
<a name="l01125"></a>01125 
<a name="l01126"></a>01126     <span class="keywordflow">if</span> (i &lt; 0) {
<a name="l01127"></a>01127         <a class="code" href="../../db/dcc/error_8c.html#a0f771a2840561f1838169b3d7d4616f3">rb_raise</a>(<a class="code" href="../../db/dcc/error_8c.html#a95ad3953d535707e2cf2b1d837f5e253">rb_eRuntimeError</a>, <span class="stringliteral">&quot;unknown encoding name - %s&quot;</span>, s);
<a name="l01128"></a>01128     }
<a name="l01129"></a>01129     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d5/de3/encoding_8h.html#a2979c0f6fe1dd9fef0c79db81687c00f">rb_enc_dummy_p</a>(<a class="code" href="../../d5/db5/encoding_8c.html#aef9c377b2d9d78b9f88e890b77593109">rb_enc_from_index</a>(i))) {
<a name="l01130"></a>01130         <a class="code" href="../../db/dcc/error_8c.html#a0f771a2840561f1838169b3d7d4616f3">rb_raise</a>(<a class="code" href="../../db/dcc/error_8c.html#a95ad3953d535707e2cf2b1d837f5e253">rb_eRuntimeError</a>, <span class="stringliteral">&quot;dummy encoding is not acceptable - %s &quot;</span>, s);
<a name="l01131"></a>01131     }
<a name="l01132"></a>01132     <span class="keywordflow">return</span> i;
<a name="l01133"></a>01133 }
<a name="l01134"></a>01134 
<a name="l01135"></a><a class="code" href="../../df/d77/ruby_8c.html#ae28cabfebc4bb8a54c5a3d47d8f252d7">01135</a> <span class="preprocessor">#define rb_progname (GET_VM()-&gt;progname)</span>
<a name="l01136"></a><a class="code" href="../../df/d77/ruby_8c.html#a0a4c6faf1ff2a0cf3c444aff1b99d4e0">01136</a> <span class="preprocessor"></span><a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <a class="code" href="../../db/d2e/intern_8h.html#a70f81ab8c056ec13134cc7a35868d565">rb_argv0</a>;
<a name="l01137"></a>01137 
<a name="l01138"></a>01138 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l01139"></a><a class="code" href="../../df/d77/ruby_8c.html#a8c96e7c3fe79a59bc328daa39f90aa22">01139</a> <a class="code" href="../../df/d77/ruby_8c.html#a8c96e7c3fe79a59bc328daa39f90aa22">false_value</a>(<span class="keywordtype">void</span>)
<a name="l01140"></a>01140 {
<a name="l01141"></a>01141     <span class="keywordflow">return</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aba0717d2689eb68797421a02ab9295c6">Qfalse</a>;
<a name="l01142"></a>01142 }
<a name="l01143"></a>01143 
<a name="l01144"></a>01144 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l01145"></a><a class="code" href="../../df/d77/ruby_8c.html#a4b7c0eb507a4ca87543ced237dcdfdde">01145</a> <a class="code" href="../../df/d77/ruby_8c.html#a4b7c0eb507a4ca87543ced237dcdfdde">true_value</a>(<span class="keywordtype">void</span>)
<a name="l01146"></a>01146 {
<a name="l01147"></a>01147     <span class="keywordflow">return</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aacea3516b33941ce8149098e223a7466">Qtrue</a>;
<a name="l01148"></a>01148 }
<a name="l01149"></a>01149 
<a name="l01150"></a><a class="code" href="../../df/d77/ruby_8c.html#a28563a913e3f4eccb3f23cd93215e6d9">01150</a> <span class="preprocessor">#define rb_define_readonly_boolean(name, val) \</span>
<a name="l01151"></a>01151 <span class="preprocessor">    rb_define_virtual_variable((name), (val) ? true_value : false_value, 0)</span>
<a name="l01152"></a>01152 <span class="preprocessor"></span>
<a name="l01153"></a>01153 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l01154"></a><a class="code" href="../../df/d77/ruby_8c.html#aa8524f0347e358ceb9cc955d3f250e44">01154</a> <a class="code" href="../../df/d77/ruby_8c.html#aa8524f0347e358ceb9cc955d3f250e44">uscore_get</a>(<span class="keywordtype">void</span>)
<a name="l01155"></a>01155 {
<a name="l01156"></a>01156     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> line;
<a name="l01157"></a>01157 
<a name="l01158"></a>01158     line = <a class="code" href="../../db/d2e/intern_8h.html#ac185acdaeb1aadf3f4297609e05fd083">rb_lastline_get</a>();
<a name="l01159"></a>01159     <span class="keywordflow">if</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a394faf7191f18552a20cb17ce14226f0">TYPE</a>(line) != <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a22a8c2a4bbaae9b68f65c9bb92fd4e39">T_STRING</a>) {
<a name="l01160"></a>01160         <a class="code" href="../../db/dcc/error_8c.html#a0f771a2840561f1838169b3d7d4616f3">rb_raise</a>(<a class="code" href="../../db/dcc/error_8c.html#a565ed9d70f4089e1b4a36e9b3381b8c6">rb_eTypeError</a>, <span class="stringliteral">&quot;$_ value need to be String (%s given)&quot;</span>,
<a name="l01161"></a>01161                  <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a4832bad8845a35fc50f7a160901854a1">NIL_P</a>(line) ? <span class="stringliteral">&quot;nil&quot;</span> : <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a9b4f42ada717bfbe7a78830639476aed">rb_obj_classname</a>(line));
<a name="l01162"></a>01162     }
<a name="l01163"></a>01163     <span class="keywordflow">return</span> line;
<a name="l01164"></a>01164 }
<a name="l01165"></a>01165 
<a name="l01166"></a>01166 <span class="comment">/*</span>
<a name="l01167"></a>01167 <span class="comment"> *  call-seq:</span>
<a name="l01168"></a>01168 <span class="comment"> *     sub(pattern, replacement)   -&gt; $_</span>
<a name="l01169"></a>01169 <span class="comment"> *     sub(pattern) { block }      -&gt; $_</span>
<a name="l01170"></a>01170 <span class="comment"> *</span>
<a name="l01171"></a>01171 <span class="comment"> *  Equivalent to &lt;code&gt;$_.sub(&lt;i&gt;args&lt;/i&gt;)&lt;/code&gt;, except that</span>
<a name="l01172"></a>01172 <span class="comment"> *  &lt;code&gt;$_&lt;/code&gt; will be updated if substitution occurs.</span>
<a name="l01173"></a>01173 <span class="comment"> *  Available only when -p/-n command line option specified.</span>
<a name="l01174"></a>01174 <span class="comment"> */</span>
<a name="l01175"></a>01175 
<a name="l01176"></a>01176 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l01177"></a><a class="code" href="../../df/d77/ruby_8c.html#afded7712c6b518d3995c464da8c64acc">01177</a> <a class="code" href="../../df/d77/ruby_8c.html#afded7712c6b518d3995c464da8c64acc">rb_f_sub</a>(<a class="code" href="../../df/d77/ruby_8c.html#ad1447518f4372828b8435ae82e48499e">argc</a>, <a class="code" href="../../df/d77/ruby_8c.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>)
<a name="l01178"></a>01178     int <a class="code" href="../../df/d77/ruby_8c.html#ad1447518f4372828b8435ae82e48499e">argc</a>;
<a name="l01179"></a>01179     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> *<a class="code" href="../../df/d77/ruby_8c.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>;
<a name="l01180"></a>01180 {
<a name="l01181"></a>01181     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str = <a class="code" href="../../dd/de7/passing__block_8c.html#a6d8090fb4b1b60f648b2d63a0c6b40d1">rb_funcall_passing_block</a>(<a class="code" href="../../df/d77/ruby_8c.html#aa8524f0347e358ceb9cc955d3f250e44">uscore_get</a>(), <a class="code" href="../../dc/dcc/array_8c.html#a9cfa42d4b79c89d68c53be8b2150a503">rb_intern</a>(<span class="stringliteral">&quot;sub&quot;</span>), argc, argv);
<a name="l01182"></a>01182     <a class="code" href="../../db/d2e/intern_8h.html#ada36b7e0e23335fa38937f0b5328601d">rb_lastline_set</a>(str);
<a name="l01183"></a>01183     <span class="keywordflow">return</span> str;
<a name="l01184"></a>01184 }
<a name="l01185"></a>01185 
<a name="l01186"></a>01186 <span class="comment">/*</span>
<a name="l01187"></a>01187 <span class="comment"> *  call-seq:</span>
<a name="l01188"></a>01188 <span class="comment"> *     gsub(pattern, replacement)    -&gt; string</span>
<a name="l01189"></a>01189 <span class="comment"> *     gsub(pattern) {|...| block }  -&gt; string</span>
<a name="l01190"></a>01190 <span class="comment"> *</span>
<a name="l01191"></a>01191 <span class="comment"> *  Equivalent to &lt;code&gt;$_.gsub...&lt;/code&gt;, except that &lt;code&gt;$_&lt;/code&gt;</span>
<a name="l01192"></a>01192 <span class="comment"> *  receives the modified result.</span>
<a name="l01193"></a>01193 <span class="comment"> *  Available only when -p/-n command line option specified.</span>
<a name="l01194"></a>01194 <span class="comment"> *</span>
<a name="l01195"></a>01195 <span class="comment"> */</span>
<a name="l01196"></a>01196 
<a name="l01197"></a>01197 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l01198"></a><a class="code" href="../../df/d77/ruby_8c.html#aa893bcb11c37ef54ec38154a76247438">01198</a> <a class="code" href="../../df/d77/ruby_8c.html#aa893bcb11c37ef54ec38154a76247438">rb_f_gsub</a>(<a class="code" href="../../df/d77/ruby_8c.html#ad1447518f4372828b8435ae82e48499e">argc</a>, <a class="code" href="../../df/d77/ruby_8c.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>)
<a name="l01199"></a>01199     int <a class="code" href="../../df/d77/ruby_8c.html#ad1447518f4372828b8435ae82e48499e">argc</a>;
<a name="l01200"></a>01200     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> *<a class="code" href="../../df/d77/ruby_8c.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>;
<a name="l01201"></a>01201 {
<a name="l01202"></a>01202     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str = <a class="code" href="../../dd/de7/passing__block_8c.html#a6d8090fb4b1b60f648b2d63a0c6b40d1">rb_funcall_passing_block</a>(<a class="code" href="../../df/d77/ruby_8c.html#aa8524f0347e358ceb9cc955d3f250e44">uscore_get</a>(), <a class="code" href="../../dc/dcc/array_8c.html#a9cfa42d4b79c89d68c53be8b2150a503">rb_intern</a>(<span class="stringliteral">&quot;gsub&quot;</span>), argc, argv);
<a name="l01203"></a>01203     <a class="code" href="../../db/d2e/intern_8h.html#ada36b7e0e23335fa38937f0b5328601d">rb_lastline_set</a>(str);
<a name="l01204"></a>01204     <span class="keywordflow">return</span> str;
<a name="l01205"></a>01205 }
<a name="l01206"></a>01206 
<a name="l01207"></a>01207 <span class="comment">/*</span>
<a name="l01208"></a>01208 <span class="comment"> *  call-seq:</span>
<a name="l01209"></a>01209 <span class="comment"> *     chop   -&gt; string</span>
<a name="l01210"></a>01210 <span class="comment"> *</span>
<a name="l01211"></a>01211 <span class="comment"> *  Equivalent to &lt;code&gt;($_.dup).chop!&lt;/code&gt;, except &lt;code&gt;nil&lt;/code&gt;</span>
<a name="l01212"></a>01212 <span class="comment"> *  is never returned. See &lt;code&gt;String#chop!&lt;/code&gt;.</span>
<a name="l01213"></a>01213 <span class="comment"> *  Available only when -p/-n command line option specified.</span>
<a name="l01214"></a>01214 <span class="comment"> *</span>
<a name="l01215"></a>01215 <span class="comment"> */</span>
<a name="l01216"></a>01216 
<a name="l01217"></a>01217 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l01218"></a><a class="code" href="../../df/d77/ruby_8c.html#a6f2ddb51efe1d1c5320cc8901e50eb86">01218</a> <a class="code" href="../../df/d77/ruby_8c.html#a6f2ddb51efe1d1c5320cc8901e50eb86">rb_f_chop</a>(<span class="keywordtype">void</span>)
<a name="l01219"></a>01219 {
<a name="l01220"></a>01220     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str = <a class="code" href="../../dd/de7/passing__block_8c.html#a6d8090fb4b1b60f648b2d63a0c6b40d1">rb_funcall_passing_block</a>(<a class="code" href="../../df/d77/ruby_8c.html#aa8524f0347e358ceb9cc955d3f250e44">uscore_get</a>(), <a class="code" href="../../dc/dcc/array_8c.html#a9cfa42d4b79c89d68c53be8b2150a503">rb_intern</a>(<span class="stringliteral">&quot;chop&quot;</span>), 0, 0);
<a name="l01221"></a>01221     <a class="code" href="../../db/d2e/intern_8h.html#ada36b7e0e23335fa38937f0b5328601d">rb_lastline_set</a>(str);
<a name="l01222"></a>01222     <span class="keywordflow">return</span> str;
<a name="l01223"></a>01223 }
<a name="l01224"></a>01224 
<a name="l01225"></a>01225 
<a name="l01226"></a>01226 <span class="comment">/*</span>
<a name="l01227"></a>01227 <span class="comment"> *  call-seq:</span>
<a name="l01228"></a>01228 <span class="comment"> *     chomp            -&gt; $_</span>
<a name="l01229"></a>01229 <span class="comment"> *     chomp(string)    -&gt; $_</span>
<a name="l01230"></a>01230 <span class="comment"> *</span>
<a name="l01231"></a>01231 <span class="comment"> *  Equivalent to &lt;code&gt;$_ = $_.chomp(&lt;em&gt;string&lt;/em&gt;)&lt;/code&gt;. See</span>
<a name="l01232"></a>01232 <span class="comment"> *  &lt;code&gt;String#chomp&lt;/code&gt;.</span>
<a name="l01233"></a>01233 <span class="comment"> *  Available only when -p/-n command line option specified.</span>
<a name="l01234"></a>01234 <span class="comment"> *</span>
<a name="l01235"></a>01235 <span class="comment"> */</span>
<a name="l01236"></a>01236 
<a name="l01237"></a>01237 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l01238"></a><a class="code" href="../../df/d77/ruby_8c.html#a80a58bbefd82cae994ab3ad257ad1c38">01238</a> <a class="code" href="../../df/d77/ruby_8c.html#a80a58bbefd82cae994ab3ad257ad1c38">rb_f_chomp</a>(<a class="code" href="../../df/d77/ruby_8c.html#ad1447518f4372828b8435ae82e48499e">argc</a>, <a class="code" href="../../df/d77/ruby_8c.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>)
<a name="l01239"></a>01239     int <a class="code" href="../../df/d77/ruby_8c.html#ad1447518f4372828b8435ae82e48499e">argc</a>;
<a name="l01240"></a>01240     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> *<a class="code" href="../../df/d77/ruby_8c.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>;
<a name="l01241"></a>01241 {
<a name="l01242"></a>01242     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> str = <a class="code" href="../../dd/de7/passing__block_8c.html#a6d8090fb4b1b60f648b2d63a0c6b40d1">rb_funcall_passing_block</a>(<a class="code" href="../../df/d77/ruby_8c.html#aa8524f0347e358ceb9cc955d3f250e44">uscore_get</a>(), <a class="code" href="../../dc/dcc/array_8c.html#a9cfa42d4b79c89d68c53be8b2150a503">rb_intern</a>(<span class="stringliteral">&quot;chomp&quot;</span>), argc, argv);
<a name="l01243"></a>01243     <a class="code" href="../../db/d2e/intern_8h.html#ada36b7e0e23335fa38937f0b5328601d">rb_lastline_set</a>(str);
<a name="l01244"></a>01244     <span class="keywordflow">return</span> str;
<a name="l01245"></a>01245 }
<a name="l01246"></a>01246 
<a name="l01247"></a>01247 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l01248"></a><a class="code" href="../../df/d77/ruby_8c.html#a5be541642607b6f62b6bf919146c0b62">01248</a> <a class="code" href="../../df/d77/ruby_8c.html#a5be541642607b6f62b6bf919146c0b62">process_options</a>(<span class="keywordtype">int</span> <a class="code" href="../../df/d77/ruby_8c.html#ad1447518f4372828b8435ae82e48499e">argc</a>, <span class="keywordtype">char</span> **<a class="code" href="../../df/d77/ruby_8c.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>, <span class="keyword">struct</span> <a class="code" href="../../d1/de6/structcmdline__options.html">cmdline_options</a> *opt)
<a name="l01249"></a>01249 {
<a name="l01250"></a>01250     NODE *tree = 0;
<a name="l01251"></a>01251     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> parser;
<a name="l01252"></a>01252     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> iseq;
<a name="l01253"></a>01253     <a class="code" href="../../d1/d7b/struct_onig_encoding_type_s_t.html">rb_encoding</a> *enc, *lenc;
<a name="l01254"></a>01254     <span class="keyword">const</span> <span class="keywordtype">char</span> *s;
<a name="l01255"></a>01255     <span class="keywordtype">char</span> <a class="code" href="../../d7/d1e/dln__find_8c.html#ac5db579e4fad392fab4cc5f012c79f5f">fbuf</a>[<a class="code" href="../../d1/ddc/dln_8c.html#addfa831c1473e710d2b71b72fd7fcfa5">MAXPATHLEN</a>];
<a name="l01256"></a>01256     <span class="keywordtype">int</span> i = (int)<a class="code" href="../../df/d77/ruby_8c.html#ab4952e1c881356feb1c53006c25517b3">proc_options</a>(argc, argv, opt, 0);
<a name="l01257"></a>01257     <a class="code" href="../../d2/d66/structrb__thread__struct.html">rb_thread_t</a> *th = <a class="code" href="../../d8/d32/vm__core_8h.html#a8deb84ec6023e3229db88ac2c9da6138">GET_THREAD</a>();
<a name="l01258"></a>01258     <a class="code" href="../../d0/d73/structrb__env__t.html">rb_env_t</a> *<a class="code" href="../../d5/df2/win32_8c.html#af973ca20f6594ad664c03daa83867128">env</a> = 0;
<a name="l01259"></a>01259 
<a name="l01260"></a>01260     argc -= i;
<a name="l01261"></a>01261     argv += i;
<a name="l01262"></a>01262 
<a name="l01263"></a>01263     <span class="keywordflow">if</span> (opt-&gt;<a class="code" href="../../d1/de6/structcmdline__options.html#a48863cb6a5e38f32ec34e0cc02aaf3df">dump</a> &amp; <a class="code" href="../../df/d77/ruby_8c.html#a407222be54393f7e01842b5d79c25f55">DUMP_BIT</a>(<a class="code" href="../../df/d77/ruby_8c.html#ab24984492570c9e0e802e45300d2eb82">usage</a>)) {
<a name="l01264"></a>01264         <a class="code" href="../../df/d77/ruby_8c.html#ab24984492570c9e0e802e45300d2eb82">usage</a>(<a class="code" href="../../df/d77/ruby_8c.html#a6c2ae3c3abc05179cb0a01ec5918b38a">origarg</a>.argv[0]);
<a name="l01265"></a>01265         <span class="keywordflow">return</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aacea3516b33941ce8149098e223a7466">Qtrue</a>;
<a name="l01266"></a>01266     }
<a name="l01267"></a>01267 
<a name="l01268"></a>01268     <span class="keywordflow">if</span> (!(opt-&gt;<a class="code" href="../../d1/de6/structcmdline__options.html#a43a59903d1fda92df5c8bf5fc27c880e">disable</a> &amp; <a class="code" href="../../df/d77/ruby_8c.html#aa374558b5c6c7775e039a0b2cf9b4498">DISABLE_BIT</a>(rubyopt)) &amp;&amp;
<a name="l01269"></a>01269         opt-&gt;<a class="code" href="../../d1/de6/structcmdline__options.html#a63be2eaa4c22858f34bda26de79a13c0">safe_level</a> == 0 &amp;&amp; (s = <a class="code" href="../../de/d32/dir_8c.html#aee28fd8a0e40b6d958f7d20348e45368">getenv</a>(<span class="stringliteral">&quot;RUBYOPT&quot;</span>))) {
<a name="l01270"></a>01270         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> src_enc_name = opt-&gt;<a class="code" href="../../d1/de6/structcmdline__options.html#a13f1f0d4bc385de1d92ac617f5fc8b2a">src</a>.<a class="code" href="../../d1/de6/structcmdline__options.html#a89ae067a92ade681a2ba731d8aa7bffc">enc</a>.name;
<a name="l01271"></a>01271         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> ext_enc_name = opt-&gt;<a class="code" href="../../d1/de6/structcmdline__options.html#ae4fff502bd9884529c1f31ab938a436c">ext</a>.<a class="code" href="../../d1/de6/structcmdline__options.html#a89ae067a92ade681a2ba731d8aa7bffc">enc</a>.name;
<a name="l01272"></a>01272         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> int_enc_name = opt-&gt;<a class="code" href="../../d1/de6/structcmdline__options.html#acae7690c90303f7a134f0baf1ed8c5ed">intern</a>.<a class="code" href="../../d1/de6/structcmdline__options.html#a89ae067a92ade681a2ba731d8aa7bffc">enc</a>.name;
<a name="l01273"></a>01273 
<a name="l01274"></a>01274         opt-&gt;<a class="code" href="../../d1/de6/structcmdline__options.html#a13f1f0d4bc385de1d92ac617f5fc8b2a">src</a>.<a class="code" href="../../d1/de6/structcmdline__options.html#a89ae067a92ade681a2ba731d8aa7bffc">enc</a>.name = opt-&gt;<a class="code" href="../../d1/de6/structcmdline__options.html#ae4fff502bd9884529c1f31ab938a436c">ext</a>.<a class="code" href="../../d1/de6/structcmdline__options.html#a89ae067a92ade681a2ba731d8aa7bffc">enc</a>.name = opt-&gt;<a class="code" href="../../d1/de6/structcmdline__options.html#acae7690c90303f7a134f0baf1ed8c5ed">intern</a>.<a class="code" href="../../d1/de6/structcmdline__options.html#a89ae067a92ade681a2ba731d8aa7bffc">enc</a>.name = 0;
<a name="l01275"></a>01275         <a class="code" href="../../df/d77/ruby_8c.html#afa6e13329102453f3e95157a46485847">moreswitches</a>(s, opt, 1);
<a name="l01276"></a>01276         <span class="keywordflow">if</span> (src_enc_name)
<a name="l01277"></a>01277             opt-&gt;<a class="code" href="../../d1/de6/structcmdline__options.html#a13f1f0d4bc385de1d92ac617f5fc8b2a">src</a>.<a class="code" href="../../d1/de6/structcmdline__options.html#a89ae067a92ade681a2ba731d8aa7bffc">enc</a>.name = src_enc_name;
<a name="l01278"></a>01278         <span class="keywordflow">if</span> (ext_enc_name)
<a name="l01279"></a>01279             opt-&gt;<a class="code" href="../../d1/de6/structcmdline__options.html#ae4fff502bd9884529c1f31ab938a436c">ext</a>.<a class="code" href="../../d1/de6/structcmdline__options.html#a89ae067a92ade681a2ba731d8aa7bffc">enc</a>.name = ext_enc_name;
<a name="l01280"></a>01280         <span class="keywordflow">if</span> (int_enc_name)
<a name="l01281"></a>01281             opt-&gt;<a class="code" href="../../d1/de6/structcmdline__options.html#acae7690c90303f7a134f0baf1ed8c5ed">intern</a>.<a class="code" href="../../d1/de6/structcmdline__options.html#a89ae067a92ade681a2ba731d8aa7bffc">enc</a>.name = int_enc_name;
<a name="l01282"></a>01282     }
<a name="l01283"></a>01283 
<a name="l01284"></a>01284     <span class="keywordflow">if</span> (opt-&gt;<a class="code" href="../../d1/de6/structcmdline__options.html#a48863cb6a5e38f32ec34e0cc02aaf3df">dump</a> &amp; <a class="code" href="../../df/d77/ruby_8c.html#a407222be54393f7e01842b5d79c25f55">DUMP_BIT</a>(<a class="code" href="../../d6/da0/nkf-utf8_2nkf_8c.html#a4fbbbc8d035c85ce83c6f270a2e56012">version</a>)) {
<a name="l01285"></a>01285         <a class="code" href="../../db/d2e/intern_8h.html#af1116bc38b8f93d03a817df80b16f634">ruby_show_version</a>();
<a name="l01286"></a>01286         <span class="keywordflow">return</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aacea3516b33941ce8149098e223a7466">Qtrue</a>;
<a name="l01287"></a>01287     }
<a name="l01288"></a>01288     <span class="keywordflow">if</span> (opt-&gt;<a class="code" href="../../d1/de6/structcmdline__options.html#a48863cb6a5e38f32ec34e0cc02aaf3df">dump</a> &amp; <a class="code" href="../../df/d77/ruby_8c.html#a407222be54393f7e01842b5d79c25f55">DUMP_BIT</a>(copyright)) {
<a name="l01289"></a>01289         <a class="code" href="../../db/d2e/intern_8h.html#a9f9eecd227f5c84b8802578c20fcc07b">ruby_show_copyright</a>();
<a name="l01290"></a>01290     }
<a name="l01291"></a>01291 
<a name="l01292"></a>01292     <span class="keywordflow">if</span> (opt-&gt;<a class="code" href="../../d1/de6/structcmdline__options.html#a63be2eaa4c22858f34bda26de79a13c0">safe_level</a> &gt;= 4) {
<a name="l01293"></a>01293         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#afd75ea0cb81c17e76c73e593d1d8a860">OBJ_TAINT</a>(<a class="code" href="../../db/d2e/intern_8h.html#afe9c34a341643ab37d8505e716e68c2a">rb_argv</a>);
<a name="l01294"></a>01294         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#afd75ea0cb81c17e76c73e593d1d8a860">OBJ_TAINT</a>(<a class="code" href="../../d8/d32/vm__core_8h.html#a6cfcd3997994924c8cd13c3b5c099ec6">GET_VM</a>()-&gt;load_path);
<a name="l01295"></a>01295     }
<a name="l01296"></a>01296 
<a name="l01297"></a>01297     <span class="keywordflow">if</span> (!opt-&gt;<a class="code" href="../../d1/de6/structcmdline__options.html#a2e5ed539082d405a331e96b70283510c">e_script</a>) {
<a name="l01298"></a>01298         <span class="keywordflow">if</span> (argc == 0) {        <span class="comment">/* no more args */</span>
<a name="l01299"></a>01299             <span class="keywordflow">if</span> (opt-&gt;<a class="code" href="../../d1/de6/structcmdline__options.html#a473a2d767a06b33c82cf4e5f4d3a41f8">verbose</a>)
<a name="l01300"></a>01300                 <span class="keywordflow">return</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aacea3516b33941ce8149098e223a7466">Qtrue</a>;
<a name="l01301"></a>01301             opt-&gt;<a class="code" href="../../d1/de6/structcmdline__options.html#a450901fd25d06a98bbf8f6525a95d73f">script</a> = <span class="stringliteral">&quot;-&quot;</span>;
<a name="l01302"></a>01302         }
<a name="l01303"></a>01303         <span class="keywordflow">else</span> {
<a name="l01304"></a>01304             opt-&gt;<a class="code" href="../../d1/de6/structcmdline__options.html#a450901fd25d06a98bbf8f6525a95d73f">script</a> = argv[0];
<a name="l01305"></a>01305             <span class="keywordflow">if</span> (opt-&gt;<a class="code" href="../../d1/de6/structcmdline__options.html#a450901fd25d06a98bbf8f6525a95d73f">script</a>[0] == <span class="charliteral">&apos;\0&apos;</span>) {
<a name="l01306"></a>01306                 opt-&gt;<a class="code" href="../../d1/de6/structcmdline__options.html#a450901fd25d06a98bbf8f6525a95d73f">script</a> = <span class="stringliteral">&quot;-&quot;</span>;
<a name="l01307"></a>01307             }
<a name="l01308"></a>01308             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (opt-&gt;<a class="code" href="../../d1/de6/structcmdline__options.html#a407d9ebb05e6359600672c47f01b18db">do_search</a>) {
<a name="l01309"></a>01309                 <span class="keywordtype">char</span> *path = <a class="code" href="../../de/d32/dir_8c.html#aee28fd8a0e40b6d958f7d20348e45368">getenv</a>(<span class="stringliteral">&quot;RUBYPATH&quot;</span>);
<a name="l01310"></a>01310 
<a name="l01311"></a>01311                 opt-&gt;<a class="code" href="../../d1/de6/structcmdline__options.html#a450901fd25d06a98bbf8f6525a95d73f">script</a> = 0;
<a name="l01312"></a>01312                 <span class="keywordflow">if</span> (path) {
<a name="l01313"></a>01313                     opt-&gt;<a class="code" href="../../d1/de6/structcmdline__options.html#a450901fd25d06a98bbf8f6525a95d73f">script</a> = <a class="code" href="../../df/da8/dln_8h.html#a3a0735a41dd1dc32a83eb1a3ac8eeb96">dln_find_file_r</a>(argv[0], path, fbuf, <span class="keyword">sizeof</span>(fbuf));
<a name="l01314"></a>01314                 }
<a name="l01315"></a>01315                 <span class="keywordflow">if</span> (!opt-&gt;<a class="code" href="../../d1/de6/structcmdline__options.html#a450901fd25d06a98bbf8f6525a95d73f">script</a>) {
<a name="l01316"></a>01316                     opt-&gt;<a class="code" href="../../d1/de6/structcmdline__options.html#a450901fd25d06a98bbf8f6525a95d73f">script</a> = <a class="code" href="../../df/da8/dln_8h.html#a3a0735a41dd1dc32a83eb1a3ac8eeb96">dln_find_file_r</a>(argv[0], <a class="code" href="../../de/d32/dir_8c.html#aee28fd8a0e40b6d958f7d20348e45368">getenv</a>(<a class="code" href="../../d8/db0/defines_8h.html#a1417bb0c04e21bbecda1d6738dbcbea3">PATH_ENV</a>), fbuf, <span class="keyword">sizeof</span>(fbuf));
<a name="l01317"></a>01317                 }
<a name="l01318"></a>01318                 <span class="keywordflow">if</span> (!opt-&gt;<a class="code" href="../../d1/de6/structcmdline__options.html#a450901fd25d06a98bbf8f6525a95d73f">script</a>)
<a name="l01319"></a>01319                     opt-&gt;<a class="code" href="../../d1/de6/structcmdline__options.html#a450901fd25d06a98bbf8f6525a95d73f">script</a> = argv[0];
<a name="l01320"></a>01320             }
<a name="l01321"></a>01321             argc--;
<a name="l01322"></a>01322             argv++;
<a name="l01323"></a>01323         }
<a name="l01324"></a>01324     }
<a name="l01325"></a>01325 
<a name="l01326"></a>01326     opt-&gt;<a class="code" href="../../d1/de6/structcmdline__options.html#a97c2411913164ff54f0dcd8405c3a574">script_name</a> = <a class="code" href="../../db/d2e/intern_8h.html#a2b9cc485b0aa1dc270744b8b9eb47569">rb_str_new_cstr</a>(opt-&gt;<a class="code" href="../../d1/de6/structcmdline__options.html#a450901fd25d06a98bbf8f6525a95d73f">script</a>);
<a name="l01327"></a>01327     opt-&gt;<a class="code" href="../../d1/de6/structcmdline__options.html#a450901fd25d06a98bbf8f6525a95d73f">script</a> = <a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(opt-&gt;<a class="code" href="../../d1/de6/structcmdline__options.html#a97c2411913164ff54f0dcd8405c3a574">script_name</a>);
<a name="l01328"></a>01328 <span class="preprocessor">#if defined DOSISH || defined __CYGWIN__</span>
<a name="l01329"></a>01329 <span class="preprocessor"></span>    translit_char(<a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(opt-&gt;<a class="code" href="../../d1/de6/structcmdline__options.html#a97c2411913164ff54f0dcd8405c3a574">script_name</a>), <span class="charliteral">&apos;\\&apos;</span>, <span class="charliteral">&apos;/&apos;</span>);
<a name="l01330"></a>01330 <span class="preprocessor">#endif</span>
<a name="l01331"></a>01331 <span class="preprocessor"></span>
<a name="l01332"></a>01332     <a class="code" href="../../df/d77/ruby_8c.html#a19244cb3740f96ae515f9c7d7cb5e9d6">ruby_init_loadpath_safe</a>(opt-&gt;<a class="code" href="../../d1/de6/structcmdline__options.html#a63be2eaa4c22858f34bda26de79a13c0">safe_level</a>);
<a name="l01333"></a>01333     <a class="code" href="../../d5/db5/encoding_8c.html#adeb5f5b97ea43528a55d717add8f64c5">rb_enc_find_index</a>(<span class="stringliteral">&quot;encdb&quot;</span>);
<a name="l01334"></a>01334     lenc = <a class="code" href="../../d5/db5/encoding_8c.html#a051d22249598e717317cb04798b3d76f">rb_locale_encoding</a>();
<a name="l01335"></a>01335     <a class="code" href="../../d5/db5/encoding_8c.html#a150a6e3ac22ac3be8f8c2ccc74a28e7b">rb_enc_associate</a>(<a class="code" href="../../df/d77/ruby_8c.html#ae28cabfebc4bb8a54c5a3d47d8f252d7">rb_progname</a>, lenc);
<a name="l01336"></a>01336     <a class="code" href="../../db/d2e/intern_8h.html#a8ea3742679211f408cb5769de6cf0d46">rb_obj_freeze</a>(<a class="code" href="../../df/d77/ruby_8c.html#ae28cabfebc4bb8a54c5a3d47d8f252d7">rb_progname</a>);
<a name="l01337"></a>01337     parser = <a class="code" href="../../d5/d11/ripper_8c.html#a175a11311538e1c0c3bc41c96a6a8aaf">rb_parser_new</a>();
<a name="l01338"></a>01338     <span class="keywordflow">if</span> (opt-&gt;<a class="code" href="../../d1/de6/structcmdline__options.html#a48863cb6a5e38f32ec34e0cc02aaf3df">dump</a> &amp; <a class="code" href="../../df/d77/ruby_8c.html#a407222be54393f7e01842b5d79c25f55">DUMP_BIT</a>(<a class="code" href="../../d5/d11/ripper_8c.html#a7fde6236fcb0f6e5d1d20ce98d9f0d01">yydebug</a>)) {
<a name="l01339"></a>01339         <a class="code" href="../../d5/d11/ripper_8c.html#a9c450b504b28c4c599201777d474c64b">rb_parser_set_yydebug</a>(parser, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aacea3516b33941ce8149098e223a7466">Qtrue</a>);
<a name="l01340"></a>01340     }
<a name="l01341"></a>01341     <span class="keywordflow">if</span> (opt-&gt;<a class="code" href="../../d1/de6/structcmdline__options.html#ae4fff502bd9884529c1f31ab938a436c">ext</a>.<a class="code" href="../../d1/de6/structcmdline__options.html#a89ae067a92ade681a2ba731d8aa7bffc">enc</a>.name != 0) {
<a name="l01342"></a>01342         opt-&gt;<a class="code" href="../../d1/de6/structcmdline__options.html#ae4fff502bd9884529c1f31ab938a436c">ext</a>.<a class="code" href="../../d1/de6/structcmdline__options.html#a89ae067a92ade681a2ba731d8aa7bffc">enc</a>.index = <a class="code" href="../../df/d77/ruby_8c.html#a5f0ba26c0b772d799188ca7905c4089a">opt_enc_index</a>(opt-&gt;<a class="code" href="../../d1/de6/structcmdline__options.html#ae4fff502bd9884529c1f31ab938a436c">ext</a>.<a class="code" href="../../d1/de6/structcmdline__options.html#a89ae067a92ade681a2ba731d8aa7bffc">enc</a>.name);
<a name="l01343"></a>01343     }
<a name="l01344"></a>01344     <span class="keywordflow">if</span> (opt-&gt;<a class="code" href="../../d1/de6/structcmdline__options.html#acae7690c90303f7a134f0baf1ed8c5ed">intern</a>.<a class="code" href="../../d1/de6/structcmdline__options.html#a89ae067a92ade681a2ba731d8aa7bffc">enc</a>.name != 0) {
<a name="l01345"></a>01345         opt-&gt;<a class="code" href="../../d1/de6/structcmdline__options.html#acae7690c90303f7a134f0baf1ed8c5ed">intern</a>.<a class="code" href="../../d1/de6/structcmdline__options.html#a89ae067a92ade681a2ba731d8aa7bffc">enc</a>.index = <a class="code" href="../../df/d77/ruby_8c.html#a5f0ba26c0b772d799188ca7905c4089a">opt_enc_index</a>(opt-&gt;<a class="code" href="../../d1/de6/structcmdline__options.html#acae7690c90303f7a134f0baf1ed8c5ed">intern</a>.<a class="code" href="../../d1/de6/structcmdline__options.html#a89ae067a92ade681a2ba731d8aa7bffc">enc</a>.name);
<a name="l01346"></a>01346     }
<a name="l01347"></a>01347     <span class="keywordflow">if</span> (opt-&gt;<a class="code" href="../../d1/de6/structcmdline__options.html#a13f1f0d4bc385de1d92ac617f5fc8b2a">src</a>.<a class="code" href="../../d1/de6/structcmdline__options.html#a89ae067a92ade681a2ba731d8aa7bffc">enc</a>.name != 0) {
<a name="l01348"></a>01348         opt-&gt;<a class="code" href="../../d1/de6/structcmdline__options.html#a13f1f0d4bc385de1d92ac617f5fc8b2a">src</a>.<a class="code" href="../../d1/de6/structcmdline__options.html#a89ae067a92ade681a2ba731d8aa7bffc">enc</a>.index = <a class="code" href="../../df/d77/ruby_8c.html#a5f0ba26c0b772d799188ca7905c4089a">opt_enc_index</a>(opt-&gt;<a class="code" href="../../d1/de6/structcmdline__options.html#a13f1f0d4bc385de1d92ac617f5fc8b2a">src</a>.<a class="code" href="../../d1/de6/structcmdline__options.html#a89ae067a92ade681a2ba731d8aa7bffc">enc</a>.name);
<a name="l01349"></a>01349         <a class="code" href="../../df/d77/ruby_8c.html#a1f4b9ad71556f5bc1fb0ca4d4eab37de">src_encoding_index</a> = opt-&gt;<a class="code" href="../../d1/de6/structcmdline__options.html#a13f1f0d4bc385de1d92ac617f5fc8b2a">src</a>.<a class="code" href="../../d1/de6/structcmdline__options.html#a89ae067a92ade681a2ba731d8aa7bffc">enc</a>.index;
<a name="l01350"></a>01350     }
<a name="l01351"></a>01351     <span class="keywordflow">if</span> (opt-&gt;<a class="code" href="../../d1/de6/structcmdline__options.html#ae4fff502bd9884529c1f31ab938a436c">ext</a>.<a class="code" href="../../d1/de6/structcmdline__options.html#a89ae067a92ade681a2ba731d8aa7bffc">enc</a>.index &gt;= 0) {
<a name="l01352"></a>01352         enc = <a class="code" href="../../d5/db5/encoding_8c.html#aef9c377b2d9d78b9f88e890b77593109">rb_enc_from_index</a>(opt-&gt;<a class="code" href="../../d1/de6/structcmdline__options.html#ae4fff502bd9884529c1f31ab938a436c">ext</a>.<a class="code" href="../../d1/de6/structcmdline__options.html#a89ae067a92ade681a2ba731d8aa7bffc">enc</a>.index);
<a name="l01353"></a>01353     }
<a name="l01354"></a>01354     <span class="keywordflow">else</span> {
<a name="l01355"></a>01355         enc = lenc;
<a name="l01356"></a>01356     }
<a name="l01357"></a>01357     <a class="code" href="../../d5/db5/encoding_8c.html#ad517d83e1b995b4d9c328c7638fbf7cc">rb_enc_set_default_external</a>(<a class="code" href="../../d5/db5/encoding_8c.html#ad4918664be7424ab9f961165eecb6c18">rb_enc_from_encoding</a>(enc));
<a name="l01358"></a>01358     <span class="keywordflow">if</span> (opt-&gt;<a class="code" href="../../d1/de6/structcmdline__options.html#acae7690c90303f7a134f0baf1ed8c5ed">intern</a>.<a class="code" href="../../d1/de6/structcmdline__options.html#a89ae067a92ade681a2ba731d8aa7bffc">enc</a>.index &gt;= 0) {
<a name="l01359"></a>01359         enc = <a class="code" href="../../d5/db5/encoding_8c.html#aef9c377b2d9d78b9f88e890b77593109">rb_enc_from_index</a>(opt-&gt;<a class="code" href="../../d1/de6/structcmdline__options.html#acae7690c90303f7a134f0baf1ed8c5ed">intern</a>.<a class="code" href="../../d1/de6/structcmdline__options.html#a89ae067a92ade681a2ba731d8aa7bffc">enc</a>.index);
<a name="l01360"></a>01360         <a class="code" href="../../d5/db5/encoding_8c.html#a791bfc8b4e88a19eea9ac762015c06df">rb_enc_set_default_internal</a>(<a class="code" href="../../d5/db5/encoding_8c.html#ad4918664be7424ab9f961165eecb6c18">rb_enc_from_encoding</a>(enc));
<a name="l01361"></a>01361         opt-&gt;<a class="code" href="../../d1/de6/structcmdline__options.html#acae7690c90303f7a134f0baf1ed8c5ed">intern</a>.<a class="code" href="../../d1/de6/structcmdline__options.html#a89ae067a92ade681a2ba731d8aa7bffc">enc</a>.index = -1;
<a name="l01362"></a>01362     }
<a name="l01363"></a>01363     <a class="code" href="../../d5/db5/encoding_8c.html#a150a6e3ac22ac3be8f8c2ccc74a28e7b">rb_enc_associate</a>(opt-&gt;<a class="code" href="../../d1/de6/structcmdline__options.html#a97c2411913164ff54f0dcd8405c3a574">script_name</a>, lenc);
<a name="l01364"></a>01364     <a class="code" href="../../db/d2e/intern_8h.html#a8ea3742679211f408cb5769de6cf0d46">rb_obj_freeze</a>(opt-&gt;<a class="code" href="../../d1/de6/structcmdline__options.html#a97c2411913164ff54f0dcd8405c3a574">script_name</a>);
<a name="l01365"></a>01365     {
<a name="l01366"></a>01366         <span class="keywordtype">long</span> i;
<a name="l01367"></a>01367         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> load_path = <a class="code" href="../../d8/d32/vm__core_8h.html#a6cfcd3997994924c8cd13c3b5c099ec6">GET_VM</a>()-&gt;load_path;
<a name="l01368"></a>01368         <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="../../d8/df4/generator_8h.html#ae988773ed219452578f881fc7189c486">RARRAY_LEN</a>(load_path); ++i) {
<a name="l01369"></a>01369             <a class="code" href="../../d5/db5/encoding_8c.html#a150a6e3ac22ac3be8f8c2ccc74a28e7b">rb_enc_associate</a>(<a class="code" href="../../d8/df4/generator_8h.html#abb794fe2d7c73eea87e7ba2273939a8e">RARRAY_PTR</a>(load_path)[i], lenc);
<a name="l01370"></a>01370         }
<a name="l01371"></a>01371     }
<a name="l01372"></a>01372     <span class="keywordflow">if</span> (!(opt-&gt;<a class="code" href="../../d1/de6/structcmdline__options.html#a43a59903d1fda92df5c8bf5fc27c880e">disable</a> &amp; <a class="code" href="../../df/d77/ruby_8c.html#aa374558b5c6c7775e039a0b2cf9b4498">DISABLE_BIT</a>(gems))) {
<a name="l01373"></a>01373 <span class="preprocessor">#if defined DISABLE_RUBYGEMS &amp;&amp; DISABLE_RUBYGEMS</span>
<a name="l01374"></a>01374 <span class="preprocessor"></span>        <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a9f4acbcae9f1821d167c69e5c429bc1b">rb_require</a>(<span class="stringliteral">&quot;rubygems&quot;</span>);
<a name="l01375"></a>01375 <span class="preprocessor">#else</span>
<a name="l01376"></a>01376 <span class="preprocessor"></span>        <a class="code" href="../../de/ddf/group__class.html#ga911071d40f9312e49a774ea0e1b12869">rb_define_module</a>(<span class="stringliteral">&quot;Gem&quot;</span>);
<a name="l01377"></a>01377 <span class="preprocessor">#endif</span>
<a name="l01378"></a>01378 <span class="preprocessor"></span>    }
<a name="l01379"></a>01379     <a class="code" href="../../df/d77/ruby_8c.html#ad59009a9d3d7a98d4aa4aaab7ed317fd">ruby_init_prelude</a>();
<a name="l01380"></a>01380     <a class="code" href="../../db/d2e/intern_8h.html#a2b37b368f133db1234220d20c0c07689">ruby_set_argv</a>(argc, argv);
<a name="l01381"></a>01381     <a class="code" href="../../df/d77/ruby_8c.html#abe32a870ccd68ec109795cb329ddb084">process_sflag</a>(&amp;opt-&gt;<a class="code" href="../../d1/de6/structcmdline__options.html#a8df7ebabf39c6f8ff518824676ff0395">sflag</a>);
<a name="l01382"></a>01382 
<a name="l01383"></a>01383     {
<a name="l01384"></a>01384         <span class="comment">/* set eval context */</span>
<a name="l01385"></a>01385         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> toplevel_binding = <a class="code" href="../../db/d2e/intern_8h.html#a17a81c1a7d754e5ab49fc4b4369b6c8c">rb_const_get</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a57c96ead3ef230b4838e65fe037c346e">rb_cObject</a>, <a class="code" href="../../dc/dcc/array_8c.html#a9cfa42d4b79c89d68c53be8b2150a503">rb_intern</a>(<span class="stringliteral">&quot;TOPLEVEL_BINDING&quot;</span>));
<a name="l01386"></a>01386         <a class="code" href="../../d3/d76/structrb__binding__t.html">rb_binding_t</a> *bind;
<a name="l01387"></a>01387 
<a name="l01388"></a>01388         <a class="code" href="../../d8/d32/vm__core_8h.html#a491d77ec5480e1530e447dbb42481f5b">GetBindingPtr</a>(toplevel_binding, bind);
<a name="l01389"></a>01389         <a class="code" href="../../d8/d32/vm__core_8h.html#aaa39b3177aba775195d515b937ef78ff">GetEnvPtr</a>(bind-&gt;<a class="code" href="../../d3/d76/structrb__binding__t.html#a65f58a22eb376363f727c34b7fde7400">env</a>, env);
<a name="l01390"></a>01390     }
<a name="l01391"></a>01391 
<a name="l01392"></a>01392 <span class="preprocessor">#define PREPARE_PARSE_MAIN(expr) do { \</span>
<a name="l01393"></a>01393 <span class="preprocessor">    th-&gt;parse_in_eval--; \</span>
<a name="l01394"></a>01394 <span class="preprocessor">    th-&gt;base_block = &amp;env-&gt;block; \</span>
<a name="l01395"></a>01395 <span class="preprocessor">    expr; \</span>
<a name="l01396"></a>01396 <span class="preprocessor">    th-&gt;parse_in_eval++; \</span>
<a name="l01397"></a>01397 <span class="preprocessor">    th-&gt;base_block = 0; \</span>
<a name="l01398"></a>01398 <span class="preprocessor">} while (0)</span>
<a name="l01399"></a>01399 <span class="preprocessor"></span>
<a name="l01400"></a>01400     <span class="keywordflow">if</span> (opt-&gt;<a class="code" href="../../d1/de6/structcmdline__options.html#a2e5ed539082d405a331e96b70283510c">e_script</a>) {
<a name="l01401"></a>01401         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> progname = <a class="code" href="../../df/d77/ruby_8c.html#ae28cabfebc4bb8a54c5a3d47d8f252d7">rb_progname</a>;
<a name="l01402"></a>01402         <a class="code" href="../../d1/d7b/struct_onig_encoding_type_s_t.html">rb_encoding</a> *eenc;
<a name="l01403"></a>01403         <span class="keywordflow">if</span> (opt-&gt;<a class="code" href="../../d1/de6/structcmdline__options.html#a13f1f0d4bc385de1d92ac617f5fc8b2a">src</a>.<a class="code" href="../../d1/de6/structcmdline__options.html#a89ae067a92ade681a2ba731d8aa7bffc">enc</a>.index &gt;= 0) {
<a name="l01404"></a>01404             eenc = <a class="code" href="../../d5/db5/encoding_8c.html#aef9c377b2d9d78b9f88e890b77593109">rb_enc_from_index</a>(opt-&gt;<a class="code" href="../../d1/de6/structcmdline__options.html#a13f1f0d4bc385de1d92ac617f5fc8b2a">src</a>.<a class="code" href="../../d1/de6/structcmdline__options.html#a89ae067a92ade681a2ba731d8aa7bffc">enc</a>.index);
<a name="l01405"></a>01405         }
<a name="l01406"></a>01406         <span class="keywordflow">else</span> {
<a name="l01407"></a>01407             eenc = lenc;
<a name="l01408"></a>01408         }
<a name="l01409"></a>01409         <a class="code" href="../../d5/db5/encoding_8c.html#a150a6e3ac22ac3be8f8c2ccc74a28e7b">rb_enc_associate</a>(opt-&gt;<a class="code" href="../../d1/de6/structcmdline__options.html#a2e5ed539082d405a331e96b70283510c">e_script</a>, eenc);
<a name="l01410"></a>01410         <a class="code" href="../../dd/dd0/eval__intern_8h.html#a83ac3f8bc164313d7a1b451f2d2cdabf">rb_vm_set_progname</a>(<a class="code" href="../../df/d77/ruby_8c.html#ae28cabfebc4bb8a54c5a3d47d8f252d7">rb_progname</a> = opt-&gt;<a class="code" href="../../d1/de6/structcmdline__options.html#a97c2411913164ff54f0dcd8405c3a574">script_name</a>);
<a name="l01411"></a>01411         <a class="code" href="../../df/d77/ruby_8c.html#a8c31193e63460680d46fbde2552c18ff">require_libraries</a>(&amp;opt-&gt;<a class="code" href="../../d1/de6/structcmdline__options.html#ab403f7b88211076cbc5cdaf54704857e">req_list</a>);
<a name="l01412"></a>01412         <a class="code" href="../../dd/dd0/eval__intern_8h.html#a83ac3f8bc164313d7a1b451f2d2cdabf">rb_vm_set_progname</a>(<a class="code" href="../../df/d77/ruby_8c.html#ae28cabfebc4bb8a54c5a3d47d8f252d7">rb_progname</a> = progname);
<a name="l01413"></a>01413 
<a name="l01414"></a>01414         <a class="code" href="../../df/d77/ruby_8c.html#a4604b83b6e0a0198466ec5a236c5e0df">PREPARE_PARSE_MAIN</a>({
<a name="l01415"></a>01415             tree = <a class="code" href="../../d5/d11/ripper_8c.html#a7412884de7525393ed236f51925b4c66">rb_parser_compile_string</a>(parser, opt-&gt;<a class="code" href="../../d1/de6/structcmdline__options.html#a450901fd25d06a98bbf8f6525a95d73f">script</a>, opt-&gt;<a class="code" href="../../d1/de6/structcmdline__options.html#a2e5ed539082d405a331e96b70283510c">e_script</a>, 1);
<a name="l01416"></a>01416         });
<a name="l01417"></a>01417     }
<a name="l01418"></a>01418     <span class="keywordflow">else</span> {
<a name="l01419"></a>01419         <span class="keywordflow">if</span> (opt-&gt;<a class="code" href="../../d1/de6/structcmdline__options.html#a450901fd25d06a98bbf8f6525a95d73f">script</a>[0] == <span class="charliteral">&apos;-&apos;</span> &amp;&amp; !opt-&gt;<a class="code" href="../../d1/de6/structcmdline__options.html#a450901fd25d06a98bbf8f6525a95d73f">script</a>[1]) {
<a name="l01420"></a>01420             <a class="code" href="../../df/d77/ruby_8c.html#aefc30916c718aa484a9692900febed5b">forbid_setid</a>(<span class="stringliteral">&quot;program input from stdin&quot;</span>);
<a name="l01421"></a>01421         }
<a name="l01422"></a>01422 
<a name="l01423"></a>01423         <a class="code" href="../../df/d77/ruby_8c.html#a4604b83b6e0a0198466ec5a236c5e0df">PREPARE_PARSE_MAIN</a>({
<a name="l01424"></a>01424             tree = <a class="code" href="../../df/d77/ruby_8c.html#ab71b0792d7f66a50c862061a655aed6a">load_file</a>(parser, opt-&gt;<a class="code" href="../../d1/de6/structcmdline__options.html#a450901fd25d06a98bbf8f6525a95d73f">script</a>, 1, opt);
<a name="l01425"></a>01425         });
<a name="l01426"></a>01426     }
<a name="l01427"></a>01427     <a class="code" href="../../df/d77/ruby_8c.html#ae28cabfebc4bb8a54c5a3d47d8f252d7">rb_progname</a> = opt-&gt;<a class="code" href="../../d1/de6/structcmdline__options.html#a97c2411913164ff54f0dcd8405c3a574">script_name</a>;
<a name="l01428"></a>01428     <a class="code" href="../../dd/dd0/eval__intern_8h.html#a83ac3f8bc164313d7a1b451f2d2cdabf">rb_vm_set_progname</a>(<a class="code" href="../../df/d77/ruby_8c.html#ae28cabfebc4bb8a54c5a3d47d8f252d7">rb_progname</a>);
<a name="l01429"></a>01429     <span class="keywordflow">if</span> (opt-&gt;<a class="code" href="../../d1/de6/structcmdline__options.html#a48863cb6a5e38f32ec34e0cc02aaf3df">dump</a> &amp; <a class="code" href="../../df/d77/ruby_8c.html#a407222be54393f7e01842b5d79c25f55">DUMP_BIT</a>(<a class="code" href="../../d5/d11/ripper_8c.html#a7fde6236fcb0f6e5d1d20ce98d9f0d01">yydebug</a>)) <span class="keywordflow">return</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aacea3516b33941ce8149098e223a7466">Qtrue</a>;
<a name="l01430"></a>01430 
<a name="l01431"></a>01431     <span class="keywordflow">if</span> (opt-&gt;<a class="code" href="../../d1/de6/structcmdline__options.html#ae4fff502bd9884529c1f31ab938a436c">ext</a>.<a class="code" href="../../d1/de6/structcmdline__options.html#a89ae067a92ade681a2ba731d8aa7bffc">enc</a>.index &gt;= 0) {
<a name="l01432"></a>01432         enc = <a class="code" href="../../d5/db5/encoding_8c.html#aef9c377b2d9d78b9f88e890b77593109">rb_enc_from_index</a>(opt-&gt;<a class="code" href="../../d1/de6/structcmdline__options.html#ae4fff502bd9884529c1f31ab938a436c">ext</a>.<a class="code" href="../../d1/de6/structcmdline__options.html#a89ae067a92ade681a2ba731d8aa7bffc">enc</a>.index);
<a name="l01433"></a>01433     }
<a name="l01434"></a>01434     <span class="keywordflow">else</span> {
<a name="l01435"></a>01435         enc = lenc;
<a name="l01436"></a>01436     }
<a name="l01437"></a>01437     <a class="code" href="../../d5/db5/encoding_8c.html#ad517d83e1b995b4d9c328c7638fbf7cc">rb_enc_set_default_external</a>(<a class="code" href="../../d5/db5/encoding_8c.html#ad4918664be7424ab9f961165eecb6c18">rb_enc_from_encoding</a>(enc));
<a name="l01438"></a>01438     <span class="keywordflow">if</span> (opt-&gt;<a class="code" href="../../d1/de6/structcmdline__options.html#acae7690c90303f7a134f0baf1ed8c5ed">intern</a>.<a class="code" href="../../d1/de6/structcmdline__options.html#a89ae067a92ade681a2ba731d8aa7bffc">enc</a>.index &gt;= 0) {
<a name="l01439"></a>01439         <span class="comment">/* Set in the shebang line */</span>
<a name="l01440"></a>01440         enc = <a class="code" href="../../d5/db5/encoding_8c.html#aef9c377b2d9d78b9f88e890b77593109">rb_enc_from_index</a>(opt-&gt;<a class="code" href="../../d1/de6/structcmdline__options.html#acae7690c90303f7a134f0baf1ed8c5ed">intern</a>.<a class="code" href="../../d1/de6/structcmdline__options.html#a89ae067a92ade681a2ba731d8aa7bffc">enc</a>.index);
<a name="l01441"></a>01441         <a class="code" href="../../d5/db5/encoding_8c.html#a791bfc8b4e88a19eea9ac762015c06df">rb_enc_set_default_internal</a>(<a class="code" href="../../d5/db5/encoding_8c.html#ad4918664be7424ab9f961165eecb6c18">rb_enc_from_encoding</a>(enc));
<a name="l01442"></a>01442     }
<a name="l01443"></a>01443     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!<a class="code" href="../../d5/db5/encoding_8c.html#a62b808940b1049f1af6233cbbb828bd6">rb_default_internal_encoding</a>())
<a name="l01444"></a>01444         <span class="comment">/* Freeze default_internal */</span>
<a name="l01445"></a>01445         <a class="code" href="../../d5/db5/encoding_8c.html#a791bfc8b4e88a19eea9ac762015c06df">rb_enc_set_default_internal</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a320970f989dc8294c8203154e3db40c1">Qnil</a>);
<a name="l01446"></a>01446     <a class="code" href="../../df/d0a/io_8c.html#a88e07bc6eaf013e80242a1740e56c9a0">rb_stdio_set_default_encoding</a>();
<a name="l01447"></a>01447 
<a name="l01448"></a>01448     <span class="keywordflow">if</span> (!tree) <span class="keywordflow">return</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aba0717d2689eb68797421a02ab9295c6">Qfalse</a>;
<a name="l01449"></a>01449 
<a name="l01450"></a>01450     <a class="code" href="../../df/d77/ruby_8c.html#abe32a870ccd68ec109795cb329ddb084">process_sflag</a>(&amp;opt-&gt;<a class="code" href="../../d1/de6/structcmdline__options.html#a8df7ebabf39c6f8ff518824676ff0395">sflag</a>);
<a name="l01451"></a>01451     opt-&gt;<a class="code" href="../../d1/de6/structcmdline__options.html#a7d125fcd6f16d94efa3cf072dda67b15">xflag</a> = 0;
<a name="l01452"></a>01452 
<a name="l01453"></a>01453     <span class="keywordflow">if</span> (opt-&gt;<a class="code" href="../../d1/de6/structcmdline__options.html#a63be2eaa4c22858f34bda26de79a13c0">safe_level</a> &gt;= 4) {
<a name="l01454"></a>01454         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a6db7676c6cc4059a7cf021be34f53840">FL_UNSET</a>(<a class="code" href="../../db/d2e/intern_8h.html#afe9c34a341643ab37d8505e716e68c2a">rb_argv</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aada6cee56453d224febc8a330e6bafdb">FL_TAINT</a>);
<a name="l01455"></a>01455         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a6db7676c6cc4059a7cf021be34f53840">FL_UNSET</a>(<a class="code" href="../../d8/d32/vm__core_8h.html#a6cfcd3997994924c8cd13c3b5c099ec6">GET_VM</a>()-&gt;load_path, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aada6cee56453d224febc8a330e6bafdb">FL_TAINT</a>);
<a name="l01456"></a>01456     }
<a name="l01457"></a>01457 
<a name="l01458"></a>01458     <span class="keywordflow">if</span> (opt-&gt;<a class="code" href="../../d1/de6/structcmdline__options.html#a48863cb6a5e38f32ec34e0cc02aaf3df">dump</a> &amp; <a class="code" href="../../df/d77/ruby_8c.html#a407222be54393f7e01842b5d79c25f55">DUMP_BIT</a>(syntax)) {
<a name="l01459"></a>01459         printf(<span class="stringliteral">&quot;Syntax OK\n&quot;</span>);
<a name="l01460"></a>01460         <span class="keywordflow">return</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aacea3516b33941ce8149098e223a7466">Qtrue</a>;
<a name="l01461"></a>01461     }
<a name="l01462"></a>01462 
<a name="l01463"></a>01463     <span class="keywordflow">if</span> (opt-&gt;<a class="code" href="../../d1/de6/structcmdline__options.html#a6993432671b13016c14debd0588a6b9f">do_print</a>) {
<a name="l01464"></a>01464         <a class="code" href="../../df/d77/ruby_8c.html#a4604b83b6e0a0198466ec5a236c5e0df">PREPARE_PARSE_MAIN</a>({
<a name="l01465"></a>01465             tree = <a class="code" href="../../d5/d11/ripper_8c.html#aafe1e960616320da34a446631cf0d679">rb_parser_append_print</a>(parser, tree);
<a name="l01466"></a>01466         });
<a name="l01467"></a>01467     }
<a name="l01468"></a>01468     <span class="keywordflow">if</span> (opt-&gt;<a class="code" href="../../d1/de6/structcmdline__options.html#acba68d4bf70d3f90cc93c46b3818ebed">do_loop</a>) {
<a name="l01469"></a>01469         <a class="code" href="../../df/d77/ruby_8c.html#a4604b83b6e0a0198466ec5a236c5e0df">PREPARE_PARSE_MAIN</a>({
<a name="l01470"></a>01470             tree = <a class="code" href="../../d5/d11/ripper_8c.html#a6be0e8687051d30b196e41d24dab0a07">rb_parser_while_loop</a>(parser, tree, opt-&gt;<a class="code" href="../../d1/de6/structcmdline__options.html#a65f1e5acac44a2b311f6dbe5c24ac802">do_line</a>, opt-&gt;<a class="code" href="../../d1/de6/structcmdline__options.html#abdd2ce8657852f857e0877eb0fc38f6f">do_split</a>);
<a name="l01471"></a>01471         });
<a name="l01472"></a>01472         <a class="code" href="../../d7/d19/group__defmethod.html#gac08f58e00836e4e2586689e45b781bdd" title="Defines a global function.">rb_define_global_function</a>(<span class="stringliteral">&quot;sub&quot;</span>, <a class="code" href="../../df/d77/ruby_8c.html#afded7712c6b518d3995c464da8c64acc">rb_f_sub</a>, -1);
<a name="l01473"></a>01473         <a class="code" href="../../d7/d19/group__defmethod.html#gac08f58e00836e4e2586689e45b781bdd" title="Defines a global function.">rb_define_global_function</a>(<span class="stringliteral">&quot;gsub&quot;</span>, <a class="code" href="../../df/d77/ruby_8c.html#aa893bcb11c37ef54ec38154a76247438">rb_f_gsub</a>, -1);
<a name="l01474"></a>01474         <a class="code" href="../../d7/d19/group__defmethod.html#gac08f58e00836e4e2586689e45b781bdd" title="Defines a global function.">rb_define_global_function</a>(<span class="stringliteral">&quot;chop&quot;</span>, <a class="code" href="../../df/d77/ruby_8c.html#a6f2ddb51efe1d1c5320cc8901e50eb86">rb_f_chop</a>, 0);
<a name="l01475"></a>01475         <a class="code" href="../../d7/d19/group__defmethod.html#gac08f58e00836e4e2586689e45b781bdd" title="Defines a global function.">rb_define_global_function</a>(<span class="stringliteral">&quot;chomp&quot;</span>, <a class="code" href="../../df/d77/ruby_8c.html#a80a58bbefd82cae994ab3ad257ad1c38">rb_f_chomp</a>, -1);
<a name="l01476"></a>01476     }
<a name="l01477"></a>01477 
<a name="l01478"></a>01478     <span class="keywordflow">if</span> (opt-&gt;<a class="code" href="../../d1/de6/structcmdline__options.html#a48863cb6a5e38f32ec34e0cc02aaf3df">dump</a> &amp; <a class="code" href="../../df/d77/ruby_8c.html#a407222be54393f7e01842b5d79c25f55">DUMP_BIT</a>(parsetree) || opt-&gt;<a class="code" href="../../d1/de6/structcmdline__options.html#a48863cb6a5e38f32ec34e0cc02aaf3df">dump</a> &amp; <a class="code" href="../../df/d77/ruby_8c.html#a407222be54393f7e01842b5d79c25f55">DUMP_BIT</a>(parsetree_with_comment)) {
<a name="l01479"></a>01479         <a class="code" href="../../db/d2e/intern_8h.html#a57f7dccae9fa179bd7a44230ca836cf9">rb_io_write</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a8e88e429d335a5cd323cc848ac18ff58">rb_stdout</a>, <a class="code" href="../../dd/d2d/node_8c.html#a6d0f9c62449b6639136db0222df27b84">rb_parser_dump_tree</a>(tree, opt-&gt;<a class="code" href="../../d1/de6/structcmdline__options.html#a48863cb6a5e38f32ec34e0cc02aaf3df">dump</a> &amp; <a class="code" href="../../df/d77/ruby_8c.html#a407222be54393f7e01842b5d79c25f55">DUMP_BIT</a>(parsetree_with_comment)));
<a name="l01480"></a>01480         <a class="code" href="../../db/d2e/intern_8h.html#a773ecf32a05c03d4ca1da8cf31bbfc29">rb_io_flush</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a8e88e429d335a5cd323cc848ac18ff58">rb_stdout</a>);
<a name="l01481"></a>01481         <span class="keywordflow">return</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aacea3516b33941ce8149098e223a7466">Qtrue</a>;
<a name="l01482"></a>01482     }
<a name="l01483"></a>01483 
<a name="l01484"></a>01484     <a class="code" href="../../df/d77/ruby_8c.html#a4604b83b6e0a0198466ec5a236c5e0df">PREPARE_PARSE_MAIN</a>({
<a name="l01485"></a>01485         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> path = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a320970f989dc8294c8203154e3db40c1">Qnil</a>;
<a name="l01486"></a>01486         <span class="keywordflow">if</span> (!opt-&gt;<a class="code" href="../../d1/de6/structcmdline__options.html#a2e5ed539082d405a331e96b70283510c">e_script</a> &amp;&amp; strcmp(opt-&gt;<a class="code" href="../../d1/de6/structcmdline__options.html#a450901fd25d06a98bbf8f6525a95d73f">script</a>, <span class="stringliteral">&quot;-&quot;</span>))
<a name="l01487"></a>01487             path = <a class="code" href="../../d6/d13/file_8c.html#af3eb55e0b3c427751ac2378fb07ad7ad">rb_realpath_internal</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a320970f989dc8294c8203154e3db40c1">Qnil</a>, opt-&gt;<a class="code" href="../../d1/de6/structcmdline__options.html#a97c2411913164ff54f0dcd8405c3a574">script_name</a>, 1);
<a name="l01488"></a>01488         iseq = <a class="code" href="../../dd/d74/iseq_8c.html#a488f0fbd4a34d568994990e7655f099a">rb_iseq_new_main</a>(tree, opt-&gt;<a class="code" href="../../d1/de6/structcmdline__options.html#a97c2411913164ff54f0dcd8405c3a574">script_name</a>, path);
<a name="l01489"></a>01489     });
<a name="l01490"></a>01490 
<a name="l01491"></a>01491     <span class="keywordflow">if</span> (opt-&gt;<a class="code" href="../../d1/de6/structcmdline__options.html#a48863cb6a5e38f32ec34e0cc02aaf3df">dump</a> &amp; <a class="code" href="../../df/d77/ruby_8c.html#a407222be54393f7e01842b5d79c25f55">DUMP_BIT</a>(insns)) {
<a name="l01492"></a>01492         <a class="code" href="../../db/d2e/intern_8h.html#a57f7dccae9fa179bd7a44230ca836cf9">rb_io_write</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a8e88e429d335a5cd323cc848ac18ff58">rb_stdout</a>, <a class="code" href="../../dd/d74/iseq_8c.html#aba975c0ae1fb541cd17607c2c285f3eb">rb_iseq_disasm</a>(iseq));
<a name="l01493"></a>01493         <a class="code" href="../../db/d2e/intern_8h.html#a773ecf32a05c03d4ca1da8cf31bbfc29">rb_io_flush</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a8e88e429d335a5cd323cc848ac18ff58">rb_stdout</a>);
<a name="l01494"></a>01494         <span class="keywordflow">return</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aacea3516b33941ce8149098e223a7466">Qtrue</a>;
<a name="l01495"></a>01495     }
<a name="l01496"></a>01496 
<a name="l01497"></a>01497     <a class="code" href="../../df/d77/ruby_8c.html#a28563a913e3f4eccb3f23cd93215e6d9">rb_define_readonly_boolean</a>(<span class="stringliteral">&quot;$-p&quot;</span>, opt-&gt;<a class="code" href="../../d1/de6/structcmdline__options.html#a6993432671b13016c14debd0588a6b9f">do_print</a>);
<a name="l01498"></a>01498     <a class="code" href="../../df/d77/ruby_8c.html#a28563a913e3f4eccb3f23cd93215e6d9">rb_define_readonly_boolean</a>(<span class="stringliteral">&quot;$-l&quot;</span>, opt-&gt;<a class="code" href="../../d1/de6/structcmdline__options.html#a65f1e5acac44a2b311f6dbe5c24ac802">do_line</a>);
<a name="l01499"></a>01499     <a class="code" href="../../df/d77/ruby_8c.html#a28563a913e3f4eccb3f23cd93215e6d9">rb_define_readonly_boolean</a>(<span class="stringliteral">&quot;$-a&quot;</span>, opt-&gt;<a class="code" href="../../d1/de6/structcmdline__options.html#abdd2ce8657852f857e0877eb0fc38f6f">do_split</a>);
<a name="l01500"></a>01500 
<a name="l01501"></a>01501     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a5e959fe5d6961caa34f52e0369506659">rb_set_safe_level</a>(opt-&gt;<a class="code" href="../../d1/de6/structcmdline__options.html#a63be2eaa4c22858f34bda26de79a13c0">safe_level</a>);
<a name="l01502"></a>01502     <a class="code" href="../../d8/d16/gc_8c.html#a13a294ac30c3b27f5b8f81ec1a6ee2ad">rb_gc_set_params</a>();
<a name="l01503"></a>01503 
<a name="l01504"></a>01504     <span class="keywordflow">return</span> iseq;
<a name="l01505"></a>01505 }
<a name="l01506"></a>01506 
<a name="l01507"></a><a class="code" href="../../db/d66/structload__file__arg.html">01507</a> <span class="keyword">struct </span><a class="code" href="../../db/d66/structload__file__arg.html">load_file_arg</a> {
<a name="l01508"></a><a class="code" href="../../db/d66/structload__file__arg.html#a44878c3d4ac4c2233a74e64842e1d9d3">01508</a>     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <a class="code" href="../../db/d66/structload__file__arg.html#a44878c3d4ac4c2233a74e64842e1d9d3">parser</a>;
<a name="l01509"></a><a class="code" href="../../db/d66/structload__file__arg.html#a78483c25d310a0217f8ec806832cbc13">01509</a>     <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../db/d66/structload__file__arg.html#a78483c25d310a0217f8ec806832cbc13">fname</a>;
<a name="l01510"></a><a class="code" href="../../db/d66/structload__file__arg.html#aec8dba1dcb8e225f9ab5d5d927e90f84">01510</a>     <span class="keywordtype">int</span> <a class="code" href="../../db/d66/structload__file__arg.html#aec8dba1dcb8e225f9ab5d5d927e90f84">script</a>;
<a name="l01511"></a><a class="code" href="../../db/d66/structload__file__arg.html#a4cbdb0fa5897f52c017c9ddc2cb9c6aa">01511</a>     <span class="keyword">struct </span><a class="code" href="../../d1/de6/structcmdline__options.html">cmdline_options</a> *<a class="code" href="../../db/d66/structload__file__arg.html#a4cbdb0fa5897f52c017c9ddc2cb9c6aa">opt</a>;
<a name="l01512"></a>01512 };
<a name="l01513"></a>01513 
<a name="l01514"></a>01514 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l01515"></a><a class="code" href="../../df/d77/ruby_8c.html#ad5c53ade3e211fd01ccc4f373c23aac6">01515</a> <a class="code" href="../../df/d77/ruby_8c.html#ad5c53ade3e211fd01ccc4f373c23aac6">load_file_internal</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> arg)
<a name="l01516"></a>01516 {
<a name="l01517"></a>01517     <span class="keyword">extern</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#afafc64c52c6ab49dbc5699da872cad03">rb_stdin</a>;
<a name="l01518"></a>01518     <span class="keyword">struct </span><a class="code" href="../../db/d66/structload__file__arg.html">load_file_arg</a> *argp = (<span class="keyword">struct </span><a class="code" href="../../db/d66/structload__file__arg.html">load_file_arg</a> *)arg;
<a name="l01519"></a>01519     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> <a class="code" href="../../db/d66/structload__file__arg.html#a44878c3d4ac4c2233a74e64842e1d9d3">parser</a> = argp-&gt;<a class="code" href="../../db/d66/structload__file__arg.html#a44878c3d4ac4c2233a74e64842e1d9d3">parser</a>;
<a name="l01520"></a>01520     <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../db/d66/structload__file__arg.html#a78483c25d310a0217f8ec806832cbc13">fname</a> = argp-&gt;<a class="code" href="../../db/d66/structload__file__arg.html#a78483c25d310a0217f8ec806832cbc13">fname</a>;
<a name="l01521"></a>01521     <span class="keywordtype">int</span> <a class="code" href="../../db/d66/structload__file__arg.html#aec8dba1dcb8e225f9ab5d5d927e90f84">script</a> = argp-&gt;<a class="code" href="../../db/d66/structload__file__arg.html#aec8dba1dcb8e225f9ab5d5d927e90f84">script</a>;
<a name="l01522"></a>01522     <span class="keyword">struct </span><a class="code" href="../../d1/de6/structcmdline__options.html">cmdline_options</a> *opt = argp-&gt;<a class="code" href="../../db/d66/structload__file__arg.html#a4cbdb0fa5897f52c017c9ddc2cb9c6aa">opt</a>;
<a name="l01523"></a>01523     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> f;
<a name="l01524"></a>01524     <span class="keywordtype">int</span> line_start = 1;
<a name="l01525"></a>01525     NODE *tree = 0;
<a name="l01526"></a>01526     <a class="code" href="../../d1/d7b/struct_onig_encoding_type_s_t.html">rb_encoding</a> *<a class="code" href="../../d1/de6/structcmdline__options.html#a89ae067a92ade681a2ba731d8aa7bffc">enc</a>;
<a name="l01527"></a>01527     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#afa5b9137f051ac26d7ccc8824f178233">ID</a> set_encoding;
<a name="l01528"></a>01528     <span class="keywordtype">int</span> <a class="code" href="../../d1/de6/structcmdline__options.html#a7d125fcd6f16d94efa3cf072dda67b15">xflag</a> = 0;
<a name="l01529"></a>01529 
<a name="l01530"></a>01530     <span class="keywordflow">if</span> (!fname)
<a name="l01531"></a>01531         <a class="code" href="../../db/dcc/error_8c.html#afd9a0929ccc113f2156202c68f2e1798">rb_load_fail</a>(fname);
<a name="l01532"></a>01532     <span class="keywordflow">if</span> (strcmp(fname, <span class="stringliteral">&quot;-&quot;</span>) == 0) {
<a name="l01533"></a>01533         f = rb_stdin;
<a name="l01534"></a>01534     }
<a name="l01535"></a>01535     <span class="keywordflow">else</span> {
<a name="l01536"></a>01536         <span class="keywordtype">int</span> fd, mode = O_RDONLY;
<a name="l01537"></a>01537 <span class="preprocessor">#if defined DOSISH || defined __CYGWIN__</span>
<a name="l01538"></a>01538 <span class="preprocessor"></span>        {
<a name="l01539"></a>01539             <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d1/de6/structcmdline__options.html#ae4fff502bd9884529c1f31ab938a436c">ext</a> = <a class="code" href="../../dd/dd0/eval__intern_8h.html#abe95d128538ae3fa3d09adfc0ef1b206">strrchr</a>(fname, <span class="charliteral">&apos;.&apos;</span>);
<a name="l01540"></a>01540             <span class="keywordflow">if</span> (ext &amp;&amp; <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a033ddb8804ee20a82e42e4153e7136f4">STRCASECMP</a>(ext, <span class="stringliteral">&quot;.exe&quot;</span>) == 0) {
<a name="l01541"></a>01541                 mode |= <a class="code" href="../../d4/db0/__sdbm_8c.html#a36fa9b2e726512bc17a7a6d3e39002be">O_BINARY</a>;
<a name="l01542"></a>01542                 xflag = 1;
<a name="l01543"></a>01543             }
<a name="l01544"></a>01544         }
<a name="l01545"></a>01545 <span class="preprocessor">#endif</span>
<a name="l01546"></a>01546 <span class="preprocessor"></span>        <span class="keywordflow">if</span> ((fd = open(fname, mode)) &lt; 0) {
<a name="l01547"></a>01547             <a class="code" href="../../db/dcc/error_8c.html#afd9a0929ccc113f2156202c68f2e1798">rb_load_fail</a>(fname);
<a name="l01548"></a>01548         }
<a name="l01549"></a>01549         <a class="code" href="../../db/d2e/intern_8h.html#a6448f20b0936afe0cb85ab3186753db2">rb_update_max_fd</a>(fd);
<a name="l01550"></a>01550 
<a name="l01551"></a>01551         f = <a class="code" href="../../db/d2e/intern_8h.html#a3c9f47fa38a9d0ec956e154d4e3d44fe">rb_io_fdopen</a>(fd, mode, fname);
<a name="l01552"></a>01552     }
<a name="l01553"></a>01553 
<a name="l01554"></a>01554     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aa50b9d5bc665eb5545f6857c89232161">CONST_ID</a>(set_encoding, <span class="stringliteral">&quot;set_encoding&quot;</span>);
<a name="l01555"></a>01555     <span class="keywordflow">if</span> (script) {
<a name="l01556"></a>01556         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> c = 1;            <span class="comment">/* something not nil */</span>
<a name="l01557"></a>01557         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> line;
<a name="l01558"></a>01558         <span class="keywordtype">char</span> *p;
<a name="l01559"></a>01559         <span class="keywordtype">int</span> no_src_enc = !opt-&gt;<a class="code" href="../../d1/de6/structcmdline__options.html#a13f1f0d4bc385de1d92ac617f5fc8b2a">src</a>.<a class="code" href="../../d1/de6/structcmdline__options.html#a89ae067a92ade681a2ba731d8aa7bffc">enc</a>.name;
<a name="l01560"></a>01560         <span class="keywordtype">int</span> no_ext_enc = !opt-&gt;<a class="code" href="../../d1/de6/structcmdline__options.html#ae4fff502bd9884529c1f31ab938a436c">ext</a>.<a class="code" href="../../d1/de6/structcmdline__options.html#a89ae067a92ade681a2ba731d8aa7bffc">enc</a>.name;
<a name="l01561"></a>01561         <span class="keywordtype">int</span> no_int_enc = !opt-&gt;<a class="code" href="../../d1/de6/structcmdline__options.html#acae7690c90303f7a134f0baf1ed8c5ed">intern</a>.<a class="code" href="../../d1/de6/structcmdline__options.html#a89ae067a92ade681a2ba731d8aa7bffc">enc</a>.name;
<a name="l01562"></a>01562 
<a name="l01563"></a>01563         enc = <a class="code" href="../../d5/db5/encoding_8c.html#a767d777810f0d48add93857b52057262">rb_ascii8bit_encoding</a>();
<a name="l01564"></a>01564         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a6a973fe624aa9aa9ba0cdeb6792d3187" title="Calls a method.">rb_funcall</a>(f, set_encoding, 1, <a class="code" href="../../d5/db5/encoding_8c.html#ad4918664be7424ab9f961165eecb6c18">rb_enc_from_encoding</a>(enc));
<a name="l01565"></a>01565 
<a name="l01566"></a>01566         <span class="keywordflow">if</span> (xflag || opt-&gt;<a class="code" href="../../d1/de6/structcmdline__options.html#a7d125fcd6f16d94efa3cf072dda67b15">xflag</a>) {
<a name="l01567"></a>01567             line_start--;
<a name="l01568"></a>01568           search_shebang:
<a name="l01569"></a>01569             <a class="code" href="../../df/d77/ruby_8c.html#aefc30916c718aa484a9692900febed5b">forbid_setid</a>(<span class="stringliteral">&quot;-x&quot;</span>);
<a name="l01570"></a>01570             opt-&gt;<a class="code" href="../../d1/de6/structcmdline__options.html#a7d125fcd6f16d94efa3cf072dda67b15">xflag</a> = <a class="code" href="../../d1/d5c/nkf_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l01571"></a>01571             <span class="keywordflow">while</span> (!<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a4832bad8845a35fc50f7a160901854a1">NIL_P</a>(line = <a class="code" href="../../db/d2e/intern_8h.html#a4f0d1bd3c88e8f31ee0b41afce9e94fb">rb_io_gets</a>(f))) {
<a name="l01572"></a>01572                 line_start++;
<a name="l01573"></a>01573                 <span class="keywordflow">if</span> (<a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(line) &gt; 2
<a name="l01574"></a>01574                     &amp;&amp; <a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(line)[0] == <span class="charliteral">&apos;#&apos;</span>
<a name="l01575"></a>01575                     &amp;&amp; <a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(line)[1] == <span class="charliteral">&apos;!&apos;</span>) {
<a name="l01576"></a>01576                     <span class="keywordflow">if</span> ((p = <a class="code" href="../../d3/d90/missing_8h.html#a695026fc69840c65da7ea58226006f69">strstr</a>(<a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(line), <span class="stringliteral">&quot;ruby&quot;</span>)) != 0) {
<a name="l01577"></a>01577                         <span class="keywordflow">goto</span> start_read;
<a name="l01578"></a>01578                     }
<a name="l01579"></a>01579                 }
<a name="l01580"></a>01580             }
<a name="l01581"></a>01581             <a class="code" href="../../db/dcc/error_8c.html#a0f771a2840561f1838169b3d7d4616f3">rb_raise</a>(<a class="code" href="../../db/dcc/error_8c.html#a5485df8856b8fa33d9d378afdabc9d29">rb_eLoadError</a>, <span class="stringliteral">&quot;no Ruby script found in input&quot;</span>);
<a name="l01582"></a>01582         }
<a name="l01583"></a>01583 
<a name="l01584"></a>01584         c = <a class="code" href="../../db/d2e/intern_8h.html#a13c20887173177e30ccd7bb42708dc2b">rb_io_getbyte</a>(f);
<a name="l01585"></a>01585         <span class="keywordflow">if</span> (c == <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(<span class="charliteral">&apos;#&apos;</span>)) {
<a name="l01586"></a>01586             c = <a class="code" href="../../db/d2e/intern_8h.html#a13c20887173177e30ccd7bb42708dc2b">rb_io_getbyte</a>(f);
<a name="l01587"></a>01587             <span class="keywordflow">if</span> (c == <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(<span class="charliteral">&apos;!&apos;</span>)) {
<a name="l01588"></a>01588                 line = <a class="code" href="../../db/d2e/intern_8h.html#a4f0d1bd3c88e8f31ee0b41afce9e94fb">rb_io_gets</a>(f);
<a name="l01589"></a>01589                 <span class="keywordflow">if</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a4832bad8845a35fc50f7a160901854a1">NIL_P</a>(line))
<a name="l01590"></a>01590                     <span class="keywordflow">return</span> 0;
<a name="l01591"></a>01591 
<a name="l01592"></a>01592                 <span class="keywordflow">if</span> ((p = <a class="code" href="../../d3/d90/missing_8h.html#a695026fc69840c65da7ea58226006f69">strstr</a>(<a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(line), <span class="stringliteral">&quot;ruby&quot;</span>)) == 0) {
<a name="l01593"></a>01593                     <span class="comment">/* not ruby script, assume -x flag */</span>
<a name="l01594"></a>01594                     <span class="keywordflow">goto</span> search_shebang;
<a name="l01595"></a>01595                 }
<a name="l01596"></a>01596 
<a name="l01597"></a>01597               start_read:
<a name="l01598"></a>01598                 p += 4;
<a name="l01599"></a>01599                 <a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(line)[<a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(line) - 1] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l01600"></a>01600                 <span class="keywordflow">if</span> (<a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(line)[<a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(line) - 2] == <span class="charliteral">&apos;\r&apos;</span>)
<a name="l01601"></a>01601                     <a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(line)[<a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(line) - 2] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l01602"></a>01602                 <span class="keywordflow">if</span> ((p = <a class="code" href="../../d3/d90/missing_8h.html#a695026fc69840c65da7ea58226006f69">strstr</a>(p, <span class="stringliteral">&quot; -&quot;</span>)) != 0) {
<a name="l01603"></a>01603                     <a class="code" href="../../df/d77/ruby_8c.html#afa6e13329102453f3e95157a46485847">moreswitches</a>(p + 1, opt, 0);
<a name="l01604"></a>01604                 }
<a name="l01605"></a>01605 
<a name="l01606"></a>01606                 <span class="comment">/* push back shebang for pragma may exist in next line */</span>
<a name="l01607"></a>01607                 <a class="code" href="../../db/d2e/intern_8h.html#ad5e3541ec00f5805a8bfb10fbe71a33a">rb_io_ungetbyte</a>(f, <a class="code" href="../../db/d2e/intern_8h.html#a03acd62c0b1edebbe1d61f957c19b7ac">rb_str_new2</a>(<span class="stringliteral">&quot;!\n&quot;</span>));
<a name="l01608"></a>01608             }
<a name="l01609"></a>01609             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a4832bad8845a35fc50f7a160901854a1">NIL_P</a>(c)) {
<a name="l01610"></a>01610                 <a class="code" href="../../db/d2e/intern_8h.html#ad5e3541ec00f5805a8bfb10fbe71a33a">rb_io_ungetbyte</a>(f, c);
<a name="l01611"></a>01611             }
<a name="l01612"></a>01612             <a class="code" href="../../db/d2e/intern_8h.html#ad5e3541ec00f5805a8bfb10fbe71a33a">rb_io_ungetbyte</a>(f, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(<span class="charliteral">&apos;#&apos;</span>));
<a name="l01613"></a>01613             <span class="keywordflow">if</span> (no_src_enc &amp;&amp; opt-&gt;<a class="code" href="../../d1/de6/structcmdline__options.html#a13f1f0d4bc385de1d92ac617f5fc8b2a">src</a>.<a class="code" href="../../d1/de6/structcmdline__options.html#a89ae067a92ade681a2ba731d8aa7bffc">enc</a>.name) {
<a name="l01614"></a>01614                 opt-&gt;<a class="code" href="../../d1/de6/structcmdline__options.html#a13f1f0d4bc385de1d92ac617f5fc8b2a">src</a>.<a class="code" href="../../d1/de6/structcmdline__options.html#a89ae067a92ade681a2ba731d8aa7bffc">enc</a>.index = <a class="code" href="../../df/d77/ruby_8c.html#a5f0ba26c0b772d799188ca7905c4089a">opt_enc_index</a>(opt-&gt;<a class="code" href="../../d1/de6/structcmdline__options.html#a13f1f0d4bc385de1d92ac617f5fc8b2a">src</a>.<a class="code" href="../../d1/de6/structcmdline__options.html#a89ae067a92ade681a2ba731d8aa7bffc">enc</a>.name);
<a name="l01615"></a>01615                 <a class="code" href="../../df/d77/ruby_8c.html#a1f4b9ad71556f5bc1fb0ca4d4eab37de">src_encoding_index</a> = opt-&gt;<a class="code" href="../../d1/de6/structcmdline__options.html#a13f1f0d4bc385de1d92ac617f5fc8b2a">src</a>.<a class="code" href="../../d1/de6/structcmdline__options.html#a89ae067a92ade681a2ba731d8aa7bffc">enc</a>.index;
<a name="l01616"></a>01616             }
<a name="l01617"></a>01617             <span class="keywordflow">if</span> (no_ext_enc &amp;&amp; opt-&gt;<a class="code" href="../../d1/de6/structcmdline__options.html#ae4fff502bd9884529c1f31ab938a436c">ext</a>.<a class="code" href="../../d1/de6/structcmdline__options.html#a89ae067a92ade681a2ba731d8aa7bffc">enc</a>.name) {
<a name="l01618"></a>01618                 opt-&gt;<a class="code" href="../../d1/de6/structcmdline__options.html#ae4fff502bd9884529c1f31ab938a436c">ext</a>.<a class="code" href="../../d1/de6/structcmdline__options.html#a89ae067a92ade681a2ba731d8aa7bffc">enc</a>.index = <a class="code" href="../../df/d77/ruby_8c.html#a5f0ba26c0b772d799188ca7905c4089a">opt_enc_index</a>(opt-&gt;<a class="code" href="../../d1/de6/structcmdline__options.html#ae4fff502bd9884529c1f31ab938a436c">ext</a>.<a class="code" href="../../d1/de6/structcmdline__options.html#a89ae067a92ade681a2ba731d8aa7bffc">enc</a>.name);
<a name="l01619"></a>01619             }
<a name="l01620"></a>01620             <span class="keywordflow">if</span> (no_int_enc &amp;&amp; opt-&gt;<a class="code" href="../../d1/de6/structcmdline__options.html#acae7690c90303f7a134f0baf1ed8c5ed">intern</a>.<a class="code" href="../../d1/de6/structcmdline__options.html#a89ae067a92ade681a2ba731d8aa7bffc">enc</a>.name) {
<a name="l01621"></a>01621                 opt-&gt;<a class="code" href="../../d1/de6/structcmdline__options.html#acae7690c90303f7a134f0baf1ed8c5ed">intern</a>.<a class="code" href="../../d1/de6/structcmdline__options.html#a89ae067a92ade681a2ba731d8aa7bffc">enc</a>.index = <a class="code" href="../../df/d77/ruby_8c.html#a5f0ba26c0b772d799188ca7905c4089a">opt_enc_index</a>(opt-&gt;<a class="code" href="../../d1/de6/structcmdline__options.html#acae7690c90303f7a134f0baf1ed8c5ed">intern</a>.<a class="code" href="../../d1/de6/structcmdline__options.html#a89ae067a92ade681a2ba731d8aa7bffc">enc</a>.name);
<a name="l01622"></a>01622             }
<a name="l01623"></a>01623         }
<a name="l01624"></a>01624         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a4832bad8845a35fc50f7a160901854a1">NIL_P</a>(c)) {
<a name="l01625"></a>01625             <a class="code" href="../../db/d2e/intern_8h.html#ad5e3541ec00f5805a8bfb10fbe71a33a">rb_io_ungetbyte</a>(f, c);
<a name="l01626"></a>01626         }
<a name="l01627"></a>01627         <span class="keywordflow">else</span> {
<a name="l01628"></a>01628             <span class="keywordflow">if</span> (f != rb_stdin) <a class="code" href="../../db/d2e/intern_8h.html#a3b37c38f6b8a9fc60eeee87a7d58d232">rb_io_close</a>(f);
<a name="l01629"></a>01629             f = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a320970f989dc8294c8203154e3db40c1">Qnil</a>;
<a name="l01630"></a>01630         }
<a name="l01631"></a>01631         <a class="code" href="../../dd/dd0/eval__intern_8h.html#a83ac3f8bc164313d7a1b451f2d2cdabf">rb_vm_set_progname</a>(<a class="code" href="../../df/d77/ruby_8c.html#ae28cabfebc4bb8a54c5a3d47d8f252d7">rb_progname</a> = opt-&gt;<a class="code" href="../../d1/de6/structcmdline__options.html#a97c2411913164ff54f0dcd8405c3a574">script_name</a>);
<a name="l01632"></a>01632         <a class="code" href="../../df/d77/ruby_8c.html#a8c31193e63460680d46fbde2552c18ff">require_libraries</a>(&amp;opt-&gt;<a class="code" href="../../d1/de6/structcmdline__options.html#ab403f7b88211076cbc5cdaf54704857e">req_list</a>);      <span class="comment">/* Why here? unnatural */</span>
<a name="l01633"></a>01633     }
<a name="l01634"></a>01634     <span class="keywordflow">if</span> (opt-&gt;<a class="code" href="../../d1/de6/structcmdline__options.html#a13f1f0d4bc385de1d92ac617f5fc8b2a">src</a>.<a class="code" href="../../d1/de6/structcmdline__options.html#a89ae067a92ade681a2ba731d8aa7bffc">enc</a>.index &gt;= 0) {
<a name="l01635"></a>01635         enc = <a class="code" href="../../d5/db5/encoding_8c.html#aef9c377b2d9d78b9f88e890b77593109">rb_enc_from_index</a>(opt-&gt;<a class="code" href="../../d1/de6/structcmdline__options.html#a13f1f0d4bc385de1d92ac617f5fc8b2a">src</a>.<a class="code" href="../../d1/de6/structcmdline__options.html#a89ae067a92ade681a2ba731d8aa7bffc">enc</a>.index);
<a name="l01636"></a>01636     }
<a name="l01637"></a>01637     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (f == rb_stdin) {
<a name="l01638"></a>01638         enc = <a class="code" href="../../d5/db5/encoding_8c.html#a051d22249598e717317cb04798b3d76f">rb_locale_encoding</a>();
<a name="l01639"></a>01639     }
<a name="l01640"></a>01640     <span class="keywordflow">else</span> {
<a name="l01641"></a>01641         enc = <a class="code" href="../../d5/db5/encoding_8c.html#a1e215012f16414c044f6a212973c95a8">rb_usascii_encoding</a>();
<a name="l01642"></a>01642     }
<a name="l01643"></a>01643     <span class="keywordflow">if</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a4832bad8845a35fc50f7a160901854a1">NIL_P</a>(f)) {
<a name="l01644"></a>01644         f = <a class="code" href="../../db/d2e/intern_8h.html#a48b2b873adb8b6a04254bd631c4b03c5">rb_str_new</a>(0, 0);
<a name="l01645"></a>01645         <a class="code" href="../../d5/db5/encoding_8c.html#a150a6e3ac22ac3be8f8c2ccc74a28e7b">rb_enc_associate</a>(f, enc);
<a name="l01646"></a>01646         <span class="keywordflow">return</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>)<a class="code" href="../../d5/d11/ripper_8c.html#a7412884de7525393ed236f51925b4c66">rb_parser_compile_string</a>(parser, fname, f, line_start);
<a name="l01647"></a>01647     }
<a name="l01648"></a>01648     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a6a973fe624aa9aa9ba0cdeb6792d3187" title="Calls a method.">rb_funcall</a>(f, set_encoding, 2, <a class="code" href="../../d5/db5/encoding_8c.html#ad4918664be7424ab9f961165eecb6c18">rb_enc_from_encoding</a>(enc), <a class="code" href="../../db/d2e/intern_8h.html#a2b9cc485b0aa1dc270744b8b9eb47569">rb_str_new_cstr</a>(<span class="stringliteral">&quot;-&quot;</span>));
<a name="l01649"></a>01649     tree = <a class="code" href="../../d5/d11/ripper_8c.html#a7368a8916f449d63c1bb090bca14dcd5">rb_parser_compile_file</a>(parser, fname, f, line_start);
<a name="l01650"></a>01650     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a6a973fe624aa9aa9ba0cdeb6792d3187" title="Calls a method.">rb_funcall</a>(f, set_encoding, 1, <a class="code" href="../../d5/d11/ripper_8c.html#a7624c273f1693afcdbd66e987ff613f5">rb_parser_encoding</a>(parser));
<a name="l01651"></a>01651     <span class="keywordflow">if</span> (script &amp;&amp; tree &amp;&amp; <a class="code" href="../../d5/d11/ripper_8c.html#a9ee877befd26d3832f3ea41a2b6fcb89">rb_parser_end_seen_p</a>(parser)) {
<a name="l01652"></a>01652         <span class="comment">/*</span>
<a name="l01653"></a>01653 <span class="comment">         * DATA is a File that contains the data section of the executed file.</span>
<a name="l01654"></a>01654 <span class="comment">         * To create a data section use &lt;tt&gt;__END__&lt;/tt&gt;:</span>
<a name="l01655"></a>01655 <span class="comment">         *</span>
<a name="l01656"></a>01656 <span class="comment">         *   $ cat t.rb</span>
<a name="l01657"></a>01657 <span class="comment">         *   puts DATA.gets</span>
<a name="l01658"></a>01658 <span class="comment">         *   __END__</span>
<a name="l01659"></a>01659 <span class="comment">         *   hello world!</span>
<a name="l01660"></a>01660 <span class="comment">         *</span>
<a name="l01661"></a>01661 <span class="comment">         *   $ ruby t.rb</span>
<a name="l01662"></a>01662 <span class="comment">         *   hello world!</span>
<a name="l01663"></a>01663 <span class="comment">         */</span>
<a name="l01664"></a>01664         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a5a25f6effbffe412ebda3391132e7129">rb_define_global_const</a>(<span class="stringliteral">&quot;DATA&quot;</span>, f);
<a name="l01665"></a>01665     }
<a name="l01666"></a>01666     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (f != rb_stdin) {
<a name="l01667"></a>01667         <a class="code" href="../../db/d2e/intern_8h.html#a3b37c38f6b8a9fc60eeee87a7d58d232">rb_io_close</a>(f);
<a name="l01668"></a>01668     }
<a name="l01669"></a>01669     <span class="keywordflow">return</span> (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>)tree;
<a name="l01670"></a>01670 }
<a name="l01671"></a>01671 
<a name="l01672"></a>01672 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l01673"></a><a class="code" href="../../df/d77/ruby_8c.html#ace03f2317721e8b304c60b7a421bb2cf">01673</a> <a class="code" href="../../df/d77/ruby_8c.html#ace03f2317721e8b304c60b7a421bb2cf">restore_lineno</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> lineno)
<a name="l01674"></a>01674 {
<a name="l01675"></a>01675     <span class="keywordflow">return</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a35d050d4c8be4c1be5d9dd7df9a406a2">rb_gv_set</a>(<span class="stringliteral">&quot;$.&quot;</span>, lineno);
<a name="l01676"></a>01676 }
<a name="l01677"></a>01677 
<a name="l01678"></a>01678 <span class="keyword">static</span> NODE *
<a name="l01679"></a><a class="code" href="../../df/d77/ruby_8c.html#ab71b0792d7f66a50c862061a655aed6a">01679</a> <a class="code" href="../../df/d77/ruby_8c.html#ab71b0792d7f66a50c862061a655aed6a">load_file</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> parser, <span class="keyword">const</span> <span class="keywordtype">char</span> *fname, <span class="keywordtype">int</span> <a class="code" href="../../d1/de6/structcmdline__options.html#a450901fd25d06a98bbf8f6525a95d73f">script</a>, <span class="keyword">struct</span> <a class="code" href="../../d1/de6/structcmdline__options.html">cmdline_options</a> *opt)
<a name="l01680"></a>01680 {
<a name="l01681"></a>01681     <span class="keyword">struct </span><a class="code" href="../../db/d66/structload__file__arg.html">load_file_arg</a> arg;
<a name="l01682"></a>01682     arg.<a class="code" href="../../db/d66/structload__file__arg.html#a44878c3d4ac4c2233a74e64842e1d9d3">parser</a> = parser;
<a name="l01683"></a>01683     arg.<a class="code" href="../../db/d66/structload__file__arg.html#a78483c25d310a0217f8ec806832cbc13">fname</a> = fname;
<a name="l01684"></a>01684     arg.<a class="code" href="../../db/d66/structload__file__arg.html#aec8dba1dcb8e225f9ab5d5d927e90f84">script</a> = script;
<a name="l01685"></a>01685     arg.<a class="code" href="../../db/d66/structload__file__arg.html#a4cbdb0fa5897f52c017c9ddc2cb9c6aa">opt</a> = opt;
<a name="l01686"></a>01686     <span class="keywordflow">return</span> (NODE *)<a class="code" href="../../d3/d57/eval_8c.html#a8061198378fb16adeb931f90540b2839">rb_ensure</a>(<a class="code" href="../../df/d77/ruby_8c.html#ad5c53ade3e211fd01ccc4f373c23aac6">load_file_internal</a>, (<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>)&amp;arg, <a class="code" href="../../df/d77/ruby_8c.html#ace03f2317721e8b304c60b7a421bb2cf">restore_lineno</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac264a2e60151682299aa24aadaf69d39">rb_gv_get</a>(<span class="stringliteral">&quot;$.&quot;</span>));
<a name="l01687"></a>01687 }
<a name="l01688"></a>01688 
<a name="l01689"></a>01689 <span class="keywordtype">void</span> *
<a name="l01690"></a><a class="code" href="../../df/d77/ruby_8c.html#a6d6823c87bf70c429480ee5f8f422643">01690</a> <a class="code" href="../../db/d2e/intern_8h.html#a9eaaf9929565001dd0245e5903b792ed">rb_load_file</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../db/d66/structload__file__arg.html#a78483c25d310a0217f8ec806832cbc13">fname</a>)
<a name="l01691"></a>01691 {
<a name="l01692"></a>01692     <span class="keyword">struct </span><a class="code" href="../../d1/de6/structcmdline__options.html">cmdline_options</a> opt;
<a name="l01693"></a>01693 
<a name="l01694"></a>01694     <span class="keywordflow">return</span> <a class="code" href="../../df/d77/ruby_8c.html#ab71b0792d7f66a50c862061a655aed6a">load_file</a>(<a class="code" href="../../d5/d11/ripper_8c.html#a175a11311538e1c0c3bc41c96a6a8aaf">rb_parser_new</a>(), fname, 0, <a class="code" href="../../df/d77/ruby_8c.html#a0c4c26a222f55646d38ac62ce6ce6ae4">cmdline_options_init</a>(&amp;opt));
<a name="l01695"></a>01695 }
<a name="l01696"></a>01696 
<a name="l01697"></a>01697 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l01698"></a><a class="code" href="../../df/d77/ruby_8c.html#a2dbcfbcfd73958f4c630a47bc0f20f1c">01698</a> <a class="code" href="../../df/d77/ruby_8c.html#a2dbcfbcfd73958f4c630a47bc0f20f1c">set_arg0</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> val, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#afa5b9137f051ac26d7ccc8824f178233">ID</a> <span class="keywordtype">id</span>)
<a name="l01699"></a>01699 {
<a name="l01700"></a>01700     <span class="keywordtype">char</span> *s;
<a name="l01701"></a>01701     <span class="keywordtype">long</span> i;
<a name="l01702"></a>01702 
<a name="l01703"></a>01703     <span class="keywordflow">if</span> (<a class="code" href="../../df/d77/ruby_8c.html#a6c2ae3c3abc05179cb0a01ec5918b38a">origarg</a>.argv == 0)
<a name="l01704"></a>01704         <a class="code" href="../../db/dcc/error_8c.html#a0f771a2840561f1838169b3d7d4616f3">rb_raise</a>(<a class="code" href="../../db/dcc/error_8c.html#a95ad3953d535707e2cf2b1d837f5e253">rb_eRuntimeError</a>, <span class="stringliteral">&quot;$0 not initialized&quot;</span>);
<a name="l01705"></a>01705     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a0e80f207eb41e9010ec9f0f5f9419fea">StringValue</a>(val);
<a name="l01706"></a>01706     s = <a class="code" href="../../d8/df4/generator_8h.html#aa0c7097c0d82c8372072fbab5a604e39">RSTRING_PTR</a>(val);
<a name="l01707"></a>01707     i = <a class="code" href="../../d8/df4/generator_8h.html#a1661e63c26c5cbeef7217d05b0f33942">RSTRING_LEN</a>(val);
<a name="l01708"></a>01708 
<a name="l01709"></a>01709     <a class="code" href="../../d3/d90/missing_8h.html#a9942f7abecafda68dccff1a5ae2f8a48">setproctitle</a>(<span class="stringliteral">&quot;%.*s&quot;</span>, (<span class="keywordtype">int</span>)i, s);
<a name="l01710"></a>01710 
<a name="l01711"></a>01711     <a class="code" href="../../df/d77/ruby_8c.html#ae28cabfebc4bb8a54c5a3d47d8f252d7">rb_progname</a> = <a class="code" href="../../db/d2e/intern_8h.html#a8ea3742679211f408cb5769de6cf0d46">rb_obj_freeze</a>(<a class="code" href="../../db/d2e/intern_8h.html#a37f67f5f2e117b1f20938b2f4b4a7556">rb_external_str_new</a>(s, i));
<a name="l01712"></a>01712 }
<a name="l01713"></a>01713 
<a name="l01714"></a>01714 <span class="keywordtype">void</span>
<a name="l01715"></a><a class="code" href="../../df/d77/ruby_8c.html#a79f43a6183d996338565fb22430d60c5">01715</a> <a class="code" href="../../db/d2e/intern_8h.html#a43beb82b75ff82edb7921a2045938189">ruby_script</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d6/da0/nkf-utf8_2nkf_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>)
<a name="l01716"></a>01716 {
<a name="l01717"></a>01717     <span class="keywordflow">if</span> (name) {
<a name="l01718"></a>01718         <a class="code" href="../../df/d77/ruby_8c.html#ae28cabfebc4bb8a54c5a3d47d8f252d7">rb_progname</a> = <a class="code" href="../../db/d2e/intern_8h.html#a37f67f5f2e117b1f20938b2f4b4a7556">rb_external_str_new</a>(name, <a class="code" href="../../d6/d7b/strchr_8c.html#a219836f542ce53545052bed5353820ca">strlen</a>(name));
<a name="l01719"></a>01719         <a class="code" href="../../dd/dd0/eval__intern_8h.html#a83ac3f8bc164313d7a1b451f2d2cdabf">rb_vm_set_progname</a>(<a class="code" href="../../df/d77/ruby_8c.html#ae28cabfebc4bb8a54c5a3d47d8f252d7">rb_progname</a>);
<a name="l01720"></a>01720     }
<a name="l01721"></a>01721 }
<a name="l01722"></a>01722 
<a name="l01723"></a>01723 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l01724"></a><a class="code" href="../../df/d77/ruby_8c.html#a2feea1db78c18d02434974c51de2de06">01724</a> <a class="code" href="../../df/d77/ruby_8c.html#a2feea1db78c18d02434974c51de2de06">init_ids</a>(<span class="keyword">struct</span> <a class="code" href="../../d1/de6/structcmdline__options.html">cmdline_options</a> *opt)
<a name="l01725"></a>01725 {
<a name="l01726"></a>01726     rb_uid_t uid = <a class="code" href="../../dc/db1/win32_8h.html#a2a3c17f15a0d34a8bba3277bfef2f56b">getuid</a>();
<a name="l01727"></a>01727     rb_uid_t euid = <a class="code" href="../../dc/db1/win32_8h.html#a562a0feffc13c71832ee590ba902deed">geteuid</a>();
<a name="l01728"></a>01728     rb_gid_t gid = <a class="code" href="../../dc/db1/win32_8h.html#aff700a9c53273ce5d774f5e9bfd706d3">getgid</a>();
<a name="l01729"></a>01729     rb_gid_t egid = <a class="code" href="../../dc/db1/win32_8h.html#aadcb5f82638d8002839ca37508e43616">getegid</a>();
<a name="l01730"></a>01730 
<a name="l01731"></a>01731     <span class="keywordflow">if</span> (uid != euid) opt-&gt;<a class="code" href="../../d1/de6/structcmdline__options.html#a1bea9e0943d0781170e1b6cb8c063384">setids</a> |= 1;
<a name="l01732"></a>01732     <span class="keywordflow">if</span> (egid != gid) opt-&gt;<a class="code" href="../../d1/de6/structcmdline__options.html#a1bea9e0943d0781170e1b6cb8c063384">setids</a> |= 2;
<a name="l01733"></a>01733     <span class="keywordflow">if</span> (uid &amp;&amp; opt-&gt;<a class="code" href="../../d1/de6/structcmdline__options.html#a1bea9e0943d0781170e1b6cb8c063384">setids</a>) {
<a name="l01734"></a>01734         <span class="keywordflow">if</span> (opt-&gt;<a class="code" href="../../d1/de6/structcmdline__options.html#a63be2eaa4c22858f34bda26de79a13c0">safe_level</a> &lt; 1) opt-&gt;<a class="code" href="../../d1/de6/structcmdline__options.html#a63be2eaa4c22858f34bda26de79a13c0">safe_level</a> = 1;
<a name="l01735"></a>01735     }
<a name="l01736"></a>01736 }
<a name="l01737"></a>01737 
<a name="l01738"></a>01738 <span class="preprocessor">#undef forbid_setid</span>
<a name="l01739"></a>01739 <span class="preprocessor"></span><span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l01740"></a><a class="code" href="../../df/d77/ruby_8c.html#a496b1a8acb1f61c131e85bc44185512d">01740</a> <a class="code" href="../../df/d77/ruby_8c.html#aefc30916c718aa484a9692900febed5b">forbid_setid</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *s, <span class="keyword">struct</span> <a class="code" href="../../d1/de6/structcmdline__options.html">cmdline_options</a> *opt)
<a name="l01741"></a>01741 {
<a name="l01742"></a>01742     <span class="keywordflow">if</span> (opt-&gt;<a class="code" href="../../d1/de6/structcmdline__options.html#a1bea9e0943d0781170e1b6cb8c063384">setids</a> &amp; 1)
<a name="l01743"></a>01743         <a class="code" href="../../db/dcc/error_8c.html#a0f771a2840561f1838169b3d7d4616f3">rb_raise</a>(<a class="code" href="../../db/dcc/error_8c.html#ae53f1d228c34c2a7715d7d39ab1a2991">rb_eSecurityError</a>, <span class="stringliteral">&quot;no %s allowed while running setuid&quot;</span>, s);
<a name="l01744"></a>01744     <span class="keywordflow">if</span> (opt-&gt;<a class="code" href="../../d1/de6/structcmdline__options.html#a1bea9e0943d0781170e1b6cb8c063384">setids</a> &amp; 2)
<a name="l01745"></a>01745         <a class="code" href="../../db/dcc/error_8c.html#a0f771a2840561f1838169b3d7d4616f3">rb_raise</a>(<a class="code" href="../../db/dcc/error_8c.html#ae53f1d228c34c2a7715d7d39ab1a2991">rb_eSecurityError</a>, <span class="stringliteral">&quot;no %s allowed while running setgid&quot;</span>, s);
<a name="l01746"></a>01746     <span class="keywordflow">if</span> (opt-&gt;<a class="code" href="../../d1/de6/structcmdline__options.html#a63be2eaa4c22858f34bda26de79a13c0">safe_level</a> &gt; 0)
<a name="l01747"></a>01747         <a class="code" href="../../db/dcc/error_8c.html#a0f771a2840561f1838169b3d7d4616f3">rb_raise</a>(<a class="code" href="../../db/dcc/error_8c.html#ae53f1d228c34c2a7715d7d39ab1a2991">rb_eSecurityError</a>, <span class="stringliteral">&quot;no %s allowed in tainted mode&quot;</span>, s);
<a name="l01748"></a>01748 }
<a name="l01749"></a>01749 
<a name="l01750"></a>01750 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l01751"></a><a class="code" href="../../df/d77/ruby_8c.html#a84ab8b02bd412174055520a9d33db7dd">01751</a> <a class="code" href="../../df/d77/ruby_8c.html#a84ab8b02bd412174055520a9d33db7dd">verbose_setter</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> val, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#afa5b9137f051ac26d7ccc8824f178233">ID</a> <span class="keywordtype">id</span>, <span class="keywordtype">void</span> *data)
<a name="l01752"></a>01752 {
<a name="l01753"></a>01753     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> *variable = data;
<a name="l01754"></a>01754     *variable = <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a117741045763c090b26e30a85bd0e0a6">RTEST</a>(val) ? <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aacea3516b33941ce8149098e223a7466">Qtrue</a> : val;
<a name="l01755"></a>01755 }
<a name="l01756"></a>01756 
<a name="l01757"></a>01757 <span class="keyword">static</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a>
<a name="l01758"></a><a class="code" href="../../df/d77/ruby_8c.html#ab5c08f98f323afef17a9afa9c0742e29">01758</a> <a class="code" href="../../df/d77/ruby_8c.html#ab5c08f98f323afef17a9afa9c0742e29">opt_W_getter</a>(<a class="code" href="../../de/de6/ruby_2ruby_8h.html#afa5b9137f051ac26d7ccc8824f178233">ID</a> <span class="keywordtype">id</span>, <span class="keywordtype">void</span> *data)
<a name="l01759"></a>01759 {
<a name="l01760"></a>01760     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> *variable = data;
<a name="l01761"></a>01761     <span class="keywordflow">switch</span> (*variable) {
<a name="l01762"></a>01762       <span class="keywordflow">case</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a320970f989dc8294c8203154e3db40c1">Qnil</a>:
<a name="l01763"></a>01763         <span class="keywordflow">return</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(0);
<a name="l01764"></a>01764       <span class="keywordflow">case</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aba0717d2689eb68797421a02ab9295c6">Qfalse</a>:
<a name="l01765"></a>01765         <span class="keywordflow">return</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(1);
<a name="l01766"></a>01766       <span class="keywordflow">case</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#aacea3516b33941ce8149098e223a7466">Qtrue</a>:
<a name="l01767"></a>01767         <span class="keywordflow">return</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#ac55fae7f748afd3fc2533d0d7d06cf5a">INT2FIX</a>(2);
<a name="l01768"></a>01768     }
<a name="l01769"></a>01769     <span class="keywordflow">return</span> <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a320970f989dc8294c8203154e3db40c1">Qnil</a>;                <span class="comment">/* not reached */</span>
<a name="l01770"></a>01770 }
<a name="l01771"></a>01771 
<a name="l01772"></a>01772 <span class="keywordtype">void</span>
<a name="l01773"></a><a class="code" href="../../df/d77/ruby_8c.html#ad6a1cc74c8bfe75b72688ca185c14db8">01773</a> <a class="code" href="../../db/d2e/intern_8h.html#ad6a1cc74c8bfe75b72688ca185c14db8">ruby_prog_init</a>(<span class="keywordtype">void</span>)
<a name="l01774"></a>01774 {
<a name="l01775"></a>01775     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a196d9fa3b954ec50f5ab17501d46c4ec">rb_define_hooked_variable</a>(<span class="stringliteral">&quot;$VERBOSE&quot;</span>, &amp;<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a56087d5316e4c73027105c023006cb15">ruby_verbose</a>, 0, <a class="code" href="../../df/d77/ruby_8c.html#a84ab8b02bd412174055520a9d33db7dd">verbose_setter</a>);
<a name="l01776"></a>01776     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a196d9fa3b954ec50f5ab17501d46c4ec">rb_define_hooked_variable</a>(<span class="stringliteral">&quot;$-v&quot;</span>, &amp;<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a56087d5316e4c73027105c023006cb15">ruby_verbose</a>, 0, <a class="code" href="../../df/d77/ruby_8c.html#a84ab8b02bd412174055520a9d33db7dd">verbose_setter</a>);
<a name="l01777"></a>01777     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a196d9fa3b954ec50f5ab17501d46c4ec">rb_define_hooked_variable</a>(<span class="stringliteral">&quot;$-w&quot;</span>, &amp;<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a56087d5316e4c73027105c023006cb15">ruby_verbose</a>, 0, <a class="code" href="../../df/d77/ruby_8c.html#a84ab8b02bd412174055520a9d33db7dd">verbose_setter</a>);
<a name="l01778"></a>01778     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a196d9fa3b954ec50f5ab17501d46c4ec">rb_define_hooked_variable</a>(<span class="stringliteral">&quot;$-W&quot;</span>, &amp;<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a56087d5316e4c73027105c023006cb15">ruby_verbose</a>, <a class="code" href="../../df/d77/ruby_8c.html#ab5c08f98f323afef17a9afa9c0742e29">opt_W_getter</a>, <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a2e765570aa5fb68b36e0ee87ed60de5f">rb_gvar_readonly_setter</a>);
<a name="l01779"></a>01779     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a57dd061565d9e4115ba7a19838b0f0f4">rb_define_variable</a>(<span class="stringliteral">&quot;$DEBUG&quot;</span>, &amp;<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a01ed2eb085103197c53c2b5c63b8f637">ruby_debug</a>);
<a name="l01780"></a>01780     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a57dd061565d9e4115ba7a19838b0f0f4">rb_define_variable</a>(<span class="stringliteral">&quot;$-d&quot;</span>, &amp;<a class="code" href="../../de/de6/ruby_2ruby_8h.html#a01ed2eb085103197c53c2b5c63b8f637">ruby_debug</a>);
<a name="l01781"></a>01781 
<a name="l01782"></a>01782     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a196d9fa3b954ec50f5ab17501d46c4ec">rb_define_hooked_variable</a>(<span class="stringliteral">&quot;$0&quot;</span>, &amp;<a class="code" href="../../df/d77/ruby_8c.html#ae28cabfebc4bb8a54c5a3d47d8f252d7">rb_progname</a>, 0, <a class="code" href="../../df/d77/ruby_8c.html#a2dbcfbcfd73958f4c630a47bc0f20f1c">set_arg0</a>);
<a name="l01783"></a>01783     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a196d9fa3b954ec50f5ab17501d46c4ec">rb_define_hooked_variable</a>(<span class="stringliteral">&quot;$PROGRAM_NAME&quot;</span>, &amp;<a class="code" href="../../df/d77/ruby_8c.html#ae28cabfebc4bb8a54c5a3d47d8f252d7">rb_progname</a>, 0, <a class="code" href="../../df/d77/ruby_8c.html#a2dbcfbcfd73958f4c630a47bc0f20f1c">set_arg0</a>);
<a name="l01784"></a>01784 
<a name="l01785"></a>01785     <span class="comment">/*</span>
<a name="l01786"></a>01786 <span class="comment">     * ARGV contains the command line arguments used to run ruby with the</span>
<a name="l01787"></a>01787 <span class="comment">     * first value containing the name of the executable.</span>
<a name="l01788"></a>01788 <span class="comment">     *</span>
<a name="l01789"></a>01789 <span class="comment">     * A library like OptionParser can be used to process command-line</span>
<a name="l01790"></a>01790 <span class="comment">     * arguments.</span>
<a name="l01791"></a>01791 <span class="comment">     */</span>
<a name="l01792"></a>01792     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a5a25f6effbffe412ebda3391132e7129">rb_define_global_const</a>(<span class="stringliteral">&quot;ARGV&quot;</span>, <a class="code" href="../../db/d2e/intern_8h.html#afe9c34a341643ab37d8505e716e68c2a">rb_argv</a>);
<a name="l01793"></a>01793 }
<a name="l01794"></a>01794 
<a name="l01795"></a>01795 <span class="keywordtype">void</span>
<a name="l01796"></a><a class="code" href="../../df/d77/ruby_8c.html#a7f84915d6c2752a20a285b9a6c53ca18">01796</a> <a class="code" href="../../db/d2e/intern_8h.html#a2b37b368f133db1234220d20c0c07689">ruby_set_argv</a>(<span class="keywordtype">int</span> <a class="code" href="../../df/d77/ruby_8c.html#ad1447518f4372828b8435ae82e48499e">argc</a>, <span class="keywordtype">char</span> **<a class="code" href="../../df/d77/ruby_8c.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>)
<a name="l01797"></a>01797 {
<a name="l01798"></a>01798     <span class="keywordtype">int</span> i;
<a name="l01799"></a>01799     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> av = <a class="code" href="../../db/d2e/intern_8h.html#afe9c34a341643ab37d8505e716e68c2a">rb_argv</a>;
<a name="l01800"></a>01800 
<a name="l01801"></a>01801 <span class="preprocessor">#if defined(USE_DLN_A_OUT)</span>
<a name="l01802"></a>01802 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (<a class="code" href="../../df/d77/ruby_8c.html#a6c2ae3c3abc05179cb0a01ec5918b38a">origarg</a>.argv)
<a name="l01803"></a>01803         dln_argv0 = <a class="code" href="../../df/d77/ruby_8c.html#a6c2ae3c3abc05179cb0a01ec5918b38a">origarg</a>.argv[0];
<a name="l01804"></a>01804     <span class="keywordflow">else</span>
<a name="l01805"></a>01805         dln_argv0 = argv[0];
<a name="l01806"></a>01806 <span class="preprocessor">#endif</span>
<a name="l01807"></a>01807 <span class="preprocessor"></span>    <a class="code" href="../../dc/dcc/array_8c.html#aaf8c74d0eef61073fadf2c631fa9540f">rb_ary_clear</a>(av);
<a name="l01808"></a>01808     <span class="keywordflow">for</span> (i = 0; i &lt; argc; i++) {
<a name="l01809"></a>01809         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> arg = <a class="code" href="../../db/d2e/intern_8h.html#a6c7ae9e860c73b7788ad9ed53b93bda9">rb_external_str_new_cstr</a>(argv[i]);
<a name="l01810"></a>01810 
<a name="l01811"></a>01811         <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a7ae8fa209abf837905d53c1c4be7c75d">OBJ_FREEZE</a>(arg);
<a name="l01812"></a>01812         <a class="code" href="../../dc/dcc/array_8c.html#a59d553a8cd781364b8bcb0deae25cca2">rb_ary_push</a>(av, arg);
<a name="l01813"></a>01813     }
<a name="l01814"></a>01814 }
<a name="l01815"></a>01815 
<a name="l01816"></a>01816 <span class="keywordtype">void</span> *
<a name="l01817"></a><a class="code" href="../../df/d77/ruby_8c.html#ad256d3e65e8db649bb88b817dd726faa">01817</a> <a class="code" href="../../db/d2e/intern_8h.html#a77b3346dd4a545359a66113f1e888556">ruby_process_options</a>(<span class="keywordtype">int</span> <a class="code" href="../../df/d77/ruby_8c.html#ad1447518f4372828b8435ae82e48499e">argc</a>, <span class="keywordtype">char</span> **<a class="code" href="../../df/d77/ruby_8c.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>)
<a name="l01818"></a>01818 {
<a name="l01819"></a>01819     <span class="keyword">struct </span><a class="code" href="../../d1/de6/structcmdline__options.html">cmdline_options</a> opt;
<a name="l01820"></a>01820     <a class="code" href="../../de/de6/ruby_2ruby_8h.html#a3c1d4bfc6a81af60bdcb48744c35f760">VALUE</a> iseq;
<a name="l01821"></a>01821 
<a name="l01822"></a>01822     <a class="code" href="../../db/d2e/intern_8h.html#a43beb82b75ff82edb7921a2045938189">ruby_script</a>(argv[0]);  <span class="comment">/* for the time being */</span>
<a name="l01823"></a>01823     rb_argv0 = <a class="code" href="../../db/d2e/intern_8h.html#af609add406b0ef084a38f6dd615119d6">rb_str_new4</a>(<a class="code" href="../../df/d77/ruby_8c.html#ae28cabfebc4bb8a54c5a3d47d8f252d7">rb_progname</a>);
<a name="l01824"></a>01824     <a class="code" href="../../d8/d16/gc_8c.html#adc7efe8997f04b5c275d7e7aed9169e3">rb_gc_register_mark_object</a>(rb_argv0);
<a name="l01825"></a>01825     iseq = <a class="code" href="../../df/d77/ruby_8c.html#a5be541642607b6f62b6bf919146c0b62">process_options</a>(argc, argv, <a class="code" href="../../df/d77/ruby_8c.html#a0c4c26a222f55646d38ac62ce6ce6ae4">cmdline_options_init</a>(&amp;opt));
<a name="l01826"></a>01826 
<a name="l01827"></a>01827 <span class="preprocessor">#ifndef HAVE_SETPROCTITLE</span>
<a name="l01828"></a>01828 <span class="preprocessor"></span>    {
<a name="l01829"></a>01829         <span class="keyword">extern</span> <span class="keywordtype">void</span> ruby_init_setproctitle(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[]);
<a name="l01830"></a>01830         ruby_init_setproctitle(argc, argv);
<a name="l01831"></a>01831     }
<a name="l01832"></a>01832 <span class="preprocessor">#endif</span>
<a name="l01833"></a>01833 <span class="preprocessor"></span>
<a name="l01834"></a>01834     <span class="keywordflow">return</span> (<span class="keywordtype">void</span>*)(<span class="keyword">struct </span><a class="code" href="../../d0/dcf/struct_r_data.html">RData</a>*)iseq;
<a name="l01835"></a>01835 }
<a name="l01836"></a>01836 
<a name="l01837"></a>01837 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l01838"></a><a class="code" href="../../df/d77/ruby_8c.html#a3793b93b0bb7d8a383d61226a5f2c97b">01838</a> <a class="code" href="../../df/d77/ruby_8c.html#a3793b93b0bb7d8a383d61226a5f2c97b">fill_standard_fds</a>(<span class="keywordtype">void</span>)
<a name="l01839"></a>01839 {
<a name="l01840"></a>01840     <span class="keywordtype">int</span> f0, f1, f2, fds[2];
<a name="l01841"></a>01841     <span class="keyword">struct </span><a class="code" href="../../dc/db1/win32_8h.html#a4feaac5e1913330bded57b059061965b">stat</a> buf;
<a name="l01842"></a>01842     f0 = <a class="code" href="../../dc/db1/win32_8h.html#a8a2cf46df7f7017617df85cdb0afdc64">fstat</a>(0, &amp;buf) == -1 &amp;&amp; <a class="code" href="../../d4/db0/__sdbm_8c.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a> == EBADF;
<a name="l01843"></a>01843     f1 = <a class="code" href="../../dc/db1/win32_8h.html#a8a2cf46df7f7017617df85cdb0afdc64">fstat</a>(1, &amp;buf) == -1 &amp;&amp; <a class="code" href="../../d4/db0/__sdbm_8c.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a> == EBADF;
<a name="l01844"></a>01844     f2 = <a class="code" href="../../dc/db1/win32_8h.html#a8a2cf46df7f7017617df85cdb0afdc64">fstat</a>(2, &amp;buf) == -1 &amp;&amp; <a class="code" href="../../d4/db0/__sdbm_8c.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a> == EBADF;
<a name="l01845"></a>01845     <span class="keywordflow">if</span> (f0) {
<a name="l01846"></a>01846         <span class="keywordflow">if</span> (pipe(fds) == 0) {
<a name="l01847"></a>01847             close(fds[1]);
<a name="l01848"></a>01848             <span class="keywordflow">if</span> (fds[0] != 0) {
<a name="l01849"></a>01849                 <a class="code" href="../../d3/d90/missing_8h.html#a1a7dc1d5f4ee5da620088e280e4bc580">dup2</a>(fds[0], 0);
<a name="l01850"></a>01850                 close(fds[0]);
<a name="l01851"></a>01851             }
<a name="l01852"></a>01852         }
<a name="l01853"></a>01853     }
<a name="l01854"></a>01854     <span class="keywordflow">if</span> (f1 || f2) {
<a name="l01855"></a>01855         <span class="keywordflow">if</span> (pipe(fds) == 0) {
<a name="l01856"></a>01856             close(fds[0]);
<a name="l01857"></a>01857             <span class="keywordflow">if</span> (f1 &amp;&amp; fds[1] != 1)
<a name="l01858"></a>01858                 <a class="code" href="../../d3/d90/missing_8h.html#a1a7dc1d5f4ee5da620088e280e4bc580">dup2</a>(fds[1], 1);
<a name="l01859"></a>01859             <span class="keywordflow">if</span> (f2 &amp;&amp; fds[1] != 2)
<a name="l01860"></a>01860                 <a class="code" href="../../d3/d90/missing_8h.html#a1a7dc1d5f4ee5da620088e280e4bc580">dup2</a>(fds[1], 2);
<a name="l01861"></a>01861             <span class="keywordflow">if</span> (fds[1] != 1 &amp;&amp; fds[1] != 2)
<a name="l01862"></a>01862                 close(fds[1]);
<a name="l01863"></a>01863         }
<a name="l01864"></a>01864     }
<a name="l01865"></a>01865 }
<a name="l01866"></a>01866 
<a name="l01867"></a>01867 <span class="keywordtype">void</span>
<a name="l01868"></a><a class="code" href="../../df/d77/ruby_8c.html#aa939b6f824daf3e455785b9a8b202ec2">01868</a> <a class="code" href="../../d8/de9/stub_8c.html#a1936ca2f0a3c33bfcf8018fb289858a7">ruby_sysinit</a>(<span class="keywordtype">int</span> *<a class="code" href="../../df/d77/ruby_8c.html#ad1447518f4372828b8435ae82e48499e">argc</a>, <span class="keywordtype">char</span> ***<a class="code" href="../../df/d77/ruby_8c.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>)
<a name="l01869"></a>01869 {
<a name="l01870"></a>01870 <span class="preprocessor">#if defined(_WIN32)</span>
<a name="l01871"></a>01871 <span class="preprocessor"></span>    <span class="keywordtype">void</span> <a class="code" href="../../d5/df2/win32_8c.html#ab5ca609dd4661f044cecf9e74eef0528">rb_w32_sysinit</a>(<span class="keywordtype">int</span> *argc, <span class="keywordtype">char</span> ***argv);
<a name="l01872"></a>01872     <a class="code" href="../../d5/df2/win32_8c.html#ab5ca609dd4661f044cecf9e74eef0528">rb_w32_sysinit</a>(argc, argv);
<a name="l01873"></a>01873 <span class="preprocessor">#endif</span>
<a name="l01874"></a>01874 <span class="preprocessor"></span>    <a class="code" href="../../df/d77/ruby_8c.html#a6c2ae3c3abc05179cb0a01ec5918b38a">origarg</a>.argc = *argc;
<a name="l01875"></a>01875     <a class="code" href="../../df/d77/ruby_8c.html#a6c2ae3c3abc05179cb0a01ec5918b38a">origarg</a>.argv = *argv;
<a name="l01876"></a>01876 <span class="preprocessor">#if defined(USE_DLN_A_OUT)</span>
<a name="l01877"></a>01877 <span class="preprocessor"></span>    dln_argv0 = <a class="code" href="../../df/d77/ruby_8c.html#a6c2ae3c3abc05179cb0a01ec5918b38a">origarg</a>.argv[0];
<a name="l01878"></a>01878 <span class="preprocessor">#endif</span>
<a name="l01879"></a>01879 <span class="preprocessor"></span>    <a class="code" href="../../df/d77/ruby_8c.html#a3793b93b0bb7d8a383d61226a5f2c97b">fill_standard_fds</a>();
<a name="l01880"></a>01880 }
<a name="l01881"></a>01881 
</pre></div></div>
<hr size="1"/><address style="text-align: right;"><small>Generated on 1 Mar 2013 for Ruby by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
