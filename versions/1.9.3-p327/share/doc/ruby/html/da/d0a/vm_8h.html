<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Ruby: include/ruby/vm.h File Reference</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="../../index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="../../files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="../../globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>include/ruby/vm.h File Reference</h1>
<p><a href="../../da/d0a/vm_8h_source.html">Go to the source code of this file.</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../da/d0a/vm_8h.html#a8820a2283cce09fb602f1dce808da007">RUBY_VM_H</a>&nbsp;&nbsp;&nbsp;1</td></tr>
<tr><td colspan="2"><h2>Typedefs</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">typedef struct <a class="el" href="../../db/d74/structrb__vm__struct.html">rb_vm_struct</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../da/d0a/vm_8h.html#afd6d6bfc5b87b128cc4b33c5b259b01a">ruby_vm_t</a></td></tr>
<tr><td colspan="2"><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../da/d0a/vm_8h.html#a64b7830f0ac2f5c4e03c3659051b3e4b">ruby_vm_destruct</a> (<a class="el" href="../../db/d74/structrb__vm__struct.html">ruby_vm_t</a> *vm)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../da/d0a/vm_8h.html#a450d06a010ca9e1139e5ba87c5cb9e38">ruby_vm_at_exit</a> (void(*<a class="el" href="../../dc/dd1/ossl__ssl_8c.html#a131c09b7f9c9a0b52e6f79f651cfd574">func</a>)(<a class="el" href="../../db/d74/structrb__vm__struct.html">ruby_vm_t</a> *))</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">ruby_vm_at_exit registers a function _func_ to be invoked when a VM passed away.  <a href="#a450d06a010ca9e1139e5ba87c5cb9e38"></a><br/></td></tr>
</table>
<hr/><h2>Define Documentation</h2>
<a class="anchor" id="a8820a2283cce09fb602f1dce808da007"></a><!-- doxytag: member="vm.h::RUBY_VM_H" ref="a8820a2283cce09fb602f1dce808da007" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define RUBY_VM_H&nbsp;&nbsp;&nbsp;1</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="../../da/d0a/vm_8h_source.html#l00013">13</a> of file <a class="el" href="../../da/d0a/vm_8h_source.html">vm.h</a>.</p>

</div>
</div>
<hr/><h2>Typedef Documentation</h2>
<a class="anchor" id="afd6d6bfc5b87b128cc4b33c5b259b01a"></a><!-- doxytag: member="vm.h::ruby_vm_t" ref="afd6d6bfc5b87b128cc4b33c5b259b01a" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="../../db/d74/structrb__vm__struct.html">rb_vm_struct</a> <a class="el" href="../../db/d74/structrb__vm__struct.html">ruby_vm_t</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="../../da/d0a/vm_8h_source.html#l00034">34</a> of file <a class="el" href="../../da/d0a/vm_8h_source.html">vm.h</a>.</p>

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="a450d06a010ca9e1139e5ba87c5cb9e38"></a><!-- doxytag: member="vm.h::ruby_vm_at_exit" ref="a450d06a010ca9e1139e5ba87c5cb9e38" args="(void(*func)(ruby_vm_t *))" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ruby_vm_at_exit </td>
          <td>(</td>
          <td class="paramtype">void(*)(<a class="el" href="../../db/d74/structrb__vm__struct.html">ruby_vm_t</a> *)&nbsp;</td>
          <td class="paramname"> <em>func</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>ruby_vm_at_exit registers a function _func_ to be invoked when a VM passed away. </p>
<p>Functions registered this way runs in reverse order of registration, just like END {} block does. The difference is its timing to be triggered. ruby_vm_at_exit functions runs when a VM _passed_ _away_, while END {} blocks runs just _before_ a VM _is_ _passing_ _away_.</p>
<p>You cannot register a function to another VM than where you are in. So where to register is intuitive, omitted. OTOH the argument _func_ cannot know which VM it is in because at the time of invocation, the VM has already died and there is no execution context. The VM itself is passed as the first argument to it.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>func</em>&nbsp;</td><td>the function to register. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="../../de/de9/vm_8c_source.html#l00205">205</a> of file <a class="el" href="../../de/de9/vm_8c_source.html">vm.c</a>.</p>

<p>References <a class="el" href="../../d5/d9d/tcltklib_8c_source.html#l00181">at_exit</a>, <a class="el" href="../../dc/dd1/ossl__ssl_8c.html#a131c09b7f9c9a0b52e6f79f651cfd574">func</a>, <a class="el" href="../../d8/d32/vm__core_8h_source.html#l00688">GET_VM</a>, and <a class="el" href="../../dc/dcc/array_8c_source.html#l00740">rb_ary_push()</a>.</p>

</div>
</div>
<a class="anchor" id="a64b7830f0ac2f5c4e03c3659051b3e4b"></a><!-- doxytag: member="vm.h::ruby_vm_destruct" ref="a64b7830f0ac2f5c4e03c3659051b3e4b" args="(ruby_vm_t *vm)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ruby_vm_destruct </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../db/d74/structrb__vm__struct.html">ruby_vm_t</a> *&nbsp;</td>
          <td class="paramname"> <em>vm</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="../../de/de9/vm_8c_source.html#l01604">1604</a> of file <a class="el" href="../../de/de9/vm_8c_source.html">vm.c</a>.</p>

<p>References <a class="el" href="../../d8/d32/vm__core_8h_source.html#l00284">rb_vm_struct::living_threads</a>, <a class="el" href="../../d8/d32/vm__core_8h_source.html#l00281">rb_vm_struct::main_thread</a>, <a class="el" href="../../d8/d32/vm__core_8h_source.html#l00321">rb_vm_struct::objspace</a>, <a class="el" href="../../d5/d75/cont_8c_source.html#l01357">rb_fiber_reset_root_local_storage()</a>, <a class="el" href="../../d8/d16/gc_8c_source.html#l02234">rb_gc_force_recycle()</a>, <a class="el" href="../../d8/d32/vm__core_8h.html#aea0806876fcecf60de5af807dd054ab0">rb_objspace_free()</a>, <a class="el" href="../../d3/de7/thread_8c_source.html#l00246">rb_vm_gvl_destroy()</a>, <a class="el" href="../../d0/daa/gc_8h_source.html#l00055">RUBY_FREE_ENTER</a>, <a class="el" href="../../d0/daa/gc_8h_source.html#l00056">RUBY_FREE_LEAVE</a>, <a class="el" href="../../de/de9/vm_8c_source.html#l00211">ruby_vm_run_at_exit_hooks()</a>, <a class="el" href="../../d8/d16/gc_8c_source.html#l00891">ruby_xfree()</a>, <a class="el" href="../../d8/d32/vm__core_8h_source.html#l00393">rb_thread_struct::self</a>, <a class="el" href="../../d8/d32/vm__core_8h_source.html#l00277">rb_vm_struct::self</a>, <a class="el" href="../../d4/d71/st_8c_source.html#l00266">st_free_table()</a>, and <a class="el" href="../../de/de9/vm_8c_source.html#l01772">thread_free()</a>.</p>

<p>Referenced by <a class="el" href="../../d3/d57/eval_8c_source.html#l00112">ruby_cleanup()</a>.</p>

</div>
</div>
</div>
<hr size="1"/><address style="text-align: right;"><small>Generated on 1 Mar 2013 for Ruby by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
