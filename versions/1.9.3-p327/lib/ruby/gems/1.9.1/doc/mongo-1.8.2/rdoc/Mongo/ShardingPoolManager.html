<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <meta content="text/html; charset=UTF-8" http-equiv="Content-Type" />

  <title>Class: Mongo::ShardingPoolManager</title>

  <link rel="stylesheet" href="../rdoc.css" type="text/css" media="screen" />

  <script src="../js/jquery.js" type="text/javascript" charset="utf-8"></script>
  <script src="../js/thickbox-compressed.js" type="text/javascript" charset="utf-8"></script>
  <script src="../js/quicksearch.js" type="text/javascript" charset="utf-8"></script>
  <script src="../js/darkfish.js" type="text/javascript" charset="utf-8"></script>

</head>
<body id="top" class="class">

  <div id="metadata">
    <div id="home-metadata">
      <div id="home-section" class="section">
        <h3 class="section-header">
          <a href="../index.html">Home</a>
          <a href="../index.html#classes">Classes</a>
          <a href="../index.html#methods">Methods</a>
        </h3>
      </div>
    </div>

    <div id="file-metadata">
      <div id="file-list-section" class="section">
        <h3 class="section-header">In Files</h3>
        <div class="section-body">
          <ul>
          
            <li><a href="../lib/mongo/util/sharding_pool_manager_rb.html?TB_iframe=true&amp;height=550&amp;width=785"
              class="thickbox" title="lib/mongo/util/sharding_pool_manager.rb">lib/mongo/util/sharding_pool_manager.rb</a></li>
          
          </ul>
        </div>
      </div>

      
    </div>

    <div id="class-metadata">
      
      <!-- Parent Class -->
      <div id="parent-class-section" class="section">
        <h3 class="section-header">Parent</h3>
        
        <p class="link"><a href="PoolManager.html">Mongo::PoolManager</a></p>
        
      </div>
      

      

      

      
      <!-- Method Quickref -->
      <div id="method-list-section" class="section">
        <h3 class="section-header">Methods</h3>
        <ul class="link-list">
          
          <li><a href="#method-c-new">::new</a></li>
          
          <li><a href="#method-i-best">#best</a></li>
          
          <li><a href="#method-i-check_connection_health">#check_connection_health</a></li>
          
          <li><a href="#method-i-connect">#connect</a></li>
          
          <li><a href="#method-i-inspect">#inspect</a></li>
          
        </ul>
      </div>
      

      
    </div>

    <div id="project-metadata">
      
      

      <div id="classindex-section" class="section project-section">
        <h3 class="section-header">Class/Module Index
          <span class="search-toggle"><img src="../images/find.png"
            height="16" width="16" alt="[+]"
            title="show/hide quicksearch" /></span></h3>
        <form action="#" method="get" accept-charset="utf-8" class="initially-hidden">
        <fieldset>
          <legend>Quicksearch</legend>
          <input type="text" name="quicksearch" value=""
            class="quicksearch-field" />
        </fieldset>
        </form>

        <ul class="link-list">
        
          <li><a href="../Mongo.html">Mongo</a></li>
        
          <li><a href="../Mongo/AuthenticationError.html">Mongo::AuthenticationError</a></li>
        
          <li><a href="../Mongo/Collection.html">Mongo::Collection</a></li>
        
          <li><a href="../Mongo/Connection.html">Mongo::Connection</a></li>
        
          <li><a href="../Mongo/ConnectionError.html">Mongo::ConnectionError</a></li>
        
          <li><a href="../Mongo/ConnectionFailure.html">Mongo::ConnectionFailure</a></li>
        
          <li><a href="../Mongo/ConnectionTimeoutError.html">Mongo::ConnectionTimeoutError</a></li>
        
          <li><a href="../Mongo/Constants.html">Mongo::Constants</a></li>
        
          <li><a href="../Mongo/Conversions.html">Mongo::Conversions</a></li>
        
          <li><a href="../Mongo/Cursor.html">Mongo::Cursor</a></li>
        
          <li><a href="../Mongo/DB.html">Mongo::DB</a></li>
        
          <li><a href="../Mongo/Grid.html">Mongo::Grid</a></li>
        
          <li><a href="../Mongo/GridError.html">Mongo::GridError</a></li>
        
          <li><a href="../Mongo/GridExt.html">Mongo::GridExt</a></li>
        
          <li><a href="../Mongo/GridExt/InstanceMethods.html">Mongo::GridExt::InstanceMethods</a></li>
        
          <li><a href="../Mongo/GridFileNotFound.html">Mongo::GridFileNotFound</a></li>
        
          <li><a href="../Mongo/GridFileSystem.html">Mongo::GridFileSystem</a></li>
        
          <li><a href="../Mongo/GridIO.html">Mongo::GridIO</a></li>
        
          <li><a href="../Mongo/GridMD5Failure.html">Mongo::GridMD5Failure</a></li>
        
          <li><a href="../Mongo/InvalidNSName.html">Mongo::InvalidNSName</a></li>
        
          <li><a href="../Mongo/InvalidOperation.html">Mongo::InvalidOperation</a></li>
        
          <li><a href="../Mongo/InvalidSortValueError.html">Mongo::InvalidSortValueError</a></li>
        
          <li><a href="../Mongo/LegacyWriteConcern.html">Mongo::LegacyWriteConcern</a></li>
        
          <li><a href="../Mongo/Logging.html">Mongo::Logging</a></li>
        
          <li><a href="../Mongo/Logging/Instrumenter.html">Mongo::Logging::Instrumenter</a></li>
        
          <li><a href="../Mongo/MongoArgumentError.html">Mongo::MongoArgumentError</a></li>
        
          <li><a href="../Mongo/MongoClient.html">Mongo::MongoClient</a></li>
        
          <li><a href="../Mongo/MongoDBError.html">Mongo::MongoDBError</a></li>
        
          <li><a href="../Mongo/MongoReplicaSetClient.html">Mongo::MongoReplicaSetClient</a></li>
        
          <li><a href="../Mongo/MongoRubyError.html">Mongo::MongoRubyError</a></li>
        
          <li><a href="../Mongo/MongoShardedClient.html">Mongo::MongoShardedClient</a></li>
        
          <li><a href="../Mongo/Networking.html">Mongo::Networking</a></li>
        
          <li><a href="../Mongo/Node.html">Mongo::Node</a></li>
        
          <li><a href="../Mongo/NodeWithTagsNotFound.html">Mongo::NodeWithTagsNotFound</a></li>
        
          <li><a href="../Mongo/OperationFailure.html">Mongo::OperationFailure</a></li>
        
          <li><a href="../Mongo/OperationTimeout.html">Mongo::OperationTimeout</a></li>
        
          <li><a href="../Mongo/Pool.html">Mongo::Pool</a></li>
        
          <li><a href="../Mongo/PoolManager.html">Mongo::PoolManager</a></li>
        
          <li><a href="../Mongo/ReadPreference.html">Mongo::ReadPreference</a></li>
        
          <li><a href="../Mongo/ReplSetConnection.html">Mongo::ReplSetConnection</a></li>
        
          <li><a href="../Mongo/ReplicaSetConnectionError.html">Mongo::ReplicaSetConnectionError</a></li>
        
          <li><a href="../Mongo/SSLSocket.html">Mongo::SSLSocket</a></li>
        
          <li><a href="../Mongo/ServerVersion.html">Mongo::ServerVersion</a></li>
        
          <li><a href="../Mongo/ShardedConnection.html">Mongo::ShardedConnection</a></li>
        
          <li><a href="../Mongo/ShardingPoolManager.html">Mongo::ShardingPoolManager</a></li>
        
          <li><a href="../Mongo/Support.html">Mongo::Support</a></li>
        
          <li><a href="../Mongo/TCPSocket.html">Mongo::TCPSocket</a></li>
        
          <li><a href="../Mongo/ThreadLocalVariableManager.html">Mongo::ThreadLocalVariableManager</a></li>
        
          <li><a href="../Mongo/UNIXSocket.html">Mongo::UNIXSocket</a></li>
        
          <li><a href="../Mongo/URIParser.html">Mongo::URIParser</a></li>
        
          <li><a href="../Mongo/WriteConcern.html">Mongo::WriteConcern</a></li>
        
          <li><a href="../Class.html">Class</a></li>
        
          <li><a href="../Mutex.html">Mutex</a></li>
        
        </ul>
        <div id="no-class-search-results" style="display: none;">No matching classes.</div>
      </div>

      
    </div>
  </div>

  <div id="documentation">
    <h1 class="class">Mongo::ShardingPoolManager</h1>

    <div id="description" class="description">
      
    </div><!-- description -->

    
    
    
    <div id="5Buntitled-5D" class="documentation-section">
      

      

      

      
      <!-- Attributes -->
      <div id="attribute-method-details" class="method-section section">
        <h3 class="section-header">Attributes</h3>

        
        <div id="client-attribute-method" class="method-detail">
          <a name="client"></a>
          
          <div class="method-heading attribute-method-heading">
            <span class="method-name">client</span><span
              class="attribute-access-type">[R]</span>
          </div>

          <div class="method-description">
          
          
          
          </div>
        </div>
        
        <div id="hosts-attribute-method" class="method-detail">
          <a name="hosts"></a>
          
          <div class="method-heading attribute-method-heading">
            <span class="method-name">hosts</span><span
              class="attribute-access-type">[R]</span>
          </div>

          <div class="method-description">
          
          
          
          </div>
        </div>
        
        <div id="max_bson_size-attribute-method" class="method-detail">
          <a name="max_bson_size"></a>
          
          <div class="method-heading attribute-method-heading">
            <span class="method-name">max_bson_size</span><span
              class="attribute-access-type">[R]</span>
          </div>

          <div class="method-description">
          
          
          
          </div>
        </div>
        
        <div id="members-attribute-method" class="method-detail">
          <a name="members"></a>
          
          <div class="method-heading attribute-method-heading">
            <span class="method-name">members</span><span
              class="attribute-access-type">[R]</span>
          </div>

          <div class="method-description">
          
          
          
          </div>
        </div>
        
        <div id="nodes-attribute-method" class="method-detail">
          <a name="nodes"></a>
          
          <div class="method-heading attribute-method-heading">
            <span class="method-name">nodes</span><span
              class="attribute-access-type">[R]</span>
          </div>

          <div class="method-description">
          
          
          
          </div>
        </div>
        
        <div id="primary-attribute-method" class="method-detail">
          <a name="primary"></a>
          
          <div class="method-heading attribute-method-heading">
            <span class="method-name">primary</span><span
              class="attribute-access-type">[R]</span>
          </div>

          <div class="method-description">
          
          
          
          </div>
        </div>
        
        <div id="primary_pool-attribute-method" class="method-detail">
          <a name="primary_pool"></a>
          
          <div class="method-heading attribute-method-heading">
            <span class="method-name">primary_pool</span><span
              class="attribute-access-type">[R]</span>
          </div>

          <div class="method-description">
          
          
          
          </div>
        </div>
        
      </div><!-- attribute-method-details -->
      

      <!-- Methods -->
      
      <div id="public-class-method-details" class="method-section section">
        <h3 class="section-header">Public Class Methods</h3>

      
        <div id="new-method" class="method-detail ">
          <a name="method-c-new"></a>

          
          <div class="method-heading">
            <span class="method-name">new</span><span
              class="method-args">(client, seeds=[])</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <p>Create a new set of connection pools.</p>

<p>The pool manager will by default use the original seed list passed to the
connection objects, accessible via connection.seeds. In addition, the user
may pass an additional list of seeds nodes discovered in real time. The
union of these lists will be used when attempting to connect, with the
newly-discovered nodes being used first.</p>
            

            
            <div class="method-source-code" id="new-source">
<pre>
<span class="ruby-comment"># File lib/mongo/util/sharding_pool_manager.rb, line 15</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-identifier">client</span>, <span class="ruby-identifier">seeds</span>=[])
  <span class="ruby-keyword">super</span>
<span class="ruby-keyword">end</span></pre>
            </div><!-- new-source -->
            
          </div>

          

          
        </div><!-- new-method -->

      
      </div><!-- public-class-method-details -->
    
      <div id="public-instance-method-details" class="method-section section">
        <h3 class="section-header">Public Instance Methods</h3>

      
        <div id="best-method" class="method-detail ">
          <a name="method-i-best"></a>

          
          <div class="method-heading">
            <span class="method-name">best</span><span
              class="method-args">(members)</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <p>“Best” should be the member with the fastest ping time but
connect/connect_to_members reinitializes @members</p>
            

            
            <div class="method-source-code" id="best-source">
<pre>
<span class="ruby-comment"># File lib/mongo/util/sharding_pool_manager.rb, line 25</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">best</span>(<span class="ruby-identifier">members</span>)
  <span class="ruby-constant">Array</span>(<span class="ruby-identifier">members</span>.<span class="ruby-identifier">first</span>)
<span class="ruby-keyword">end</span></pre>
            </div><!-- best-source -->
            
          </div>

          

          
        </div><!-- best-method -->

      
        <div id="check_connection_health-method" class="method-detail ">
          <a name="method-i-check_connection_health"></a>

          
          <div class="method-heading">
            <span class="method-name">check_connection_health</span><span
              class="method-args">()</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <p>We want to refresh to the member with the fastest ping time but also want
to minimize refreshes We’re healthy if the primary is pingable. If this
isn’t the case, or the members have changed, set @refresh_required to true,
and return. The config.mongos find can’t be part of the connect call chain
due to infinite recursion</p>
            

            
            <div class="method-source-code" id="check_connection_health-source">
<pre>
<span class="ruby-comment"># File lib/mongo/util/sharding_pool_manager.rb, line 45</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">check_connection_health</span>
  <span class="ruby-keyword">begin</span>
    <span class="ruby-identifier">seeds</span> = <span class="ruby-ivar">@client</span>[<span class="ruby-string">'config'</span>][<span class="ruby-string">'mongos'</span>].<span class="ruby-identifier">find</span>.<span class="ruby-identifier">to_a</span>.<span class="ruby-identifier">map</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">doc</span><span class="ruby-operator">|</span> <span class="ruby-identifier">doc</span>[<span class="ruby-string">'_id'</span>]}
    <span class="ruby-keyword">if</span> <span class="ruby-ivar">@seeds</span> <span class="ruby-operator">!=</span> <span class="ruby-identifier">seeds</span>
      <span class="ruby-ivar">@seeds</span> = <span class="ruby-identifier">seeds</span>
      <span class="ruby-ivar">@refresh_required</span> = <span class="ruby-keyword">true</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">rescue</span> <span class="ruby-constant">Mongo</span><span class="ruby-operator">::</span><span class="ruby-constant">OperationFailure</span>
    <span class="ruby-ivar">@refresh_required</span> = <span class="ruby-keyword">true</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
            </div><!-- check_connection_health-source -->
            
          </div>

          

          
        </div><!-- check_connection_health-method -->

      
        <div id="connect-method" class="method-detail ">
          <a name="method-i-connect"></a>

          
          <div class="method-heading">
            <span class="method-name">connect</span><span
              class="method-args">()</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            
            

            
            <div class="method-source-code" id="connect-source">
<pre>
<span class="ruby-comment"># File lib/mongo/util/sharding_pool_manager.rb, line 29</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">connect</span>
  <span class="ruby-identifier">close</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@previously_connected</span>

  <span class="ruby-identifier">initialize_data</span>
  <span class="ruby-identifier">members</span> = <span class="ruby-identifier">connect_to_members</span>
  <span class="ruby-identifier">initialize_pools</span>(<span class="ruby-identifier">best</span>(<span class="ruby-identifier">members</span>))

  <span class="ruby-ivar">@members</span> = <span class="ruby-identifier">members</span>
  <span class="ruby-ivar">@previously_connected</span> = <span class="ruby-keyword">true</span>
<span class="ruby-keyword">end</span></pre>
            </div><!-- connect-source -->
            
          </div>

          

          
        </div><!-- connect-method -->

      
        <div id="inspect-method" class="method-detail ">
          <a name="method-i-inspect"></a>

          
          <div class="method-heading">
            <span class="method-name">inspect</span><span
              class="method-args">()</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            
            

            
            <div class="method-source-code" id="inspect-source">
<pre>
<span class="ruby-comment"># File lib/mongo/util/sharding_pool_manager.rb, line 19</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">inspect</span>
  <span class="ruby-node">&quot;&lt;Mongo::ShardingPoolManager:0x#{self.object_id.to_s(16)} @seeds=#{@seeds}&gt;&quot;</span>
<span class="ruby-keyword">end</span></pre>
            </div><!-- inspect-source -->
            
          </div>

          

          
        </div><!-- inspect-method -->

      
      </div><!-- public-instance-method-details -->
    
    </div><!-- 5Buntitled-5D -->
  

  </div><!-- documentation -->

  <div id="validator-badges">
    <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
    <p><small>Generated with the <a href="http://deveiate.org/projects/Darkfish-Rdoc/">Darkfish
      Rdoc Generator</a> 2</small>.</p>
  </div>

</body>
</html>

