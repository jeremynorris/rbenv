<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <meta content="text/html; charset=UTF-8" http-equiv="Content-Type" />

  <title>Class: Puppet::PuppetSpecInitializer</title>

  <link rel="stylesheet" href="../rdoc.css" type="text/css" media="screen" />

  <script src="../js/jquery.js" type="text/javascript" charset="utf-8"></script>
  <script src="../js/thickbox-compressed.js" type="text/javascript" charset="utf-8"></script>
  <script src="../js/quicksearch.js" type="text/javascript" charset="utf-8"></script>
  <script src="../js/darkfish.js" type="text/javascript" charset="utf-8"></script>

</head>
<body id="top" class="class">

  <div id="metadata">
    <div id="home-metadata">
      <div id="home-section" class="section">
        <h3 class="section-header">
          <a href="../index.html">Home</a>
          <a href="../index.html#classes">Classes</a>
          <a href="../index.html#methods">Methods</a>
        </h3>
      </div>
    </div>

    <div id="file-metadata">
      <div id="file-list-section" class="section">
        <h3 class="section-header">In Files</h3>
        <div class="section-body">
          <ul>
          
            <li><a href="../lib/puppetlabs_spec_helper/puppet_spec_helper_rb.html?TB_iframe=true&amp;height=550&amp;width=785"
              class="thickbox" title="lib/puppetlabs_spec_helper/puppet_spec_helper.rb">lib/puppetlabs_spec_helper/puppet_spec_helper.rb</a></li>
          
          </ul>
        </div>
      </div>

      
    </div>

    <div id="class-metadata">
      
      <!-- Parent Class -->
      <div id="parent-class-section" class="section">
        <h3 class="section-header">Parent</h3>
        
        <p class="link"><a href="../Object.html">Object</a></p>
        
      </div>
      

      

      

      
      <!-- Method Quickref -->
      <div id="method-list-section" class="section">
        <h3 class="section-header">Methods</h3>
        <ul class="link-list">
          
          <li><a href="#method-c-initialize_via_fallback_compatibility">::initialize_via_fallback_compatibility</a></li>
          
          <li><a href="#method-c-initialize_via_testhelper">::initialize_via_testhelper</a></li>
          
        </ul>
      </div>
      

      
    </div>

    <div id="project-metadata">
      
      

      <div id="classindex-section" class="section project-section">
        <h3 class="section-header">Class/Module Index
          <span class="search-toggle"><img src="../images/find.png"
            height="16" width="16" alt="[+]"
            title="show/hide quicksearch" /></span></h3>
        <form action="#" method="get" accept-charset="utf-8" class="initially-hidden">
        <fieldset>
          <legend>Quicksearch</legend>
          <input type="text" name="quicksearch" value=""
            class="quicksearch-field" />
        </fieldset>
        </form>

        <ul class="link-list">
        
          <li><a href="../Puppet.html">Puppet</a></li>
        
          <li><a href="../Puppet/PuppetSpecInitializer.html">Puppet::PuppetSpecInitializer</a></li>
        
          <li><a href="../Puppet/Test.html">Puppet::Test</a></li>
        
          <li><a href="../Puppet/Test/LogCollector.html">Puppet::Test::LogCollector</a></li>
        
          <li><a href="../PuppetlabsSpec.html">PuppetlabsSpec</a></li>
        
          <li><a href="../PuppetlabsSpec/Files.html">PuppetlabsSpec::Files</a></li>
        
          <li><a href="../PuppetlabsSpec/Fixtures.html">PuppetlabsSpec::Fixtures</a></li>
        
          <li><a href="../PuppetlabsSpec/PuppetInternals.html">PuppetlabsSpec::PuppetInternals</a></li>
        
          <li><a href="../RSpec.html">RSpec</a></li>
        
          <li><a href="../RSpec/Matchers.html">RSpec::Matchers</a></li>
        
          <li><a href="../RSpec/Matchers/BlockAliases.html">RSpec::Matchers::BlockAliases</a></li>
        
          <li><a href="../Object.html">Object</a></li>
        
        </ul>
        <div id="no-class-search-results" style="display: none;">No matching classes.</div>
      </div>

      
    </div>
  </div>

  <div id="documentation">
    <h1 class="class">Puppet::PuppetSpecInitializer</h1>

    <div id="description" class="description">
      
    </div><!-- description -->

    
    
    
    <div id="5Buntitled-5D" class="documentation-section">
      

      

      

      

      <!-- Methods -->
      
      <div id="public-class-method-details" class="method-section section">
        <h3 class="section-header">Public Class Methods</h3>

      
        <div id="initialize_via_fallback_compatibility-method" class="method-detail ">
          <a name="method-c-initialize_via_fallback_compatibility"></a>

          
          <div class="method-heading">
            <span class="method-name">initialize_via_fallback_compatibility</span><span
              class="method-args">(config)</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <p>This method is for initializing puppet state for testing for older versions
of puppet that do not support the new TestHelper API.  As you can see, this
involves explicitly modifying global variables, directly manipulating
Puppet’s Settings singleton object, and other fun implementation details
that code external to puppet should really never know about.</p>
            

            
            <div class="method-source-code" id="initialize_via_fallback_compatibility-source">
<pre>
<span class="ruby-comment"># File lib/puppetlabs_spec_helper/puppet_spec_helper.rb, line 75</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">initialize_via_fallback_compatibility</span>(<span class="ruby-identifier">config</span>)
  <span class="ruby-identifier">config</span>.<span class="ruby-identifier">before</span> <span class="ruby-value">:all</span> <span class="ruby-keyword">do</span>
    <span class="ruby-comment"># nothing to do for now</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">config</span>.<span class="ruby-identifier">after</span> <span class="ruby-value">:all</span> <span class="ruby-keyword">do</span>
    <span class="ruby-comment"># nothing to do for now</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">config</span>.<span class="ruby-identifier">before</span> <span class="ruby-value">:each</span> <span class="ruby-keyword">do</span>
    <span class="ruby-comment"># these globals are set by Application</span>
    <span class="ruby-identifier">$puppet_application_mode</span> = <span class="ruby-keyword">nil</span>
    <span class="ruby-identifier">$puppet_application_name</span> = <span class="ruby-keyword">nil</span>

    <span class="ruby-comment"># REVISIT: I think this conceals other bad tests, but I don't have time to</span>
    <span class="ruby-comment"># fully diagnose those right now.  When you read this, please come tell me</span>
    <span class="ruby-comment"># I suck for letting this float. --daniel 2011-04-21</span>
    <span class="ruby-constant">Signal</span>.<span class="ruby-identifier">stubs</span>(<span class="ruby-value">:trap</span>)

    <span class="ruby-comment"># Set the confdir and vardir to gibberish so that tests</span>
    <span class="ruby-comment"># have to be correctly mocked.</span>
    <span class="ruby-constant">Puppet</span>[<span class="ruby-value">:confdir</span>] = <span class="ruby-string">&quot;/dev/null&quot;</span>
    <span class="ruby-constant">Puppet</span>[<span class="ruby-value">:vardir</span>] = <span class="ruby-string">&quot;/dev/null&quot;</span>

    <span class="ruby-comment"># Avoid opening ports to the outside world</span>
    <span class="ruby-constant">Puppet</span>.<span class="ruby-identifier">settings</span>[<span class="ruby-value">:bindaddress</span>] = <span class="ruby-string">&quot;127.0.0.1&quot;</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">config</span>.<span class="ruby-identifier">after</span> <span class="ruby-value">:each</span> <span class="ruby-keyword">do</span>
    <span class="ruby-constant">Puppet</span>.<span class="ruby-identifier">settings</span>.<span class="ruby-identifier">clear</span>

    <span class="ruby-constant">Puppet</span><span class="ruby-operator">::</span><span class="ruby-constant">Node</span><span class="ruby-operator">::</span><span class="ruby-constant">Environment</span>.<span class="ruby-identifier">clear</span>
    <span class="ruby-constant">Puppet</span><span class="ruby-operator">::</span><span class="ruby-constant">Util</span><span class="ruby-operator">::</span><span class="ruby-constant">Storage</span>.<span class="ruby-identifier">clear</span>
    <span class="ruby-constant">Puppet</span><span class="ruby-operator">::</span><span class="ruby-constant">Util</span><span class="ruby-operator">::</span><span class="ruby-constant">ExecutionStub</span>.<span class="ruby-identifier">reset</span> <span class="ruby-keyword">if</span> <span class="ruby-constant">Puppet</span><span class="ruby-operator">::</span><span class="ruby-constant">Util</span>.<span class="ruby-identifier">constants</span>.<span class="ruby-identifier">include?</span> <span class="ruby-string">&quot;ExecutionStub&quot;</span>

    <span class="ruby-constant">PuppetlabsSpec</span><span class="ruby-operator">::</span><span class="ruby-constant">Files</span>.<span class="ruby-identifier">cleanup</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
            </div><!-- initialize_via_fallback_compatibility-source -->
            
          </div>

          

          
        </div><!-- initialize_via_fallback_compatibility-method -->

      
        <div id="initialize_via_testhelper-method" class="method-detail ">
          <a name="method-c-initialize_via_testhelper"></a>

          
          <div class="method-heading">
            <span class="method-name">initialize_via_testhelper</span><span
              class="method-args">(config)</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <p>This method uses the “new”/preferred approach of delegating all of the test
state initialization to puppet itself, via Puppet::Test::TestHelper API. 
This should be fairly future-proof as long as that API doesn’t change,
which it hopefully will not need to.</p>
            

            
            <div class="method-source-code" id="initialize_via_testhelper-source">
<pre>
<span class="ruby-comment"># File lib/puppetlabs_spec_helper/puppet_spec_helper.rb, line 45</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">initialize_via_testhelper</span>(<span class="ruby-identifier">config</span>)
  <span class="ruby-keyword">begin</span>
    <span class="ruby-constant">Puppet</span><span class="ruby-operator">::</span><span class="ruby-constant">Test</span><span class="ruby-operator">::</span><span class="ruby-constant">TestHelper</span>.<span class="ruby-identifier">initialize</span>
  <span class="ruby-keyword">rescue</span> <span class="ruby-constant">NoMethodError</span>
    <span class="ruby-constant">Puppet</span><span class="ruby-operator">::</span><span class="ruby-constant">Test</span><span class="ruby-operator">::</span><span class="ruby-constant">TestHelper</span>.<span class="ruby-identifier">before_each_test</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># connect rspec hooks to TestHelper methods.</span>
  <span class="ruby-identifier">config</span>.<span class="ruby-identifier">before</span> <span class="ruby-value">:all</span> <span class="ruby-keyword">do</span>
    <span class="ruby-constant">Puppet</span><span class="ruby-operator">::</span><span class="ruby-constant">Test</span><span class="ruby-operator">::</span><span class="ruby-constant">TestHelper</span>.<span class="ruby-identifier">before_all_tests</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">config</span>.<span class="ruby-identifier">after</span> <span class="ruby-value">:all</span> <span class="ruby-keyword">do</span>
    <span class="ruby-constant">Puppet</span><span class="ruby-operator">::</span><span class="ruby-constant">Test</span><span class="ruby-operator">::</span><span class="ruby-constant">TestHelper</span>.<span class="ruby-identifier">after_all_tests</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">config</span>.<span class="ruby-identifier">before</span> <span class="ruby-value">:each</span> <span class="ruby-keyword">do</span>
    <span class="ruby-constant">Puppet</span><span class="ruby-operator">::</span><span class="ruby-constant">Test</span><span class="ruby-operator">::</span><span class="ruby-constant">TestHelper</span>.<span class="ruby-identifier">before_each_test</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">config</span>.<span class="ruby-identifier">after</span> <span class="ruby-value">:each</span> <span class="ruby-keyword">do</span>
    <span class="ruby-constant">Puppet</span><span class="ruby-operator">::</span><span class="ruby-constant">Test</span><span class="ruby-operator">::</span><span class="ruby-constant">TestHelper</span>.<span class="ruby-identifier">after_each_test</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
            </div><!-- initialize_via_testhelper-source -->
            
          </div>

          

          
        </div><!-- initialize_via_testhelper-method -->

      
      </div><!-- public-class-method-details -->
    
    </div><!-- 5Buntitled-5D -->
  

  </div><!-- documentation -->

  <div id="validator-badges">
    <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
    <p><small>Generated with the <a href="http://deveiate.org/projects/Darkfish-Rdoc/">Darkfish
      Rdoc Generator</a> 2</small>.</p>
  </div>

</body>
</html>

